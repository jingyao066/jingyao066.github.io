<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>19_lambda | Wjy&#39;s Blog</title>
<meta name="keywords" content="java基础">
<meta name="description" content="函数式编程
我们先看看什么是函数。函数是一种最基本的任务，一个大型程序就是一个顶层函数调用若干底层函数，这些被调用的函数又可以调用其他函数，即大任务被一层层拆解并执行。所以函数就是面向过程的程序设计的基本单元。
Java不支持单独定义函数，但可以把静态方法视为独立的函数，把实例方法视为自带this参数的函数。
而函数式编程（请注意多了一个“式”字）——Functional Programming，虽然也可以归结到面向过程的程序设计，但其思想更接近数学计算。
我们首先要搞明白计算机（Computer）和计算（Compute）的概念。
在计算机的层次上，CPU执行的是加减乘除的指令代码，以及各种条件判断和跳转指令，所以，汇编语言是最贴近计算机的语言。
而计算则指数学意义上的计算，越是抽象的计算，离计算机硬件越远。
对应到编程语言，就是越低级的语言，越贴近计算机，抽象程度低，执行效率高，比如C语言；越高级的语言，越贴近计算，抽象程度高，执行效率低，比如Lisp语言。
函数式编程就是一种抽象程度很高的编程范式，纯粹的函数式编程语言编写的函数没有变量，因此，任意一个函数，只要输入是确定的，输出就是确定的，这种纯函数我们称之为没有副作用。而允许使用变量的程序设计语言，由于函数内部的变量状态不确定，同样的输入，可能得到不同的输出，因此，这种函数是有副作用的。
函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！
函数式编程最早是数学家阿隆佐·邱奇研究的一套函数变换逻辑，又称Lambda Calculus（λ-Calculus），所以也经常把函数式编程称为Lambda计算。
Java平台从Java 8开始，支持函数式编程。">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://009965.xyz/posts/java%E5%9F%BA%E7%A1%80/19_lambda/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://009965.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://009965.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://009965.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://009965.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://009965.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://009965.xyz/posts/java%E5%9F%BA%E7%A1%80/19_lambda/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://009965.xyz/posts/java%E5%9F%BA%E7%A1%80/19_lambda/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="19_lambda">
  <meta property="og:description" content="函数式编程 我们先看看什么是函数。函数是一种最基本的任务，一个大型程序就是一个顶层函数调用若干底层函数，这些被调用的函数又可以调用其他函数，即大任务被一层层拆解并执行。所以函数就是面向过程的程序设计的基本单元。
Java不支持单独定义函数，但可以把静态方法视为独立的函数，把实例方法视为自带this参数的函数。
而函数式编程（请注意多了一个“式”字）——Functional Programming，虽然也可以归结到面向过程的程序设计，但其思想更接近数学计算。
我们首先要搞明白计算机（Computer）和计算（Compute）的概念。
在计算机的层次上，CPU执行的是加减乘除的指令代码，以及各种条件判断和跳转指令，所以，汇编语言是最贴近计算机的语言。
而计算则指数学意义上的计算，越是抽象的计算，离计算机硬件越远。
对应到编程语言，就是越低级的语言，越贴近计算机，抽象程度低，执行效率高，比如C语言；越高级的语言，越贴近计算，抽象程度高，执行效率低，比如Lisp语言。
函数式编程就是一种抽象程度很高的编程范式，纯粹的函数式编程语言编写的函数没有变量，因此，任意一个函数，只要输入是确定的，输出就是确定的，这种纯函数我们称之为没有副作用。而允许使用变量的程序设计语言，由于函数内部的变量状态不确定，同样的输入，可能得到不同的输出，因此，这种函数是有副作用的。
函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！
函数式编程最早是数学家阿隆佐·邱奇研究的一套函数变换逻辑，又称Lambda Calculus（λ-Calculus），所以也经常把函数式编程称为Lambda计算。
Java平台从Java 8开始，支持函数式编程。">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-08-15T18:18:18+00:00">
    <meta property="article:modified_time" content="2022-08-15T18:18:18+00:00">
    <meta property="article:tag" content="Java基础">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="19_lambda">
<meta name="twitter:description" content="函数式编程
我们先看看什么是函数。函数是一种最基本的任务，一个大型程序就是一个顶层函数调用若干底层函数，这些被调用的函数又可以调用其他函数，即大任务被一层层拆解并执行。所以函数就是面向过程的程序设计的基本单元。
Java不支持单独定义函数，但可以把静态方法视为独立的函数，把实例方法视为自带this参数的函数。
而函数式编程（请注意多了一个“式”字）——Functional Programming，虽然也可以归结到面向过程的程序设计，但其思想更接近数学计算。
我们首先要搞明白计算机（Computer）和计算（Compute）的概念。
在计算机的层次上，CPU执行的是加减乘除的指令代码，以及各种条件判断和跳转指令，所以，汇编语言是最贴近计算机的语言。
而计算则指数学意义上的计算，越是抽象的计算，离计算机硬件越远。
对应到编程语言，就是越低级的语言，越贴近计算机，抽象程度低，执行效率高，比如C语言；越高级的语言，越贴近计算，抽象程度高，执行效率低，比如Lisp语言。
函数式编程就是一种抽象程度很高的编程范式，纯粹的函数式编程语言编写的函数没有变量，因此，任意一个函数，只要输入是确定的，输出就是确定的，这种纯函数我们称之为没有副作用。而允许使用变量的程序设计语言，由于函数内部的变量状态不确定，同样的输入，可能得到不同的输出，因此，这种函数是有副作用的。
函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！
函数式编程最早是数学家阿隆佐·邱奇研究的一套函数变换逻辑，又称Lambda Calculus（λ-Calculus），所以也经常把函数式编程称为Lambda计算。
Java平台从Java 8开始，支持函数式编程。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://009965.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "19_lambda",
      "item": "https://009965.xyz/posts/java%E5%9F%BA%E7%A1%80/19_lambda/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "19_lambda",
  "name": "19_lambda",
  "description": "函数式编程 我们先看看什么是函数。函数是一种最基本的任务，一个大型程序就是一个顶层函数调用若干底层函数，这些被调用的函数又可以调用其他函数，即大任务被一层层拆解并执行。所以函数就是面向过程的程序设计的基本单元。\nJava不支持单独定义函数，但可以把静态方法视为独立的函数，把实例方法视为自带this参数的函数。\n而函数式编程（请注意多了一个“式”字）——Functional Programming，虽然也可以归结到面向过程的程序设计，但其思想更接近数学计算。\n我们首先要搞明白计算机（Computer）和计算（Compute）的概念。\n在计算机的层次上，CPU执行的是加减乘除的指令代码，以及各种条件判断和跳转指令，所以，汇编语言是最贴近计算机的语言。\n而计算则指数学意义上的计算，越是抽象的计算，离计算机硬件越远。\n对应到编程语言，就是越低级的语言，越贴近计算机，抽象程度低，执行效率高，比如C语言；越高级的语言，越贴近计算，抽象程度高，执行效率低，比如Lisp语言。\n函数式编程就是一种抽象程度很高的编程范式，纯粹的函数式编程语言编写的函数没有变量，因此，任意一个函数，只要输入是确定的，输出就是确定的，这种纯函数我们称之为没有副作用。而允许使用变量的程序设计语言，由于函数内部的变量状态不确定，同样的输入，可能得到不同的输出，因此，这种函数是有副作用的。\n函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！\n函数式编程最早是数学家阿隆佐·邱奇研究的一套函数变换逻辑，又称Lambda Calculus（λ-Calculus），所以也经常把函数式编程称为Lambda计算。\nJava平台从Java 8开始，支持函数式编程。\n",
  "keywords": [
    "java基础"
  ],
  "articleBody": "函数式编程 我们先看看什么是函数。函数是一种最基本的任务，一个大型程序就是一个顶层函数调用若干底层函数，这些被调用的函数又可以调用其他函数，即大任务被一层层拆解并执行。所以函数就是面向过程的程序设计的基本单元。\nJava不支持单独定义函数，但可以把静态方法视为独立的函数，把实例方法视为自带this参数的函数。\n而函数式编程（请注意多了一个“式”字）——Functional Programming，虽然也可以归结到面向过程的程序设计，但其思想更接近数学计算。\n我们首先要搞明白计算机（Computer）和计算（Compute）的概念。\n在计算机的层次上，CPU执行的是加减乘除的指令代码，以及各种条件判断和跳转指令，所以，汇编语言是最贴近计算机的语言。\n而计算则指数学意义上的计算，越是抽象的计算，离计算机硬件越远。\n对应到编程语言，就是越低级的语言，越贴近计算机，抽象程度低，执行效率高，比如C语言；越高级的语言，越贴近计算，抽象程度高，执行效率低，比如Lisp语言。\n函数式编程就是一种抽象程度很高的编程范式，纯粹的函数式编程语言编写的函数没有变量，因此，任意一个函数，只要输入是确定的，输出就是确定的，这种纯函数我们称之为没有副作用。而允许使用变量的程序设计语言，由于函数内部的变量状态不确定，同样的输入，可能得到不同的输出，因此，这种函数是有副作用的。\n函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！\n函数式编程最早是数学家阿隆佐·邱奇研究的一套函数变换逻辑，又称Lambda Calculus（λ-Calculus），所以也经常把函数式编程称为Lambda计算。\nJava平台从Java 8开始，支持函数式编程。\nLambda基础 在了解Lambda之前，我们先回顾一下Java的方法。\nJava的方法分为实例方法，例如Integer定义的equals()方法：\n1 2 3 4 5 public final class Integer { boolean equals(Object o) { } } 以及静态方法，例如Integer定义的parseInt()方法：\n1 2 3 4 5 public final class Integer { public static int parseInt(String s) { } } 无论是实例方法，还是静态方法，本质上都相当于过程式语言的函数。例如C函数：\n1 char* strcpy(char* dest, char* src) 只不过Java的实例方法隐含地传入了一个this变量，即实例方法总是有一个隐含参数this。\n函数式编程（Functional Programming）是把函数作为基本运算单元，函数可以作为变量，可以接收函数，还可以返回函数。历史上研究函数式编程的理论是Lambda演算，所以我们经常把支持函数式编程的编码风格称为Lambda表达式。\nLambda表达式 在Java程序中，我们经常遇到一大堆单方法接口，即一个接口只定义了一个方法：\nComparator Runnable Callable 以Comparator为例，我们想要调用Arrays.sort()时，可以传入一个Comparator实例，以匿名类方式编写如下：\n1 2 3 4 5 6 String[] array = [\"c\",\"b\",\"a\"]; Arrays.sort(array, new Comparator() { public int compare(String s1, String s2) { return s1.compareTo(s2); } }); 上述写法非常繁琐。从Java 8开始，我们可以用Lambda表达式替换单方法接口。改写上述代码如下：\n1 2 3 4 5 6 7 8 9 public class Main { public static void main(String[] args) { String[] array = new String[] {\"Apple\", \"Orange\", \"Banana\", \"Lemon\"}; Arrays.sort(array, (s1, s2) -\u003e { return s1.compareTo(s2); }); System.out.println(String.join(\", \", array)); } } 观察Lambda表达式的写法，它只需要写出方法定义：\n1 2 3 (s1, s2) -\u003e { return s1.compareTo(s2); } 其中，参数是(s1, s2)，参数类型可以省略，因为编译器可以自动推断出String类型。-\u003e { ... }表示方法体，所有代码写在内部即可。Lambda表达式没有class定义，因此写法非常简洁。\n如果只有一行return xxx的代码，完全可以用更简单的写法：\n1 Arrays.sort(array, (s1, s2) -\u003e s1.compareTo(s2)); 返回值的类型也是由编译器自动推断的，这里推断出的返回值是int，因此，只要返回int，编译器就不会报错。\nFunctionalInterface 我们把只定义了单方法的接口称之为FunctionalInterface，用注解@FunctionalInterface标记。例如，Callable接口：\n1 2 3 4 @FunctionalInterface public interface Callable { V call() throws Exception; } 再来看Comparator接口：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @FunctionalInterface public interface Comparator { int compare(T o1, T o2); boolean equals(Object obj); default Comparator reversed() { return Collections.reverseOrder(this); } default Comparator thenComparing(Comparator\u003c? super T\u003e other) { ... } ... } 虽然Comparator接口有很多方法，但只有一个抽象方法int compare(T o1, T o2)，其他的方法都是default方法或static方法。另外注意到boolean equals(Object obj)是Object定义的方法，不算在接口方法内。因此，Comparator也是一个FunctionalInterface。\n小结 单方法接口被称为FunctionalInterface。\n接收FunctionalInterface作为参数的时候，可以把实例化的匿名类改写为Lambda表达式，能大大简化代码。\nLambda表达式的参数和返回值均可由编译器自动推断。\n方法引用 使用Lambda表达式，我们就可以不必编写FunctionalInterface接口的实现类，从而简化代码：\n1 2 3 Arrays.sort(array, (s1, s2) -\u003e { return s1.compareTo(s2); }); 实际上，除了Lambda表达式，我们还可以直接传入方法引用。例如：\n1 2 3 4 5 6 7 8 9 10 11 public class Main { public static void main(String[] args) { String[] array = new String[] { \"Apple\", \"Orange\", \"Banana\", \"Lemon\" }; Arrays.sort(array, Main::cmp); System.out.println(String.join(\", \", array)); } static int cmp(String s1, String s2) { return s1.compareTo(s2); } } 上述代码在Arrays.sort()中直接传入了静态方法cmp的引用，用Main::cmp表示。\n因此，所谓方法引用，是指如果某个方法签名和接口恰好一致，就可以直接传入方法引用。\n因为Comparator接口定义的方法是int compare(String, String)，和静态方法int cmp(String, String)相比，除了方法名外，方法参数一致，返回类型相同，因此，我们说两者的方法签名一致，可以直接把方法名作为Lambda表达式传入：\n1 Arrays.sort(array, Main::cmp); 注意：在这里，方法签名只看参数类型和返回类型，不看方法名称，也不看类的继承关系。\n我们再看看如何引用实例方法。如果我们把代码改写如下：\n1 2 3 4 5 6 7 public class Main { public static void main(String[] args) { String[] array = new String[] { \"Apple\", \"Orange\", \"Banana\", \"Lemon\" }; Arrays.sort(array, String::compareTo); System.out.println(String.join(\", \", array)); } } 不但可以编译通过，而且运行结果也是一样的，这说明String.compareTo()方法也符合Lambda定义。\n观察String.compareTo()的方法定义：\n1 2 3 4 5 public final class String { public int compareTo(String o) { } } 这个方法的签名只有一个参数，为什么和int Comparator.compare(String, String)能匹配呢？\n因为实例方法有一个隐含的this参数，String类的compareTo()方法在实际调用的时候，第一个隐含参数总是传入this，相当于静态方法：\n1 public static int compareTo(this, String o); 所以，String.compareTo()方法也可作为方法引用传入。\n构造方法引用 除了可以引用静态方法和实例方法，我们还可以引用构造方法。\n我们来看一个例子：如果要把一个List转换为List，应该怎么办？\n1 2 3 4 5 6 7 8 9 class Person { String name; public Person(String name) { this.name = name; } } List names = List.of(\"Bob\", \"Alice\", \"Tim\"); List persons = ??? 传统的做法是先定义一个ArrayList，然后用for循环填充这个List：\n1 2 3 4 5 List names = List.of(\"Bob\", \"Alice\", \"Tim\"); List persons = new ArrayList\u003c\u003e(); for (String name : names) { persons.add(new Person(name)); } 要更简单地实现String到Person的转换，我们可以引用Person的构造方法：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public class Main { public static void main(String[] args) { List names = List.of(\"Bob\", \"Alice\", \"Tim\"); List persons = names.stream().map(Person::new).collect(Collectors.toList()); System.out.println(persons); } } class Person { String name; public Person(String name) { this.name = name; } public String toString() { return \"Person:\" + this.name; } } 后面我们会讲到Stream的map()方法。现在我们看到，这里的map()需要传入的FunctionalInterface的定义是：\n1 2 3 4 @FunctionalInterface public interface Function { R apply(T t); } 把泛型对应上就是方法签名Person apply(String)，即传入参数String，返回类型Person。而Person类的构造方法恰好满足这个条件，因为构造方法的参数是String，而构造方法虽然没有return语句，但它会隐式地返回this实例，类型就是Person，因此，此处可以引用构造方法。构造方法的引用写法是类名::new，因此，此处传入Person::new。\n小结 FunctionalInterface允许传入：\n接口的实现类（传统写法，代码较繁琐）； Lambda表达式（只需列出参数名，由编译器推断类型）； 符合方法签名的静态方法； 符合方法签名的实例方法（实例类型被看做第一个参数类型）； 符合方法签名的构造方法（实例类型被看做返回类型）。 FunctionalInterface不强制继承关系，不需要方法名称相同，只要求方法参数（类型和数量）与方法返回类型相同，即认为方法签名相同。\n使用Stream Java从8开始，不但引入了Lambda表达式，还引入了一个全新的流式API：Stream API。它位于java.util.stream包中。\n划重点：这个Stream不同于java.io的InputStream和OutputStream，它代表的是任意Java对象的序列。两者对比如下：\njava.io java.util.stream 存储 顺序读写的byte或char 顺序输出的任意Java对象实例 用途 序列化至文件或网络 内存计算／业务逻辑 有同学会问：一个顺序输出的Java对象序列，不就是一个List容器吗？\n再次划重点：这个Stream和List也不一样，List存储的每个元素都是已经存储在内存中的某个Java对象，而Stream输出的元素可能并没有预先存储在内存中，而是实时计算出来的。\n换句话说，List的用途是操作一组已存在的Java对象，而Stream实现的是惰性计算，两者对比如下：\njava.util.List java.util.stream 元素 已分配并存储在内存 可能未分配，实时计算 用途 操作一组已存在的Java对象 惰性计算 Stream看上去有点不好理解，但我们举个例子就明白了。\n如果我们要表示一个全体自然数的集合，显然，用List是不可能写出来的，因为自然数是无限的，内存再大也没法放到List中：\n1 List list = ??? // 全体自然数? 但是，用Stream可以做到。写法如下：\n1 Stream naturals = createNaturalStream(); // 全体自然数 我们先不考虑createNaturalStream()这个方法是如何实现的，我们看看如何使用这个Stream。\n首先，我们可以对每个自然数做一个平方，这样我们就把这个Stream转换成了另一个Stream：\n1 2 Stream naturals = createNaturalStream(); // 全体自然数 Stream streamNxN = naturals.map(n -\u003e n.multiply(n)); // 全体自然数的平方 因为这个streamNxN也有无限多个元素，要打印它，必须首先把无限多个元素变成有限个元素，可以用limit()方法截取前100个元素，最后用forEach()处理每个元素，这样，我们就打印出了前100个自然数的平方：\n1 2 3 4 Stream naturals = createNaturalStream(); naturals.map(n -\u003e n.multiply(n)) // 1, 4, 9, 16, 25... .limit(100) .forEach(System.out::println); 我们总结一下Stream的特点：它可以“存储”有限个或无限个元素。这里的存储打了个引号，是因为元素有可能已经全部存储在内存中，也有可能是根据需要实时计算出来的。\nStream的另一个特点是，一个Stream可以轻易地转换为另一个Stream，而不是修改原Stream本身。\n最后，真正的计算通常发生在最后结果的获取，也就是惰性计算。\n1 2 3 4 Stream naturals = createNaturalStream(); // 不计算 Stream s2 = naturals.map(BigInteger::multiply); // 不计算 Stream s3 = s2.limit(100); // 不计算 s3.forEach(System.out::println); // 计算 惰性计算的特点是：一个Stream转换为另一个Stream时，实际上只存储了转换规则，并没有任何计算发生。\n例如，创建一个全体自然数的Stream，不会进行计算，把它转换为上述s2这个Stream，也不会进行计算。再把s2这个无限Stream转换为s3这个有限的Stream，也不会进行计算。只有最后，调用forEach确实需要Stream输出的元素时，才进行计算。我们通常把Stream的操作写成链式操作，代码更简洁：\n1 2 3 4 createNaturalStream() .map(BigInteger::multiply) .limit(100) .forEach(System.out::println); 因此，Stream API的基本用法就是：创建一个Stream，然后做若干次转换，最后调用一个求值方法获取真正计算的结果：\n1 2 3 4 5 int result = createNaturalStream() // 创建Stream .filter(n -\u003e n % 2 == 0) // 任意个转换 .map(n -\u003e n * n) // 任意个转换 .limit(100) // 任意个转换 .sum(); // 最终计算结果 小结 Stream API的特点是：\nStream API提供了一套新的流式处理的抽象序列； Stream API支持函数式编程和链式操作； Stream可以表示无限序列，并且大多数情况下是惰性求值的。 创建Stream 要使用Stream，就必须先创建它。创建Stream有很多种方法，我们来一一介绍。\nStream.of() 创建Stream最简单的方式是直接用Stream.of()静态方法，传入可变参数即创建了一个能输出确定元素的Stream：\n1 2 3 4 5 6 7 8 public class Main { public static void main(String[] args) { Stream stream = Stream.of(\"A\", \"B\", \"C\", \"D\"); // forEach()方法相当于内部循环调用， // 可传入符合Consumer接口的void accept(T t)的方法引用： stream.forEach(System.out::println); } } 虽然这种方式基本上没啥实质性用途，但测试的时候很方便。\n基于数组或Collection创建Stream 第二种创建Stream的方法是基于一个数组或者Collection，这样该Stream输出的元素就是数组或者Collection持有的元素：\n1 2 3 4 5 6 7 8 public class Main { public static void main(String[] args) { Stream stream1 = Arrays.stream(new String[] { \"A\", \"B\", \"C\" }); Stream stream2 = List.of(\"X\", \"Y\", \"Z\").stream(); stream1.forEach(System.out::println); stream2.forEach(System.out::println); } } 把数组变成Stream使用Arrays.stream()方法。对于Collection（List、Set、Queue等），直接调用stream()方法就可以获得Stream。\n上述创建Stream的方法都是把一个现有的序列变为Stream，它的元素是固定的。\n基于Supplier创建Stream 创建Stream还可以通过Stream.generate()方法，它需要传入一个Supplier对象：\n1 Stream s = Stream.generate(Supplier sp); 基于Supplier创建的Stream会不断调用Supplier.get()方法来不断产生下一个元素，这种Stream保存的不是元素，而是算法，它可以用来表示无限序列。\n例如，我们编写一个能不断生成自然数的Supplier，它的代码非常简单，每次调用get()方法，就生成下一个自然数：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public class Main { public static void main(String[] args) { Stream natual = Stream.generate(new NatualSupplier()); // 注意：无限序列必须先变成有限序列再打印: natual.limit(20).forEach(System.out::println); } } class NatualSupplier implements Supplier { int n = 0; public Integer get() { n++; return n; } } 上述代码我们用一个Supplier模拟了一个无限序列（当然受int范围限制不是真的无限大）。如果用List表示，即便在int范围内，也会占用巨大的内存，而Stream几乎不占用空间，因为每个元素都是实时计算出来的，用的时候再算。\n对于无限序列，如果直接调用forEach()或者count()这些最终求值操作，会进入死循环，因为永远无法计算完这个序列，所以正确的方法是先把无限序列变成有限序列，例如，用limit()方法可以截取前面若干个元素，这样就变成了一个有限序列，对这个有限序列调用forEach()或者count()操作就没有问题。\n其他方式创建Stream 创建Stream的第三种方法是通过一些API提供的接口，直接获得Stream。\n例如，Files类的lines()方法可以把一个文件变成一个Stream，每个元素代表文件的一行内容：\n1 2 3 try (Stream lines = Files.lines(Paths.get(\"/path/to/file.txt\"))) { ... } 此方法对于按行遍历文本文件十分有用。\n另外，正则表达式的Pattern对象有一个splitAsStream()方法，可以直接把一个长字符串分割成Stream序列而不是数组：\n1 2 3 Pattern p = Pattern.compile(\"\\\\s+\"); Stream s = p.splitAsStream(\"The quick brown fox jumps over the lazy dog\"); s.forEach(System.out::println); 基本类型 因为Java的范型不支持基本类型，所以我们无法用Stream这样的类型，会发生编译错误。为了保存int，只能使用Stream，但这样会产生频繁的装箱、拆箱操作。为了提高效率，Java标准库提供了IntStream、LongStream和DoubleStream这三种使用基本类型的Stream，它们的使用方法和范型Stream没有大的区别，设计这三个Stream的目的是提高运行效率：\n1 2 3 4 // 将int[]数组变为IntStream: IntStream is = Arrays.stream(new int[] { 1, 2, 3 }); // 将Stream转换为LongStream: LongStream ls = List.of(\"1\", \"2\", \"3\").stream().mapToLong(Long::parseLong); 小结 创建Stream的方法有 ：\n通过指定元素、指定数组、指定Collection创建Stream； 通过Supplier创建Stream，可以是无限序列； 通过其他类的相关方法创建。 基本类型的Stream有IntStream、LongStream和DoubleStream。\n使用 Stream.map() Stream.map()是Stream最常用的一个转换方法，它把一个Stream转换为另一个Stream。\n所谓map操作，就是把一种操作运算，映射到一个序列的每一个元素上。例如，对x计算它的平方，可以使用函数f(x) = x * x。我们把这个函数映射到一个序列1，2，3，4，5上，就得到了另一个序列1，4，9，16，25：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 f(x) = x * x │ │ ┌───┬───┬───┬───┼───┬───┬───┬───┐ │ │ │ │ │ │ │ │ │ ▼ ▼ ▼ ▼ ▼ ▼ ▼ ▼ ▼ [ 1 2 3 4 5 6 7 8 9 ] │ │ │ │ │ │ │ │ │ │ │ │ │ │ │ │ │ │ ▼ ▼ ▼ ▼ ▼ ▼ ▼ ▼ ▼ [ 1 4 9 16 25 36 49 64 81 ] 可见，map操作，把一个Stream的每个元素一一对应到应用了目标函数的结果上。\n1 2 Stream s = Stream.of(1, 2, 3, 4, 5); Stream s2 = s.map(n -\u003e n * n); 如果我们查看Stream的源码，会发现map()方法接收的对象是Function接口对象，它定义了一个apply()方法，负责把一个T类型转换成R类型：\n1 Stream map(Function\u003c? super T, ? extends R\u003e mapper); 其中，Function的定义是：\n1 2 3 4 5 @FunctionalInterface public interface Function { // 将T类型转换为R: R apply(T t); } 利用map()，不但能完成数学计算，对于字符串操作，以及任何Java对象都是非常有用的。例如：\n1 2 3 4 5 6 7 8 9 public class Main { public static void main(String[] args) { List.of(\" Apple \", \" pear \", \" ORANGE\", \" BaNaNa \") .stream() .map(String::trim) // 去空格 .map(String::toLowerCase) // 变小写 .forEach(System.out::println); // 打印 } } 通过若干步map转换，可以写出逻辑简单、清晰的代码。\n使用filter Stream.filter()是Stream的另一个常用转换方法。\n所谓filter()操作，就是对一个Stream的所有元素一一进行测试，不满足条件的就被“滤掉”了，剩下的满足条件的元素就构成了一个新的Stream。\n例如，我们对1，2，3，4，5这个Stream调用filter()，传入的测试函数f(x) = x % 2 != 0用来判断元素是否是奇数，这样就过滤掉偶数，只剩下奇数，因此我们得到了另一个序列1，3，5：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 f(x) = x % 2 != 0 │ │ ┌───┬───┬───┬───┼───┬───┬───┬───┐ │ │ │ │ │ │ │ │ │ ▼ ▼ ▼ ▼ ▼ ▼ ▼ ▼ ▼ [ 1 2 3 4 5 6 7 8 9 ] │ X │ X │ X │ X │ │ │ │ │ │ ▼ ▼ ▼ ▼ ▼ [ 1 3 5 7 9 ] 用IntStream写出上述逻辑，代码如下：\n1 2 3 4 5 6 7 public class Main { public static void main(String[] args) { IntStream.of(1, 2, 3, 4, 5, 6, 7, 8, 9) .filter(n -\u003e n % 2 != 0) .forEach(System.out::println); } } 从结果可知，经过filter()后生成的Stream元素可能变少。\nfilter()方法接收的对象是Predicate接口对象，它定义了一个test()方法，负责判断元素是否符合条件：\n1 2 3 4 5 @FunctionalInterface public interface Predicate { // 判断元素t是否符合条件: boolean test(T t); } filter()除了常用于数值外，也可应用于任何Java对象。例如，从一组给定的LocalDate中过滤掉工作日，以便得到休息日：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public class Main { public static void main(String[] args) { Stream.generate(new LocalDateSupplier()) .limit(31) .filter(ldt -\u003e ldt.getDayOfWeek() == DayOfWeek.SATURDAY || ldt.getDayOfWeek() == DayOfWeek.SUNDAY) .forEach(System.out::println); } } class LocalDateSupplier implements Supplier { LocalDate start = LocalDate.of(2020, 1, 1); int n = -1; public LocalDate get() { n++; return start.plusDays(n); } } 使用reduce map()和filter()都是Stream的转换方法，而Stream.reduce()则是Stream的一个聚合方法，它可以把一个Stream的所有元素按照聚合函数聚合成一个结果。\n我们来看一个简单的聚合方法：\n1 2 3 4 5 6 public class Main { public static void main(String[] args) { int sum = Stream.of(1, 2, 3, 4, 5, 6, 7, 8, 9).reduce(0, (acc, n) -\u003e acc + n); System.out.println(sum); // 45 } } reduce()方法传入的对象是BinaryOperator接口，它定义了一个apply()方法，负责把上次累加的结果和本次的元素 进行运算，并返回累加的结果：\n1 2 3 4 5 @FunctionalInterface public interface BinaryOperator { // Bi操作：两个输入，一个输出 T apply(T t, T u); } 上述代码看上去不好理解，但我们用for循环改写一下，就容易理解了：\n1 2 3 4 5 Stream stream = ... int sum = 0; for (n : stream) { sum = (sum, n) -\u003e sum + n; } 可见，reduce()操作首先初始化结果为指定值（这里是0），紧接着，reduce()对每个元素依次调用(acc, n) -\u003e acc + n，其中，acc是上次计算的结果：\n1 2 3 4 5 6 7 8 9 10 11 // 计算过程: acc = 0 // 初始化为指定值 acc = acc + n = 0 + 1 = 1 // n = 1 acc = acc + n = 1 + 2 = 3 // n = 2 acc = acc + n = 3 + 3 = 6 // n = 3 acc = acc + n = 6 + 4 = 10 // n = 4 acc = acc + n = 10 + 5 = 15 // n = 5 acc = acc + n = 15 + 6 = 21 // n = 6 acc = acc + n = 21 + 7 = 28 // n = 7 acc = acc + n = 28 + 8 = 36 // n = 8 acc = acc + n = 36 + 9 = 45 // n = 9 因此，实际上这个reduce()操作是一个求和。\n如果去掉初始值，我们会得到一个Optional：\n1 2 3 4 Optional opt = stream.reduce((acc, n) -\u003e acc + n); if (opt.isPresent()) { System.out.println(opt.get()); } 这是因为Stream的元素有可能是0个，这样就没法调用reduce()的聚合函数了，因此返回Optional对象，需要进一步判断结果是否存在。\n利用reduce()，我们可以把求和改成求积，代码也十分简单：\n1 2 3 4 5 6 public class Main { public static void main(String[] args) { int s = Stream.of(1, 2, 3, 4, 5, 6, 7, 8, 9).reduce(1, (acc, n) -\u003e acc * n); System.out.println(s); // 362880 } } 注意：计算求积时，初始值必须设置为1。\n除了可以对数值进行累积计算外，灵活运用reduce()也可以对Java对象进行操作。下面的代码演示了如何将配置文件的每一行配置通过map()和reduce()操作聚合成一个Map：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 public class Main { public static void main(String[] args) { // 按行读取配置文件: List props = List.of(\"profile=native\", \"debug=true\", \"logging=warn\", \"interval=500\"); Map map = props.stream() // 把k=v转换为Map[k]=v: .map(kv -\u003e { String[] ss = kv.split(\"\\\\=\", 2); return Map.of(ss[0], ss[1]); }) // 把所有Map聚合到一个Map: .reduce(new HashMap(), (m, kv) -\u003e { m.putAll(kv); return m; }); // 打印结果: map.forEach((k, v) -\u003e { System.out.println(k + \" = \" + v); }); } } 小结 reduce()方法将一个Stream的每个元素依次作用于BinaryOperator，并将结果合并。\nreduce()是聚合方法，聚合方法会立刻对Stream进行计算。\n输出集合 我们介绍了Stream的几个常见操作：map()、filter()、reduce()。这些操作对Stream来说可以分为两类，一类是转换操作，即把一个Stream转换为另一个Stream，例如map()和filter()，另一类是聚合操作，即对Stream的每个元素进行计算，得到一个确定的结果，例如reduce()。\n区分这两种操作是非常重要的，因为对于Stream来说，对其进行转换操作并不会触发任何计算！我们可以做个实验：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public class Main { public static void main(String[] args) { Stream s1 = Stream.generate(new NatualSupplier()); Stream s2 = s1.map(n -\u003e n * n); Stream s3 = s2.map(n -\u003e n - 1); System.out.println(s3); // java.util.stream.ReferencePipeline$3@49476842 } } class NatualSupplier implements Supplier { long n = 0; public Long get() { n++; return n; } } 因为s1是一个Long类型的序列，它的元素高达922亿亿个，但执行上述代码，既不会有任何内存增长，也不会有任何计算，因为转换操作只是保存了转换规则，无论我们对一个Stream转换多少次，都不会有任何实际计算发生。\n而聚合操作则不一样，聚合操作会立刻促使Stream输出它的每一个元素，并依次纳入计算，以获得最终结果。所以，对一个Stream进行聚合操作，会触发一系列连锁反应：\n1 2 3 4 5 Stream s1 = Stream.generate(new NatualSupplier()); Stream s2 = s1.map(n -\u003e n * n); Stream s3 = s2.map(n -\u003e n - 1); Stream s4 = s3.limit(10); s4.reduce(0, (acc, n) -\u003e acc + n); 我们对s4进行reduce()聚合计算，会不断请求s4输出它的每一个元素。因为s4的上游是s3，它又会向s3请求元素，导致s3向s2请求元素，s2向s1请求元素，最终，s1从Supplier实例中请求到真正的元素，并经过一系列转换，最终被reduce()聚合出结果。\n可见，聚合操作是真正需要从Stream请求数据的，对一个Stream做聚合计算后，结果就不是一个Stream，而是一个其他的Java对象。\n输出为List reduce()只是一种聚合操作，如果我们希望把Stream的元素保存到集合，例如List，因为List的元素是确定的Java对象，因此，把Stream变为List不是一个转换操作，而是一个聚合操作，它会强制Stream输出每个元素。\n下面的代码演示了如何将一组String先过滤掉空字符串，然后把非空字符串保存到List中：\n1 2 3 4 5 6 7 8 9 public class Main { public static void main(String[] args) { Stream stream = Stream.of(\"Apple\", \"\", null, \"Pear\", \" \", \"Orange\"); List list = stream .filter(s -\u003e s != null \u0026\u0026 !s.isBlank()) .collect(Collectors.toList()); System.out.println(list); } } 把Stream的每个元素收集到List的方法是调用collect()并传入Collectors.toList()对象，它实际上是一个Collector实例，通过类似reduce()的操作，把每个元素添加到一个收集器中（实际上是ArrayList）。\n类似的，collect(Collectors.toSet())可以把Stream的每个元素收集到Set中。\n输出为数组 把Stream的元素输出为数组和输出为List类似，我们只需要调用toArray()方法，并传入数组的“构造方法”：\n1 2 List list = List.of(\"Apple\", \"Banana\", \"Orange\"); String[] array = list.stream().toArray(String[]::new); 注意到传入的“构造方法”是String[]::new，它的签名实际上是IntFunction定义的String[] apply(int)，即传入int参数，获得String[]数组的返回值。\n输出为Map 如果我们要把Stream的元素收集到Map中，就稍微麻烦一点。因为对于每个元素，添加到Map时需要key和value，因此，我们要指定两个映射函数，分别把元素映射为key和value：\n1 2 3 4 5 6 7 8 9 10 11 12 public class Main { public static void main(String[] args) { Stream stream = Stream.of(\"APPL:Apple\", \"MSFT:Microsoft\"); Map map = stream .collect(Collectors.toMap( // 把元素s映射为key: s -\u003e s.substring(0, s.indexOf(':')), // 把元素s映射为value: s -\u003e s.substring(s.indexOf(':') + 1))); System.out.println(map); } } 分组输出 Stream还有一个强大的分组功能，可以按组输出。我们看下面的例子：\n1 2 3 4 5 6 7 8 public class Main { public static void main(String[] args) { List list = List.of(\"Apple\", \"Banana\", \"Blackberry\", \"Coconut\", \"Avocado\", \"Cherry\", \"Apricots\"); Map",
  "wordCount" : "34718",
  "inLanguage": "en",
  "datePublished": "2022-08-15T18:18:18Z",
  "dateModified": "2022-08-15T18:18:18Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://009965.xyz/posts/java%E5%9F%BA%E7%A1%80/19_lambda/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://009965.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      19_lambda
    </h1>
    <div class="post-meta"><span title='2022-08-15 18:18:18 +0000 UTC'>2022-08-15</span>&nbsp;·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b" aria-label="函数式编程">函数式编程</a></li>
                <li>
                    <a href="#lambda%e5%9f%ba%e7%a1%80" aria-label="Lambda基础">Lambda基础</a><ul>
                        
                <li>
                    <a href="#lambda%e8%a1%a8%e8%be%be%e5%bc%8f" aria-label="Lambda表达式">Lambda表达式</a></li>
                <li>
                    <a href="#functionalinterface" aria-label="FunctionalInterface">FunctionalInterface</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e5%bc%95%e7%94%a8" aria-label="方法引用">方法引用</a><ul>
                        
                <li>
                    <a href="#%e6%9e%84%e9%80%a0%e6%96%b9%e6%b3%95%e5%bc%95%e7%94%a8" aria-label="构造方法引用">构造方法引用</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-1" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8stream" aria-label="使用Stream">使用Stream</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-2" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%bastream" aria-label="创建Stream">创建Stream</a><ul>
                        
                <li>
                    <a href="#streamof" aria-label="Stream.of()">Stream.of()</a></li>
                <li>
                    <a href="#%e5%9f%ba%e4%ba%8e%e6%95%b0%e7%bb%84%e6%88%96collection%e5%88%9b%e5%bb%bastream" aria-label="基于数组或Collection创建Stream">基于数组或Collection创建Stream</a></li>
                <li>
                    <a href="#%e5%9f%ba%e4%ba%8esupplier%e5%88%9b%e5%bb%bastream" aria-label="基于Supplier创建Stream">基于Supplier创建Stream</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96%e6%96%b9%e5%bc%8f%e5%88%9b%e5%bb%bastream" aria-label="其他方式创建Stream">其他方式创建Stream</a></li>
                <li>
                    <a href="#%e5%9f%ba%e6%9c%ac%e7%b1%bb%e5%9e%8b" aria-label="基本类型">基本类型</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-3" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-streammap" aria-label="使用 Stream.map()">使用 Stream.map()</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8filter" aria-label="使用filter">使用filter</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8reduce" aria-label="使用reduce">使用reduce</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-4" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%be%93%e5%87%ba%e9%9b%86%e5%90%88" aria-label="输出集合">输出集合</a><ul>
                        
                <li>
                    <a href="#%e8%be%93%e5%87%ba%e4%b8%balist" aria-label="输出为List">输出为List</a></li>
                <li>
                    <a href="#%e8%be%93%e5%87%ba%e4%b8%ba%e6%95%b0%e7%bb%84" aria-label="输出为数组">输出为数组</a></li>
                <li>
                    <a href="#%e8%be%93%e5%87%ba%e4%b8%bamap" aria-label="输出为Map">输出为Map</a></li>
                <li>
                    <a href="#%e5%88%86%e7%bb%84%e8%be%93%e5%87%ba" aria-label="分组输出">分组输出</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96%e6%93%8d%e4%bd%9c" aria-label="其他操作">其他操作</a><ul>
                        
                <li>
                    <a href="#%e6%8e%92%e5%ba%8f" aria-label="排序">排序</a></li>
                <li>
                    <a href="#%e5%8e%bb%e9%87%8d" aria-label="去重">去重</a></li>
                <li>
                    <a href="#%e6%88%aa%e5%8f%96" aria-label="截取">截取</a></li>
                <li>
                    <a href="#%e5%90%88%e5%b9%b6" aria-label="合并">合并</a></li>
                <li>
                    <a href="#flatmap" aria-label="flatMap">flatMap</a></li>
                <li>
                    <a href="#%e5%b9%b6%e8%a1%8c" aria-label="并行">并行</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96%e8%81%9a%e5%90%88%e6%96%b9%e6%b3%95" aria-label="其他聚合方法">其他聚合方法</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-5" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#----------%e5%88%86%e5%89%b2%e7%ba%bf-----------" aria-label="&mdash;&mdash;&mdash;-分割线&mdash;&mdash;&mdash;&ndash;">&mdash;&mdash;&mdash;-分割线&mdash;&mdash;&mdash;&ndash;</a></li>
                <li>
                    <a href="#lambda%e8%a1%a8%e8%be%be%e5%bc%8f-1" aria-label="Lambda表达式">Lambda表达式</a><ul>
                        
                <li>
                    <a href="#lambda%e8%a1%a8%e8%be%be%e5%bc%8f%e7%9a%84%e8%af%ad%e6%b3%95" aria-label="Lambda表达式的语法">Lambda表达式的语法</a></li>
                <li>
                    <a href="#lambda%e8%a1%a8%e8%be%be%e5%bc%8f%e5%92%8c%e5%87%bd%e6%95%b0%e5%bc%8f%e6%8e%a5%e5%8f%a3%e7%bb%93%e5%90%88" aria-label="Lambda表达式和函数式接口结合">Lambda表达式和函数式接口结合</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96%e5%bd%a2%e5%bc%8f%e7%9a%84%e5%87%bd%e6%95%b0%e5%bc%8f%e6%8e%a5%e5%8f%a3%e5%8f%8a%e5%ae%9e%e7%8e%b0" aria-label="其他形式的函数式接口及实现">其他形式的函数式接口及实现</a><ul>
                        
                <li>
                    <a href="#%e6%9c%89%e5%8f%82%e6%97%a0%e8%bf%94%e5%9b%9e%e5%80%bc" aria-label="有参无返回值">有参无返回值</a></li>
                <li>
                    <a href="#%e6%97%a0%e5%8f%82%e6%9c%89%e8%bf%94%e5%9b%9e%e5%80%bc" aria-label="无参有返回值">无参有返回值</a></li>
                <li>
                    <a href="#%e6%9c%89%e5%8f%82%e6%9c%89%e8%bf%94%e5%9b%9e%e5%80%bc" aria-label="有参有返回值">有参有返回值</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%87%a0%e7%a7%8d%e7%ae%80%e5%8d%95%e5%bd%a2%e5%bc%8f" aria-label="几种简单形式">几种简单形式</a></li>
                <li>
                    <a href="#%e5%9f%ba%e6%9c%ac%e7%9a%84lambda%e4%be%8b%e5%ad%90" aria-label="基本的Lambda例子">基本的Lambda例子</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8lambda%e5%af%b9%e9%9b%86%e5%90%88%e8%bf%9b%e8%a1%8c%e6%8e%92%e5%ba%8f" aria-label="使用Lambda对集合进行排序">使用Lambda对集合进行排序</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8lambdas%e5%92%8cstreams" aria-label="使用Lambdas和Streams">使用Lambdas和Streams</a></li>
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e5%87%bd%e6%95%b0%e5%bc%8f%e6%8e%a5%e5%8f%a3" aria-label="什么是函数式接口">什么是函数式接口</a></li>
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e5%bc%95%e7%94%a8-1" aria-label="方法引用">方法引用</a><ul>
                        
                <li>
                    <a href="#%e9%9d%99%e6%80%81%e6%96%b9%e6%b3%95%e5%bc%95%e7%94%a8" aria-label="静态方法引用">静态方法引用</a></li>
                <li>
                    <a href="#%e5%ae%9e%e4%be%8b%e6%96%b9%e6%b3%95%e5%bc%95%e7%94%a8" aria-label="实例方法引用">实例方法引用</a></li>
                <li>
                    <a href="#%e7%b1%bb%e6%96%b9%e6%b3%95%e5%bc%95%e7%94%a8" aria-label="类方法引用">类方法引用</a></li>
                <li>
                    <a href="#%e6%9e%84%e9%80%a0%e6%96%b9%e6%b3%95%e5%bc%95%e7%94%a8-1" aria-label="构造方法引用">构造方法引用</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#lambda%e8%a1%a8%e8%be%be%e5%bc%8f%e7%9a%84%e4%b8%80%e4%ba%9b%e5%b0%8f%e9%97%ae%e9%a2%98" aria-label="lambda表达式的一些小问题">lambda表达式的一些小问题</a><ul>
                        
                <li>
                    <a href="#variable-used-in-lambda-expression-should-be-final-or-effectively-final" aria-label="Variable used in lambda expression should be final or effectively final">Variable used in lambda expression should be final or effectively final</a></li>
                <li>
                    <a href="#lambda%e8%a1%a8%e8%be%be%e5%bc%8fforeach%e5%a6%82%e4%bd%95%e6%8f%90%e5%89%8d%e7%bb%88%e6%ad%a2" aria-label="lambda表达式foreach()如何提前终止">lambda表达式foreach()如何提前终止</a></li></ul>
                </li>
                <li>
                    <a href="#collectors" aria-label="Collectors">Collectors</a><ul>
                        
                <li>
                    <a href="#tolist" aria-label="toList">toList</a></li>
                <li>
                    <a href="#toset" aria-label="toSet">toSet</a></li>
                <li>
                    <a href="#joining" aria-label="joining">joining</a></li>
                <li>
                    <a href="#collectorsgroupingby" aria-label="Collectors.groupingBy">Collectors.groupingBy</a><ul>
                        
                <li>
                    <a href="#groupingby%e7%9a%84%e6%8e%92%e5%ba%8f" aria-label="groupingBy的排序">groupingBy的排序</a></li></ul>
                </li>
                <li>
                    <a href="#collectorstomap" aria-label="Collectors.toMap">Collectors.toMap</a><ul>
                        
                <li>
                    <a href="#%e5%85%b3%e4%ba%8e-collectorstomap-%e6%96%b9%e6%b3%95" aria-label="关于 Collectors.toMap 方法">关于 Collectors.toMap 方法</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#java8%e5%86%85%e7%bd%ae%e7%9a%84%e5%87%bd%e6%95%b0%e5%bc%8f%e6%8e%a5%e5%8f%a3" aria-label="java8内置的函数式接口">java8内置的函数式接口</a><ul>
                        
                <li>
                    <a href="#predicate%e6%96%ad%e8%a8%80" aria-label="Predicate：断言">Predicate：断言</a></li>
                <li>
                    <a href="#function" aria-label="Function">Function</a></li>
                <li>
                    <a href="#supplier%e7%94%9f%e4%ba%a7%e8%80%85" aria-label="Supplier：生产者">Supplier：生产者</a></li>
                <li>
                    <a href="#consumer%e6%b6%88%e8%b4%b9%e8%80%85" aria-label="Consumer：消费者">Consumer：消费者</a></li>
                <li>
                    <a href="#comparator" aria-label="Comparator">Comparator</a></li>
                <li>
                    <a href="#optional" aria-label="Optional">Optional</a></li></ul>
                </li>
                <li>
                    <a href="#stream" aria-label="stream">stream</a><ul>
                        
                <li>
                    <a href="#filter-%e8%bf%87%e6%bb%a4" aria-label="Filter 过滤">Filter 过滤</a></li>
                <li>
                    <a href="#sorted-%e6%8e%92%e5%ba%8f" aria-label="Sorted 排序">Sorted 排序</a></li>
                <li>
                    <a href="#map-%e8%bd%ac%e6%8d%a2" aria-label="Map 转换">Map 转换</a></li>
                <li>
                    <a href="#match-%e5%8c%b9%e9%85%8d" aria-label="Match 匹配">Match 匹配</a></li>
                <li>
                    <a href="#count-%e8%ae%a1%e6%95%b0" aria-label="Count 计数">Count 计数</a></li>
                <li>
                    <a href="#reduce" aria-label="Reduce">Reduce</a></li>
                <li>
                    <a href="#parallel-streams-%e5%b9%b6%e8%a1%8c%e6%b5%81" aria-label="Parallel-Streams 并行流">Parallel-Streams 并行流</a></li>
                <li>
                    <a href="#map-%e9%9b%86%e5%90%88" aria-label="Map 集合">Map 集合</a></li>
                <li>
                    <a href="#stream-%e7%9a%84%e5%a4%84%e7%90%86%e9%a1%ba%e5%ba%8f" aria-label="Stream 的处理顺序">Stream 的处理顺序</a></li>
                <li>
                    <a href="#%e4%b8%ad%e9%97%b4%e6%93%8d%e4%bd%9c%e7%9a%84%e9%a1%ba%e5%ba%8f" aria-label="中间操作的顺序">中间操作的顺序</a></li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e6%b5%81%e5%a4%8d%e7%94%a8%e9%97%ae%e9%a2%98" aria-label="数据流复用问题">数据流复用问题</a></li>
                <li>
                    <a href="#%e9%ab%98%e7%ba%a7%e6%93%8d%e4%bd%9c" aria-label="高级操作">高级操作</a><ul>
                        
                <li>
                    <a href="#collect" aria-label="Collect">Collect</a></li>
                <li>
                    <a href="#flatmap-1" aria-label="FlatMap">FlatMap</a></li>
                <li>
                    <a href="#reduce-1" aria-label="Reduce">Reduce</a></li>
                <li>
                    <a href="#%e5%b9%b6%e8%a1%8c%e6%b5%81" aria-label="并行流">并行流</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="函数式编程">函数式编程<a hidden class="anchor" aria-hidden="true" href="#函数式编程">#</a></h1>
<p>我们先看看什么是函数。函数是一种最基本的任务，一个大型程序就是一个顶层函数调用若干底层函数，这些被调用的函数又可以调用其他函数，即大任务被一层层拆解并执行。所以函数就是面向过程的程序设计的基本单元。</p>
<p>Java不支持单独定义函数，但可以把静态方法视为独立的函数，把实例方法视为自带<code>this</code>参数的函数。</p>
<p>而函数式编程（请注意多了一个“式”字）——Functional Programming，虽然也可以归结到面向过程的程序设计，但其思想更接近数学计算。</p>
<p>我们首先要搞明白计算机（Computer）和计算（Compute）的概念。</p>
<p>在计算机的层次上，CPU执行的是加减乘除的指令代码，以及各种条件判断和跳转指令，所以，汇编语言是最贴近计算机的语言。</p>
<p>而计算则指数学意义上的计算，越是抽象的计算，离计算机硬件越远。</p>
<p>对应到编程语言，就是越低级的语言，越贴近计算机，抽象程度低，执行效率高，比如C语言；越高级的语言，越贴近计算，抽象程度高，执行效率低，比如Lisp语言。</p>
<p>函数式编程就是一种抽象程度很高的编程范式，纯粹的函数式编程语言编写的函数没有变量，因此，任意一个函数，只要输入是确定的，输出就是确定的，这种纯函数我们称之为没有副作用。而允许使用变量的程序设计语言，由于函数内部的变量状态不确定，同样的输入，可能得到不同的输出，因此，这种函数是有副作用的。</p>
<p>函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！</p>
<p>函数式编程最早是数学家<a href="https://zh.wikipedia.org/wiki/%E9%98%BF%E9%9A%86%E4%BD%90%C2%B7%E9%82%B1%E5%A5%87">阿隆佐·邱奇</a>研究的一套函数变换逻辑，又称Lambda Calculus（λ-Calculus），所以也经常把函数式编程称为Lambda计算。</p>
<p>Java平台从Java 8开始，支持函数式编程。</p>
<h1 id="lambda基础">Lambda基础<a hidden class="anchor" aria-hidden="true" href="#lambda基础">#</a></h1>
<p>在了解Lambda之前，我们先回顾一下Java的方法。</p>
<p>Java的方法分为实例方法，例如<code>Integer</code>定义的<code>equals()</code>方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">class</span> Integer {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> equals(Object o) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>以及静态方法，例如<code>Integer</code>定义的<code>parseInt()</code>方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">class</span> Integer {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">int</span> parseInt(String s) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>无论是实例方法，还是静态方法，本质上都相当于过程式语言的函数。例如C函数：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">char</span>* strcpy(<span style="color:#fff;font-weight:bold">char</span>* dest, <span style="color:#fff;font-weight:bold">char</span>* src)
</span></span></code></pre></td></tr></table>
</div>
</div><p>只不过Java的实例方法隐含地传入了一个<code>this</code>变量，即实例方法总是有一个隐含参数<code>this</code>。</p>
<p>函数式编程（Functional Programming）是把函数作为基本运算单元，函数可以作为变量，可以接收函数，还可以返回函数。历史上研究函数式编程的理论是Lambda演算，所以我们经常把支持函数式编程的编码风格称为Lambda表达式。</p>
<h2 id="lambda表达式">Lambda表达式<a hidden class="anchor" aria-hidden="true" href="#lambda表达式">#</a></h2>
<p>在Java程序中，我们经常遇到一大堆单方法接口，即一个接口只定义了一个方法：</p>
<ul>
<li>Comparator</li>
<li>Runnable</li>
<li>Callable</li>
</ul>
<p>以<code>Comparator</code>为例，我们想要调用<code>Arrays.sort()</code>时，可以传入一个<code>Comparator</code>实例，以匿名类方式编写如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String[] array = [<span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;b&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>];
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(array, <span style="color:#fff;font-weight:bold">new</span> Comparator&lt;String&gt;() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compare(String s1, String s2) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s1.<span style="color:#007f7f">compareTo</span>(s2);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述写法非常繁琐。从Java 8开始，我们可以用Lambda表达式替换单方法接口。改写上述代码如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        String[] array = <span style="color:#fff;font-weight:bold">new</span> String[] {<span style="color:#0ff;font-weight:bold">&#34;Apple&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Orange&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Banana&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Lemon&#34;</span>};
</span></span><span style="display:flex;"><span>        Arrays.<span style="color:#007f7f">sort</span>(array, (s1, s2) -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> s1.<span style="color:#007f7f">compareTo</span>(s2);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(String.<span style="color:#007f7f">join</span>(<span style="color:#0ff;font-weight:bold">&#34;, &#34;</span>, array));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>观察Lambda表达式的写法，它只需要写出方法定义：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>(s1, s2) -&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> s1.<span style="color:#007f7f">compareTo</span>(s2);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中，参数是<code>(s1, s2)</code>，参数类型可以省略，因为编译器可以自动推断出<code>String</code>类型。<code>-&gt; { ... }</code>表示方法体，所有代码写在内部即可。Lambda表达式没有<code>class</code>定义，因此写法非常简洁。</p>
<p>如果只有一行<code>return xxx</code>的代码，完全可以用更简单的写法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(array, (s1, s2) -&gt; s1.<span style="color:#007f7f">compareTo</span>(s2));
</span></span></code></pre></td></tr></table>
</div>
</div><p>返回值的类型也是由编译器自动推断的，这里推断出的返回值是<code>int</code>，因此，只要返回<code>int</code>，编译器就不会报错。</p>
<h2 id="functionalinterface">FunctionalInterface<a hidden class="anchor" aria-hidden="true" href="#functionalinterface">#</a></h2>
<p>我们把只定义了单方法的接口称之为<code>FunctionalInterface</code>，用注解<code>@FunctionalInterface</code>标记。例如，<code>Callable</code>接口：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Callable&lt;V&gt; {
</span></span><span style="display:flex;"><span>    V call() <span style="color:#fff;font-weight:bold">throws</span> Exception;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>再来看<code>Comparator</code>接口：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Comparator&lt;T&gt; {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> compare(T o1, T o2);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> equals(Object obj);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> Comparator&lt;T&gt; reversed() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Collections.<span style="color:#007f7f">reverseOrder</span>(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> Comparator&lt;T&gt; thenComparing(Comparator&lt;? <span style="color:#fff;font-weight:bold">super</span> T&gt; other) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>虽然<code>Comparator</code>接口有很多方法，但只有一个抽象方法<code>int compare(T o1, T o2)</code>，其他的方法都是<code>default</code>方法或<code>static</code>方法。另外注意到<code>boolean equals(Object obj)</code>是<code>Object</code>定义的方法，不算在接口方法内。因此，<code>Comparator</code>也是一个<code>FunctionalInterface</code>。</p>
<h2 id="小结">小结<a hidden class="anchor" aria-hidden="true" href="#小结">#</a></h2>
<p>单方法接口被称为<code>FunctionalInterface</code>。</p>
<p>接收<code>FunctionalInterface</code>作为参数的时候，可以把实例化的匿名类改写为Lambda表达式，能大大简化代码。</p>
<p>Lambda表达式的参数和返回值均可由编译器自动推断。</p>
<h1 id="方法引用">方法引用<a hidden class="anchor" aria-hidden="true" href="#方法引用">#</a></h1>
<p>使用Lambda表达式，我们就可以不必编写<code>FunctionalInterface</code>接口的实现类，从而简化代码：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(array, (s1, s2) -&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> s1.<span style="color:#007f7f">compareTo</span>(s2);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></td></tr></table>
</div>
</div><p>实际上，除了Lambda表达式，我们还可以直接传入方法引用。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        String[] array = <span style="color:#fff;font-weight:bold">new</span> String[] { <span style="color:#0ff;font-weight:bold">&#34;Apple&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Orange&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Banana&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Lemon&#34;</span> };
</span></span><span style="display:flex;"><span>        Arrays.<span style="color:#007f7f">sort</span>(array, Main::cmp);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(String.<span style="color:#007f7f">join</span>(<span style="color:#0ff;font-weight:bold">&#34;, &#34;</span>, array));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">int</span> cmp(String s1, String s2) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s1.<span style="color:#007f7f">compareTo</span>(s2);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述代码在<code>Arrays.sort()</code>中直接传入了静态方法<code>cmp</code>的引用，用<code>Main::cmp</code>表示。</p>
<p>因此，所谓方法引用，是指如果某个方法签名和接口恰好一致，就可以直接传入方法引用。</p>
<p>因为<code>Comparator&lt;String&gt;</code>接口定义的方法是<code>int compare(String, String)</code>，和静态方法<code>int cmp(String, String)</code>相比，除了方法名外，方法参数一致，返回类型相同，因此，我们说两者的方法签名一致，可以直接把方法名作为Lambda表达式传入：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(array, Main::cmp);
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：在这里，方法签名只看参数类型和返回类型，不看方法名称，也不看类的继承关系。</p>
<p>我们再看看如何引用实例方法。如果我们把代码改写如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        String[] array = <span style="color:#fff;font-weight:bold">new</span> String[] { <span style="color:#0ff;font-weight:bold">&#34;Apple&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Orange&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Banana&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Lemon&#34;</span> };
</span></span><span style="display:flex;"><span>        Arrays.<span style="color:#007f7f">sort</span>(array, String::compareTo);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(String.<span style="color:#007f7f">join</span>(<span style="color:#0ff;font-weight:bold">&#34;, &#34;</span>, array));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>不但可以编译通过，而且运行结果也是一样的，这说明<code>String.compareTo()</code>方法也符合Lambda定义。</p>
<p>观察<code>String.compareTo()</code>的方法定义：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">class</span> String {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compareTo(String o) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个方法的签名只有一个参数，为什么和<code>int Comparator&lt;String&gt;.compare(String, String)</code>能匹配呢？</p>
<p>因为实例方法有一个隐含的<code>this</code>参数，<code>String</code>类的<code>compareTo()</code>方法在实际调用的时候，第一个隐含参数总是传入<code>this</code>，相当于静态方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">int</span> compareTo(<span style="color:#fff;font-weight:bold">this</span>, String o);
</span></span></code></pre></td></tr></table>
</div>
</div><p>所以，<code>String.compareTo()</code>方法也可作为方法引用传入。</p>
<h2 id="构造方法引用">构造方法引用<a hidden class="anchor" aria-hidden="true" href="#构造方法引用">#</a></h2>
<p>除了可以引用静态方法和实例方法，我们还可以引用构造方法。</p>
<p>我们来看一个例子：如果要把一个<code>List&lt;String&gt;</code>转换为<code>List&lt;Person&gt;</code>，应该怎么办？</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Person {
</span></span><span style="display:flex;"><span>    String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Person(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>List&lt;String&gt; names = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;Bob&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Alice&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Tim&#34;</span>);
</span></span><span style="display:flex;"><span>List&lt;Person&gt; persons = ???
</span></span></code></pre></td></tr></table>
</div>
</div><p>传统的做法是先定义一个<code>ArrayList&lt;Person&gt;</code>，然后用<code>for</code>循环填充这个<code>List</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;String&gt; names = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;Bob&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Alice&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Tim&#34;</span>);
</span></span><span style="display:flex;"><span>List&lt;Person&gt; persons = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span> (String name : names) {
</span></span><span style="display:flex;"><span>    persons.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> Person(name));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>要更简单地实现<code>String</code>到<code>Person</code>的转换，我们可以引用<code>Person</code>的构造方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        List&lt;String&gt; names = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;Bob&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Alice&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Tim&#34;</span>);
</span></span><span style="display:flex;"><span>        List&lt;Person&gt; persons = names.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">map</span>(Person::<span style="color:#fff;font-weight:bold">new</span>).<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(persons);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Person {
</span></span><span style="display:flex;"><span>    String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Person(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String toString() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;Person:&#34;</span> + <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>后面我们会讲到<code>Stream</code>的<code>map()</code>方法。现在我们看到，这里的<code>map()</code>需要传入的FunctionalInterface的定义是：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Function&lt;T, R&gt; {
</span></span><span style="display:flex;"><span>    R apply(T t);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>把泛型对应上就是方法签名<code>Person apply(String)</code>，即传入参数<code>String</code>，返回类型<code>Person</code>。而<code>Person</code>类的构造方法恰好满足这个条件，因为构造方法的参数是<code>String</code>，而构造方法虽然没有<code>return</code>语句，但它会隐式地返回<code>this</code>实例，类型就是<code>Person</code>，因此，此处可以引用构造方法。构造方法的引用写法是<code>类名::new</code>，因此，此处传入<code>Person::new</code>。</p>
<h2 id="小结-1">小结<a hidden class="anchor" aria-hidden="true" href="#小结-1">#</a></h2>
<p><code>FunctionalInterface</code>允许传入：</p>
<ul>
<li>接口的实现类（传统写法，代码较繁琐）；</li>
<li>Lambda表达式（只需列出参数名，由编译器推断类型）；</li>
<li>符合方法签名的静态方法；</li>
<li>符合方法签名的实例方法（实例类型被看做第一个参数类型）；</li>
<li>符合方法签名的构造方法（实例类型被看做返回类型）。</li>
</ul>
<p><code>FunctionalInterface</code>不强制继承关系，不需要方法名称相同，只要求方法参数（类型和数量）与方法返回类型相同，即认为方法签名相同。</p>
<h1 id="使用stream">使用Stream<a hidden class="anchor" aria-hidden="true" href="#使用stream">#</a></h1>
<p>Java从8开始，不但引入了Lambda表达式，还引入了一个全新的流式API：Stream API。它位于<code>java.util.stream</code>包中。</p>
<p><em>划重点</em>：这个<code>Stream</code>不同于<code>java.io</code>的<code>InputStream</code>和<code>OutputStream</code>，它代表的是任意Java对象的序列。两者对比如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">java.io</th>
<th style="text-align:left">java.util.stream</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">存储</td>
<td style="text-align:left">顺序读写的<code>byte</code>或<code>char</code></td>
<td style="text-align:left">顺序输出的任意Java对象实例</td>
</tr>
<tr>
<td style="text-align:left">用途</td>
<td style="text-align:left">序列化至文件或网络</td>
<td style="text-align:left">内存计算／业务逻辑</td>
</tr>
</tbody>
</table>
<p>有同学会问：一个顺序输出的Java对象序列，不就是一个<code>List</code>容器吗？</p>
<p><em>再次划重点</em>：这个<code>Stream</code>和<code>List</code>也不一样，<code>List</code>存储的每个元素都是已经存储在内存中的某个Java对象，而<code>Stream</code>输出的元素可能并没有预先存储在内存中，而是实时计算出来的。</p>
<p>换句话说，<code>List</code>的用途是操作一组已存在的Java对象，而<code>Stream</code>实现的是惰性计算，两者对比如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">java.util.List</th>
<th style="text-align:left">java.util.stream</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">元素</td>
<td style="text-align:left">已分配并存储在内存</td>
<td style="text-align:left">可能未分配，实时计算</td>
</tr>
<tr>
<td style="text-align:left">用途</td>
<td style="text-align:left">操作一组已存在的Java对象</td>
<td style="text-align:left">惰性计算</td>
</tr>
</tbody>
</table>
<p><code>Stream</code>看上去有点不好理解，但我们举个例子就明白了。</p>
<p>如果我们要表示一个全体自然数的集合，显然，用<code>List</code>是不可能写出来的，因为自然数是无限的，内存再大也没法放到<code>List</code>中：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;BigInteger&gt; list = ??? <span style="color:#007f7f">// 全体自然数?</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是，用<code>Stream</code>可以做到。写法如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;BigInteger&gt; naturals = createNaturalStream(); <span style="color:#007f7f">// 全体自然数</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们先不考虑<code>createNaturalStream()</code>这个方法是如何实现的，我们看看如何使用这个<code>Stream</code>。</p>
<p>首先，我们可以对每个自然数做一个平方，这样我们就把这个<code>Stream</code>转换成了另一个<code>Stream</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;BigInteger&gt; naturals = createNaturalStream(); <span style="color:#007f7f">// 全体自然数</span>
</span></span><span style="display:flex;"><span>Stream&lt;BigInteger&gt; streamNxN = naturals.<span style="color:#007f7f">map</span>(n -&gt; n.<span style="color:#007f7f">multiply</span>(n)); <span style="color:#007f7f">// 全体自然数的平方</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为这个<code>streamNxN</code>也有无限多个元素，要打印它，必须首先把无限多个元素变成有限个元素，可以用<code>limit()</code>方法截取前100个元素，最后用<code>forEach()</code>处理每个元素，这样，我们就打印出了前100个自然数的平方：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;BigInteger&gt; naturals = createNaturalStream();
</span></span><span style="display:flex;"><span>naturals.<span style="color:#007f7f">map</span>(n -&gt; n.<span style="color:#007f7f">multiply</span>(n)) <span style="color:#007f7f">// 1, 4, 9, 16, 25...</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">limit</span>(100)
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们总结一下<code>Stream</code>的特点：它可以“存储”有限个或无限个元素。这里的存储打了个引号，是因为元素有可能已经全部存储在内存中，也有可能是根据需要实时计算出来的。</p>
<p><code>Stream</code>的另一个特点是，一个<code>Stream</code>可以轻易地转换为另一个<code>Stream</code>，而不是修改原<code>Stream</code>本身。</p>
<p>最后，真正的计算通常发生在最后结果的获取，也就是惰性计算。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;BigInteger&gt; naturals = createNaturalStream(); <span style="color:#007f7f">// 不计算</span>
</span></span><span style="display:flex;"><span>Stream&lt;BigInteger&gt; s2 = naturals.<span style="color:#007f7f">map</span>(BigInteger::multiply); <span style="color:#007f7f">// 不计算</span>
</span></span><span style="display:flex;"><span>Stream&lt;BigInteger&gt; s3 = s2.<span style="color:#007f7f">limit</span>(100); <span style="color:#007f7f">// 不计算</span>
</span></span><span style="display:flex;"><span>s3.<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println); <span style="color:#007f7f">// 计算</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>惰性计算的特点是：一个<code>Stream</code>转换为另一个<code>Stream</code>时，实际上只存储了转换规则，并没有任何计算发生。</p>
<p>例如，创建一个全体自然数的<code>Stream</code>，不会进行计算，把它转换为上述<code>s2</code>这个<code>Stream</code>，也不会进行计算。再把<code>s2</code>这个无限<code>Stream</code>转换为<code>s3</code>这个有限的<code>Stream</code>，也不会进行计算。只有最后，调用<code>forEach</code>确实需要<code>Stream</code>输出的元素时，才进行计算。我们通常把<code>Stream</code>的操作写成链式操作，代码更简洁：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>createNaturalStream()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(BigInteger::multiply)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">limit</span>(100)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span></code></pre></td></tr></table>
</div>
</div><p>因此，Stream API的基本用法就是：创建一个<code>Stream</code>，然后做若干次转换，最后调用一个求值方法获取真正计算的结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> result = createNaturalStream() <span style="color:#007f7f">// 创建Stream</span>
</span></span><span style="display:flex;"><span>             .<span style="color:#007f7f">filter</span>(n -&gt; n % 2 == 0) <span style="color:#007f7f">// 任意个转换</span>
</span></span><span style="display:flex;"><span>             .<span style="color:#007f7f">map</span>(n -&gt; n * n) <span style="color:#007f7f">// 任意个转换</span>
</span></span><span style="display:flex;"><span>             .<span style="color:#007f7f">limit</span>(100) <span style="color:#007f7f">// 任意个转换</span>
</span></span><span style="display:flex;"><span>             .<span style="color:#007f7f">sum</span>(); <span style="color:#007f7f">// 最终计算结果</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="小结-2">小结<a hidden class="anchor" aria-hidden="true" href="#小结-2">#</a></h2>
<p>Stream API的特点是：</p>
<ul>
<li>Stream API提供了一套新的流式处理的抽象序列；</li>
<li>Stream API支持函数式编程和链式操作；</li>
<li>Stream可以表示无限序列，并且大多数情况下是惰性求值的。</li>
</ul>
<h1 id="创建stream">创建Stream<a hidden class="anchor" aria-hidden="true" href="#创建stream">#</a></h1>
<p>要使用<code>Stream</code>，就必须先创建它。创建<code>Stream</code>有很多种方法，我们来一一介绍。</p>
<h2 id="streamof">Stream.of()<a hidden class="anchor" aria-hidden="true" href="#streamof">#</a></h2>
<p>创建<code>Stream</code>最简单的方式是直接用<code>Stream.of()</code>静态方法，传入可变参数即创建了一个能输出确定元素的<code>Stream</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Stream&lt;String&gt; stream = Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;D&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// forEach()方法相当于内部循环调用，</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 可传入符合Consumer接口的void accept(T t)的方法引用：</span>
</span></span><span style="display:flex;"><span>        stream.<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>虽然这种方式基本上没啥实质性用途，但测试的时候很方便。</p>
<h2 id="基于数组或collection创建stream">基于数组或Collection创建Stream<a hidden class="anchor" aria-hidden="true" href="#基于数组或collection创建stream">#</a></h2>
<p>第二种创建<code>Stream</code>的方法是基于一个数组或者<code>Collection</code>，这样该<code>Stream</code>输出的元素就是数组或者<code>Collection</code>持有的元素：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Stream&lt;String&gt; stream1 = Arrays.<span style="color:#007f7f">stream</span>(<span style="color:#fff;font-weight:bold">new</span> String[] { <span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;C&#34;</span> });
</span></span><span style="display:flex;"><span>        Stream&lt;String&gt; stream2 = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;X&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Y&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Z&#34;</span>).<span style="color:#007f7f">stream</span>();
</span></span><span style="display:flex;"><span>        stream1.<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span>        stream2.<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>把数组变成<code>Stream</code>使用<code>Arrays.stream()</code>方法。对于<code>Collection</code>（<code>List</code>、<code>Set</code>、<code>Queue</code>等），直接调用<code>stream()</code>方法就可以获得<code>Stream</code>。</p>
<p>上述创建<code>Stream</code>的方法都是把一个现有的序列变为<code>Stream</code>，它的元素是固定的。</p>
<h2 id="基于supplier创建stream">基于Supplier创建Stream<a hidden class="anchor" aria-hidden="true" href="#基于supplier创建stream">#</a></h2>
<p>创建<code>Stream</code>还可以通过<code>Stream.generate()</code>方法，它需要传入一个<code>Supplier</code>对象：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Stream&lt;String&gt; s = Stream.generate(Supplier&lt;String&gt; sp);
</span></span></code></pre></td></tr></table>
</div>
</div><p>基于<code>Supplier</code>创建的<code>Stream</code>会不断调用<code>Supplier.get()</code>方法来不断产生下一个元素，这种<code>Stream</code>保存的不是元素，而是算法，它可以用来表示无限序列。</p>
<p>例如，我们编写一个能不断生成自然数的<code>Supplier</code>，它的代码非常简单，每次调用<code>get()</code>方法，就生成下一个自然数：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Stream&lt;Integer&gt; natual = Stream.<span style="color:#007f7f">generate</span>(<span style="color:#fff;font-weight:bold">new</span> NatualSupplier());
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 注意：无限序列必须先变成有限序列再打印:</span>
</span></span><span style="display:flex;"><span>        natual.<span style="color:#007f7f">limit</span>(20).<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> NatualSupplier <span style="color:#fff;font-weight:bold">implements</span> Supplier&lt;Integer&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> n = 0;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>        n++;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> n;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述代码我们用一个<code>Supplier&lt;Integer&gt;</code>模拟了一个无限序列（当然受<code>int</code>范围限制不是真的无限大）。如果用<code>List</code>表示，即便在<code>int</code>范围内，也会占用巨大的内存，而<code>Stream</code>几乎不占用空间，因为每个元素都是实时计算出来的，用的时候再算。</p>
<p>对于无限序列，如果直接调用<code>forEach()</code>或者<code>count()</code>这些最终求值操作，会进入死循环，因为永远无法计算完这个序列，所以正确的方法是先把无限序列变成有限序列，例如，用<code>limit()</code>方法可以截取前面若干个元素，这样就变成了一个有限序列，对这个有限序列调用<code>forEach()</code>或者<code>count()</code>操作就没有问题。</p>
<h2 id="其他方式创建stream">其他方式创建Stream<a hidden class="anchor" aria-hidden="true" href="#其他方式创建stream">#</a></h2>
<p>创建<code>Stream</code>的第三种方法是通过一些API提供的接口，直接获得<code>Stream</code>。</p>
<p>例如，<code>Files</code>类的<code>lines()</code>方法可以把一个文件变成一个<code>Stream</code>，每个元素代表文件的一行内容：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>try (Stream&lt;String&gt; lines = Files.lines(Paths.get(&#34;/path/to/file.txt&#34;))) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>此方法对于按行遍历文本文件十分有用。</p>
<p>另外，正则表达式的<code>Pattern</code>对象有一个<code>splitAsStream()</code>方法，可以直接把一个长字符串分割成<code>Stream</code>序列而不是数组：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Pattern p = Pattern.<span style="color:#007f7f">compile</span>(<span style="color:#0ff;font-weight:bold">&#34;\\s+&#34;</span>);
</span></span><span style="display:flex;"><span>Stream&lt;String&gt; s = p.<span style="color:#007f7f">splitAsStream</span>(<span style="color:#0ff;font-weight:bold">&#34;The quick brown fox jumps over the lazy dog&#34;</span>);
</span></span><span style="display:flex;"><span>s.<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="基本类型">基本类型<a hidden class="anchor" aria-hidden="true" href="#基本类型">#</a></h2>
<p>因为Java的范型不支持基本类型，所以我们无法用<code>Stream&lt;int&gt;</code>这样的类型，会发生编译错误。为了保存<code>int</code>，只能使用<code>Stream&lt;Integer&gt;</code>，但这样会产生频繁的装箱、拆箱操作。为了提高效率，Java标准库提供了<code>IntStream</code>、<code>LongStream</code>和<code>DoubleStream</code>这三种使用基本类型的<code>Stream</code>，它们的使用方法和范型<code>Stream</code>没有大的区别，设计这三个<code>Stream</code>的目的是提高运行效率：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 将int[]数组变为IntStream:</span>
</span></span><span style="display:flex;"><span>IntStream is = Arrays.<span style="color:#007f7f">stream</span>(<span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">int</span>[] { 1, 2, 3 });
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 将Stream&lt;String&gt;转换为LongStream:</span>
</span></span><span style="display:flex;"><span>LongStream ls = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;3&#34;</span>).<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">mapToLong</span>(Long::parseLong);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="小结-3">小结<a hidden class="anchor" aria-hidden="true" href="#小结-3">#</a></h2>
<p>创建<code>Stream</code>的方法有 ：</p>
<ul>
<li>通过指定元素、指定数组、指定<code>Collection</code>创建<code>Stream</code>；</li>
<li>通过<code>Supplier</code>创建<code>Stream</code>，可以是无限序列；</li>
<li>通过其他类的相关方法创建。</li>
</ul>
<p>基本类型的<code>Stream</code>有<code>IntStream</code>、<code>LongStream</code>和<code>DoubleStream</code>。</p>
<h1 id="使用-streammap">使用 Stream.map()<a hidden class="anchor" aria-hidden="true" href="#使用-streammap">#</a></h1>
<p><code>Stream.map()</code>是<code>Stream</code>最常用的一个转换方法，它把一个<code>Stream</code>转换为另一个<code>Stream</code>。</p>
<p>所谓<code>map</code>操作，就是把一种操作运算，映射到一个序列的每一个元素上。例如，对<code>x</code>计算它的平方，可以使用函数<code>f(x) = x * x</code>。我们把这个函数映射到一个序列1，2，3，4，5上，就得到了另一个序列1，4，9，16，25：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>            f(x) = x * x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                  │
</span></span><span style="display:flex;"><span>                  │
</span></span><span style="display:flex;"><span>  ┌───┬───┬───┬───┼───┬───┬───┬───┐
</span></span><span style="display:flex;"><span>  │   │   │   │   │   │   │   │   │
</span></span><span style="display:flex;"><span>  ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ 1   2   3   4   5   6   7   8   9 ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  │   │   │   │   │   │   │   │   │
</span></span><span style="display:flex;"><span>  │   │   │   │   │   │   │   │   │
</span></span><span style="display:flex;"><span>  ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ 1   4   9  16  25  36  49  64  81 ]
</span></span></code></pre></td></tr></table>
</div>
</div><p>可见，<code>map</code>操作，把一个<code>Stream</code>的每个元素一一对应到应用了目标函数的结果上。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;Integer&gt; s = Stream.<span style="color:#007f7f">of</span>(1, 2, 3, 4, 5);
</span></span><span style="display:flex;"><span>Stream&lt;Integer&gt; s2 = s.<span style="color:#007f7f">map</span>(n -&gt; n * n);
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果我们查看<code>Stream</code>的源码，会发现<code>map()</code>方法接收的对象是<code>Function</code>接口对象，它定义了一个<code>apply()</code>方法，负责把一个<code>T</code>类型转换成<code>R</code>类型：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>&lt;R&gt; Stream&lt;R&gt; map(Function&lt;<span style="color:#f00">?</span> super T, <span style="color:#f00">?</span> <span style="color:#fff;font-weight:bold">extends</span> R&gt; mapper);
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中，<code>Function</code>的定义是：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span>public interface Function&lt;T, R&gt; {
</span></span><span style="display:flex;"><span>    // 将T类型转换为R:
</span></span><span style="display:flex;"><span>    R apply(T t);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>利用<code>map()</code>，不但能完成数学计算，对于字符串操作，以及任何Java对象都是非常有用的。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;  Apple &#34;</span>, <span style="color:#0ff;font-weight:bold">&#34; pear &#34;</span>, <span style="color:#0ff;font-weight:bold">&#34; ORANGE&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34; BaNaNa &#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">map</span>(String::trim) <span style="color:#007f7f">// 去空格</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">map</span>(String::toLowerCase) <span style="color:#007f7f">// 变小写</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println); <span style="color:#007f7f">// 打印</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过若干步<code>map</code>转换，可以写出逻辑简单、清晰的代码。</p>
<h1 id="使用filter">使用filter<a hidden class="anchor" aria-hidden="true" href="#使用filter">#</a></h1>
<p><code>Stream.filter()</code>是<code>Stream</code>的另一个常用转换方法。</p>
<p>所谓<code>filter()</code>操作，就是对一个<code>Stream</code>的所有元素一一进行测试，不满足条件的就被“滤掉”了，剩下的满足条件的元素就构成了一个新的<code>Stream</code>。</p>
<p>例如，我们对1，2，3，4，5这个<code>Stream</code>调用<code>filter()</code>，传入的测试函数<code>f(x) = x % 2 != 0</code>用来判断元素是否是奇数，这样就过滤掉偶数，只剩下奇数，因此我们得到了另一个序列1，3，5：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>            f(x) = x % 2 != 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                  │
</span></span><span style="display:flex;"><span>                  │
</span></span><span style="display:flex;"><span>  ┌───┬───┬───┬───┼───┬───┬───┬───┐
</span></span><span style="display:flex;"><span>  │   │   │   │   │   │   │   │   │
</span></span><span style="display:flex;"><span>  ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ 1   2   3   4   5   6   7   8   9 ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  │   X   │   X   │   X   │   X   │
</span></span><span style="display:flex;"><span>  │       │       │       │       │
</span></span><span style="display:flex;"><span>  ▼       ▼       ▼       ▼       ▼
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ 1       3       5       7       9 ]
</span></span></code></pre></td></tr></table>
</div>
</div><p>用IntStream写出上述逻辑，代码如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        IntStream.<span style="color:#007f7f">of</span>(1, 2, 3, 4, 5, 6, 7, 8, 9)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">filter</span>(n -&gt; n % 2 != 0)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>从结果可知，经过<code>filter()</code>后生成的<code>Stream</code>元素可能变少。</p>
<p><code>filter()</code>方法接收的对象是<code>Predicate</code>接口对象，它定义了一个<code>test()</code>方法，负责判断元素是否符合条件：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Predicate&lt;T&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 判断元素t是否符合条件:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> test(T t);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>filter()</code>除了常用于数值外，也可应用于任何Java对象。例如，从一组给定的<code>LocalDate</code>中过滤掉工作日，以便得到休息日：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Stream.<span style="color:#007f7f">generate</span>(<span style="color:#fff;font-weight:bold">new</span> LocalDateSupplier())
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">limit</span>(31)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">filter</span>(ldt -&gt; ldt.<span style="color:#007f7f">getDayOfWeek</span>() == DayOfWeek.<span style="color:#007f7f">SATURDAY</span> 
</span></span><span style="display:flex;"><span>                    || ldt.<span style="color:#007f7f">getDayOfWeek</span>() == DayOfWeek.<span style="color:#007f7f">SUNDAY</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> LocalDateSupplier <span style="color:#fff;font-weight:bold">implements</span> Supplier&lt;LocalDate&gt; {
</span></span><span style="display:flex;"><span>    LocalDate start = LocalDate.<span style="color:#007f7f">of</span>(2020, 1, 1);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> n = -1;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> LocalDate get() {
</span></span><span style="display:flex;"><span>        n++;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> start.<span style="color:#007f7f">plusDays</span>(n);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="使用reduce">使用reduce<a hidden class="anchor" aria-hidden="true" href="#使用reduce">#</a></h1>
<p><code>map()</code>和<code>filter()</code>都是<code>Stream</code>的转换方法，而<code>Stream.reduce()</code>则是<code>Stream</code>的一个聚合方法，它可以把一个<code>Stream</code>的所有元素按照聚合函数聚合成一个结果。</p>
<p>我们来看一个简单的聚合方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> sum = Stream.<span style="color:#007f7f">of</span>(1, 2, 3, 4, 5, 6, 7, 8, 9).<span style="color:#007f7f">reduce</span>(0, (acc, n) -&gt; acc + n);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(sum); <span style="color:#007f7f">// 45</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>reduce()</code>方法传入的对象是<code>BinaryOperator</code>接口，它定义了一个<code>apply()</code>方法，负责把上次累加的结果和本次的元素 进行运算，并返回累加的结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> BinaryOperator&lt;T&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Bi操作：两个输入，一个输出</span>
</span></span><span style="display:flex;"><span>    T apply(T t, T u);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述代码看上去不好理解，但我们用<code>for</code>循环改写一下，就容易理解了：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;Integer&gt; stream = ...
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> sum = 0;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span> (n : stream) {
</span></span><span style="display:flex;"><span>    sum = (sum, n) -&gt; sum + n;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可见，<code>reduce()</code>操作首先初始化结果为指定值（这里是0），紧接着，<code>reduce()</code>对每个元素依次调用<code>(acc, n) -&gt; acc + n</code>，其中，<code>acc</code>是上次计算的结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 计算过程:</span>
</span></span><span style="display:flex;"><span>acc = 0 <span style="color:#007f7f">// 初始化为指定值</span>
</span></span><span style="display:flex;"><span>acc = acc + n = 0 + 1 = 1 <span style="color:#007f7f">// n = 1</span>
</span></span><span style="display:flex;"><span>acc = acc + n = 1 + 2 = 3 <span style="color:#007f7f">// n = 2</span>
</span></span><span style="display:flex;"><span>acc = acc + n = 3 + 3 = 6 <span style="color:#007f7f">// n = 3</span>
</span></span><span style="display:flex;"><span>acc = acc + n = 6 + 4 = 10 <span style="color:#007f7f">// n = 4</span>
</span></span><span style="display:flex;"><span>acc = acc + n = 10 + 5 = 15 <span style="color:#007f7f">// n = 5</span>
</span></span><span style="display:flex;"><span>acc = acc + n = 15 + 6 = 21 <span style="color:#007f7f">// n = 6</span>
</span></span><span style="display:flex;"><span>acc = acc + n = 21 + 7 = 28 <span style="color:#007f7f">// n = 7</span>
</span></span><span style="display:flex;"><span>acc = acc + n = 28 + 8 = 36 <span style="color:#007f7f">// n = 8</span>
</span></span><span style="display:flex;"><span>acc = acc + n = 36 + 9 = 45 <span style="color:#007f7f">// n = 9</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>因此，实际上这个<code>reduce()</code>操作是一个求和。</p>
<p>如果去掉初始值，我们会得到一个<code>Optional&lt;Integer&gt;</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Optional&lt;Integer&gt; opt = stream.<span style="color:#007f7f">reduce</span>((acc, n) -&gt; acc + n);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (opt.<span style="color:#007f7f">isPresent</span>()) {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(opt.<span style="color:#007f7f">get</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这是因为<code>Stream</code>的元素有可能是0个，这样就没法调用<code>reduce()</code>的聚合函数了，因此返回<code>Optional</code>对象，需要进一步判断结果是否存在。</p>
<p>利用reduce()，我们可以把求和改成求积，代码也十分简单：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> s = Stream.<span style="color:#007f7f">of</span>(1, 2, 3, 4, 5, 6, 7, 8, 9).<span style="color:#007f7f">reduce</span>(1, (acc, n) -&gt; acc * n);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(s); <span style="color:#007f7f">// 362880</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：计算求积时，初始值必须设置为<code>1</code>。</p>
<p>除了可以对数值进行累积计算外，灵活运用<code>reduce()</code>也可以对Java对象进行操作。下面的代码演示了如何将配置文件的每一行配置通过<code>map()</code>和<code>reduce()</code>操作聚合成一个<code>Map&lt;String, String&gt;</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 按行读取配置文件:</span>
</span></span><span style="display:flex;"><span>        List&lt;String&gt; props = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;profile=native&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;debug=true&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;logging=warn&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;interval=500&#34;</span>);
</span></span><span style="display:flex;"><span>        Map&lt;String, String&gt; map = props.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 把k=v转换为Map[k]=v:</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">map</span>(kv -&gt; {
</span></span><span style="display:flex;"><span>                String[] ss = kv.<span style="color:#007f7f">split</span>(<span style="color:#0ff;font-weight:bold">&#34;\\=&#34;</span>, 2);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> Map.<span style="color:#007f7f">of</span>(ss[0], ss[1]);
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 把所有Map聚合到一个Map:</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">reduce</span>(<span style="color:#fff;font-weight:bold">new</span> HashMap&lt;String, String&gt;(), (m, kv) -&gt; {
</span></span><span style="display:flex;"><span>                m.<span style="color:#007f7f">putAll</span>(kv);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> m;
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 打印结果:</span>
</span></span><span style="display:flex;"><span>        map.<span style="color:#007f7f">forEach</span>((k, v) -&gt; {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(k + <span style="color:#0ff;font-weight:bold">&#34; = &#34;</span> + v);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="小结-4">小结<a hidden class="anchor" aria-hidden="true" href="#小结-4">#</a></h2>
<p><code>reduce()</code>方法将一个<code>Stream</code>的每个元素依次作用于<code>BinaryOperator</code>，并将结果合并。</p>
<p><code>reduce()</code>是聚合方法，聚合方法会立刻对<code>Stream</code>进行计算。</p>
<h1 id="输出集合">输出集合<a hidden class="anchor" aria-hidden="true" href="#输出集合">#</a></h1>
<p>我们介绍了<code>Stream</code>的几个常见操作：<code>map()</code>、<code>filter()</code>、<code>reduce()</code>。这些操作对<code>Stream</code>来说可以分为两类，一类是转换操作，即把一个<code>Stream</code>转换为另一个<code>Stream</code>，例如<code>map()</code>和<code>filter()</code>，另一类是聚合操作，即对<code>Stream</code>的每个元素进行计算，得到一个确定的结果，例如<code>reduce()</code>。</p>
<p>区分这两种操作是非常重要的，因为对于<code>Stream</code>来说，对其进行转换操作<em>并不会触发任何计算</em>！我们可以做个实验：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Stream&lt;Long&gt; s1 = Stream.<span style="color:#007f7f">generate</span>(<span style="color:#fff;font-weight:bold">new</span> NatualSupplier());
</span></span><span style="display:flex;"><span>        Stream&lt;Long&gt; s2 = s1.<span style="color:#007f7f">map</span>(n -&gt; n * n);
</span></span><span style="display:flex;"><span>        Stream&lt;Long&gt; s3 = s2.<span style="color:#007f7f">map</span>(n -&gt; n - 1);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(s3); <span style="color:#007f7f">// java.util.stream.ReferencePipeline$3@49476842</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> NatualSupplier <span style="color:#fff;font-weight:bold">implements</span> Supplier&lt;Long&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> n = 0;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Long get() {
</span></span><span style="display:flex;"><span>        n++;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> n;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为<code>s1</code>是一个<code>Long</code>类型的序列，它的元素高达922亿亿个，但执行上述代码，既不会有任何内存增长，也不会有任何计算，因为转换操作只是保存了转换规则，无论我们对一个<code>Stream</code>转换多少次，都不会有任何实际计算发生。</p>
<p>而聚合操作则不一样，聚合操作会立刻促使<code>Stream</code>输出它的每一个元素，并依次纳入计算，以获得最终结果。所以，对一个<code>Stream</code>进行聚合操作，会触发一系列连锁反应：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;Long&gt; s1 = Stream.<span style="color:#007f7f">generate</span>(<span style="color:#fff;font-weight:bold">new</span> NatualSupplier());
</span></span><span style="display:flex;"><span>Stream&lt;Long&gt; s2 = s1.<span style="color:#007f7f">map</span>(n -&gt; n * n);
</span></span><span style="display:flex;"><span>Stream&lt;Long&gt; s3 = s2.<span style="color:#007f7f">map</span>(n -&gt; n - 1);
</span></span><span style="display:flex;"><span>Stream&lt;Long&gt; s4 = s3.<span style="color:#007f7f">limit</span>(10);
</span></span><span style="display:flex;"><span>s4.<span style="color:#007f7f">reduce</span>(0, (acc, n) -&gt; acc + n);
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们对<code>s4</code>进行<code>reduce()</code>聚合计算，会不断请求<code>s4</code>输出它的每一个元素。因为<code>s4</code>的上游是<code>s3</code>，它又会向<code>s3</code>请求元素，导致<code>s3</code>向<code>s2</code>请求元素，<code>s2</code>向<code>s1</code>请求元素，最终，<code>s1</code>从<code>Supplier</code>实例中请求到真正的元素，并经过一系列转换，最终被<code>reduce()</code>聚合出结果。</p>
<p>可见，聚合操作是真正需要从<code>Stream</code>请求数据的，对一个<code>Stream</code>做聚合计算后，结果就不是一个<code>Stream</code>，而是一个其他的Java对象。</p>
<h2 id="输出为list">输出为List<a hidden class="anchor" aria-hidden="true" href="#输出为list">#</a></h2>
<p><code>reduce()</code>只是一种聚合操作，如果我们希望把<code>Stream</code>的元素保存到集合，例如<code>List</code>，因为<code>List</code>的元素是确定的Java对象，因此，把<code>Stream</code>变为<code>List</code>不是一个转换操作，而是一个聚合操作，它会强制<code>Stream</code>输出每个元素。</p>
<p>下面的代码演示了如何将一组<code>String</code>先过滤掉空字符串，然后把非空字符串保存到<code>List</code>中：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Stream&lt;String&gt; stream = Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;Apple&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>, <span style="color:#fff;font-weight:bold">null</span>, <span style="color:#0ff;font-weight:bold">&#34;Pear&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;  &#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Orange&#34;</span>);
</span></span><span style="display:flex;"><span>        List&lt;String&gt; list = stream
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">filter</span>(s -&gt; s != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; !s.<span style="color:#007f7f">isBlank</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(list);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>把<code>Stream</code>的每个元素收集到<code>List</code>的方法是调用<code>collect()</code>并传入<code>Collectors.toList()</code>对象，它实际上是一个<code>Collector</code>实例，通过类似<code>reduce()</code>的操作，把每个元素添加到一个收集器中（实际上是<code>ArrayList</code>）。</p>
<p>类似的，<code>collect(Collectors.toSet())</code>可以把<code>Stream</code>的每个元素收集到<code>Set</code>中。</p>
<h2 id="输出为数组">输出为数组<a hidden class="anchor" aria-hidden="true" href="#输出为数组">#</a></h2>
<p>把Stream的元素输出为数组和输出为List类似，我们只需要调用<code>toArray()</code>方法，并传入数组的“构造方法”：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;String&gt; list = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;Apple&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Banana&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Orange&#34;</span>);
</span></span><span style="display:flex;"><span>String[] array = list.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">toArray</span>(String[]::<span style="color:#fff;font-weight:bold">new</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意到传入的“构造方法”是<code>String[]::new</code>，它的签名实际上是<code>IntFunction&lt;String[]&gt;</code>定义的<code>String[] apply(int)</code>，即传入<code>int</code>参数，获得<code>String[]</code>数组的返回值。</p>
<h2 id="输出为map">输出为Map<a hidden class="anchor" aria-hidden="true" href="#输出为map">#</a></h2>
<p>如果我们要把Stream的元素收集到Map中，就稍微麻烦一点。因为对于每个元素，添加到Map时需要key和value，因此，我们要指定两个映射函数，分别把元素映射为key和value：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Stream&lt;String&gt; stream = Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;APPL:Apple&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;MSFT:Microsoft&#34;</span>);
</span></span><span style="display:flex;"><span>        Map&lt;String, String&gt; map = stream
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toMap</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 把元素s映射为key:</span>
</span></span><span style="display:flex;"><span>                s -&gt; s.<span style="color:#007f7f">substring</span>(0, s.<span style="color:#007f7f">indexOf</span>(<span style="color:#0ff;font-weight:bold">&#39;:&#39;</span>)),
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 把元素s映射为value:</span>
</span></span><span style="display:flex;"><span>                s -&gt; s.<span style="color:#007f7f">substring</span>(s.<span style="color:#007f7f">indexOf</span>(<span style="color:#0ff;font-weight:bold">&#39;:&#39;</span>) + 1)));
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(map);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="分组输出">分组输出<a hidden class="anchor" aria-hidden="true" href="#分组输出">#</a></h2>
<p><code>Stream</code>还有一个强大的分组功能，可以按组输出。我们看下面的例子：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        List&lt;String&gt; list = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;Apple&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Banana&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Blackberry&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Coconut&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Avocado&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Cherry&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Apricots&#34;</span>);
</span></span><span style="display:flex;"><span>        Map&lt;String, List&lt;String&gt;&gt; groups = list.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">groupingBy</span>(s -&gt; s.<span style="color:#007f7f">substring</span>(0, 1), Collectors.<span style="color:#007f7f">toList</span>()));
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(groups);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>分组输出使用<code>Collectors.groupingBy()</code>，它需要提供两个函数：一个是分组的key，这里使用<code>s -&gt; s.substring(0, 1)</code>，表示只要首字母相同的<code>String</code>分到一组，第二个是分组的value，这里直接使用<code>Collectors.toList()</code>，表示输出为<code>List</code>，上述代码运行结果如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    A=[Apple, Avocado, Apricots],
</span></span><span style="display:flex;"><span>    B=[Banana, Blackberry],
</span></span><span style="display:flex;"><span>    C=[Coconut, Cherry]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可见，结果一共有3组，按<code>&quot;A&quot;</code>，<code>&quot;B&quot;</code>，<code>&quot;C&quot;</code>分组，每一组都是一个<code>List</code>。</p>
<p>假设有这样一个<code>Student</code>类，包含学生姓名、班级和成绩：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Student {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> gradeId; <span style="color:#007f7f">// 年级</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> classId; <span style="color:#007f7f">// 班级</span>
</span></span><span style="display:flex;"><span>    String name; <span style="color:#007f7f">// 名字</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> score; <span style="color:#007f7f">// 分数</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果我们有一个<code>Stream&lt;Student&gt;</code>，利用分组输出，可以非常简单地按年级或班级把<code>Student</code>归类。</p>
<h1 id="其他操作">其他操作<a hidden class="anchor" aria-hidden="true" href="#其他操作">#</a></h1>
<p>我们把<code>Stream</code>提供的操作分为两类：转换操作和聚合操作。除了前面介绍的常用操作外，<code>Stream</code>还提供了一系列非常有用的方法。</p>
<h2 id="排序">排序<a hidden class="anchor" aria-hidden="true" href="#排序">#</a></h2>
<p>对<code>Stream</code>的元素进行排序十分简单，只需调用<code>sorted()</code>方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        List&lt;String&gt; list = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;Orange&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;apple&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Banana&#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">sorted</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(list);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>此方法要求<code>Stream</code>的每个元素必须实现<code>Comparable</code>接口。如果要自定义排序，传入指定的<code>Comparator</code>即可：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;String&gt; list = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;Orange&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;apple&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Banana&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">sorted</span>(String::compareToIgnoreCase)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意<code>sorted()</code>只是一个转换操作，它会返回一个新的<code>Stream</code>。</p>
<h2 id="去重">去重<a hidden class="anchor" aria-hidden="true" href="#去重">#</a></h2>
<p>对一个<code>Stream</code>的元素进行去重，没必要先转换为<code>Set</code>，可以直接用<code>distinct()</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;D&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">distinct</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>()); <span style="color:#007f7f">// [A, B, C, D]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="截取">截取<a hidden class="anchor" aria-hidden="true" href="#截取">#</a></h2>
<p>截取操作常用于把一个无限的<code>Stream</code>转换成有限的<code>Stream</code>，<code>skip()</code>用于跳过当前<code>Stream</code>的前N个元素，<code>limit()</code>用于截取当前<code>Stream</code>最多前N个元素：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;D&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;E&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;F&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">skip</span>(2) <span style="color:#007f7f">// 跳过A, B</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">limit</span>(3) <span style="color:#007f7f">// 截取C, D, E</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>()); <span style="color:#007f7f">// [C, D, E]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>截取操作也是一个转换操作，将返回新的<code>Stream</code>。</p>
<h2 id="合并">合并<a hidden class="anchor" aria-hidden="true" href="#合并">#</a></h2>
<p>将两个<code>Stream</code>合并为一个<code>Stream</code>可以使用<code>Stream</code>的静态方法<code>concat()</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;String&gt; s1 = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>).<span style="color:#007f7f">stream</span>();
</span></span><span style="display:flex;"><span>Stream&lt;String&gt; s2 = List.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;D&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;E&#34;</span>).<span style="color:#007f7f">stream</span>();
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 合并:</span>
</span></span><span style="display:flex;"><span>Stream&lt;String&gt; s = Stream.<span style="color:#007f7f">concat</span>(s1, s2);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(s.<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>())); <span style="color:#007f7f">// [A, B, C, D, E]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="flatmap">flatMap<a hidden class="anchor" aria-hidden="true" href="#flatmap">#</a></h2>
<p>如果<code>Stream</code>的元素是集合：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;List&lt;Integer&gt;&gt; s = Stream.<span style="color:#007f7f">of</span>(
</span></span><span style="display:flex;"><span>    Arrays.<span style="color:#007f7f">asList</span>(1, 2, 3),
</span></span><span style="display:flex;"><span>    Arrays.<span style="color:#007f7f">asList</span>(4, 5, 6),
</span></span><span style="display:flex;"><span>    Arrays.<span style="color:#007f7f">asList</span>(7, 8, 9));
</span></span></code></pre></td></tr></table>
</div>
</div><p>而我们希望把上述<code>Stream</code>转换为<code>Stream&lt;Integer&gt;</code>，就可以使用<code>flatMap()</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;Integer&gt; i = s.<span style="color:#007f7f">flatMap</span>(list -&gt; list.<span style="color:#007f7f">stream</span>());
</span></span></code></pre></td></tr></table>
</div>
</div><p>因此，所谓<code>flatMap()</code>，是指把<code>Stream</code>的每个元素（这里是<code>List</code>）映射为<code>Stream</code>，然后合并成一个新的<code>Stream</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>┌─────────────┬─────────────┬─────────────┐
</span></span><span style="display:flex;"><span>│┌───┬───┬───┐│┌───┬───┬───┐│┌───┬───┬───┐│
</span></span><span style="display:flex;"><span>││ 1 │ 2 │ 3 │││ 4 │ 5 │ 6 │││ 7 │ 8 │ 9 ││
</span></span><span style="display:flex;"><span>│└───┴───┴───┘│└───┴───┴───┘│└───┴───┴───┘│
</span></span><span style="display:flex;"><span>└─────────────┴─────────────┴─────────────┘
</span></span><span style="display:flex;"><span>                     │
</span></span><span style="display:flex;"><span>                     │flatMap(List -&gt; Stream)
</span></span><span style="display:flex;"><span>                     │
</span></span><span style="display:flex;"><span>                     │
</span></span><span style="display:flex;"><span>                     ▼
</span></span><span style="display:flex;"><span>   ┌───┬───┬───┬───┬───┬───┬───┬───┬───┐
</span></span><span style="display:flex;"><span>   │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7 │ 8 │ 9 │
</span></span><span style="display:flex;"><span>   └───┴───┴───┴───┴───┴───┴───┴───┴───┘
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="并行">并行<a hidden class="anchor" aria-hidden="true" href="#并行">#</a></h2>
<p>通常情况下，对<code>Stream</code>的元素进行处理是单线程的，即一个一个元素进行处理。但是很多时候，我们希望可以并行处理<code>Stream</code>的元素，因为在元素数量非常大的情况，并行处理可以大大加快处理速度。</p>
<p>把一个普通<code>Stream</code>转换为可以并行处理的<code>Stream</code>非常简单，只需要用<code>parallel()</code>进行转换：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;String&gt; s = ...
</span></span><span style="display:flex;"><span>String[] result = s.<span style="color:#007f7f">parallel</span>() <span style="color:#007f7f">// 变成一个可以并行处理的Stream</span>
</span></span><span style="display:flex;"><span>                   .<span style="color:#007f7f">sorted</span>() <span style="color:#007f7f">// 可以进行并行排序</span>
</span></span><span style="display:flex;"><span>                   .<span style="color:#007f7f">toArray</span>(String[]::<span style="color:#fff;font-weight:bold">new</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>经过<code>parallel()</code>转换后的<code>Stream</code>只要可能，就会对后续操作进行并行处理。我们不需要编写任何多线程代码就可以享受到并行处理带来的执行效率的提升。</p>
<h2 id="其他聚合方法">其他聚合方法<a hidden class="anchor" aria-hidden="true" href="#其他聚合方法">#</a></h2>
<p>除了<code>reduce()</code>和<code>collect()</code>外，<code>Stream</code>还有一些常用的聚合方法：</p>
<ul>
<li><code>count()</code>：用于返回元素个数；</li>
<li><code>max(Comparator&lt;? super T&gt; cp)</code>：找出最大元素；</li>
<li><code>min(Comparator&lt;? super T&gt; cp)</code>：找出最小元素。</li>
</ul>
<p>针对<code>IntStream</code>、<code>LongStream</code>和<code>DoubleStream</code>，还额外提供了以下聚合方法：</p>
<ul>
<li><code>sum()</code>：对所有元素求和；</li>
<li><code>average()</code>：对所有元素求平均数。</li>
</ul>
<p>还有一些方法，用来测试<code>Stream</code>的元素是否满足以下条件：</p>
<ul>
<li><code>boolean allMatch(Predicate&lt;? super T&gt;)</code>：测试是否所有元素均满足测试条件；</li>
<li><code>boolean anyMatch(Predicate&lt;? super T&gt;)</code>：测试是否至少有一个元素满足测试条件。</li>
</ul>
<p>最后一个常用的方法是<code>forEach()</code>，它可以循环处理<code>Stream</code>的每个元素，我们经常传入<code>System.out::println</code>来打印<code>Stream</code>的元素：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;String&gt; s = ...
</span></span><span style="display:flex;"><span>s.<span style="color:#007f7f">forEach</span>(str -&gt; {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello, &#34;</span> + str);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="小结-5">小结<a hidden class="anchor" aria-hidden="true" href="#小结-5">#</a></h2>
<p><code>Stream</code>提供的常用操作有：</p>
<p>转换操作：<code>map()</code>，<code>filter()</code>，<code>sorted()</code>，<code>distinct()</code>；</p>
<p>合并操作：<code>concat()</code>，<code>flatMap()</code>；</p>
<p>并行处理：<code>parallel()</code>；</p>
<p>聚合操作：<code>reduce()</code>，<code>collect()</code>，<code>count()</code>，<code>max()</code>，<code>min()</code>，<code>sum()</code>，<code>average()</code>；</p>
<p>其他操作：<code>allMatch()</code>, <code>anyMatch()</code>, <code>forEach()</code>。</p>
<h1 id="----------分割线-----------">&mdash;&mdash;&mdash;-分割线&mdash;&mdash;&mdash;&ndash;<a hidden class="anchor" aria-hidden="true" href="#----------分割线-----------">#</a></h1>
<h1 id="lambda表达式-1">Lambda表达式<a hidden class="anchor" aria-hidden="true" href="#lambda表达式-1">#</a></h1>
<h2 id="lambda表达式的语法">Lambda表达式的语法<a hidden class="anchor" aria-hidden="true" href="#lambda表达式的语法">#</a></h2>
<p>基本语法:<br>
(parameters) -&gt; expression<br>
或<br>
(parameters) -&gt;{ statements; }</p>
<p>Lambda表达式本质上是一个匿名方法。让我们来看下面这个例子：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> add(<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> x + y;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>转成Lambda表达式后是这个样子：<br>
<code>(int x, int y) -&gt; x + y;</code><br>
参数类型也可以省略，Java编译器会根据上下文推断出来：<br>
<code>(x, y) -&gt; x + y; //返回两数之和</code><br>
或者<br>
<code>(x, y) -&gt; { return x + y; } //显式指明返回值</code><br>
可见Lambda表达式由三部分组成：参数列表，箭头（-&gt;），以及一个表达式或语句块。</p>
<h2 id="lambda表达式和函数式接口结合">Lambda表达式和函数式接口结合<a hidden class="anchor" aria-hidden="true" href="#lambda表达式和函数式接口结合">#</a></h2>
<p>新建无参函数式接口</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> InterfaceWithNoParam {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> run();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>新建包含属性为函数式接口的类</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TestJava8{
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>实现函数式接口</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TestJava8{
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//匿名内部类</span>
</span></span><span style="display:flex;"><span>	InterfaceWithNoParam param1 = <span style="color:#fff;font-weight:bold">new</span> InterfaceWithNoParam() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;通过匿名内部类实现run()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//Lambda表达式(空括号表示无参)</span>
</span></span><span style="display:flex;"><span>	InterfaceWithNoParam param = () -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;通过Lambda表达式实现run()&#34;</span>) ;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试函数式接口的方法</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TestJava8 {
</span></span><span style="display:flex;"><span>    InterfaceWithNoParam param = <span style="color:#fff;font-weight:bold">new</span> InterfaceWithNoParam() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;通过匿名内部类实现run()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    InterfaceWithNoParam param1 = ()-&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;通过Lambda表达式实现run()&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        TestJava8 testJava8 = <span style="color:#fff;font-weight:bold">new</span> TestJava8();
</span></span><span style="display:flex;"><span>        testJava8.<span style="color:#007f7f">param</span>.<span style="color:#007f7f">run</span>();
</span></span><span style="display:flex;"><span>        testJava8.<span style="color:#007f7f">param1</span>.<span style="color:#007f7f">run</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行结果：<br>
通过匿名内部类实现run()<br>
通过Lambda表达式实现run()</p>
<h2 id="其他形式的函数式接口及实现">其他形式的函数式接口及实现<a hidden class="anchor" aria-hidden="true" href="#其他形式的函数式接口及实现">#</a></h2>
<p>上述内容实现了无参无返回值的函数接口与实现，当然还有其他形式：</p>
<h3 id="有参无返回值">有参无返回值<a hidden class="anchor" aria-hidden="true" href="#有参无返回值">#</a></h3>
<p>接口</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> InterfaceWithParams {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> run(String s);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>实现：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TestJava8 {
</span></span><span style="display:flex;"><span>    InterfaceWithNoParam param = <span style="color:#fff;font-weight:bold">new</span> InterfaceWithNoParam() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run(String s) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;通过&#34;</span> + s + <span style="color:#0ff;font-weight:bold">&#34;实现run(String)&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    InterfaceWithNoParam param1 = (s)-&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;通过&#34;</span> + s + <span style="color:#0ff;font-weight:bold">&#34;实现run(String)&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        TestJava8 testJava8 = <span style="color:#fff;font-weight:bold">new</span> TestJava8();
</span></span><span style="display:flex;"><span>        testJava8.<span style="color:#007f7f">param</span>.<span style="color:#007f7f">run</span>(<span style="color:#0ff;font-weight:bold">&#34;匿名内部类&#34;</span>);
</span></span><span style="display:flex;"><span>        testJava8.<span style="color:#007f7f">param1</span>.<span style="color:#007f7f">run</span>(<span style="color:#0ff;font-weight:bold">&#34;Lambda&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行结果：<br>
通过匿名内部类实现run(String)<br>
通过Lambda实现run(String)</p>
<h3 id="无参有返回值">无参有返回值<a hidden class="anchor" aria-hidden="true" href="#无参有返回值">#</a></h3>
<p>接口</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> InterfaceUnVoidWithNoParam {
</span></span><span style="display:flex;"><span>    String run();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>实现:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TestJava8 {
</span></span><span style="display:flex;"><span>    InterfaceWithNoParam param = <span style="color:#fff;font-weight:bold">new</span> InterfaceWithNoParam() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> String run() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;Hello World!&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    InterfaceWithNoParam param1 = ()-&gt; <span style="color:#0ff;font-weight:bold">&#34;Hello Lambda!&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        TestJava8 testJava8 = <span style="color:#fff;font-weight:bold">new</span> TestJava8();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(testJava8.<span style="color:#007f7f">param</span>.<span style="color:#007f7f">run</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(testJava8.<span style="color:#007f7f">param1</span>.<span style="color:#007f7f">run</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行结果：<br>
Hello World!<br>
Hello Lambda!</p>
<h3 id="有参有返回值">有参有返回值<a hidden class="anchor" aria-hidden="true" href="#有参有返回值">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span>public interface InterfaceWithNoParam {
</span></span><span style="display:flex;"><span>    String run(Integer i);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>实现：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TestJava8 {
</span></span><span style="display:flex;"><span>    InterfaceWithNoParam param = <span style="color:#fff;font-weight:bold">new</span> InterfaceWithNoParam() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> String run(Integer i) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> String.<span style="color:#007f7f">valueOf</span>(i);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    InterfaceWithNoParam param1 = (Integer i)-&gt; String.<span style="color:#007f7f">valueOf</span>(i);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        TestJava8 testJava8 = <span style="color:#fff;font-weight:bold">new</span> TestJava8();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(testJava8.<span style="color:#007f7f">param</span>.<span style="color:#007f7f">run</span>(1));
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(testJava8.<span style="color:#007f7f">param1</span>.<span style="color:#007f7f">run</span>(2));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行结果:<br>
1<br>
2</p>
<h2 id="几种简单形式">几种简单形式<a hidden class="anchor" aria-hidden="true" href="#几种简单形式">#</a></h2>
<ul>
<li>不需要参数，返回值为 5<br>
<code>() -&gt; 5</code></li>
<li>接收一个参数(数字类型)，返回其2倍的值<br>
<code>x -&gt; 2 * x</code></li>
<li>接受2个参数(数字)，并返回他们的差值<br>
<code>(x, y) -&gt; x – y</code></li>
<li>接收2个int型整数，返回他们的和<br>
<code>(int x, int y) -&gt; x + y</code></li>
<li>接受一个 string 对象，并在控制台打印，不返回任何值(看起来像是返回void)<br>
<code>(String s) -&gt; System.out.print(s)</code></li>
</ul>
<h2 id="基本的lambda例子">基本的Lambda例子<a hidden class="anchor" aria-hidden="true" href="#基本的lambda例子">#</a></h2>
<p>假设有一个玩家List，程序员可以使用 for循环来遍历，在Java 8中可以转换为另一种形式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String[] atp = {<span style="color:#0ff;font-weight:bold">&#34;d&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;b&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>};
</span></span><span style="display:flex;"><span>List&lt;String&gt; players =  Arrays.<span style="color:#007f7f">asList</span>(atp);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//以前的循环方式</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span> (String player : players) {
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>(player + <span style="color:#0ff;font-weight:bold">&#34;; &#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//使用lambda表达式以及函数操作(functional operation)</span>
</span></span><span style="display:flex;"><span>players.<span style="color:#007f7f">forEach</span>((player) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(player + <span style="color:#0ff;font-weight:bold">&#34;;&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//在JAVA 8 中使用双冒号操作符(double colon operator)</span>
</span></span><span style="display:flex;"><span>players.<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//下面是使用lambdas 来实现 Runnable接口 的示例:</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 1.1使用匿名内部类</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">new</span> Thread(<span style="color:#fff;font-weight:bold">new</span> Runnable() {
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello world !&#34;</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 1.2使用 lambda expression</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">new</span> Thread(() -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello world !&#34;</span>)).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 2.1使用匿名内部类</span>
</span></span><span style="display:flex;"><span>Runnable race1 = <span style="color:#fff;font-weight:bold">new</span> Runnable() {
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello world !&#34;</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 2.2使用 lambda expression</span>
</span></span><span style="display:flex;"><span>Runnable race2 = () -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello world !&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 直接调用 run 方法(没开新线程哦!)</span>
</span></span><span style="display:flex;"><span>race1.<span style="color:#007f7f">run</span>();
</span></span><span style="display:flex;"><span>race2.<span style="color:#007f7f">run</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="使用lambda对集合进行排序">使用Lambda对集合进行排序<a hidden class="anchor" aria-hidden="true" href="#使用lambda对集合进行排序">#</a></h2>
<p>在java中，Comparator 类被用来排序集合，在下面的例子中，我们将根据球员的 name，surname，name 长度以及最后一个字母。和前面的示例一样，先使用匿名内部类来排序，然后再使用lambda表达式精简我们的代码。在第一个例子中，我们将根据name来排序list。使用旧的方式，代码如下所示：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String[] players = {<span style="color:#0ff;font-weight:bold">&#34;Rafael Nadal&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Novak Djokovic&#34;</span>,   
</span></span><span style="display:flex;"><span>    <span style="color:#0ff;font-weight:bold">&#34;Stanislas Wawrinka&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;David Ferrer&#34;</span>,  
</span></span><span style="display:flex;"><span>    <span style="color:#0ff;font-weight:bold">&#34;Roger Federer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Andy Murray&#34;</span>,  
</span></span><span style="display:flex;"><span>    <span style="color:#0ff;font-weight:bold">&#34;Tomas Berdych&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Juan Martin Del Potro&#34;</span>,  
</span></span><span style="display:flex;"><span>    <span style="color:#0ff;font-weight:bold">&#34;Richard Gasquet&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;John Isner&#34;</span>};  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 1.1 使用匿名内部类根据 name 排序 players  </span>
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, <span style="color:#fff;font-weight:bold">new</span> Comparator&lt;String&gt;() {  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compare(String s1, String s2) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> (s1.<span style="color:#007f7f">compareTo</span>(s2));  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用lambda，可以通过下面的代码实现同样的功能：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 1.2 使用 lambda 表达式 排序 players </span>
</span></span><span style="display:flex;"><span>Comparator&lt;String&gt; sortByName = (String s1, String s2) -&gt; (s1.<span style="color:#007f7f">compareTo</span>(s2)); 
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, sortByName); 
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 1.3 也可以采用如下形式: </span>
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, (String s1, String s2) -&gt; (s1.<span style="color:#007f7f">compareTo</span>(s2)));
</span></span></code></pre></td></tr></table>
</div>
</div><p>其他的排序如下所示。和上面的示例一样，代码分别通过匿名内部类和一些lambda表达式来实现Comparator：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 1.1 使用匿名内部类根据 surname（姓） 排序 players </span>
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, <span style="color:#fff;font-weight:bold">new</span> Comparator&lt;String&gt;() { 
</span></span><span style="display:flex;"><span>    @Override 
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compare(String s1, String s2) { 
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> (s1.<span style="color:#007f7f">substring</span>(s1.<span style="color:#007f7f">indexOf</span>(<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>)).<span style="color:#007f7f">compareTo</span>(s2.<span style="color:#007f7f">substring</span>(s2.<span style="color:#007f7f">indexOf</span>(<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>))));  
</span></span><span style="display:flex;"><span>    } 
</span></span><span style="display:flex;"><span>}); 
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 1.2 使用 lambda expression 排序,根据 surname </span>
</span></span><span style="display:flex;"><span>Comparator&lt;String&gt; sortBySurname = (String s1, String s2) -&gt;
</span></span><span style="display:flex;"><span>    ( s1.<span style="color:#007f7f">substring</span>(s1.<span style="color:#007f7f">indexOf</span>(<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>)).<span style="color:#007f7f">compareTo</span>( s2.<span style="color:#007f7f">substring</span>(s2.<span style="color:#007f7f">indexOf</span>(<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>)) ) ); 
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, sortBySurname); 
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 1.3 或者这样</span>
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, (String s1, String s2) -&gt; 
</span></span><span style="display:flex;"><span>      ( s1.<span style="color:#007f7f">substring</span>(s1.<span style="color:#007f7f">indexOf</span>(<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>)).<span style="color:#007f7f">compareTo</span>( s2.<span style="color:#007f7f">substring</span>(s2.<span style="color:#007f7f">indexOf</span>(<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>)) ) ) 
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 1.4 或者使用comparing优化</span>
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, Comparator.<span style="color:#007f7f">comparing</span>((String s) -&gt; s.<span style="color:#007f7f">substring</span>(s.<span style="color:#007f7f">indexOf</span>(<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>)))
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 2.1 使用匿名内部类根据 name lenght 排序 players</span>
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, <span style="color:#fff;font-weight:bold">new</span> Comparator&lt;String&gt;() {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compare(String s1, String s2) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> (s1.<span style="color:#007f7f">length</span>() - s2.<span style="color:#007f7f">length</span>());  
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 2.2 使用 lambda expression 排序,根据 name lenght</span>
</span></span><span style="display:flex;"><span>Comparator&lt;String&gt; sortByNameLenght = (String s1, String s2) -&gt; (s1.<span style="color:#007f7f">length</span>() - s2.<span style="color:#007f7f">length</span>());
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, sortByNameLenght);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 2.3 或者这样</span>
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, (String s1, String s2) -&gt; (s1.<span style="color:#007f7f">length</span>() - s2.<span style="color:#007f7f">length</span>()));
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 3.1 使用匿名内部类排序 players, 根据最后一个字母</span>
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, <span style="color:#fff;font-weight:bold">new</span> Comparator&lt;String&gt;() {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compare(String s1, String s2) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> (s1.<span style="color:#007f7f">charAt</span>(s1.<span style="color:#007f7f">length</span>() - 1) - s2.<span style="color:#007f7f">charAt</span>(s2.<span style="color:#007f7f">length</span>() - 1));  
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 3.2 使用 lambda expression 排序,根据最后一个字母</span>
</span></span><span style="display:flex;"><span>Comparator&lt;String&gt; sortByLastLetter = 
</span></span><span style="display:flex;"><span>    (String s1, String s2) -&gt;
</span></span><span style="display:flex;"><span>        (s1.<span style="color:#007f7f">charAt</span>(s1.<span style="color:#007f7f">length</span>() - 1) - s2.<span style="color:#007f7f">charAt</span>(s2.<span style="color:#007f7f">length</span>() - 1));  
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, sortByLastLetter);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 3.3 或者这样</span>
</span></span><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">sort</span>(players, (String s1, String s2) -&gt; (s1.<span style="color:#007f7f">charAt</span>(s1.<span style="color:#007f7f">length</span>() - 1) - s2.<span style="color:#007f7f">charAt</span>(s2.<span style="color:#007f7f">length</span>() - 1)));
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="使用lambdas和streams">使用Lambdas和Streams<a hidden class="anchor" aria-hidden="true" href="#使用lambdas和streams">#</a></h2>
<p>Stream是对集合的包装，通常和lambda一起使用。 使用lambdas可以支持许多操作，<br>
如 map、filter、limit、sorted、count、min、max、sum、collect等等。<br>
同样，stream使用懒运算，他们并不会真正地读取所有数据，遇到像getFirst()这样的方法就会结束链式语法。<br>
在接下来的例子中，我们将探索lambdas和streams 能做什么。我们创建了一个Person类并使用这个类来添加一些数据到list中，将用于进一步流操作。</p>
<p>Person只是一个简单的POJO类：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Person {
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> String firstName, lastName, job, gender;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> salary, age;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> Person(String firstName, String lastName, String job,
</span></span><span style="display:flex;"><span>                String gender, <span style="color:#fff;font-weight:bold">int</span> age, <span style="color:#fff;font-weight:bold">int</span> salary)       {  
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">firstName</span> = firstName;  
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">lastName</span> = lastName;  
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">gender</span> = gender;  
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">age</span> = age;  
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">job</span> = job;  
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">salary</span> = salary;  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Getter and Setter</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// . . . . .</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来，我们将创建两个list，都用来存放Person对象：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Person&gt; javaProgrammers = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;Person&gt;() {
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Elsdon&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Jaycob&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Java programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;male&#34;</span>, 43, 2000));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Tamsen&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Brittany&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Java programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>, 23, 1500));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Floyd&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Donny&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Java programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;male&#34;</span>, 33, 1800));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Sindy&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Jonie&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Java programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>, 32, 1600));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Vere&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Hervey&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Java programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;male&#34;</span>, 22, 1200));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Maude&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Jaimie&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Java programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>, 27, 1900));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Shawn&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Randall&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Java programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;male&#34;</span>, 30, 2300));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Jayden&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Corrina&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Java programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>, 35, 1700));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Palmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Dene&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Java programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;male&#34;</span>, 33, 2000));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Addison&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Pam&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Java programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>, 34, 1300));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>List&lt;Person&gt; phpProgrammers = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;Person&gt;() {
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Jarrod&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Pace&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PHP programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;male&#34;</span>, 34, 1550));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Clarette&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Cicely&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PHP programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>, 23, 1200));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Victor&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Channing&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PHP programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;male&#34;</span>, 32, 1600));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Tori&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Sheryl&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PHP programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>, 21, 1000));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Osborne&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Shad&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PHP programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;male&#34;</span>, 32, 1100));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Rosalind&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Layla&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PHP programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>, 25, 1300));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Fraser&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Hewie&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PHP programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;male&#34;</span>, 36, 1100));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Quinn&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Tamara&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PHP programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>, 21, 1000));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Alvin&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Lance&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PHP programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;male&#34;</span>, 38, 1600));
</span></span><span style="display:flex;"><span>    add(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Evonne&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Shari&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PHP programmer&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>, 40, 1800));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在我们使用forEach方法来迭代输出上述列表：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;所有程序员的姓名:&#34;</span>);
</span></span><span style="display:flex;"><span>javaProgrammers.<span style="color:#007f7f">forEach</span>((p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;%s %s; &#34;</span>, p.<span style="color:#007f7f">getFirstName</span>(), p.<span style="color:#007f7f">getLastName</span>()));
</span></span><span style="display:flex;"><span>phpProgrammers.<span style="color:#007f7f">forEach</span>((p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;%s %s; &#34;</span>, p.<span style="color:#007f7f">getFirstName</span>(), p.<span style="color:#007f7f">getLastName</span>()));
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们同样使用forEach方法，增加程序员的工资5%：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;给程序员加薪 5% :&#34;</span>);
</span></span><span style="display:flex;"><span>Consumer&lt;Person&gt; giveRaise = e -&gt; e.<span style="color:#007f7f">setSalary</span>(e.<span style="color:#007f7f">getSalary</span>() / 100 * 5 + e.<span style="color:#007f7f">getSalary</span>());
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>javaProgrammers.<span style="color:#007f7f">forEach</span>(giveRaise);
</span></span><span style="display:flex;"><span>phpProgrammers.<span style="color:#007f7f">forEach</span>(giveRaise);
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过过滤器filter()，筛选出月薪超过1400美元的PHP程序员：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;下面是月薪超过 $1,400 的PHP程序员:&#34;</span>);
</span></span><span style="display:flex;"><span>phpProgrammers.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">filter</span>((p) -&gt; (p.<span style="color:#007f7f">getSalary</span>() &gt; 1400))  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">forEach</span>((p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;%s %s; &#34;</span>, p.<span style="color:#007f7f">getFirstName</span>(), p.<span style="color:#007f7f">getLastName</span>()));
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们也可以定义过滤器，然后重用它们来执行其他操作：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 定义 filters</span>
</span></span><span style="display:flex;"><span>Predicate&lt;Person&gt; ageFilter = (p) -&gt; (p.<span style="color:#007f7f">getAge</span>() &gt; 25);
</span></span><span style="display:flex;"><span>Predicate&lt;Person&gt; salaryFilter = (p) -&gt; (p.<span style="color:#007f7f">getSalary</span>() &gt; 1400);
</span></span><span style="display:flex;"><span>Predicate&lt;Person&gt; genderFilter = (p) -&gt; (<span style="color:#0ff;font-weight:bold">&#34;female&#34;</span>.<span style="color:#007f7f">equals</span>(p.<span style="color:#007f7f">getGender</span>()));
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;下面是年龄大于 24岁且月薪在$1,400以上的女PHP程序员:&#34;</span>);
</span></span><span style="display:flex;"><span>phpProgrammers.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">filter</span>(ageFilter)
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">filter</span>(salaryFilter)
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">filter</span>(genderFilter)
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">forEach</span>((p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;%s %s; &#34;</span>, p.<span style="color:#007f7f">getFirstName</span>(), p.<span style="color:#007f7f">getLastName</span>()));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 重用filters</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;年龄大于 24岁的女性 Java programmers:&#34;</span>);
</span></span><span style="display:flex;"><span>javaProgrammers.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">filter</span>(ageFilter)  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">filter</span>(genderFilter)  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">forEach</span>((p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;%s %s; &#34;</span>, p.<span style="color:#007f7f">getFirstName</span>(), p.<span style="color:#007f7f">getLastName</span>()));  
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用limit方法，可以限制结果集的个数：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;最前面的3个 Java programmers:&#34;</span>);
</span></span><span style="display:flex;"><span>javaProgrammers.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">limit</span>(3)  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">forEach</span>((p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;%s %s; &#34;</span>, p.<span style="color:#007f7f">getFirstName</span>(), p.<span style="color:#007f7f">getLastName</span>()));
</span></span><span style="display:flex;"><span>		  
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;最前面的3个女性 Java programmers:&#34;</span>);
</span></span><span style="display:flex;"><span>javaProgrammers.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">filter</span>(genderFilter)
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">limit</span>(3)
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">forEach</span>((p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;%s %s; &#34;</span>, p.<span style="color:#007f7f">getFirstName</span>(), p.<span style="color:#007f7f">getLastName</span>()));
</span></span></code></pre></td></tr></table>
</div>
</div><p>排序呢? 我们在stream中能处理吗? 答案是肯定的。在下面的例子中,我们将根据名字和薪水排序Java程序员，放到一个list中,然后显示列表：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;根据 name 排序,并显示前5个 Java programmers:&#34;</span>);
</span></span><span style="display:flex;"><span>List&lt;Person&gt; sortedJavaProgrammers = javaProgrammers
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">stream</span>()  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">sorted</span>((p, p2) -&gt; (p.<span style="color:#007f7f">getFirstName</span>().<span style="color:#007f7f">compareTo</span>(p2.<span style="color:#007f7f">getFirstName</span>())))  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">limit</span>(5)  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">collect</span>(toList());  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>sortedJavaProgrammers.<span style="color:#007f7f">forEach</span>((p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;%s %s; %n&#34;</span>, p.<span style="color:#007f7f">getFirstName</span>(), p.<span style="color:#007f7f">getLastName</span>()));
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;根据 salary 排序 Java programmers:&#34;</span>);
</span></span><span style="display:flex;"><span>sortedJavaProgrammers = javaProgrammers
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">stream</span>()  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">sorted</span>( (p, p2) -&gt; (p.<span style="color:#007f7f">getSalary</span>() - p2.<span style="color:#007f7f">getSalary</span>()) )  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">collect</span>( toList() );  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>sortedJavaProgrammers.<span style="color:#007f7f">forEach</span>((p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;%s %s; %n&#34;</span>, p.<span style="color:#007f7f">getFirstName</span>(), p.<span style="color:#007f7f">getLastName</span>())); 
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果我们只对最低和最高的薪水感兴趣，比排序后选择第一个/最后一个更快的是min和max方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;工资最低的 Java programmer:&#34;</span>);
</span></span><span style="display:flex;"><span>Person pers = javaProgrammers
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">stream</span>()  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">min</span>((p1, p2) -&gt; (p1.<span style="color:#007f7f">getSalary</span>() - p2.<span style="color:#007f7f">getSalary</span>()))  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;Name: %s %s; Salary: $%,d.&#34;</span>, pers.<span style="color:#007f7f">getFirstName</span>(), pers.<span style="color:#007f7f">getLastName</span>(), pers.<span style="color:#007f7f">getSalary</span>());
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;工资最高的 Java programmer:&#34;</span>);
</span></span><span style="display:flex;"><span>Person person = javaProgrammers
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">stream</span>()  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">max</span>((p, p2) -&gt; (p.<span style="color:#007f7f">getSalary</span>() - p2.<span style="color:#007f7f">getSalary</span>()))
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;Name: %s %s; Salary: $%,d.&#34;</span>, person.<span style="color:#007f7f">getFirstName</span>(), person.<span style="color:#007f7f">getLastName</span>(), person.<span style="color:#007f7f">getSalary</span>());
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面的例子中我们已经看到 collect 方法是如何工作的。结合 map 方法，我们可以使用 collect 方法来将我们的结果集放到一个字符串，一个 Set 或一个TreeSet中：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;将 PHP programmers 的 first name 拼接成字符串:&#34;</span>);
</span></span><span style="display:flex;"><span>String phpDevelopers = phpProgrammers
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">stream</span>()  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">map</span>(Person::getFirstName)  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">collect</span>(joining(<span style="color:#0ff;font-weight:bold">&#34; ; &#34;</span>)); <span style="color:#007f7f">// 在进一步的操作中可以作为标记(token)     </span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;将 Java programmers 的 first name 存放到 Set:&#34;</span>);
</span></span><span style="display:flex;"><span>Set&lt;String&gt; javaDevFirstName = javaProgrammers
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">stream</span>()  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">map</span>(Person::getFirstName)  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">collect</span>(toSet());  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;将 Java programmers 的 first name 存放到 TreeSet:&#34;</span>);
</span></span><span style="display:flex;"><span>TreeSet&lt;String&gt; javaDevLastName = javaProgrammers
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">stream</span>()  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">map</span>(Person::getLastName)  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">collect</span>(toCollection(TreeSet::<span style="color:#fff;font-weight:bold">new</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><p>Streams 还可以是并行的(parallel)。示例如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;计算付给 Java programmers 的所有money:&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> totalSalary = javaProgrammers
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">parallelStream</span>()  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">mapToInt</span>(p -&gt; p.<span style="color:#007f7f">getSalary</span>())  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">sum</span>();  
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们可以使用summaryStatistics方法获得stream中元素的各种汇总数据。接下来，我们可以访问这些方法，比如getMax，getMin，getSum或getAverage：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//计算 count, min, max, sum, and average for numbers</span>
</span></span><span style="display:flex;"><span>List&lt;Integer&gt; numbers = Arrays.<span style="color:#007f7f">asList</span>(1, 2, 3, 4, 5, 6, 7, 8, 9, 10);
</span></span><span style="display:flex;"><span>IntSummaryStatistics stats = numbers
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">stream</span>()  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">mapToInt</span>((x) -&gt; x)  
</span></span><span style="display:flex;"><span>          .<span style="color:#007f7f">summaryStatistics</span>();  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;List中最大的数字 : &#34;</span> + stats.<span style="color:#007f7f">getMax</span>());
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;List中最小的数字 : &#34;</span> + stats.<span style="color:#007f7f">getMin</span>());
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;所有数字的总和   : &#34;</span> + stats.<span style="color:#007f7f">getSum</span>());
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;所有数字的平均值 : &#34;</span> + stats.<span style="color:#007f7f">getAverage</span>()); 
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://www.cnblogs.com/franson-2016/p/5593080.html">参考</a></p>
<h2 id="什么是函数式接口">什么是函数式接口<a hidden class="anchor" aria-hidden="true" href="#什么是函数式接口">#</a></h2>
<p>函数式接口就是<code>只显式声明一个抽象方法的接口</code>。<br>
为保证方法数量不多不少，java8提供了一个专用注解@FunctionalInterface，当接口中声明的抽象方法多于或少于一个时就会报错。如下所示：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface  <span style="color:#007f7f">//报错</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> InterfaceWithNoParam {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface  <span style="color:#007f7f">//报错</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> InterfaceWithNoParam {
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">void</span> f1();
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">void</span> f2();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>必须先来理解下函数式接口，因为Lambda是建立在函数式接口的基础上的。</p>
<ul>
<li>只包含一个抽象方法的接口，称为函数式接口。</li>
<li>你可以通过 Lambda 表达式来创建该接口的对象。</li>
<li>我们可以在任意函数式接口上使用 @FunctionalInterface 注解，这样做可以检测它是否是一个函数式接口，同时 javadoc 也会包含一条声明，说明这个接口是一个函数式接口。</li>
</ul>
<p>🈶️两个比较常见的函数式接口：Runnable接口，Comparator接口</p>
<p>Runnable接口相关</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Test {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 1.1使用匿名内部类  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(<span style="color:#fff;font-weight:bold">new</span> Runnable() {  
</span></span><span style="display:flex;"><span>            @Override  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {  
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello world !&#34;</span>);  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        }).<span style="color:#007f7f">start</span>();  
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 1.2使用 lambda 获得Runnable接口对象  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(() -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello world !&#34;</span>)).<span style="color:#007f7f">start</span>();  
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//=============================================================================</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.1使用匿名内部类  </span>
</span></span><span style="display:flex;"><span>        Runnable race1 = <span style="color:#fff;font-weight:bold">new</span> Runnable() {  
</span></span><span style="display:flex;"><span>            @Override  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {  
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello world !&#34;</span>);  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        };  
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.2使用 lambda直接获得接口对象 </span>
</span></span><span style="display:flex;"><span>        Runnable race2 = () -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello world !&#34;</span>);          
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 直接调用 run 方法(没开新线程哦!)  </span>
</span></span><span style="display:flex;"><span>        race1.<span style="color:#007f7f">run</span>();  
</span></span><span style="display:flex;"><span>        race2.<span style="color:#007f7f">run</span>();  
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>/*输出结果
</span></span><span style="display:flex;"><span> * Hello world !
</span></span><span style="display:flex;"><span> * Hello world !
</span></span><span style="display:flex;"><span> * Hello world !
</span></span><span style="display:flex;"><span> * Hello world !
</span></span><span style="display:flex;"><span> *<span style="color:#f00">／</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用Lambda对数组排序</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TestArray {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        String[] players = {<span style="color:#0ff;font-weight:bold">&#34;zhansgan&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;lisi&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;wangwu&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;zhaoliu&#34;</span>,  <span style="color:#0ff;font-weight:bold">&#34;wangmazi&#34;</span>};  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 1.1 使用匿名内部类根据 surname 排序 players  </span>
</span></span><span style="display:flex;"><span>        Arrays.<span style="color:#007f7f">sort</span>(players, <span style="color:#fff;font-weight:bold">new</span> Comparator&lt;String&gt;() {  
</span></span><span style="display:flex;"><span>            @Override  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compare(String s1, String s2) {  
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> (s1.<span style="color:#007f7f">compareTo</span>(s2));  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        });  
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 1.2 使用 lambda 排序,根据 surname  </span>
</span></span><span style="display:flex;"><span>        Arrays.<span style="color:#007f7f">sort</span>(players, (String s1, String s2) -&gt;  s1.<span style="color:#007f7f">compareTo</span>(s2));  
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//================================================================================================</span>
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.1 使用匿名内部类根据 name lenght 排序 players  </span>
</span></span><span style="display:flex;"><span>        Arrays.<span style="color:#007f7f">sort</span>(players, <span style="color:#fff;font-weight:bold">new</span> Comparator&lt;String&gt;() {  
</span></span><span style="display:flex;"><span>            @Override  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compare(String s1, String s2) {  
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> (s1.<span style="color:#007f7f">length</span>() - s2.<span style="color:#007f7f">length</span>());  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        });  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.2使用Lambda,根据name length  </span>
</span></span><span style="display:flex;"><span>        Arrays.<span style="color:#007f7f">sort</span>(players, (String s1, String s2) -&gt; (s1.<span style="color:#007f7f">length</span>() - s2.<span style="color:#007f7f">length</span>()));  
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//==================================================================================================    </span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 3.1 使用匿名内部类排序 players, 根据最后一个字母  </span>
</span></span><span style="display:flex;"><span>        Arrays.<span style="color:#007f7f">sort</span>(players, <span style="color:#fff;font-weight:bold">new</span> Comparator&lt;String&gt;() {
</span></span><span style="display:flex;"><span>            @Override  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compare(String s1, String s2) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> (s1.<span style="color:#007f7f">charAt</span>(s1.<span style="color:#007f7f">length</span>() - 1) - s2.<span style="color:#007f7f">charAt</span>(s2.<span style="color:#007f7f">length</span>() - 1));  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>        });  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 3.2 使用Lambda,根据最后一个字母</span>
</span></span><span style="display:flex;"><span>        Arrays.<span style="color:#007f7f">sort</span>(players, (String s1, String s2) -&gt; (s1.<span style="color:#007f7f">charAt</span>(s1.<span style="color:#007f7f">length</span>() - 1) - s2.<span style="color:#007f7f">charAt</span>(s2.<span style="color:#007f7f">length</span>() - 1)));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过上面例子我们再来思考为什么Lambda表达式需要函数式接口？其实很简单目的就是为来保证唯一。<br>
你的Runnable接口只要一个抽象方法，那么我用<code>() -&gt; System.out.println(&quot;Hello world !&quot;)</code>，就只能代表run方法，如果你下面还有一个抽象方法，那我使用Lambda表达式，那鬼才知道要调用哪个抽象方法呢。</p>
<h2 id="方法引用-1">方法引用<a hidden class="anchor" aria-hidden="true" href="#方法引用-1">#</a></h2>
<p>函数式接口的实例可以通过 lambda 表达式、 方法引用、构造方法引用来创建。方法引用是 lambda 表达式的语法糖，任何用方法引用的地方都可由lambda表达式替换，但是并不是所有的lambda表达式都可以用方法引用来替换。<br>
举例，这就是一个打印集合所有元素的例子，<code>value -&gt; System.out.println(value) </code>是一个Consumer函数式接口， 这个函数式接口可以通过方法引用来替换。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TestArray {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>         List&lt;String&gt; list = Arrays.<span style="color:#007f7f">asList</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>);
</span></span><span style="display:flex;"><span>         list.<span style="color:#007f7f">forEach</span>(value -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(value));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/* 输出：
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * a
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * b
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * c
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用方法引用的方式，和上面的输出是一样的，方法引用使用的是双冒号（::）<br>
<code>list.forEach(System.out::println);</code></p>
<p>分类</p>
<table>
<thead>
<tr>
<th>类别</th>
<th>使用形式</th>
</tr>
</thead>
<tbody>
<tr>
<td>静态方法引用</td>
<td>类名 :: 静态方法名</td>
</tr>
<tr>
<td>实例方法引用</td>
<td>对象名(引用名) :: 实例方法名</td>
</tr>
<tr>
<td>类方法引用</td>
<td>类名 :: 实例方法名</td>
</tr>
<tr>
<td>构造方法引用</td>
<td>类名 :: new</td>
</tr>
</tbody>
</table>
<h3 id="静态方法引用">静态方法引用<a hidden class="anchor" aria-hidden="true" href="#静态方法引用">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Apple {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String color;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">double</span> weight;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Apple(String name, String color, <span style="color:#fff;font-weight:bold">double</span> weight) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">color</span> = color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">weight</span> = weight;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">int</span> compareByWeight(Apple a1, Apple a2) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">double</span> diff = a1.<span style="color:#007f7f">getWeight</span>() - a2.<span style="color:#007f7f">getWeight</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Double(diff).<span style="color:#007f7f">intValue</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//还有getter setter toString</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>有一个苹果的List，现在需要根据苹果的重量进行排序。List 的 sort 函数接收一个 Comparator 类型的参数，Comparator 是一个函数式接口，接收两个参数，返回一个int值。<br>
Apple的静态方法compareByWeight正好符合Comparator函数式接口，所以可以使用：<br>
<code>Apple::compareByWeight</code>静态方法引用来替代lambda表达式</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LambdaTest {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Apple apple1 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;红富士&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Red&#34;</span>, 280);
</span></span><span style="display:flex;"><span>        Apple apple2 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;冯心&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Yello&#34;</span>, 470);
</span></span><span style="display:flex;"><span>        Apple apple3 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;大牛&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Red&#34;</span>, 320);
</span></span><span style="display:flex;"><span>        Apple apple4 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;小小&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Green&#34;</span>, 300);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        List&lt;Apple&gt; appleList = Arrays.<span style="color:#007f7f">asList</span>(apple1, apple2, apple3, apple4);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//lambda 表达式形式</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//appleList.sort((Apple a1, Apple a2) -&gt; {</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//    return new Double(a1.getWeight() - a2.getWeight()).intValue();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//静态方法引用形式（可以看出引用方法比上面的更加简单</span>
</span></span><span style="display:flex;"><span>        appleList.<span style="color:#007f7f">sort</span>(Apple::compareByWeight);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        appleList.<span style="color:#007f7f">forEach</span>(apple -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(apple));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>输出<span style="color:#f00">：</span>
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>红富士<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Red<span style="color:#f00">&#39;</span>, weight=280.<span style="color:#007f7f">0</span>}
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>小小<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Green<span style="color:#f00">&#39;</span>, weight=300.<span style="color:#007f7f">0</span>}
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>大牛<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Red<span style="color:#f00">&#39;</span>, weight=320.<span style="color:#007f7f">0</span>}
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>冯心<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Yello<span style="color:#f00">&#39;</span>, weight=470.<span style="color:#007f7f">0</span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Apple.compareByWeight</code>是方法的调用，而<code>Apple::compareByWeight</code>方法引用，这两者完全不是一回事。</p>
<h3 id="实例方法引用">实例方法引用<a hidden class="anchor" aria-hidden="true" href="#实例方法引用">#</a></h3>
<p>这个 compareByWeight 是一个实例方法</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppleComparator {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compareByWeight(Apple a1, Apple a2) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">double</span> diff = a1.<span style="color:#007f7f">getWeight</span>() - a2.<span style="color:#007f7f">getWeight</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Double(diff).<span style="color:#007f7f">intValue</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>下面的例子通过实例对象的方法引用 <code>comparator::compareByWeight</code> 来代替lambda表达式</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LambdaTest {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Apple apple1 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;红富士&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Red&#34;</span>, 280);
</span></span><span style="display:flex;"><span>        Apple apple2 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;冯心&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Yello&#34;</span>, 470);
</span></span><span style="display:flex;"><span>        Apple apple3 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;哈哈&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Red&#34;</span>, 320);
</span></span><span style="display:flex;"><span>        Apple apple4 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;小小&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Green&#34;</span>, 300);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        List&lt;Apple&gt; appleList = Arrays.<span style="color:#007f7f">asList</span>(apple1, apple2, apple3, apple4);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//lambda 表达式形式</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//appleList.sort((Apple a1, Apple a2) -&gt; {</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//    return new Double(a1.getWeight() - a2.getWeight()).intValue();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//实例方法引用</span>
</span></span><span style="display:flex;"><span>        AppleComparator comparator = <span style="color:#fff;font-weight:bold">new</span> AppleComparator();
</span></span><span style="display:flex;"><span>        appleList.<span style="color:#007f7f">sort</span>(comparator::compareByWeight);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        appleList.<span style="color:#007f7f">forEach</span>(apple -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(apple));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>输出<span style="color:#f00">：</span>
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>红富士<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Red<span style="color:#f00">&#39;</span>, weight=280.<span style="color:#007f7f">0</span>}
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>小小<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Green<span style="color:#f00">&#39;</span>, weight=300.<span style="color:#007f7f">0</span>}
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>哈哈<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Red<span style="color:#f00">&#39;</span>, weight=320.<span style="color:#007f7f">0</span>}
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>冯心<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Yello<span style="color:#f00">&#39;</span>, weight=470.<span style="color:#007f7f">0</span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过上面两个例子可以看到，静态方法引用和实例方法引用都是比较好理解的。</p>
<h3 id="类方法引用">类方法引用<a hidden class="anchor" aria-hidden="true" href="#类方法引用">#</a></h3>
<p>一般来说，同类型对象的比较，应该当前调用方法的对象与另外一个对象进行比较，好的设计应该像下面：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Apple {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String category;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String color;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">double</span> weight;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Apple(String category, String color, <span style="color:#fff;font-weight:bold">double</span> weight) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">category</span> = category;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">color</span> = color;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">weight</span> = weight;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//这里和上面静态方式唯一区别就是这个参数就一个，需要实例对象调这个方法</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> compareByWeight(Apple other) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">double</span> diff = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getWeight</span>() - other.<span style="color:#007f7f">getWeight</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Double(diff).<span style="color:#007f7f">intValue</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//getter setter toString</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>还是之前List排序的例子，看看使用类方法引用如何写：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LambdaTest {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Apple apple1 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;红富士&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Red&#34;</span>, 280);
</span></span><span style="display:flex;"><span>        Apple apple2 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;黄元帅&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Yello&#34;</span>, 470);
</span></span><span style="display:flex;"><span>        Apple apple3 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;红将军&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Red&#34;</span>, 320);
</span></span><span style="display:flex;"><span>        Apple apple4 = <span style="color:#fff;font-weight:bold">new</span> Apple(<span style="color:#0ff;font-weight:bold">&#34;国光&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Green&#34;</span>, 300);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        List&lt;Apple&gt; appleList = Arrays.<span style="color:#007f7f">asList</span>(apple1, apple2, apple3, apple4);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//lambda 表达式形式</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//appleList.sort((Apple a1, Apple a2) -&gt; {</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//    return new Double(a1.getWeight() - a2.getWeight()).intValue();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//这里是类方法引用</span>
</span></span><span style="display:flex;"><span>        appleList.<span style="color:#007f7f">sort</span>(Apple::compareByWeight);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        appleList.<span style="color:#007f7f">forEach</span>(apple -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(apple));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>输出<span style="color:#f00">：</span>
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>红富士<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Red<span style="color:#f00">&#39;</span>, weight=280.<span style="color:#007f7f">0</span>}
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>国光<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Green<span style="color:#f00">&#39;</span>, weight=300.<span style="color:#007f7f">0</span>}
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>红将军<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Red<span style="color:#f00">&#39;</span>, weight=320.<span style="color:#007f7f">0</span>}
</span></span><span style="display:flex;"><span>Apple{category=<span style="color:#f00">&#39;</span>黄元帅<span style="color:#f00">&#39;</span>, color=<span style="color:#f00">&#39;</span>Yello<span style="color:#f00">&#39;</span>, weight=470.<span style="color:#007f7f">0</span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里使用的是：类名::实例方法名。首先要说明的是，方法引用不是方法调用。compareByWeight一定是某个实例调用的，就是lambda表达式的第一个参数，然后lambda表达式剩下的参数作为<br>
compareByWeight的参数，这样compareByWeight正好符合lambda表达式的定义。<br>
或者也可以这样理解：<br>
<code>(Apple a1, Apple a2) -&gt; { return new Double(a1.getWeight() - a2.getWeight()).intValue(); }</code><br>
int compareByWeight(Apple other) 需要当前对象调用，然后与另外一个对象比较，并且返回一个int值。可以理解为lambda表达式的第一个参数 a1 赋值给当前对象， 然后 a2 赋值给 other对象，然后返回int值。</p>
<h3 id="构造方法引用-1">构造方法引用<a hidden class="anchor" aria-hidden="true" href="#构造方法引用-1">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ConstructionMethodTest {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getString(Supplier&lt;String&gt; supplier) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> supplier.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        ConstructionMethodTest test = <span style="color:#fff;font-weight:bold">new</span> ConstructionMethodTest();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//lambda表达式形式</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(test.<span style="color:#007f7f">getString</span>(() -&gt; { <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> String();}));
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//构造方法引用形式</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(test.<span style="color:#007f7f">getString</span>(String::<span style="color:#fff;font-weight:bold">new</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>getString 方法接收一个Supplier类型的参数，Supplier 不接收参数，返回一个String。lambda表达式应该这样写：<br>
<code>() -&gt; { return new String();}</code><br>
替换成方法引用的形式如下： 实际上调用的是String 无参构造方法。<br>
<code>String::new</code></p>
<p><a href="https://www.cnblogs.com/xiaoxi/p/7099667.html">方法引用参考</a></p>
<h1 id="lambda表达式的一些小问题">lambda表达式的一些小问题<a hidden class="anchor" aria-hidden="true" href="#lambda表达式的一些小问题">#</a></h1>
<h2 id="variable-used-in-lambda-expression-should-be-final-or-effectively-final">Variable used in lambda expression should be final or effectively final<a hidden class="anchor" aria-hidden="true" href="#variable-used-in-lambda-expression-should-be-final-or-effectively-final">#</a></h2>
<p>翻译：lambda表达式中使用的变量应该是final或有效的final。<br>
Lambda与匿名内部类在访问外部变量时，都不允许有修改变量的倾向，即：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">double</span> a  = 3.<span style="color:#007f7f">141592</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">double</span> b = 3.<span style="color:#007f7f">141592</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DoubleUnaryOperator anotherDoubleUnaryOperator = x -&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ERROR，Cannot assign a value to final variable，无法改变final量的值</span>
</span></span><span style="display:flex;"><span>    a = 2; 
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ERROR，Variable used in lambda expression should be final or effectively final，</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 不允许在Lambda表达式中修改使用的（外部）变量</span>
</span></span><span style="display:flex;"><span>    b = 3; 
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> 0.<span style="color:#007f7f">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></td></tr></table>
</div>
</div><p>如何规避这个？可以使用数组</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">double</span>[] a = {3.<span style="color:#007f7f">141592</span>};
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">double</span>[] b = {3.<span style="color:#007f7f">141592</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DoubleUnaryOperator anotherDoubleUnaryOperator = x -&gt; {
</span></span><span style="display:flex;"><span>    a[0] = 2; <span style="color:#007f7f">// COOL</span>
</span></span><span style="display:flex;"><span>    b[0] = 3; <span style="color:#007f7f">// ALSO COOL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> 0.<span style="color:#007f7f">0</span>;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lambda表达式foreach如何提前终止">lambda表达式foreach()如何提前终止<a hidden class="anchor" aria-hidden="true" href="#lambda表达式foreach如何提前终止">#</a></h2>
<p><a href="https://www.cnblogs.com/Marydon20170307/p/14207705.html">参考</a><br>
<code>lambda</code> 表达式 <code>foreach()</code> 是无法通过 <code>continue</code> 或 <code>break</code> 跳出的，但是可以通过return跳过本轮循环，如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>    String[] nameArray = {<span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;3&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;4&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;5&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;6&#34;</span>};
</span></span><span style="display:flex;"><span>    List&lt;String&gt; list = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;(Arrays.<span style="color:#007f7f">asList</span>(nameArray));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    list.<span style="color:#007f7f">forEach</span>(i-&gt;{
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(<span style="color:#0ff;font-weight:bold">&#34;3&#34;</span>.<span style="color:#007f7f">equals</span>(i)){
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;结束本轮循环&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(i);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>如上，想要跳出当前循环，使用了 <code>return</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1
</span></span><span style="display:flex;"><span>2
</span></span><span style="display:flex;"><span>结束本轮循环
</span></span><span style="display:flex;"><span>4
</span></span><span style="display:flex;"><span>5
</span></span><span style="display:flex;"><span>6
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，只有3没被打印出来，其他元素都被打印了。<br>
就是说，关键字return，在这里的执行效果相当于普通for循环里的关键字continue。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>我们知道<span style="color:#f00">，</span>在普通的for循环里<span style="color:#f00">，</span>
</span></span><span style="display:flex;"><span>- 想要提前终止循环体<span style="color:#f00">，</span>使用break<span style="color:#f00">。</span>
</span></span><span style="display:flex;"><span>- 想要结束本轮循环<span style="color:#f00">，</span>进入下一次循环<span style="color:#f00">，</span>使用continue<span style="color:#f00">。</span>
</span></span><span style="display:flex;"><span>另外<span style="color:#f00">，</span>在普通for里<span style="color:#f00">，</span>如果使用<span style="color:#0ff;font-weight:bold">&#34;return&#34;</span><span style="color:#f00">，</span>不仅强制结束for循环体<span style="color:#f00">，</span>还会提前结束包含这个循环体的整个方法<span style="color:#f00">。</span>
</span></span><span style="display:flex;"><span>而在Java8中的forEach()中<span style="color:#f00">，</span><span style="color:#0ff;font-weight:bold">&#34;break&#34;</span>或<span style="color:#0ff;font-weight:bold">&#34;continue&#34;</span>是不被允许使用的<span style="color:#f00">，</span>而return的意思也不是原来return代表的含义了<span style="color:#f00">。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果想要跳出<code>foreach</code>，还是建议使用普通的<code>foreach</code>。</p>
<h1 id="collectors">Collectors<a hidden class="anchor" aria-hidden="true" href="#collectors">#</a></h1>
<p>Collector和Collectors。<br>
Collector是专门用来作为Stream的collect方法的参数的。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Stream&lt;T&gt; <span style="color:#fff;font-weight:bold">extends</span> BaseStream&lt;T, Stream&lt;T&gt;&gt; {
</span></span><span style="display:flex;"><span>    &lt;R, A&gt; R collect(Collector&lt;? <span style="color:#fff;font-weight:bold">super</span> T, A, R&gt; collector);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Collectors 是工具类，用来生产具体的 Collector。</p>
<h2 id="tolist">toList<a hidden class="anchor" aria-hidden="true" href="#tolist">#</a></h2>
<p>将流中的元素放置到一个集合中。这个列表默认为ArrayList。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Integer&gt; list = Arrays.<span style="color:#007f7f">asList</span>(1,2,3,4);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 过滤list，然后将过滤后的数据，放到一个新的list中</span>
</span></span><span style="display:flex;"><span>List&lt;Integer&gt; newList = list.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(i-&gt; i&gt;2)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(newList);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="toset">toSet<a hidden class="anchor" aria-hidden="true" href="#toset">#</a></h2>
<p>将流中的元素放置到一个无序集set中去，默认为HashSet。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Integer&gt; list = Arrays.<span style="color:#007f7f">asList</span>(1,2,3,3,4);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 过滤list，然后将过滤后的数据，放到一个set中（set会去掉重复元素）</span>
</span></span><span style="display:flex;"><span>Set&lt;Integer&gt; set = list.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(i -&gt; i&gt;2)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toSet</span>());
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(set);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="joining">joining<a hidden class="anchor" aria-hidden="true" href="#joining">#</a></h2>
<p>joining 可以将list中的数据拼接成一个字符串，可以指定连接符，还可以指定结果的前后缀。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;String&gt; list = Arrays.<span style="color:#007f7f">asList</span>(<span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;4&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 将list中的数据，拼接成一个字符串</span>
</span></span><span style="display:flex;"><span>String s1 = list.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">joining</span>());
</span></span><span style="display:flex;"><span>String s2 = list.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">joining</span>(<span style="color:#0ff;font-weight:bold">&#34;,&#34;</span>));
</span></span><span style="display:flex;"><span>String s3 = list.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">joining</span>(<span style="color:#0ff;font-weight:bold">&#34;,&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;[&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;]&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 输出，观察三个方法的不同</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(s1);<span style="color:#007f7f">// 1234</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(s2);<span style="color:#007f7f">// 1,2,3,4</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(s3);<span style="color:#007f7f">// [1,2,3,4]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="collectorsgroupingby">Collectors.groupingBy<a hidden class="anchor" aria-hidden="true" href="#collectorsgroupingby">#</a></h2>
<p><code>Collectors.groupingBy</code> 根据一个或多个属性对集合中的项目进行分组。</p>
<p>准备一个类：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> Product{
</span></span><span style="display:flex;"><span>    Long id;
</span></span><span style="display:flex;"><span>    Integer num;
</span></span><span style="display:flex;"><span>    BigDecimal price;
</span></span><span style="display:flex;"><span>    String name;
</span></span><span style="display:flex;"><span>    String category;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Product(Long id, Integer num, BigDecimal price, String name, String category) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">id</span> = id;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">num</span> = num;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">price</span> = price;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">category</span> = category;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>开始测试</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Product prod1 = <span style="color:#fff;font-weight:bold">new</span> Product(1L, 1, <span style="color:#fff;font-weight:bold">new</span> BigDecimal(<span style="color:#0ff;font-weight:bold">&#34;15.5&#34;</span>), <span style="color:#0ff;font-weight:bold">&#34;面包&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;零食&#34;</span>);
</span></span><span style="display:flex;"><span>Product prod2 = <span style="color:#fff;font-weight:bold">new</span> Product(2L, 2, <span style="color:#fff;font-weight:bold">new</span> BigDecimal(<span style="color:#0ff;font-weight:bold">&#34;20&#34;</span>), <span style="color:#0ff;font-weight:bold">&#34;饼干&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;零食&#34;</span>);
</span></span><span style="display:flex;"><span>Product prod3 = <span style="color:#fff;font-weight:bold">new</span> Product(3L, 3, <span style="color:#fff;font-weight:bold">new</span> BigDecimal(<span style="color:#0ff;font-weight:bold">&#34;30&#34;</span>), <span style="color:#0ff;font-weight:bold">&#34;月饼&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;零食&#34;</span>);
</span></span><span style="display:flex;"><span>Product prod4 = <span style="color:#fff;font-weight:bold">new</span> Product(4L, 3, <span style="color:#fff;font-weight:bold">new</span> BigDecimal(<span style="color:#0ff;font-weight:bold">&#34;10&#34;</span>), <span style="color:#0ff;font-weight:bold">&#34;青岛啤酒&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;啤酒&#34;</span>);
</span></span><span style="display:flex;"><span>Product prod5 = <span style="color:#fff;font-weight:bold">new</span> Product(5L, 10, <span style="color:#fff;font-weight:bold">new</span> BigDecimal(<span style="color:#0ff;font-weight:bold">&#34;15&#34;</span>), <span style="color:#0ff;font-weight:bold">&#34;百威啤酒&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;啤酒&#34;</span>);
</span></span><span style="display:flex;"><span>List&lt;Product&gt; prodList = Lists.<span style="color:#007f7f">newArrayList</span>(prod1, prod2, prod3, prod4, prod5);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//按照类目分组：</span>
</span></span><span style="display:flex;"><span>Map&lt;String, List&lt;Product&gt;&gt; prodMap = prodList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">groupingBy</span>(Product::getCategory));
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//和上面的写法结果相同</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//Map&lt;String, List&lt;Product&gt;&gt; prodMap2 = prodList.stream().collect(Collectors.groupingBy(item -&gt; item.getCategory()));</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//格式化结果</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//{&#34;啤酒&#34;:[{&#34;category&#34;:&#34;啤酒&#34;,&#34;id&#34;:4,&#34;name&#34;:&#34;青岛啤酒&#34;,&#34;num&#34;:3,&#34;price&#34;:10},{&#34;category&#34;:&#34;啤酒&#34;,&#34;id&#34;:5,&#34;name&#34;:&#34;百威啤酒&#34;,&#34;num&#34;:10,&#34;price&#34;:15}],&#34;零食&#34;:[{&#34;category&#34;:&#34;零食&#34;,&#34;id&#34;:1,&#34;name&#34;:&#34;面包&#34;,&#34;num&#34;:1,&#34;price&#34;:15.5},{&#34;category&#34;:&#34;零食&#34;,&#34;id&#34;:2,&#34;name&#34;:&#34;饼干&#34;,&#34;num&#34;:2,&#34;price&#34;:20},{&#34;category&#34;:&#34;零食&#34;,&#34;id&#34;:3,&#34;name&#34;:&#34;月饼&#34;,&#34;num&#34;:3,&#34;price&#34;:30}]}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//按照几个属性拼接分组：</span>
</span></span><span style="display:flex;"><span>Map&lt;String, List&lt;Product&gt;&gt; prodMap2 = prodList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">groupingBy</span>(item -&gt; item.<span style="color:#007f7f">getCategory</span>() + <span style="color:#0ff;font-weight:bold">&#34;_&#34;</span> + item.<span style="color:#007f7f">getName</span>()));
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//{&#34;零食_月饼&#34;:[{&#34;category&#34;:&#34;零食&#34;,&#34;id&#34;:3,&#34;name&#34;:&#34;月饼&#34;,&#34;num&#34;:3,&#34;price&#34;:30}],&#34;零食_面包&#34;:[{&#34;category&#34;:&#34;零食&#34;,&#34;id&#34;:1,&#34;name&#34;:&#34;面包&#34;,&#34;num&#34;:1,&#34;price&#34;:15.5}],&#34;啤酒_百威啤酒&#34;:[{&#34;category&#34;:&#34;啤酒&#34;,&#34;id&#34;:5,&#34;name&#34;:&#34;百威啤酒&#34;,&#34;num&#34;:10,&#34;price&#34;:15}],&#34;啤酒_青岛啤酒&#34;:[{&#34;category&#34;:&#34;啤酒&#34;,&#34;id&#34;:4,&#34;name&#34;:&#34;青岛啤酒&#34;,&#34;num&#34;:3,&#34;price&#34;:10}],&#34;零食_饼干&#34;:[{&#34;category&#34;:&#34;零食&#34;,&#34;id&#34;:2,&#34;name&#34;:&#34;饼干&#34;,&#34;num&#34;:2,&#34;price&#34;:20}]}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//根据不同条件分组：</span>
</span></span><span style="display:flex;"><span>Map&lt;String, List&lt;Product&gt;&gt; prodMap3 = prodList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">groupingBy</span>(item -&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(item.<span style="color:#007f7f">getNum</span>() &lt; 3) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;3&#34;</span>;
</span></span><span style="display:flex;"><span>    }<span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;other&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}));
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//{&#34;other&#34;:[{&#34;category&#34;:&#34;零食&#34;,&#34;id&#34;:3,&#34;name&#34;:&#34;月饼&#34;,&#34;num&#34;:3,&#34;price&#34;:30},{&#34;category&#34;:&#34;啤酒&#34;,&#34;id&#34;:4,&#34;name&#34;:&#34;青岛啤酒&#34;,&#34;num&#34;:3,&#34;price&#34;:10},{&#34;category&#34;:&#34;啤酒&#34;,&#34;id&#34;:5,&#34;name&#34;:&#34;百威啤酒&#34;,&#34;num&#34;:10,&#34;price&#34;:15}],&#34;3&#34;:[{&#34;category&#34;:&#34;零食&#34;,&#34;id&#34;:1,&#34;name&#34;:&#34;面包&#34;,&#34;num&#34;:1,&#34;price&#34;:15.5},{&#34;category&#34;:&#34;零食&#34;,&#34;id&#34;:2,&#34;name&#34;:&#34;饼干&#34;,&#34;num&#34;:2,&#34;price&#34;:20}]}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//---------多级分组</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//按子组收集数据</span>
</span></span><span style="display:flex;"><span>Map&lt;String, Long&gt; prodMap4 = prodList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">groupingBy</span>(Product::getCategory, Collectors.<span style="color:#007f7f">counting</span>()));
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(prodMap4);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//{&#34;啤酒&#34;:2,&#34;零食&#34;:3}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//求和</span>
</span></span><span style="display:flex;"><span>Map&lt;String, Integer&gt; prodMap5 = prodList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">groupingBy</span>(Product::getCategory, Collectors.<span style="color:#007f7f">summingInt</span>(Product::getNum)));
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(prodMap5);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//{&#34;啤酒&#34;:13,&#34;零食&#34;:6}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//把收集器的结果转换为另一种类型</span>
</span></span><span style="display:flex;"><span>Map&lt;String, Product&gt; prodMap6 = prodList.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">groupingBy</span>(Product::getCategory,
</span></span><span style="display:flex;"><span>                                   Collectors.<span style="color:#007f7f">collectingAndThen</span>(Collectors.<span style="color:#007f7f">maxBy</span>(Comparator.<span style="color:#007f7f">comparingInt</span>(Product::getNum)), Optional::get)));
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//{&#34;啤酒&#34;:{&#34;category&#34;:&#34;啤酒&#34;,&#34;id&#34;:5,&#34;name&#34;:&#34;百威啤酒&#34;,&#34;num&#34;:10,&#34;price&#34;:15},&#34;零食&#34;:{&#34;category&#34;:&#34;零食&#34;,&#34;id&#34;:3,&#34;name&#34;:&#34;月饼&#34;,&#34;num&#34;:3,&#34;price&#34;:30}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="groupingby的排序">groupingBy的排序<a hidden class="anchor" aria-hidden="true" href="#groupingby的排序">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> Question {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String type;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> sortOrder;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 省略get/set和构造方法</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 假如有一个这样的list</span>
</span></span><span style="display:flex;"><span>List&lt;Question&gt; questions = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>questions.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> Question(<span style="color:#0ff;font-weight:bold">&#34;丙&#34;</span>, 3));
</span></span><span style="display:flex;"><span>questions.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> Question(<span style="color:#0ff;font-weight:bold">&#34;乙&#34;</span>, 2));
</span></span><span style="display:flex;"><span>questions.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> Question(<span style="color:#0ff;font-weight:bold">&#34;甲&#34;</span>, 1));
</span></span><span style="display:flex;"><span>questions.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> Question(<span style="color:#0ff;font-weight:bold">&#34;丙&#34;</span>, 4));
</span></span><span style="display:flex;"><span>questions.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> Question(<span style="color:#0ff;font-weight:bold">&#34;乙&#34;</span>, 5));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 期望根据type字段进行分组，并且根据type字段排序</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 方法一：因为sortOrder字段是有序的，所以先根据sortOrder字段排序</span>
</span></span><span style="display:flex;"><span>questions = questions.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">sorted</span>(Comparator.<span style="color:#007f7f">comparing</span>(Question::getSortOrder)).<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 分组，使用LinkedHashMap</span>
</span></span><span style="display:flex;"><span>Map&lt;String, List&lt;Question&gt;&gt; groupedQuestions = questions.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">groupingBy</span>(Question::getType, LinkedHashMap::<span style="color:#fff;font-weight:bold">new</span>, Collectors.<span style="color:#007f7f">toList</span>()));
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 打印分组结果</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span> (Map.<span style="color:#007f7f">Entry</span>&lt;String, List&lt;Question&gt;&gt; entry : groupedQuestions.<span style="color:#007f7f">entrySet</span>()) {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;题型名: &#34;</span> + entry.<span style="color:#007f7f">getKey</span>());
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;排序结果: &#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (Question question : entry.<span style="color:#007f7f">getValue</span>()) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(question.<span style="color:#007f7f">getSortOrder</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;--------&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>题型名: 甲
</span></span><span style="display:flex;"><span>排序结果: 
</span></span><span style="display:flex;"><span>1
</span></span><span style="display:flex;"><span>--------
</span></span><span style="display:flex;"><span>题型名: 乙
</span></span><span style="display:flex;"><span>排序结果: 
</span></span><span style="display:flex;"><span>2
</span></span><span style="display:flex;"><span>5
</span></span><span style="display:flex;"><span>--------
</span></span><span style="display:flex;"><span>题型名: 丙
</span></span><span style="display:flex;"><span>排序结果: 
</span></span><span style="display:flex;"><span>3
</span></span><span style="display:flex;"><span>4
</span></span><span style="display:flex;"><span>--------
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 方法二：先分组，对分组结果进行排序</span>
</span></span><span style="display:flex;"><span>Map&lt;String, List&lt;Question&gt;&gt; groupedQuestions = questions.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">groupingBy</span>(Question::getType));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 对分组结果进行排序</span>
</span></span><span style="display:flex;"><span>LinkedHashMap&lt;String, List&lt;Question&gt;&gt; sortedGroupedQuestions = <span style="color:#fff;font-weight:bold">new</span> LinkedHashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>groupedQuestions.<span style="color:#007f7f">entrySet</span>().<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEachOrdered</span>(entry -&gt; sortedGroupedQuestions.<span style="color:#007f7f">put</span>(entry.<span style="color:#007f7f">getKey</span>(), sortBySortOrder(entry.<span style="color:#007f7f">getValue</span>())));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> List&lt;Question&gt; sortBySortOrder(List&lt;Question&gt; questions) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> questions.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">sorted</span>(Comparator.<span style="color:#007f7f">comparingInt</span>(Question::getSortOrder))
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>总结：因为<code>groupingBy</code>后，map的key是汉字，不能以自然序排序，所以这里只能根据list中的其他内容进行排序。</p>
<h2 id="collectorstomap">Collectors.toMap<a hidden class="anchor" aria-hidden="true" href="#collectorstomap">#</a></h2>
<p>我们经常会用到 List 转 Map 操作，以前我们用 for 循环遍历的方式。举个例子：<br>
先定义类：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 简单对象 </span>
</span></span><span style="display:flex;"><span>@Accessors(chain = <span style="color:#fff;font-weight:bold">true</span>) <span style="color:#007f7f">// 链式方法 </span>
</span></span><span style="display:flex;"><span>@lombok.Data
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String id;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后有这样一个 List：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;User&gt; userList = Lists.<span style="color:#007f7f">newArrayList</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> User().<span style="color:#007f7f">setId</span>(<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>).<span style="color:#007f7f">setName</span>(<span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> User().<span style="color:#007f7f">setId</span>(<span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>).<span style="color:#007f7f">setName</span>(<span style="color:#0ff;font-weight:bold">&#34;李四&#34;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> User().<span style="color:#007f7f">setId</span>(<span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>).<span style="color:#007f7f">setName</span>(<span style="color:#0ff;font-weight:bold">&#34;王五&#34;</span>)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们希望转成 Map 的格式为：<br>
A-&gt; 张三<br>
B-&gt; 李四<br>
C-&gt; 王五</p>
<p>过去的做法（循环）：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Map&lt;String, String&gt; map = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span> (User user : userList) {
</span></span><span style="display:flex;"><span>    map.<span style="color:#007f7f">put</span>(user.<span style="color:#007f7f">getId</span>(), user.<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Java8 中新增了 Stream 特性，使得我们在处理集合操作时更方便了。<br>
以上述例子为例，我们可以一行代码搞定：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>userList.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toMap</span>(User::getId, User::getName));
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然，如果希望得到 Map 的 value 为对象本身时，可以这样写：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>userList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toMap</span>(User::getId, t -&gt; t));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 或者</span>
</span></span><span style="display:flex;"><span>userList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toMap</span>(User::getId, Function.<span style="color:#007f7f">identity</span>()));
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="关于-collectorstomap-方法">关于 Collectors.toMap 方法<a hidden class="anchor" aria-hidden="true" href="#关于-collectorstomap-方法">#</a></h3>
<p>Collectors.toMap 有三个重载方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>toMap(Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">extends</span> K&gt; keyMapper, Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">extends</span> U&gt; valueMapper);
</span></span><span style="display:flex;"><span>toMap(Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">extends</span> K&gt; keyMapper, Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">extends</span> U&gt; valueMapper,
</span></span><span style="display:flex;"><span>        BinaryOperator&lt;U&gt; mergeFunction);
</span></span><span style="display:flex;"><span>toMap(Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">extends</span> K&gt; keyMapper, Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">extends</span> U&gt; valueMapper,
</span></span><span style="display:flex;"><span>        BinaryOperator&lt;U&gt; mergeFunction, Supplier&lt;M&gt; mapSupplier);
</span></span></code></pre></td></tr></table>
</div>
</div><p>参数含义分别是：<br>
keyMapper：Key 的映射函数<br>
valueMapper：Value 的映射函数<br>
mergeFunction：当 Key 冲突时，调用的合并方法<br>
mapSupplier：Map 构造器，在需要返回特定的 Map 时使用<br>
还是用上面的例子，如果 List 中 userId 有相同的，使用上面的写法会抛异常：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;User&gt; userList = Lists.<span style="color:#007f7f">newArrayList</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> User().<span style="color:#007f7f">setId</span>(<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>).<span style="color:#007f7f">setName</span>(<span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> User().<span style="color:#007f7f">setId</span>(<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>).<span style="color:#007f7f">setName</span>(<span style="color:#0ff;font-weight:bold">&#34;李四&#34;</span>), <span style="color:#007f7f">// Key 相同 </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> User().<span style="color:#007f7f">setId</span>(<span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>).<span style="color:#007f7f">setName</span>(<span style="color:#0ff;font-weight:bold">&#34;王五&#34;</span>)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>userList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toMap</span>(User::getId, User::getName));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 异常：</span>
</span></span><span style="display:flex;"><span>java.<span style="color:#007f7f">lang</span>.<span style="color:#007f7f">IllegalStateException</span>: Duplicate key 张三 
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">stream</span>.<span style="color:#007f7f">Collectors</span>.<span style="color:#007f7f">lambda$throwingMerger$114</span>(Collectors.<span style="color:#007f7f">java</span>:133)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">HashMap</span>.<span style="color:#007f7f">merge</span>(HashMap.<span style="color:#007f7f">java</span>:1245)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">stream</span>.<span style="color:#007f7f">Collectors</span>.<span style="color:#007f7f">lambda$toMap$172</span>(Collectors.<span style="color:#007f7f">java</span>:1320)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">stream</span>.<span style="color:#007f7f">ReduceOps$3ReducingSink</span>.<span style="color:#007f7f">accept</span>(ReduceOps.<span style="color:#007f7f">java</span>:169)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">ArrayList$ArrayListSpliterator</span>.<span style="color:#007f7f">forEachRemaining</span>(ArrayList.<span style="color:#007f7f">java</span>:1374)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">stream</span>.<span style="color:#007f7f">AbstractPipeline</span>.<span style="color:#007f7f">copyInto</span>(AbstractPipeline.<span style="color:#007f7f">java</span>:481)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">stream</span>.<span style="color:#007f7f">AbstractPipeline</span>.<span style="color:#007f7f">wrapAndCopyInto</span>(AbstractPipeline.<span style="color:#007f7f">java</span>:471)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">stream</span>.<span style="color:#007f7f">ReduceOps$ReduceOp</span>.<span style="color:#007f7f">evaluateSequential</span>(ReduceOps.<span style="color:#007f7f">java</span>:708)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">stream</span>.<span style="color:#007f7f">AbstractPipeline</span>.<span style="color:#007f7f">evaluate</span>(AbstractPipeline.<span style="color:#007f7f">java</span>:234)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">stream</span>.<span style="color:#007f7f">ReferencePipeline</span>.<span style="color:#007f7f">collect</span>(ReferencePipeline.<span style="color:#007f7f">java</span>:499)
</span></span><span style="display:flex;"><span>    at Test.<span style="color:#007f7f">toMap</span>(Test.<span style="color:#007f7f">java</span>:17)
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></td></tr></table>
</div>
</div><p>这时就需要调用第二个重载方法，传入合并函数，如将值拼接：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>userList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toMap</span>(User::getId, User::getName, (v1,v2) -&gt; v1+v2)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 输出结果：</span>
</span></span><span style="display:flex;"><span>A-&gt; 张三李四 
</span></span><span style="display:flex;"><span>C-&gt; 王五 
</span></span></code></pre></td></tr></table>
</div>
</div><p>或者值覆盖：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 后边的值覆盖前边的值</span>
</span></span><span style="display:flex;"><span>userList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toMap</span>(User::getId, User::getName, (v1, v2) -&gt; v2));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 前边的值覆盖后边的值</span>
</span></span><span style="display:flex;"><span>userList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toMap</span>(User::getId, User::getName, (v1, v2) -&gt; v1));
</span></span></code></pre></td></tr></table>
</div>
</div><p>第四个参数（mapSupplier）用于自定义返回 Map 类型，比如我们希望返回的 Map 是根据 Key 排序的，可以使用如下写法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;User&gt; userList = Lists.<span style="color:#007f7f">newArrayList</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> User().<span style="color:#007f7f">setId</span>(<span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>).<span style="color:#007f7f">setName</span>(<span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> User().<span style="color:#007f7f">setId</span>(<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>).<span style="color:#007f7f">setName</span>(<span style="color:#0ff;font-weight:bold">&#34;李四&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> User().<span style="color:#007f7f">setId</span>(<span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>).<span style="color:#007f7f">setName</span>(<span style="color:#0ff;font-weight:bold">&#34;王五&#34;</span>)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>userList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">collect</span>(
</span></span><span style="display:flex;"><span>    Collectors.<span style="color:#007f7f">toMap</span>(User::getId, User::getName, (n1, n2) -&gt; n1, TreeMap::<span style="color:#fff;font-weight:bold">new</span>)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 输出结果：</span>
</span></span><span style="display:flex;"><span>A-&gt; 李四 
</span></span><span style="display:flex;"><span>B-&gt; 张三 
</span></span><span style="display:flex;"><span>C-&gt; 王五 
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="java8内置的函数式接口">java8内置的函数式接口<a hidden class="anchor" aria-hidden="true" href="#java8内置的函数式接口">#</a></h1>
<p>JDK 1.8 API 包含了很多内置的函数式接口。其中就包括我们在老版本中经常见到的 Comparator 和 Runnable，Java 8 为他们都添加了 @FunctionalInterface 注解，以用来支持 Lambda 表达式。<br>
值得一提的是，除了 Comparator 和 Runnable 外，还有一些新的函数式接口，它们很多都借鉴于知名的 Google Guava 库。</p>
<h2 id="predicate断言">Predicate：断言<a hidden class="anchor" aria-hidden="true" href="#predicate断言">#</a></h2>
<p>Predicate 是一个可以指定入参类型，并返回 boolean 值的函数式接口。它内部提供了一些带有默认实现的方法，可以被用来组合一个复杂的逻辑判断（and、or、negate）：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 定义predicate，匿名实现：判断字符串长度大于0</span>
</span></span><span style="display:flex;"><span>Predicate&lt;String&gt; predicate = (s) -&gt; s.<span style="color:#007f7f">length</span>() &gt; 0;
</span></span><span style="display:flex;"><span>predicate.<span style="color:#007f7f">test</span>(<span style="color:#0ff;font-weight:bold">&#34;foo&#34;</span>);<span style="color:#007f7f">// true</span>
</span></span><span style="display:flex;"><span>predicate.<span style="color:#007f7f">negate</span>().<span style="color:#007f7f">test</span>(<span style="color:#0ff;font-weight:bold">&#34;foo&#34;</span>);<span style="color:#007f7f">// false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 定义其他predicate</span>
</span></span><span style="display:flex;"><span>Predicate&lt;Boolean&gt; nonNull = Objects::nonNull;<span style="color:#007f7f">// 非null</span>
</span></span><span style="display:flex;"><span>Predicate&lt;Boolean&gt; isNull = Objects::isNull;<span style="color:#007f7f">// null</span>
</span></span><span style="display:flex;"><span>Predicate&lt;String&gt; isEmpty = String::isEmpty;<span style="color:#007f7f">// 空串</span>
</span></span><span style="display:flex;"><span>Predicate&lt;String&gt; isNotEmpty = isEmpty.<span style="color:#007f7f">negate</span>();<span style="color:#007f7f">// 非空串</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="function">Function<a hidden class="anchor" aria-hidden="true" href="#function">#</a></h2>
<p>Function 函数式接口的作用是，我们可以为其提供一个原料，他给生产一个最终的产品。通过它提供的默认方法，组合，链行处理(compose、andThen)：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 定义Function，字符串转integer</span>
</span></span><span style="display:flex;"><span>Function&lt;String, Integer&gt; toInteger = Integer::valueOf;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 定义Function，+5</span>
</span></span><span style="display:flex;"><span>Function&lt;String, Integer&gt; integerAdd = toInteger.<span style="color:#007f7f">andThen</span>(i -&gt; i + 5);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(integerAdd.<span style="color:#007f7f">apply</span>(<span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>));<span style="color:#007f7f">// 6</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>上边通过function定义了一个链式操作<span style="color:#f00">，</span>先将传进来的参数转为integer<span style="color:#f00">，</span>然后+5<span style="color:#f00">，</span>最终结果是6<span style="color:#f00">。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="supplier生产者">Supplier：生产者<a hidden class="anchor" aria-hidden="true" href="#supplier生产者">#</a></h2>
<p>Supplier 与 Function 不同，它不接受入参，直接为我们生产一个指定的结果，有点像生产者模式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Person {
</span></span><span style="display:flex;"><span>    String firstName;
</span></span><span style="display:flex;"><span>    String lastName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Person() {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Person(String firstName, String lastName) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">firstName</span> = firstName;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">lastName</span> = lastName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Supplier&lt;Person&gt; personSupplier = Person::<span style="color:#fff;font-weight:bold">new</span>;
</span></span><span style="display:flex;"><span>personSupplier.<span style="color:#007f7f">get</span>();   <span style="color:#007f7f">// new Person</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="consumer消费者">Consumer：消费者<a hidden class="anchor" aria-hidden="true" href="#consumer消费者">#</a></h2>
<p>对于 Consumer，我们需要提供入参，用来被消费，如下面这段示例代码：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Person {
</span></span><span style="display:flex;"><span>    String firstName;
</span></span><span style="display:flex;"><span>    String lastName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Person() {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Person(String firstName, String lastName) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">firstName</span> = firstName;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">lastName</span> = lastName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Consumer&lt;Person&gt; greeter = (p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello, &#34;</span> + p.<span style="color:#007f7f">firstName</span>);
</span></span><span style="display:flex;"><span>greeter.<span style="color:#007f7f">accept</span>(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Luke&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Skywalker&#34;</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="comparator">Comparator<a hidden class="anchor" aria-hidden="true" href="#comparator">#</a></h2>
<p>Comparator 在 Java 8 之前是使用比较普遍的。Java 8 中除了将其升级成了函数式接口，还为它拓展了一些默认方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Comparator&lt;Person&gt; comparator = (p1, p2) -&gt; p1.<span style="color:#007f7f">firstName</span>.<span style="color:#007f7f">compareTo</span>(p2.<span style="color:#007f7f">firstName</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Person p1 = <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;John&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Doe&#34;</span>);
</span></span><span style="display:flex;"><span>Person p2 = <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Alice&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Wonderland&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>comparator.<span style="color:#007f7f">compare</span>(p1, p2);             <span style="color:#007f7f">// &gt; 0</span>
</span></span><span style="display:flex;"><span>comparator.<span style="color:#007f7f">reversed</span>().<span style="color:#007f7f">compare</span>(p1, p2);  <span style="color:#007f7f">// &lt; 0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="optional">Optional<a hidden class="anchor" aria-hidden="true" href="#optional">#</a></h2>
<p>首先，Optional 它不是一个函数式接口，设计它的目的是为了防止空指针异常 <code>NullPointerException</code>。<br>
让我们来快速了解一下 Optional 要如何使用！你可以将 Optional 看做是包装对象（可能是 null, 也有可能非 null）的容器。当你定义了 一个方法，这个方法返回的对象可能是空，也有可能非空的时候，你就可以考虑用 Optional 来包装它，这也是在 Java 8 被推荐使用的做法。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Optional&lt;String&gt; optional = Optional.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;bam&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>optional.<span style="color:#007f7f">isPresent</span>();           <span style="color:#007f7f">// true</span>
</span></span><span style="display:flex;"><span>optional.<span style="color:#007f7f">get</span>();                 <span style="color:#007f7f">// &#34;bam&#34;</span>
</span></span><span style="display:flex;"><span>optional.<span style="color:#007f7f">orElse</span>(<span style="color:#0ff;font-weight:bold">&#34;fallback&#34;</span>);    <span style="color:#007f7f">// &#34;bam&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>optional.<span style="color:#007f7f">ifPresent</span>((s) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(s.<span style="color:#007f7f">charAt</span>(0)));     <span style="color:#007f7f">// &#34;b&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>实际应用：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 符合条件的多个高级会员</span>
</span></span><span style="display:flex;"><span>List&lt;VipProduct&gt; products = vipMapper.<span style="color:#007f7f">productInfo</span>(vipInfoVo.<span style="color:#007f7f">getId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 筛选出每份价格最低的</span>
</span></span><span style="display:flex;"><span>Optional&lt;BigDecimal&gt; min = products.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(i -&gt; i.<span style="color:#007f7f">getUnitPrice</span>())
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">min</span>(Comparator.<span style="color:#007f7f">naturalOrder</span>());
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 判断是否存在</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (min.<span style="color:#007f7f">isPresent</span>()) {
</span></span><span style="display:flex;"><span>    BigDecimal minPrice = min.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (BigDecimal.<span style="color:#007f7f">ZERO</span>.<span style="color:#007f7f">compareTo</span>(minPrice) == 0) {
</span></span><span style="display:flex;"><span>        minPrice = <span style="color:#fff;font-weight:bold">new</span> BigDecimal(<span style="color:#0ff;font-weight:bold">&#34;0.01&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 每份低至多少元</span>
</span></span><span style="display:flex;"><span>    vipInfoVo.<span style="color:#007f7f">setCent</span>(minPrice.<span style="color:#007f7f">toString</span>());
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 默认0.1元</span>
</span></span><span style="display:flex;"><span>    vipInfoVo.<span style="color:#007f7f">setCent</span>(<span style="color:#0ff;font-weight:bold">&#34;0.1&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="stream">stream<a hidden class="anchor" aria-hidden="true" href="#stream">#</a></h1>
<p>什么是 Stream ？<br>
简单来说，我们可以使用 <code>java.util.Stream</code> 对包含多个元素的集合做各种操作。这些操作可能是<code>中间操作</code> 亦或是<code>终端操作</code>。终端操作会返回一个结果，而中间操作会返回一个 Stream 流。需要注意的是，你只能对实现了<code>java.util.Collection</code> 接口的类做流的操作。Map 不支持 Stream 流。</p>
<h2 id="filter-过滤">Filter 过滤<a hidden class="anchor" aria-hidden="true" href="#filter-过滤">#</a></h2>
<p>首先，我们创建一个 List 集合：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;String&gt; stringCollection = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>stringCollection.<span style="color:#007f7f">add</span>(<span style="color:#0ff;font-weight:bold">&#34;ddd2&#34;</span>);
</span></span><span style="display:flex;"><span>stringCollection.<span style="color:#007f7f">add</span>(<span style="color:#0ff;font-weight:bold">&#34;aaa2&#34;</span>);
</span></span><span style="display:flex;"><span>stringCollection.<span style="color:#007f7f">add</span>(<span style="color:#0ff;font-weight:bold">&#34;bbb1&#34;</span>);
</span></span><span style="display:flex;"><span>stringCollection.<span style="color:#007f7f">add</span>(<span style="color:#0ff;font-weight:bold">&#34;aaa1&#34;</span>);
</span></span><span style="display:flex;"><span>stringCollection.<span style="color:#007f7f">add</span>(<span style="color:#0ff;font-weight:bold">&#34;bbb3&#34;</span>);
</span></span><span style="display:flex;"><span>stringCollection.<span style="color:#007f7f">add</span>(<span style="color:#0ff;font-weight:bold">&#34;ccc&#34;</span>);
</span></span><span style="display:flex;"><span>stringCollection.<span style="color:#007f7f">add</span>(<span style="color:#0ff;font-weight:bold">&#34;bbb2&#34;</span>);
</span></span><span style="display:flex;"><span>stringCollection.<span style="color:#007f7f">add</span>(<span style="color:#0ff;font-weight:bold">&#34;ddd1&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>Filter 的入参是一个 Predicate，上面已经说到，Predicate 是一个断言的中间操作，它能够帮我们筛选出我们需要的集合元素。它的返参同样 是一个 Stream 流，我们可以通过 foreach 终端操作，来打印被筛选的元素：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>stringCollection
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>((s) -&gt; s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// &#34;aaa2&#34;, &#34;aaa1&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：foreach 是一个终端操作，它的返参是 void，无法对其再次进行流操作。</p>
<h2 id="sorted-排序">Sorted 排序<a hidden class="anchor" aria-hidden="true" href="#sorted-排序">#</a></h2>
<p>Sorted 同样是一个中间操作，它的返参是一个 Stream 流。另外，我们可以传入一个 Comparator 用来自定义排序，如果不传，则使用默认的排序规则。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>stringCollection
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">sorted</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>((s) -&gt; s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// &#34;aaa1&#34;, &#34;aaa2&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>需要注意，sorted 不会对 stringCollection 做出任何改变，stringCollection 还是原有的那些个元素，且顺序不变：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(stringCollection);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ddd2, aaa2, bbb1, aaa1, bbb3, ccc, bbb2, ddd1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="map-转换">Map 转换<a hidden class="anchor" aria-hidden="true" href="#map-转换">#</a></h2>
<p>中间操作 Map 能够帮助我们将 List 中的每一个元素做功能处理。例如下面的示例，通过 map 我们将每一个 string 转成大写：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>stringCollection
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(String::toUpperCase)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">sorted</span>((a, b) -&gt; b.<span style="color:#007f7f">compareTo</span>(a))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// &#34;DDD2&#34;, &#34;DDD1&#34;, &#34;CCC&#34;, &#34;BBB3&#34;, &#34;BBB2&#34;, &#34;AAA2&#34;, &#34;AAA1&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="match-匹配">Match 匹配<a hidden class="anchor" aria-hidden="true" href="#match-匹配">#</a></h2>
<p>顾名思义，match 用来做匹配操作，它的返回值是一个 boolean 类型。通过 match，我们可以方便的验证一个 list 中是否存在某个类型的元素。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 验证 list 中 string 是否有以 a 开头的, 匹配到第一个，即返回 true</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">boolean</span> anyStartsWithA =
</span></span><span style="display:flex;"><span>    stringCollection
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">anyMatch</span>((s) -&gt; s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(anyStartsWithA);      <span style="color:#007f7f">// true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 验证 list 中 string 是否都是以 a 开头的</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">boolean</span> allStartsWithA =
</span></span><span style="display:flex;"><span>    stringCollection
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">allMatch</span>((s) -&gt; s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(allStartsWithA);      <span style="color:#007f7f">// false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 验证 list 中 string 是否都不是以 z 开头的,</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">boolean</span> noneStartsWithZ =
</span></span><span style="display:flex;"><span>    stringCollection
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">noneMatch</span>((s) -&gt; s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;z&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(noneStartsWithZ);      <span style="color:#007f7f">// true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="count-计数">Count 计数<a hidden class="anchor" aria-hidden="true" href="#count-计数">#</a></h2>
<p>count 是一个终端操作，它能够统计 stream 流中的元素总数，返回值是 long 类型。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 先对 list 中字符串开头为 b 进行过滤，然后统计数量</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">long</span> startsWithB =
</span></span><span style="display:flex;"><span>    stringCollection
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>((s) -&gt; s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;b&#34;</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">count</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(startsWithB);<span style="color:#007f7f">// 3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="reduce">Reduce<a hidden class="anchor" aria-hidden="true" href="#reduce">#</a></h2>
<p>Reduce 中文翻译为：减少、缩小。通过入参的 Function，我们能够将 list 归约成一个值。它的返回类型是 Optional 类型。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Optional&lt;String&gt; reduced =
</span></span><span style="display:flex;"><span>    stringCollection
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">sorted</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">reduce</span>((s1, s2) -&gt; s1 + <span style="color:#0ff;font-weight:bold">&#34;#&#34;</span> + s2);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>reduced.<span style="color:#007f7f">ifPresent</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// &#34;aaa1#aaa2#bbb1#bbb2#bbb3#ccc#ddd1#ddd2&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="parallel-streams-并行流">Parallel-Streams 并行流<a hidden class="anchor" aria-hidden="true" href="#parallel-streams-并行流">#</a></h2>
<p>stream 流是支持顺序和并行的。顺序流操作是单线程操作，而并行流是通过多线程来处理的，能够充分利用物理机多核CPU 的优势，同时处理速度更快。<br>
首先，我们创建一个包含 1000000 UUID list 集合。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> max = 1000000;
</span></span><span style="display:flex;"><span>List&lt;String&gt; values = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;(max);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; max; i++) {
</span></span><span style="display:flex;"><span>    UUID uuid = UUID.<span style="color:#007f7f">randomUUID</span>();
</span></span><span style="display:flex;"><span>    values.<span style="color:#007f7f">add</span>(uuid.<span style="color:#007f7f">toString</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>分别通过顺序流和并行流，对这个 list 进行排序，测算耗时：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 开始时间</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">long</span> startTime = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//串行</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//long count = values.stream().sorted().count();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//并行</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">long</span> count = values.<span style="color:#007f7f">parallelStream</span>().<span style="color:#007f7f">sorted</span>().<span style="color:#007f7f">count</span>();
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(count);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 结束时间</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">long</span> endTime = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(String.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;排序耗时: %d ms&#34;</span>, endTime - startTime));
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 串行排序耗时: 505 ms</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 并行排序耗时: 302 ms</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>同样的逻辑处理，通过并行流，我们的性能提升了近 50%。完成这一切，我们需要做的仅仅是将 stream 改成了 parallelStream。</p>
<h2 id="map-集合">Map 集合<a hidden class="anchor" aria-hidden="true" href="#map-集合">#</a></h2>
<p>前面已经提到过 Map 是不支持 Stream 流的，因为 Map 接口并没有像 Collection 接口那样，定义了 stream() 方法。但是，我们可以对其 key、values、entry 使用流操作，如 <code>map.keySet().stream()</code>、<code>map.values().stream()</code> 和 <code>map.entrySet().stream()</code>。<br>
另外，JDK 8 中对 map 提供了一些其他新特性：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Map&lt;Integer, String&gt; map = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//putIfAbent()：put 之前，先判断 key 是否存在，</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// - 如果key存在，则直接返回 value</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// - 如果key不存在，则 put, 再返回 value</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(map.<span style="color:#007f7f">putIfAbsent</span>(1, <span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>));<span style="color:#007f7f">// null</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(map.<span style="color:#007f7f">putIfAbsent</span>(1, <span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>));<span style="color:#007f7f">// a</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// forEach 可以很方便地对 map 进行遍历操作</span>
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">forEach</span>((key, value) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(value));
</span></span></code></pre></td></tr></table>
</div>
</div><p>除了上面的 <code>putIfAbsent()</code> 和 <code>forEach()</code> 外，我们还可以很方便地对某个 key 的值做相关操作：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// computeIfPresent(), 当 key 存在时，才会做相关处理</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 如下：对 key 为 3 的值，内部会先判断值是否存在，存在，则做 value + key 的拼接操作</span>
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">put</span>(3,<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>);
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">computeIfPresent</span>(3, (k, v) -&gt; k + v);
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">get</span>(3);<span style="color:#007f7f">// 3a</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 先判断 key 为 9 的元素是否存在，存在，则做删除操作</span>
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">computeIfPresent</span>(9, (k, v) -&gt; <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(map.<span style="color:#007f7f">containsKey</span>(9));<span style="color:#007f7f">// false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// computeIfAbsent(), 当 key 不存在时，才会做相关处理</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 如下：先判断 key 为 23 的元素是否存在，不存在，则添加23,并设置value</span>
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">computeIfAbsent</span>(23, num -&gt; <span style="color:#0ff;font-weight:bold">&#34;23存在&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(map.<span style="color:#007f7f">get</span>(23));<span style="color:#007f7f">// true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>关于删除操作，JDK 8 中提供了新的 <code>remove()</code> API：<br>
只有当给定的 key 和 value 完全匹配时，才会执行删除操作。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>map.<span style="color:#007f7f">put</span>(3,<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">remove</span>(3, <span style="color:#0ff;font-weight:bold">&#34;abc&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(map.<span style="color:#007f7f">get</span>(3));<span style="color:#007f7f">// a</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">remove</span>(3, <span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(map.<span style="color:#007f7f">get</span>(3));<span style="color:#007f7f">// null</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>关于添加方法，JDK 8 中提供了带有默认值的 <code>getOrDefault()</code> 方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 若 key 42 不存在，则返回 not found</span>
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">getOrDefault</span>(42, <span style="color:#0ff;font-weight:bold">&#34;not found&#34;</span>);  <span style="color:#007f7f">// not found</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>对于 value 的合并操作也变得更加简单：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// merge 方法，会先判断进行合并的 key 是否存在，不存在，则会添加元素</span>
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">merge</span>(9, <span style="color:#0ff;font-weight:bold">&#34;val9&#34;</span>, (value, newValue) -&gt; value.<span style="color:#007f7f">concat</span>(newValue));
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">get</span>(9);             <span style="color:#007f7f">// val9</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 若 key 的元素存在，则对 value 执行拼接操作</span>
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">merge</span>(9, <span style="color:#0ff;font-weight:bold">&#34;concat&#34;</span>, (value, newValue) -&gt; value.<span style="color:#007f7f">concat</span>(newValue));
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">get</span>(9);             <span style="color:#007f7f">// val9concat</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="stream-的处理顺序">Stream 的处理顺序<a hidden class="anchor" aria-hidden="true" href="#stream-的处理顺序">#</a></h2>
<p>中间操作的有个重要特性 —— 延迟性。观察下面这个没有终端操作的示例代码：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;d2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;filter: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    });
</span></span></code></pre></td></tr></table>
</div>
</div><p>这段代码不会打印任何内容，是不是很奇怪。为什么呢？<br>
原因是：当且仅当存在终端操作时，中间操作操作才会被执行。<br>
是不是不信？接下来，对上面的代码添加 forEach终端操作：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;d2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;filter: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(s -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;forEach: &#34;</span> + s));
</span></span></code></pre></td></tr></table>
</div>
</div><p>再次执行，我们会看到输出如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>filter:  d2
</span></span><span style="display:flex;"><span>forEach: d2
</span></span><span style="display:flex;"><span>filter:  a2
</span></span><span style="display:flex;"><span>forEach: a2
</span></span><span style="display:flex;"><span>filter:  b1
</span></span><span style="display:flex;"><span>forEach: b1
</span></span><span style="display:flex;"><span>filter:  b3
</span></span><span style="display:flex;"><span>forEach: b3
</span></span><span style="display:flex;"><span>filter:  c
</span></span><span style="display:flex;"><span>forEach: c
</span></span></code></pre></td></tr></table>
</div>
</div><p>是不是很奇怪，不是应该先将所有 filter 前缀的字符串打印出来，接着才会打印 forEach 前缀的字符串么？事实上，输出的结果却是随着链条垂直移动的。比如说，当 Stream 开始处理 d2 元素时，它实际上会在执行完 filter 操作后，再执行 forEach 操作，接着才会处理第二个元素。为什么要设计成这样呢？原因是出于性能的考虑。这样设计可以减少对每个元素的实际操作数，看完下面代码你就明白了：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;d2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;map: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">toUpperCase</span>(); <span style="color:#007f7f">// 转大写</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">anyMatch</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;anyMatch: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>); <span style="color:#007f7f">// 过滤出以 A 为前缀的元素</span>
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// map:      d2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// anyMatch: D2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// map:      a2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// anyMatch: A2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>终端操作 anyMatch()表示任何一个元素以 A 为前缀，返回为 true，就停止循环。所以它会从 d2 开始匹配，接着循环到 a2 的时候，返回为 true ，于是停止循环。<br>
由于数据流的链式调用是垂直执行的，map这里只需要执行两次。相对于水平执行来说，map会执行尽可能少的次数，而不是把所有元素都 map 转换一遍。</p>
<h2 id="中间操作的顺序">中间操作的顺序<a hidden class="anchor" aria-hidden="true" href="#中间操作的顺序">#</a></h2>
<p>下面的例子由两个中间操作map和filter，以及一个终端操作forEach组成。让我们再来看看这些操作是如何执行的：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;d2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;map: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">toUpperCase</span>(); <span style="color:#007f7f">// 转大写</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;filter: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>); <span style="color:#007f7f">// 过滤出以 A 为前缀的元素</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(s -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;forEach: &#34;</span> + s)); <span style="color:#007f7f">// for 循环输出</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// map:     d2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  D2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// map:     a2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  A2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// forEach: A2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// map:     b1</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  B1</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// map:     b3</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  B3</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// map:     c</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  C</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>学习了上面一小节，您应该已经知道了，map和filter会对集合中的每个字符串调用五次，而forEach却只会调用一次，因为只有 &ldquo;a2&rdquo; 满足过滤条件。<br>
如果我们改变中间操作的顺序，将filter移动到链头的最开始，就可以大大减少实际的执行次数：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;d2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;filter: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>); <span style="color:#007f7f">// 过滤出以 a 为前缀的元素</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;map: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">toUpperCase</span>(); <span style="color:#007f7f">// 转大写</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(s -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;forEach: &#34;</span> + s)); <span style="color:#007f7f">// for 循环输出</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  d2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  a2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// map:     a2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// forEach: A2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  b1</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  b3</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  c</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在，map仅仅只需调用一次，性能得到了提升，这种小技巧对于流中存在大量元素来说，是非常很有用的。<br>
接下来，让我们对上面的代码再添加一个中间操作sorted：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;d2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">sorted</span>((s1, s2) -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;sort: %s; %s\n&#34;</span>, s1, s2);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s1.<span style="color:#007f7f">compareTo</span>(s2); <span style="color:#007f7f">// 排序</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;filter: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>); <span style="color:#007f7f">// 过滤出以 a 为前缀的元素</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;map: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">toUpperCase</span>(); <span style="color:#007f7f">// 转大写</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(s -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;forEach: &#34;</span> + s)); <span style="color:#007f7f">// for 循环输出</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>sorted 是一个有状态的操作，因为它需要在处理的过程中，保存状态以对集合中的元素进行排序。<br>
执行上面代码，输出如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>sort:    a2; d2
</span></span><span style="display:flex;"><span>sort:    b1; a2
</span></span><span style="display:flex;"><span>sort:    b1; d2
</span></span><span style="display:flex;"><span>sort:    b1; a2
</span></span><span style="display:flex;"><span>sort:    b3; b1
</span></span><span style="display:flex;"><span>sort:    b3; d2
</span></span><span style="display:flex;"><span>sort:    c; b3
</span></span><span style="display:flex;"><span>sort:    c; d2
</span></span><span style="display:flex;"><span>filter:  a2
</span></span><span style="display:flex;"><span>map:     a2
</span></span><span style="display:flex;"><span>forEach: A2
</span></span><span style="display:flex;"><span>filter:  b1
</span></span><span style="display:flex;"><span>filter:  b3
</span></span><span style="display:flex;"><span>filter:  c
</span></span><span style="display:flex;"><span>filter:  d2
</span></span></code></pre></td></tr></table>
</div>
</div><p>咦？这次怎么又不是垂直执行了。你需要知道的是，sorted是水平执行的。因此，在这种情况下，sorted会对集合中的元素组合调用八次。这里，我们也可以利用上面说道的优化技巧，将 filter 过滤中间操作移动到开头部分：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;d2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;filter: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>);
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">sorted</span>((s1, s2) -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">printf</span>(<span style="color:#0ff;font-weight:bold">&#34;sort: %s; %s\n&#34;</span>, s1, s2);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s1.<span style="color:#007f7f">compareTo</span>(s2);
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;map: &#34;</span> + s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">toUpperCase</span>();
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(s -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;forEach: &#34;</span> + s));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  d2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  a2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  b1</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  b3</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// filter:  c</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// map:     a2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// forEach: A2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>从上面的输出中，我们看到了 sorted从未被调用过，因为经过filter过后的元素已经减少到只有一个，这种情况下，是不用执行排序操作的。因此性能被大大提高了。</p>
<h2 id="数据流复用问题">数据流复用问题<a hidden class="anchor" aria-hidden="true" href="#数据流复用问题">#</a></h2>
<p>Java8 Stream 流是不能被复用的，一旦你调用任何终端操作，流就会关闭：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Stream&lt;String&gt; stream =
</span></span><span style="display:flex;"><span>    Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;d2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">filter</span>(s -&gt; s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stream.<span style="color:#007f7f">anyMatch</span>(s -&gt; <span style="color:#fff;font-weight:bold">true</span>);    <span style="color:#007f7f">// ok</span>
</span></span><span style="display:flex;"><span>stream.<span style="color:#007f7f">noneMatch</span>(s -&gt; <span style="color:#fff;font-weight:bold">true</span>);   <span style="color:#007f7f">// exception</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当我们对 stream 调用了 anyMatch 终端操作以后，流即关闭了，再调用 noneMatch 就会抛出异常：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>java.<span style="color:#007f7f">lang</span>.<span style="color:#007f7f">IllegalStateException</span>: stream has already been operated upon or closed
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">stream</span>.<span style="color:#007f7f">AbstractPipeline</span>.<span style="color:#007f7f">evaluate</span>(AbstractPipeline.<span style="color:#007f7f">java</span>:229)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">stream</span>.<span style="color:#007f7f">ReferencePipeline</span>.<span style="color:#007f7f">noneMatch</span>(ReferencePipeline.<span style="color:#007f7f">java</span>:459)
</span></span><span style="display:flex;"><span>    at com.<span style="color:#007f7f">winterbe</span>.<span style="color:#007f7f">java8</span>.<span style="color:#007f7f">Streams5</span>.<span style="color:#007f7f">test7</span>(Streams5.<span style="color:#007f7f">java</span>:38)
</span></span><span style="display:flex;"><span>    at com.<span style="color:#007f7f">winterbe</span>.<span style="color:#007f7f">java8</span>.<span style="color:#007f7f">Streams5</span>.<span style="color:#007f7f">main</span>(Streams5.<span style="color:#007f7f">java</span>:28)
</span></span></code></pre></td></tr></table>
</div>
</div><p>为了克服这个限制，我们必须为我们想要执行的每个终端操作创建一个新的流链，例如，我们可以通过 Supplier 来包装一下流，通过 get() 方法来构建一个新的 Stream 流，如下所示：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Supplier&lt;Stream&lt;String&gt;&gt; streamSupplier =
</span></span><span style="display:flex;"><span>    () -&gt; Stream.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;d2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(s -&gt; s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>streamSupplier.<span style="color:#007f7f">get</span>().<span style="color:#007f7f">anyMatch</span>(s -&gt; <span style="color:#fff;font-weight:bold">true</span>);   <span style="color:#007f7f">// ok</span>
</span></span><span style="display:flex;"><span>streamSupplier.<span style="color:#007f7f">get</span>().<span style="color:#007f7f">noneMatch</span>(s -&gt; <span style="color:#fff;font-weight:bold">true</span>);  <span style="color:#007f7f">// ok</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过构造一个新的流，来避开流不能被复用的限制，这也是取巧的一种方式。</p>
<h2 id="高级操作">高级操作<a hidden class="anchor" aria-hidden="true" href="#高级操作">#</a></h2>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">参考官方文档</a><br>
本小节中的大多数代码示例均会使用以下 <code>List&lt;Person&gt;</code>进行演示：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Person {
</span></span><span style="display:flex;"><span>    String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> age;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Person(String name, <span style="color:#fff;font-weight:bold">int</span> age) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">age</span> = age;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String toString() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 构建一个 Person 集合</span>
</span></span><span style="display:flex;"><span>List&lt;Person&gt; persons =
</span></span><span style="display:flex;"><span>    Arrays.<span style="color:#007f7f">asList</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Max&#34;</span>, 18),
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Peter&#34;</span>, 23),
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Pamela&#34;</span>, 23),
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;David&#34;</span>, 12));
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="collect">Collect<a hidden class="anchor" aria-hidden="true" href="#collect">#</a></h3>
<p>collect 是一个非常有用的终端操作，它可以将流中的元素转变成另外一个不同的对象，例如一个List，Set或Map。collect 接受入参为Collector（收集器），它由四个不同的操作组成：供应器（supplier）、累加器（accumulator）、组合器（combiner）和终止器（finisher）。<br>
这些都是个啥？别慌，看上去非常复杂的样子，但好在大多数情况下，您并不需要自己去实现收集器。因为 Java 8通过Collectors类内置了各种常用的收集器，你直接拿来用就行了。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Person&gt; filtered =
</span></span><span style="display:flex;"><span>    persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>() <span style="color:#007f7f">// 构建流</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(p -&gt; p.<span style="color:#007f7f">name</span>.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;P&#34;</span>)) <span style="color:#007f7f">// 过滤出名字以 P 开头的</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>()); <span style="color:#007f7f">// 生成一个新的 List</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(filtered);    <span style="color:#007f7f">// [Peter, Pamela]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>你也看到了，从流中构造一个 List 异常简单。如果说你需要构造一个 Set 集合，只需要使用<code>Collectors.toSet()</code>就可以了。</p>
<p>下面按年龄对所有人进行分组：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Map&lt;Integer, List&lt;Person&gt;&gt; personsByAge = persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">groupingBy</span>(p -&gt; p.<span style="color:#007f7f">age</span>)); <span style="color:#007f7f">// 以年龄为 key,进行分组</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>personsByAge.<span style="color:#007f7f">forEach</span>((age, p) -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;age %s: %s\n&#34;</span>, age, p));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// age 18: [Max]</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// age 23: [Peter, Pamela]</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// age 12: [David]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行聚合操作，例如，计算所有人的平均年龄：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Double averageAge = persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">averagingInt</span>(p -&gt; p.<span style="color:#007f7f">age</span>)); <span style="color:#007f7f">// 聚合出平均年龄</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(averageAge);     <span style="color:#007f7f">// 19.0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果您还想得到一个更全面的统计信息，摘要收集器可以返回一个特殊的内置统计对象。通过它，我们可以简单地计算出最小年龄、最大年龄、平均年龄、总和以及总数量。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>IntSummaryStatistics ageSummary =
</span></span><span style="display:flex;"><span>    persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">summarizingInt</span>(p -&gt; p.<span style="color:#007f7f">age</span>)); <span style="color:#007f7f">// 生成摘要统计</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(ageSummary);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// IntSummaryStatistics{count=4, sum=76, min=12, average=19.000000, max=23}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>将所有人名连接成一个字符串：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String phrase = persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(p -&gt; p.<span style="color:#007f7f">age</span> &gt;= 18) <span style="color:#007f7f">// 过滤出年龄大于等于18的</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(p -&gt; p.<span style="color:#007f7f">name</span>) <span style="color:#007f7f">// 提取名字</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 以 In Germany 开头，and 连接各元素，再以 are of legal age. 结束</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">joining</span>(<span style="color:#0ff;font-weight:bold">&#34; and &#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;In Germany &#34;</span>, <span style="color:#0ff;font-weight:bold">&#34; are of legal age.&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(phrase);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// In Germany Max and Peter and Pamela are of legal age.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>将流转换为 Map集合，必须指定 Map 的键和值。这里需要注意，Map 的键必须是唯一的，否则会抛出IllegalStateException 异常。<br>
你可以选择传递一个合并函数作为额外的参数来避免发生这个异常：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Map&lt;Integer, String&gt; map = persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toMap</span>(
</span></span><span style="display:flex;"><span>        p -&gt; p.<span style="color:#007f7f">age</span>,
</span></span><span style="display:flex;"><span>        p -&gt; p.<span style="color:#007f7f">name</span>,
</span></span><span style="display:flex;"><span>        (name1, name2) -&gt; name1 + <span style="color:#0ff;font-weight:bold">&#34;;&#34;</span> + name2)); <span style="color:#007f7f">// 对于同样 key 的，将值拼接</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(map);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// {18=Max, 23=Peter;Pamela, 12=David}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>尝试构建自定义收集器。比如说，我们希望将流中的所有人转换成一个字符串，包含所有大写的名称，并以|分割。为了达到这种效果，我们需要通过Collector.of()创建一个新的收集器。同时，我们还需要传入收集器的四个组成部分：供应器、累加器、组合器和终止器。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Collector&lt;Person, StringJoiner, String&gt; personNameCollector =
</span></span><span style="display:flex;"><span>    Collector.<span style="color:#007f7f">of</span>(
</span></span><span style="display:flex;"><span>    () -&gt; <span style="color:#fff;font-weight:bold">new</span> StringJoiner(<span style="color:#0ff;font-weight:bold">&#34; | &#34;</span>),          <span style="color:#007f7f">// supplier 供应器</span>
</span></span><span style="display:flex;"><span>    (j, p) -&gt; j.<span style="color:#007f7f">add</span>(p.<span style="color:#007f7f">name</span>.<span style="color:#007f7f">toUpperCase</span>()),  <span style="color:#007f7f">// accumulator 累加器</span>
</span></span><span style="display:flex;"><span>    (j1, j2) -&gt; j1.<span style="color:#007f7f">merge</span>(j2),               <span style="color:#007f7f">// combiner 组合器</span>
</span></span><span style="display:flex;"><span>    StringJoiner::toString);                <span style="color:#007f7f">// finisher 终止器</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>String names = persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">collect</span>(personNameCollector); <span style="color:#007f7f">// 传入自定义的收集器</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(names);  <span style="color:#007f7f">// MAX | PETER | PAMELA | DAVID</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于Java 中的字符串是 final 类型的，我们需要借助辅助类StringJoiner，来帮我们构造字符串。<br>
最开始供应器使用分隔符构造了一个StringJointer。<br>
累加器用于将每个人的人名转大写，然后加到StringJointer中。<br>
组合器将两个StringJointer合并为一个。<br>
最终，终结器从StringJointer构造出预期的字符串。</p>
<h3 id="flatmap-1">FlatMap<a hidden class="anchor" aria-hidden="true" href="#flatmap-1">#</a></h3>
<p>上面我们已经学会了如通过map操作，将流中的对象转换为另一种类型。但是，Map只能将每个对象映射到另一个对象。如果说，我们想要将一个对象转换为多个其他对象或者根本不做转换操作呢？这个时候，flatMap就派上用场了。</p>
<p>FlatMap 能够将流的每个元素，转换为其他对象的流。因此，每个对象可以被转换为零个，一个或多个其他对象，并以流的方式返回。之后，这些流的内容会被放入flatMap返回的流中。<br>
在学习如何实际操作flatMap之前，我们先新建两个类，用来测试：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Foo {
</span></span><span style="display:flex;"><span>    String name;
</span></span><span style="display:flex;"><span>    List&lt;Bar&gt; bars = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Foo(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Bar {
</span></span><span style="display:flex;"><span>    String name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Bar(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来，通过我们上面学习到的流知识，来实例化一些对象：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Foo&gt; foos = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 创建 foos 集合</span>
</span></span><span style="display:flex;"><span>IntStream
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">range</span>(1, 4)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(i -&gt; foos.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> Foo(<span style="color:#0ff;font-weight:bold">&#34;Foo&#34;</span> + i)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 创建 bars 集合</span>
</span></span><span style="display:flex;"><span>foos.<span style="color:#007f7f">forEach</span>(f -&gt;
</span></span><span style="display:flex;"><span>             IntStream.<span style="color:#007f7f">range</span>(1, 4)
</span></span><span style="display:flex;"><span>             .<span style="color:#007f7f">forEach</span>(i -&gt; f.<span style="color:#007f7f">bars</span>.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> Bar(<span style="color:#0ff;font-weight:bold">&#34;Bar&#34;</span> + i + <span style="color:#0ff;font-weight:bold">&#34; &lt;- &#34;</span> + f.<span style="color:#007f7f">name</span>))));
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们创建了包含三个foo的集合，每个foo中又包含三个 bar。<br>
flatMap 的入参接受一个返回对象流的函数。为了处理每个foo中的bar，我们需要传入相应 stream 流：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>foos.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">flatMap</span>(f -&gt; f.<span style="color:#007f7f">bars</span>.<span style="color:#007f7f">stream</span>())
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(b -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(b.<span style="color:#007f7f">name</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Bar1 &lt;- Foo1</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Bar2 &lt;- Foo1</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Bar3 &lt;- Foo1</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Bar1 &lt;- Foo2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Bar2 &lt;- Foo2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Bar3 &lt;- Foo2</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Bar1 &lt;- Foo3</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Bar2 &lt;- Foo3</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Bar3 &lt;- Foo3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如上所示，我们已成功将三个 foo对象的流转换为九个bar对象的流。<br>
最后，上面的这段代码可以简化为单一的流式操作：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>IntStream.<span style="color:#007f7f">range</span>(1, 4)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">mapToObj</span>(i -&gt; <span style="color:#fff;font-weight:bold">new</span> Foo(<span style="color:#0ff;font-weight:bold">&#34;Foo&#34;</span> + i))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">peek</span>(f -&gt; IntStream.<span style="color:#007f7f">range</span>(1, 4)
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">mapToObj</span>(i -&gt; <span style="color:#fff;font-weight:bold">new</span> Bar(<span style="color:#0ff;font-weight:bold">&#34;Bar&#34;</span> + i + <span style="color:#0ff;font-weight:bold">&#34; &lt;- &#34;</span> f.<span style="color:#007f7f">name</span>))
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">forEach</span>(f.<span style="color:#007f7f">bars</span>::add))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">flatMap</span>(f -&gt; f.<span style="color:#007f7f">bars</span>.<span style="color:#007f7f">stream</span>())
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(b -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(b.<span style="color:#007f7f">name</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><p>flatMap也可用于Java8引入的Optional类。Optional的flatMap操作返回一个Optional或其他类型的对象。所以它可以用于避免繁琐的null检查。<br>
接下来，让我们创建层次更深的对象：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Outer {
</span></span><span style="display:flex;"><span>    Nested nested;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Nested {
</span></span><span style="display:flex;"><span>    Inner inner;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Inner {
</span></span><span style="display:flex;"><span>    String foo;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>为了处理从 Outer 对象中获取最底层的 foo 字符串，你需要添加多个null检查来避免可能发生的NullPointerException，如下所示：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Outer outer = <span style="color:#fff;font-weight:bold">new</span> Outer();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (outer != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; outer.<span style="color:#007f7f">nested</span> != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; outer.<span style="color:#007f7f">nested</span>.<span style="color:#007f7f">inner</span> != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(outer.<span style="color:#007f7f">nested</span>.<span style="color:#007f7f">inner</span>.<span style="color:#007f7f">foo</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们还可以使用Optional的flatMap操作，来完成上述相同功能的判断，且更加优雅：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Optional.<span style="color:#007f7f">of</span>(<span style="color:#fff;font-weight:bold">new</span> Outer())
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">flatMap</span>(o -&gt; Optional.<span style="color:#007f7f">ofNullable</span>(o.<span style="color:#007f7f">nested</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">flatMap</span>(n -&gt; Optional.<span style="color:#007f7f">ofNullable</span>(n.<span style="color:#007f7f">inner</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">flatMap</span>(i -&gt; Optional.<span style="color:#007f7f">ofNullable</span>(i.<span style="color:#007f7f">foo</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">ifPresent</span>(System.<span style="color:#007f7f">out</span>::println);
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果不为空的话，每个flatMap的调用都会返回预期对象的Optional包装，否则返回为null的Optional包装类。</p>
<h3 id="reduce-1">Reduce<a hidden class="anchor" aria-hidden="true" href="#reduce-1">#</a></h3>
<p>规约操作可以将流的所有元素组合成一个结果。Java 8 支持三种不同的reduce方法。第一种将流中的元素规约成流中的一个元素。让我们看看如何使用这种方法，来筛选出年龄最大的那个人：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">reduce</span>((p1, p2) -&gt; p1.<span style="color:#007f7f">age</span> &gt; p2.<span style="color:#007f7f">age</span> ? p1 : p2)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">ifPresent</span>(System.<span style="color:#007f7f">out</span>::println);    <span style="color:#007f7f">// Pamela</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>reduce方法接受 <code>BinaryOperator</code> 积累函数。该函数实际上是两个操作数类型相同的 <code>BiFunction</code>。<code>BiFunction</code> 功能和Function一样，但是它接受两个参数。示例代码中，我们比较两个人的年龄，来返回年龄较大的人。<br>
第二种reduce方法接受标识值和 <code>BinaryOperator</code> 累加器。此方法可用于构造一个新的 Person，其中包含来自流中所有其他人的聚合名称和年龄：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Person result =
</span></span><span style="display:flex;"><span>    persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">reduce</span>(<span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>, 0), (p1, p2) -&gt; {
</span></span><span style="display:flex;"><span>        p1.<span style="color:#007f7f">age</span> += p2.<span style="color:#007f7f">age</span>;
</span></span><span style="display:flex;"><span>        p1.<span style="color:#007f7f">name</span> += p2.<span style="color:#007f7f">name</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> p1;
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;name=%s; age=%s&#34;</span>, result.<span style="color:#007f7f">name</span>, result.<span style="color:#007f7f">age</span>);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// name=MaxPeterPamelaDavid; age=76</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>第三种reduce方法接受三个参数：标识值，BiFunction累加器和类型的组合器函数BinaryOperator。由于初始值的类型不一定为Person，我们可以使用这个归约函数来计算所有人的年龄总和：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Integer ageSum = persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">reduce</span>(0, (sum, p) -&gt; sum += p.<span style="color:#007f7f">age</span>, (sum1, sum2) -&gt; sum1 + sum2);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(ageSum);  <span style="color:#007f7f">// 76</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果为76，但是内部究竟发生了什么呢？让我们再打印一些调试日志：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Integer ageSum = persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">reduce</span>(0,
</span></span><span style="display:flex;"><span>            (sum, p) -&gt; {
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;accumulator: sum=%s; person=%s\n&#34;</span>, sum, p);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> sum += p.<span style="color:#007f7f">age</span>;
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            (sum1, sum2) -&gt; {
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;combiner: sum1=%s; sum2=%s\n&#34;</span>, sum1, sum2);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> sum1 + sum2;
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// accumulator: sum=0; person=Max</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// accumulator: sum=18; person=Peter</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// accumulator: sum=41; person=Pamela</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// accumulator: sum=64; person=David</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>你可以看到，累加器函数完成了所有工作。它首先使用初始值0和第一个人年龄相加。接下来的三步中sum会持续增加，直到76。<br>
等等？好像哪里不太对！组合器从来都没有调用过啊？<br>
我们以并行流的方式运行上面的代码，看看日志输出：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Integer ageSum = persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">parallelStream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">reduce</span>(0,
</span></span><span style="display:flex;"><span>        (sum, p) -&gt; {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;accumulator: sum=%s; person=%s\n&#34;</span>, sum, p);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> sum += p.<span style="color:#007f7f">age</span>;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        (sum1, sum2) -&gt; {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;combiner: sum1=%s; sum2=%s\n&#34;</span>, sum1, sum2);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> sum1 + sum2;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// accumulator: sum=0; person=Pamela</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// accumulator: sum=0; person=David</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// accumulator: sum=0; person=Max</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// accumulator: sum=0; person=Peter</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// combiner: sum1=18; sum2=23</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// combiner: sum1=23; sum2=12</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// combiner: sum1=41; sum2=35</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>并行流的执行方式完全不同。这里组合器被调用了。实际上，由于累加器被并行调用，组合器需要被用于计算部分累加值的总和。让我们在下一章深入探讨并行流。</p>
<h3 id="并行流">并行流<a hidden class="anchor" aria-hidden="true" href="#并行流">#</a></h3>
<p>流是可以并行执行的，当流中存在大量元素时，可以显著提升性能。并行流底层使用的ForkJoinPool, 它由ForkJoinPool.commonPool()方法提供。底层线程池的大小最多为五个 - 具体取决于 CPU 可用核心数：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ForkJoinPool commonPool = ForkJoinPool.<span style="color:#007f7f">commonPool</span>();
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(commonPool.<span style="color:#007f7f">getParallelism</span>());    <span style="color:#007f7f">// 7</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在我的机器上，公共池初始化默认值为 7。你也可以通过设置以下JVM参数可以减小或增加此值：<br>
<code>-Djava.util.concurrent.ForkJoinPool.common.parallelism=5</code></p>
<p>集合支持parallelStream()方法来创建元素的并行流。或者你可以在已存在的数据流上调用中间方法parallel()，将串行流转换为并行流，这也是可以的。<br>
为了详细了解并行流的执行行为，我们在下面的示例代码中，打印当前线程的信息：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">asList</span>(<span style="color:#0ff;font-weight:bold">&#34;a1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c1&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">parallelStream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;filter: %s [%s]\n&#34;</span>,
</span></span><span style="display:flex;"><span>            s, Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;map: %s [%s]\n&#34;</span>,
</span></span><span style="display:flex;"><span>            s, Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">toUpperCase</span>();
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(s -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;forEach: %s [%s]\n&#34;</span>,
</span></span><span style="display:flex;"><span>        s, Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()));
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过日志输出，我们可以对哪个线程被用于执行流式操作，有个更深入的理解：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>filter:  b1 [main]
</span></span><span style="display:flex;"><span>filter:  a2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-1]
</span></span><span style="display:flex;"><span>map:     a2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-1]
</span></span><span style="display:flex;"><span>filter:  c2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-3]
</span></span><span style="display:flex;"><span>map:     c2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-3]
</span></span><span style="display:flex;"><span>filter:  c1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span><span style="display:flex;"><span>map:     c1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span><span style="display:flex;"><span>forEach: C2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-3]
</span></span><span style="display:flex;"><span>forEach: A2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-1]
</span></span><span style="display:flex;"><span>map:     b1 [main]
</span></span><span style="display:flex;"><span>forEach: B1 [main]
</span></span><span style="display:flex;"><span>filter:  a1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-3]
</span></span><span style="display:flex;"><span>map:     a1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-3]
</span></span><span style="display:flex;"><span>forEach: A1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-3]
</span></span><span style="display:flex;"><span>forEach: C1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span></code></pre></td></tr></table>
</div>
</div><p>如您所见，并行流使用了所有的ForkJoinPool中的可用线程来执行流式操作。<br>
让我们通过添加中间操作sort来扩展上面示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Arrays.<span style="color:#007f7f">asList</span>(<span style="color:#0ff;font-weight:bold">&#34;a1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;a2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;b1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;c1&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">parallelStream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;filter: %s [%s]\n&#34;</span>,
</span></span><span style="display:flex;"><span>            s, Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">map</span>(s -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;map: %s [%s]\n&#34;</span>,
</span></span><span style="display:flex;"><span>            s, Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s.<span style="color:#007f7f">toUpperCase</span>();
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">sorted</span>((s1, s2) -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;sort: %s &lt;&gt; %s [%s]\n&#34;</span>,
</span></span><span style="display:flex;"><span>            s1, s2, Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s1.<span style="color:#007f7f">compareTo</span>(s2);
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forEach</span>(s -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;forEach: %s [%s]\n&#34;</span>,
</span></span><span style="display:flex;"><span>        s, Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()));
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行代码，输出结果看上去有些奇怪：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>filter:  c2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-3]
</span></span><span style="display:flex;"><span>filter:  c1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span><span style="display:flex;"><span>map:     c1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span><span style="display:flex;"><span>filter:  a2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-1]
</span></span><span style="display:flex;"><span>map:     a2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-1]
</span></span><span style="display:flex;"><span>filter:  b1 [main]
</span></span><span style="display:flex;"><span>map:     b1 [main]
</span></span><span style="display:flex;"><span>filter:  a1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span><span style="display:flex;"><span>map:     a1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span><span style="display:flex;"><span>map:     c2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-3]
</span></span><span style="display:flex;"><span>sort:    A2 &lt;&gt; A1 [main]
</span></span><span style="display:flex;"><span>sort:    B1 &lt;&gt; A2 [main]
</span></span><span style="display:flex;"><span>sort:    C2 &lt;&gt; B1 [main]
</span></span><span style="display:flex;"><span>sort:    C1 &lt;&gt; C2 [main]
</span></span><span style="display:flex;"><span>sort:    C1 &lt;&gt; B1 [main]
</span></span><span style="display:flex;"><span>sort:    C1 &lt;&gt; C2 [main]
</span></span><span style="display:flex;"><span>forEach: A1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-1]
</span></span><span style="display:flex;"><span>forEach: C2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-3]
</span></span><span style="display:flex;"><span>forEach: B1 [main]
</span></span><span style="display:flex;"><span>forEach: A2 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span><span style="display:flex;"><span>forEach: C1 [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-1]
</span></span></code></pre></td></tr></table>
</div>
</div><p>貌似sort只在主线程上串行执行。但是实际上，并行流中的sort在底层使用了Java8中新的方法Arrays.parallelSort()。如 javadoc官方文档解释的，这个方法会按照数据长度来决定以串行方式，或者以并行的方式来执行。<br>
回到上小节 reduce的例子。我们已经发现了组合器函数只在并行流中调用，而不不会在串行流中被调用。让我们来实际观察一下涉及到哪个线程：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Person&gt; persons = Arrays.<span style="color:#007f7f">asList</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Max&#34;</span>, 18),
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Peter&#34;</span>, 23),
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;Pamela&#34;</span>, 23),
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;David&#34;</span>, 12));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>persons
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">parallelStream</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">reduce</span>(0,
</span></span><span style="display:flex;"><span>        (sum, p) -&gt; {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;accumulator: sum=%s; person=%s [%s]\n&#34;</span>,
</span></span><span style="display:flex;"><span>                sum, p, Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> sum += p.<span style="color:#007f7f">age</span>;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        (sum1, sum2) -&gt; {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;combiner: sum1=%s; sum2=%s [%s]\n&#34;</span>,
</span></span><span style="display:flex;"><span>                sum1, sum2, Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> sum1 + sum2;
</span></span><span style="display:flex;"><span>        });
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过控制台日志输出，累加器和组合器均在所有可用的线程上并行执行：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>accumulator: sum=0; person=Pamela; [main]
</span></span><span style="display:flex;"><span>accumulator: sum=0; person=Max;    [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-3]
</span></span><span style="display:flex;"><span>accumulator: sum=0; person=David;  [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span><span style="display:flex;"><span>accumulator: sum=0; person=Peter;  [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-1]
</span></span><span style="display:flex;"><span>combiner:    sum1=18; sum2=23;     [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-1]
</span></span><span style="display:flex;"><span>combiner:    sum1=23; sum2=12;     [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span><span style="display:flex;"><span>combiner:    sum1=41; sum2=35;     [ForkJoinPool.<span style="color:#007f7f">commonPool</span>-worker-2]
</span></span></code></pre></td></tr></table>
</div>
</div><p>总之，并行流对含有大量元素的数据流提升性能极大。但是你也需要记住并行流的一些操作，例如reduce和collect操作，需要额外的计算（如组合操作），这在串行执行时是并不需要。<br>
此外，所有并行流操作都共享相同的 JVM 相关的公共ForkJoinPool。所以你可能需要避免写出一些又慢又卡的流式操作，这很有可能会拖慢你应用中，严重依赖并行流的其它部分代码的性能。</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/java%E5%9F%BA%E7%A1%80/">Java基础</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
