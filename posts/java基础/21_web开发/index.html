<!DOCTYPE html>
<html lang="en" dir="auto">

<head>
    
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;Â»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      21_webå¼€å‘
    </h1>
    <div class="post-meta"><span title='2022-08-16 15:40:43 +0000 UTC'>2022-08-16</span>&nbsp;Â·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%a6%82%e8%bf%b0" aria-label="æ¦‚è¿°">æ¦‚è¿°</a></li>
                <li>
                    <a href="#web%e5%9f%ba%e7%a1%80" aria-label="WebåŸºç¡€">WebåŸºç¡€</a><ul>
                        
                <li>
                    <a href="#http%e5%8d%8f%e8%ae%ae" aria-label="HTTPåè®®">HTTPåè®®</a></li>
                <li>
                    <a href="#%e7%bc%96%e5%86%99http-server" aria-label="ç¼–å†™HTTP Server">ç¼–å†™HTTP Server</a></li></ul>
                </li>
                <li>
                    <a href="#servlet%e5%85%a5%e9%97%a8" aria-label="Servletå…¥é—¨">Servletå…¥é—¨</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#servlet-%e5%bc%80%e5%8f%91" aria-label="Servlet å¼€å‘">Servlet å¼€å‘</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-1" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#servlet%e8%bf%9b%e9%98%b6" aria-label="Servletè¿›é˜¶">Servletè¿›é˜¶</a><ul>
                        
                <li>
                    <a href="#httpservletrequest" aria-label="HttpServletRequest">HttpServletRequest</a></li>
                <li>
                    <a href="#httpservletresponse" aria-label="HttpServletResponse">HttpServletResponse</a></li>
                <li>
                    <a href="#servlet%e5%a4%9a%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b" aria-label="Servletå¤šçº¿ç¨‹æ¨¡å‹">Servletå¤šçº¿ç¨‹æ¨¡å‹</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-2" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%87%8d%e5%ae%9a%e5%90%91%e4%b8%8e%e8%bd%ac%e5%8f%91" aria-label="é‡å®šå‘ä¸è½¬å‘">é‡å®šå‘ä¸è½¬å‘</a><ul>
                        
                <li>
                    <a href="#redirect" aria-label="Redirect">Redirect</a></li>
                <li>
                    <a href="#forward" aria-label="Forward">Forward</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8session%e5%92%8ccookie" aria-label="ä½¿ç”¨Sessionå’ŒCookie">ä½¿ç”¨Sessionå’ŒCookie</a><ul>
                        
                <li>
                    <a href="#session" aria-label="Session">Session</a></li>
                <li>
                    <a href="#cookie" aria-label="Cookie">Cookie</a></li></ul>
                </li>
                <li>
                    <a href="#jsp%e5%bc%80%e5%8f%91" aria-label="JSPå¼€å‘">JSPå¼€å‘</a><ul>
                        
                <li>
                    <a href="#jsp%e9%ab%98%e7%ba%a7%e5%8a%9f%e8%83%bd" aria-label="JSPé«˜çº§åŠŸèƒ½">JSPé«˜çº§åŠŸèƒ½</a><ul>
                        
                <li>
                    <a href="#jsp-tag" aria-label="JSP Tag">JSP Tag</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-3" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#mvc%e5%bc%80%e5%8f%91" aria-label="MVCå¼€å‘">MVCå¼€å‘</a></li>
                <li>
                    <a href="#mvc%e9%ab%98%e7%ba%a7%e5%bc%80%e5%8f%91" aria-label="MVCé«˜çº§å¼€å‘">MVCé«˜çº§å¼€å‘</a><ul>
                        
                <li>
                    <a href="#%e8%ae%be%e8%ae%a1mvc%e6%a1%86%e6%9e%b6" aria-label="è®¾è®¡MVCæ¡†æ¶">è®¾è®¡MVCæ¡†æ¶</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0%e6%b8%b2%e6%9f%93" aria-label="å®ç°æ¸²æŸ“">å®ç°æ¸²æŸ“</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-4" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8filter" aria-label="ä½¿ç”¨Filter">ä½¿ç”¨Filter</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-5" aria-label="å°ç»“">å°ç»“</a></li>
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9%e8%af%b7%e6%b1%82" aria-label="ä¿®æ”¹è¯·æ±‚">ä¿®æ”¹è¯·æ±‚</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-6" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9%e5%93%8d%e5%ba%94" aria-label="ä¿®æ”¹å“åº”">ä¿®æ”¹å“åº”</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-7" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8listener" aria-label="ä½¿ç”¨Listener">ä½¿ç”¨Listener</a><ul>
                        
                <li>
                    <a href="#servletcontext" aria-label="ServletContext">ServletContext</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-8" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%83%a8%e7%bd%b2" aria-label="éƒ¨ç½²">éƒ¨ç½²</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-9" aria-label="å°ç»“">å°ç»“</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="æ¦‚è¿°">æ¦‚è¿°<a hidden class="anchor" aria-hidden="true" href="#æ¦‚è¿°">#</a></h1>
<p>ä»€ä¹ˆæ˜¯JavaEEï¼ŸJavaEEæ˜¯Java Platform Enterprise Editionçš„ç¼©å†™ï¼Œå³Javaä¼ä¸šå¹³å°ã€‚æˆ‘ä»¬å‰é¢ä»‹ç»çš„æ‰€æœ‰åŸºäºæ ‡å‡†JDKçš„å¼€å‘éƒ½æ˜¯JavaSEï¼Œå³Java Platform Standard Editionã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå°ä¼—ä¸å¤ªå¸¸ç”¨çš„JavaMEï¼šJava Platform Micro Editionï¼Œæ˜¯Javaç§»åŠ¨å¼€å‘å¹³å°ï¼ˆéAndroidï¼‰ï¼Œå®ƒä»¬ä¸‰è€…å…³ç³»å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚     JavaEE     â”‚
</span></span><span style="display:flex;"><span>â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
</span></span><span style="display:flex;"><span>â”‚â”‚    JavaSE    â”‚â”‚
</span></span><span style="display:flex;"><span>â”‚â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚   JavaME   â”‚â”‚â”‚
</span></span><span style="display:flex;"><span>â”‚â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
</span></span><span style="display:flex;"><span>â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>JavaMEæ˜¯ä¸€ä¸ªè£å‰ªåçš„â€œå¾®å‹ç‰ˆâ€JDKï¼Œç°åœ¨ä½¿ç”¨å¾ˆå°‘ï¼Œæˆ‘ä»¬ä¸ç”¨ç®¡å®ƒã€‚JavaEEä¹Ÿä¸æ˜¯å‡­ç©ºå†’å‡ºæ¥çš„ï¼Œå®ƒå®é™…ä¸Šæ˜¯å®Œå…¨åŸºäºJavaSEï¼Œåªæ˜¯å¤šäº†ä¸€å¤§å †æœåŠ¡å™¨ç›¸å…³çš„åº“ä»¥åŠAPIæ¥å£ã€‚æ‰€æœ‰çš„JavaEEç¨‹åºï¼Œä»ç„¶æ˜¯è¿è¡Œåœ¨æ ‡å‡†çš„JavaSEçš„è™šæ‹Ÿæœºä¸Šçš„ã€‚</p>
<p>æœ€æ—©çš„JavaEEçš„åç§°æ˜¯J2EEï¼šJava 2 Platform Enterprise Editionï¼Œåæ¥æ”¹åä¸ºJavaEEã€‚ç”±äºOracleå°†JavaEEç§»äº¤ç»™<a href="https://www.eclipse.org/">Eclipse</a>å¼€æºç»„ç»‡æ—¶ï¼Œä¸å…è®¸ä»–ä»¬ç»§ç»­ä½¿ç”¨Javaå•†æ ‡ï¼Œæ‰€ä»¥JavaEEå†æ¬¡æ”¹åä¸º<a href="https://jakarta.ee/">Jakarta EE</a>ã€‚å› ä¸ºè¿™ä¸ªæ‹¼å†™æ¯”è¾ƒå¤æ‚è€Œä¸”éš¾è®°ï¼Œæ‰€ä»¥æˆ‘ä»¬åé¢è¿˜æ˜¯ç”¨JavaEEè¿™ä¸ªç¼©å†™ã€‚</p>
<p>JavaEEå¹¶ä¸æ˜¯ä¸€ä¸ªè½¯ä»¶äº§å“ï¼Œå®ƒæ›´å¤šçš„æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„å’Œè®¾è®¡æ€æƒ³ã€‚æˆ‘ä»¬å¯ä»¥æŠŠJavaEEçœ‹ä½œæ˜¯åœ¨JavaSEçš„åŸºç¡€ä¸Šï¼Œå¼€å‘çš„ä¸€ç³»åˆ—åŸºäºæœåŠ¡å™¨çš„ç»„ä»¶ã€APIæ ‡å‡†å’Œé€šç”¨æ¶æ„ã€‚</p>
<p>JavaEEæœ€æ ¸å¿ƒçš„ç»„ä»¶å°±æ˜¯åŸºäºServletæ ‡å‡†çš„WebæœåŠ¡å™¨ï¼Œå¼€å‘è€…ç¼–å†™çš„åº”ç”¨ç¨‹åºæ˜¯åŸºäºServlet APIå¹¶è¿è¡Œåœ¨WebæœåŠ¡å™¨å†…éƒ¨çš„ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
</span></span><span style="display:flex;"><span>â”‚â”‚ User App  â”‚â”‚
</span></span><span style="display:flex;"><span>â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
</span></span><span style="display:flex;"><span>â”‚â”‚Servlet APIâ”‚â”‚
</span></span><span style="display:flex;"><span>â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
</span></span><span style="display:flex;"><span>â”‚ Web Server  â”‚
</span></span><span style="display:flex;"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span style="display:flex;"><span>â”‚   JavaSE    â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤–ï¼ŒJavaEEè¿˜æœ‰ä¸€ç³»åˆ—æŠ€æœ¯æ ‡å‡†ï¼š</p>
<ul>
<li>EJBï¼šEnterprise JavaBeanï¼Œä¼ä¸šçº§JavaBeanï¼Œæ—©æœŸç»å¸¸ç”¨äºå®ç°åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ï¼Œç°åœ¨åŸºæœ¬è¢«è½»é‡çº§æ¡†æ¶å¦‚Springæ‰€å–ä»£ï¼›</li>
<li>JAASï¼šJava Authentication and Authorization Serviceï¼Œä¸€ä¸ªæ ‡å‡†çš„è®¤è¯å’ŒæˆæƒæœåŠ¡ï¼Œå¸¸ç”¨äºä¼ä¸šå†…éƒ¨ï¼ŒWebç¨‹åºé€šå¸¸ä½¿ç”¨æ›´è½»é‡çº§çš„è‡ªå®šä¹‰è®¤è¯ï¼›</li>
<li>JCAï¼šJavaEE Connector Architectureï¼Œç”¨äºè¿æ¥ä¼ä¸šå†…éƒ¨çš„EISç³»ç»Ÿç­‰ï¼›</li>
<li>JMSï¼šJava Message Serviceï¼Œç”¨äºæ¶ˆæ¯æœåŠ¡ï¼›</li>
<li>JTAï¼šJava Transaction APIï¼Œç”¨äºåˆ†å¸ƒå¼äº‹åŠ¡ï¼›</li>
<li>JAX-WSï¼šJava API for XML Web Servicesï¼Œç”¨äºæ„å»ºåŸºäºXMLçš„WebæœåŠ¡ï¼›</li>
<li>&hellip;</li>
</ul>
<p>ç›®å‰æµè¡Œçš„åŸºäºSpringçš„è½»é‡çº§JavaEEå¼€å‘æ¶æ„ï¼Œä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯Servletå’ŒJMSï¼Œä»¥åŠä¸€ç³»åˆ—å¼€æºç»„ä»¶ã€‚æœ¬ç« æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»åŸºäºServletçš„Webå¼€å‘ã€‚</p>
<h1 id="webåŸºç¡€">WebåŸºç¡€<a hidden class="anchor" aria-hidden="true" href="#webåŸºç¡€">#</a></h1>
<p>ä»Šå¤©æˆ‘ä»¬è®¿é—®ç½‘ç«™ï¼Œä½¿ç”¨Appæ—¶ï¼Œéƒ½æ˜¯åŸºäºWebè¿™ç§Browser/Serveræ¨¡å¼ï¼Œç®€ç§°BSæ¶æ„ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼Œå®¢æˆ·ç«¯åªéœ€è¦æµè§ˆå™¨ï¼Œåº”ç”¨ç¨‹åºçš„é€»è¾‘å’Œæ•°æ®éƒ½å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ã€‚æµè§ˆå™¨åªéœ€è¦è¯·æ±‚æœåŠ¡å™¨ï¼Œè·å–Webé¡µé¢ï¼Œå¹¶æŠŠWebé¡µé¢å±•ç¤ºç»™ç”¨æˆ·å³å¯ã€‚</p>
<p>Webé¡µé¢å…·æœ‰æå¼ºçš„äº¤äº’æ€§ã€‚ç”±äºWebé¡µé¢æ˜¯ç”¨HTMLç¼–å†™çš„ï¼Œè€ŒHTMLå…·å¤‡è¶…å¼ºçš„è¡¨ç°åŠ›ï¼Œå¹¶ä¸”ï¼ŒæœåŠ¡å™¨ç«¯å‡çº§åï¼Œå®¢æˆ·ç«¯æ— éœ€ä»»ä½•éƒ¨ç½²å°±å¯ä»¥ä½¿ç”¨åˆ°æ–°çš„ç‰ˆæœ¬ï¼Œå› æ­¤ï¼ŒBSæ¶æ„å‡çº§éå¸¸å®¹æ˜“ã€‚</p>
<h2 id="httpåè®®">HTTPåè®®<a hidden class="anchor" aria-hidden="true" href="#httpåè®®">#</a></h2>
<p>åœ¨Webåº”ç”¨ä¸­ï¼Œæµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªURLï¼ŒæœåŠ¡å™¨å°±æŠŠç”Ÿæˆçš„HTMLç½‘é¡µå‘é€ç»™æµè§ˆå™¨ï¼Œè€Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“åè®®æ˜¯HTTPï¼Œæ‰€ä»¥ï¼š</p>
<ul>
<li>HTMLæ˜¯ä¸€ç§ç”¨æ¥å®šä¹‰ç½‘é¡µçš„æ–‡æœ¬ï¼Œä¼šHTMLï¼Œå°±å¯ä»¥ç¼–å†™ç½‘é¡µï¼›</li>
<li>HTTPæ˜¯åœ¨ç½‘ç»œä¸Šä¼ è¾“HTMLçš„åè®®ï¼Œç”¨äºæµè§ˆå™¨å’ŒæœåŠ¡å™¨çš„é€šä¿¡ã€‚</li>
</ul>
<p>HTTPåè®®æ˜¯ä¸€ä¸ªåŸºäºTCPåè®®ä¹‹ä¸Šçš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒéå¸¸ç®€å•ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨Chromeæµè§ˆå™¨æŸ¥çœ‹æ–°æµªé¦–é¡µï¼Œç„¶åé€‰æ‹©View - Developer - Inspect Elementså°±å¯ä»¥çœ‹åˆ°HTMLã€‚</p>
<p>åˆ‡æ¢åˆ°Networkï¼Œé‡æ–°åŠ è½½é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨å‘å‡ºçš„æ¯ä¸€ä¸ªè¯·æ±‚å’Œå“åº”ã€‚</p>
<p>å¯¹äºBrowseræ¥è¯´ï¼Œè¯·æ±‚é¡µé¢çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ï¼›</li>
<li>å‘é€HTTPè¯·æ±‚ï¼›</li>
<li>æ”¶å–HTTPå“åº”ï¼Œç„¶åæŠŠç½‘é¡µåœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚</li>
</ol>
<p>æµè§ˆå™¨å‘é€çš„HTTPè¯·æ±‚å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET / HTTP/1.1
</span></span><span style="display:flex;"><span>Host: www.sina.com.cn
</span></span><span style="display:flex;"><span>User-Agent: Mozilla/5.0 xxx
</span></span><span style="display:flex;"><span>Accept: */*
</span></span><span style="display:flex;"><span>Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œç¬¬ä¸€è¡Œè¡¨ç¤ºä½¿ç”¨<code>GET</code>è¯·æ±‚è·å–è·¯å¾„ä¸º<code>/</code>çš„èµ„æºï¼Œå¹¶ä½¿ç”¨<code>HTTP/1.1</code>åè®®ï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œæ¯è¡Œéƒ½æ˜¯ä»¥<code>Header: Value</code>å½¢å¼è¡¨ç¤ºçš„HTTPå¤´ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„HTTP HeaderåŒ…æ‹¬ï¼š</p>
<ul>
<li>Host: è¡¨ç¤ºè¯·æ±‚çš„ä¸»æœºåï¼Œå› ä¸ºä¸€ä¸ªæœåŠ¡å™¨ä¸Šå¯èƒ½è¿è¡Œç€å¤šä¸ªç½‘ç«™ï¼Œå› æ­¤ï¼ŒHostè¡¨ç¤ºæµè§ˆå™¨æ­£åœ¨è¯·æ±‚çš„åŸŸåï¼›</li>
<li>User-Agent: æ ‡è¯†å®¢æˆ·ç«¯æœ¬èº«ï¼Œä¾‹å¦‚Chromeæµè§ˆå™¨çš„æ ‡è¯†ç±»ä¼¼<code>Mozilla/5.0 ... Chrome/79</code>ï¼ŒIEæµè§ˆå™¨çš„æ ‡è¯†ç±»ä¼¼<code>Mozilla/5.0 (Windows NT ...) like Gecko</code>ï¼›</li>
<li>Acceptï¼šè¡¨ç¤ºæµè§ˆå™¨èƒ½æ¥æ”¶çš„èµ„æºç±»å‹ï¼Œå¦‚<code>text/*</code>ï¼Œ<code>image/*</code>æˆ–è€…<code>*/*</code>è¡¨ç¤ºæ‰€æœ‰ï¼›</li>
<li>Accept-Languageï¼šè¡¨ç¤ºæµè§ˆå™¨åå¥½çš„è¯­è¨€ï¼ŒæœåŠ¡å™¨å¯ä»¥æ®æ­¤è¿”å›ä¸åŒè¯­è¨€çš„ç½‘é¡µï¼›</li>
<li>Accept-Encodingï¼šè¡¨ç¤ºæµè§ˆå™¨å¯ä»¥æ”¯æŒçš„å‹ç¼©ç±»å‹ï¼Œä¾‹å¦‚<code>gzip, deflate, br</code>ã€‚</li>
</ul>
<p>æœåŠ¡å™¨çš„å“åº”å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>HTTP/1.1 200 OK
</span></span><span style="display:flex;"><span>Content-Type: text/html
</span></span><span style="display:flex;"><span>Content-Length: 21932
</span></span><span style="display:flex;"><span>Content-Encoding: gzip
</span></span><span style="display:flex;"><span>Cache-Control: max-age=300
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;html&gt;...ç½‘é¡µæ•°æ®...
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœåŠ¡å™¨å“åº”çš„ç¬¬ä¸€è¡Œæ€»æ˜¯ç‰ˆæœ¬å·+ç©ºæ ¼+æ•°å­—+ç©ºæ ¼+æ–‡æœ¬ï¼Œæ•°å­—è¡¨ç¤ºå“åº”ä»£ç ï¼Œå…¶ä¸­<code>2xx</code>è¡¨ç¤ºæˆåŠŸï¼Œ<code>3xx</code>è¡¨ç¤ºé‡å®šå‘ï¼Œ<code>4xx</code>è¡¨ç¤ºå®¢æˆ·ç«¯å¼•å‘çš„é”™è¯¯ï¼Œ<code>5xx</code>è¡¨ç¤ºæœåŠ¡å™¨ç«¯å¼•å‘çš„é”™è¯¯ã€‚æ•°å­—æ˜¯ç»™ç¨‹åºè¯†åˆ«ï¼Œæ–‡æœ¬åˆ™æ˜¯ç»™å¼€å‘è€…è°ƒè¯•ä½¿ç”¨çš„ã€‚å¸¸è§çš„å“åº”ä»£ç æœ‰ï¼š</p>
<ul>
<li>200 OKï¼šè¡¨ç¤ºæˆåŠŸï¼›</li>
<li>301 Moved Permanentlyï¼šè¡¨ç¤ºè¯¥URLå·²ç»æ°¸ä¹…é‡å®šå‘ï¼›</li>
<li>302 Foundï¼šè¡¨ç¤ºè¯¥URLéœ€è¦ä¸´æ—¶é‡å®šå‘ï¼›</li>
<li>304 Not Modifiedï¼šè¡¨ç¤ºè¯¥èµ„æºæ²¡æœ‰ä¿®æ”¹ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„ç‰ˆæœ¬ï¼›</li>
<li>400 Bad Requestï¼šè¡¨ç¤ºå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªé”™è¯¯çš„è¯·æ±‚ï¼Œä¾‹å¦‚å‚æ•°æ— æ•ˆï¼›</li>
<li>401 Unauthorizedï¼šè¡¨ç¤ºå®¢æˆ·ç«¯å› ä¸ºèº«ä»½æœªéªŒè¯è€Œä¸å…è®¸è®¿é—®è¯¥URLï¼›</li>
<li>403 Forbiddenï¼šè¡¨ç¤ºæœåŠ¡å™¨å› ä¸ºæƒé™é—®é¢˜æ‹’ç»äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼›</li>
<li>404 Not Foundï¼šè¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚äº†ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºï¼›</li>
<li>500 Internal Server Errorï¼šè¡¨ç¤ºæœåŠ¡å™¨å¤„ç†æ—¶å†…éƒ¨å‡ºé”™ï¼Œä¾‹å¦‚å› ä¸ºæ— æ³•è¿æ¥æ•°æ®åº“ï¼›</li>
<li>503 Service Unavailableï¼šè¡¨ç¤ºæœåŠ¡å™¨æ­¤åˆ»æš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚ã€‚</li>
</ul>
<p>ä»ç¬¬äºŒè¡Œå¼€å§‹ï¼ŒæœåŠ¡å™¨æ¯ä¸€è¡Œå‡è¿”å›ä¸€ä¸ªHTTPå¤´ã€‚æœåŠ¡å™¨ç»å¸¸è¿”å›çš„HTTP HeaderåŒ…æ‹¬ï¼š</p>
<ul>
<li>Content-Typeï¼šè¡¨ç¤ºè¯¥å“åº”å†…å®¹çš„ç±»å‹ï¼Œä¾‹å¦‚<code>text/html</code>ï¼Œ<code>image/jpeg</code>ï¼›</li>
<li>Content-Lengthï¼šè¡¨ç¤ºè¯¥å“åº”å†…å®¹çš„é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ï¼›</li>
<li>Content-Encodingï¼šè¡¨ç¤ºè¯¥å“åº”å‹ç¼©ç®—æ³•ï¼Œä¾‹å¦‚<code>gzip</code>ï¼›</li>
<li>Cache-Controlï¼šæŒ‡ç¤ºå®¢æˆ·ç«¯åº”å¦‚ä½•ç¼“å­˜ï¼Œä¾‹å¦‚<code>max-age=300</code>è¡¨ç¤ºå¯ä»¥æœ€å¤šç¼“å­˜300ç§’ã€‚</li>
</ul>
<p>HTTPè¯·æ±‚å’Œå“åº”éƒ½ç”±HTTP Headerå’ŒHTTP Bodyæ„æˆï¼Œå…¶ä¸­HTTP Headeræ¯è¡Œéƒ½ä»¥<code>\r\n</code>ç»“æŸã€‚å¦‚æœé‡åˆ°ä¸¤ä¸ªè¿ç»­çš„<code>\r\n</code>ï¼Œé‚£ä¹ˆåé¢å°±æ˜¯HTTP Bodyã€‚æµè§ˆå™¨è¯»å–HTTP Bodyï¼Œå¹¶æ ¹æ®Headerä¿¡æ¯ä¸­æŒ‡ç¤ºçš„<code>Content-Type</code>ã€<code>Content-Encoding</code>ç­‰è§£å‹åæ˜¾ç¤ºç½‘é¡µã€å›¾åƒæˆ–å…¶ä»–å†…å®¹ã€‚</p>
<p>é€šå¸¸æµè§ˆå™¨è·å–çš„ç¬¬ä¸€ä¸ªèµ„æºæ˜¯HTMLç½‘é¡µï¼Œåœ¨ç½‘é¡µä¸­ï¼Œå¦‚æœåµŒå…¥äº†JavaScriptã€CSSã€å›¾ç‰‡ã€è§†é¢‘ç­‰å…¶ä»–èµ„æºï¼Œæµè§ˆå™¨ä¼šæ ¹æ®èµ„æºçš„URLå†æ¬¡å‘æœåŠ¡å™¨è¯·æ±‚å¯¹åº”çš„èµ„æºã€‚</p>
<p>å…³äºHTTPåè®®çš„è¯¦ç»†å†…å®¹ï¼Œè¯·å‚è€ƒ<a href="https://www.amazon.cn/dp/B00M2DKYRC/">HTTPæƒå¨æŒ‡å—</a>ä¸€ä¹¦ï¼Œæˆ–è€…<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP">Mozillaå¼€å‘è€…ç½‘ç«™</a>ã€‚</p>
<p>æˆ‘ä»¬åœ¨å‰é¢ä»‹ç»çš„<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1319099982413858">HTTPç¼–ç¨‹</a>æ˜¯ä»¥å®¢æˆ·ç«¯çš„èº«ä»½å»è¯·æ±‚æœåŠ¡å™¨èµ„æºã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä»¥æœåŠ¡å™¨çš„èº«ä»½å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œç¼–å†™æœåŠ¡å™¨ç¨‹åºæ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚é€šå¸¸å°±ç§°ä¹‹ä¸ºWebå¼€å‘ã€‚</p>
<h2 id="ç¼–å†™http-server">ç¼–å†™HTTP Server<a hidden class="anchor" aria-hidden="true" href="#ç¼–å†™http-server">#</a></h2>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ç¼–å†™HTTP Serverã€‚ä¸€ä¸ªHTTP Serveræœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªTCPæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å…ˆç”¨<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1305207629676577">TCPç¼–ç¨‹</a>çš„å¤šçº¿ç¨‹å®ç°çš„æœåŠ¡å™¨ç«¯æ¡†æ¶ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Server {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        ServerSocket ss = <span style="color:#fff;font-weight:bold">new</span> ServerSocket(8080); <span style="color:#007f7f">// ç›‘å¬æŒ‡å®šç«¯å£</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;server is running...&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>            Socket sock = ss.<span style="color:#007f7f">accept</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;connected from &#34;</span> + sock.<span style="color:#007f7f">getRemoteSocketAddress</span>());
</span></span><span style="display:flex;"><span>            Thread t = <span style="color:#fff;font-weight:bold">new</span> Handler(sock);
</span></span><span style="display:flex;"><span>            t.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Handler <span style="color:#fff;font-weight:bold">extends</span> Thread {
</span></span><span style="display:flex;"><span>    Socket sock;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Handler(Socket sock) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">sock</span> = sock;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> (InputStream input = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">sock</span>.<span style="color:#007f7f">getInputStream</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> (OutputStream output = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">sock</span>.<span style="color:#007f7f">getOutputStream</span>()) {
</span></span><span style="display:flex;"><span>                handle(input, output);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">sock</span>.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (IOException ioe) {
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;client disconnected.&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> handle(InputStream input, OutputStream output) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">var</span> reader = <span style="color:#fff;font-weight:bold">new</span> BufferedReader(<span style="color:#fff;font-weight:bold">new</span> InputStreamReader(input, StandardCharsets.<span style="color:#007f7f">UTF_8</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">var</span> writer = <span style="color:#fff;font-weight:bold">new</span> BufferedWriter(<span style="color:#fff;font-weight:bold">new</span> OutputStreamWriter(output, StandardCharsets.<span style="color:#007f7f">UTF_8</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// TODO: å¤„ç†HTTPè¯·æ±‚</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åªéœ€è¦åœ¨<code>handle()</code>æ–¹æ³•ä¸­ï¼Œç”¨Readerè¯»å–HTTPè¯·æ±‚ï¼Œç”¨Writerå‘é€HTTPå“åº”ï¼Œå³å¯å®ç°ä¸€ä¸ªæœ€ç®€å•çš„HTTPæœåŠ¡å™¨ã€‚ç¼–å†™ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> handle(InputStream input, OutputStream output) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Process new http request...&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">var</span> reader = <span style="color:#fff;font-weight:bold">new</span> BufferedReader(<span style="color:#fff;font-weight:bold">new</span> InputStreamReader(input, StandardCharsets.<span style="color:#007f7f">UTF_8</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">var</span> writer = <span style="color:#fff;font-weight:bold">new</span> BufferedWriter(<span style="color:#fff;font-weight:bold">new</span> OutputStreamWriter(output, StandardCharsets.<span style="color:#007f7f">UTF_8</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è¯»å–HTTPè¯·æ±‚:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> requestOk = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    String first = reader.<span style="color:#007f7f">readLine</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (first.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;GET / HTTP/1.&#34;</span>)) {
</span></span><span style="display:flex;"><span>        requestOk = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>        String header = reader.<span style="color:#007f7f">readLine</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (header.<span style="color:#007f7f">isEmpty</span>()) { <span style="color:#007f7f">// è¯»å–åˆ°ç©ºè¡Œæ—¶, HTTP Headerè¯»å–å®Œæ¯•</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(header);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(requestOk ? <span style="color:#0ff;font-weight:bold">&#34;Response OK&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;Response Error&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (!requestOk) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å‘é€é”™è¯¯å“åº”:</span>
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;HTTP/1.0 404 Not Found\r\n&#34;</span>);
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;Content-Length: 0\r\n&#34;</span>);
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;\r\n&#34;</span>);
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å‘é€æˆåŠŸå“åº”:</span>
</span></span><span style="display:flex;"><span>        String data = <span style="color:#0ff;font-weight:bold">&#34;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello, world!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> length = data.<span style="color:#007f7f">getBytes</span>(StandardCharsets.<span style="color:#007f7f">UTF_8</span>).<span style="color:#007f7f">length</span>;
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;HTTP/1.0 200 OK\r\n&#34;</span>);
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;Connection: close\r\n&#34;</span>);
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;Content-Type: text/html\r\n&#34;</span>);
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;Content-Length: &#34;</span> + length + <span style="color:#0ff;font-weight:bold">&#34;\r\n&#34;</span>);
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;\r\n&#34;</span>); <span style="color:#007f7f">// ç©ºè¡Œæ ‡è¯†Headerå’ŒBodyçš„åˆ†éš”</span>
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">write</span>(data);
</span></span><span style="display:flex;"><span>        writer.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„æ ¸å¿ƒä»£ç æ˜¯ï¼Œå…ˆè¯»å–HTTPè¯·æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬åªå¤„ç†<code>GET /</code>çš„è¯·æ±‚ã€‚å½“è¯»å–åˆ°ç©ºè¡Œæ—¶ï¼Œè¡¨ç¤ºå·²è¯»åˆ°è¿ç»­ä¸¤ä¸ª<code>\r\n</code>ï¼Œè¯´æ˜è¯·æ±‚ç»“æŸï¼Œå¯ä»¥å‘é€å“åº”ã€‚å‘é€å“åº”çš„æ—¶å€™ï¼Œé¦–å…ˆå‘é€å“åº”ä»£ç <code>HTTP/1.0 200 OK</code>è¡¨ç¤ºä¸€ä¸ªæˆåŠŸçš„200å“åº”ï¼Œä½¿ç”¨<code>HTTP/1.0</code>åè®®ï¼Œç„¶åï¼Œä¾æ¬¡å‘é€Headerï¼Œå‘é€å®ŒHeaderåï¼Œå†å‘é€ä¸€ä¸ªç©ºè¡Œæ ‡è¯†Headerç»“æŸï¼Œç´§æ¥ç€å‘é€HTTP Bodyï¼Œåœ¨æµè§ˆå™¨è¾“å…¥<code>http://local.liaoxuefeng.com:8080/</code>å°±å¯ä»¥çœ‹åˆ°å“åº”é¡µé¢ï¼š</p>
<p>HTTPç›®å‰æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œ<code>1.0</code>æ˜¯æ—©æœŸç‰ˆæœ¬ï¼Œæµè§ˆå™¨æ¯æ¬¡å»ºç«‹TCPè¿æ¥åï¼Œåªå‘é€ä¸€ä¸ªHTTPè¯·æ±‚å¹¶æ¥æ”¶ä¸€ä¸ªHTTPå“åº”ï¼Œç„¶åå°±å…³é—­TCPè¿æ¥ã€‚ç”±äºåˆ›å»ºTCPè¿æ¥æœ¬èº«å°±éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´ï¼Œå› æ­¤ï¼ŒHTTP 1.1å…è®¸æµè§ˆå™¨å’ŒæœåŠ¡å™¨åœ¨åŒä¸€ä¸ªTCPè¿æ¥ä¸Šåå¤å‘é€ã€æ¥æ”¶å¤šä¸ªHTTPè¯·æ±‚å’Œå“åº”ï¼Œè¿™æ ·å°±å¤§å¤§æé«˜äº†ä¼ è¾“æ•ˆç‡ã€‚</p>
<p>æˆ‘ä»¬æ³¨æ„åˆ°HTTPåè®®æ˜¯ä¸€ä¸ªè¯·æ±‚-å“åº”åè®®ï¼Œå®ƒæ€»æ˜¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åæ¥æ”¶ä¸€ä¸ªå“åº”ã€‚èƒ½ä¸èƒ½ä¸€æ¬¡æ€§å‘é€å¤šä¸ªè¯·æ±‚ï¼Œç„¶åå†æ¥æ”¶å¤šä¸ªå“åº”å‘¢ï¼ŸHTTP 2.0å¯ä»¥æ”¯æŒæµè§ˆå™¨åŒæ—¶å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œä½†æ¯ä¸ªè¯·æ±‚éœ€è¦å”¯ä¸€æ ‡è¯†ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸æŒ‰è¯·æ±‚çš„é¡ºåºè¿”å›å¤šä¸ªå“åº”ï¼Œç”±æµè§ˆå™¨è‡ªå·±æŠŠæ”¶åˆ°çš„å“åº”å’Œè¯·æ±‚å¯¹åº”èµ·æ¥ã€‚å¯è§ï¼ŒHTTP 2.0è¿›ä¸€æ­¥æé«˜äº†ä¼ è¾“æ•ˆç‡ï¼Œå› ä¸ºæµè§ˆå™¨å‘å‡ºä¸€ä¸ªè¯·æ±‚åï¼Œä¸å¿…ç­‰å¾…å“åº”ï¼Œå°±å¯ä»¥ç»§ç»­å‘ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</p>
<p>HTTP 3.0ä¸ºäº†è¿›ä¸€æ­¥æé«˜é€Ÿåº¦ï¼Œå°†æŠ›å¼ƒTCPåè®®ï¼Œæ”¹ä¸ºä½¿ç”¨æ— éœ€åˆ›å»ºè¿æ¥çš„UDPåè®®ï¼Œç›®å‰HTTP 3.0ä»ç„¶å¤„äºå®éªŒé˜¶æ®µã€‚</p>
<h1 id="servletå…¥é—¨">Servletå…¥é—¨<a hidden class="anchor" aria-hidden="true" href="#servletå…¥é—¨">#</a></h1>
<p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œç¼–å†™HTTPæœåŠ¡å™¨å…¶å®æ˜¯éå¸¸ç®€å•çš„ï¼Œåªéœ€è¦å…ˆç¼–å†™åŸºäºå¤šçº¿ç¨‹çš„TCPæœåŠ¡ï¼Œç„¶ååœ¨ä¸€ä¸ªTCPè¿æ¥ä¸­è¯»å–HTTPè¯·æ±‚ï¼Œå‘é€HTTPå“åº”å³å¯ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¦ç¼–å†™ä¸€ä¸ªå®Œå–„çš„HTTPæœåŠ¡å™¨ï¼Œä»¥HTTP/1.1ä¸ºä¾‹ï¼Œéœ€è¦è€ƒè™‘çš„åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¯†åˆ«æ­£ç¡®å’Œé”™è¯¯çš„HTTPè¯·æ±‚ï¼›</li>
<li>è¯†åˆ«æ­£ç¡®å’Œé”™è¯¯çš„HTTPå¤´ï¼›</li>
<li>å¤ç”¨TCPè¿æ¥ï¼›</li>
<li>å¤ç”¨çº¿ç¨‹ï¼›</li>
<li>IOå¼‚å¸¸å¤„ç†ï¼›</li>
<li>&hellip;</li>
</ul>
<p>è¿™äº›åŸºç¡€å·¥ä½œéœ€è¦è€—è´¹å¤§é‡çš„æ—¶é—´ï¼Œå¹¶ä¸”ç»è¿‡é•¿æœŸæµ‹è¯•æ‰èƒ½ç¨³å®šè¿è¡Œã€‚å¦‚æœæˆ‘ä»¬åªéœ€è¦è¾“å‡ºä¸€ä¸ªç®€å•çš„HTMLé¡µé¢ï¼Œå°±ä¸å¾—ä¸ç¼–å†™ä¸Šåƒè¡Œåº•å±‚ä»£ç ï¼Œé‚£å°±æ ¹æœ¬æ— æ³•åšåˆ°é«˜æ•ˆè€Œå¯é åœ°å¼€å‘ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨JavaEEå¹³å°ä¸Šï¼Œå¤„ç†TCPè¿æ¥ï¼Œè§£æHTTPåè®®è¿™äº›åº•å±‚å·¥ä½œç»Ÿç»Ÿæ‰”ç»™ç°æˆçš„WebæœåŠ¡å™¨å»åšï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠè‡ªå·±çš„åº”ç”¨ç¨‹åºè·‘åœ¨WebæœåŠ¡å™¨ä¸Šã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®çš„ï¼ŒJavaEEæä¾›äº†Servlet APIï¼Œæˆ‘ä»¬ä½¿ç”¨Servlet APIç¼–å†™è‡ªå·±çš„Servletæ¥å¤„ç†HTTPè¯·æ±‚ï¼ŒWebæœåŠ¡å™¨å®ç°Servlet APIæ¥å£ï¼Œå®ç°åº•å±‚åŠŸèƒ½ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                 â”‚My Servlet â”‚
</span></span><span style="display:flex;"><span>                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span style="display:flex;"><span>                 â”‚Servlet APIâ”‚
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”  HTTP  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span style="display:flex;"><span>â”‚Browserâ”‚&lt;â”€â”€â”€â”€â”€â”€&gt;â”‚Web Server â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªæœ€ç®€å•çš„Servletï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// WebServletæ³¨è§£è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªServletï¼Œå¹¶æ˜ å°„åˆ°åœ°å€/:</span>
</span></span><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HelloServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ç½®å“åº”ç±»å‹:</span>
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;text/html&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–è¾“å‡ºæµ:</span>
</span></span><span style="display:flex;"><span>        PrintWriter pw = resp.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å†™å…¥å“åº”:</span>
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æœ€åä¸è¦å¿˜è®°flushå¼ºåˆ¶è¾“å‡º:</span>
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€ä¸ªServletæ€»æ˜¯ç»§æ‰¿è‡ª<code>HttpServlet</code>ï¼Œç„¶åè¦†å†™<code>doGet()</code>æˆ–<code>doPost()</code>æ–¹æ³•ã€‚æ³¨æ„åˆ°<code>doGet()</code>æ–¹æ³•ä¼ å…¥äº†<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>ä¸¤ä¸ªå¯¹è±¡ï¼Œåˆ†åˆ«ä»£è¡¨HTTPè¯·æ±‚å’Œå“åº”ã€‚æˆ‘ä»¬ä½¿ç”¨Servlet APIæ—¶ï¼Œå¹¶ä¸ç›´æ¥ä¸åº•å±‚TCPäº¤äº’ï¼Œä¹Ÿä¸éœ€è¦è§£æHTTPåè®®ï¼Œå› ä¸º<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å°±å·²ç»å°è£…å¥½äº†è¯·æ±‚å’Œå“åº”ã€‚ä»¥å‘é€å“åº”ä¸ºä¾‹ï¼Œæˆ‘ä»¬åªéœ€è¦è®¾ç½®æ­£ç¡®çš„å“åº”ç±»å‹ï¼Œç„¶åè·å–<code>PrintWriter</code>ï¼Œå†™å…¥å“åº”å³å¯ã€‚</p>
<p>ç°åœ¨é—®é¢˜æ¥äº†ï¼šServlet APIæ˜¯è°æä¾›ï¼Ÿ</p>
<p>Servlet APIæ˜¯ä¸€ä¸ªjaråŒ…ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡Mavenæ¥å¼•å…¥å®ƒï¼Œæ‰èƒ½æ­£å¸¸ç¼–è¯‘ã€‚ç¼–å†™<code>pom.xml</code>æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>&lt;project xmlns=<span style="color:#0ff;font-weight:bold">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style="display:flex;"><span>    xmlns:xsi=<span style="color:#0ff;font-weight:bold">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>    xsi:schemaLocation=<span style="color:#0ff;font-weight:bold">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;modelVersion&gt;4.<span style="color:#007f7f">0</span>.<span style="color:#007f7f">0</span>&lt;/modelVersion&gt;
</span></span><span style="display:flex;"><span>    &lt;groupId&gt;com.<span style="color:#007f7f">itranswarp</span>.<span style="color:#007f7f">learnjava</span>&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>    &lt;artifactId&gt;web-servlet-hello&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>    &lt;packaging&gt;war&lt;/packaging&gt;
</span></span><span style="display:flex;"><span>    &lt;version&gt;1.<span style="color:#007f7f">0</span>-SNAPSHOT&lt;/version&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;properties&gt;
</span></span><span style="display:flex;"><span>        &lt;project.<span style="color:#007f7f">build</span>.<span style="color:#007f7f">sourceEncoding</span>&gt;UTF-8&lt;/project.<span style="color:#007f7f">build</span>.<span style="color:#007f7f">sourceEncoding</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;project.<span style="color:#007f7f">reporting</span>.<span style="color:#007f7f">outputEncoding</span>&gt;UTF-8&lt;/project.<span style="color:#007f7f">reporting</span>.<span style="color:#007f7f">outputEncoding</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;maven.<span style="color:#007f7f">compiler</span>.<span style="color:#007f7f">source</span>&gt;11&lt;/maven.<span style="color:#007f7f">compiler</span>.<span style="color:#007f7f">source</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;maven.<span style="color:#007f7f">compiler</span>.<span style="color:#007f7f">target</span>&gt;11&lt;/maven.<span style="color:#007f7f">compiler</span>.<span style="color:#007f7f">target</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;java.<span style="color:#007f7f">version</span>&gt;11&lt;/java.<span style="color:#007f7f">version</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/properties&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;dependencies&gt;
</span></span><span style="display:flex;"><span>        &lt;dependency&gt;
</span></span><span style="display:flex;"><span>            &lt;groupId&gt;javax.<span style="color:#007f7f">servlet</span>&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>            &lt;artifactId&gt;javax.<span style="color:#007f7f">servlet</span>-api&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>            &lt;version&gt;4.<span style="color:#007f7f">0</span>.<span style="color:#007f7f">0</span>&lt;/version&gt;
</span></span><span style="display:flex;"><span>            &lt;scope&gt;provided&lt;/scope&gt;
</span></span><span style="display:flex;"><span>        &lt;/dependency&gt;
</span></span><span style="display:flex;"><span>    &lt;/dependencies&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;build&gt;
</span></span><span style="display:flex;"><span>        &lt;finalName&gt;hello&lt;/finalName&gt;
</span></span><span style="display:flex;"><span>    &lt;/build&gt;
</span></span><span style="display:flex;"><span>&lt;/project&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°è¿™ä¸ª<code>pom.xml</code>ä¸å‰é¢æˆ‘ä»¬è®²åˆ°çš„æ™®é€šJavaç¨‹åºæœ‰ä¸ªåŒºåˆ«ï¼Œæ‰“åŒ…ç±»å‹ä¸æ˜¯<code>jar</code>ï¼Œè€Œæ˜¯<code>war</code>ï¼Œè¡¨ç¤ºJava Web Application Archiveï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;packaging&gt;war&lt;/packaging&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¼•å…¥çš„Servlet APIå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>&lt;dependency&gt;
</span></span><span style="display:flex;"><span>    &lt;groupId&gt;javax.<span style="color:#007f7f">servlet</span>&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>    &lt;artifactId&gt;javax.<span style="color:#007f7f">servlet</span>-api&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>    &lt;version&gt;4.<span style="color:#007f7f">0</span>.<span style="color:#007f7f">0</span>&lt;/version&gt;
</span></span><span style="display:flex;"><span>    &lt;scope&gt;provided&lt;/scope&gt;
</span></span><span style="display:flex;"><span>&lt;/dependency&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°<code>&lt;scope&gt;</code>æŒ‡å®šä¸º<code>provided</code>ï¼Œè¡¨ç¤ºç¼–è¯‘æ—¶ä½¿ç”¨ï¼Œä½†ä¸ä¼šæ‰“åŒ…åˆ°<code>.war</code>æ–‡ä»¶ä¸­ï¼Œå› ä¸ºè¿è¡ŒæœŸWebæœåŠ¡å™¨æœ¬èº«å·²ç»æä¾›äº†Servlet APIç›¸å…³çš„jaråŒ…ã€‚</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦åœ¨å·¥ç¨‹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>web.xml</code>æè¿°æ–‡ä»¶ï¼Œæ”¾åˆ°<code>src/main/webapp/WEB-INF</code>ç›®å½•ä¸‹ï¼ˆå›ºå®šç›®å½•ç»“æ„ï¼Œä¸è¦ä¿®æ”¹è·¯å¾„ï¼Œæ³¨æ„å¤§å°å†™ï¼‰ã€‚æ–‡ä»¶å†…å®¹å¯ä»¥å›ºå®šå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;!DOCTYPE web-app PUBLIC
</span></span><span style="display:flex;"><span> &#34;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&#34;
</span></span><span style="display:flex;"><span> &#34;http://java.sun.com/dtd/web-app_2_3.dtd&#34;&gt;
</span></span><span style="display:flex;"><span>&lt;web-app&gt;
</span></span><span style="display:flex;"><span>  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
</span></span><span style="display:flex;"><span>&lt;/web-app&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•´ä¸ªå·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>web-servlet-hello
</span></span><span style="display:flex;"><span>â”œâ”€â”€ pom.xml
</span></span><span style="display:flex;"><span>â””â”€â”€ src
</span></span><span style="display:flex;"><span>    â””â”€â”€ main
</span></span><span style="display:flex;"><span>        â”œâ”€â”€ java
</span></span><span style="display:flex;"><span>        â”‚   â””â”€â”€ com
</span></span><span style="display:flex;"><span>        â”‚       â””â”€â”€ itranswarp
</span></span><span style="display:flex;"><span>        â”‚           â””â”€â”€ learnjava
</span></span><span style="display:flex;"><span>        â”‚               â””â”€â”€ servlet
</span></span><span style="display:flex;"><span>        â”‚                   â””â”€â”€ HelloServlet.java
</span></span><span style="display:flex;"><span>        â”œâ”€â”€ resources
</span></span><span style="display:flex;"><span>        â””â”€â”€ webapp
</span></span><span style="display:flex;"><span>            â””â”€â”€ WEB-INF
</span></span><span style="display:flex;"><span>                â””â”€â”€ web.xml
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡ŒMavenå‘½ä»¤<code>mvn clean package</code>ï¼Œåœ¨<code>target</code>ç›®å½•ä¸‹å¾—åˆ°ä¸€ä¸ª<code>hello.war</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯æˆ‘ä»¬ç¼–è¯‘æ‰“åŒ…åçš„Webåº”ç”¨ç¨‹åºã€‚</p>
<p>ç°åœ¨é—®é¢˜åˆæ¥äº†ï¼šæˆ‘ä»¬åº”è¯¥å¦‚ä½•è¿è¡Œè¿™ä¸ª<code>war</code>æ–‡ä»¶ï¼Ÿ</p>
<p>æ™®é€šçš„Javaç¨‹åºæ˜¯é€šè¿‡å¯åŠ¨JVMï¼Œç„¶åæ‰§è¡Œ<code>main()</code>æ–¹æ³•å¼€å§‹è¿è¡Œã€‚ä½†æ˜¯Webåº”ç”¨ç¨‹åºæœ‰æ‰€ä¸åŒï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è¿è¡Œ<code>war</code>æ–‡ä»¶ï¼Œå¿…é¡»å…ˆå¯åŠ¨WebæœåŠ¡å™¨ï¼Œå†ç”±WebæœåŠ¡å™¨åŠ è½½æˆ‘ä»¬ç¼–å†™çš„<code>HelloServlet</code>ï¼Œè¿™æ ·å°±å¯ä»¥è®©<code>HelloServlet</code>å¤„ç†æµè§ˆå™¨å‘é€çš„è¯·æ±‚ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ‰¾ä¸€ä¸ªæ”¯æŒServlet APIçš„WebæœåŠ¡å™¨ã€‚å¸¸ç”¨çš„æœåŠ¡å™¨æœ‰ï¼š</p>
<ul>
<li><a href="https://tomcat.apache.org/">Tomcat</a>ï¼šç”±Apacheå¼€å‘çš„å¼€æºå…è´¹æœåŠ¡å™¨ï¼›</li>
<li><a href="https://www.eclipse.org/jetty/">Jetty</a>ï¼šç”±Eclipseå¼€å‘çš„å¼€æºå…è´¹æœåŠ¡å™¨ï¼›</li>
<li><a href="https://javaee.github.io/glassfish/">GlassFish</a>ï¼šä¸€ä¸ªå¼€æºçš„å…¨åŠŸèƒ½JavaEEæœåŠ¡å™¨ã€‚</li>
</ul>
<p>è¿˜æœ‰ä¸€äº›æ”¶è´¹çš„å•†ç”¨æœåŠ¡å™¨ï¼Œå¦‚Oracleçš„<a href="https://www.oracle.com/middleware/weblogic/">WebLogic</a>ï¼ŒIBMçš„<a href="https://www.ibm.com/cloud/websphere-application-platform/">WebSphere</a>ã€‚</p>
<p>æ— è®ºä½¿ç”¨å“ªä¸ªæœåŠ¡å™¨ï¼Œåªè¦å®ƒæ”¯æŒServlet API 4.0ï¼ˆå› ä¸ºæˆ‘ä»¬å¼•å…¥çš„Servletç‰ˆæœ¬æ˜¯4.0ï¼‰ï¼Œæˆ‘ä»¬çš„waråŒ…éƒ½å¯ä»¥åœ¨ä¸Šé¢è¿è¡Œã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨æœ€å¹¿æ³›çš„å¼€æºå…è´¹çš„TomcatæœåŠ¡å™¨ã€‚</p>
<p>è¦è¿è¡Œæˆ‘ä»¬çš„<code>hello.war</code>ï¼Œé¦–å…ˆè¦<a href="https://tomcat.apache.org/download-90.cgi">ä¸‹è½½TomcatæœåŠ¡å™¨</a>ï¼Œè§£å‹åï¼ŒæŠŠ<code>hello.war</code>å¤åˆ¶åˆ°Tomcatçš„<code>webapps</code>ç›®å½•ä¸‹ï¼Œç„¶ååˆ‡æ¢åˆ°<code>bin</code>ç›®å½•ï¼Œæ‰§è¡Œ<code>startup.sh</code>æˆ–<code>startup.bat</code>å¯åŠ¨TomcatæœåŠ¡å™¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ./startup.sh 
</span></span><span style="display:flex;"><span>Using CATALINA_BASE:   .../apache-tomcat-9.0.30
</span></span><span style="display:flex;"><span>Using CATALINA_HOME:   .../apache-tomcat-9.0.30
</span></span><span style="display:flex;"><span>Using CATALINA_TMPDIR: .../apache-tomcat-9.0.30/temp
</span></span><span style="display:flex;"><span>Using JRE_HOME:        .../jdk-11.jdk/Contents/Home
</span></span><span style="display:flex;"><span>Using CLASSPATH:       .../apache-tomcat-9.0.30/bin/bootstrap.jar:...
</span></span><span style="display:flex;"><span>Tomcat started.
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨æµè§ˆå™¨è¾“å…¥<code>http://localhost:8080/hello/</code>å³å¯çœ‹åˆ°<code>HelloServlet</code>çš„è¾“å‡ºã€‚</p>
<p>ç»†å¿ƒçš„ç«¥é‹å¯èƒ½ä¼šé—®ï¼Œä¸ºå•¥è·¯å¾„æ˜¯<code>/hello/</code>è€Œä¸æ˜¯<code>/</code>ï¼Ÿå› ä¸ºä¸€ä¸ªWebæœåŠ¡å™¨å…è®¸åŒæ—¶è¿è¡Œå¤šä¸ªWeb Appï¼Œè€Œæˆ‘ä»¬çš„Web Appå«<code>hello</code>ï¼Œå› æ­¤ï¼Œç¬¬ä¸€çº§ç›®å½•<code>/hello</code>è¡¨ç¤ºWeb Appçš„åå­—ï¼Œåé¢çš„<code>/</code>æ‰æ˜¯æˆ‘ä»¬åœ¨<code>HelloServlet</code>ä¸­æ˜ å°„çš„è·¯å¾„ã€‚</p>
<p>é‚£èƒ½ä¸èƒ½ç›´æ¥ä½¿ç”¨<code>/</code>è€Œä¸æ˜¯<code>/hello/</code>ï¼Ÿæ¯•ç«Ÿ<code>/</code>æ¯”è¾ƒç®€æ´ã€‚</p>
<p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚å…ˆå…³é—­Tomcatï¼ˆæ‰§è¡Œ<code>shutdown.sh</code>æˆ–<code>shutdown.bat</code>ï¼‰ï¼Œç„¶ååˆ é™¤Tomcatçš„webappsç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼Œæœ€åæŠŠæˆ‘ä»¬çš„<code>hello.war</code>å¤åˆ¶è¿‡æ¥ï¼Œæ”¹åä¸º<code>ROOT.war</code>ï¼Œæ–‡ä»¶åä¸º<code>ROOT</code>çš„åº”ç”¨ç¨‹åºå°†ä½œä¸ºé»˜è®¤åº”ç”¨ï¼Œå¯åŠ¨åç›´æ¥è®¿é—®<code>http://localhost:8080/</code>å³å¯ã€‚</p>
<p>å®é™…ä¸Šï¼Œç±»ä¼¼Tomcatè¿™æ ·çš„æœåŠ¡å™¨ä¹Ÿæ˜¯Javaç¼–å†™çš„ï¼Œå¯åŠ¨TomcatæœåŠ¡å™¨å®é™…ä¸Šæ˜¯å¯åŠ¨Javaè™šæ‹Ÿæœºï¼Œæ‰§è¡ŒTomcatçš„<code>main()</code>æ–¹æ³•ï¼Œç„¶åç”±Tomcatè´Ÿè´£åŠ è½½æˆ‘ä»¬çš„<code>.war</code>æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª<code>HelloServlet</code>å®ä¾‹ï¼Œæœ€åä»¥å¤šçº¿ç¨‹çš„æ¨¡å¼æ¥å¤„ç†HTTPè¯·æ±‚ã€‚å¦‚æœTomcatæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚è·¯å¾„æ˜¯<code>/</code>ï¼ˆå‡å®šéƒ¨ç½²æ–‡ä»¶ä¸ºROOT.warï¼‰ï¼Œå°±è½¬å‘åˆ°<code>HelloServlet</code>å¹¶ä¼ å…¥<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>ä¸¤ä¸ªå¯¹è±¡ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬ç¼–å†™çš„Servletå¹¶ä¸æ˜¯ç›´æ¥è¿è¡Œï¼Œè€Œæ˜¯ç”±WebæœåŠ¡å™¨åŠ è½½ååˆ›å»ºå®ä¾‹è¿è¡Œï¼Œæ‰€ä»¥ï¼Œç±»ä¼¼Tomcatè¿™æ ·çš„WebæœåŠ¡å™¨ä¹Ÿç§°ä¸ºServletå®¹å™¨ã€‚</p>
<p>åœ¨Servletå®¹å™¨ä¸­è¿è¡Œçš„Servletå…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ— æ³•åœ¨ä»£ç ä¸­ç›´æ¥é€šè¿‡newåˆ›å»ºServletå®ä¾‹ï¼Œå¿…é¡»ç”±Servletå®¹å™¨è‡ªåŠ¨åˆ›å»ºServletå®ä¾‹ï¼›</li>
<li>Servletå®¹å™¨åªä¼šç»™æ¯ä¸ªServletç±»åˆ›å»ºå”¯ä¸€å®ä¾‹ï¼›</li>
<li>Servletå®¹å™¨ä¼šä½¿ç”¨å¤šçº¿ç¨‹æ‰§è¡Œ<code>doGet()</code>æˆ–<code>doPost()</code>æ–¹æ³•ã€‚</li>
</ul>
<p>å¤ä¹ ä¸€ä¸‹Java<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1255943750561472">å¤šçº¿ç¨‹</a>çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š</p>
<ul>
<li>åœ¨Servletä¸­å®šä¹‰çš„å®ä¾‹å˜é‡ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œè¦æ³¨æ„çº¿ç¨‹å®‰å…¨ï¼›</li>
<li><code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å®ä¾‹æ˜¯ç”±Servletå®¹å™¨ä¼ å…¥çš„å±€éƒ¨å˜é‡ï¼Œå®ƒä»¬åªèƒ½è¢«å½“å‰çº¿ç¨‹è®¿é—®ï¼Œä¸å­˜åœ¨å¤šä¸ªçº¿ç¨‹è®¿é—®çš„é—®é¢˜ï¼›</li>
<li>åœ¨<code>doGet()</code>æˆ–<code>doPost()</code>æ–¹æ³•ä¸­ï¼Œå¦‚æœä½¿ç”¨äº†<code>ThreadLocal</code>ï¼Œä½†æ²¡æœ‰æ¸…ç†ï¼Œé‚£ä¹ˆå®ƒçš„çŠ¶æ€å¾ˆå¯èƒ½ä¼šå½±å“åˆ°ä¸‹æ¬¡çš„æŸä¸ªè¯·æ±‚ï¼Œå› ä¸ºServletå®¹å™¨å¾ˆå¯èƒ½ç”¨çº¿ç¨‹æ± å®ç°çº¿ç¨‹å¤ç”¨ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œæ­£ç¡®ç¼–å†™Servletï¼Œè¦æ¸…æ™°ç†è§£Javaçš„å¤šçº¿ç¨‹æ¨¡å‹ï¼Œéœ€è¦åŒæ­¥è®¿é—®çš„å¿…é¡»åŒæ­¥ã€‚</p>
<h2 id="å°ç»“">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“">#</a></h2>
<p>ç¼–å†™Webåº”ç”¨ç¨‹åºå°±æ˜¯ç¼–å†™Servletå¤„ç†HTTPè¯·æ±‚ï¼›</p>
<p>Servlet APIæä¾›äº†<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>ä¸¤ä¸ªé«˜çº§æ¥å£æ¥å°è£…HTTPè¯·æ±‚å’Œå“åº”ï¼›</p>
<p>Webåº”ç”¨ç¨‹åºå¿…é¡»æŒ‰å›ºå®šç»“æ„ç»„ç»‡å¹¶æ‰“åŒ…ä¸º<code>.war</code>æ–‡ä»¶ï¼›</p>
<p>éœ€è¦å¯åŠ¨WebæœåŠ¡å™¨æ¥åŠ è½½æˆ‘ä»¬çš„waråŒ…æ¥è¿è¡ŒServletã€‚</p>
<h1 id="servlet-å¼€å‘">Servlet å¼€å‘<a hidden class="anchor" aria-hidden="true" href="#servlet-å¼€å‘">#</a></h1>
<p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œä¸€ä¸ªå®Œæ•´çš„Webåº”ç”¨ç¨‹åºçš„å¼€å‘æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç¼–å†™Servletï¼›</li>
<li>æ‰“åŒ…ä¸ºwaræ–‡ä»¶ï¼›</li>
<li>å¤åˆ¶åˆ°Tomcatçš„webappsç›®å½•ä¸‹ï¼›</li>
<li>å¯åŠ¨Tomcatã€‚</li>
</ol>
<p>è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸æ˜¯å¾ˆç¹çï¼Ÿå¦‚æœæˆ‘ä»¬æƒ³åœ¨IDEä¸­æ–­ç‚¹è°ƒè¯•ï¼Œè¿˜éœ€è¦æ‰“å¼€Tomcatçš„è¿œç¨‹è°ƒè¯•ç«¯å£å¹¶ä¸”è¿æ¥ä¸Šå»ã€‚</p>
<p>è®¸å¤šåˆå­¦è€…ç»å¸¸å¡åœ¨å¦‚ä½•åœ¨IDEä¸­å¯åŠ¨Tomcatå¹¶åŠ è½½webappï¼Œæ›´ä¸è¦è¯´æ–­ç‚¹è°ƒè¯•äº†ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä¸€ç§ç®€å•å¯é ï¼Œèƒ½ç›´æ¥åœ¨IDEä¸­å¯åŠ¨å¹¶è°ƒè¯•webappçš„æ–¹æ³•ã€‚</p>
<p>å› ä¸ºTomcatå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªJavaç¨‹åºï¼Œæˆ‘ä»¬çœ‹çœ‹Tomcatçš„å¯åŠ¨æµç¨‹ï¼š</p>
<ol>
<li>å¯åŠ¨JVMå¹¶æ‰§è¡ŒTomcatçš„<code>main()</code>æ–¹æ³•ï¼›</li>
<li>åŠ è½½warå¹¶åˆå§‹åŒ–Servletï¼›</li>
<li>æ­£å¸¸æœåŠ¡ã€‚</li>
</ol>
<p>å¯åŠ¨Tomcatæ— éå°±æ˜¯è®¾ç½®å¥½classpathå¹¶æ‰§è¡ŒTomcatæŸä¸ªjaråŒ…çš„<code>main()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠTomcatçš„jaråŒ…å…¨éƒ¨å¼•å…¥è¿›æ¥ï¼Œç„¶åè‡ªå·±ç¼–å†™ä¸€ä¸ª<code>main()</code>æ–¹æ³•ï¼Œå…ˆå¯åŠ¨Tomcatï¼Œç„¶åè®©å®ƒåŠ è½½æˆ‘ä»¬çš„webappå°±è¡Œã€‚</p>
<p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ª<code>web-servlet-embedded</code>å·¥ç¨‹ï¼Œç¼–å†™<code>pom.xml</code>å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>&lt;project xmlns=<span style="color:#0ff;font-weight:bold">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style="display:flex;"><span>    xmlns:xsi=<span style="color:#0ff;font-weight:bold">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>    xsi:schemaLocation=<span style="color:#0ff;font-weight:bold">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;modelVersion&gt;4.<span style="color:#007f7f">0</span>.<span style="color:#007f7f">0</span>&lt;/modelVersion&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;groupId&gt;com.<span style="color:#007f7f">itranswarp</span>.<span style="color:#007f7f">learnjava</span>&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>    &lt;artifactId&gt;web-servlet-embedded&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>    &lt;version&gt;1.<span style="color:#007f7f">0</span>-SNAPSHOT&lt;/version&gt;
</span></span><span style="display:flex;"><span>    &lt;packaging&gt;war&lt;/packaging&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;properties&gt;
</span></span><span style="display:flex;"><span>        &lt;project.<span style="color:#007f7f">build</span>.<span style="color:#007f7f">sourceEncoding</span>&gt;UTF-8&lt;/project.<span style="color:#007f7f">build</span>.<span style="color:#007f7f">sourceEncoding</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;project.<span style="color:#007f7f">reporting</span>.<span style="color:#007f7f">outputEncoding</span>&gt;UTF-8&lt;/project.<span style="color:#007f7f">reporting</span>.<span style="color:#007f7f">outputEncoding</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;maven.<span style="color:#007f7f">compiler</span>.<span style="color:#007f7f">source</span>&gt;11&lt;/maven.<span style="color:#007f7f">compiler</span>.<span style="color:#007f7f">source</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;maven.<span style="color:#007f7f">compiler</span>.<span style="color:#007f7f">target</span>&gt;11&lt;/maven.<span style="color:#007f7f">compiler</span>.<span style="color:#007f7f">target</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;java.<span style="color:#007f7f">version</span>&gt;11&lt;/java.<span style="color:#007f7f">version</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;tomcat.<span style="color:#007f7f">version</span>&gt;9.<span style="color:#007f7f">0</span>.<span style="color:#007f7f">26</span>&lt;/tomcat.<span style="color:#007f7f">version</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/properties&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;dependencies&gt;
</span></span><span style="display:flex;"><span>        &lt;dependency&gt;
</span></span><span style="display:flex;"><span>            &lt;groupId&gt;org.<span style="color:#007f7f">apache</span>.<span style="color:#007f7f">tomcat</span>.<span style="color:#007f7f">embed</span>&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>            &lt;artifactId&gt;tomcat-embed-core&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>            &lt;version&gt;${tomcat.<span style="color:#007f7f">version</span>}&lt;/version&gt;
</span></span><span style="display:flex;"><span>            &lt;scope&gt;provided&lt;/scope&gt;
</span></span><span style="display:flex;"><span>        &lt;/dependency&gt;
</span></span><span style="display:flex;"><span>        &lt;dependency&gt;
</span></span><span style="display:flex;"><span>            &lt;groupId&gt;org.<span style="color:#007f7f">apache</span>.<span style="color:#007f7f">tomcat</span>.<span style="color:#007f7f">embed</span>&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>            &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>            &lt;version&gt;${tomcat.<span style="color:#007f7f">version</span>}&lt;/version&gt;
</span></span><span style="display:flex;"><span>            &lt;scope&gt;provided&lt;/scope&gt;
</span></span><span style="display:flex;"><span>        &lt;/dependency&gt;
</span></span><span style="display:flex;"><span>    &lt;/dependencies&gt;
</span></span><span style="display:flex;"><span>&lt;/project&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œ<code>&lt;packaging&gt;</code>ç±»å‹ä»ç„¶ä¸º<code>war</code>ï¼Œå¼•å…¥ä¾èµ–<code>tomcat-embed-core</code>å’Œ<code>tomcat-embed-jasper</code>ï¼Œå¼•å…¥çš„Tomcatç‰ˆæœ¬<code>&lt;tomcat.version&gt;</code>ä¸º<code>9.0.26</code>ã€‚</p>
<p>ä¸å¿…å¼•å…¥Servlet APIï¼Œå› ä¸ºå¼•å…¥Tomcatä¾èµ–åè‡ªåŠ¨å¼•å…¥äº†Servlet APIã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¸¸ç¼–å†™Servletå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HelloServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;text/html&#34;</span>);
</span></span><span style="display:flex;"><span>        String name = req.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (name == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            name = <span style="color:#0ff;font-weight:bold">&#34;world&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        PrintWriter pw = resp.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;Hello, &#34;</span> + name + <span style="color:#0ff;font-weight:bold">&#34;!&lt;/h1&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ª<code>main()</code>æ–¹æ³•ï¼Œå¯åŠ¨TomcatæœåŠ¡å™¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¯åŠ¨Tomcat:</span>
</span></span><span style="display:flex;"><span>        Tomcat tomcat = <span style="color:#fff;font-weight:bold">new</span> Tomcat();
</span></span><span style="display:flex;"><span>        tomcat.<span style="color:#007f7f">setPort</span>(Integer.<span style="color:#007f7f">getInteger</span>(<span style="color:#0ff;font-weight:bold">&#34;port&#34;</span>, 8080));
</span></span><span style="display:flex;"><span>        tomcat.<span style="color:#007f7f">getConnector</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºwebapp:</span>
</span></span><span style="display:flex;"><span>        Context ctx = tomcat.<span style="color:#007f7f">addWebapp</span>(<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;src/main/webapp&#34;</span>).<span style="color:#007f7f">getAbsolutePath</span>());
</span></span><span style="display:flex;"><span>        WebResourceRoot resources = <span style="color:#fff;font-weight:bold">new</span> StandardRoot(ctx);
</span></span><span style="display:flex;"><span>        resources.<span style="color:#007f7f">addPreResources</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> DirResourceSet(resources, <span style="color:#0ff;font-weight:bold">&#34;/WEB-INF/classes&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;target/classes&#34;</span>).<span style="color:#007f7f">getAbsolutePath</span>(), <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>));
</span></span><span style="display:flex;"><span>        ctx.<span style="color:#007f7f">setResources</span>(resources);
</span></span><span style="display:flex;"><span>        tomcat.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        tomcat.<span style="color:#007f7f">getServer</span>().<span style="color:#007f7f">await</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œ<code>main()</code>æ–¹æ³•ï¼Œå³å¯å¯åŠ¨åµŒå…¥å¼TomcatæœåŠ¡å™¨ï¼Œç„¶åï¼Œé€šè¿‡é¢„è®¾çš„<code>tomcat.addWebapp(&quot;&quot;, new File(&quot;src/main/webapp&quot;)</code>ï¼ŒTomcatä¼šè‡ªåŠ¨åŠ è½½å½“å‰å·¥ç¨‹ä½œä¸ºæ ¹webappï¼Œå¯ç›´æ¥åœ¨æµè§ˆå™¨è®¿é—®<code>http://localhost:8080/</code>ã€‚</p>
<p>é€šè¿‡<code>main()</code>æ–¹æ³•å¯åŠ¨TomcatæœåŠ¡å™¨å¹¶åŠ è½½æˆ‘ä»¬è‡ªå·±çš„webappæœ‰å¦‚ä¸‹å¥½å¤„ï¼š</p>
<ol>
<li>å¯åŠ¨ç®€å•ï¼Œæ— éœ€ä¸‹è½½Tomcatæˆ–å®‰è£…ä»»ä½•IDEæ’ä»¶ï¼›</li>
<li>è°ƒè¯•æ–¹ä¾¿ï¼Œå¯åœ¨IDEä¸­ä½¿ç”¨æ–­ç‚¹è°ƒè¯•ï¼›</li>
<li>ä½¿ç”¨Mavenåˆ›å»ºwaråŒ…åï¼Œä¹Ÿå¯ä»¥æ­£å¸¸éƒ¨ç½²åˆ°ç‹¬ç«‹çš„TomcatæœåŠ¡å™¨ä¸­ã€‚</li>
</ol>
<p>å¯¹SpringBootæœ‰æ‰€äº†è§£çš„ç«¥é‹å¯èƒ½çŸ¥é“ï¼ŒSpringBootä¹Ÿæ”¯æŒåœ¨<code>main()</code>æ–¹æ³•ä¸­ä¸€è¡Œä»£ç ç›´æ¥å¯åŠ¨Tomcatï¼Œå¹¶ä¸”è¿˜èƒ½æ–¹ä¾¿åœ°æ›´æ¢æˆJettyç­‰å…¶ä»–æœåŠ¡å™¨ã€‚å®ƒçš„å¯åŠ¨æ–¹å¼å’Œæˆ‘ä»¬ä»‹ç»çš„æ˜¯åŸºæœ¬ä¸€æ ·çš„ï¼Œåç»­æ¶‰åŠåˆ°SpringBootçš„éƒ¨åˆ†æˆ‘ä»¬è¿˜ä¼šè¯¦ç»†è®²è§£ã€‚</p>
<h2 id="å°ç»“-1">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-1">#</a></h2>
<p>å¼€å‘Servletæ—¶ï¼Œæ¨èä½¿ç”¨<code>main()</code>æ–¹æ³•å¯åŠ¨åµŒå…¥å¼TomcatæœåŠ¡å™¨å¹¶åŠ è½½å½“å‰å·¥ç¨‹çš„webappï¼Œä¾¿äºå¼€å‘è°ƒè¯•ï¼Œä¸”ä¸å½±å“æ‰“åŒ…éƒ¨ç½²ï¼Œèƒ½æå¤§åœ°æå‡å¼€å‘æ•ˆç‡ã€‚</p>
<h1 id="servletè¿›é˜¶">Servletè¿›é˜¶<a hidden class="anchor" aria-hidden="true" href="#servletè¿›é˜¶">#</a></h1>
<p>ä¸€ä¸ªWeb Appå°±æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªServletç»„æˆçš„ï¼Œæ¯ä¸ªServleté€šè¿‡æ³¨è§£è¯´æ˜è‡ªå·±èƒ½å¤„ç†çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/hello&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HelloServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°<code>HelloServlet</code>èƒ½å¤„ç†<code>/hello</code>è¿™ä¸ªè·¯å¾„çš„è¯·æ±‚ã€‚</p>
<p>æ³¨æ„ï¼šæ—©æœŸçš„Servletéœ€è¦åœ¨web.xmlä¸­é…ç½®æ˜ å°„è·¯å¾„ï¼Œä½†æœ€æ–°Servletç‰ˆæœ¬åªéœ€è¦é€šè¿‡æ³¨è§£å°±å¯ä»¥å®Œæˆæ˜ å°„ã€‚</p>
<p>å› ä¸ºæµè§ˆå™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œè¿˜ä¼šæœ‰è¯·æ±‚æ–¹æ³•ï¼ˆHTTP Methodï¼‰ï¼šå³GETã€POSTã€PUTç­‰ä¸åŒç±»å‹çš„è¯·æ±‚ã€‚å› æ­¤ï¼Œè¦å¤„ç†GETè¯·æ±‚ï¼Œæˆ‘ä»¬è¦è¦†å†™<code>doGet()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/hello&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HelloServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç±»ä¼¼çš„ï¼Œè¦å¤„ç†POSTè¯·æ±‚ï¼Œå°±éœ€è¦è¦†å†™<code>doPost()</code>æ–¹æ³•ã€‚</p>
<p>å¦‚æœæ²¡æœ‰è¦†å†™<code>doPost()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆ<code>HelloServlet</code>èƒ½ä¸èƒ½å¤„ç†<code>POST /hello</code>è¯·æ±‚å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹<code>HttpServlet</code>çš„<code>doPost()</code>æ–¹æ³•å°±ä¸€ç›®äº†ç„¶äº†ï¼šå®ƒä¼šç›´æ¥è¿”å›405æˆ–400é”™è¯¯ã€‚å› æ­¤ï¼Œä¸€ä¸ªServletå¦‚æœæ˜ å°„åˆ°<code>/hello</code>ï¼Œé‚£ä¹ˆæ‰€æœ‰è¯·æ±‚æ–¹æ³•éƒ½ä¼šç”±è¿™ä¸ªServletå¤„ç†ï¼Œè‡³äºèƒ½ä¸èƒ½è¿”å›200æˆåŠŸå“åº”ï¼Œè¦çœ‹æœ‰æ²¡æœ‰è¦†å†™å¯¹åº”çš„è¯·æ±‚æ–¹æ³•ã€‚</p>
<p>ä¸€ä¸ªWebappå®Œå…¨å¯ä»¥æœ‰å¤šä¸ªServletï¼Œåˆ†åˆ«æ˜ å°„ä¸åŒçš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/hello&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HelloServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/signin&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SignInServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> IndexServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµè§ˆå™¨å‘å‡ºçš„HTTPè¯·æ±‚æ€»æ˜¯ç”±Web Serverå…ˆæ¥æ”¶ï¼Œç„¶åï¼Œæ ¹æ®Servleté…ç½®çš„æ˜ å°„ï¼Œä¸åŒçš„è·¯å¾„è½¬å‘åˆ°ä¸åŒçš„Servletï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>               â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>               â”‚            /hello    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
</span></span><span style="display:flex;"><span>                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ HelloServlet  â”‚
</span></span><span style="display:flex;"><span>               â”‚          â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ /signin   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚Browserâ”‚â”€â”€â”€&gt;â”‚Dispatcherâ”‚â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ SignInServlet â”‚â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>               â”‚          â”‚ /         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
</span></span><span style="display:flex;"><span>                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ IndexServlet  â”‚
</span></span><span style="display:flex;"><span>               â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
</span></span><span style="display:flex;"><span>                              Web Server
</span></span><span style="display:flex;"><span>               â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ ¹æ®è·¯å¾„è½¬å‘çš„åŠŸèƒ½æˆ‘ä»¬ä¸€èˆ¬ç§°ä¸ºDispatchã€‚æ˜ å°„åˆ°<code>/</code>çš„<code>IndexServlet</code>æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒå®é™…ä¸Šä¼šæ¥æ”¶æ‰€æœ‰æœªåŒ¹é…çš„è·¯å¾„ï¼Œç›¸å½“äº<code>/*</code>ï¼Œå› ä¸ºDispatcherçš„é€»è¾‘å¯ä»¥ç”¨ä¼ªä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String path = ...
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (path.<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;/hello&#34;</span>)) {
</span></span><span style="display:flex;"><span>    dispatchTo(helloServlet);
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (path.<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;/signin&#34;</span>)) {
</span></span><span style="display:flex;"><span>    dispatchTo(signinServlet);
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ‰€æœ‰æœªåŒ¹é…çš„è·¯å¾„å‡è½¬å‘åˆ°&#34;/&#34;</span>
</span></span><span style="display:flex;"><span>    dispatchTo(indexServlet);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥æˆ‘ä»¬åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ª<code>http://localhost:8080/abc</code>ä¹Ÿä¼šçœ‹åˆ°<code>IndexServlet</code>ç”Ÿæˆçš„é¡µé¢ã€‚</p>
<h2 id="httpservletrequest">HttpServletRequest<a hidden class="anchor" aria-hidden="true" href="#httpservletrequest">#</a></h2>
<p><code>HttpServletRequest</code>å°è£…äº†ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä»<code>ServletRequest</code>ç»§æ‰¿è€Œæ¥ã€‚æœ€æ—©è®¾è®¡Servletæ—¶ï¼Œè®¾è®¡è€…å¸Œæœ›Servletä¸ä»…èƒ½å¤„ç†HTTPï¼Œä¹Ÿèƒ½å¤„ç†ç±»ä¼¼SMTPç­‰å…¶ä»–åè®®ï¼Œå› æ­¤ï¼Œå•ç‹¬æŠ½å‡ºäº†<code>ServletRequest</code>æ¥å£ï¼Œä½†å®é™…ä¸Šé™¤äº†HTTPå¤–ï¼Œå¹¶æ²¡æœ‰å…¶ä»–åè®®ä¼šç”¨Servletå¤„ç†ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªè¿‡åº¦è®¾è®¡ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡<code>HttpServletRequest</code>æä¾›çš„æ¥å£æ–¹æ³•å¯ä»¥æ‹¿åˆ°HTTPè¯·æ±‚çš„å‡ ä¹å…¨éƒ¨ä¿¡æ¯ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>getMethod()ï¼šè¿”å›è¯·æ±‚æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œ<code>&quot;GET&quot;</code>ï¼Œ<code>&quot;POST&quot;</code>ï¼›</li>
<li>getRequestURI()ï¼šè¿”å›è¯·æ±‚è·¯å¾„ï¼Œä½†ä¸åŒ…æ‹¬è¯·æ±‚å‚æ•°ï¼Œä¾‹å¦‚ï¼Œ<code>&quot;/hello&quot;</code>ï¼›</li>
<li>getQueryString()ï¼šè¿”å›è¯·æ±‚å‚æ•°ï¼Œä¾‹å¦‚ï¼Œ<code>&quot;name=Bob&amp;a=1&amp;b=2&quot;</code>ï¼›</li>
<li>getParameter(name)ï¼šè¿”å›è¯·æ±‚å‚æ•°ï¼ŒGETè¯·æ±‚ä»URLè¯»å–å‚æ•°ï¼ŒPOSTè¯·æ±‚ä»Bodyä¸­è¯»å–å‚æ•°ï¼›</li>
<li>getContentType()ï¼šè·å–è¯·æ±‚Bodyçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼Œ<code>&quot;application/x-www-form-urlencoded&quot;</code>ï¼›</li>
<li>getContextPath()ï¼šè·å–å½“å‰WebappæŒ‚è½½çš„è·¯å¾„ï¼Œå¯¹äºROOTæ¥è¯´ï¼Œæ€»æ˜¯è¿”å›ç©ºå­—ç¬¦ä¸²<code>&quot;&quot;</code>ï¼›</li>
<li>getCookies()ï¼šè¿”å›è¯·æ±‚æºå¸¦çš„æ‰€æœ‰Cookieï¼›</li>
<li>getHeader(name)ï¼šè·å–æŒ‡å®šçš„Headerï¼Œå¯¹Headeråç§°ä¸åŒºåˆ†å¤§å°å†™ï¼›</li>
<li>getHeaderNames()ï¼šè¿”å›æ‰€æœ‰Headeråç§°ï¼›</li>
<li>getInputStream()ï¼šå¦‚æœè¯¥è¯·æ±‚å¸¦æœ‰HTTP Bodyï¼Œè¯¥æ–¹æ³•å°†æ‰“å¼€ä¸€ä¸ªè¾“å…¥æµç”¨äºè¯»å–Bodyï¼›</li>
<li>getReader()ï¼šå’ŒgetInputStream()ç±»ä¼¼ï¼Œä½†æ‰“å¼€çš„æ˜¯Readerï¼›</li>
<li>getRemoteAddr()ï¼šè¿”å›å®¢æˆ·ç«¯çš„IPåœ°å€ï¼›</li>
<li>getScheme()ï¼šè¿”å›åè®®ç±»å‹ï¼Œä¾‹å¦‚ï¼Œ<code>&quot;http&quot;</code>ï¼Œ<code>&quot;https&quot;</code>ï¼›</li>
</ul>
<p>æ­¤å¤–ï¼Œ<code>HttpServletRequest</code>è¿˜æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š<code>setAttribute()</code>å’Œ<code>getAttribute()</code>ï¼Œå¯ä»¥ç»™å½“å‰<code>HttpServletRequest</code>å¯¹è±¡é™„åŠ å¤šä¸ªKey-Valueï¼Œç›¸å½“äºæŠŠ<code>HttpServletRequest</code>å½“ä½œä¸€ä¸ª<code>Map&lt;String, Object&gt;</code>ä½¿ç”¨ã€‚</p>
<p>è°ƒç”¨<code>HttpServletRequest</code>çš„æ–¹æ³•æ—¶ï¼Œæ³¨æ„åŠ¡å¿…é˜…è¯»æ¥å£æ–¹æ³•çš„æ–‡æ¡£è¯´æ˜ï¼Œå› ä¸ºæœ‰çš„æ–¹æ³•ä¼šè¿”å›<code>null</code>ï¼Œä¾‹å¦‚<code>getQueryString()</code>çš„æ–‡æ¡£å°±å†™äº†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>... This method returns null if the URL does not have a query string...
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="httpservletresponse">HttpServletResponse<a hidden class="anchor" aria-hidden="true" href="#httpservletresponse">#</a></h2>
<p><code>HttpServletResponse</code>å°è£…äº†ä¸€ä¸ªHTTPå“åº”ã€‚ç”±äºHTTPå“åº”å¿…é¡»å…ˆå‘é€Headerï¼Œå†å‘é€Bodyï¼Œæ‰€ä»¥ï¼Œæ“ä½œ<code>HttpServletResponse</code>å¯¹è±¡æ—¶ï¼Œå¿…é¡»å…ˆè°ƒç”¨è®¾ç½®Headerçš„æ–¹æ³•ï¼Œæœ€åè°ƒç”¨å‘é€Bodyçš„æ–¹æ³•ã€‚</p>
<p>å¸¸ç”¨çš„è®¾ç½®Headerçš„æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>setStatus(sc)ï¼šè®¾ç½®å“åº”ä»£ç ï¼Œé»˜è®¤æ˜¯<code>200</code>ï¼›</li>
<li>setContentType(type)ï¼šè®¾ç½®Bodyçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼Œ<code>&quot;text/html&quot;</code>ï¼›</li>
<li>setCharacterEncoding(charset)ï¼šè®¾ç½®å­—ç¬¦ç¼–ç ï¼Œä¾‹å¦‚ï¼Œ<code>&quot;UTF-8&quot;</code>ï¼›</li>
<li>setHeader(name, value)ï¼šè®¾ç½®ä¸€ä¸ªHeaderçš„å€¼ï¼›</li>
<li>addCookie(cookie)ï¼šç»™å“åº”æ·»åŠ ä¸€ä¸ªCookieï¼›</li>
<li>addHeader(name, value)ï¼šç»™å“åº”æ·»åŠ ä¸€ä¸ªHeaderï¼Œå› ä¸ºHTTPåè®®å…è®¸æœ‰å¤šä¸ªç›¸åŒçš„Headerï¼›</li>
</ul>
<p>å†™å…¥å“åº”æ—¶ï¼Œéœ€è¦é€šè¿‡<code>getOutputStream()</code>è·å–å†™å…¥æµï¼Œæˆ–è€…é€šè¿‡<code>getWriter()</code>è·å–å­—ç¬¦æµï¼ŒäºŒè€…åªèƒ½è·å–å…¶ä¸­ä¸€ä¸ªã€‚</p>
<p>å†™å…¥å“åº”æ—¶ï¼Œéœ€è¦é€šè¿‡<code>getOutputStream()</code>è·å–å†™å…¥æµï¼Œæˆ–è€…é€šè¿‡<code>getWriter()</code>è·å–å­—ç¬¦æµï¼ŒäºŒè€…åªèƒ½è·å–å…¶ä¸­ä¸€ä¸ªã€‚</p>
<p>å†™å…¥å“åº”å‰ï¼Œæ— éœ€è®¾ç½®<code>setContentLength()</code>ï¼Œå› ä¸ºåº•å±‚æœåŠ¡å™¨ä¼šæ ¹æ®å†™å…¥çš„å­—èŠ‚æ•°è‡ªåŠ¨è®¾ç½®ï¼Œå¦‚æœå†™å…¥çš„æ•°æ®é‡å¾ˆå°ï¼Œå®é™…ä¸Šä¼šå…ˆå†™å…¥ç¼“å†²åŒºï¼Œå¦‚æœå†™å…¥çš„æ•°æ®é‡å¾ˆå¤§ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨é‡‡ç”¨Chunkedç¼–ç è®©æµè§ˆå™¨èƒ½è¯†åˆ«æ•°æ®ç»“æŸç¬¦è€Œä¸éœ€è¦è®¾ç½®Content-Lengthå¤´ã€‚</p>
<p>ä½†æ˜¯ï¼Œå†™å…¥å®Œæ¯•åè°ƒç”¨<code>flush()</code>å´æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºå¤§éƒ¨åˆ†WebæœåŠ¡å™¨éƒ½åŸºäºHTTP/1.1åè®®ï¼Œä¼šå¤ç”¨TCPè¿æ¥ã€‚å¦‚æœæ²¡æœ‰è°ƒç”¨<code>flush()</code>ï¼Œå°†å¯¼è‡´ç¼“å†²åŒºçš„å†…å®¹æ— æ³•åŠæ—¶å‘é€åˆ°å®¢æˆ·ç«¯ã€‚æ­¤å¤–ï¼Œå†™å…¥å®Œæ¯•ååƒä¸‡ä¸è¦è°ƒç”¨<code>close()</code>ï¼ŒåŸå› åŒæ ·æ˜¯å› ä¸ºä¼šå¤ç”¨TCPè¿æ¥ï¼Œå¦‚æœå…³é—­å†™å…¥æµï¼Œå°†å…³é—­TCPè¿æ¥ï¼Œä½¿å¾—WebæœåŠ¡å™¨æ— æ³•å¤ç”¨æ­¤TCPè¿æ¥ã€‚</p>
<p>æ³¨æ„ï¼šå†™å…¥å®Œæ¯•åå¯¹è¾“å‡ºæµè°ƒç”¨flush()è€Œä¸æ˜¯close()æ–¹æ³•ï¼</p>
<p>æœ‰äº†<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>è¿™ä¸¤ä¸ªé«˜çº§æ¥å£ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦ç›´æ¥å¤„ç†HTTPåè®®ã€‚æ³¨æ„åˆ°å…·ä½“çš„å®ç°ç±»æ˜¯ç”±å„æœåŠ¡å™¨æä¾›çš„ï¼Œè€Œæˆ‘ä»¬ç¼–å†™çš„Webåº”ç”¨ç¨‹åºåªå…³å¿ƒæ¥å£æ–¹æ³•ï¼Œå¹¶ä¸éœ€è¦å…³å¿ƒå…·ä½“å®ç°çš„å­ç±»ã€‚</p>
<h2 id="servletå¤šçº¿ç¨‹æ¨¡å‹">Servletå¤šçº¿ç¨‹æ¨¡å‹<a hidden class="anchor" aria-hidden="true" href="#servletå¤šçº¿ç¨‹æ¨¡å‹">#</a></h2>
<p>ä¸€ä¸ªServletç±»åœ¨æœåŠ¡å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä½†å¯¹äºæ¯ä¸ªHTTPè¯·æ±‚ï¼ŒWebæœåŠ¡å™¨ä¼šä½¿ç”¨å¤šçº¿ç¨‹æ‰§è¡Œè¯·æ±‚ã€‚å› æ­¤ï¼Œä¸€ä¸ªServletçš„<code>doGet()</code>ã€<code>doPost()</code>ç­‰å¤„ç†è¯·æ±‚çš„æ–¹æ³•æ˜¯å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„ã€‚å¦‚æœServletä¸­å®šä¹‰äº†å­—æ®µï¼Œè¦æ³¨æ„å¤šçº¿ç¨‹å¹¶å‘è®¿é—®çš„é—®é¢˜ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>public <span style="color:#fff;font-weight:bold">class</span> HelloServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    private Map&lt;String, String&gt; map = new ConcurrentHashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
</span></span><span style="display:flex;"><span>        // <span style="color:#f00">æ³¨æ„è¯»å†™</span>mapå­—æ®µæ˜¯å¤šçº¿ç¨‹å¹¶å‘çš„:
</span></span><span style="display:flex;"><span>        this.map.put(key, value);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºæ¯ä¸ªè¯·æ±‚ï¼ŒWebæœåŠ¡å™¨ä¼šåˆ›å»ºå”¯ä¸€çš„<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å®ä¾‹ï¼Œå› æ­¤ï¼Œ<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å®ä¾‹åªæœ‰åœ¨å½“å‰å¤„ç†çº¿ç¨‹ä¸­æœ‰æ•ˆï¼Œå®ƒä»¬æ€»æ˜¯å±€éƒ¨å˜é‡ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹å…±äº«çš„é—®é¢˜ã€‚</p>
<h2 id="å°ç»“-2">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-2">#</a></h2>
<p>ä¸€ä¸ªWebappä¸­çš„å¤šä¸ªServletä¾é è·¯å¾„æ˜ å°„æ¥å¤„ç†ä¸åŒçš„è¯·æ±‚ï¼›</p>
<p>æ˜ å°„ä¸º<code>/</code>çš„Servletå¯å¤„ç†æ‰€æœ‰â€œæœªåŒ¹é…â€çš„è¯·æ±‚ï¼›</p>
<p>å¦‚ä½•å¤„ç†è¯·æ±‚å–å†³äºServletè¦†å†™çš„å¯¹åº”æ–¹æ³•ï¼›</p>
<p>WebæœåŠ¡å™¨é€šè¿‡å¤šçº¿ç¨‹å¤„ç†HTTPè¯·æ±‚ï¼Œä¸€ä¸ªServletçš„å¤„ç†æ–¹æ³•å¯ä»¥ç”±å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚</p>
<h1 id="é‡å®šå‘ä¸è½¬å‘">é‡å®šå‘ä¸è½¬å‘<a hidden class="anchor" aria-hidden="true" href="#é‡å®šå‘ä¸è½¬å‘">#</a></h1>
<h2 id="redirect">Redirect<a hidden class="anchor" aria-hidden="true" href="#redirect">#</a></h2>
<p>é‡å®šå‘æ˜¯æŒ‡å½“æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªURLæ—¶ï¼ŒæœåŠ¡å™¨è¿”å›ä¸€ä¸ªé‡å®šå‘æŒ‡ä»¤ï¼Œå‘Šè¯‰æµè§ˆå™¨åœ°å€å·²ç»å˜äº†ï¼Œéº»çƒ¦ä½¿ç”¨æ–°çš„URLå†é‡æ–°å‘é€æ–°è¯·æ±‚ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™äº†ä¸€ä¸ªèƒ½å¤„ç†<code>/hello</code>çš„<code>HelloServlet</code>ï¼Œå¦‚æœæ”¶åˆ°çš„è·¯å¾„ä¸º<code>/hi</code>ï¼Œå¸Œæœ›èƒ½é‡å®šå‘åˆ°<code>/hello</code>ï¼Œå¯ä»¥å†ç¼–å†™ä¸€ä¸ª<code>RedirectServlet</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/hi&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RedirectServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ„é€ é‡å®šå‘çš„è·¯å¾„:</span>
</span></span><span style="display:flex;"><span>        String name = req.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>);
</span></span><span style="display:flex;"><span>        String redirectToUrl = <span style="color:#0ff;font-weight:bold">&#34;/hello&#34;</span> + (name == <span style="color:#fff;font-weight:bold">null</span> ? <span style="color:#0ff;font-weight:bold">&#34;&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;?name=&#34;</span> + name);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å‘é€é‡å®šå‘å“åº”:</span>
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">sendRedirect</span>(redirectToUrl);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæµè§ˆå™¨å‘é€<code>GET /hi</code>è¯·æ±‚ï¼Œ<code>RedirectServlet</code>å°†å¤„ç†æ­¤è¯·æ±‚ã€‚ç”±äº<code>RedirectServlet</code>åœ¨å†…éƒ¨åˆå‘é€äº†é‡å®šå‘å“åº”ï¼Œå› æ­¤ï¼Œæµè§ˆå™¨ä¼šæ”¶åˆ°å¦‚ä¸‹å“åº”ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>HTTP/1.1 302 Found
</span></span><span style="display:flex;"><span>Location: /hello
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“æµè§ˆå™¨æ”¶åˆ°302å“åº”åï¼Œå®ƒä¼šç«‹åˆ»æ ¹æ®<code>Location</code>çš„æŒ‡ç¤ºå‘é€ä¸€ä¸ªæ–°çš„<code>GET /hello</code>è¯·æ±‚ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯é‡å®šå‘ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”   GET /hi     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚Browserâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt; â”‚RedirectServletâ”‚
</span></span><span style="display:flex;"><span>â”‚       â”‚ &lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚               â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜   302         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”  GET /hello   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚Browserâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt; â”‚ HelloServlet  â”‚
</span></span><span style="display:flex;"><span>â”‚       â”‚ &lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚               â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜   200 &lt;html&gt;  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§‚å¯ŸChromeæµè§ˆå™¨çš„ç½‘ç»œè¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤æ¬¡HTTPè¯·æ±‚ã€‚</p>
<p>å¹¶ä¸”æµè§ˆå™¨çš„åœ°å€æ è·¯å¾„è‡ªåŠ¨æ›´æ–°ä¸º<code>/hello</code>ã€‚</p>
<p>é‡å®šå‘æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯302å“åº”ï¼Œç§°ä¸ºä¸´æ—¶é‡å®šå‘ï¼Œä¸€ç§æ˜¯301å“åº”ï¼Œç§°ä¸ºæ°¸ä¹…é‡å®šå‘ã€‚ä¸¤è€…çš„åŒºåˆ«æ˜¯ï¼Œå¦‚æœæœåŠ¡å™¨å‘é€301æ°¸ä¹…é‡å®šå‘å“åº”ï¼Œæµè§ˆå™¨ä¼šç¼“å­˜<code>/hi</code>åˆ°<code>/hello</code>è¿™ä¸ªé‡å®šå‘çš„å…³è”ï¼Œä¸‹æ¬¡è¯·æ±‚<code>/hi</code>çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°±ç›´æ¥å‘é€<code>/hello</code>è¯·æ±‚äº†ã€‚</p>
<p>é‡å®šå‘æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿé‡å®šå‘çš„ç›®çš„æ˜¯å½“Webåº”ç”¨å‡çº§åï¼Œå¦‚æœè¯·æ±‚è·¯å¾„å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯ä»¥å°†åŸæ¥çš„è·¯å¾„é‡å®šå‘åˆ°æ–°è·¯å¾„ï¼Œä»è€Œé¿å…æµè§ˆå™¨è¯·æ±‚åŸè·¯å¾„æ‰¾ä¸åˆ°èµ„æºã€‚</p>
<p><code>HttpServletResponse</code>æä¾›äº†å¿«æ·çš„<code>redirect()</code>æ–¹æ³•å®ç°302é‡å®šå‘ã€‚å¦‚æœè¦å®ç°301æ°¸ä¹…é‡å®šå‘ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>resp.<span style="color:#007f7f">setStatus</span>(HttpServletResponse.<span style="color:#007f7f">SC_MOVED_PERMANENTLY</span>); <span style="color:#007f7f">// 301</span>
</span></span><span style="display:flex;"><span>resp.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Location&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;/hello&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="forward">Forward<a hidden class="anchor" aria-hidden="true" href="#forward">#</a></h2>
<p>Forwardæ˜¯æŒ‡å†…éƒ¨è½¬å‘ã€‚å½“ä¸€ä¸ªServletå¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼Œå®ƒå¯ä»¥å†³å®šè‡ªå·±ä¸ç»§ç»­å¤„ç†ï¼Œè€Œæ˜¯è½¬å‘ç»™å¦ä¸€ä¸ªServletå¤„ç†ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™äº†ä¸€ä¸ªèƒ½å¤„ç†<code>/hello</code>çš„<code>HelloServlet</code>ï¼Œç»§ç»­ç¼–å†™ä¸€ä¸ªèƒ½å¤„ç†<code>/morning</code>çš„<code>ForwardServlet</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f00">@</span>WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/morning&#34;</span>)
</span></span><span style="display:flex;"><span>public <span style="color:#fff;font-weight:bold">class</span> ForwardServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
</span></span><span style="display:flex;"><span>        req.getRequestDispatcher(<span style="color:#0ff;font-weight:bold">&#34;/hello&#34;</span>).forward(req, resp);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ForwardServlet</code>åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œå®ƒå¹¶ä¸è‡ªå·±å‘é€å“åº”ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚å’Œå“åº”éƒ½è½¬å‘ç»™è·¯å¾„ä¸º<code>/hello</code>çš„Servletï¼Œå³ä¸‹é¢çš„ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>req.getRequestDispatcher(&#34;/hello&#34;).forward(req, resp);
</span></span></code></pre></td></tr></table>
</div>
</div><p>åç»­è¯·æ±‚çš„å¤„ç†å®é™…ä¸Šæ˜¯ç”±<code>HelloServlet</code>å®Œæˆçš„ã€‚è¿™ç§å¤„ç†æ–¹å¼ç§°ä¸ºè½¬å‘ï¼ˆForwardï¼‰ï¼Œæˆ‘ä»¬ç”¨æµç¨‹å›¾ç”»å‡ºæ¥å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                          â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>                          â”‚ â”€â”€â”€â”€&gt;â”‚ForwardServlet â”‚ â”‚
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”  GET /morning   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>â”‚Browserâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt; â”‚              â”‚         â”‚
</span></span><span style="display:flex;"><span>â”‚       â”‚ &lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â–¼         â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜    200 &lt;html&gt;   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>                          â”‚ &lt;â”€â”€â”€â”€â”‚ HelloServlet  â”‚ â”‚
</span></span><span style="display:flex;"><span>                          â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>                          â”‚       Web Server       â”‚
</span></span><span style="display:flex;"><span>                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>è½¬å‘å’Œé‡å®šå‘çš„åŒºåˆ«åœ¨äºï¼Œè½¬å‘æ˜¯åœ¨WebæœåŠ¡å™¨å†…éƒ¨å®Œæˆçš„ï¼Œå¯¹æµè§ˆå™¨æ¥è¯´ï¼Œå®ƒåªå‘å‡ºäº†ä¸€ä¸ªHTTPè¯·æ±‚ã€‚</p>
<p>æ³¨æ„åˆ°ä½¿ç”¨è½¬å‘çš„æ—¶å€™ï¼Œæµè§ˆå™¨çš„åœ°å€æ è·¯å¾„ä»ç„¶æ˜¯<code>/morning</code>ï¼Œæµè§ˆå™¨å¹¶ä¸çŸ¥é“è¯¥è¯·æ±‚åœ¨WebæœåŠ¡å™¨å†…éƒ¨å®é™…ä¸Šåšäº†ä¸€æ¬¡è½¬å‘ã€‚</p>
<h1 id="ä½¿ç”¨sessionå’Œcookie">ä½¿ç”¨Sessionå’ŒCookie<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨sessionå’Œcookie">#</a></h1>
<p>åœ¨Webåº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ç»å¸¸è¦è·Ÿè¸ªç”¨æˆ·èº«ä»½ã€‚å½“ä¸€ä¸ªç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå¦‚æœä»–ç»§ç»­è®¿é—®å…¶ä»–é¡µé¢ï¼ŒWebç¨‹åºå¦‚ä½•æ‰èƒ½è¯†åˆ«å‡ºè¯¥ç”¨æˆ·èº«ä»½ï¼Ÿ</p>
<p>å› ä¸ºHTTPåè®®æ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ï¼Œå³Webåº”ç”¨ç¨‹åºæ— æ³•åŒºåˆ†æ”¶åˆ°çš„ä¸¤ä¸ªHTTPè¯·æ±‚æ˜¯å¦æ˜¯åŒä¸€ä¸ªæµè§ˆå™¨å‘å‡ºçš„ã€‚ä¸ºäº†è·Ÿè¸ªç”¨æˆ·çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘æµè§ˆå™¨åˆ†é…ä¸€ä¸ªå”¯ä¸€IDï¼Œå¹¶ä»¥Cookieçš„å½¢å¼å‘é€åˆ°æµè§ˆå™¨ï¼Œæµè§ˆå™¨åœ¨åç»­è®¿é—®æ—¶æ€»æ˜¯é™„å¸¦æ­¤Cookieï¼Œè¿™æ ·ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥è¯†åˆ«ç”¨æˆ·èº«ä»½ã€‚</p>
<h2 id="session">Session<a hidden class="anchor" aria-hidden="true" href="#session">#</a></h2>
<p>æˆ‘ä»¬æŠŠè¿™ç§åŸºäºå”¯ä¸€IDè¯†åˆ«ç”¨æˆ·èº«ä»½çš„æœºåˆ¶ç§°ä¸ºSessionã€‚æ¯ä¸ªç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨åï¼Œä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ªSession IDã€‚å¦‚æœç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰è®¿é—®æœåŠ¡å™¨ï¼Œé‚£ä¹ˆSessionä¼šè‡ªåŠ¨å¤±æ•ˆï¼Œä¸‹æ¬¡å³ä½¿å¸¦ç€ä¸Šæ¬¡åˆ†é…çš„Session IDè®¿é—®ï¼ŒæœåŠ¡å™¨ä¹Ÿè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œä¼šåˆ†é…æ–°çš„Session IDã€‚</p>
<p>JavaEEçš„Servletæœºåˆ¶å†…å»ºäº†å¯¹Sessionçš„æ”¯æŒã€‚æˆ‘ä»¬ä»¥ç™»å½•ä¸ºä¾‹ï¼Œå½“ä¸€ä¸ªç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™ä¸ªç”¨æˆ·çš„åå­—æ”¾å…¥ä¸€ä¸ª<code>HttpSession</code>å¯¹è±¡ï¼Œä»¥ä¾¿åç»­è®¿é—®å…¶ä»–é¡µé¢çš„æ—¶å€™ï¼Œèƒ½ç›´æ¥ä»<code>HttpSession</code>å–å‡ºç”¨æˆ·åï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/signin&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SignInServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ¨¡æ‹Ÿä¸€ä¸ªæ•°æ®åº“:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Map&lt;String, String&gt; users = Map.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;bob&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;bob123&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;alice&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;alice123&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;tom&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;tomcat&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// GETè¯·æ±‚æ—¶æ˜¾ç¤ºç™»å½•é¡µ:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;text/html&#34;</span>);
</span></span><span style="display:flex;"><span>        PrintWriter pw = resp.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;Sign In&lt;/h1&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;form action=\&#34;/signin\&#34; method=\&#34;post\&#34;&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;p&gt;Username: &lt;input name=\&#34;username\&#34;&gt;&lt;/p&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;p&gt;Password: &lt;input name=\&#34;password\&#34; type=\&#34;password\&#34;&gt;&lt;/p&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;p&gt;&lt;button type=\&#34;submit\&#34;&gt;Sign In&lt;/button&gt; &lt;a href=\&#34;/\&#34;&gt;Cancel&lt;/a&gt;&lt;/p&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;/form&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// POSTè¯·æ±‚æ—¶å¤„ç†ç”¨æˆ·ç™»å½•:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doPost(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        String name = req.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;username&#34;</span>);
</span></span><span style="display:flex;"><span>        String password = req.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>);
</span></span><span style="display:flex;"><span>        String expectedPassword = users.<span style="color:#007f7f">get</span>(name.<span style="color:#007f7f">toLowerCase</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (expectedPassword != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; expectedPassword.<span style="color:#007f7f">equals</span>(password)) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// ç™»å½•æˆåŠŸ:</span>
</span></span><span style="display:flex;"><span>            req.<span style="color:#007f7f">getSession</span>().<span style="color:#007f7f">setAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>, name);
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">sendRedirect</span>(<span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">sendError</span>(HttpServletResponse.<span style="color:#007f7f">SC_FORBIDDEN</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°<code>SignInServlet</code>åœ¨åˆ¤æ–­ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œç«‹åˆ»å°†ç”¨æˆ·åæ”¾å…¥å½“å‰<code>HttpSession</code>ä¸­ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>HttpSession session = req.getSession();
</span></span><span style="display:flex;"><span>session.setAttribute(&#34;user&#34;, name);
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>IndexServlet</code>ä¸­ï¼Œå¯ä»¥ä»<code>HttpSession</code>å–å‡ºç”¨æˆ·åï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> IndexServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä»HttpSessionè·å–å½“å‰ç”¨æˆ·å:</span>
</span></span><span style="display:flex;"><span>        String user = (String) req.<span style="color:#007f7f">getSession</span>().<span style="color:#007f7f">getAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>);
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;text/html&#34;</span>);
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setCharacterEncoding</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;X-Powered-By&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;JavaEE Servlet&#34;</span>);
</span></span><span style="display:flex;"><span>        PrintWriter pw = resp.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;Welcome, &#34;</span> + (user != <span style="color:#fff;font-weight:bold">null</span> ? user : <span style="color:#0ff;font-weight:bold">&#34;Guest&#34;</span>) + <span style="color:#0ff;font-weight:bold">&#34;&lt;/h1&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (user == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•é“¾æ¥:</span>
</span></span><span style="display:flex;"><span>            pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;p&gt;&lt;a href=\&#34;/signin\&#34;&gt;Sign In&lt;/a&gt;&lt;/p&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å·²ç™»å½•ï¼Œæ˜¾ç¤ºç™»å‡ºé“¾æ¥:</span>
</span></span><span style="display:flex;"><span>            pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;p&gt;&lt;a href=\&#34;/signout\&#34;&gt;Sign Out&lt;/a&gt;&lt;/p&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œå¯ä»¥é€šè¿‡è®¿é—®<code>/signout</code>ç™»å‡ºã€‚ç™»å‡ºé€»è¾‘å°±æ˜¯ä»<code>HttpSession</code>ä¸­ç§»é™¤ç”¨æˆ·ç›¸å…³ä¿¡æ¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/signout&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SignOutServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä»HttpSessionç§»é™¤ç”¨æˆ·å:</span>
</span></span><span style="display:flex;"><span>        req.<span style="color:#007f7f">getSession</span>().<span style="color:#007f7f">removeAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>);
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">sendRedirect</span>(<span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºWebåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œæˆ‘ä»¬æ€»æ˜¯é€šè¿‡<code>HttpSession</code>è¿™ä¸ªé«˜çº§æ¥å£è®¿é—®å½“å‰Sessionã€‚å¦‚æœè¦æ·±å…¥ç†è§£SessionåŸç†ï¼Œå¯ä»¥è®¤ä¸ºWebæœåŠ¡å™¨åœ¨å†…å­˜ä¸­è‡ªåŠ¨ç»´æŠ¤äº†ä¸€ä¸ªIDåˆ°<code>HttpSession</code>çš„æ˜ å°„è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>           â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>           â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
</span></span><span style="display:flex;"><span>             â”Œâ”€â”€â”€&gt;â”‚ IndexServlet  â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>           â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â–¼    â”‚
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚Browserâ”‚â”€â”€â”¼â”€â”¼â”€â”€â”€&gt;â”‚ SignInServlet â”‚&lt;â”€â”€â”€â”€&gt;â”‚Sessionsâ”‚â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>           â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â–²    â”‚
</span></span><span style="display:flex;"><span>             â””â”€â”€â”€&gt;â”‚SignOutServlet â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>           â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>           â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>è€ŒæœåŠ¡å™¨è¯†åˆ«Sessionçš„å…³é”®å°±æ˜¯ä¾é ä¸€ä¸ªåä¸º<code>JSESSIONID</code>çš„Cookieã€‚åœ¨Servletä¸­ç¬¬ä¸€æ¬¡è°ƒç”¨<code>req.getSession()</code>æ—¶ï¼ŒServletå®¹å™¨è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªSession IDï¼Œç„¶åé€šè¿‡ä¸€ä¸ªåä¸º<code>JSESSIONID</code>çš„Cookieå‘é€ç»™æµè§ˆå™¨ã€‚</p>
<p>è¿™é‡Œè¦æ³¨æ„çš„å‡ ç‚¹æ˜¯ï¼š</p>
<ul>
<li><code>JSESSIONID</code>æ˜¯ç”±Servletå®¹å™¨è‡ªåŠ¨åˆ›å»ºçš„ï¼Œç›®çš„æ˜¯ç»´æŠ¤ä¸€ä¸ªæµè§ˆå™¨ä¼šè¯ï¼Œå®ƒå’Œæˆ‘ä»¬çš„ç™»å½•é€»è¾‘æ²¡æœ‰å…³ç³»ï¼›</li>
<li>ç™»å½•å’Œç™»å‡ºçš„ä¸šåŠ¡é€»è¾‘æ˜¯æˆ‘ä»¬è‡ªå·±æ ¹æ®<code>HttpSession</code>æ˜¯å¦å­˜åœ¨ä¸€ä¸ª<code>&quot;user&quot;</code>çš„Keyåˆ¤æ–­çš„ï¼Œç™»å‡ºåï¼ŒSession IDå¹¶ä¸ä¼šæ”¹å˜ï¼›</li>
<li>å³ä½¿æ²¡æœ‰ç™»å½•åŠŸèƒ½ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨<code>HttpSession</code>è¿½è¸ªç”¨æˆ·ï¼Œä¾‹å¦‚ï¼Œæ”¾å…¥ä¸€äº›ç”¨æˆ·é…ç½®ä¿¡æ¯ç­‰ã€‚</li>
</ul>
<p>é™¤äº†ä½¿ç”¨Cookieæœºåˆ¶å¯ä»¥å®ç°Sessionå¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡éšè—è¡¨å•ã€URLæœ«å°¾é™„åŠ IDæ¥è¿½è¸ªSessionã€‚è¿™äº›æœºåˆ¶å¾ˆå°‘ä½¿ç”¨ï¼Œæœ€å¸¸ç”¨çš„Sessionæœºåˆ¶ä»ç„¶æ˜¯Cookieã€‚</p>
<p>ä½¿ç”¨Sessionæ—¶ï¼Œç”±äºæœåŠ¡å™¨æŠŠæ‰€æœ‰ç”¨æˆ·çš„Sessionéƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœé‡åˆ°å†…å­˜ä¸è¶³çš„æƒ…å†µï¼Œå°±éœ€è¦æŠŠéƒ¨åˆ†ä¸æ´»åŠ¨çš„Sessionåºåˆ—åŒ–åˆ°ç£ç›˜ä¸Šï¼Œè¿™ä¼šå¤§å¤§é™ä½æœåŠ¡å™¨çš„è¿è¡Œæ•ˆç‡ï¼Œå› æ­¤ï¼Œæ”¾å…¥Sessionçš„å¯¹è±¡è¦å°ï¼Œé€šå¸¸æˆ‘ä»¬æ”¾å…¥ä¸€ä¸ªç®€å•çš„<code>User</code>å¯¹è±¡å°±è¶³å¤Ÿäº†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> id; <span style="color:#007f7f">// å”¯ä¸€æ ‡è¯†</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String email;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String name;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ä½¿ç”¨å¤šå°æœåŠ¡å™¨æ„æˆé›†ç¾¤æ—¶ï¼Œä½¿ç”¨Sessionä¼šé‡åˆ°ä¸€äº›é¢å¤–çš„é—®é¢˜ã€‚é€šå¸¸ï¼Œå¤šå°æœåŠ¡å™¨é›†ç¾¤ä½¿ç”¨åå‘ä»£ç†ä½œä¸ºç½‘ç«™å…¥å£ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                                â”Œâ”€â”€â”€&gt;â”‚Web Server 1â”‚
</span></span><span style="display:flex;"><span>                                â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚Browserâ”‚â”€â”€â”€â”€&gt;â”‚Reverse Proxyâ”‚â”€â”€â”€â”¼â”€â”€â”€&gt;â”‚Web Server 2â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>                                â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                                â””â”€â”€â”€&gt;â”‚Web Server 3â”‚
</span></span><span style="display:flex;"><span>                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœå¤šå°Web Serveré‡‡ç”¨æ— çŠ¶æ€é›†ç¾¤ï¼Œé‚£ä¹ˆåå‘ä»£ç†æ€»æ˜¯ä»¥è½®è¯¢æ–¹å¼å°†è¯·æ±‚ä¾æ¬¡è½¬å‘ç»™æ¯å°Web Serverï¼Œè¿™ä¼šé€ æˆä¸€ä¸ªç”¨æˆ·åœ¨Web Server 1å­˜å‚¨çš„Sessionä¿¡æ¯ï¼Œåœ¨Web Server 2å’Œ3ä¸Šå¹¶ä¸å­˜åœ¨ï¼Œå³ä»Web Server 1ç™»å½•åï¼Œå¦‚æœåç»­è¯·æ±‚è¢«è½¬å‘åˆ°Web Server 2æˆ–3ï¼Œé‚£ä¹ˆç”¨æˆ·çœ‹åˆ°çš„ä»ç„¶æ˜¯æœªç™»å½•çŠ¶æ€ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ–¹æ¡ˆä¸€æ˜¯åœ¨æ‰€æœ‰Web Serverä¹‹é—´è¿›è¡ŒSessionå¤åˆ¶ï¼Œä½†è¿™æ ·ä¼šä¸¥é‡æ¶ˆè€—ç½‘ç»œå¸¦å®½ï¼Œå¹¶ä¸”ï¼Œæ¯ä¸ªWeb Serverçš„å†…å­˜å‡å­˜å‚¨æ‰€æœ‰ç”¨æˆ·çš„Sessionï¼Œå†…å­˜ä½¿ç”¨ç‡å¾ˆä½ã€‚</p>
<p>å¦ä¸€ä¸ªæ–¹æ¡ˆæ˜¯é‡‡ç”¨ç²˜æ»ä¼šè¯ï¼ˆSticky Sessionï¼‰æœºåˆ¶ï¼Œå³åå‘ä»£ç†åœ¨è½¬å‘è¯·æ±‚çš„æ—¶å€™ï¼Œæ€»æ˜¯æ ¹æ®JSESSIONIDçš„å€¼åˆ¤æ–­ï¼Œç›¸åŒçš„JSESSIONIDæ€»æ˜¯è½¬å‘åˆ°å›ºå®šçš„Web Serverï¼Œä½†è¿™éœ€è¦åå‘ä»£ç†çš„æ”¯æŒã€‚</p>
<p>æ— è®ºé‡‡ç”¨ä½•ç§æ–¹æ¡ˆï¼Œä½¿ç”¨Sessionæœºåˆ¶ï¼Œä¼šä½¿å¾—Web Serverçš„é›†ç¾¤å¾ˆéš¾æ‰©å±•ï¼Œå› æ­¤ï¼ŒSessioné€‚ç”¨äºä¸­å°å‹Webåº”ç”¨ç¨‹åºã€‚å¯¹äºå¤§å‹Webåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œé€šå¸¸éœ€è¦é¿å…ä½¿ç”¨Sessionæœºåˆ¶ã€‚</p>
<h2 id="cookie">Cookie<a hidden class="anchor" aria-hidden="true" href="#cookie">#</a></h2>
<p>å®é™…ä¸Šï¼ŒServletæä¾›çš„<code>HttpSession</code>æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡ä¸€ä¸ªåä¸º<code>JSESSIONID</code>çš„Cookieæ¥è·Ÿè¸ªç”¨æˆ·ä¼šè¯çš„ã€‚é™¤äº†è¿™ä¸ªåç§°å¤–ï¼Œå…¶ä»–åç§°çš„Cookieæˆ‘ä»¬å¯ä»¥ä»»æ„ä½¿ç”¨ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦è®¾ç½®ä¸€ä¸ªCookieï¼Œä¾‹å¦‚ï¼Œè®°å½•ç”¨æˆ·é€‰æ‹©çš„è¯­è¨€ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ª<code>LanguageServlet</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/pref&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LanguageServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> Set&lt;String&gt; LANGUAGES = Set.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;en&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;zh&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        String lang = req.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;lang&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (LANGUAGES.<span style="color:#007f7f">contains</span>(lang)) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªæ–°çš„Cookie:</span>
</span></span><span style="display:flex;"><span>            Cookie cookie = <span style="color:#fff;font-weight:bold">new</span> Cookie(<span style="color:#0ff;font-weight:bold">&#34;lang&#34;</span>, lang);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è¯¥Cookieç”Ÿæ•ˆçš„è·¯å¾„èŒƒå›´:</span>
</span></span><span style="display:flex;"><span>            cookie.<span style="color:#007f7f">setPath</span>(<span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è¯¥Cookieæœ‰æ•ˆæœŸ:</span>
</span></span><span style="display:flex;"><span>            cookie.<span style="color:#007f7f">setMaxAge</span>(8640000); <span style="color:#007f7f">// 8640000ç§’=100å¤©</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å°†è¯¥Cookieæ·»åŠ åˆ°å“åº”:</span>
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">addCookie</span>(cookie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">sendRedirect</span>(<span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»ºä¸€ä¸ªæ–°Cookieæ—¶ï¼Œé™¤äº†æŒ‡å®šåç§°å’Œå€¼ä»¥å¤–ï¼Œé€šå¸¸éœ€è¦è®¾ç½®<code>setPath(&quot;/&quot;)</code>ï¼Œæµè§ˆå™¨æ ¹æ®æ­¤å‰ç¼€å†³å®šæ˜¯å¦å‘é€Cookieã€‚å¦‚æœä¸€ä¸ªCookieè°ƒç”¨äº†<code>setPath(&quot;/user/&quot;)</code>ï¼Œé‚£ä¹ˆæµè§ˆå™¨åªæœ‰åœ¨è¯·æ±‚ä»¥<code>/user/</code>å¼€å¤´çš„è·¯å¾„æ—¶æ‰ä¼šé™„åŠ æ­¤Cookieã€‚é€šè¿‡<code>setMaxAge()</code>è®¾ç½®Cookieçš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ï¼Œæœ€åé€šè¿‡<code>resp.addCookie()</code>æŠŠå®ƒæ·»åŠ åˆ°å“åº”ã€‚</p>
<p>å¦‚æœè®¿é—®çš„æ˜¯httpsç½‘é¡µï¼Œè¿˜éœ€è¦è°ƒç”¨<code>setSecure(true)</code>ï¼Œå¦åˆ™æµè§ˆå™¨ä¸ä¼šå‘é€è¯¥Cookieã€‚</p>
<p>å› æ­¤ï¼ŒåŠ¡å¿…æ³¨æ„ï¼šæµè§ˆå™¨åœ¨è¯·æ±‚æŸä¸ªURLæ—¶ï¼Œæ˜¯å¦æºå¸¦æŒ‡å®šçš„Cookieï¼Œå–å†³äºCookieæ˜¯å¦æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰è¦æ±‚ï¼š</p>
<ul>
<li>URLå‰ç¼€æ˜¯è®¾ç½®Cookieæ—¶çš„Pathï¼›</li>
<li>Cookieåœ¨æœ‰æ•ˆæœŸå†…ï¼›</li>
<li>Cookieè®¾ç½®äº†secureæ—¶å¿…é¡»ä»¥httpsè®¿é—®ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨çœ‹åˆ°æœåŠ¡å™¨å‘é€çš„Cookieã€‚Network-&gt;Headers</p>
<p>å¦‚æœæˆ‘ä»¬è¦è¯»å–Cookieï¼Œä¾‹å¦‚ï¼Œåœ¨<code>IndexServlet</code>ä¸­ï¼Œè¯»å–åä¸º<code>lang</code>çš„Cookieä»¥è·å–ç”¨æˆ·è®¾ç½®çš„è¯­è¨€ï¼Œå¯ä»¥å†™ä¸€ä¸ªæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> String parseLanguageFromCookie(HttpServletRequest req) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è·å–è¯·æ±‚é™„å¸¦çš„æ‰€æœ‰Cookie:</span>
</span></span><span style="display:flex;"><span>    Cookie[] cookies = req.<span style="color:#007f7f">getCookies</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœè·å–åˆ°Cookie:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (cookies != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¾ªç¯æ¯ä¸ªCookie:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (Cookie cookie : cookies) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¦‚æœCookieåç§°ä¸ºlang:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (cookie.<span style="color:#007f7f">getName</span>().<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;lang&#34;</span>)) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// è¿”å›Cookieçš„å€¼:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> cookie.<span style="color:#007f7f">getValue</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è¿”å›é»˜è®¤å€¼:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;en&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼Œè¯»å–Cookieä¸»è¦ä¾é éå†<code>HttpServletRequest</code>é™„å¸¦çš„æ‰€æœ‰Cookieã€‚</p>
<h1 id="jspå¼€å‘">JSPå¼€å‘<a hidden class="anchor" aria-hidden="true" href="#jspå¼€å‘">#</a></h1>
<p>æˆ‘ä»¬ä»å‰é¢çš„ç« èŠ‚å¯ä»¥çœ‹åˆ°ï¼ŒServletå°±æ˜¯ä¸€ä¸ªèƒ½å¤„ç†HTTPè¯·æ±‚ï¼Œå‘é€HTTPå“åº”çš„å°ç¨‹åºï¼Œè€Œå‘é€å“åº”æ— éå°±æ˜¯è·å–<code>PrintWriter</code>ï¼Œç„¶åè¾“å‡ºHTMLï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>PrintWriter pw = resp.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;html&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;body&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;Welcome, &#34;</span> + name + <span style="color:#0ff;font-weight:bold">&#34;!&lt;/h1&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;/body&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;/html&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>pw.<span style="color:#007f7f">flush</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>åªä¸è¿‡ï¼Œç”¨PrintWriterè¾“å‡ºHTMLæ¯”è¾ƒç—›è‹¦ï¼Œå› ä¸ºä¸ä½†è¦æ­£ç¡®ç¼–å†™HTMLï¼Œè¿˜éœ€è¦æ’å…¥å„ç§å˜é‡ã€‚å¦‚æœæƒ³åœ¨Servletä¸­è¾“å‡ºä¸€ä¸ªç±»ä¼¼æ–°æµªé¦–é¡µçš„HTMLï¼Œå†™å¯¹HTMLåŸºæœ¬ä¸Šä¸å¤ªå¯èƒ½ã€‚</p>
<p>é‚£æœ‰æ²¡æœ‰æ›´ç®€å•çš„è¾“å‡ºHTMLçš„åŠæ³•ï¼Ÿ</p>
<p><strong>æœ‰ï¼</strong></p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨JSPã€‚</p>
<p>JSPæ˜¯Java Server Pagesçš„ç¼©å†™ï¼Œå®ƒçš„æ–‡ä»¶å¿…é¡»æ”¾åˆ°<code>/src/main/webapp</code>ä¸‹ï¼Œæ–‡ä»¶åå¿…é¡»ä»¥<code>.jsp</code>ç»“å°¾ï¼Œæ•´ä¸ªæ–‡ä»¶ä¸HTMLå¹¶æ— å¤ªå¤§åŒºåˆ«ï¼Œä½†éœ€è¦æ’å…¥å˜é‡ï¼Œæˆ–è€…åŠ¨æ€è¾“å‡ºçš„åœ°æ–¹ï¼Œä½¿ç”¨ç‰¹æ®ŠæŒ‡ä»¤<code>&lt;% ... %&gt;</code>ã€‚</p>
<p>æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ª<code>hello.jsp</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>&lt;head&gt;
</span></span><span style="display:flex;"><span>    &lt;title&gt;Hello World - JSP&lt;/title&gt;
</span></span><span style="display:flex;"><span>&lt;/head&gt;
</span></span><span style="display:flex;"><span>&lt;body&gt;
</span></span><span style="display:flex;"><span>    &lt;%-- JSP Comment --%&gt;
</span></span><span style="display:flex;"><span>    &lt;h1&gt;Hello World!&lt;/h1&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;
</span></span><span style="display:flex;"><span>    &lt;%
</span></span><span style="display:flex;"><span>         out.println(&#34;Your IP address is &#34;);
</span></span><span style="display:flex;"><span>    %&gt;
</span></span><span style="display:flex;"><span>    &lt;span style=&#34;color:red&#34;&gt;
</span></span><span style="display:flex;"><span>        &lt;%= request.getRemoteAddr() %&gt;
</span></span><span style="display:flex;"><span>    &lt;/span&gt;
</span></span><span style="display:flex;"><span>    &lt;/p&gt;
</span></span><span style="display:flex;"><span>&lt;/body&gt;
</span></span><span style="display:flex;"><span>&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•´ä¸ªJSPçš„å†…å®¹å®é™…ä¸Šæ˜¯ä¸€ä¸ªHTMLï¼Œä½†æ˜¯ç¨æœ‰ä¸åŒï¼š</p>
<ul>
<li>åŒ…å«åœ¨<code>&lt;%--</code>å’Œ<code>--%&gt;</code>ä¹‹é—´çš„æ˜¯JSPçš„æ³¨é‡Šï¼Œå®ƒä»¬ä¼šè¢«å®Œå…¨å¿½ç•¥ï¼›</li>
<li>åŒ…å«åœ¨<code>&lt;%</code>å’Œ<code>%&gt;</code>ä¹‹é—´çš„æ˜¯Javaä»£ç ï¼Œå¯ä»¥ç¼–å†™ä»»æ„Javaä»£ç ï¼›</li>
<li>å¦‚æœä½¿ç”¨<code>&lt;%= xxx %&gt;</code>åˆ™å¯ä»¥å¿«æ·è¾“å‡ºä¸€ä¸ªå˜é‡çš„å€¼ã€‚</li>
</ul>
<p>JSPé¡µé¢å†…ç½®äº†å‡ ä¸ªå˜é‡ï¼š</p>
<ul>
<li>outï¼šè¡¨ç¤ºHttpServletResponseçš„PrintWriterï¼›</li>
<li>sessionï¼šè¡¨ç¤ºå½“å‰HttpSessionå¯¹è±¡ï¼›</li>
<li>requestï¼šè¡¨ç¤ºHttpServletRequestå¯¹è±¡ã€‚</li>
</ul>
<p>è¿™å‡ ä¸ªå˜é‡å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<p>è®¿é—®JSPé¡µé¢æ—¶ï¼Œç›´æ¥æŒ‡å®šå®Œæ•´è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ<code>http://localhost:8080/hello.jsp</code>ï¼Œæµè§ˆå™¨æ˜¾ç¤ºå¦‚ä¸‹ã€‚</p>
<p>JSPå’ŒServletæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå…¶å®å®ƒä»¬æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œå› ä¸ºJSPåœ¨æ‰§è¡Œå‰é¦–å…ˆè¢«ç¼–è¯‘æˆä¸€ä¸ªServletã€‚åœ¨Tomcatçš„ä¸´æ—¶ç›®å½•ä¸‹ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ª<code>hello_jsp.java</code>çš„æºæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯TomcatæŠŠJSPè‡ªåŠ¨è½¬æ¢æˆçš„Servletæºç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>package org.apache.jsp;
</span></span><span style="display:flex;"><span>import ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>public final <span style="color:#fff;font-weight:bold">class</span> hello_jsp <span style="color:#fff;font-weight:bold">extends</span> org.apache.jasper.runtime.HttpJspBase
</span></span><span style="display:flex;"><span>    implements org.apache.jasper.runtime.JspSourceDependent,
</span></span><span style="display:flex;"><span>               org.apache.jasper.runtime.JspSourceImports {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
</span></span><span style="display:flex;"><span>        throws java.io.IOException, javax.servlet.ServletException {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        out.write(<span style="color:#0ff;font-weight:bold">&#34;&lt;html&gt;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        out.write(<span style="color:#0ff;font-weight:bold">&#34;&lt;head&gt;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        out.write(<span style="color:#0ff;font-weight:bold">&#34;    &lt;title&gt;Hello World - JSP&lt;/title&gt;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        out.write(<span style="color:#0ff;font-weight:bold">&#34;&lt;/head&gt;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        out.write(<span style="color:#0ff;font-weight:bold">&#34;&lt;body&gt;</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>);
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§JSPæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªServletï¼Œåªä¸è¿‡æ— éœ€é…ç½®æ˜ å°„è·¯å¾„ï¼ŒWeb Serverä¼šæ ¹æ®è·¯å¾„æŸ¥æ‰¾å¯¹åº”çš„<code>.jsp</code>æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±è‡ªåŠ¨ç¼–è¯‘æˆServletå†æ‰§è¡Œã€‚åœ¨æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¿®æ”¹äº†JSPçš„å†…å®¹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šè‡ªåŠ¨é‡æ–°ç¼–è¯‘ã€‚</p>
<h2 id="jspé«˜çº§åŠŸèƒ½">JSPé«˜çº§åŠŸèƒ½<a hidden class="anchor" aria-hidden="true" href="#jspé«˜çº§åŠŸèƒ½">#</a></h2>
<p>JSPçš„æŒ‡ä»¤éå¸¸å¤æ‚ï¼Œé™¤äº†<code>&lt;% ... %&gt;</code>å¤–ï¼ŒJSPé¡µé¢æœ¬èº«å¯ä»¥é€šè¿‡<code>page</code>æŒ‡ä»¤å¼•å…¥Javaç±»ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;%@ page import=&#34;java.io.*&#34; %&gt;
</span></span><span style="display:flex;"><span>&lt;%@ page import=&#34;java.util.*&#34; %&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·åç»­çš„Javaä»£ç æ‰èƒ½å¼•ç”¨ç®€å•ç±»åè€Œä¸æ˜¯å®Œæ•´ç±»åã€‚</p>
<p>ä½¿ç”¨<code>include</code>æŒ‡ä»¤å¯ä»¥å¼•å…¥å¦ä¸€ä¸ªJSPæ–‡ä»¶ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>&lt;body&gt;
</span></span><span style="display:flex;"><span>    &lt;%@ include file=&#34;header.jsp&#34;%&gt;
</span></span><span style="display:flex;"><span>    &lt;h1&gt;Index Page&lt;/h1&gt;
</span></span><span style="display:flex;"><span>    &lt;%@ include file=&#34;footer.jsp&#34;%&gt;
</span></span><span style="display:flex;"><span>&lt;/body&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="jsp-tag">JSP Tag<a hidden class="anchor" aria-hidden="true" href="#jsp-tag">#</a></h3>
<p>JSPè¿˜å…è®¸è‡ªå®šä¹‰è¾“å‡ºçš„tagï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;c:out value = &#34;${sessionScope.user.name}&#34;/&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>JSP Tagéœ€è¦æ­£ç¡®å¼•å…¥taglibçš„jaråŒ…ï¼Œå¹¶ä¸”è¿˜éœ€è¦æ­£ç¡®å£°æ˜ï¼Œä½¿ç”¨èµ·æ¥éå¸¸å¤æ‚ï¼Œå¯¹äºé¡µé¢å¼€å‘æ¥è¯´ï¼Œ<em>ä¸æ¨è</em>ä½¿ç”¨JSP Tagï¼Œå› ä¸ºæˆ‘ä»¬åç»­ä¼šä»‹ç»æ›´ç®€å•çš„æ¨¡æ¿å¼•æ“ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å†ä»‹ç»å¦‚ä½•ä½¿ç”¨taglibã€‚</p>
<h2 id="å°ç»“-3">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-3">#</a></h2>
<p>JSPæ˜¯ä¸€ç§åœ¨HTMLä¸­åµŒå…¥åŠ¨æ€è¾“å‡ºçš„æ–‡ä»¶ï¼Œå®ƒå’ŒServletæ­£å¥½ç›¸åï¼ŒServletæ˜¯åœ¨Javaä»£ç ä¸­åµŒå…¥è¾“å‡ºHTMLï¼›</p>
<p>JSPå¯ä»¥å¼•å…¥å¹¶ä½¿ç”¨JSP Tagï¼Œä½†ç”±äºå…¶è¯­æ³•å¤æ‚ï¼Œä¸æ¨èä½¿ç”¨ï¼›</p>
<p>JSPæœ¬èº«ç›®å‰å·²ç»å¾ˆå°‘ä½¿ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦äº†è§£å…¶åŸºæœ¬ç”¨æ³•å³å¯ã€‚</p>
<h1 id="mvcå¼€å‘">MVCå¼€å‘<a hidden class="anchor" aria-hidden="true" href="#mvcå¼€å‘">#</a></h1>
<p>æˆ‘ä»¬é€šè¿‡å‰é¢çš„ç« èŠ‚å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>Servleté€‚åˆç¼–å†™Javaä»£ç ï¼Œå®ç°å„ç§å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œä½†ä¸é€‚åˆè¾“å‡ºå¤æ‚çš„HTMLï¼›</li>
<li>JSPé€‚åˆç¼–å†™HTMLï¼Œå¹¶åœ¨å…¶ä¸­æ’å…¥åŠ¨æ€å†…å®¹ï¼Œä½†ä¸é€‚åˆç¼–å†™å¤æ‚çš„Javaä»£ç ã€‚</li>
</ul>
<p>èƒ½å¦å°†ä¸¤è€…ç»“åˆèµ·æ¥ï¼Œå‘æŒ¥å„è‡ªçš„ä¼˜ç‚¹ï¼Œé¿å…å„è‡ªçš„ç¼ºç‚¹ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬å·²ç»ç¼–å†™äº†å‡ ä¸ªJavaBeanï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> id;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> School school;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> School {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String address;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>UserServlet</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ•°æ®åº“è¯»å–<code>User</code>ã€<code>School</code>ç­‰ä¿¡æ¯ï¼Œç„¶åï¼ŒæŠŠè¯»å–åˆ°çš„JavaBeanå…ˆæ”¾åˆ°HttpServletRequestä¸­ï¼Œå†é€šè¿‡<code>forward()</code>ä¼ ç»™<code>user.jsp</code>å¤„ç†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/user&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å‡è£…ä»æ•°æ®åº“è¯»å–:</span>
</span></span><span style="display:flex;"><span>        School school = <span style="color:#fff;font-weight:bold">new</span> School(<span style="color:#0ff;font-weight:bold">&#34;No.1 Middle School&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;101 South Street&#34;</span>);
</span></span><span style="display:flex;"><span>        User user = <span style="color:#fff;font-weight:bold">new</span> User(123, <span style="color:#0ff;font-weight:bold">&#34;Bob&#34;</span>, school);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ”¾å…¥Requestä¸­:</span>
</span></span><span style="display:flex;"><span>        req.<span style="color:#007f7f">setAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>, user);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// forwardç»™user.jsp:</span>
</span></span><span style="display:flex;"><span>        req.<span style="color:#007f7f">getRequestDispatcher</span>(<span style="color:#0ff;font-weight:bold">&#34;/WEB-INF/user.jsp&#34;</span>).<span style="color:#007f7f">forward</span>(req, resp);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>user.jsp</code>ä¸­ï¼Œæˆ‘ä»¬åªè´Ÿè´£å±•ç¤ºç›¸å…³JavaBeançš„ä¿¡æ¯ï¼Œä¸éœ€è¦ç¼–å†™è®¿é—®æ•°æ®åº“ç­‰å¤æ‚é€»è¾‘ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;%@ page import=&#34;com.itranswarp.learnjava.bean.*&#34;%&gt;
</span></span><span style="display:flex;"><span>&lt;%
</span></span><span style="display:flex;"><span>    User user = (User) request.getAttribute(&#34;user&#34;);
</span></span><span style="display:flex;"><span>%&gt;
</span></span><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>&lt;head&gt;
</span></span><span style="display:flex;"><span>    &lt;title&gt;Hello World - JSP&lt;/title&gt;
</span></span><span style="display:flex;"><span>&lt;/head&gt;
</span></span><span style="display:flex;"><span>&lt;body&gt;
</span></span><span style="display:flex;"><span>    &lt;h1&gt;Hello &lt;%= user.name %&gt;!&lt;/h1&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;School Name:
</span></span><span style="display:flex;"><span>    &lt;span style=&#34;color:red&#34;&gt;
</span></span><span style="display:flex;"><span>        &lt;%= user.school.name %&gt;
</span></span><span style="display:flex;"><span>    &lt;/span&gt;
</span></span><span style="display:flex;"><span>    &lt;/p&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;School Address:
</span></span><span style="display:flex;"><span>    &lt;span style=&#34;color:red&#34;&gt;
</span></span><span style="display:flex;"><span>        &lt;%= user.school.address %&gt;
</span></span><span style="display:flex;"><span>    &lt;/span&gt;
</span></span><span style="display:flex;"><span>    &lt;/p&gt;
</span></span><span style="display:flex;"><span>&lt;/body&gt;
</span></span><span style="display:flex;"><span>&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯·æ³¨æ„å‡ ç‚¹ï¼š</p>
<ul>
<li>éœ€è¦å±•ç¤ºçš„<code>User</code>è¢«æ”¾å…¥<code>HttpServletRequest</code>ä¸­ä»¥ä¾¿ä¼ é€’ç»™JSPï¼Œå› ä¸ºä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ª<code>HttpServletRequest</code>ï¼Œæˆ‘ä»¬ä¹Ÿæ— éœ€æ¸…ç†å®ƒï¼Œå¤„ç†å®Œè¯¥è¯·æ±‚å<code>HttpServletRequest</code>å®ä¾‹å°†è¢«ä¸¢å¼ƒï¼›</li>
<li>æŠŠ<code>user.jsp</code>æ”¾åˆ°<code>/WEB-INF/</code>ç›®å½•ä¸‹ï¼Œæ˜¯å› ä¸º<code>WEB-INF</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šç›®å½•ï¼ŒWeb Serverä¼šé˜»æ­¢æµè§ˆå™¨å¯¹<code>WEB-INF</code>ç›®å½•ä¸‹ä»»ä½•èµ„æºçš„è®¿é—®ï¼Œè¿™æ ·å°±é˜²æ­¢ç”¨æˆ·é€šè¿‡<code>/user.jsp</code>è·¯å¾„ç›´æ¥è®¿é—®åˆ°JSPé¡µé¢ï¼›</li>
<li>JSPé¡µé¢é¦–å…ˆä»<code>request</code>å˜é‡è·å–<code>User</code>å®ä¾‹ï¼Œç„¶ååœ¨é¡µé¢ä¸­ç›´æ¥è¾“å‡ºï¼Œæ­¤å¤„æœªè€ƒè™‘HTMLçš„è½¬ä¹‰é—®é¢˜ï¼Œæœ‰æ½œåœ¨å®‰å…¨é£é™©ã€‚</li>
</ul>
<p>æˆ‘ä»¬åœ¨æµè§ˆå™¨è®¿é—®<code>http://localhost:8080/user</code>ï¼Œè¯·æ±‚é¦–å…ˆç”±<code>UserServlet</code>å¤„ç†ï¼Œç„¶åäº¤ç»™<code>user.jsp</code>æ¸²æŸ“ã€‚</p>
<p>æˆ‘ä»¬æŠŠ<code>UserServlet</code>çœ‹ä½œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ŒæŠŠ<code>User</code>çœ‹ä½œæ¨¡å‹ï¼ŒæŠŠ<code>user.jsp</code>çœ‹ä½œæ¸²æŸ“ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼é€šå¸¸è¢«ç§°ä¸ºMVCï¼šModel-View-Controllerï¼Œå³<code>UserServlet</code>ä½œä¸ºæ§åˆ¶å™¨ï¼ˆControllerï¼‰ï¼Œ<code>User</code>ä½œä¸ºæ¨¡å‹ï¼ˆModelï¼‰ï¼Œ<code>user.jsp</code>ä½œä¸ºè§†å›¾ï¼ˆViewï¼‰ï¼Œæ•´ä¸ªMVCæ¶æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>             â”Œâ”€â”€â”€â”€&gt;â”‚Controller: UserServletâ”‚
</span></span><span style="display:flex;"><span>             â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>             â”‚                 â”‚
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚Browserâ”‚â”€â”€â”€â”€â”˜           â”‚Model: Userâ”‚
</span></span><span style="display:flex;"><span>â”‚       â”‚&lt;â”€â”€â”€â”           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                 â”‚
</span></span><span style="display:flex;"><span>             â”‚                 â–¼
</span></span><span style="display:flex;"><span>             â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>             â””â”€â”€â”€â”€â”€â”‚    View: user.jsp     â”‚
</span></span><span style="display:flex;"><span>                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨MVCæ¨¡å¼çš„å¥½å¤„æ˜¯ï¼ŒControllerä¸“æ³¨äºä¸šåŠ¡å¤„ç†ï¼Œå®ƒçš„å¤„ç†ç»“æœå°±æ˜¯Modelã€‚Modelå¯ä»¥æ˜¯ä¸€ä¸ªJavaBeanï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå¯¹è±¡çš„Mapï¼ŒControlleråªè´Ÿè´£æŠŠModelä¼ é€’ç»™Viewï¼ŒViewåªè´Ÿè´£æŠŠModelç»™â€œæ¸²æŸ“â€å‡ºæ¥ï¼Œè¿™æ ·ï¼Œä¸‰è€…èŒè´£æ˜ç¡®ï¼Œä¸”å¼€å‘æ›´ç®€å•ï¼Œå› ä¸ºå¼€å‘Controlleræ—¶æ— éœ€å…³æ³¨é¡µé¢ï¼Œå¼€å‘Viewæ—¶æ— éœ€å…³å¿ƒå¦‚ä½•åˆ›å»ºModelã€‚</p>
<p>MVCæ¨¡å¼å¹¿æ³›åœ°åº”ç”¨åœ¨Webé¡µé¢å’Œä¼ ç»Ÿçš„æ¡Œé¢ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œé€šè¿‡Servletå’ŒJSPå®ç°äº†ä¸€ä¸ªç®€å•çš„MVCæ¨¡å‹ï¼Œä½†å®ƒè¿˜ä¸å¤Ÿç®€æ´å’Œçµæ´»ï¼Œåç»­æˆ‘ä»¬ä¼šä»‹ç»æ›´ç®€å•çš„Spring MVCå¼€å‘ã€‚</p>
<h1 id="mvcé«˜çº§å¼€å‘">MVCé«˜çº§å¼€å‘<a hidden class="anchor" aria-hidden="true" href="#mvcé«˜çº§å¼€å‘">#</a></h1>
<p>é€šè¿‡ç»“åˆServletå’ŒJSPçš„MVCæ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘æŒ¥äºŒè€…å„è‡ªçš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>Servletå®ç°ä¸šåŠ¡é€»è¾‘ï¼›</li>
<li>JSPå®ç°å±•ç¤ºé€»è¾‘ã€‚</li>
</ul>
<p>ä½†æ˜¯ï¼Œç›´æ¥æŠŠMVCæ­åœ¨Servletå’ŒJSPä¹‹ä¸Šè¿˜æ˜¯ä¸å¤ªå¥½ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li>Servletæä¾›çš„æ¥å£ä»ç„¶ååº•å±‚ï¼Œéœ€è¦å®ç°Servletè°ƒç”¨ç›¸å…³æ¥å£ï¼›</li>
<li>JSPå¯¹é¡µé¢å¼€å‘ä¸å‹å¥½ï¼Œæ›´å¥½çš„æ›¿ä»£å“æ˜¯æ¨¡æ¿å¼•æ“ï¼›</li>
<li>ä¸šåŠ¡é€»è¾‘æœ€å¥½ç”±çº¯ç²¹çš„Javaç±»å®ç°ï¼Œè€Œä¸æ˜¯å¼ºè¿«ç»§æ‰¿è‡ªServletã€‚</li>
</ul>
<p>èƒ½ä¸èƒ½é€šè¿‡æ™®é€šçš„Javaç±»å®ç°MVCçš„Controllerï¼Ÿç±»ä¼¼ä¸‹é¢çš„ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserController {
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/signin&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView signin() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PostMapping(<span style="color:#0ff;font-weight:bold">&#34;/signin&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView doSignin(SignInBean bean) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/signout&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView signout(HttpSession session) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„è¿™ä¸ªJavaç±»æ¯ä¸ªæ–¹æ³•éƒ½å¯¹åº”ä¸€ä¸ªGETæˆ–POSTè¯·æ±‚ï¼Œæ–¹æ³•è¿”å›å€¼æ˜¯<code>ModelAndView</code>ï¼Œå®ƒåŒ…å«ä¸€ä¸ªViewçš„è·¯å¾„ä»¥åŠä¸€ä¸ªModelï¼Œè¿™æ ·ï¼Œå†ç”±MVCæ¡†æ¶å¤„ç†åè¿”å›ç»™æµè§ˆå™¨ã€‚</p>
<p>å¦‚æœæ˜¯GETè¯·æ±‚ï¼Œæˆ‘ä»¬å¸Œæœ›MVCæ¡†æ¶èƒ½ç›´æ¥æŠŠURLå‚æ•°æŒ‰æ–¹æ³•å‚æ•°å¯¹åº”èµ·æ¥ç„¶åä¼ å…¥ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/hello&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ModelAndView hello(String name) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ˜¯POSTè¯·æ±‚ï¼Œæˆ‘ä»¬å¸Œæœ›MVCæ¡†æ¶èƒ½ç›´æ¥æŠŠPostå‚æ•°å˜æˆä¸€ä¸ªJavaBeanåé€šè¿‡æ–¹æ³•å‚æ•°ä¼ å…¥ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@PostMapping(<span style="color:#0ff;font-weight:bold">&#34;/signin&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ModelAndView doSignin(SignInBean bean) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†å¢åŠ çµæ´»æ€§ï¼Œå¦‚æœControllerçš„æ–¹æ³•åœ¨å¤„ç†è¯·æ±‚æ—¶éœ€è¦è®¿é—®<code>HttpServletRequest</code>ã€<code>HttpServletResponse</code>ã€<code>HttpSession</code>è¿™äº›å®ä¾‹æ—¶ï¼Œåªè¦æ–¹æ³•å‚æ•°æœ‰å®šä¹‰ï¼Œå°±å¯ä»¥è‡ªåŠ¨ä¼ å…¥ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/signout&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ModelAndView signout(HttpSession session) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬åœ¨è®¾è®¡MVCæ¡†æ¶æ—¶ï¼Œä¸Šå±‚ä»£ç æ‰€éœ€è¦çš„ä¸€åˆ‡ä¿¡æ¯ã€‚</p>
<h2 id="è®¾è®¡mvcæ¡†æ¶">è®¾è®¡MVCæ¡†æ¶<a hidden class="anchor" aria-hidden="true" href="#è®¾è®¡mvcæ¡†æ¶">#</a></h2>
<p>å¦‚ä½•è®¾è®¡ä¸€ä¸ªMVCæ¡†æ¶ï¼Ÿåœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†ä¸Šå±‚ä»£ç ç¼–å†™Controllerçš„ä¸€åˆ‡æ¥å£ä¿¡æ¯ï¼Œå¹¶ä¸”å¹¶ä¸è¦æ±‚å®ç°ç‰¹å®šæ¥å£ï¼Œåªéœ€è¿”å›<code>ModelAndView</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸€ä¸ª<code>View</code>å’Œä¸€ä¸ª<code>Model</code>ã€‚å®é™…ä¸Š<code>View</code>å°±æ˜¯æ¨¡æ¿çš„è·¯å¾„ï¼Œè€Œ<code>Model</code>å¯ä»¥ç”¨ä¸€ä¸ª<code>Map&lt;String, Object&gt;</code>è¡¨ç¤ºï¼Œå› æ­¤ï¼Œ<code>ModelAndView</code>å®šä¹‰éå¸¸ç®€å•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ModelAndView {
</span></span><span style="display:flex;"><span>    Map&lt;String, Object&gt; model;
</span></span><span style="display:flex;"><span>    String view;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¯”è¾ƒå¤æ‚çš„æ˜¯æˆ‘ä»¬éœ€è¦åœ¨MVCæ¡†æ¶ä¸­åˆ›å»ºä¸€ä¸ªæ¥æ”¶æ‰€æœ‰è¯·æ±‚çš„<code>Servlet</code>ï¼Œé€šå¸¸æˆ‘ä»¬æŠŠå®ƒå‘½åä¸º<code>DispatcherServlet</code>ï¼Œå®ƒæ€»æ˜¯æ˜ å°„åˆ°<code>/</code>ï¼Œç„¶åï¼Œæ ¹æ®ä¸åŒçš„Controllerçš„æ–¹æ³•å®šä¹‰çš„<code>@Get</code>æˆ–<code>@Post</code>çš„Pathå†³å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œæœ€åï¼Œè·å¾—æ–¹æ³•è¿”å›çš„<code>ModelAndView</code>åï¼Œæ¸²æŸ“æ¨¡æ¿ï¼Œå†™å…¥<code>HttpServletResponse</code>ï¼Œå³å®Œæˆäº†æ•´ä¸ªMVCçš„å¤„ç†ã€‚</p>
<p>è¿™ä¸ªMVCçš„æ¶æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>   HTTP Request    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚DispatcherServletâ”‚
</span></span><span style="display:flex;"><span>                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>                            â”‚
</span></span><span style="display:flex;"><span>               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>               â–¼            â–¼            â–¼
</span></span><span style="display:flex;"><span>         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>         â”‚Controller1â”‚â”‚Controller2â”‚â”‚Controller3â”‚
</span></span><span style="display:flex;"><span>         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>               â”‚            â”‚            â”‚
</span></span><span style="display:flex;"><span>               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>                            â–¼
</span></span><span style="display:flex;"><span>   HTTP Response â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚render(ModelAndView)â”‚
</span></span><span style="display:flex;"><span>                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œ<code>DispatcherServlet</code>ä»¥åŠå¦‚ä½•æ¸²æŸ“å‡ç”±MVCæ¡†æ¶å®ç°ï¼Œåœ¨MVCæ¡†æ¶ä¹‹ä¸Šåªéœ€è¦ç¼–å†™æ¯ä¸€ä¸ªControllerã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ç¼–å†™æœ€å¤æ‚çš„<code>DispatcherServlet</code>ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å­˜å‚¨è¯·æ±‚è·¯å¾„åˆ°æŸä¸ªå…·ä½“æ–¹æ³•çš„æ˜ å°„ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DispatcherServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Map&lt;String, GetDispatcher&gt; getMappings = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Map&lt;String, PostDispatcher&gt; postMappings = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¤„ç†ä¸€ä¸ªGETè¯·æ±‚æ˜¯é€šè¿‡<code>GetDispatcher</code>å¯¹è±¡å®Œæˆçš„ï¼Œå®ƒéœ€è¦å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> GetDispatcher {
</span></span><span style="display:flex;"><span>    Object instance; <span style="color:#007f7f">// Controllerå®ä¾‹</span>
</span></span><span style="display:flex;"><span>    Method method; <span style="color:#007f7f">// Controlleræ–¹æ³•</span>
</span></span><span style="display:flex;"><span>    String[] parameterNames; <span style="color:#007f7f">// æ–¹æ³•å‚æ•°åç§°</span>
</span></span><span style="display:flex;"><span>    Class&lt;?&gt;[] parameterClasses; <span style="color:#007f7f">// æ–¹æ³•å‚æ•°ç±»å‹</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†ä»¥ä¸Šä¿¡æ¯ï¼Œå°±å¯ä»¥å®šä¹‰<code>invoke()</code>æ¥å¤„ç†çœŸæ­£çš„è¯·æ±‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> GetDispatcher {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView invoke(HttpServletRequest request, HttpServletResponse response) {
</span></span><span style="display:flex;"><span>        Object[] arguments = <span style="color:#fff;font-weight:bold">new</span> Object[parameterClasses.<span style="color:#007f7f">length</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; parameterClasses.<span style="color:#007f7f">length</span>; i++) {
</span></span><span style="display:flex;"><span>            String parameterName = parameterNames[i];
</span></span><span style="display:flex;"><span>            Class&lt;?&gt; parameterClass = parameterClasses[i];
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (parameterClass == HttpServletRequest.<span style="color:#007f7f">class</span>) {
</span></span><span style="display:flex;"><span>                arguments[i] = request;
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (parameterClass == HttpServletResponse.<span style="color:#007f7f">class</span>) {
</span></span><span style="display:flex;"><span>                arguments[i] = response;
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (parameterClass == HttpSession.<span style="color:#007f7f">class</span>) {
</span></span><span style="display:flex;"><span>                arguments[i] = request.<span style="color:#007f7f">getSession</span>();
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (parameterClass == <span style="color:#fff;font-weight:bold">int</span>.<span style="color:#007f7f">class</span>) {
</span></span><span style="display:flex;"><span>                arguments[i] = Integer.<span style="color:#007f7f">valueOf</span>(getOrDefault(request, parameterName, <span style="color:#0ff;font-weight:bold">&#34;0&#34;</span>));
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (parameterClass == <span style="color:#fff;font-weight:bold">long</span>.<span style="color:#007f7f">class</span>) {
</span></span><span style="display:flex;"><span>                arguments[i] = Long.<span style="color:#007f7f">valueOf</span>(getOrDefault(request, parameterName, <span style="color:#0ff;font-weight:bold">&#34;0&#34;</span>));
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (parameterClass == <span style="color:#fff;font-weight:bold">boolean</span>.<span style="color:#007f7f">class</span>) {
</span></span><span style="display:flex;"><span>                arguments[i] = Boolean.<span style="color:#007f7f">valueOf</span>(getOrDefault(request, parameterName, <span style="color:#0ff;font-weight:bold">&#34;false&#34;</span>));
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (parameterClass == String.<span style="color:#007f7f">class</span>) {
</span></span><span style="display:flex;"><span>                arguments[i] = getOrDefault(request, parameterName, <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;Missing handler for type: &#34;</span> + parameterClass);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> (ModelAndView) <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">method</span>.<span style="color:#007f7f">invoke</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">instance</span>, arguments);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String getOrDefault(HttpServletRequest request, String name, String defaultValue) {
</span></span><span style="display:flex;"><span>        String s = request.<span style="color:#007f7f">getParameter</span>(name);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> s == <span style="color:#fff;font-weight:bold">null</span> ? defaultValue : s;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç æ¯”è¾ƒç¹çï¼Œä½†é€»è¾‘éå¸¸ç®€å•ï¼Œå³é€šè¿‡æ„é€ æŸä¸ªæ–¹æ³•éœ€è¦çš„æ‰€æœ‰å‚æ•°åˆ—è¡¨ï¼Œä½¿ç”¨åå°„è°ƒç”¨è¯¥æ–¹æ³•åè¿”å›ç»“æœã€‚</p>
<p>ç±»ä¼¼çš„ï¼Œ<code>PostDispatcher</code>éœ€è¦å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> PostDispatcher {
</span></span><span style="display:flex;"><span>    Object instance; <span style="color:#007f7f">// Controllerå®ä¾‹</span>
</span></span><span style="display:flex;"><span>    Method method; <span style="color:#007f7f">// Controlleræ–¹æ³•</span>
</span></span><span style="display:flex;"><span>    Class&lt;?&gt;[] parameterClasses; <span style="color:#007f7f">// æ–¹æ³•å‚æ•°ç±»å‹</span>
</span></span><span style="display:flex;"><span>    ObjectMapper objectMapper; <span style="color:#007f7f">// JSONæ˜ å°„</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å’ŒGETè¯·æ±‚ä¸åŒï¼ŒPOSTè¯·æ±‚ä¸¥æ ¼åœ°æ¥è¯´ä¸èƒ½æœ‰URLå‚æ•°ï¼Œæ‰€æœ‰æ•°æ®éƒ½åº”å½“ä»Post Bodyä¸­è¯»å–ã€‚è¿™é‡Œæˆ‘ä»¬ä¸ºäº†ç®€åŒ–å¤„ç†ï¼Œ<em>åªæ”¯æŒ</em>JSONæ ¼å¼çš„POSTè¯·æ±‚ï¼Œè¿™æ ·ï¼ŒæŠŠPostæ•°æ®è½¬åŒ–ä¸ºJavaBeanå°±éå¸¸å®¹æ˜“ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> PostDispatcher {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView invoke(HttpServletRequest request, HttpServletResponse response) {
</span></span><span style="display:flex;"><span>        Object[] arguments = <span style="color:#fff;font-weight:bold">new</span> Object[parameterClasses.<span style="color:#007f7f">length</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; parameterClasses.<span style="color:#007f7f">length</span>; i++) {
</span></span><span style="display:flex;"><span>            Class&lt;?&gt; parameterClass = parameterClasses[i];
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (parameterClass == HttpServletRequest.<span style="color:#007f7f">class</span>) {
</span></span><span style="display:flex;"><span>                arguments[i] = request;
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (parameterClass == HttpServletResponse.<span style="color:#007f7f">class</span>) {
</span></span><span style="display:flex;"><span>                arguments[i] = response;
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (parameterClass == HttpSession.<span style="color:#007f7f">class</span>) {
</span></span><span style="display:flex;"><span>                arguments[i] = request.<span style="color:#007f7f">getSession</span>();
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// è¯»å–JSONå¹¶è§£æä¸ºJavaBean:</span>
</span></span><span style="display:flex;"><span>                BufferedReader reader = request.<span style="color:#007f7f">getReader</span>();
</span></span><span style="display:flex;"><span>                arguments[i] = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">objectMapper</span>.<span style="color:#007f7f">readValue</span>(reader, parameterClass);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> (ModelAndView) <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">method</span>.<span style="color:#007f7f">invoke</span>(instance, arguments);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œæˆ‘ä»¬æ¥å®ç°æ•´ä¸ª<code>DispatcherServlet</code>çš„å¤„ç†æµç¨‹ï¼Œä»¥<code>doGet()</code>ä¸ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DispatcherServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;text/html&#34;</span>);
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setCharacterEncoding</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>        String path = req.<span style="color:#007f7f">getRequestURI</span>().<span style="color:#007f7f">substring</span>(req.<span style="color:#007f7f">getContextPath</span>().<span style="color:#007f7f">length</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ ¹æ®è·¯å¾„æŸ¥æ‰¾GetDispatcher:</span>
</span></span><span style="display:flex;"><span>        GetDispatcher dispatcher = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getMappings</span>.<span style="color:#007f7f">get</span>(path);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (dispatcher == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æœªæ‰¾åˆ°è¿”å›404:</span>
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">sendError</span>(404);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è°ƒç”¨Controlleræ–¹æ³•è·å¾—è¿”å›å€¼:</span>
</span></span><span style="display:flex;"><span>        ModelAndView mv = dispatcher.<span style="color:#007f7f">invoke</span>(req, resp);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å…è®¸è¿”å›null:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (mv == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å…è®¸è¿”å›`redirect:`å¼€å¤´çš„viewè¡¨ç¤ºé‡å®šå‘:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (mv.<span style="color:#007f7f">view</span>.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;redirect:&#34;</span>)) {
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">sendRedirect</span>(mv.<span style="color:#007f7f">view</span>.<span style="color:#007f7f">substring</span>(9));
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†æ¨¡æ¿å¼•æ“æ¸²æŸ“çš„å†…å®¹å†™å…¥å“åº”:</span>
</span></span><span style="display:flex;"><span>        PrintWriter pw = resp.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">viewEngine</span>.<span style="color:#007f7f">render</span>(mv, pw);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæœ‰å‡ ä¸ªå°æ”¹è¿›ï¼š</p>
<ul>
<li>å…è®¸Controlleræ–¹æ³•è¿”å›<code>null</code>ï¼Œè¡¨ç¤ºå†…éƒ¨å·²è‡ªè¡Œå¤„ç†å®Œæ¯•ï¼›</li>
<li>å…è®¸Controlleræ–¹æ³•è¿”å›ä»¥<code>redirect:</code>å¼€å¤´çš„viewåç§°ï¼Œè¡¨ç¤ºä¸€ä¸ªé‡å®šå‘ã€‚</li>
</ul>
<p>è¿™æ ·ä½¿å¾—ä¸Šå±‚ä»£ç ç¼–å†™æ›´çµæ´»ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ˜¾ç¤ºç”¨æˆ·èµ„æ–™çš„è¯·æ±‚å¯ä»¥è¿™æ ·å†™ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/user/profile&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ModelAndView profile(HttpServletResponse response, HttpSession session) {
</span></span><span style="display:flex;"><span>    User user = (User) session.<span style="color:#007f7f">getAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (user == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ModelAndView(<span style="color:#0ff;font-weight:bold">&#34;redirect:/signin&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (!user.<span style="color:#007f7f">isManager</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æƒé™ä¸å¤Ÿï¼Œè¿”å›403:</span>
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">sendError</span>(403);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ModelAndView(<span style="color:#0ff;font-weight:bold">&#34;/profile.html&#34;</span>, Map.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>, user));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åä¸€æ­¥æ˜¯åœ¨<code>DispatcherServlet</code>çš„<code>init()</code>æ–¹æ³•ä¸­åˆå§‹åŒ–æ‰€æœ‰Getå’ŒPostçš„æ˜ å°„ï¼Œä»¥åŠç”¨äºæ¸²æŸ“çš„æ¨¡æ¿å¼•æ“ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DispatcherServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Map&lt;String, GetDispatcher&gt; getMappings = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Map&lt;String, PostDispatcher&gt; postMappings = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> ViewEngine viewEngine;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> init() <span style="color:#fff;font-weight:bold">throws</span> ServletException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getMappings</span> = scanGetInControllers();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">postMappings</span> = scanPostInControllers();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">viewEngine</span> = <span style="color:#fff;font-weight:bold">new</span> ViewEngine(getServletContext());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚ä½•æ‰«ææ‰€æœ‰Controllerä»¥è·å–æ‰€æœ‰æ ‡è®°æœ‰<code>@GetMapping</code>å’Œ<code>@PostMapping</code>çš„æ–¹æ³•ï¼Ÿå½“ç„¶æ˜¯ä½¿ç”¨åå°„äº†ã€‚è™½ç„¶ä»£ç æ¯”è¾ƒç¹çï¼Œä½†æˆ‘ä»¬ç›¸ä¿¡å„ä½ç«¥é‹å¯ä»¥è½»æ¾å®ç°ã€‚</p>
<p>è¿™æ ·ï¼Œæ•´ä¸ªMVCæ¡†æ¶å°±æ­å»ºå®Œæ¯•ã€‚</p>
<h2 id="å®ç°æ¸²æŸ“">å®ç°æ¸²æŸ“<a hidden class="anchor" aria-hidden="true" href="#å®ç°æ¸²æŸ“">#</a></h2>
<p>æœ‰çš„ç«¥é‹å¯¹å¦‚ä½•ä½¿ç”¨æ¨¡æ¿å¼•æ“è¿›è¡Œæ¸²æŸ“æœ‰ç–‘é—®ï¼Œå³å¦‚ä½•å®ç°ä¸Šè¿°çš„<code>ViewEngine</code>ï¼Ÿå…¶å®<code>ViewEngine</code>éå¸¸ç®€å•ï¼Œåªéœ€è¦å®ç°ä¸€ä¸ªç®€å•çš„<code>render()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ViewEngine {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> render(ModelAndView mv, Writer writer) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        String view = mv.<span style="color:#007f7f">view</span>;
</span></span><span style="display:flex;"><span>        Map&lt;String, Object&gt; model = mv.<span style="color:#007f7f">model</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ ¹æ®viewæ‰¾åˆ°æ¨¡æ¿æ–‡ä»¶:</span>
</span></span><span style="display:flex;"><span>        Template template = getTemplateByPath(view);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ¸²æŸ“å¹¶å†™å…¥Writer:</span>
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">write</span>(writer, model);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Javaæœ‰å¾ˆå¤šå¼€æºçš„æ¨¡æ¿å¼•æ“ï¼Œå¸¸ç”¨çš„æœ‰ï¼š</p>
<ul>
<li><a href="https://www.thymeleaf.org/">Thymeleaf</a></li>
<li><a href="https://freemarker.apache.org/">FreeMarker</a></li>
<li><a href="https://velocity.apache.org/">Velocity</a></li>
</ul>
<p>ä»–ä»¬çš„ç”¨æ³•éƒ½å¤§åŒå°å¼‚ã€‚è¿™é‡Œæˆ‘ä»¬æ¨èä¸€ä¸ªä½¿ç”¨<a href="https://palletsprojects.com/p/jinja/">Jinja</a>è¯­æ³•çš„æ¨¡æ¿å¼•æ“<a href="https://pebbletemplates.io/">Pebble</a>ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯è¯­æ³•ç®€å•ï¼Œæ”¯æŒæ¨¡æ¿ç»§æ‰¿ï¼Œç¼–å†™å‡ºæ¥çš„æ¨¡æ¿ç±»ä¼¼ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>&lt;body&gt;
</span></span><span style="display:flex;"><span>  &lt;ul&gt;
</span></span><span style="display:flex;"><span>  {% for user in users %}
</span></span><span style="display:flex;"><span>    &lt;li&gt;&lt;a href=&#34;{{ user.url }}&#34;&gt;{{ user.username }}&lt;/a&gt;&lt;/li&gt;
</span></span><span style="display:flex;"><span>  {% endfor %}
</span></span><span style="display:flex;"><span>  &lt;/ul&gt;
</span></span><span style="display:flex;"><span>&lt;/body&gt;
</span></span><span style="display:flex;"><span>&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å³å˜é‡ç”¨<code>{{ xxx }}</code>è¡¨ç¤ºï¼Œæ§åˆ¶è¯­å¥ç”¨<code>{% xxx %}</code>è¡¨ç¤ºã€‚</p>
<p>ä½¿ç”¨Pebbleæ¸²æŸ“åªéœ€è¦å¦‚ä¸‹å‡ è¡Œä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ViewEngine {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> PebbleEngine engine;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ViewEngine(ServletContext servletContext) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å®šä¹‰ä¸€ä¸ªServletLoaderç”¨äºåŠ è½½æ¨¡æ¿:</span>
</span></span><span style="display:flex;"><span>        ServletLoader loader = <span style="color:#fff;font-weight:bold">new</span> ServletLoader(servletContext);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ¨¡æ¿ç¼–ç :</span>
</span></span><span style="display:flex;"><span>        loader.<span style="color:#007f7f">setCharset</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ¨¡æ¿å‰ç¼€ï¼Œè¿™é‡Œé»˜è®¤æ¨¡æ¿å¿…é¡»æ”¾åœ¨`/WEB-INF/templates`ç›®å½•:</span>
</span></span><span style="display:flex;"><span>        loader.<span style="color:#007f7f">setPrefix</span>(<span style="color:#0ff;font-weight:bold">&#34;/WEB-INF/templates&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ¨¡æ¿åç¼€:</span>
</span></span><span style="display:flex;"><span>        loader.<span style="color:#007f7f">setSuffix</span>(<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºPebbleå®ä¾‹:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">engine</span> = <span style="color:#fff;font-weight:bold">new</span> PebbleEngine.<span style="color:#007f7f">Builder</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">autoEscaping</span>(<span style="color:#fff;font-weight:bold">true</span>) <span style="color:#007f7f">// é»˜è®¤æ‰“å¼€HTMLå­—ç¬¦è½¬ä¹‰ï¼Œé˜²æ­¢XSSæ”»å‡»</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">cacheActive</span>(<span style="color:#fff;font-weight:bold">false</span>) <span style="color:#007f7f">// ç¦ç”¨ç¼“å­˜ä½¿å¾—æ¯æ¬¡ä¿®æ”¹æ¨¡æ¿å¯ä»¥ç«‹åˆ»çœ‹åˆ°æ•ˆæœ</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">loader</span>(loader).<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> render(ModelAndView mv, Writer writer) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æŸ¥æ‰¾æ¨¡æ¿:</span>
</span></span><span style="display:flex;"><span>        PebbleTemplate template = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">engine</span>.<span style="color:#007f7f">getTemplate</span>(mv.<span style="color:#007f7f">view</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ¸²æŸ“:</span>
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">evaluate</span>(writer, mv.<span style="color:#007f7f">model</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä¸ªå·¥ç¨‹çš„ç»“æ„ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>web-mvc
</span></span><span style="display:flex;"><span>â”œâ”€â”€ pom.xml
</span></span><span style="display:flex;"><span>â””â”€â”€ src
</span></span><span style="display:flex;"><span>    â””â”€â”€ main
</span></span><span style="display:flex;"><span>        â”œâ”€â”€ java
</span></span><span style="display:flex;"><span>        â”‚   â””â”€â”€ com
</span></span><span style="display:flex;"><span>        â”‚       â””â”€â”€ itranswarp
</span></span><span style="display:flex;"><span>        â”‚           â””â”€â”€ learnjava
</span></span><span style="display:flex;"><span>        â”‚               â”œâ”€â”€ Main.java
</span></span><span style="display:flex;"><span>        â”‚               â”œâ”€â”€ bean
</span></span><span style="display:flex;"><span>        â”‚               â”‚   â”œâ”€â”€ SignInBean.java
</span></span><span style="display:flex;"><span>        â”‚               â”‚   â””â”€â”€ User.java
</span></span><span style="display:flex;"><span>        â”‚               â”œâ”€â”€ controller
</span></span><span style="display:flex;"><span>        â”‚               â”‚   â”œâ”€â”€ IndexController.java
</span></span><span style="display:flex;"><span>        â”‚               â”‚   â””â”€â”€ UserController.java
</span></span><span style="display:flex;"><span>        â”‚               â””â”€â”€ framework
</span></span><span style="display:flex;"><span>        â”‚                   â”œâ”€â”€ DispatcherServlet.java
</span></span><span style="display:flex;"><span>        â”‚                   â”œâ”€â”€ FileServlet.java
</span></span><span style="display:flex;"><span>        â”‚                   â”œâ”€â”€ GetMapping.java
</span></span><span style="display:flex;"><span>        â”‚                   â”œâ”€â”€ ModelAndView.java
</span></span><span style="display:flex;"><span>        â”‚                   â”œâ”€â”€ PostMapping.java
</span></span><span style="display:flex;"><span>        â”‚                   â””â”€â”€ ViewEngine.java
</span></span><span style="display:flex;"><span>        â””â”€â”€ webapp
</span></span><span style="display:flex;"><span>            â”œâ”€â”€ WEB-INF
</span></span><span style="display:flex;"><span>            â”‚   â”œâ”€â”€ templates
</span></span><span style="display:flex;"><span>            â”‚   â”‚   â”œâ”€â”€ _base.html
</span></span><span style="display:flex;"><span>            â”‚   â”‚   â”œâ”€â”€ hello.html
</span></span><span style="display:flex;"><span>            â”‚   â”‚   â”œâ”€â”€ index.html
</span></span><span style="display:flex;"><span>            â”‚   â”‚   â”œâ”€â”€ profile.html
</span></span><span style="display:flex;"><span>            â”‚   â”‚   â””â”€â”€ signin.html
</span></span><span style="display:flex;"><span>            â”‚   â””â”€â”€ web.xml
</span></span><span style="display:flex;"><span>            â””â”€â”€ static
</span></span><span style="display:flex;"><span>                â”œâ”€â”€ css
</span></span><span style="display:flex;"><span>                â”‚   â””â”€â”€ bootstrap.css
</span></span><span style="display:flex;"><span>                â””â”€â”€ js
</span></span><span style="display:flex;"><span>                    â”œâ”€â”€ bootstrap.js
</span></span><span style="display:flex;"><span>                    â””â”€â”€ jquery.js
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œ<code>framework</code>åŒ…æ˜¯MVCçš„æ¡†æ¶ï¼Œå®Œå…¨å¯ä»¥å•ç‹¬ç¼–è¯‘åä½œä¸ºä¸€ä¸ªMavenä¾èµ–å¼•å…¥ï¼Œ<code>controller</code>åŒ…æ‰æ˜¯æˆ‘ä»¬éœ€è¦ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>æˆ‘ä»¬è¿˜ç¡¬æ€§è§„å®šæ¨¡æ¿å¿…é¡»æ”¾åœ¨<code>webapp/WEB-INF/templates</code>ç›®å½•ä¸‹ï¼Œé™æ€æ–‡ä»¶å¿…é¡»æ”¾åœ¨<code>webapp/static</code>ç›®å½•ä¸‹ï¼Œå› æ­¤ï¼Œä¸ºäº†ä¾¿äºå¼€å‘ï¼Œæˆ‘ä»¬è¿˜é¡ºå¸¦å®ç°ä¸€ä¸ª<code>FileServlet</code>æ¥å¤„ç†é™æ€æ–‡ä»¶ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = { <span style="color:#0ff;font-weight:bold">&#34;/favicon.ico&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;/static/*&#34;</span> })
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> FileServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¯»å–å½“å‰è¯·æ±‚è·¯å¾„:</span>
</span></span><span style="display:flex;"><span>        ServletContext ctx = req.<span style="color:#007f7f">getServletContext</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// RequestURIåŒ…å«ContextPath,éœ€è¦å»æ‰:</span>
</span></span><span style="display:flex;"><span>        String urlPath = req.<span style="color:#007f7f">getRequestURI</span>().<span style="color:#007f7f">substring</span>(ctx.<span style="color:#007f7f">getContextPath</span>().<span style="color:#007f7f">length</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–çœŸå®æ–‡ä»¶è·¯å¾„:</span>
</span></span><span style="display:flex;"><span>        String filepath = ctx.<span style="color:#007f7f">getRealPath</span>(urlPath);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (filepath == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ— æ³•è·å–åˆ°è·¯å¾„:</span>
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">sendError</span>(HttpServletResponse.<span style="color:#007f7f">SC_NOT_FOUND</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Path path = Paths.<span style="color:#007f7f">get</span>(filepath);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!path.<span style="color:#007f7f">toFile</span>().<span style="color:#007f7f">isFile</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ–‡ä»¶ä¸å­˜åœ¨:</span>
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">sendError</span>(HttpServletResponse.<span style="color:#007f7f">SC_NOT_FOUND</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ ¹æ®æ–‡ä»¶åçŒœæµ‹Content-Type:</span>
</span></span><span style="display:flex;"><span>        String mime = Files.<span style="color:#007f7f">probeContentType</span>(path);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (mime == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            mime = <span style="color:#0ff;font-weight:bold">&#34;application/octet-stream&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setContentType</span>(mime);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¯»å–æ–‡ä»¶å¹¶å†™å…¥Response:</span>
</span></span><span style="display:flex;"><span>        OutputStream output = resp.<span style="color:#007f7f">getOutputStream</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> (InputStream input = <span style="color:#fff;font-weight:bold">new</span> BufferedInputStream(<span style="color:#fff;font-weight:bold">new</span> FileInputStream(filepath))) {
</span></span><span style="display:flex;"><span>            input.<span style="color:#007f7f">transferTo</span>(output);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        output.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œä»£ç ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥URL<code>http://localhost:8080/hello?name=Bob</code>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é¡µé¢ã€‚</p>
<p>ä¸ºäº†æŠŠæ–¹æ³•å‚æ•°çš„åç§°ç¼–è¯‘åˆ°classæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿å¤„ç†<code>@GetMapping</code>æ—¶ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€ç¼–è¯‘å™¨çš„ä¸€ä¸ªå‚æ•°ï¼Œåœ¨Eclipseä¸­å‹¾é€‰<code>Preferences</code>-<code>Java</code>-<code>Compiler</code>-<code>Store information about method parameters (usable via reflection)</code>ï¼›åœ¨Ideaä¸­é€‰æ‹©<code>Preferences</code>-<code>Build, Execution, Deployment</code>-<code>Compiler</code>-<code>Java Compiler</code>-<code>Additional command line parameters</code>ï¼Œå¡«å…¥<code>-parameters</code>ï¼›åœ¨Mavençš„<code>pom.xml</code>æ·»åŠ ä¸€æ®µé…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;project ...&gt;
</span></span><span style="display:flex;"><span>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    &lt;build&gt;
</span></span><span style="display:flex;"><span>        &lt;plugins&gt;
</span></span><span style="display:flex;"><span>            &lt;plugin&gt;
</span></span><span style="display:flex;"><span>                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>                &lt;configuration&gt;
</span></span><span style="display:flex;"><span>                    &lt;compilerArgs&gt;
</span></span><span style="display:flex;"><span>                        &lt;arg&gt;-parameters&lt;/arg&gt;
</span></span><span style="display:flex;"><span>                    &lt;/compilerArgs&gt;
</span></span><span style="display:flex;"><span>                &lt;/configuration&gt;
</span></span><span style="display:flex;"><span>            &lt;/plugin&gt;
</span></span><span style="display:flex;"><span>        &lt;/plugins&gt;
</span></span><span style="display:flex;"><span>    &lt;/build&gt;
</span></span><span style="display:flex;"><span>&lt;/project&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº›ç”¨è¿‡Spring MVCçš„ç«¥é‹ä¼šå‘ç°ï¼Œæœ¬èŠ‚å®ç°çš„è¿™ä¸ªMVCæ¡†æ¶ï¼Œä¸Šå±‚ä»£ç ä½¿ç”¨çš„å…¬å…±ç±»å¦‚<code>GetMapping</code>ã€<code>PostMapping</code>å’Œ<code>ModelAndView</code>éƒ½å’ŒSpring MVCéå¸¸ç±»ä¼¼ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬è¿™ä¸ªMVCæ¡†æ¶ä¸»è¦å‚è€ƒå°±æ˜¯Spring MVCï¼Œé€šè¿‡å®ç°ä¸€ä¸ªâ€œç®€åŒ–ç‰ˆâ€MVCï¼Œå¯ä»¥æŒæ¡Java Web MVCå¼€å‘çš„æ ¸å¿ƒæ€æƒ³ä¸åŸç†ï¼Œå¯¹å°†æ¥ç›´æ¥ä½¿ç”¨Spring MVCæ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p>
<h2 id="å°ç»“-4">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-4">#</a></h2>
<p>ä¸€ä¸ªMVCæ¡†æ¶æ˜¯åŸºäºServletåŸºç¡€æŠ½è±¡å‡ºæ›´é«˜çº§çš„æ¥å£ï¼Œä½¿å¾—ä¸Šå±‚åŸºäºMVCæ¡†æ¶çš„å¼€å‘å¯ä»¥ä¸æ¶‰åŠServletç›¸å…³çš„<code>HttpServletRequest</code>ç­‰æ¥å£ï¼Œå¤„ç†å¤šä¸ªè¯·æ±‚æ›´åŠ çµæ´»ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä»»æ„æ¨¡æ¿å¼•æ“ï¼Œä¸å¿…ä½¿ç”¨JSPã€‚</p>
<h1 id="ä½¿ç”¨filter">ä½¿ç”¨Filter<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨filter">#</a></h1>
<p>åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„Webåº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸éƒ½æœ‰å¾ˆå¤šURLæ˜ å°„ï¼Œå¯¹åº”çš„ï¼Œä¹Ÿä¼šæœ‰å¤šä¸ªServletæ¥å¤„ç†URLã€‚</p>
<p>æˆ‘ä»¬è€ƒå¯Ÿè¿™æ ·ä¸€ä¸ªè®ºå›åº”ç”¨ç¨‹åºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>            â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”
</span></span><span style="display:flex;"><span>               /             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ IndexServlet â”‚ â”‚
</span></span><span style="display:flex;"><span>              â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>            â”‚ â”‚/signin       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚SignInServlet â”‚
</span></span><span style="display:flex;"><span>            â”‚ â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>              â”‚/signout      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚SignOutServletâ”‚ â”‚
</span></span><span style="display:flex;"><span>â”‚Browserâ”œâ”€â”€â”€â”€â”€â”¤              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚/user/profile â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ProfileServletâ”‚
</span></span><span style="display:flex;"><span>            â”‚ â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>              â”‚/user/post    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>            â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ PostServlet  â”‚ â”‚
</span></span><span style="display:flex;"><span>              â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>            â”‚ â”‚/user/reply   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ ReplyServlet â”‚
</span></span><span style="display:flex;"><span>            â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>             â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
</span></span></code></pre></td></tr></table>
</div>
</div><p>å„ä¸ªServletè®¾è®¡åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>IndexServletï¼šæµè§ˆå¸–å­ï¼›</li>
<li>SignInServletï¼šç™»å½•ï¼›</li>
<li>SignOutServletï¼šç™»å‡ºï¼›</li>
<li>ProfileServletï¼šä¿®æ”¹ç”¨æˆ·èµ„æ–™ï¼›</li>
<li>PostServletï¼šå‘å¸–ï¼›</li>
<li>ReplyServletï¼šå›å¤ã€‚</li>
</ul>
<p>å…¶ä¸­ï¼ŒProfileServletã€PostServletå’ŒReplyServletéƒ½éœ€è¦ç”¨æˆ·ç™»å½•åæ‰èƒ½æ“ä½œï¼Œå¦åˆ™ï¼Œåº”å½“ç›´æ¥è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠåˆ¤æ–­ç™»å½•çš„é€»è¾‘å†™åˆ°è¿™3ä¸ªServletä¸­ï¼Œä½†æ˜¯ï¼ŒåŒæ ·çš„é€»è¾‘é‡å¤3æ¬¡æ²¡æœ‰å¿…è¦ï¼Œå¹¶ä¸”ï¼Œå¦‚æœåç»­ç»§ç»­åŠ Servletå¹¶ä¸”ä¹Ÿéœ€è¦éªŒè¯ç™»å½•æ—¶ï¼Œè¿˜éœ€è¦ç»§ç»­é‡å¤è¿™ä¸ªæ£€æŸ¥é€»è¾‘ã€‚</p>
<p>ä¸ºäº†æŠŠä¸€äº›å…¬ç”¨é€»è¾‘ä»å„ä¸ªServletä¸­æŠ½ç¦»å‡ºæ¥ï¼ŒJavaEEçš„Servletè§„èŒƒè¿˜æä¾›äº†ä¸€ç§Filterç»„ä»¶ï¼Œå³è¿‡æ»¤å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼Œåœ¨HTTPè¯·æ±‚åˆ°è¾¾Servletä¹‹å‰ï¼Œå¯ä»¥è¢«ä¸€ä¸ªæˆ–å¤šä¸ªFilteré¢„å¤„ç†ï¼Œç±»ä¼¼æ‰“å°æ—¥å¿—ã€ç™»å½•æ£€æŸ¥ç­‰é€»è¾‘ï¼Œå®Œå…¨å¯ä»¥æ”¾åˆ°Filterä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„EncodingFilterï¼Œå®ƒå¼ºåˆ¶æŠŠè¾“å…¥å’Œè¾“å‡ºçš„ç¼–ç è®¾ç½®ä¸ºUTF-8ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebFilter(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/*&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> EncodingFilter <span style="color:#fff;font-weight:bold">implements</span> Filter {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;EncodingFilter:doFilter&#34;</span>);
</span></span><span style="display:flex;"><span>        request.<span style="color:#007f7f">setCharacterEncoding</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setCharacterEncoding</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>        chain.<span style="color:#007f7f">doFilter</span>(request, response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–å†™Filteræ—¶ï¼Œå¿…é¡»å®ç°<code>Filter</code>æ¥å£ï¼Œåœ¨<code>doFilter()</code>æ–¹æ³•å†…éƒ¨ï¼Œè¦ç»§ç»­å¤„ç†è¯·æ±‚ï¼Œå¿…é¡»è°ƒç”¨<code>chain.doFilter()</code>ã€‚æœ€åï¼Œç”¨<code>@WebFilter</code>æ³¨è§£æ ‡æ³¨è¯¥Filteréœ€è¦è¿‡æ»¤çš„URLã€‚è¿™é‡Œçš„<code>/*</code>è¡¨ç¤ºæ‰€æœ‰è·¯å¾„ã€‚</p>
<p>æ·»åŠ äº†Filterä¹‹åï¼Œæ•´ä¸ªè¯·æ±‚çš„å¤„ç†æ¶æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>            â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”
</span></span><span style="display:flex;"><span>                                   /             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>            â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ IndexServlet â”‚ â”‚
</span></span><span style="display:flex;"><span>                                  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>            â”‚                     â”‚/signin       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚SignInServlet â”‚
</span></span><span style="display:flex;"><span>            â”‚                     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>                                  â”‚/signout      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚SignOutServletâ”‚ â”‚
</span></span><span style="display:flex;"><span>â”‚Browserâ”‚â”€â”€â”€â”€â”€â”€&gt;â”‚EncodingFilterâ”œâ”€â”€â”¤              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚/user/profile â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ProfileServletâ”‚
</span></span><span style="display:flex;"><span>            â”‚                     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>                                  â”‚/user/post    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>            â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ PostServlet  â”‚ â”‚
</span></span><span style="display:flex;"><span>                                  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>            â”‚                     â”‚/user/reply   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚ ReplyServlet â”‚
</span></span><span style="display:flex;"><span>            â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>             â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿˜å¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–Filterï¼Œä¾‹å¦‚LogFilterï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebFilter(<span style="color:#0ff;font-weight:bold">&#34;/*&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LogFilter <span style="color:#fff;font-weight:bold">implements</span> Filter {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;LogFilter: process &#34;</span> + ((HttpServletRequest) request).<span style="color:#007f7f">getRequestURI</span>());
</span></span><span style="display:flex;"><span>        chain.<span style="color:#007f7f">doFilter</span>(request, response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¤šä¸ªFilterä¼šç»„æˆä¸€ä¸ªé“¾ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½è¢«é“¾ä¸Šçš„Filterä¾æ¬¡å¤„ç†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                                     â”Œâ”€&gt;â”‚ServletAâ”‚
</span></span><span style="display:flex;"><span>                                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”€â”€â”€&gt;â”‚EncodingFilterâ”‚â”€â”€â”€&gt;â”‚LogFilterâ”‚â”€â”€â”¼â”€&gt;â”‚ServletBâ”‚
</span></span><span style="display:flex;"><span>    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>                                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                                     â””â”€&gt;â”‚ServletCâ”‚
</span></span><span style="display:flex;"><span>                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº›ç»†å¿ƒçš„ç«¥é‹ä¼šé—®ï¼Œæœ‰å¤šä¸ªFilterçš„æ—¶å€™ï¼ŒFilterçš„é¡ºåºå¦‚ä½•æŒ‡å®šï¼Ÿå¤šä¸ªFilteræŒ‰ä¸åŒé¡ºåºå¤„ç†ä¼šé€ æˆå¤„ç†ç»“æœä¸åŒå—ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯Filterçš„é¡ºåºç¡®å®å¯¹å¤„ç†çš„ç»“æœæœ‰å½±å“ã€‚ä½†é—æ†¾çš„æ˜¯ï¼ŒServletè§„èŒƒå¹¶æ²¡æœ‰å¯¹<code>@WebFilter</code>æ³¨è§£æ ‡æ³¨çš„Filterè§„å®šé¡ºåºã€‚å¦‚æœä¸€å®šè¦ç»™æ¯ä¸ªFilteræŒ‡å®šé¡ºåºï¼Œå°±å¿…é¡»åœ¨<code>web.xml</code>æ–‡ä»¶ä¸­å¯¹è¿™äº›Filterå†é…ç½®ä¸€éã€‚</p>
<p>æ³¨æ„åˆ°ä¸Šè¿°ä¸¤ä¸ªFilterçš„è¿‡æ»¤è·¯å¾„éƒ½æ˜¯<code>/*</code>ï¼Œå³å®ƒä»¬ä¼šå¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œè¿‡æ»¤ã€‚ä¹Ÿå¯ä»¥ç¼–å†™åªå¯¹ç‰¹å®šè·¯å¾„è¿›è¡Œè¿‡æ»¤çš„Filterï¼Œä¾‹å¦‚<code>AuthFilter</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebFilter(<span style="color:#0ff;font-weight:bold">&#34;/user/*&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AuthFilter <span style="color:#fff;font-weight:bold">implements</span> Filter {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;AuthFilter: check authentication&#34;</span>);
</span></span><span style="display:flex;"><span>        HttpServletRequest req = (HttpServletRequest) request;
</span></span><span style="display:flex;"><span>        HttpServletResponse resp = (HttpServletResponse) response;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (req.<span style="color:#007f7f">getSession</span>().<span style="color:#007f7f">getAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>) == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æœªç™»å½•ï¼Œè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ:</span>
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;AuthFilter: not signin!&#34;</span>);
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">sendRedirect</span>(<span style="color:#0ff;font-weight:bold">&#34;/signin&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å·²ç™»å½•ï¼Œç»§ç»­å¤„ç†:</span>
</span></span><span style="display:flex;"><span>            chain.<span style="color:#007f7f">doFilter</span>(request, response);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°<code>AuthFilter</code>åªè¿‡æ»¤ä»¥<code>/user/</code>å¼€å¤´çš„è·¯å¾„ï¼Œå› æ­¤ï¼š</p>
<ul>
<li>å¦‚æœä¸€ä¸ªè¯·æ±‚è·¯å¾„ç±»ä¼¼<code>/user/profile</code>ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«ä¸Šè¿°3ä¸ªFilterä¾æ¬¡å¤„ç†ï¼›</li>
<li>å¦‚æœä¸€ä¸ªè¯·æ±‚è·¯å¾„ç±»ä¼¼<code>/test</code>ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«ä¸Šè¿°2ä¸ªFilterä¾æ¬¡å¤„ç†ï¼ˆä¸ä¼šè¢«AuthFilterå¤„ç†ï¼‰ã€‚</li>
</ul>
<p>å†æ³¨æ„è§‚å¯Ÿ<code>AuthFilter</code>ï¼Œå½“ç”¨æˆ·æ²¡æœ‰ç™»å½•æ—¶ï¼Œåœ¨<code>AuthFilter</code>å†…éƒ¨ï¼Œç›´æ¥è°ƒç”¨<code>resp.sendRedirect()</code>å‘é€é‡å®šå‘ï¼Œä¸”æ²¡æœ‰è°ƒç”¨<code>chain.doFilter()</code>ï¼Œå› æ­¤ï¼Œå½“ç”¨æˆ·æ²¡æœ‰ç™»å½•æ—¶ï¼Œè¯·æ±‚åˆ°è¾¾<code>AuthFilter</code>åï¼Œä¸å†ç»§ç»­å¤„ç†ï¼Œå³åç»­çš„Filterå’Œä»»ä½•Servletéƒ½æ²¡æœ‰æœºä¼šå¤„ç†è¯¥è¯·æ±‚äº†ã€‚</p>
<p>å¯è§ï¼ŒFilterå¯ä»¥æœ‰é’ˆå¯¹æ€§åœ°æ‹¦æˆªæˆ–è€…æ”¾è¡ŒHTTPè¯·æ±‚ã€‚</p>
<p>å¦‚æœä¸€ä¸ªFilteråœ¨å½“å‰è¯·æ±‚ä¸­ç”Ÿæ•ˆï¼Œä½†ä»€ä¹ˆéƒ½æ²¡æœ‰åšï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebFilter(<span style="color:#0ff;font-weight:bold">&#34;/*&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MyFilter <span style="color:#fff;font-weight:bold">implements</span> Filter {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// TODO</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆï¼Œç”¨æˆ·å°†çœ‹åˆ°ä¸€ä¸ªç©ºç™½é¡µï¼Œå› ä¸ºè¯·æ±‚æ²¡æœ‰ç»§ç»­å¤„ç†ï¼Œé»˜è®¤å“åº”æ˜¯200+ç©ºç™½è¾“å‡ºã€‚</p>
<p>æ³¨æ„ï¼šå¦‚æœFilterè¦ä½¿è¯·æ±‚ç»§ç»­è¢«å¤„ç†ï¼Œå°±ä¸€å®šè¦è°ƒç”¨<code>chain.doFilter()</code></p>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸Šä¸€èŠ‚ä»‹ç»çš„MVCæ¨¡å¼ï¼Œå³ä¸€ä¸ªç»Ÿä¸€çš„<code>DispatcherServlet</code>å…¥å£ï¼ŒåŠ ä¸Šå¤šä¸ªControllerï¼Œè¿™ç§æ¨¡å¼ä¸‹Filterä»ç„¶æ˜¯æ­£å¸¸å·¥ä½œçš„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¤„ç†<code>/user/*</code>çš„Filterå®é™…ä¸Šä½œç”¨äºé‚£äº›å¤„ç†<code>/user/</code>å¼€å¤´çš„Controlleræ–¹æ³•ä¹‹å‰ã€‚</p>
<h2 id="å°ç»“-5">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-5">#</a></h2>
<p>Filteræ˜¯ä¸€ç§å¯¹HTTPè¯·æ±‚è¿›è¡Œé¢„å¤„ç†çš„ç»„ä»¶ï¼Œå®ƒå¯ä»¥æ„æˆä¸€ä¸ªå¤„ç†é“¾ï¼Œä½¿å¾—å…¬å…±å¤„ç†ä»£ç èƒ½é›†ä¸­åˆ°ä¸€èµ·ï¼›
Filteré€‚ç”¨äºæ—¥å¿—ã€ç™»å½•æ£€æŸ¥ã€å…¨å±€è®¾ç½®ç­‰ï¼›
è®¾è®¡åˆç†çš„URLæ˜ å°„å¯ä»¥è®©Filteré“¾æ›´æ¸…æ™°ã€‚</p>
<h2 id="ä¿®æ”¹è¯·æ±‚">ä¿®æ”¹è¯·æ±‚<a hidden class="anchor" aria-hidden="true" href="#ä¿®æ”¹è¯·æ±‚">#</a></h2>
<p>Filterå¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¾ˆå¤šå…¬å…±é¢„å¤„ç†é€»è¾‘æ”¾åˆ°Filterä¸­å®Œæˆã€‚</p>
<p>è€ƒå¯Ÿè¿™æ ·ä¸€ç§éœ€æ±‚ï¼šæˆ‘ä»¬åœ¨Webåº”ç”¨ä¸­ç»å¸¸éœ€è¦å¤„ç†ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªUploadServletå¯ä»¥ç®€å•åœ°ç¼–å†™å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/upload/file&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UploadServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doPost(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¯»å–Request Body:</span>
</span></span><span style="display:flex;"><span>        InputStream input = req.<span style="color:#007f7f">getInputStream</span>();
</span></span><span style="display:flex;"><span>        ByteArrayOutputStream output = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">byte</span>[] buffer = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[1024];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> len = input.<span style="color:#007f7f">read</span>(buffer);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (len == -1) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            output.<span style="color:#007f7f">write</span>(buffer, 0, len);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// TODO: å†™å…¥æ–‡ä»¶:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ˜¾ç¤ºä¸Šä¼ ç»“æœ:</span>
</span></span><span style="display:flex;"><span>        String uploadedText = output.<span style="color:#007f7f">toString</span>(StandardCharsets.<span style="color:#007f7f">UTF_8</span>);
</span></span><span style="display:flex;"><span>        PrintWriter pw = resp.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;Uploaded:&lt;/h1&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;pre&gt;&lt;code&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(uploadedText);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;/code&gt;&lt;/pre&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯è¦ä¿è¯æ–‡ä»¶ä¸Šä¼ çš„å®Œæ•´æ€§æ€ä¹ˆåŠï¼Ÿåœ¨<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1304227729113121">å“ˆå¸Œç®—æ³•</a>ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœåœ¨ä¸Šä¼ æ–‡ä»¶çš„åŒæ—¶ï¼ŒæŠŠæ–‡ä»¶çš„å“ˆå¸Œä¹Ÿä¼ è¿‡æ¥ï¼ŒæœåŠ¡å™¨ç«¯åšä¸€ä¸ªéªŒè¯ï¼Œå°±å¯ä»¥ç¡®ä¿ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ä¸€å®šæ˜¯å®Œæ•´çš„ã€‚</p>
<p>è¿™ä¸ªéªŒè¯é€»è¾‘éå¸¸é€‚åˆå†™åœ¨<code>ValidateUploadFilter</code>ä¸­ï¼Œå› ä¸ºå®ƒå¯ä»¥å¤ç”¨ã€‚</p>
<p>æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€å•çš„ç‰ˆæœ¬ï¼Œå¿«é€Ÿå®ç°<code>ValidateUploadFilter</code>çš„é€»è¾‘ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebFilter(<span style="color:#0ff;font-weight:bold">&#34;/upload/*&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ValidateUploadFilter <span style="color:#fff;font-weight:bold">implements</span> Filter {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        HttpServletRequest req = (HttpServletRequest) request;
</span></span><span style="display:flex;"><span>        HttpServletResponse resp = (HttpServletResponse) response;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–å®¢æˆ·ç«¯ä¼ å…¥çš„ç­¾åæ–¹æ³•å’Œç­¾å:</span>
</span></span><span style="display:flex;"><span>        String digest = req.<span style="color:#007f7f">getHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Signature-Method&#34;</span>);
</span></span><span style="display:flex;"><span>        String signature = req.<span style="color:#007f7f">getHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Signature&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (digest == <span style="color:#fff;font-weight:bold">null</span> || digest.<span style="color:#007f7f">isEmpty</span>() || signature == <span style="color:#fff;font-weight:bold">null</span> || signature.<span style="color:#007f7f">isEmpty</span>()) {
</span></span><span style="display:flex;"><span>            sendErrorPage(resp, <span style="color:#0ff;font-weight:bold">&#34;Missing signature.&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¯»å–Requestçš„Bodyå¹¶éªŒè¯ç­¾å:</span>
</span></span><span style="display:flex;"><span>        MessageDigest md = getMessageDigest(digest);
</span></span><span style="display:flex;"><span>        InputStream input = <span style="color:#fff;font-weight:bold">new</span> DigestInputStream(request.<span style="color:#007f7f">getInputStream</span>(), md);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">byte</span>[] buffer = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[1024];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> len = input.<span style="color:#007f7f">read</span>(buffer);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (len == -1) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        String actual = toHexString(md.<span style="color:#007f7f">digest</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!signature.<span style="color:#007f7f">equals</span>(actual)) {
</span></span><span style="display:flex;"><span>            sendErrorPage(resp, <span style="color:#0ff;font-weight:bold">&#34;Invalid signature.&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// éªŒè¯æˆåŠŸåç»§ç»­å¤„ç†:</span>
</span></span><span style="display:flex;"><span>        chain.<span style="color:#007f7f">doFilter</span>(request, response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å°†byte[]è½¬æ¢ä¸ºhex string:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String toHexString(<span style="color:#fff;font-weight:bold">byte</span>[] digest) {
</span></span><span style="display:flex;"><span>        StringBuilder sb = <span style="color:#fff;font-weight:bold">new</span> StringBuilder();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">byte</span> b : digest) {
</span></span><span style="display:flex;"><span>            sb.<span style="color:#007f7f">append</span>(String.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;%02x&#34;</span>, b));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> sb.<span style="color:#007f7f">toString</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ ¹æ®åç§°åˆ›å»ºMessageDigest:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> MessageDigest getMessageDigest(String name) <span style="color:#fff;font-weight:bold">throws</span> ServletException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> MessageDigest.<span style="color:#007f7f">getInstance</span>(name);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (NoSuchAlgorithmException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> ServletException(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å‘é€ä¸€ä¸ªé”™è¯¯å“åº”:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> sendErrorPage(HttpServletResponse resp, String errorMessage) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setStatus</span>(HttpServletResponse.<span style="color:#007f7f">SC_BAD_REQUEST</span>);
</span></span><span style="display:flex;"><span>        PrintWriter pw = resp.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;html&gt;&lt;body&gt;&lt;h1&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(errorMessage);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ª<code>ValidateUploadFilter</code>çš„é€»è¾‘ä¼¼ä¹æ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨curlå‘½ä»¤æµ‹è¯•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl http://localhost:8080/upload/file -v -d <span style="color:#0ff;font-weight:bold">&#39;test-data&#39;</span> <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span>  -H <span style="color:#0ff;font-weight:bold">&#39;Signature-Method: SHA-1&#39;</span> <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span>  -H <span style="color:#0ff;font-weight:bold">&#39;Signature: 7115e9890f5b5cc6914bdfa3b7c011db1cdafedb&#39;</span> <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span>  -H <span style="color:#0ff;font-weight:bold">&#39;Content-Type: application/octet-stream&#39;</span>
</span></span><span style="display:flex;"><span>*   Trying ::1...
</span></span><span style="display:flex;"><span>* TCP_NODELAY <span style="color:#fff;font-weight:bold">set</span>
</span></span><span style="display:flex;"><span>* Connected to localhost (::1) port <span style="color:#ff0;font-weight:bold">8080</span> (<span style="color:#007f7f">#0)</span>
</span></span><span style="display:flex;"><span>&gt; POST /upload/file HTTP/1.1
</span></span><span style="display:flex;"><span>&gt; Host: localhost:8080
</span></span><span style="display:flex;"><span>&gt; User-Agent: curl/7.64.1
</span></span><span style="display:flex;"><span>&gt; Accept: */*
</span></span><span style="display:flex;"><span>&gt; Signature-Method: SHA-1
</span></span><span style="display:flex;"><span>&gt; Signature: 7115e9890f5b5cc6914bdfa3b7c011db1cdafedb
</span></span><span style="display:flex;"><span>&gt; Content-Type: application/octet-stream
</span></span><span style="display:flex;"><span>&gt; Content-Length: <span style="color:#ff0;font-weight:bold">9</span>
</span></span><span style="display:flex;"><span>&gt; 
</span></span><span style="display:flex;"><span>* upload completely sent off: <span style="color:#ff0;font-weight:bold">9</span> out of <span style="color:#ff0;font-weight:bold">9</span> bytes
</span></span><span style="display:flex;"><span>&lt; HTTP/1.1 <span style="color:#ff0;font-weight:bold">200</span> 
</span></span><span style="display:flex;"><span>&lt; Transfer-Encoding: chunked
</span></span><span style="display:flex;"><span>&lt; Date: Thu, <span style="color:#ff0;font-weight:bold">30</span> Jan <span style="color:#ff0;font-weight:bold">2020</span> 13:56:39 GMT
</span></span><span style="display:flex;"><span>&lt; 
</span></span><span style="display:flex;"><span>* Connection <span style="color:#007f7f">#0 to host localhost left intact</span>
</span></span><span style="display:flex;"><span>&lt;h1&gt;Uploaded:&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;
</span></span><span style="display:flex;"><span>* Closing connection <span style="color:#ff0;font-weight:bold">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ValidateUploadFilter</code>å¯¹ç­¾åè¿›è¡ŒéªŒè¯çš„é€»è¾‘æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯ï¼Œç»†å¿ƒçš„ç«¥é‹æ³¨æ„åˆ°ï¼Œ<code>UploadServlet</code>å¹¶æœªè¯»å–åˆ°ä»»ä½•æ•°æ®ï¼</p>
<p>è¿™é‡Œçš„åŸå› æ˜¯å¯¹<code>HttpServletRequest</code>è¿›è¡Œè¯»å–æ—¶ï¼Œåªèƒ½è¯»å–ä¸€æ¬¡ã€‚å¦‚æœFilterè°ƒç”¨<code>getInputStream()</code>è¯»å–äº†ä¸€æ¬¡æ•°æ®ï¼Œåç»­Servletå¤„ç†æ—¶ï¼Œå†æ¬¡è¯»å–ï¼Œå°†æ— æ³•è¯»åˆ°ä»»ä½•æ•°æ®ã€‚æ€ä¹ˆåŠï¼Ÿ</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªâ€œä¼ªé€ â€çš„<code>HttpServletRequest</code>ï¼Œå…·ä½“åšæ³•æ˜¯ä½¿ç”¨<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1281319432618017">ä»£ç†æ¨¡å¼</a>ï¼Œå¯¹<code>getInputStream()</code>å’Œ<code>getReader()</code>è¿”å›ä¸€ä¸ªæ–°çš„æµï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> ReReadableHttpServletRequest <span style="color:#fff;font-weight:bold">extends</span> HttpServletRequestWrapper {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">byte</span>[] body;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">boolean</span> open = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ReReadableHttpServletRequest(HttpServletRequest request, <span style="color:#fff;font-weight:bold">byte</span>[] body) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(request);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">body</span> = body;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è¿”å›InputStream:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ServletInputStream getInputStream() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (open) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalStateException(<span style="color:#0ff;font-weight:bold">&#34;Cannot re-open input stream!&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        open = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ServletInputStream() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> offset = 0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isFinished() {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> offset &gt;= body.<span style="color:#007f7f">length</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isReady() {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setReadListener(ReadListener listener) {
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> read() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (offset &gt;= body.<span style="color:#007f7f">length</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">return</span> -1;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">int</span> n = body[offset] &amp; 0xff;
</span></span><span style="display:flex;"><span>                offset++;
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> n;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è¿”å›Reader:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> BufferedReader getReader() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (open) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalStateException(<span style="color:#0ff;font-weight:bold">&#34;Cannot re-open reader!&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        open = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> BufferedReader(<span style="color:#fff;font-weight:bold">new</span> InputStreamReader(<span style="color:#fff;font-weight:bold">new</span> ByteArrayInputStream(body), <span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„è§‚å¯Ÿ<code>ReReadableHttpServletRequest</code>çš„æ„é€ æ–¹æ³•ï¼Œå®ƒä¿å­˜äº†<code>ValidateUploadFilter</code>è¯»å–çš„<code>byte[]</code>å†…å®¹ï¼Œå¹¶åœ¨è°ƒç”¨<code>getInputStream()</code>æ—¶é€šè¿‡<code>byte[]</code>æ„é€ äº†ä¸€ä¸ªæ–°çš„<code>ServletInputStream</code>ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬åœ¨<code>ValidateUploadFilter</code>ä¸­ï¼ŒæŠŠ<code>doFilter()</code>è°ƒç”¨æ—¶ä¼ ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…çš„<code>HttpServletRequest</code>æ›¿æ¢ä¸ºæˆ‘ä»¬è‡ªå·±â€œä¼ªé€ â€çš„<code>ReReadableHttpServletRequest</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    chain.<span style="color:#007f7f">doFilter</span>(<span style="color:#fff;font-weight:bold">new</span> ReReadableHttpServletRequest(req, output.<span style="color:#007f7f">toByteArray</span>()), response);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†æ³¨æ„åˆ°æˆ‘ä»¬ç¼–å†™<code>ReReadableHttpServletRequest</code>æ—¶ï¼Œæ˜¯ä»<code>HttpServletRequestWrapper</code>ç»§æ‰¿ï¼Œè€Œä¸æ˜¯ç›´æ¥å®ç°<code>HttpServletRequest</code>æ¥å£ã€‚è¿™æ˜¯å› ä¸ºï¼ŒServletçš„æ¯ä¸ªæ–°ç‰ˆæœ¬éƒ½ä¼šå¯¹æ¥å£å¢åŠ ä¸€äº›æ–°æ–¹æ³•ï¼Œä»<code>HttpServletRequestWrapper</code>ç»§æ‰¿å¯ä»¥ç¡®ä¿æ–°æ–¹æ³•è¢«æ­£ç¡®åœ°è¦†å†™äº†ï¼Œå› ä¸º<code>HttpServletRequestWrapper</code>æ˜¯ç”±Servletçš„jaråŒ…æä¾›çš„ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†è®©æˆ‘ä»¬æ–¹ä¾¿åœ°å®ç°å¯¹<code>HttpServletRequest</code>æ¥å£çš„ä»£ç†ã€‚</p>
<p>æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å¯¹<code>HttpServletRequest</code>æ¥å£è¿›è¡Œä»£ç†çš„æ­¥éª¤ï¼š</p>
<ol>
<li>ä»<code>HttpServletRequestWrapper</code>ç»§æ‰¿ä¸€ä¸ª<code>XxxHttpServletRequest</code>ï¼Œéœ€è¦ä¼ å…¥åŸå§‹çš„<code>HttpServletRequest</code>å®ä¾‹ï¼›</li>
<li>è¦†å†™æŸäº›æ–¹æ³•ï¼Œä½¿å¾—æ–°çš„<code>XxxHttpServletRequest</code>å®ä¾‹çœ‹ä¸Šå»â€œæ”¹å˜â€äº†åŸå§‹çš„<code>HttpServletRequest</code>å®ä¾‹ï¼›</li>
<li>åœ¨<code>doFilter()</code>ä¸­ä¼ å…¥æ–°çš„<code>XxxHttpServletRequest</code>å®ä¾‹ã€‚</li>
</ol>
<p>è™½ç„¶æ•´ä¸ªFilterçš„ä»£ç æ¯”è¾ƒå¤æ‚ï¼Œä½†å®ƒçš„å¥½å¤„åœ¨äºï¼šè¿™ä¸ªFilteråœ¨æ•´ä¸ªå¤„ç†é“¾ä¸­å®ç°äº†çµæ´»çš„â€œå¯æ’æ‹”â€ç‰¹æ€§ï¼Œå³æ˜¯å¦å¯ç”¨å¯¹Webåº”ç”¨ç¨‹åºçš„å…¶ä»–ç»„ä»¶ï¼ˆFilterã€Servletï¼‰å®Œå…¨æ²¡æœ‰å½±å“ã€‚</p>
<h3 id="å°ç»“-6">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-6">#</a></h3>
<p>å€ŸåŠ©<code>HttpServletRequestWrapper</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Filterä¸­å®ç°å¯¹åŸå§‹<code>HttpServletRequest</code>çš„ä¿®æ”¹ã€‚</p>
<h2 id="ä¿®æ”¹å“åº”">ä¿®æ”¹å“åº”<a hidden class="anchor" aria-hidden="true" href="#ä¿®æ”¹å“åº”">#</a></h2>
<p>æ—¢ç„¶æˆ‘ä»¬èƒ½é€šè¿‡Filterä¿®æ”¹<code>HttpServletRequest</code>ï¼Œè‡ªç„¶ä¹Ÿèƒ½ä¿®æ”¹<code>HttpServletResponse</code>ï¼Œå› ä¸ºè¿™ä¸¤è€…éƒ½æ˜¯æ¥å£ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ä¿®æ”¹<code>HttpServletResponse</code>ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªServletï¼Œä½†ç”±äºä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå¤„ç†è¯¥è¯·æ±‚éœ€è¦è€—è´¹å¾ˆé•¿çš„æ—¶é—´ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/slow/hello&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HelloServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;text/html&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ¨¡æ‹Ÿè€—æ—¶1ç§’:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#007f7f">sleep</span>(1000);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        PrintWriter pw = resp.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        pw.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¥½æ¶ˆæ¯æ˜¯æ¯æ¬¡è¿”å›çš„å“åº”å†…å®¹æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬èƒ½ä½¿ç”¨ç¼“å­˜å°†ç»“æœç¼“å­˜èµ·æ¥ï¼Œå°±å¯ä»¥å¤§å¤§æé«˜Webåº”ç”¨ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p>
<p>ç¼“å­˜é€»è¾‘æœ€å¥½ä¸è¦åœ¨Servletå†…éƒ¨å®ç°ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›èƒ½å¤ç”¨ç¼“å­˜é€»è¾‘ï¼Œæ‰€ä»¥ï¼Œç¼–å†™ä¸€ä¸ª<code>CacheFilter</code>æœ€åˆé€‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebFilter(<span style="color:#0ff;font-weight:bold">&#34;/slow/*&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> CacheFilter <span style="color:#fff;font-weight:bold">implements</span> Filter {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Pathåˆ°byte[]çš„ç¼“å­˜:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Map&lt;String, <span style="color:#fff;font-weight:bold">byte</span>[]&gt; cache = <span style="color:#fff;font-weight:bold">new</span> ConcurrentHashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        HttpServletRequest req = (HttpServletRequest) request;
</span></span><span style="display:flex;"><span>        HttpServletResponse resp = (HttpServletResponse) response;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–Path:</span>
</span></span><span style="display:flex;"><span>        String url = req.<span style="color:#007f7f">getRequestURI</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–ç¼“å­˜å†…å®¹:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">byte</span>[] data = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">cache</span>.<span style="color:#007f7f">get</span>(url);
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;X-Cache-Hit&#34;</span>, data == <span style="color:#fff;font-weight:bold">null</span> ? <span style="color:#0ff;font-weight:bold">&#34;No&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;Yes&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (data == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// ç¼“å­˜æœªæ‰¾åˆ°,æ„é€ ä¸€ä¸ªä¼ªé€ çš„Response:</span>
</span></span><span style="display:flex;"><span>            CachedHttpServletResponse wrapper = <span style="color:#fff;font-weight:bold">new</span> CachedHttpServletResponse(resp);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è®©ä¸‹æ¸¸ç»„ä»¶å†™å…¥æ•°æ®åˆ°ä¼ªé€ çš„Response:</span>
</span></span><span style="display:flex;"><span>            chain.<span style="color:#007f7f">doFilter</span>(request, wrapper);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// ä»ä¼ªé€ çš„Responseä¸­è¯»å–å†™å…¥çš„å†…å®¹å¹¶æ”¾å…¥ç¼“å­˜:</span>
</span></span><span style="display:flex;"><span>            data = wrapper.<span style="color:#007f7f">getContent</span>();
</span></span><span style="display:flex;"><span>            cache.<span style="color:#007f7f">put</span>(url, data);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å†™å…¥åˆ°åŸå§‹çš„Response:</span>
</span></span><span style="display:flex;"><span>        ServletOutputStream output = resp.<span style="color:#007f7f">getOutputStream</span>();
</span></span><span style="display:flex;"><span>        output.<span style="color:#007f7f">write</span>(data);
</span></span><span style="display:flex;"><span>        output.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ç°ç¼“å­˜çš„å…³é”®åœ¨äºï¼Œè°ƒç”¨<code>doFilter()</code>æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½ä¼ å…¥åŸå§‹çš„<code>HttpServletResponse</code>ï¼Œå› ä¸ºè¿™æ ·å°±ä¼šå†™å…¥Socketï¼Œæˆ‘ä»¬ä¹Ÿå°±æ— æ³•è·å–ä¸‹æ¸¸ç»„ä»¶å†™å…¥çš„å†…å®¹ã€‚å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„æ˜¯â€œä¼ªé€ â€çš„<code>HttpServletResponse</code>ï¼Œè®©ä¸‹æ¸¸ç»„ä»¶å†™å…¥åˆ°æˆ‘ä»¬é¢„è®¾çš„<code>ByteArrayOutputStream</code>ï¼Œæˆ‘ä»¬å°±â€œæˆªè·â€äº†ä¸‹æ¸¸ç»„ä»¶å†™å…¥çš„å†…å®¹ï¼Œäºæ˜¯ï¼Œå°±å¯ä»¥æŠŠå†…å®¹ç¼“å­˜èµ·æ¥ï¼Œå†é€šè¿‡åŸå§‹çš„<code>HttpServletResponse</code>å®ä¾‹å†™å…¥åˆ°ç½‘ç»œã€‚</p>
<p>è¿™ä¸ª<code>CachedHttpServletResponse</code>å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> CachedHttpServletResponse <span style="color:#fff;font-weight:bold">extends</span> HttpServletResponseWrapper {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">boolean</span> open = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> ByteArrayOutputStream output = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> CachedHttpServletResponse(HttpServletResponse response) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è·å–Writer:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> PrintWriter getWriter() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (open) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalStateException(<span style="color:#0ff;font-weight:bold">&#34;Cannot re-open writer!&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        open = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> PrintWriter(output, <span style="color:#fff;font-weight:bold">false</span>, StandardCharsets.<span style="color:#007f7f">UTF_8</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è·å–OutputStream:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ServletOutputStream getOutputStream() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (open) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalStateException(<span style="color:#0ff;font-weight:bold">&#34;Cannot re-open output stream!&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        open = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ServletOutputStream() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isReady() {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setWriteListener(WriteListener listener) {
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å®é™…å†™å…¥ByteArrayOutputStream:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> write(<span style="color:#fff;font-weight:bold">int</span> b) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>                output.<span style="color:#007f7f">write</span>(b);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è¿”å›å†™å…¥çš„byte[]:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">byte</span>[] getContent() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> output.<span style="color:#007f7f">toByteArray</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä¿®æ”¹å“åº”ï¼Œå°±å¯ä»¥é€šè¿‡<code>HttpServletResponseWrapper</code>æ„é€ ä¸€ä¸ªâ€œä¼ªé€ â€çš„<code>HttpServletResponse</code>ï¼Œè¿™æ ·å°±èƒ½æ‹¦æˆªåˆ°å†™å…¥çš„æ•°æ®ã€‚</p>
<p>ä¿®æ”¹å“åº”æ—¶ï¼Œæœ€åä¸è¦å¿˜è®°æŠŠæ•°æ®å†™å…¥åŸå§‹çš„<code>HttpServletResponse</code>å®ä¾‹ã€‚</p>
<p>è¿™ä¸ª<code>CacheFilter</code>åŒæ ·æ˜¯ä¸€ä¸ªâ€œå¯æ’æ‹”â€ç»„ä»¶ï¼Œå®ƒæ˜¯å¦å¯ç”¨ä¸å½±å“Webåº”ç”¨ç¨‹åºçš„å…¶ä»–ç»„ä»¶ï¼ˆFilterã€Servletï¼‰ã€‚</p>
<h3 id="å°ç»“-7">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-7">#</a></h3>
<p>å€ŸåŠ©<code>HttpServletResponseWrapper</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Filterä¸­å®ç°å¯¹åŸå§‹<code>HttpServletResponse</code>çš„ä¿®æ”¹ã€‚</p>
<h1 id="ä½¿ç”¨listener">ä½¿ç”¨Listener<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨listener">#</a></h1>
<p>é™¤äº†Servletå’ŒFilterå¤–ï¼ŒJavaEEçš„Servletè§„èŒƒè¿˜æä¾›äº†ç¬¬ä¸‰ç§ç»„ä»¶ï¼šListenerã€‚</p>
<p>Listeneré¡¾åæ€ä¹‰å°±æ˜¯ç›‘å¬å™¨ï¼Œæœ‰å¥½å‡ ç§Listenerï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯<code>ServletContextListener</code>ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå®ç°äº†<code>ServletContextListener</code>æ¥å£çš„ç±»å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebListener
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppListener <span style="color:#fff;font-weight:bold">implements</span> ServletContextListener {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åœ¨æ­¤åˆå§‹åŒ–WebApp,ä¾‹å¦‚æ‰“å¼€æ•°æ®åº“è¿æ¥æ± ç­‰:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> contextInitialized(ServletContextEvent sce) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;WebApp initialized.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åœ¨æ­¤æ¸…ç†WebApp,ä¾‹å¦‚å…³é—­æ•°æ®åº“è¿æ¥æ± ç­‰:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> contextDestroyed(ServletContextEvent sce) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;WebApp destroyed.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»»ä½•æ ‡æ³¨ä¸º<code>@WebListener</code>ï¼Œä¸”å®ç°äº†ç‰¹å®šæ¥å£çš„ç±»ä¼šè¢«WebæœåŠ¡å™¨è‡ªåŠ¨åˆå§‹åŒ–ã€‚ä¸Šè¿°<code>AppListener</code>å®ç°äº†<code>ServletContextListener</code>æ¥å£ï¼Œå®ƒä¼šåœ¨æ•´ä¸ªWebåº”ç”¨ç¨‹åºåˆå§‹åŒ–å®Œæˆåï¼Œä»¥åŠWebåº”ç”¨ç¨‹åºå…³é—­åè·å¾—å›è°ƒé€šçŸ¥ã€‚æˆ‘ä»¬å¯ä»¥æŠŠåˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ç­‰å·¥ä½œæ”¾åˆ°<code>contextInitialized()</code>å›è°ƒæ–¹æ³•ä¸­ï¼ŒæŠŠæ¸…ç†èµ„æºçš„å·¥ä½œæ”¾åˆ°<code>contextDestroyed()</code>å›è°ƒæ–¹æ³•ä¸­ï¼Œå› ä¸ºWebæœåŠ¡å™¨ä¿è¯åœ¨<code>contextInitialized()</code>æ‰§è¡Œåï¼Œæ‰ä¼šæ¥å—ç”¨æˆ·çš„HTTPè¯·æ±‚ã€‚</p>
<p>å¾ˆå¤šç¬¬ä¸‰æ–¹Webæ¡†æ¶éƒ½ä¼šé€šè¿‡ä¸€ä¸ª<code>ServletContextListener</code>æ¥å£åˆå§‹åŒ–è‡ªå·±ã€‚</p>
<p>é™¤äº†<code>ServletContextListener</code>å¤–ï¼Œè¿˜æœ‰å‡ ç§Listenerï¼š</p>
<ul>
<li>HttpSessionListenerï¼šç›‘å¬HttpSessionçš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼›</li>
<li>ServletRequestListenerï¼šç›‘å¬ServletRequestè¯·æ±‚çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼›</li>
<li>ServletRequestAttributeListenerï¼šç›‘å¬ServletRequestè¯·æ±‚çš„å±æ€§å˜åŒ–äº‹ä»¶ï¼ˆå³è°ƒç”¨<code>ServletRequest.setAttribute()</code>æ–¹æ³•ï¼‰ï¼›</li>
<li>ServletContextAttributeListenerï¼šç›‘å¬ServletContextçš„å±æ€§å˜åŒ–äº‹ä»¶ï¼ˆå³è°ƒç”¨<code>ServletContext.setAttribute()</code>æ–¹æ³•ï¼‰ï¼›</li>
</ul>
<h2 id="servletcontext">ServletContext<a hidden class="anchor" aria-hidden="true" href="#servletcontext">#</a></h2>
<p>ä¸€ä¸ªWebæœåŠ¡å™¨å¯ä»¥è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªWebAppï¼Œå¯¹äºæ¯ä¸ªWebAppï¼ŒWebæœåŠ¡å™¨éƒ½ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªå…¨å±€å”¯ä¸€çš„<code>ServletContext</code>å®ä¾‹ï¼Œæˆ‘ä»¬åœ¨<code>AppListener</code>é‡Œé¢ç¼–å†™çš„ä¸¤ä¸ªå›è°ƒæ–¹æ³•å®é™…ä¸Šå¯¹åº”çš„å°±æ˜¯<code>ServletContext</code>å®ä¾‹çš„åˆ›å»ºå’Œé”€æ¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> contextInitialized(ServletContextEvent sce) {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;WebApp initialized: ServletContext = &#34;</span> + sce.<span style="color:#007f7f">getServletContext</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ServletRequest</code>ã€<code>HttpSession</code>ç­‰å¾ˆå¤šå¯¹è±¡ä¹Ÿæä¾›<code>getServletContext()</code>æ–¹æ³•è·å–åˆ°åŒä¸€ä¸ª<code>ServletContext</code>å®ä¾‹ã€‚<code>ServletContext</code>å®ä¾‹æœ€å¤§çš„ä½œç”¨å°±æ˜¯è®¾ç½®å’Œå…±äº«å…¨å±€ä¿¡æ¯ã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>ServletContext</code>è¿˜æä¾›äº†åŠ¨æ€æ·»åŠ Servletã€Filterã€Listenerç­‰åŠŸèƒ½ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºåœ¨è¿è¡ŒæœŸé—´åŠ¨æ€æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œè™½ç„¶è¿™ä¸ªåŠŸèƒ½ä¸æ˜¯å¾ˆå¸¸ç”¨ã€‚</p>
<h2 id="å°ç»“-8">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-8">#</a></h2>
<p>é€šè¿‡Listeneræˆ‘ä»¬å¯ä»¥ç›‘å¬Webåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼Œè·å–<code>HttpSession</code>ç­‰åˆ›å»ºå’Œé”€æ¯çš„äº‹ä»¶ï¼›</p>
<p><code>ServletContext</code>æ˜¯ä¸€ä¸ªWebAppè¿è¡ŒæœŸçš„å…¨å±€å”¯ä¸€å®ä¾‹ï¼Œå¯ç”¨äºè®¾ç½®å’Œå…±äº«é…ç½®ä¿¡æ¯ã€‚</p>
<h1 id="éƒ¨ç½²">éƒ¨ç½²<a hidden class="anchor" aria-hidden="true" href="#éƒ¨ç½²">#</a></h1>
<p>å¯¹ä¸€ä¸ªWebåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œé™¤äº†Servletã€Filterè¿™äº›é€»è¾‘ç»„ä»¶ï¼Œè¿˜éœ€è¦JSPè¿™æ ·çš„è§†å›¾æ–‡ä»¶ï¼Œå¤–åŠ ä¸€å †é™æ€èµ„æºæ–‡ä»¶ï¼Œå¦‚CSSã€JSç­‰ã€‚</p>
<p>åˆç†ç»„ç»‡æ–‡ä»¶ç»“æ„éå¸¸é‡è¦ã€‚æˆ‘ä»¬ä»¥ä¸€ä¸ªå…·ä½“çš„Webåº”ç”¨ç¨‹åºä¸ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>webapp
</span></span><span style="display:flex;"><span>â”œâ”€â”€ pom.xml
</span></span><span style="display:flex;"><span>â””â”€â”€ src
</span></span><span style="display:flex;"><span>    â””â”€â”€ main
</span></span><span style="display:flex;"><span>        â”œâ”€â”€ java
</span></span><span style="display:flex;"><span>        â”‚   â””â”€â”€ com
</span></span><span style="display:flex;"><span>        â”‚       â””â”€â”€ itranswarp
</span></span><span style="display:flex;"><span>        â”‚           â””â”€â”€ learnjava
</span></span><span style="display:flex;"><span>        â”‚               â”œâ”€â”€ Main.java
</span></span><span style="display:flex;"><span>        â”‚               â”œâ”€â”€ filter
</span></span><span style="display:flex;"><span>        â”‚               â”‚   â””â”€â”€ EncodingFilter.java
</span></span><span style="display:flex;"><span>        â”‚               â””â”€â”€ servlet
</span></span><span style="display:flex;"><span>        â”‚                   â”œâ”€â”€ FileServlet.java
</span></span><span style="display:flex;"><span>        â”‚                   â””â”€â”€ HelloServlet.java
</span></span><span style="display:flex;"><span>        â”œâ”€â”€ resources
</span></span><span style="display:flex;"><span>        â””â”€â”€ webapp
</span></span><span style="display:flex;"><span>            â”œâ”€â”€ WEB-INF
</span></span><span style="display:flex;"><span>            â”‚   â””â”€â”€ web.xml
</span></span><span style="display:flex;"><span>            â”œâ”€â”€ favicon.ico
</span></span><span style="display:flex;"><span>            â””â”€â”€ static
</span></span><span style="display:flex;"><span>                â””â”€â”€ bootstrap.css
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æŠŠæ‰€æœ‰çš„é™æ€èµ„æºæ–‡ä»¶æ”¾å…¥<code>/static/</code>ç›®å½•ï¼Œåœ¨å¼€å‘é˜¶æ®µï¼Œæœ‰äº›WebæœåŠ¡å™¨ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åŠ ä¸€ä¸ªä¸“é—¨è´Ÿè´£å¤„ç†é™æ€æ–‡ä»¶çš„Servletï¼Œä½†å¦‚æœ<code>IndexServlet</code>æ˜ å°„è·¯å¾„ä¸º<code>/</code>ï¼Œä¼šå±è”½æ‰å¤„ç†é™æ€æ–‡ä»¶çš„Servletæ˜ å°„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±ç¼–å†™ä¸€ä¸ªå¤„ç†é™æ€æ–‡ä»¶çš„<code>FileServlet</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/static/*&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> FileServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        ServletContext ctx = req.<span style="color:#007f7f">getServletContext</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// RequestURIåŒ…å«ContextPath,éœ€è¦å»æ‰:</span>
</span></span><span style="display:flex;"><span>        String urlPath = req.<span style="color:#007f7f">getRequestURI</span>().<span style="color:#007f7f">substring</span>(ctx.<span style="color:#007f7f">getContextPath</span>().<span style="color:#007f7f">length</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–çœŸå®æ–‡ä»¶è·¯å¾„:</span>
</span></span><span style="display:flex;"><span>        String filepath = ctx.<span style="color:#007f7f">getRealPath</span>(urlPath);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (filepath == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ— æ³•è·å–åˆ°è·¯å¾„:</span>
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">sendError</span>(HttpServletResponse.<span style="color:#007f7f">SC_NOT_FOUND</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Path path = Paths.<span style="color:#007f7f">get</span>(filepath);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!path.<span style="color:#007f7f">toFile</span>().<span style="color:#007f7f">isFile</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ–‡ä»¶ä¸å­˜åœ¨:</span>
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">sendError</span>(HttpServletResponse.<span style="color:#007f7f">SC_NOT_FOUND</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ ¹æ®æ–‡ä»¶åçŒœæµ‹Content-Type:</span>
</span></span><span style="display:flex;"><span>        String mime = Files.<span style="color:#007f7f">probeContentType</span>(path);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (mime == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            mime = <span style="color:#0ff;font-weight:bold">&#34;application/octet-stream&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        resp.<span style="color:#007f7f">setContentType</span>(mime);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¯»å–æ–‡ä»¶å¹¶å†™å…¥Response:</span>
</span></span><span style="display:flex;"><span>        OutputStream output = resp.<span style="color:#007f7f">getOutputStream</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> (InputStream input = <span style="color:#fff;font-weight:bold">new</span> BufferedInputStream(<span style="color:#fff;font-weight:bold">new</span> FileInputStream(filepath))) {
</span></span><span style="display:flex;"><span>            input.<span style="color:#007f7f">transferTo</span>(output);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        output.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ä¸€æ¥ï¼Œåœ¨å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–¹ä¾¿åœ°é«˜æ•ˆå¼€å‘ã€‚</p>
<p>ç±»ä¼¼Tomcatè¿™æ ·çš„WebæœåŠ¡å™¨ï¼Œè¿è¡Œçš„Webåº”ç”¨ç¨‹åºé€šå¸¸éƒ½æ˜¯ä¸šåŠ¡ç³»ç»Ÿï¼Œå› æ­¤ï¼Œè¿™ç±»æœåŠ¡å™¨ä¹Ÿè¢«ç§°ä¸ºåº”ç”¨æœåŠ¡å™¨ã€‚åº”ç”¨æœåŠ¡å™¨å¹¶ä¸æ“…é•¿å¤„ç†é™æ€æ–‡ä»¶ï¼Œä¹Ÿä¸é€‚åˆç›´æ¥æš´éœ²ç»™ç”¨æˆ·ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨ç±»ä¼¼Nginxè¿™æ ·çš„æœåŠ¡å™¨å……å½“åå‘ä»£ç†å’Œé™æ€æœåŠ¡å™¨ï¼Œåªæœ‰åŠ¨æ€è¯·æ±‚æ‰ä¼šæ”¾è¡Œç»™åº”ç”¨æœåŠ¡å™¨ï¼Œæ‰€ä»¥ï¼Œéƒ¨ç½²æ¶æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>             â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>             â”‚  /static/*            â”‚
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt; file
</span></span><span style="display:flex;"><span>â”‚Browserâ”œâ”€â”€â”€â”€â”¼â”€â”¤                     â”‚    â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚/          proxy_pass
</span></span><span style="display:flex;"><span>             â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€&gt;â”‚  Web Server â”‚
</span></span><span style="display:flex;"><span>                       Nginx
</span></span><span style="display:flex;"><span>             â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜    â”” â”€ â”€ â”€ â”€ â”€ â”€ â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ç°ä¸Šè¿°åŠŸèƒ½çš„Nginxé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>server {
</span></span><span style="display:flex;"><span>    listen 80;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    server_name www.local.liaoxuefeng.com;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># é™æ€æ–‡ä»¶æ ¹ç›®å½•:</span>
</span></span><span style="display:flex;"><span>    root /path/to/src/main/webapp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    access_log /var/log/nginx/webapp_access_log;
</span></span><span style="display:flex;"><span>    error_log  /var/log/nginx/webapp_error_log;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># å¤„ç†é™æ€æ–‡ä»¶è¯·æ±‚:</span>
</span></span><span style="display:flex;"><span>    location /static {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># å¤„ç†é™æ€æ–‡ä»¶è¯·æ±‚:</span>
</span></span><span style="display:flex;"><span>    location /favicon.ico {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># ä¸å…è®¸è¯·æ±‚/WEB-INF:</span>
</span></span><span style="display:flex;"><span>    location /WEB-INF {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> 404;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># å…¶ä»–è¯·æ±‚è½¬å‘ç»™Tomcat:</span>
</span></span><span style="display:flex;"><span>    location / {
</span></span><span style="display:flex;"><span>        proxy_pass       http://127.0.0.1:8080;
</span></span><span style="display:flex;"><span>        proxy_set_header Host $host;
</span></span><span style="display:flex;"><span>        proxy_set_header X-Real-IP $remote_addr;
</span></span><span style="display:flex;"><span>        proxy_set_header X-Forwarded-Proto $scheme;
</span></span><span style="display:flex;"><span>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨Nginxé…åˆTomcatæœåŠ¡å™¨ï¼Œå¯ä»¥å……åˆ†å‘æŒ¥Nginxä½œä¸ºç½‘å…³çš„ä¼˜åŠ¿ï¼Œæ—¢å¯ä»¥é«˜æ•ˆå¤„ç†é™æ€æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æŠŠhttpsã€é˜²ç«å¢™ã€é™é€Ÿã€åçˆ¬è™«ç­‰åŠŸèƒ½æ”¾åˆ°Nginxä¸­ï¼Œä½¿å¾—æˆ‘ä»¬è‡ªå·±çš„WebAppèƒ½ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚</p>
<h2 id="å°ç»“-9">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-9">#</a></h2>
<p>éƒ¨ç½²Webåº”ç”¨ç¨‹åºæ—¶ï¼Œè¦è®¾è®¡åˆç†çš„ç›®å½•ç»“æ„ï¼ŒåŒæ—¶è€ƒè™‘å¼€å‘æ¨¡å¼éœ€è¦ä¾¿æ·æ€§ï¼Œç”Ÿäº§æ¨¡å¼éœ€è¦é«˜æ€§èƒ½ã€‚</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/java%E5%9F%BA%E7%A1%80/">JavaåŸºç¡€</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>