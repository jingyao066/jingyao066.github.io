<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>es | Wjy&#39;s Blog</title>
<meta name="keywords" content="中间件">
<meta name="description" content="Elasticsearch">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://funny-toffee-4aa7c3.netlify.app/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/es/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://funny-toffee-4aa7c3.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://funny-toffee-4aa7c3.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://funny-toffee-4aa7c3.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://funny-toffee-4aa7c3.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://funny-toffee-4aa7c3.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="es" />
<meta property="og:description" content="Elasticsearch" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://funny-toffee-4aa7c3.netlify.app/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/es/" /><meta property="article:section" content="posts" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="es"/>
<meta name="twitter:description" content="Elasticsearch"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "es",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/es/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "es",
  "name": "es",
  "description": "Elasticsearch\n",
  "keywords": [
    "中间件"
  ],
  "articleBody": "Elasticsearch\n参考 参考\n安装 安装 中文分词器IK 建议下载es前，先下载安装中文分词插件IK。 github下载地址 下载最上面的zip包。 注意版本：需要和es的版本对应。比如IK版本是v7.15.2，那么es也要下载对应版本的。 否则启动会报错。 下载并解压，然后将解压的包直接放到es的plugins目录下，然后启动es。\n安装 es 官网：https://www.elastic.co/cn/ es需要jdk1.8以上环境。\n官网下载es：https://www.elastic.co/cn/downloads/elasticsearch 下载完解压到理想位置。 进入bin目录下，双击执行elasticsearch.bat 访问http://localhost:9200/ Elastic 返回一个 JSON 对象，包含当前节点、集群、版本等信息。\n默认情况下，Elastic 只允许本机访问，如果需要远程访问，可以修改 Elastic 安装目录的config/elasticsearch.yml文件，去掉network.host的注释，将它的值改成0.0.0.0，然后重新启动 Elastic。 network.host: 0.0.0.0\n上面代码中，写成0.0.0.0让任何人都可以访问。生产环境不要这样设置，要写成具体的 IP。\n安装 elasticsearch-head（已不再维护） elasticsearch-head 本机需要安装nodejs。 下载：https://github.com/mobz/elasticsearch-head 启动：\n1 2 3 4 git clone git://github.com/mobz/elasticsearch-head.git cd elasticsearch-head npm install npm run start 访问：http://localhost:9100/ 存在跨域问题（只有当两个页面同源，才能交互） 同源（端口，主机，协议三者都相同） https://blog.csdn.net/qq_38128179/article/details/84956552\n开启跨域（在elasticsearch解压目录config下elasticsearch.yml中添加）\n1 2 3 4 # 开启跨域 http.cors.enabled: true # 所有人访问 http.cors.allow-origin: \"*\" 重启elasticsearch。 访问：http://localhost:9100/\n连接es： 在浏览器左上角输入： http://IP地址:9200/ 注意：一定要加http://。\n安装 kibana Kibana是一个针对ElasticSearch的开源分析及可视化平台，用来搜索、查看交互存储在Elasticsearch索引中的数据。使用Kibana，可以通过各种图表进行高级数据分析及展示。Kibana让海量数据更容易理解。它操作简单，基于浏览器的用户界面可以快速创建仪表板( dashboard )实时显示Elasticsearch查询动态。设置Kibana非常简单。无需编码或者额外的基础架构，几分钟内就可以完成Kibana安装并启动Elasticsearch索引监测。\n注意：下载的版本需要与ElasticSearch版本对应。 官网下载：https://www.elastic.co/cn/downloads/kibana 历史版本下载：https://www.elastic.co/cn/downloads/past-releases#kibana\n解压，修改配置文件kibana/config/kibana.yml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 端口 server.port: 5601 # 允许远程访问的地址配置，默认只允许本机访问，需要把Kibana服务给远程主机访问，就改为远程的那台主机的ip地址， # 那如果我们希望所有的远程主机都能访问，那就填写0.0.0.0 server.host: \"localhost\" # 连接Elasticsearch服务配置，根据自己情况修改。 elasticsearch.hosts: [\"http://localhost:9200\"] # Elasticsearch的用户名和密码 elasticsearch.username: \"kibana_system\" elasticsearch.password: \"pass\" # 显示中文 i18n.locale: \"zh-CN\" 运行：进入bin目录，运行kibana.bat 访问：localhost:5601 控制台：http://localhost:5601/app/dev_tools#/console\nes基本概念 ES中有几个基本概念：索引(index)、类型(type)、文档(document)、映射(mapping)等。我们将这几个概念与传统的关系型数据库中的库、表、行、列等概念进行对比，如下表：\nRDBS ES 数据库（database） 索引（index） 表（table） 类型（type）（ES7.0之后被废弃，es8.0中完全删除） 表结构（schema） 映射（mapping） 行（row） 文档（document） 列（column） 字段（field） 索引 反向索引 SQL 查询DSL SELECT * FROM table GET http://….. UPDATE table SET PUT http://…… DELETE DELETE http://…… Index（索引） ES管理的顶层单位就叫做 Index（索引），对应关系型数据库中的库。\n下面的命令可以查看当前节点的所有 Index。 curl -X GET http://localhost:9200/_cat/indices?v\nES在后台把每个索引划分成多个分片，每个分片可以在集群中的不同服务器间迁移。\nType（类型） ES中，一个索引可以存储多个用于不同用途的对象，可以通过类型来区分索引中的不同对象，对应关系型数据库中表的概念。但是在ES6.0开始，类型的概念被废弃，ES7中将它完全删除。删除type的原因： 我们一直认为ES中的“index”类似于关系型数据库的“database”，而“type”相当于一个数据表。ES的开发者们认为这是一个糟糕的认识。例如：关系型数据库中两个数据表示是独立的，即使他们里面有相同名称的列也不影响使用，但ES中不是这样的。\n我们都知道elasticsearch是基于Lucene开发的搜索引擎，而ES中不同type下名称相同的filed最终在Lucene中的处理方式是一样的。举个例子，两个不同type下的两个user_name，在ES同一个索引下其实被认为是同一个filed，你必须在两个不同的type中定义相同的filed映射。否则，不同type中的相同字段名称就会在处理中出现冲突的情况，导致Lucene处理效率下降。\n去掉type能够使数据存储在独立的index中，这样即使有相同的字段名称也不会出现冲突，就像ElasticSearch出现的第一句话一样“你知道的，为了搜索····”，去掉type就是为了提高ES处理数据的效率。\n除此之外，在同一个索引的不同type下存储字段数不一样的实体会导致存储中出现稀疏数据，影响Lucene压缩文档的能力，导致ES查询效率的降低。\n下面的命令可以列出每个 Index 所包含的 Type。 curl localhost:9200/_mapping?pretty=true\nDocument（文档） Document是ES存储的最小单位，可以理解为关系型数据库中的一条记录，每个文档由多个字段（field）组成。区别于关系型数据库的是，ES是一个非结构化的数据库，每个文档可以有不同的字段，并且有一个唯一标识 unique id。\n文档（Document）是不可变的：它们不能被修改，只能被替换。因此对于 Document 的所有修改操作，在其内部都要经历检索-修改-重建索引的处理过程。\n每个文档有一些默认的属性，称为文档的元数据，用于标注文档的相关信息。\n1 2 3 4 5 6 _id：文档唯一id _index：文档所属的索引名 _type：文档所属的类型名 _source：文档的原始Json数据 _version：文档版本信息 _score：文档相关度打分 _score（相关度）是一个很重要的概念，表示 ES 在全文属性上搜索并返回相关性最强的结果，这是完全区别于传统关系型数据库的一个概念，关系数据库中的一条记录要么匹配要么不匹配。\n倒排索引 https://zhuanlan.zhihu.com/p/55296265\nID 文章内容 1 今天天气不错 2 适合学习ES 正常来说，我们是通过id去搜索文章内容的。id-\u003e内容 但是在搜索引擎上，我们肯定不会去搜id，而是搜索关键字。比如搜索学习ES，肯定不能通过id去搜索，只能全文扫描文章内容字段。当数据量很大的时候，效率是没办法接受的！ 倒排索引，简单说就是以内容的关键词建立索引，映射关系为内容的关键词-\u003eID。 这样的话，我们只需要在关键词中进行检索，效率肯定很快。\n关键词 文档id=1 文档id=2 今天 √ 天气不错 √ 学习ES √ 分词 分词，就是把一段话分成一些关键字，便于检索。 比如：今天天气不错 分词后变成：今天、天气、不错、今天天气、天气不错，等组合。\nes默认的分词器会把每个汉字都分成一个词，如：我吃西红柿，会被分成：我、吃、西、红、柿。 这不符合要求，我们需要支持中文的分词器，就是IK分词器。\nIK分词器官网：https://github.com/medcl/elasticsearch-analysis-ik\nIK提供了两个分词算法: ik_smart 和 ik_max_word。 其中ik_smart为最少切分，ik_max_word 为最细粒度划分。\nik_max_word 最细粒度划分，穷尽各种可能的组合，适合term query。如：今天天气不错，会被拆分成如下结果：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 # 获取分词结果 GET /_analyze { \"text\":\"今天天气不错\", \"analyzer\": \"ik_max_word\" } { \"tokens\" : [ { \"token\" : \"今天天气\", \"start_offset\" : 0, \"end_offset\" : 4, \"type\" : \"CN_WORD\", \"position\" : 0 }, { \"token\" : \"今天\", \"start_offset\" : 0, \"end_offset\" : 2, \"type\" : \"CN_WORD\", \"position\" : 1 }, { \"token\" : \"天天\", \"start_offset\" : 1, \"end_offset\" : 3, \"type\" : \"CN_WORD\", \"position\" : 2 }, { \"token\" : \"天气\", \"start_offset\" : 2, \"end_offset\" : 4, \"type\" : \"CN_WORD\", \"position\" : 3 }, { \"token\" : \"不错\", \"start_offset\" : 4, \"end_offset\" : 6, \"type\" : \"CN_WORD\", \"position\" : 4 } ] } ik_smart 最少切分。还是上面的例子，分词结果如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # 获取分词结果 GET /_analyze { \"text\":\"今天天气不错\", \"analyzer\": \"ik_smart\" } { \"tokens\" : [ { \"token\" : \"今天天气\", \"start_offset\" : 0, \"end_offset\" : 4, \"type\" : \"CN_WORD\", \"position\" : 0 }, { \"token\" : \"不错\", \"start_offset\" : 4, \"end_offset\" : 6, \"type\" : \"CN_WORD\", \"position\" : 1 } ] } 建议：一般情况下，为了提高搜索的效果，需要这两种分词器配合使用。既建索引时用 ik_max_word 尽可能多的分词，而搜索时用 ik_smart 尽可能提高匹配准度，让用户的搜索尽可能的准确。比如一个常见的场景，就是搜索\"进口红酒\"的时候，尽可能的不要出现口红相关商品或者让口红不要排在前面。\nES集群概念 Elastic 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elastic 实例。单个 Elastic 实例称为一个节点（node）。一组节点构成一个集群（cluster）。\n节点（node） 一个es实例就是一个节点，一台机器可以有多个节点，正常使用下每个实例都应该会部署在不同的机器上。\n集群（cluster） 一组节点（node）构成一个集群（cluster）。\n分片（shard） 如果索引（Index）存储的数据太多（就是文档太多），可以将索引进行分片。 比如，一个包含10亿个文档的索引占据1TB的磁盘空间，而索引所在的节点没有足够的磁盘空间来存储这么多的数据，或者本节点不能处理搜索请求，响应会太慢。\n为了解决这个问题，ES提供了将索引划分成多片的能力，这些片叫做分片。当你创建一个索引的时候，你可以指定你想要的分片的数量。每个分片本身也是一个功能完善并且独立的“索引”，这个“索引” 可以被放置到集群中的任何节点上。\n分片的特点：\nES的一个索引可以包含多个分片（shard） 每一个分片（shard）都是一个最小的工作单元，承载部分数据； 每个shard都是一个lucene实例，有完整的简历索引和处理请求的能力； 增减节点时，shard会自动在nodes中负载均衡； 一个索引中含有shard的数量，默认值为5，在索引创建后这个值是不能被更改的。 可以水平分割和扩展内容容量 允许你在分片（位于多个节点上）之上进行分布式的、并行的操作，进而提高性能/吞吐量 每一个shard关联的副本分片（replica shard）的数量，默认值为1，这个设置在任何时候都可以修改。 至于一个分片怎样分布，它的文档怎样聚合回搜索请求，是完全由Elasticsearch管理的，对于作为用户的你来说，这些都是透明的。\n复制分片（replica shard） 在一个网络/云的环境里，失败随时都可能发生。在某个分片/节点因为某些原因处于离线状态或者消失的情况下，故障转移机制是非常有用且强烈推荐的。为此， Elasticsearch允许你创建分片的一份或多份拷贝，这些拷贝叫做复制分片，或者直接叫复制。复制分片的主要作用是：\n在分片/节点失败的情况下，复制提供了高可用性。复制分片不与原/主要分片置于同一节点上是非常重要的。 因为搜索可以在所有的复制上并行运行，复制可以扩展你的搜索量/吞吐量 总之，每个索引可以被分成多个分片。一个索引也可以被复制0次（即没有复制） 或多次。一旦复制了，每个索引就有了主分片（作为复制源的分片）和复制分片（主分片的拷贝）。 分片和复制的数量可以在索引创建的时候指定。在索引创建之后，你可以在任何时候动态地改变复制的数量，但是你不能再改变分片的数量。 默认情况下，ES中的每个索引都由5个主分片构成，每一个主分片会有一个副本（复制分片）。\nes数据类型 参考官网：https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html\n每个字段都有一个字段数据类型，或字段类型。这种类型表明该字段所包含的数据种类，如字符串或布尔值，以及它的预期用途。例如，你可以将字符串索引到文本和关键字字段。然而，文本字段的值会被分析为全文搜索，而关键词字符串则被保留为过滤和排序的原样。\n字段类型是按族来分组的。同一家族的类型具有完全相同的搜索行为，但可能具有不同的空间使用或性能特征。\n目前，有两个类型家族，keyword和text。其他类型族只有一个字段类型。例如，布尔类型族由一个字段类型组成：boolean\nkeyword keyword 类型的字段只能通过精确值搜索到，适合需要过滤、排序、聚合的字段。 tip：不要用 keyword 字段进行全文搜索，应该使用 text 类型代替。\ntext text 类型的字段用于全文检索。text字段的内容会被分词。 索引时将字符串转换为单个关键词的列表（倒排索引），搜索时es会根据倒排索引搜索包含搜索关键字的内容。 text字段不能被排序，很少用于聚合。 使用场景：不具备唯一性的字符串，如商品介绍，电子邮件正文。\n可选参数：\nanalyzer 应该用于文本字段的分析器，无论是在索引时还是在搜索时。默认的分析器是standard analyzer 注：搜索的分析器可以单独指定，属性是search_analyzer\nfields 允许text字段以多种方式被索引，用于不同的目的，如一个字段用于搜索，一个多字段用于排序和聚合，或同一字符串值被不同的分析器分析。\nsearch_analyzer 在搜索时使用的分析器\n看下面的例子，不指定分词器，那么使用默认的分词器 standard\n1 2 3 4 GET /_analyze { \"text\":\"我爱你中国\" } 使用默认的分词器standard，分词结果就是将每个汉字分成一个词。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 { \"tokens\" : [ { \"token\" : \"我\", \"start_offset\" : 0, \"end_offset\" : 1, \"type\" : \"\", \"position\" : 0 }, { \"token\" : \"爱\", \"start_offset\" : 1, \"end_offset\" : 2, \"type\" : \"\", \"position\" : 1 }, { \"token\" : \"你\", \"start_offset\" : 2, \"end_offset\" : 3, \"type\" : \"\", \"position\" : 2 }, { \"token\" : \"中\", \"start_offset\" : 3, \"end_offset\" : 4, \"type\" : \"\", \"position\" : 3 }, { \"token\" : \"国\", \"start_offset\" : 4, \"end_offset\" : 5, \"type\" : \"\", \"position\" : 4 } ] } 这意味着，如果你使用text类型去储存你本不想分词的字段，你在查询的时候，查询结果将违背你的预期。示例如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 创建索引 PUT test_index { \"mappings\": { \"properties\": { \"field1\": { \"type\": \"text\" } } } } # 存入数据 POST /test_index/_doc/1 { \"field1\":\"我爱你中国\" } 查所有数据，确认可以查到数据。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 GET test_index/_search { \"took\" : 62, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 1, \"relation\" : \"eq\" }, \"max_score\" : 1.0, \"hits\" : [ { \"_index\" : \"test_index\", \"_type\" : \"_doc\", \"_id\" : \"1\", \"_score\" : 1.0, \"_source\" : { \"field1\" : \"我爱你中国\" } } ] } } 条件搜索，等价于mysql的 where field1 = \"中国我爱你\"。发现居然查询不到数据\n1 2 3 4 5 6 7 8 9 10 GET test_index/_search { \"query\": { \"term\": { \"field1\": { \"value\": \"我爱你中国\" } } } } 再根据刚才的ES分词效果，我们检索其中一个字，居然神奇的检索到了。\n1 2 3 4 5 6 7 8 9 10 GET test_index/_search { \"query\": { \"term\": { \"field1\": { \"value\": \"我\" } } } } 使用term查询（等价于mysql的=）时查不到数据，就是因为text类型被分词了，因为使用的是默认的分词器standard ，所以我爱你中国这句话在es中被分成了5个单独的汉字，所以搜不到。 如果使用IK分词器呢？删除刚才的索引 DELETE test_index\n重新创建索引，并指定analyzer为ik_max_word\n1 2 3 4 5 6 7 8 9 10 11 PUT test_index { \"mappings\": { \"properties\": { \"field1\": { \"type\": \"text\", \"analyzer\": \"ik_max_word\" } } } } 存入数据\n1 2 3 4 POST /test_index/_doc/1 { \"field1\":\"我爱你中国\" } 再次检索\n1 2 3 4 5 6 7 8 9 10 GET test_index/_search { \"query\": { \"term\": { \"field1\": { \"value\": \"我爱你中国\" } } } } 还是无数据，查看原因：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 GET /_analyze { \"text\":\"我爱你中国\", \"analyzer\": \"ik_max_word\" } { \"tokens\" : [ { \"token\" : \"我爱你\", \"start_offset\" : 0, \"end_offset\" : 3, \"type\" : \"CN_WORD\", \"position\" : 0 }, { \"token\" : \"爱你\", \"start_offset\" : 1, \"end_offset\" : 3, \"type\" : \"CN_WORD\", \"position\" : 1 }, { \"token\" : \"中国\", \"start_offset\" : 3, \"end_offset\" : 5, \"type\" : \"CN_WORD\", \"position\" : 2 } ] } 原来分词后，没有我爱你中国这个完整的词。这里不再分析了，详见IK分词器。\nnumeric 数字类型，这类数据类型都是以确切值索引的，可以使用term查询，精确匹配。\nlong：带符号的64位整数，最小值-2^63，最大值2^63 -1 integer：带符号的32位整数，最小值-2^31，最大值2^31 -1 short：带符号的16位整数，最小值-32768，最大值32767 byte：带符号的8位整数，最小值-128，最小值127 double：双精度64位IEEE 754 浮点数 float：单精度32位IEEE 754 浮点数 half_float：半精度16位IEEE 754 浮点数 scaled_float：带有缩放因子的缩放类型浮点数\n注意： double、float、half_float这3种浮点型数据类型，认为-0.0和0.0是不同的值。这意味着在-0.0上进行查询(match or term)匹配不到0.0，反之亦然；范围查询也是如此：如果上限为-0.0则0.0将不匹配，如果下限为0.0则-0.0将不匹配。\n就整数类型（byte，short，integer和long）而言，要选择满足实际需求的最小类型，这有助于索引和搜索。但请注意：ES存储数据是根据存储的实际值进行优化的，因此选择一种类型而不是另一种类型，将不会影响存储要求。\nscaled_float类型需要格外注意：必须指定缩放因子scaling_factor。ES索引时，原始值会乘以该缩放因子并四舍五入得到新值，ES内部储存的是这个新值，但返回结果仍是原始值。例如：scale_factor为10的scaled_float字段将在内部存储2.34为23，查询时，ES都会将查询参数*10再四舍五入得到的值与23匹配，若能匹配到返回结果为2.34。\nrange 参考官网：https://www.elastic.co/guide/en/elasticsearch/reference/master/range.html 范围数据类型。具有大小关系的一个值区间，所以会用到gt、gte、lt、lte..等逻辑表示符。 ES支持下面6种范围数据类型： integer_range，带符号的32位整数区间，最小值-2^31，最大值2^31 -1 long_range，带符号的64位整数区间，最小值-2^63，最大值2^63 -1 float_range，单精度32位IEEE 754浮点数区间 double_range，双精度64位IEEE 754浮点数区间 date_range，日期值范围，支持各种日期格式。无论使用何种格式，日期值都被解析为一个无符号的64位整数，代表UTC中Unix纪元以来的毫秒。不支持包含now date数学表达式的值。 ip_range，支持IPv4或IPv6（或混合）地址ip值范围\narray 数组类型。默认情况下，任何字段都可以包含零个或多个值，当包含多个值时，它就表示array datatype了。注意：\n数组中的所有值必须具有相同的数据类型（要么同为字符串，要么同为整型，不能数组中一些值为字符串，另一些值为整型）。 array类型，无需提前设置，es天生支持。 使用_mapping查看索引的映射类型时，array datatype不会被写出来，还是以数组的元素的基本类型来表示。 object 对象类型，JSON文档在本质上是分层的：文档可能包含内部对象，而内部对象又可能包含内部对象本身。\n1 2 3 4 5 6 7 8 9 10 11 PUT my-index-000001/_doc/1 { \"region\": \"US\", \"manager\": { \"age\": 30, \"name\": { \"first\": \"John\", \"last\": \"Smith\" } } } 整个外部文档是一个JSON对象，它包含一个名为manager的内部对象，而manager又包含一个名为name的内部对象。 在ES内部，这种文档会被索引成一种简单平坦的键值对列表，如：\n1 2 3 4 5 6 { \"region\": \"US\", \"manager.age\": 30, \"manager.name.first\": \"John\", \"manager.name.last\": \"Smith\" } 查看上述文档的mapping映射：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 PUT my-index-000001 { \"mappings\": { \"properties\": { \"region\": { \"type\": \"keyword\" }, \"manager\": { \"properties\": { \"age\": { \"type\": \"integer\" }, \"name\": { \"properties\": { \"first\": { \"type\": \"text\" }, \"last\": { \"type\": \"text\" } } } } } } } } 会发现，只要字段的数据类型是object datatype，它就会有一个properties映射，该映射罗列出该字段的内部对象字段，然后内部对象再定义其每个字段的数据类型。 无需显示的设置字段类型为object，因为这是默认的。 注意：object不允许彼此独立地索引查询。这句话啥意思呢，看下面的nested类型。\nnested（嵌套的） nested datatype，嵌套数据类型，是object datatype的专用版本，在文档属性是一个对象数组时使用，它允许对象数组彼此独立地编制索引和查询。这里需要说明：\n1 2 3 4 5 6 { \"addr\": { \"id\": 1, \"name\": \"北京\" } } addr属性仅有一个内部对象，此时可以使用object 类型。\n1 2 3 4 5 6 7 8 9 10 11 12 { \"addr\": [ { \"id\": 1, \"name\": \"北京\" }, { \"id\": 2, \"name\": \"河北\" } ] } addr是对象数组，此时要使用nested 类型。因为object类型映射这种对象数组会有问题。 由于Lucene没有内部对象的概念，因此ES将对象层次结构展平为一个简单的字段名称和值列表。 若一个属性包含若干个内部对象，例如下面的文档结构，user属性包含两个内部对象：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 PUT my_index/_doc/1 { \"group\" : \"fans\", \"user\" : [ { \"name\" : \"张三\", \"age\" : 18 }, { \"name\" : \"李四\", \"age\" : 23 } ] } 如果使用object datatype数据类型去映射，ES将在内部转换为看起来更像这样的文档：\n1 2 3 4 5 { \"group\" : \"fans\", \"user.name\" : [ \"张三\", \"李四\" ], \"user.age\" : [ 18, 23 ] } user.name和user.age字段被展平为多值字段，并且张三和18(同理，李四和23)之间的关联将丢失。此文档将错误地匹配张三和李四的查询：(张三 是18不是23，但搜索结果还是会把整个文档匹配到)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 GET my_index/_search { \"query\": { \"bool\": { \"must\": [ { \"match\": { \"user.name\": \"张三\" } }, { \"match\": { \"user.age\": \"18\" } } ] } } } # 返回的结果 \"hits\" : [ { \"_index\" : \"my_index\", \"_type\" : \"_doc\", \"_id\" : \"1\", \"_score\" : 0.5753642, \"_source\" : { \"user\" : [ { \"name\" : \"张三\", \"age\" : \"18\" }, { \"name\" : \"李四\", \"age\" : \"23\" } ] } } ] 对于对象数组的映射，ES推出了nested datatype来取代object datatype。在内部，nested datatype将数组中的每个对象索引为单独的隐藏文档，这意味着可以使用嵌套查询独立于其它对象查询每个嵌套对象。同样以上面的的数据为例子，只不过在添加数据前，先将user的数据类型设置为nested datatype：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 # 删除刚才的索引 DELETE my_index # 新建索引，user字段被映射为nested类型，而不是object类型。 PUT my-index-000001 { \"mappings\": { \"properties\": { \"user\": { \"type\": \"nested\" } } } } # 存入数据 PUT my_index/_doc/1 { \"group\" : \"fans\", \"user\" : [ { \"name\" : \"张三\", \"age\" : 18 }, { \"name\" : \"李四\", \"age\" : 23 } ] } # 这个查询不匹配，因为张三和23不在同一个嵌套对象中 GET my_index/_search { \"query\": { \"nested\": { \"path\": \"user\", \"query\": { \"bool\": { \"must\": [ { \"match\": { \"user.name\": \"张三\" } }, { \"match\": { \"user.age\": \"23\" } } ] } } } } } # 这个查询匹配，因为张三和18在同一个嵌套对象中。 # inner_hits 可以突出显示嵌套对象的具体匹配内容 GET my_index/_search { \"query\": { \"nested\": { \"path\": \"user\", \"query\": { \"bool\": { \"must\": [ { \"match\": { \"user.name\": \"张三\" }}, { \"match\": { \"user.age\": \"18\" }} ] } }, \"inner_hits\": { \"highlight\": { \"fields\": { \"user.first\": {} } } } } } } binary 编码为Base64字符串的二进制值。 二进制类型接受一个作为Base64编码字符串的二进制值。该字段默认不存储，也不可搜索。\nboolean true或false。 boolean字段接受JSON的true和false，但也可以接受被解释为真或假的字符串。 false：false, \"false\", \"\" (empty string) true：true, \"true\"\ndate JSON没有日期数据类型，所以Elasticsearch中的日期可以是\n包含格式化日期的字符串，例如 “2015-01-01 “或 “2015/01/01 12:10:30”。 秒级（毫秒级）时间戳 如果没有自定义日期格式，那么按照默认的格式： strict_date_optional_time||epoch_millis\n示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 PUT my-index-000001 { \"mappings\": { \"properties\": { \"date\": { \"type\": \"date\" } } } } PUT my-index-000001/_doc/1 { \"date\": \"2015-01-01\" } PUT my-index-000001/_doc/2 { \"date\": \"2015-01-01T12:10:30Z\" } PUT my-index-000001/_doc/3 { \"date\": 1420070400001 } # 在使用date类型字段进行排序时，返回的排序值都是以毫秒为单位 GET my-index-000001/_search { \"sort\": { \"date\": \"asc\"} } 可选参数： format：自定义的日期格式，默认：strict_date_optional_time || epoch_millis\nDSL语法 参考官网：https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html 其他参考\nDSL，全称是 Domain Specific Language，域特定语言。 ES 提供了一个基于JSON的完整查询DSL来定义查询。 ES将Query DSL视为查询AST（抽象语法树），由两种类型子句组成：\n叶查询子句，查找特定字段中的特定值，例如匹配，术语或范围查询； 复合查询子句，包装其他叶子或复合查询，用于以逻辑方式组合多个查询 查询和过滤上下文 相关性评分 默认情况下，Elasticsearch 按照相关性分数对匹配的搜索结果进行排序，相关性分数衡量每个文档与查询的匹配程度。 相关性分数是一个正的浮点数字，在 search API的_score元数据字段中返回。_score越高，文档就越相关。虽然每种查询类型可以以不同的方式计算相关性分数，但分数的计算也取决于查询子句是在查询还是在过滤器上下文中运行。\nQuery context 查询上下文 在查询上下文中，查询子句回答的问题是 这个文档与这个查询子句的匹配程度如何？。除了决定文档是否匹配，查询子句还在_score元数据字段中计算相关性分数。 每当查询子句被传递给一个查询参数时，查询上下文就会生效，例如 search API中的查询参数。\nFilter context 过滤上下文 在一个过滤器的上下文中，一个查询子句回答了 这个文档是否与这个查询子句相匹配 的问题？答案是简单的 “是 “或 “否”，不计算分数。过滤器上下文主要用于过滤结构化数据，例如 这个时间戳是否属于2015至2016年的范围？ 状态字段是否设置为 “发布”？\n经常使用的过滤器会被 Elasticsearch 自动缓存，以加快性能。\n只要查询子句被传递给一个 filter 参数，如bool查询中的 filter 或must_not参数、constant_score查询中的 filter 参数或过滤器聚合，过滤器上下文就生效。\n示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 GET /_search { \"query\": { \"bool\": { \"must\": [ { \"match\": { \"title\": \"Search\" }}, { \"match\": { \"content\": \"Elasticsearch\" }} ], \"filter\": [ { \"term\": { \"status\": \"published\" }}, { \"range\": { \"publish_date\": { \"gte\": \"2015-01-01\" }}} ] } } } query字段表示query上下文。 bool和两个match子句是在查询上下文中使用的，这意味着它们被用来对每个文档的匹配程度进行评分。 filter 参数表示过滤器上下文。它的 term 和 range 子句是用于过滤上下文的。它们将过滤掉不匹配的文档，但它们不会影响匹配文档的得分。 match_all 最简单的查询，它匹配所有的文档，给它们的分数都是1.0\n1 2 3 4 5 6 GET my_index/_search { \"query\": { \"match_all\": {} } } 可以通过 boost 参数修改分数：\n1 2 3 4 5 6 GET /_search { \"query\": { \"match_all\": { \"boost\" : 1.2 } } } 复合查询 bool query 用于组合多个叶子或复合查询子句的默认查询，如 must、should、must_not、或 filter 子句。 Bool查询对应Lucene中的BooleanQuery，它由一个或者多个子句组成，每个子句都有特定的类型。\nmust 文档必须满足must子句的条件，并且参与计算分值。 where id = 1 and name = 'wjy' must_not 文档必须不满足must_not定义的条件。 where id != 1 and name != 'wjy' filter 文档必须满足filter子句的条件，和must的唯一区别是不计算分值。 where id = 1 and name = 'wjy' should 文档可能满足should子句的条件，和must的区别是字句由or连接 where id = 1 or name = 'wjy' 注意：\nBool query 只支持以上4种查询的子句。 以上4种查询的子句，只支持 Full text queries、Term-level queries 和 Bool query。 只有must 和 should 子句会计算相关性评分；filter 和 must_not 子句都是在过滤器上下文中执行，计分被忽略，并且子句被考虑用于缓存。 在一个Bool查询中，如果没有must或者filter，有一个或者多个should子句，那么只要满足一个就可以返回。minimum_should_match参数定义了至少满足几个子句。 bool查询采用 more_matches_is_better 的机制，因此满足must和should子句的文档将会合并起来计算分值。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 POST _search { \"query\": { \"bool\" : { \"must\" : { \"term\" : { \"user.id\" : \"kimchy\" } }, \"filter\": { \"term\" : { \"tags\" : \"production\" } }, \"must_not\" : { \"range\" : { \"age\" : { \"gte\" : 10, \"lte\" : 20 } } }, \"should\" : [ { \"term\" : { \"tags\" : \"env1\" } }, { \"term\" : { \"tags\" : \"deployed\" } } ], \"minimum_should_match\" : 1, \"boost\" : 1.0 } } } bool query 示例 创建index\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 PUT blogs_index { \"settings\": { \"index\": { \"number_of_shards\": 1, \"number_of_replicas\": 1 } }, \"mappings\": { \"dynamic\": false, \"properties\": { \"id\": { \"type\": \"integer\" }, \"author\": { \"type\": \"keyword\" }, \"title\": { \"type\": \"text\", \"analyzer\": \"ik_smart\" }, \"content\": { \"type\": \"text\", \"analyzer\": \"ik_max_word\", \"search_analyzer\": \"ik_smart\" }, \"tag\": { \"type\": \"keyword\" }, \"influence\": { \"type\": \"integer_range\" }, \"createAt\": { \"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm\" } } } } 导入数据\n1 2 3 4 5 6 7 8 9 10 11 12 13 POST _bulk {\"index\":{\"_index\":\"blogs_index\",\"_id\":\"1\"}} {\"id\":1,\"author\":\"方才兄\",\"title\":\"关注我，系统学习es\",\"content\":\"这是关于es的文章\",\"tag\":[1,2,3],\"influence\":{\"gte\":10,\"lte\":12},\"createAt\":\"2020-05-24 10:56\"} {\"index\":{\"_index\":\"blogs_index\",\"_id\":\"2\"}} {\"id\":2,\"author\":\"方才兄\",\"title\":\"系统学习编程\",\"content\":\"这是关于编程的文章\",\"tag\":[2,3,4],\"influence\":{\"gte\":12,\"lte\":15},\"createAt\":\"2020-05-23 10:56\"} {\"index\":{\"_index\":\"blogs_index\",\"_id\":\"3\"}} {\"id\":3,\"author\":\"方才兄\",\"title\":\"关注我，必看文章\",\"content\":\"这是关于关于es和编程的必看文章\",\"tag\":[2,3,4],\"influence\":{\"gte\":12,\"lte\":15},\"createAt\":\"2020-05-22 10:56\"} {\"index\":{\"_index\":\"blogs_index\",\"_id\":\"4\"}} {\"id\":4,\"author\":\"方才\",\"title\":\"关注我，系统学习es\",\"content\":\"这是关于es的文章\",\"tag\":[1,2,3],\"influence\":{\"gte\":10,\"lte\":15},\"createAt\":\"2020-05-24 10:56\"} {\"index\":{\"_index\":\"blogs_index\",\"_id\":\"5\"}} {\"id\":5,\"author\":\"方才\",\"title\":\"系统学习编程\",\"content\":\"这是关于编程的文章\",\"tag\":[2,3,4],\"influence\":{\"gte\":12,\"lte\":18},\"createAt\":\"2020-05-25 10:56\"} {\"index\":{\"_index\":\"blogs_index\",\"_id\":\"6\"}} {\"id\":6,\"author\":\"方才\",\"title\":\"关注我，必看文章\",\"content\":\"这是关于关于es和编程的必看文章\",\"tag\":[2,3,4],\"influence\":{\"gte\":15,\"lte\":18},\"createAt\":\"2020-05-20 10:56\"} filter的使用 filter 子句内可包含多个 Full text queries 和 Term-level queries 的子句。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 GET /blogs_index/_search { \"query\": { \"bool\": { \"filter\": [ { \"term\": { \"author\": \"方才兄\" } }, { \"term\": { \"tag\": \"2\" } }, { \"match\": { \"title\": \"es\" } } ] } } } 该DSL语句可以检索到文档1，检索逻辑是： author = '方才兄' and tag = 2 and title的PostingLIst包含'es'\nfilter 子句类可包含 bool query，实现更复杂的逻辑。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 GET /blogs_index/_search { \"query\": { \"bool\": { \"filter\": { \"bool\": { \"must\": [ { \"term\": { \"author\": \"方才兄\" } }, { \"term\": { \"tag\": \"2\" } } ], \"should\": [ { \"match\": { \"title\": \"es\" } }, { \"match\": { \"content\": \"es\" } } ] } } } } } 该DSL语句可以检索到文档1和文档3，检索逻辑是： author = “方才兄” and tag 包含 2 and （ title的PostingLIst包含“es”or content的PostingLIst包含“es”）\n注意：使用filter查询，是不会计算文档的相关性评分的，可以看一下结果。_score：0\nmust 的使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 GET /blogs_index/_search { \"query\": { \"bool\": { \"must\": [ { \"term\": { \"author\": \"方才兄\" } }, { \"term\": { \"tag\": \"2\" } }, { \"match\": { \"title\": \"es\" } } ] } } } 可以检索到文档1，检索逻辑和 filter 完全一致，唯一的区别就是must会计算相关性评分。\nmust_not 的使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 GET /blogs_index/_search { \"query\": { \"bool\": { \"must_not\": [ { \"term\": { \"author\": \"方才兄\" } }, { \"match\": { \"title\": \"es\" } } ] } } } 该DSL可检索到文档5和文档6，检索逻辑为： author != 方才兄 and title的postingList 不包含“es”\nshould 的使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 GET /blogs_index/_search { \"query\": { \"bool\": { \"should\": [ { \"term\": { \"author\": \"方才兄\" } }, { \"match\": { \"title\": \"es\" } } ] } } } 该DSL会检索到文档1、2、3、4，检索逻辑是： author = 方才兄 or title的PostingList包含 es\nshould 的注意事项 should 仅影响得分的情况。 如果 bool查询在Query context中并且 bool查询具有must或 filter子句，那么bool的 should查询即使没有匹配到，文档也将与查询匹配。在这种情况下，should的子句仅用于影响得分。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 GET /blogs_index/_search { \"query\": { \"bool\": { \"must\": { \"bool\": { \"must\": [ { \"term\": { \"author\": \"方才兄\" } }, { \"term\": { \"tag\": \"2\" } } ], \"should\": [ { \"match\": { \"title\": \"es\" } }, { \"match\": { \"content\": \"es\" } } ] } } } } } 该DSL语句会检索到文档1、2、3。正常理解should语句至少满足一个条件而言，检索到文档1和文档3是没问题，但是文档2，也被检索出来了，那就证明此时的should子句仅用于影响得分。\nshould 至少匹配一个的情况。 如果bool 查询是 Filter context 或 既没有must也没filter，则文档至少与一个should的查询相匹配。 第一个例子：bool 查询是 Filter context。直接将上述的DSL的第一个must替换为filter即可：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 GET /blogs_index/_search { \"query\": { \"bool\": { \"filter\": { \"bool\": { \"must\": [ { \"term\": { \"author\": \"方才兄\" } }, { \"term\": { \"tag\": \"2\" } } ], \"should\": [ { \"match\": { \"title\": \"es\" } }, { \"match\": { \"content\": \"es\" } } ] } } } } } 上述DSL就只能检索文档1和3了。说明should 至少匹配了一个。\n第二个例子：既没有must也没filter，should 至少匹配一个的情况。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 GET /blogs_index/_search { \"query\": { \"bool\": { \"should\": [ { \"term\": { \"author\": \"方才兄\" } }, { \"match\": { \"title\": \"es\" } } ] } } } minimum_should_match 参数值说明 如果不管哪种情况，我们都希望should子句应该被匹配，或者应该被匹配多个，那应该怎么做呢？可以通过minimum_should_match 参数控制。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 GET /blogs_index/_search { \"query\": { \"bool\": { \"must\": { \"bool\": { \"must\": [ { \"term\": { \"author\": \"方才兄\" } } ], \"should\": [ { \"match\": { \"title\": \"es\" } }, { \"match\": { \"content\": \"es\" } }, { \"match\": { \"content\": \"编程\" } } ], \"minimum_should_match\":2 } } } } } 该DSL可以检索到文档1和3，检索逻辑为：author = 方才兄 and （title的PostingList 包含“es” 、content的PostingList 包含“es” 、content的PostingList 包含“编程”）【这3个条件满足2个】\nminimum_should_match 参数可以有以下形式的参数： 标记：N——应该匹配的子句数，S——子句总数，X——用户给定的参数值\n正整数 N = X，比如给定值为3，那么 N=3。\n负整数 N = S - |X|，比如给定值为-2，那么 N= S - 2。\n正百分比 N = min 取整（S*X），比如 S=5，X = 25% ，那么 N= 1\n负百分比 N =S - min 取整（|S*X|），比如 S=5，X = -25% ，那么 N= 5 - 1 = 4。\n组合，比如 3\u003c90% 当 S \u003c= 3，则全部都是必需的；当 S \u003e 3，则仅需要90％，按上面的正百分比计算。\n多种组合，比如：2\u003c-25% 9\u003c3 多个条件规范可以用空格分隔。每个条件规范仅对大于其前一个的数字有效。 在此示例中：如果有1或2个子句，则都需要；如果有3-9个子句，则需要-25％(按负百分数计算)；如果有9个以上的子句，则需要3个。\n注意： 当minimum_should_match的值大于子句数量数，DSL将检索不到值； 当minimum_should_match为0时，should子句失效。\nfull text query 全文检索 即全文检索，先建立索引，再对索引进行搜索的过程就叫全文检索。\nmatch query 匹配查询，接受 text、number、date 或 boolean 四种参数。在匹配之前，对所提供的文本进行分析（即分词）。\n1 2 3 4 5 6 7 8 9 10 GET /zw_paper/_search { \"query\": { \"match\":{ \"title\": { \"query\": \"天气不错\" } } } } title，你想搜索的字段名。如果没有额外参数，可以将搜索内容直接写在title后面，如： \"title\": \"想搜索的内容\"。有额外参数，需要将查询文本放到query中。\n查询内容是：天气不错。被分析器分词之后，假如产生两个词，天气和不错。就根据分词的结果构造一个布尔查询。引擎内部执行的查询逻辑是：只要 title 字段值中包含任意一个关键字：天气、不错，那么返回该文档。伪代码如下：\n1 2 3 if(doc.title.contains(\"天气\") or doc.title.contains(\"不错\")){ return doc; } 这里有两个可选参数： operator：表示单个字段如何匹配查询条件的分词。 minimum_should_match：表示字段匹配的数量。\n默认情况下operator的值是or，在构造查询时设置分词之间的逻辑运算符，如果设置为and，那么引擎内部执行的查询逻辑是：\n1 2 3 if(doc.title.contains(\"天气\") and doc.title.contains(\"不错\")){ return doc; } 对于 minimum_should_match 属性值，默认值是1，即文档的 title 字段包含任意一个关键词，就满足查询条件。如果设置为2，意思是文档的 title 字段需要包含任意两个关键词，才能满足查询条件。\n其他可选参数： query：希望搜索的内容，类型可以是Text, number, boolean 或 date analyzer：query 中内容的分析器。如果不指定，那么使用该字段索引时的analyzer。\n这里给一个完整的示例。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # 创建索引 PUT my_index { \"settings\": { \"index\": { \"number_of_shards\": 1, \"number_of_replicas\": 1 } }, \"mappings\": { \"dynamic\": false, \"properties\": { \"id\": { \"type\": \"integer\" }, \"content\": { \"type\": \"keyword\", \"fields\": { \"ik_max_analyzer\": { \"type\": \"text\", \"analyzer\": \"ik_max_word\", \"search_analyzer\": \"ik_max_word\" }, \"ik_smart_analyzer\": { \"type\": \"text\", \"analyzer\": \"ik_smart\" } } }, \"createAt\": { \"type\": \"date\" } } } } 简单解释下，content字段的映射：【就是一个字段配置多个分词器】\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \"content\": { \"type\": \"keyword\", # 默认为 keyword类型 \"fields\": { \"ik_max_analyzer\": { # 创建名为 ik_max_analyzer 的子字段 \"type\": \"text\", \"analyzer\": \"ik_max_word\", # 字段ik_max_analyzer 的倒排序索引分词器为ik_max_word \"search_analyzer\": \"ik_max_word\" # 检索关键词的分词器为ik_max_word }, \"ik_smart_analyzer\": { # 创建名为 ik_smart_analyzer的子字段 \"type\": \"text\", \"analyzer\": \"ik_smart\", # 字段ik_smart_analyzer 的倒排序索引分词器为ik_smart # 字段ik_smart_analyzer 的检索关键词的分词器默认为ik_smart，无需单独设置 } } } 相对于粗暴的用不同的字段去实现配置不同的分词器而言，一个字段配置多个分词器在数据的存储和操作上方便许多，只用储存一个字段，即可得到不同的分词效果。\n批量插入数据\n1 2 3 4 5 6 7 8 9 POST _bulk { \"index\" : { \"_index\" : \"my_index\", \"_id\" : \"1\" } } { \"id\" : 1,\"content\":\"关注我，系统学编程\" } { \"index\" : { \"_index\" : \"my_index\", \"_id\" : \"2\" } } { \"id\" : 2,\"content\":\"系统学编程,就关注我\" } { \"index\" : { \"_index\" : \"my_index\", \"_id\" : \"3\" } } { \"id\" : 3,\"content\":\"系统编程，关注我\" } {\"index\" : { \"_index\" : \"my_index\", \"_id\" : \"4\" } } {\"id\" : 4,\"content\":\"关注我，间隔系统学编程\" } 注意：bulk api 对json语法有严格的要求，一个json串内部不能换行，只能放到一行。而且一个json串和其他json串之间必须要换行，否则会出现错误。\n检查批量插入是否成功 GET my_index/_search\n使用 content 的默认字段检索【keword】\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # 这样查不到数据 GET my_index/_search { \"query\":{ \"match\":{ \"content\":\"系统学\" } } } # 可以查到数据 GET my_index/_search { \"query\":{ \"match\":{ \"content\":\"关注我，系统学编程\" } } } 语句1查不到数据，是因为此时content是keyword类型，是不会分词的，所以检索词需要和内容完全一样。语句2和第一个文档content内容完全一样，所以可以查到数据。\n下面使用 content.ik_max_analyzer 字段检索【ik_max_word】\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 可以查到全部数据 GET my_index/_search { \"query\":{ \"match\":{ \"content.ik_max_analyzer\":\"系统学\" } } } # 改变检索分词器为ik_smart，只能检索到文档1和文档2 GET my_index/_search { \"query\": { \"match\": { \"content.ik_max_analyzer\": { \"query\": \"系统学\", \"analyzer\": \"ik_smart\" } } } } 分析： 【语句1】能查到所有文档，因为检索词根据 ik_max_word 分词，得到Token（系统、系统学）。 【语句2】的检索词根据 ik_smart 分词，只能得到Token（系统学），所以无法匹配文档3。\n可以自己执行以下的分词测试语句，查看分词效果：\n1 2 3 4 5 6 7 8 9 10 11 GET /_analyze { \"text\": [\"系统学\"], \"analyzer\": \"ik_smart\" } GET /_analyze { \"text\": [\"系统学\"], \"analyzer\": \"ik_max_word\" } Match phrase query match_phrase查询，分析文本并根据分析的文本创建一个短语查询。 match_phrase 会将检索关键词分词。 match_phrase的分词结果必须在被检索字段的分词中都包含，而且顺序必须相同，而且默认必须都是连续的。\n简单看个例子，与match query 对比下，就很好理解了。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # 使用match_phrase查询，ik_smart分词，结果只有文档1 GET my_index/_search { \"query\": { \"match_phrase\": { \"content.ik_smart_analyzer\": { \"query\": \"关注我,系统学\" } } } } # 改为match查询，ik_smart分词，可以查询出所有结果 GET my_index/_search { \"query\": { \"match\": { \"content.ik_smart_analyzer\": { \"query\": \"关注我,系统学\" } } } } 分析：上面的例子使用的分词器是ik_smart，所以检索词“关注我，系统学”会被分词为3个Token【关注、我、系统学】；而文档1、文档2和文档4 的content被分词后都包含这3个关键词，但是只有文档1的Token的顺序和检索词一致，且连续。所以使用 match_phrase 查询只能查询到文档1（ps：文档2 Token顺序不一致；文档4 Token不连续；文档3 Token没有完全包含）。使用 match查询可以查询到所有文档，是因为所有文档都有【关注、我】这两个Token。\nmatch_phrase 核心参数：slop，Token之间的位置距离，直接看例子。\n1 2 3 4 5 6 7 8 9 10 11 12 # 将上面的 match_phrase 查询新增一个 slop参数，文档1和文档4都被检索出来 GET /my_index/_doc/_search { \"query\": { \"match_phrase\": { \"content.ik_smart_analyzer\": { \"query\": \"关注我,系统学\", \"slop\":1 } } } } 使用 analyze 接口分析下文档4的Token。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 # 文档4 content 的分词 GET /_analyze { \"text\": [\"关注我,间隔系统学编程\"], \"analyzer\": \"ik_smart\" } # 结果 { \"tokens\": [ { \"token\": \"关注\", \"start_offset\": 0, \"end_offset\": 2, \"type\": \"CN_WORD\", \"position\": 0 }, { \"token\": \"我\", \"start_offset\": 2, \"end_offset\": 3, \"type\": \"CN_CHAR\", \"position\": 1 }, { \"token\": \"间隔\", \"start_offset\": 4, \"end_offset\": 6, \"type\": \"CN_WORD\", \"position\": 2 }, { \"token\": \"系统学\", \"start_offset\": 6, \"end_offset\": 9, \"type\": \"CN_WORD\", \"position\": 3 }, { \"token\": \"编程\", \"start_offset\": 9, \"end_offset\": 11, \"type\": \"CN_WORD\", \"position\": 4 } ] } 通过分词测试，发现Token【我】与【系统学】的position差值为1(等于slop的值)，所以文档4也被检索出来了。\nmatch_phrase_prefix 与match_phrase查询类似，但是会对最后一个Token在倒排序索引列表中进行通配符搜索。 重要参数：max_expansions，模糊匹配数控制： 默认值50，最小值为1。 示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # 1、先使用match_phrase查询，没有结果 GET my_index/_search { \"query\": { \"match_phrase\": { \"content.ik_smart_analyzer\": { \"query\": \"系\" } } } } # 2、使用match_phrase_prefix查询， \"max_expansions\": 1，得到文档3 GET my_index/_search { \"query\": { \"match_phrase_prefix\": { \"content.ik_smart_analyzer\": { \"query\": \"系\", \"max_expansions\": 1 } } } } # 3.match_phrase_prefix查询， \"max_expansions\": 2，得到所有文档 GET my_index/_search { \"query\": { \"match_phrase_prefix\": { \"content.ik_smart_analyzer\": { \"query\": \"系\", \"max_expansions\": 2 } } } } 结果分析：【语句1】查不到结果，是因为根据ik_smart分词器生成的倒排序索引中，所有文档中都不包含Token【系】；【语句2】查询到文档3，是因为文档3包含Token【系统】，同时 “max_expansions”: 1，所以检索关键词【系】+ 1个通配符匹配，就可以匹配到一个Token【系统】；【语句3】查询到所有文档，是因为\"max_expansions”: 2，所以检索关键词【系】+ 2个通配符匹配，就可以匹配到两个Token【系统、系统学】，所以就可以查询到所有。\nmulti_match 多重匹配查询，在match的基础上允许多个字段查询。multi_match默认带有2个属性：query 和 fields，query设置搜索文档，fields用于指定匹配字段。\n1 2 3 4 5 6 7 8 9 GET my_index/_search { \"query\": { \"multi_match\" : { \"query\": \"this is a test\", \"fields\": [\"subject\", \"message\"] } } } fields可以模糊匹配，如：\n1 2 3 4 5 6 7 8 9 GET /_search { \"query\": { \"multi_match\" : { \"query\": \"Will Smith\", \"fields\": [\"title\", \"*_name\"] } } } 搜索三个字段：title、first_name 和 last_name。\n提升字段分数。\n1 2 3 4 5 6 7 8 9 GET /_search { \"query\": { \"multi_match\" : { \"query\" : \"this is a test\", \"fields\" : [\"subject^3\", \"message\"] } } } subject得分乘以3，message 字段不变。\n可选参数： type：设置multi_match在内部查询的执行方式，有5个可选项。\nbest_fields：默认值，它可以查询与任何字段匹配的文档，但使用最佳字段的_score作为返回结果的_score(相关度) most_fields：查找与任何字段匹配的文档，并组合每个字段的_score cross_fields：使用相同的分析器处理每个字段 phrase：在每个字段上运行match_phrase查询，并组合每个字段的_score phrase_prefix：在每个字段上运行match_phrase_prefix查询，并组合每个字段的_score 再给一个上面的例子：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # 1、同时查询 \"content\", \"content.ik_smart_analyzer\"，得到文档3 GET /tehero_index/_doc/_search { \"query\": { \"multi_match\": { \"query\": \"系统\", \"fields\": [ \"content\", \"content.ik_smart_analyzer\" ] } } } # 2、同时查询 所有字段 得到所有文档 GET /tehero_index/_doc/_search { \"query\": { \"multi_match\": { \"query\": \"系统\", \"fields\": [ \"content\", \"content.ik_smart_analyzer\", \"content.ik_max_analyzer\" ] } } } 需要注意的是，多个Fields之间的查询关系是 or ，就相当于mysql 的 where 字段1=\"检索词\" or 字段2=\"检索词\" or 字段3=\"检索词\"\nquery_string 允许我们在单个查询字符串中指定AND | OR | NOT条件，同时也和 multi_match query 一样，支持多字段搜索。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # 1、检索同时包含Token【系统学、es】的文档，结果为空 GET /tehero_index/_doc/_search { \"query\": { \"query_string\" : { \"query\" : \"系统学 AND es\" \"fields\" : [\"content.ik_smart_analyzer\"], } } } 等价sql： where Token = '系统学' and Token = 'es' # 2、检索包含Token【系统学、es】二者之一的文档，能检索到文档1、2、4 GET /tehero_index/_doc/_search { \"query\": { \"query_string\" : { \"query\" : \"系统学 OR es\" \"fields\" : [\"content.ik_smart_analyzer\"], } } } 注意点：中间的连接词【AND | OR | NOT】必须是全大写。\nsimple_query_string 类似于query_string ，但是会忽略错误的语法，永远不会引发异常，并且会丢弃查询的无效部分。\n1 2 3 4 5 6 7 simple_query_string支持以下特殊字符： + 表示与运算，相当于query_string 的 AND | 表示或运算，相当于query_string 的 OR - 取反单个令牌,相当于query_string 的 NOT \"\" 表示对检索词进行 match_phrase query * 字词末尾表示前缀查询 +表示与运算，相当于query_string 的 AND\n1 2 3 4 5 6 7 8 9 10 # 1、检索到文档4 GET /tehero_index/_doc/_search { \"query\": { \"simple_query_string\" : { \"query\" : \"系统学 + 间隔\" \"fields\" : [\"content.ik_smart_analyzer\"], } } } | 表示或运算，相当于query_string 的 OR\n1 2 3 4 5 6 7 8 9 10 # 2、检索到文档1、2、4 GET /tehero_index/_doc/_search { \"query\": { \"simple_query_string\" : { \"fields\" : [\"content.ik_smart_analyzer\"], \"query\" : \"系统学 | 间隔\" } } } -取反单个令牌，相当于query_string 的 NOT\n1 2 3 4 5 6 7 8 9 10 11 # 3、检索到文档1、2 GET /tehero_index/_doc/_search { \"query\": { \"simple_query_string\" : { \"fields\" : [\"content.ik_smart_analyzer\"], \"query\" : \"系统学 -间隔\", \"default_operator\": \"and\" } } } 注意：参数\"default_operator\": \"and\"。该参数的默认值为or。 上述DSL对应的sql语句为：where Token = 系统学 and Token != 间隔\n*字词末尾表示前缀查询 -match_phrase_prefix query\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 6、检索到文档 3 GET /tehero_index/_doc/_search { \"query\": { \"simple_query_string\" : { \"fields\" : [\"content.ik_smart_analyzer\"], \"query\" : \"系统\" } } } # 6、检索到所有文档，等价于match_phrase_prefix query GET /tehero_index/_doc/_search { \"query\": { \"simple_query_string\" : { \"fields\" : [\"content.ik_smart_analyzer\"], \"query\" : \"系统*\" } } } 总结 match query：用于执行全文查询的标准查询，包括模糊匹配和短语或接近查询。重要参数：控制Token之间的布尔关系：operator：or/and match_phrase query：与match查询类似，但用于匹配确切的短语或单词接近匹配。重要参数：Token之间的位置距离：slop 参数 match_phrase_prefix query：与match_phrase查询类似，但是会对最后一个Token在倒排序索引列表中进行通配符搜索。重要参数：模糊匹配数控制：max_expansions 默认值50，最小值为1 multi_match query：match查询 的多字段版本。该查询在实际中使用较多，可以降低DSL语句的复杂性。同时该语句有多个查询类型，后面TeHero会专门进行讲解。 common terms query：对于中文检索意义不大。 query_string query 和 simple_query_string query，其实就是以上 query语句的合集，使用非常灵活，DSL编写简单。但是，TeHero认为这两个查询语句，有一个很明显的弊端：类似于sql注入【建议使用flags参数进行控制】。如果用户在检索词输入了对应的“关键字”【比如OR、*】等，用户将获取到本不应该被查询到的数据。慎用！ Term-level queries 术语查询 术语级查询就是根据结构化数据中的精确值查找文档。 所有属于term level query 的查询，都是给什么就查什么，不会对检索词进行，明显区别于全文检索full text query。 注意：只是检索词不会被分词，被检索的字段如果是 text 类型，还是会分词，和检索词无关。比如你的检索词是天气不错，天气不错不会被分词，如果被搜索的字段是 text 类型（会被分词），且有一列的值是今天天气不错，那么也会被搜出来。\nterm 根据查询内容，返回精确匹配的文档。等价于sqlwhere id = 123\n注：不要用 term 查询搜索 text 类型的字段。因为es会对 text 类型的字段进行分词，所以会使精确匹配变得困难。想对 text 类型的字段进行检索，应该使用 match 。\nterm 使用示例：\n1 2 3 4 5 6 7 8 9 10 11 GET my_index/_search { \"query\": { \"term\": { \"user.name\": { \"value\": \"wjy\", \"boost\": 1.0 } } } } term的参数： 你想要搜索的字段 的参数：\nvalue 你想搜索的内容\nboost 用于减少或增加查询的相关性分数的浮点数字，默认为1.0。\nterms 精确匹配多个值，其他各方面都和term一致。等价sqlwhere id in(1,2,3)\n示例：\n1 2 3 4 5 6 7 8 9 GET /_search { \"query\": { \"terms\": { \"user.name\": [ \"wjy\", \"wm\" ], \"boost\": 1.0 } } } terms set terms_set 查询与 terms 查询相同，区别是可以定义返回文档所需的匹配词条数目。索引数据时，你需要创建一个数字字段映射来使用terms_set查询，这个数字字段包含了返回一个文档所需的匹配术语的数量。\nterms_set query 在对Array类型的字段做检索时非常有用，特别是对于每个文档，需要匹配的数量不一致时。如果所有文档需要匹配的数量一致，可以使用match query替代。\n示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 # 创建index PUT /job-candidates { \"mappings\": { \"properties\": { \"name\": { \"type\": \"keyword\" }, \"programming_languages\": { \"type\": \"keyword\" }, \"required_matches\": { // 必须是数字类型 \"type\": \"long\" } } } } # 创建数据1 PUT /job-candidates/_doc/1?refresh { \"name\": \"Jane Smith\", \"programming_languages\": [ \"c++\", \"java\" ], \"required_matches\": 2 } # 创建数据2 PUT /job-candidates/_doc/2?refresh { \"name\": \"Jason Response\", \"programming_languages\": [ \"java\", \"php\" ], \"required_matches\": 2 } # 查询 GET /job-candidates/_search { \"query\": { \"terms_set\": { \"programming_languages\": { \"terms\": [ \"c++\", \"java\", \"php\" ], \"minimum_should_match_field\": \"required_matches\" } } } } 两个文档都可以查到。因为两个文档的required_matches都是2，而我们查询了三个字符串。 如果\"terms\": [ \"c++\", \"java\"]，那么只能查到文档1，如果\"terms\": [\"java\"]，那么查不到任何数据。\n与match query的比较。 当每个文档的required_matches值都相同时，上述两句DSL与下面的match query 语句检索效果完全一致：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 GET /job-candidates/_search { \"query\": { \"match\": { \"programming_languages\" : { \"query\": \"c++ java php, \"analyzer\": \"whitespace\", \"minimum_should_match\": 2 } } } } \"analyzer\": \"whitespace\", 所以 query会被分词3个Token【c++】【java】【php】。\"minimum_should_match\": 2，所以可以检索到文档1和2。 range 查找指定字段指定范围内的值。\n示例：\n1 2 3 4 5 6 7 8 9 10 11 12 GET /_search { \"query\": { \"range\": { \"age\": { \"gte\": 10, \"lte\": 20, \"boost\": 2.0 } } } } 查询10-20岁之间的数据。 查询字段的可选参数。\n1 2 3 4 gt（Greater than）：即大于 \u003e gte（Greater than or equal to）：即大于等于 \u003e= lt（Less than）：即小于 \u003c lte（Less than or equal to）：即小于等于 \u003c= boost：分值，默认1.0\nrange（date类型） es的日期函数由两部分组成。 第一部分： 以固定日期开头，如：2022-03-31 16:16:55。 以 now 开头。 是以“||”结尾的时间字符串，如：2022-03-31||。\n第二部分：固定日期后面可接一个或多个数学表达式。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 多个数学表达式，如： +1h：增加一小时 -1d：减少一天 /d：四舍五入到最近的一天 支持的时间单位： y-Years M-Months w-Weeks d-Days h-Hours H-Hours m-Minutes s-Seconds 看几个Date Math 示例加以理解。\n1 2 3 4 5 6 7 比如当前时间：now = 2020-05-26 13:00:00 now + 1h ：now的毫秒值 + 1小时，结果为：2020-05-26 14:00:00 now-1h/d：now的毫秒值 - 1小时，再根据情况四舍五入到最近的一天的起始：2020-05-26 00:00:00 或者 结束：2020-05-26 23:59:59.999 2020-05-26||-1M/M：2020-05-26 的毫秒值 - 1个月，再根据情况四舍五入到最近的一月的起始：2020-04-01 00:00:00 或者 结束：2020-04-30 23:59:59.999 这里说的“根据情况四舍五入”就是下面即将介绍的date math to round\ndate math to round 当使用日期函数，将日期四舍五入到最接近的日期、月份、小时等，四舍五入的日期取决于范围的结尾是包含端点还是排除端点。\n包含端点：gte（大于等于） 和 lte（小于等于） 就是包含端点。 不包含端点：gt（大于） 和 lt（小于） 就是不包含端点。\n包含端点：按最大范围四舍五入 gte（大于或等于）四舍五入的日期：2020-05-25||/M变为2020-05-01，即包括整个月份。\n1 2 3 4 5 6 7 8 9 10 11 12 GET /blogs_index/_search { \"query\": { \"range\" : { \"createAt\" : { \"gte\" : \"2020-05-25||/M\" } } } } 等价于sql【where createAt \u003e= \"2020-05-01 00:00:00\"】 lte （小于或等于）四舍五入的日期：2020-05-25||/M变为2020-05-31T23:59:59.999，即包括整个月份。\n1 2 3 4 5 6 7 8 9 10 11 12 GET /blogs_index/_search { \"query\": { \"range\" : { \"createAt\" : { \"lte\" : \"2020-05-01||/M\" } } } } 等价于sql【where createAt \u003c= \"2020-05-31 23:59:59.999\"】 排除端点：按最小范围四舍五入。\ngt 大于四舍五入的日期：2020-05-01||/M变为2020-05-31T23:59:59.999，即排除整个月份。\n1 2 3 4 5 6 7 8 9 10 11 12 GET /blogs_index/_search { \"query\": { \"range\" : { \"createAt\" : { \"gt\" : \"2020-05-01||/M\" } } } } 等价于sql【where createAt \u003e \"2020-05-31T23:59:59.999\"】 lt 少于四舍五入的日期：2020-05-31||/M变为2020-05-01，即排除整个月份。\n1 2 3 4 5 6 7 8 9 10 11 12 GET /blogs_index/_search { \"query\": { \"range\" : { \"createAt\" : { \"lt\" : \"2020-05-31||/M\" } } } } 等价于sql【where createAt \u003c \"2020-05-01 00:00:00\"】 使用日期函数进行检索 以下示例，基于now = 2020-05-25 23:00:00\n获取昨天发布的博客 1 2 3 4 5 6 7 8 9 10 11 12 13 GET /blogs_index/_search { \"query\": { \"range\" : { \"createAt\" : { \"gte\" : \"now-1d/d\", \"lt\" : \"now/d\" } } } } 等价于sql【where createAt \u003e= \"2020-05-24 00:00:00\" and createAt \u003c \"2020-05-25 00:00:00\"】 获取一周内发布的博客 1 2 3 4 5 6 7 8 9 10 11 12 13 GET /blogs_index/_search { \"query\": { \"range\" : { \"createAt\" : { \"gte\" : \"now-1w/d\", \"lt\" : \"now/d\" } } } } 等价于sql【where createAt \u003e= \"2020-05-18 00:00:00\" and createAt \u003c \"2020-05-25 00:00:00\"】 获取本月内发布的博客 1 2 3 4 5 6 7 8 9 10 11 12 13 GET /blogs_index/_search { \"query\": { \"range\" : { \"createAt\" : { \"gte\" : \"now/M\", \"lte\" : \"now/M\" } } } } 等价于sql【where createAt \u003e= \"2020-05-01 00:00:00\" and createAt \u003c \"2020-05-31 23:59:59.999\"】 日期格式 对日期字段进行检索时，默认使用被检索字段的format，但是可以通过format参数覆盖。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 GET /blogs_index/_search { \"query\": { \"range\" : { \"createAt\" : { \"gte\": \"20/05/2020\", \"lte\": \"2021\", \"format\": \"dd/MM/yyyy||yyyy\" } } } } 请注意，如果日期缺少年，月和日的某些坐标，则丢失的部分将以unix time的开始（即1970年1月1日）填充 。 这意味着，例如，当指定dd格式时，\"gte\" : 10 将使用翻译成1970-01-10T00:00:00.000Z。 等价于sql【where createAt \u003e= \"2020-05-24T00:00:00Z\" and createAt \u003c \"2021-01-01T00:00:00.000Z\" 】 如果没有 format，上述DSL执行将报parse_exception异常，因为date类型默认只支持3种格式。\n对类型为 range 字段的查询 文档1【“gte”:10,“lte”:15】 文档2【“gte”:10,“lte”:20】 文档3【“gte”:15,“lte”:18】 文档4【“gte”:15,“lt”:18】 文档5【“gt”:15,“lt”:18】\nWITHIN：文档的范围字段要完全在检索关键词的范围里。\n1 2 3 4 5 6 7 8 9 10 11 12 GET /blogs_index/_search { \"query\" : { \"range\" : { \"age_range\": { \"gte\" : 12, \"lte\" : 17, \"relation\" : \"within\" } } } } 可以检索到文档4和文档5，【15,18）完全在【12,17】范围里。\nCONTAINS：文档的范围字段完全包含检索关键词的范围；\n1 2 3 4 5 6 7 8 9 10 11 12 GET /blogs_index/_search { \"query\" : { \"range\" : { \"age_range\": { \"gte\" : 12, \"lte\" : 17, \"relation\" : \"CONTAINS\" } } } } 可以检索到文档2，只有【10,20】完全包含【12,17】范围。\nINTERSECTS：（为默认值）文档的范围字段与检索关键词的范围有交集即可。\n1 2 3 4 5 6 7 8 9 10 11 12 GET /blogs_index/_search { \"query\" : { \"range\" : { \"influence\": { \"gte\" : 12, \"lte\" : 17, \"relation\" : \"CONTAINS\" } } } } 可以检索到所有文档，都有交集。\nexists 查找指定字段包含至少包含一个非空值的文档。等价于sqlwhere name is not null 空值的界定：\nnull 空数组[] 该字段在映射中设置了 “index”：false 字段值的长度超过了映射中的ignore_above设置。 注：\"\"会被查出来，因为\"\"不是null。\n1 2 3 4 5 6 7 8 GET /_search { \"query\": { \"exists\": { \"field\": \"phone\" } } } 查询 phone 字段不为空的文档。\n查询某个为空的字段，可以用 mast_not和exists配合。\n1 2 3 4 5 6 7 8 9 10 11 12 GET /_search { \"query\": { \"bool\": { \"must_not\": { \"exists\": { \"field\": \"user.id\" } } } } } perfix 前缀匹配。\n1 2 3 4 5 6 7 8 9 10 11 12 13 GET /_search { \"query\": { \"prefix\": { \"address\": { \"value\": \"北京\" } } } } 等价于sql：where author like '北京%' 等价于 wildcard query 的 \"wildcard\" : { \"author\": \"方*\" } 查询address字段中，带有北京前缀的文档。\n你可以使用index_prefixes映射参数来加快前缀查询的速度。如果启用，Elasticsearch会在一个单独的字段中为2到5个字符的前缀建立索引。这可以让Elasticsearch更有效地运行前缀查询，但代价是索引会变得更大。\nwildcard 通配符查询。等价于mysql 的 like 查询。 下面的搜索会返回user.name字段包含以ki开头，以y结尾的术语的文档，这些匹配的术语可以包括kiy，kity，或kimchy。\n1 2 3 4 5 6 7 8 9 10 11 12 GET /_search { \"query\": { \"wildcard\": { \"user.name\": { \"value\": \"ki*y\", \"boost\": 1.0, \"rewrite\": \"constant_score\" } } } } 支持两个通配符： *：匹配任何字符序列（包括空字符）。 ?：匹配任何单个字符。\nregexp 正则表达式匹配。 正则表达式是一种使用占位符（称为操作符）来匹配数据模式的方法。 下面的搜索返回user.id字段包含任何以k开头，以y结尾的术语的文档。.*操作符匹配任何长度的字符，包括无字符。匹配的术语可以包括ky，kay，和kimchy。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 GET /_search { \"query\": { \"regexp\": { \"user.id\": { \"value\": \"k.*y\", \"flags\": \"ALL\", \"case_insensitive\": true, \"max_determinized_states\": 10000, \"rewrite\": \"constant_score\" } } } } regexp查询的性能和正则表达式相关。为了提高性能，避免使用通配符模式，如.*或.*?+，没有前缀或后缀。\nfuzzy 模糊查询，返回与搜索内容相近的文档，依据编辑距离算法。 编辑距离：将一个字符串转化成另一个字符串所需的操作次数。如果它们的距离越大，说明它们越是不同。变化方式有以下几种： 改变一个字符 (box → fox) 移除一个字符 (black → lack) 插入一个字符 (sic → sick) 两个相邻字符换位置 (act → cat)\n简单示例：\n1 2 3 4 5 6 7 8 9 10 GET /_search { \"query\": { \"fuzzy\": { \"username\": { \"value\": \"王靖尧\" } } } } 使用高级参数示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 GET /_search { \"query\": { \"fuzzy\": { \"username\": { \"value\": \"王靖尧\", \"fuzziness\": \"AUTO\", \"max_expansions\": 50, \"prefix_length\": 0, \"transpositions\": true, \"rewrite\": \"constant_score\" } } } } 参数： value：必须参数，你想要匹配的内容。 fuzziness：最大编辑距离，默认auto。 max_expansions：模糊查询能扩展的最大词数，默认为50。 prefix_length：不会“模糊化”的初始字符数，这有助于减少必须检查的术语数量，默认为0。\nids 文档id查询，查文档的_id字段。\n1 2 3 4 5 6 7 8 GET /_search { \"query\": { \"ids\" : { \"values\" : [\"1\", \"4\", \"100\"] } } } mapping 设置指南 什么是 mapping？ Mapping 类似于数据库中的表结构定义 schema，它有以下几个作用：\n定义索引中字段的名称； 定义字段的数据类型，比如 text、keyword、date； 倒排索引的相关配置，比如设置某个字段为不被索引； 基础配置 properties。 mappings、object字段和nested字段包含的子字段就叫做 properties，示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 PUT my_index { \"mappings\": { \"properties\": { \"manager\": { \"properties\": { \"age\": { \"type\": \"integer\" }, \"name\": { \"type\": \"text\" } } }, \"employees\": { \"type\": \"nested\", \"properties\": { \"age\": { \"type\": \"integer\" }, \"name\": { \"type\": \"text\" } } } } } } 分词配置 fields 对同一个字段建立不同的索引方式，即multi-field。示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 PUT my_index { \"mappings\": { \"properties\": { \"name\": { 针对 name 字段，使用 standard 分词器建立索引 \"type\": \"text\", \"fields\": { 针对 name.sub_name 字段，使用 english 分词器建立索引 \"sub_name\": { \"type\": \"text\", \"analyzer\": \"english\" } } } } } } analyzer analyzer就是分词器。设置text类型字段索引时的分词器。\nes 是如何确定 analyzer 的？\n首先读取字段的“analyzer”配置 1 2 3 4 5 6 7 8 9 10 11 12 13 PUT my_index { \"mappings\": { \"properties\": { \"title\": { \"type\": \"text\", \"analyzer\": \"whitespace\" } } } } # 指定字段 title 建立倒排索引时的 analyzer 为 whitespace 如果字段没有配置分词器，再读取index的setting：analysis.analyzer.default 1 2 3 4 5 6 7 8 9 10 11 12 PUT my_index { \"settings\": { \"analysis\": { \"analyzer\": { \"default\": { \"type\": \"english\" } } } } } 还没有，则使用默认的 standard 标准分词器。 search_analyzer 设置 search 时使用的分词器。 ElasticSearch 如何确定 search 时的 analyzer ？\n首先找搜索时指定 analyzer 1 2 3 4 5 6 7 8 9 10 11 GET my_index/_search { \"query\": { \"match\": { \"message\": { \"query\": \"Quick foxes\", \"analyzer\": \"stop\" } } } } 如果搜索时没指定 search_analyzer，则读取 index 的 mapping 字段配置 search_analyzer。 1 2 3 4 5 6 7 8 9 10 11 12 PUT my_index { \"mappings\": { \"properties\": { \"title\": { \"type\": \"text\", \"analyzer\": \"whitespace\", \"search_analyzer\": \"simple\" } } } } 还没有，则读取 index 的 setting 的 analysis.analyzer.default_search 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 PUT my_index { \"settings\": { \"analysis\": { \"analyzer\": { \"default\": { \"type\": \"simple\" }, \"default_search\": { \"type\": \"whitespace\" } } } } } 还没有，则使用 field 的 analyzer 都没有，使用默认的 standard analyzer normalizer normalizer是 keyword的一个属性，可以对 keyword生成的单一 Term再做进一步的处理，比如 lowercase，即做小写变换。使用方法和自定义分词器有些类似，需要自定义，如下所示：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 DELETE test_normalizer 自定义 normalizer PUT test_normalizer { \"settings\": { \"analysis\": { \"normalizer\": { \"lowercase\": { \"type\": \"custom\", \"filter\": [ \"lowercase\" ] } } } }, \"mappings\": { \"doc\": { \"properties\": { \"type\": { \"type\": \"keyword\" }, \"type_normalizer\": { \"type\": \"keyword\", \"normalizer\": \"lowercase\" } } } } } PUT test_normalizer/doc/1 { \"type\": \"apple\", \"type_normalizer\": \"apple\" } PUT test_normalizer/doc/2 { \"type\": \"Apple\", \"type_normalizer\": \"Apple\" } 查询三 GET test_normalizer/_search { \"query\": { \"term\":{ \"type\":\"aPple\" } } } 查询四 GET test_normalizer/_search { \"query\": { \"term\":{ \"type_normalizer\":\"aPple\" } } } 我们第一步是自定义了名为 lowercase的 normalizer，其中filter 类似自定义分词器中的 filter ，但是可用的种类很少，详情大家可以查看官方文档。然后通过 normalizer属性设定到字段type_normalizer中，然后插入相同的2条文档。执行发现，查询三无结果返回，查询四返回2条文档。问题解决了！我们来看下是如何解决的\n文档写入时由于加入了 normalizer,所有的 term都会被做小写处理 查询时搜索词同样采用有 normalizer的配置，因此处理后的 term也是小写的 两边分词匹对，就得到了我们上面的结果 “相关性\"配置 boost 增加字段的权重。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 PUT my_index { \"mappings\": { \"properties\": { \"title\": { \"type\": \"text\", \"boost\": 2 }, \"content\": { \"type\": \"text\" } } } } 数据处理配置 dynamic 是否可以动态添加新字段。可选参数：\ntrue：动态添加新的字段（默认） false：忽略新的字段，但是会存在于_source中； strict：如果遇到新字段抛出异常【推荐】。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 PUT /my_index { \"mappings\": { \"my_type\": { \"dynamic\": \"strict\", \"properties\": { \"title\": { \"type\": \"string\" }, \"stash\": { \"type\": \"object\", \"dynamic\": \"strict\" } } } } } format 为 date 类型的字段指定格式，ES的date类型允许我们规定格式，可以使用的格式有3种： yyyy-MM-dd HH:mm:ss yyyy-MM-dd epoch_millis（毫秒值） 示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 规定格式如下：|| 表示或者 PUT my_index { \"mappings\": { \"_doc\": { \"properties\": { \"createDate\": { \"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis\" } } } } } 注意：一旦我们规定了格式，如果新增数据不符合这个格式，ES将会报错mapper_parsing_exception。 性能配置 enabled 设置成 false，仅做存储，不⽀持搜索和聚合分析，数据保存在 _source中。 enabled设置仅可应用于顶级映射定义和object字段，示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 PUT my_index { \"mappings\": { \"properties\": { \"user_id\": { \"type\": \"keyword\" }, \"last_updated\": { \"type\": \"date\" }, \"session_data\": { \"type\": \"object\", \"enabled\": false } } } } 任何任意数据都可以传递到该session_data字段，因为它将被完全忽略。 PUT my_index/_doc/session_1 { \"user_id\": \"kimchy\", \"session_data\": { \"arbitrary_object\": { \"some_array\": [ \"foo\", \"bar\", { \"baz\": 2 } ] } }, \"last_updated\": \"2015-12-06T18:20:22\" } PUT my_index/_doc/session_2 { \"user_id\": \"jpountz\", \"session_data\": \"none\", \"last_updated\": \"2015-12-06T18:22:13\" } doc_values doc_values 默认对所有字段启用，除了 text。禁用 doc_values，可以节省磁盘空间，仍然可以查询，但字段不能被用于聚合、排序以及脚本操作。示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 创建索引 PUT my_index { \"mappings\": { \"properties\": { \"status_code\": { \"type\": \"keyword\" }, \"session_id\": { \"type\": \"keyword\", \"doc_values\": false } } } } 存数据 PUT /my_index/_doc/1 { \"session_id\":\"关注我\" } 可以检索到 GET /my_index/_search { \"query\": { \"term\": { \"session_id\": { \"value\": \"关注我\" } } } } 聚合操作，直接报错 illegal_argument_exception GET /my_index/_search { \"aggs\": { \"test_agg\": { \"terms\": { \"field\": \"session_id\", \"size\": 10 } } } } 如果你确定永远也不会对某些字段进行聚合、排序或是使用脚本操作，就可以通过禁用特定字段的 doc_values，这样可以节省磁盘空间。\nindex 设置为 false，不构建倒排索引，不能被查询，但还是⽀持 aggregation，排序，脚本，并出现在 _source，与doc_values 的效果相反。示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 创建索引 PUT my_index { \"mappings\": { \"properties\": { \"test_field\": { \"type\": \"keyword\", \"index\": false } } } } 存数据 PUT /my_index/_doc/1 { \"test_field\":\"关注我\" } 查询，直接报错 GET /my_index/_search { \"query\": { \"term\": { \"test_field\": { \"value\": \"关注我\" } } } } 可以聚合 GET /my_index/_search { \"aggs\": { \"test_agg\": { \"terms\": { \"field\": \"test_field\", \"size\": 10 } } } } 因为倒排索引在index时会序列化到磁盘，所以该配置设置为false，也节约磁盘。\nfielddata 对 text 字段，该参数默认是禁止的，所以直接对 text 字段进行聚合、排序或在脚本中使用时，es 会报错。如果需要对 text 字段进行聚合，可以开启该配置。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 PUT my_index { \"mappings\": { \"properties\": { \"test_field\": { \"type\": \"text\", \"fielddata\": true }, \"test_field2\":{ \"type\": \"text\" } } } } PUT /my_index/_doc/1 { \"test_field\":\"点个在看\", \"test_field2\":\"可好\" } 可以聚合 GET /my_index/_search { \"size\": 0, \"aggs\": { \"test_agg\": { \"terms\": { \"field\": \"test_field\", \"size\": 10 } } } } 聚合报错 GET /my_index/_search { \"size\": 0, \"aggs\": { \"test_agg\": { \"terms\": { \"field\": \"test_field2\", \"size\": 10 } } } } 但是，一旦将 fielddata 加载到 JVM 的 Heap 中，在该 segment 的生命周期内会一直保留在堆中，所以使用 fielddata 会占用大量的堆内存，影响性能。而对于非 text 类型字段的聚合，大多数使用的都是 doc_value，根据ElasticSearch官网对其的描述：\n1 Doc Values 是在索引时与倒排索引同时生成。也就是说 Doc Values 和 倒排索引 一样，基于 Segement 生成并且是不可变的。同时 Doc Values 和 倒排索引 一样序列化到磁盘，这样对性能和扩展性有很大帮助。Doc Values 通过序列化把数据结构持久化到磁盘，我们可以充分利用操作系统的内存，而不是 JVM 的 Heap 。 当 working set 远小于系统的可用内存，系统会自动将 Doc Values 驻留在内存中，使得其读写十分快速；不过，当其远大于可用内存时，系统会根据需要从磁盘读取 Doc Values，然后选择性放到分页缓存中。很显然，这样性能会比在内存中差很多，但是它的大小就不再局限于服务器的内存了。 综上，个人建议，如有对 text 类型字段进行聚合、排序等需求，建议通过 fields 配置多字段：新增 keyword类型，同时将 index 参数设置为false，示例如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 PUT my_index { \"mappings\": { \"properties\": { \"my_field\": { \"type\": \"text\", \"fields\": { 该字段只用于聚合、排序等，所以关闭了index \"keyword\": { \"type\": \"keyword\", \"index\":false } } } } } } PUT /my_index/_doc/1 { \"my_field\":\"点个在看,可好\" } 可以聚合 GET /my_index/_search { \"size\": 0, \"aggs\": { \"test_agg\": { \"terms\": { \"field\": \"my_field.keyword\", \"size\": 10 } } } } store 与 _source 对比 store：默认 false，不存储，数据默认存储在 _source中。 如果字段的 store 被设置为 true，则在 lucence 中该字段的值被单独存储。 设置为 true 后，通过stored_filed 显示。\n_source：以json格式存储在_source字段中。 在lucence 中_source只是一个字段。 官方不建议关闭，因为关闭后会由很多限制。\n对比分析： 从每一个 stored field 中获取值都需要一次磁盘 io，如果想获取多个 field 的值，就需要多次磁盘 io ，但是，如果从 _source 中获取多个 field 的值，则只需要一次磁盘 io ，因为 _source 只是一个字段，而且_source是被压缩过的。所以在大多数情况下，从 _source 中获取是快速而高效的。\n哪些情形下需要显式的指定 store 属性呢？ 如果你的文档长度很长，存储 _source 或者从 _source 中获取 field 的代价很大，你可以显式的将某些 field 的 store 属性设置为 yes。此时只查询这一个字段的值的，效率高。\n完整示例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 PUT /blogs_index/ { \"settings\": { \"index\": { \"number_of_shards\": 1, \"number_of_replicas\": 1 }, \"analysis\": { \"analyzer\": { \"pinyin_analyzer\": { \"tokenizer\": \"standard\", \"filter\": [ \"my_pinyin\" ] } }, \"filter\": { \"my_pinyin\": { \"type\": \"pinyin\", \"keep_first_letter\": true, \"keep_separate_first_letter\": true, \"keep_full_pinyin\": true, \"keep_original\": true, \"limit_first_letter_length\": 16, \"lowercase\": true } } } }, \"mappings\": { 禁止新增字段 \"dynamic\": \"strict\", \"properties\": { \"id\": { \"type\": \"integer\" }, \"author\": { \"type\": \"text\", 对作者使用拼音分词 \"analyzer\": \"pinyin_analyzer\", \"fields\": { 建立多字段，用于聚合 \"keyword\": { \"type\": \"keyword\", \"index\":false } } }, 博客的分类，支持 term 查询 \"blog_sort\": { \"type\": \"keyword\", 需要聚合，且数据量较大，但唯一值较少 \"eager_global_ordinals\": true, 提升该字段的权重 \"boost\": 3 }, \"title\": { \"type\": \"text\", \"analyzer\": \"ik_max_word\", 检索的分词没必要细粒度，提升效率 \"search_analyzer\": \"ik_smart\", 对 标题 不需要聚合、排序 \"doc_values\": false, 提升该字段的权重 \"boost\": 5 }, \"content\": { \"type\": \"text\", \"analyzer\": \"ik_max_word\", \"search_analyzer\": \"ik_smart\", 博客内容为大字段，单独存储，用于查询返回 \"store\": true, 不需要聚合、排序 \"doc_values\": false }, \"update_time\":{ \"type\": \"date\", 规定格式，提高可读性 \"format\": [\"yyyy-MM-dd HH:mm:ss\"], 该字段仅用于显示，不用检索、聚合、排序【非object类型，不能使用 enabled 参数】 \"index\":false, \"doc_values\": false }, \"create_time\":{ \"type\": \"date\", \"format\": [\"yyyy-MM-dd HH:mm:ss\"] } } } } 聚合 ES的聚合一共有4种类型。\nBucket Aggregations：桶聚合，类似于SQL的分组(GROUP BY)。 Metrics Aggregations：指标聚合，一些数学运算，对文档字段进行统计分析，类似于sql的COUNT()、SUM()、MAX()等统计方法。 Pipeline Aggregations：管道聚合，对其他聚合结果进行二次聚合 Matrix Aggregations：矩阵聚合，支持对多个字段的操作并提供一个结果矩阵，此功能是试验性的，在将来的版本中可能会完全更改或删除。 简单示例，学会agg语法：（aggregations 可以缩写为 aggs）\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 GET /my_index/_search { \"size\": 0, // 和query 同级别的关键字 \"aggs\": { // 自定义聚合名 \"first_agg_name\": { // 聚合的类型 \"terms\": { // 具体字段 \"field\": \"color\" }, // 子聚合 \"aggs\": { // 自定义聚合名 \"sub_agg_name1\": { // 聚合类型 \"avg\": { // 具体字段 \"field\": \"price\" } }, // 可以包含多个同级的聚合 \"sub_agg_name2\": { \"terms\": { \"field\": \"make\" } } } } } } Bucket Aggregations 桶聚合 Bucket 就是桶的意思，即按照一定的规则将文档分配到不同的桶中，达到分类分析的目的。\nTerms 术语聚合 使用场景：按照某个字段的值，将分档聚合分类。等价与sql的 group by 注意：默认根据 doc_count 降序排列。 text 类型的字段需要启用 fielddata。 默认情况下，返回排序前十的存储桶，可以通过设置size参数来更改此默认行为。 返回参数解析： sum_other_doc_count：响应中未被包含的文档总和 doc_count_error_upper_bound：每个术语的文档计数上的错误上限\n示例：将博客系统中的文档按作者分类，得到每位作者的博文总数\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 GET /blogs_index/_search { \"size\": 0, \"aggs\": { // 自定义聚合名 \"author_aggs\": { // 聚合类型 \"terms\": { // 聚合字段 \"field\": \"author\" } } } } 返回结果 \"aggregations\" : { \"author_aggs\" : { \"doc_count_error_upper_bound\" : 0, \"sum_other_doc_count\" : 0, \"buckets\" : [ { \"key\" : \"方才\", \"doc_count\" : 3 }, { \"key\" : \"方才兄\", \"doc_count\" : 3 } ] } } Rare Terms 稀有术语聚合 作用：统计最少出现的文档 排序：按doc_count 升序排列（doc_count少的在前面） 参数：\nfield：聚合的字段 max_doc_count：文档最多出现的次数，默认1 precision：精确度，默认0.01，不能比0.00001更小 include：包含的值 exclude：不包含的值 missing：缺省值 示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 创建索引 PUT /rare_terms_test { \"mappings\": { \"properties\": { \"name\": {\"type\": \"keyword\"} } } } 新增数据 POST /rare_terms_test/_bulk?routing=1\u0026refresh {\"index\": {\"_id\": 1}} {\"name\": \"张三\"} {\"index\": {\"_id\": 2}} {\"name\": \"李四\"} {\"index\": {\"_id\": 3}} {\"name\": \"王五\"} {\"index\": {\"_id\": 4}} {\"name\": \"张三\"} {\"index\": {\"_id\": 5}} {\"name\": \"张三\"} {\"index\": {\"_id\": 6}} {\"name\": \"张三\"} {\"index\": {\"_id\": 7}} {\"name\": \"李四\"} {\"index\": {\"_id\": 8}} {\"name\": \"赵六\"} 搜索 GET /rare_terms_test/_search?size=0 { \"aggs\": { \"rare_terms_aggs\": { \"rare_terms\": { \"field\": \"name\", \"max_doc_count\": 2, \"include\": [\"张三\", \"李四\", \"王五\"], \"exclude\": [\"赵六\"] } } } } 返回结果： \"aggregations\" : { \"rare_terms_aggs\" : { \"buckets\" : [ { \"key\" : \"王五\", \"doc_count\" : 1 }, { \"key\" : \"李四\", \"doc_count\" : 2 } ] } } Histogram 直方图聚合 使用场景：根据数值（或数值范围）字段，按固定间隔将文档分类。 例如：将商品按价格区间聚合，得到不同区间的商品数量。 配置字段：\nfield：要聚合的字段 interval：间隔 min_doc_count：不返回doc_count小于该值的存储桶 order：排序 offset：偏移量 keyed：更改返回格式，将key作为键返回 missing：缺省值 示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 创建索引 PUT /histogram_test { \"mappings\": { \"properties\": { \"num\": {\"type\": \"integer\"} } } } 索引数据 POST /histogram_test/_bulk?routing=1\u0026refresh {\"index\": {\"_id\": 1}} {\"num\": 1} {\"index\": {\"_id\": 2}} {\"num\": 3} {\"index\": {\"_id\": 3}} {\"num\": 5} {\"index\": {\"_id\": 4}} {\"num\": 10} {\"index\": {\"_id\": 5}} {\"num\": 80} 搜索 GET /histogram_test/_search?size=0 { \"aggs\": { // 自定义聚合的名字 \"num_aggs\": { // 聚合方式 \"histogram\": { // 聚合的字段 \"field\": \"num\", // 间隔 \"interval\": 5, } } } } 返回结果： \"aggregations\" : { \"num_aggs\" : { \"buckets\" : [ { \"key\" : 0.0, \"doc_count\" : 3 }, { \"key\" : 10.0, \"doc_count\" : 1 }, { \"key\" : 20.0, \"doc_count\" : 0 }, { \"key\" : 30.0, \"doc_count\" : 0 }, { \"key\" : 40.0, \"doc_count\" : 0 }, { \"key\" : 50.0, \"doc_count\" : 0 }, { \"key\" : 60.0, \"doc_count\" : 0 }, { \"key\" : 70.0, \"doc_count\" : 0 }, { \"key\" : 80.0, \"doc_count\" : 1 } ] } } 我们看到返回了很多 doc_count 为0的数据。可以通过设置 min_doc_count 来过滤掉doc_count 为0的数据。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # 搜索 GET /histogram_test/_search?size=0 { \"aggs\": { \"num_aggs\": { \"histogram\": { \"field\": \"num\", \"interval\": 10, \"min_doc_count\": 1 } } } } 返回结果： \"aggregations\" : { \"num_aggs\" : { \"buckets\" : [ { // 0到10之间有3个文档 \"key\" : 0.0, \"doc_count\" : 3 }, { // 10到20之间有1个文档 \"key\" : 10.0, \"doc_count\" : 1 }, { // 80到90之间有1个文档 \"key\" : 80.0, \"doc_count\" : 1 } ] } } 正常返回的数据如上面所示，是按照数组的方式返回。如果要按照名字返回，可以设置keyed为true。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 搜索 GET /histogram_test/_search?size=0 { \"aggs\": { \"num_aggs\": { \"histogram\": { \"field\": \"num\", \"interval\": 10, \"min_doc_count\": 1, \"keyed\": true } } } } 返回结果 \"aggregations\" : { \"num_aggs\" : { \"buckets\" : { \"0.0\" : { \"key\" : 0.0, \"doc_count\" : 3 }, \"10.0\" : { \"key\" : 10.0, \"doc_count\" : 1 }, \"80.0\" : { \"key\" : 80.0, \"doc_count\" : 1 } } } } Date histogram 日期直方图聚合 场景：按固定日期间隔将文档分类（根据date字段 或 date range 字段） 字段：\ncalender_interval：日期间隔。如：minute（1m）、hour（1h）、day（1d） fixed_interval：固定时间间隔，如：ms、s、m、h、d format：格式化返回的时间字符串 time_zone：时区，如：+8:00 offset：时间偏移量，如：+1d keyed：更改返回格式，将key作为键返回 min_doc_count：不返回 doc_count 小于该值的存储桶 missing：默认值，如果字段没有值，以该参数填充 extended_bounds：指定返回的doc_count范围 示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 删除 DELETE /date_histogram_test 创建索引 PUT /date_histogram_test { \"mappings\": { \"properties\": { \"date\": {\"type\": \"date\"} } } } 索引数据 POST /date_histogram_test/_bulk?routing=1\u0026refresh {\"index\": {\"_id\": 1}} {\"date\": \"2021-09-29\"} {\"index\": {\"_id\": 2}} {\"date\": \"2021-09-28\"} {\"index\": {\"_id\": 3}} {\"date\": \"2021-09-27\"} {\"index\": {\"_id\": 4}} {\"date\": \"2021-09-30\"} {\"index\": {\"_id\": 5}} {\"date\": null} 搜索 - missing要与format的格式一致 GET /date_histogram_test/_search { \"size\": 0, \"aggs\": { \"date_aggs\": { \"date_histogram\": { \"field\": \"date\", \"calendar_interval\": \"day\", \"format\": \"yyyy-MM-dd\", \"keyed\": true, \"missing\": \"2021-09-30\", \"order\": {\"_key\": \"desc\"}, \"time_zone\": \"+08:00\" } } } } 结果 \"aggregations\" : { \"date_aggs\" : { \"buckets\" : { \"2021-09-30\" : { \"key_as_string\" : \"2021-09-30\", \"key\" : 1632931200000, \"doc_count\" : 2 }, \"2021-09-29\" : { \"key_as_string\" : \"2021-09-29\", \"key\" : 1632844800000, \"doc_count\" : 1 }, \"2021-09-28\" : { \"key_as_string\" : \"2021-09-28\", \"key\" : 1632758400000, \"doc_count\" : 1 }, \"2021-09-27\" : { \"key_as_string\" : \"2021-09-27\", \"key\" : 1632672000000, \"doc_count\" : 1 } } } } # 搜索 - missing要与format的格式一致 GET /date_histogram_test/_search { \"size\": 0, \"aggs\": { \"date_aggs\": { \"date_histogram\": { \"field\": \"date\", \"fixed_interval\": \"2d\", \"format\": \"yyyy-MM-dd\", \"keyed\": true, \"missing\": \"2021-09-30\", \"order\": {\"_count\": \"desc\"}, \"offset\": \"+1d\" } } } } 结果 \"aggregations\" : { \"date_aggs\" : { \"buckets\" : { \"2021-09-29\" : { \"key_as_string\" : \"2021-09-29\", \"key\" : 1632873600000, \"doc_count\" : 3 }, \"2021-09-27\" : { \"key_as_string\" : \"2021-09-27\", \"key\" : 1632700800000, \"doc_count\" : 2 } } } } Auto-interval Date Histogram 自动间隔日期直方图聚合 场景：和日期直方图类似，不同点是可以指定返回的结果数。 参数： buckets：指定返回的存储桶数（返回的结果会\u003c=该值） 不支持的参数： min_doc_count、extened_bounds、order。 其他参数和日期直方图一致。\nrange 范围聚合 场景：用户自定义范围聚合。 参数：\nfield：要聚合的字段 keyed：更改返回格式，将key作为键返回 scipt：脚本 ranges：范围，包括from的值，不包括to的值，即左闭右开。 示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 # 删除 DELETE /range_test # 映射 PUT /range_test { \"mappings\": { \"properties\": { \"num\": {\"type\": \"integer\"} } } } # 索引 POST /range_test/_bulk?routing=1\u0026refresh {\"index\": {\"_id\": 1}} {\"num\": 18} {\"index\": {\"_id\": 2}} {\"num\": 19} {\"index\": {\"_id\": 3}} {\"num\": 78} {\"index\": {\"_id\": 4}} {\"num\": 75} # 搜索 GET /range_test/_search?size=0 { \"aggs\": { \"range_aggs\": { \"range\": { \"field\": \"num\", \"keyed\": true, \"ranges\": [ { \"from\": 10, \"to\": 20 }, { \"from\": 50, \"to\": 100 } ] }, \"aggs\": { \"num_stats_aggs\": { \"stats\": { \"field\": \"num\" } } } } } } # 结果 { \"took\" : 2, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 4, \"relation\" : \"eq\" }, \"max_score\" : null, \"hits\" : [ ] }, \"aggregations\" : { \"range_aggs\" : { \"buckets\" : { \"10.0-20.0\" : { \"from\" : 10.0, \"to\" : 20.0, \"doc_count\" : 2, \"num_stats_aggs\" : { \"count\" : 2, \"min\" : 18.0, \"max\" : 19.0, \"avg\" : 18.5, \"sum\" : 37.0 } }, \"50.0-100.0\" : { \"from\" : 50.0, \"to\" : 100.0, \"doc_count\" : 2, \"num_stats_aggs\" : { \"count\" : 2, \"min\" : 75.0, \"max\" : 78.0, \"avg\" : 76.5, \"sum\" : 153.0 } } } } } } Date Range 日期范围聚合 场景：data类型的范围聚合。 参数：\nfield：要聚合的字段 format：时间格式 missing：缺省值 time_zone：时区，如UTC keyed：更改返回格式，将key作为键返回 ranges：范围，包括from的值，不包括to的值，即左闭右开。 示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 # 删除 DELETE /date_range_test # 映射 PUT /date_range_test { \"mappings\": { \"properties\": { \"date\": {\"type\": \"date\"} } } } # 索引 POST /date_range_test/_bulk?routing=1\u0026refresh {\"index\": {\"_id\": 1}} {\"date\": \"2021-09-29\"} {\"index\": {\"_id\": 2}} {\"date\": \"2021-09-28\"} {\"index\": {\"_id\": 3}} {\"date\": \"2021-09-27\"} {\"index\": {\"_id\": 4}} {\"date\": \"2021-09-30\"} {\"index\": {\"_id\": 5}} {\"date\": null} # 搜索 - missing要与format的格式一致 GET /date_range_test/_search { \"size\": 0, \"aggs\": { \"date_aggs\": { \"date_range\": { \"field\": \"date\", \"format\": \"yyyy-MM-dd\", \"keyed\": true, \"missing\": \"2021-09-30\", \"time_zone\": \"UTC\", \"ranges\": [ { \"key\": \"r_1\", \"from\": \"2021-09-27\", \"to\": \"2021-09-28\" }, { \"key\": \"r_2\", \"from\": \"2021-09-28\", \"to\": \"2021-09-30\" }, { \"key\": \"r_3\", \"from\": \"2021-09-30\", \"to\": \"now/d\" } ] } } } } # 结果 { \"took\" : 7, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 5, \"relation\" : \"eq\" }, \"max_score\" : null, \"hits\" : [ ] }, \"aggregations\" : { \"date_aggs\" : { \"buckets\" : { \"r_1\" : { \"from\" : 1.6327008E12, \"from_as_string\" : \"2021-09-27\", \"to\" : 1.6327872E12, \"to_as_string\" : \"2021-09-28\", \"doc_count\" : 1 }, \"r_2\" : { \"from\" : 1.6327872E12, \"from_as_string\" : \"2021-09-28\", \"to\" : 1.63296E12, \"to_as_string\" : \"2021-09-30\", \"doc_count\" : 2 }, \"r_3\" : { \"from\" : 1.63296E12, \"from_as_string\" : \"2021-09-30\", \"to\" : 1.6337376E12, \"to_as_string\" : \"2021-10-09\", \"doc_count\" : 2 } } } } } IP Range IP范围聚合 场景：指定IP范围聚合。 参数：\nfield：要聚合的字段。 keyed：显示键 ranges：from（从）-to（到），key：键的名字 示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 # 删除 DELETE /ip_range_test # 映射 PUT /ip_range_test { \"mappings\": { \"properties\": { \"ip\": {\"type\": \"ip\"} } } } # 索引 POST /ip_range_test/_bulk?routing=1\u0026refresh {\"index\": {\"_id\": 1}} {\"ip\": \"192.168.2.8\"} {\"index\": {\"_id\": 2}} {\"ip\": \"192.168.2.78\"} {\"index\": {\"_id\": 3}} {\"ip\": \"192.168.2.38\"} {\"index\": {\"_id\": 4}} {\"ip\": \"192.168.2.58\"} {\"index\": {\"_id\": 5}} {\"ip\": \"192.168.2.88\"} # 搜索 GET /ip_range_test/_search?size=0 { \"aggs\": { \"ip_range_aggs\": { \"ip_range\": { \"field\": \"ip\", \"ranges\": [ { \"to\": \"192.168.2.10\" }, { \"from\": \"192.168.2.37\", \"to\": \"192.168.2.59\" }, { \"from\": \"192.168.2.60\" } ] } } } } # 结果 { \"took\" : 1, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 5, \"relation\" : \"eq\" }, \"max_score\" : null, \"hits\" : [ ] }, \"aggregations\" : { \"ip_range_aggs\" : { \"buckets\" : [ { \"key\" : \"*-192.168.2.10\", \"to\" : \"192.168.2.10\", \"doc_count\" : 1 }, { \"key\" : \"192.168.2.37-192.168.2.59\", \"from\" : \"192.168.2.37\", \"to\" : \"192.168.2.59\", \"doc_count\" : 2 }, { \"key\" : \"192.168.2.60-*\", \"from\" : \"192.168.2.60\", \"doc_count\" : 2 } ] } } } Composite 复合聚合 场景：组合分组统计。\n示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 # 删除 DELETE /composite_test # 映射 PUT /composite_test { \"mappings\": { \"properties\": { \"name\": {\"type\": \"keyword\"}, \"num\": {\"type\": \"integer\"}, \"date\": {\"type\": \"date\"} } } } # 索引 POST /composite_test/_bulk?routing=1\u0026refresh {\"index\": {\"_id\": 1}} {\"name\": \"hello\", \"num\": 3, \"date\": \"2021-09-29\"} {\"index\": {\"_id\": 2}} {\"name\": \"good\", \"num\": 5, \"date\": \"2020-09-29\"} {\"index\": {\"_id\": 3}} {\"name\": \"me\", \"num\": 5, \"date\": \"2024-09-29\"} {\"index\": {\"_id\": 4}} {\"name\": \"hello\", \"num\": 7, \"date\": \"2024-09-29\"} # 搜索 GET /composite_test/_search { \"size\": 0, \"aggs\": { \"com_aggs\": { \"composite\": { \"sources\": [ { \"names\": { \"terms\": { \"field\": \"name\" } } } ] } } } } # 结果 { \"took\" : 0, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 4, \"relation\" : \"eq\" }, \"max_score\" : null, \"hits\" : [ ] }, \"aggregations\" : { \"com_aggs\" : { \"after_key\" : { \"names\" : \"me\" }, \"buckets\" : [ { \"key\" : { \"names\" : \"good\" }, \"doc_count\" : 1 }, { \"key\" : { \"names\" : \"hello\" }, \"doc_count\" : 2 }, { \"key\" : { \"names\" : \"me\" }, \"doc_count\" : 1 } ] } } } # 搜索 GET /composite_test/_search { \"size\": 0, \"aggs\": { \"com_aggs\": { \"composite\": { \"sources\": [ { \"nums\": { \"histogram\": { \"field\": \"num\", \"interval\": 2 } } } ] } } } } # 结果 { \"took\" : 1, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 4, \"relation\" : \"eq\" }, \"max_score\" : null, \"hits\" : [ ] }, \"aggregations\" : { \"com_aggs\" : { \"after_key\" : { \"nums\" : 6.0 }, \"buckets\" : [ { \"key\" : { \"nums\" : 2.0 }, \"doc_count\" : 1 }, { \"key\" : { \"nums\" : 4.0 }, \"doc_count\" : 2 }, { \"key\" : { \"nums\" : 6.0 }, \"doc_count\" : 1 } ] } } } # 搜索 GET /composite_test/_search { \"size\": 0, \"aggs\": { \"com_aggs\": { \"composite\": { \"sources\": [ { \"dates\": { \"date_histogram\": { \"field\": \"date\", \"calendar_interval\": \"1d\", \"format\": \"yyyy-MM-dd\" } } } ] } } } } # 结果 { \"took\" : 1, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 4, \"relation\" : \"eq\" }, \"max_score\" : null, \"hits\" : [ ] }, \"aggregations\" : { \"com_aggs\" : { \"after_key\" : { \"dates\" : \"2024-09-29\" }, \"buckets\" : [ { \"key\" : { \"dates\" : \"2020-09-29\" }, \"doc_count\" : 1 }, { \"key\" : { \"dates\" : \"2021-09-29\" }, \"doc_count\" : 1 }, { \"key\" : { \"dates\" : \"2024-09-29\" }, \"doc_count\" : 2 } ] } } } # 搜索 - 组合统计 GET /composite_test/_search { \"size\": 0, \"aggs\": { \"com_aggs\": { \"composite\": { \"sources\": [ { \"names\": { \"terms\": { \"field\": \"name\" } } },{ \"nums\": { \"histogram\": { \"field\": \"num\", \"interval\": 2 } } },{ \"dates\": { \"date_histogram\": { \"field\": \"date\", \"calendar_interval\": \"1d\", \"format\": \"yyyy-MM-dd\" } } } ] } } } } # 结果 { \"took\" : 1, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 4, \"relation\" : \"eq\" }, \"max_score\" : null, \"hits\" : [ ] }, \"aggregations\" : { \"com_aggs\" : { \"after_key\" : { \"names\" : \"me\", \"nums\" : 4.0, \"dates\" : \"2024-09-29\" }, \"buckets\" : [ { \"key\" : { \"names\" : \"good\", \"nums\" : 4.0, \"dates\" : \"2020-09-29\" }, \"doc_count\" : 1 }, { \"key\" : { \"names\" : \"hello\", \"nums\" : 2.0, \"dates\" : \"2021-09-29\" }, \"doc_count\" : 1 }, { \"key\" : { \"names\" : \"hello\", \"nums\" : 6.0, \"dates\" : \"2024-09-29\" }, \"doc_count\" : 1 }, { \"key\" : { \"names\" : \"me\", \"nums\" : 4.0, \"dates\" : \"2024-09-29\" }, \"doc_count\" : 1 } ] } } } missing 缺少聚合 场景：获取指定字段没有值或配置为null的文档数 等价sql：select count(*) from table_a where name is null\n示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 # 删除 DELETE /missing_test # 映射 PUT /missing_test { \"mappings\": { \"properties\": { \"name\": {\"type\": \"keyword\"} } } } # 索引 POST /missing_test/_bulk?routing=1\u0026refresh {\"index\": {\"_id\": 1}} {\"name\": \"hello\"} {\"index\": {\"_id\": 2}} {\"name\": \"good\"} {\"index\": {\"_id\": 3}} {\"name\": \"me\"} {\"index\": {\"_id\": 4}} {\"name\": null} {\"index\": {\"_id\": 5}} {\"name\": null} # 搜索 GET /missing_test/_search?size=0 { \"aggs\": { \"missing_aggs\": { \"missing\": { \"field\": \"name\" } } } } # 结果 { \"took\" : 2, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 5, \"relation\" : \"eq\" }, \"max_score\" : null, \"hits\" : [ ] }, \"aggregations\" : { \"missing_aggs\" : { \"doc_count\" : 2 } } } Metrics Agg 指标聚合 Metrics Aggregations 指标聚合，就是一些数学运算，对文档字段进行统计分析，类似于 sql 的 COUNT() 、 SUM() 、 MAX() 等统计方法。\navg、max、min、sum 平均、最大、最小、总和。\navg示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 POST exams/_search?size = 0 { \"aggs\": { \"avg_grade\": { \"avg\": { \"field\": \"grade\" } } } } 结果： { ... \"aggregations\": { \"avg_grade\": { \"value\": 75.0 } } } Value Count 计数聚合 统计字段不为空的文档数。 等价sql：select count(*) from table_a where name is not null\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 POST sales/_search?size = 0 { \"aggs\": { \"types_count\": { \"value_count\": { \"field\": \"type\" } } } } 结果 { ... \"aggregations\": { \"types_count\": { \"value\": 7 } } } Stats 统计聚合 返回的结果包括：min、max、sun、avg、count。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 POST/exams/_search?size=0 { \"aggs\": { \"grades_stats\": { \"stats\": { \"field\": \"grade\" } } } } 结果 { ... \"aggregations\": { \"grades_stats\": { \"count\": 2, \"min\": 50.0, \"max\": 100.0, \"avg\": 75.0, \"sum\": 150.0 } } } cardinality 基数聚合 计算字段有多少不同的值。 等价sql：select count(distinct age) from table\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 GET cars/_search { \"size\": 0, \"aggs\": { \"distinct_colors\": { \"cardinality\": { \"field\": \"color\" } } } } \"aggregations\": { \"distinct_colors\": { \"value\": 3 } } Pipeline Agg Rest APIs 参考官网 https://www.elastic.co/cn/\nRest一种软件架构风格，而不是标准，只是提供了一组设计原则和约束条件。它主要用于客户端和服务器交互类的软件。基于这个风格设计的软件可以更简洁，更有层次，更易于实现缓存等机制。\n我们可以使用任何能发送HTTP请求的客户端与ES进行交互。比如：curl、PostMan，Es-Head、Kibana等。\n集群操作 查集群健康 curl 'localhost:9200/_cat/health?v'\n得到的响应\n1 2 epoch timestamp cluster status node.total node.data shards pri relo init unassign 1394735289 14:28:09 elasticsearch green 1 1 0 0 0 0 0 cluster：集群名 status：集群的状态。有绿、黄、红，三种状态。 绿：集群功能齐全，一切正常。 黄：所有的数据都是可用的，但是某些复制没有被分配（集群功能齐全） 红：因为某些原因，某些数据不可用。注意，即使集群状态是红色的，集群仍然是部分可用的（它仍然会利用可用的分片来响应搜索请求），但是可能你需要尽快修复它，因为你有丢失的数据。\n查集群中的节点列表 curl 'localhost:9200/_cat/nodes?v'\n索引操作 创建索引 语法： PUT index_name\n创建一个索引：my-index curl -X PUT \"localhost:9200/my-index?pretty\"\n请求体\naliases：索引的别名 mappings：索引中字段的映射 settings：索引的设置 示例：\n1 2 3 4 5 6 7 8 9 10 11 12 PUT my_index/_mappings { \"properties\": { \"field1\": { \"type\": \"text\", \"analyzer\": \"ik_max_word\" }, \"field2\": { \"type\": \"keyword\" } } } 删除索引 语法：DELETE index_name\n删除一个索引： curl -X DELETE \"localhost:9200/my-index-000001?pretty\"\n获取索引 语法：GET index_name\ncurl -X GET \"localhost:9200/my-index-000001?pretty\"\n查所有索引 curl 'localhost:9200/_cat/indices?v'\n修改索引 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # 查看索引是否允许被修改 GET my_index/_settings { \"test_index\" : { \"settings\" : { \"index\" : { \"number_of_shards\" : \"1\", \"blocks\" : { \"read_only_allow_delete\" : \"true\" }, \"provided_name\" : \"test_index\", \"creation_date\" : \"1646452164709\", \"number_of_replicas\" : \"1\", \"uuid\" : \"7M9EvUSnRIuS_SWqk2I12A\", \"version\" : { \"created\" : \"7060199\" } } } } } 如果没有blocks字段，说明索引是可以修改的。如果有blocks字段，且是 true，那么需要改一下这个值，才能修改索引。\n1 2 3 4 PUT test_index/_settings { \"index.blocks.read_only_allow_delete\": null } 然后可以给索引新增字段：\n1 2 3 4 5 6 7 8 9 10 11 12 PUT test_index/_mappings { \"properties\": { \"field1\": { \"type\": \"text\", \"analyzer\": \"ik_max_word\" }, \"field2\": { \"type\": \"keyword\" } } } 这里新增了两个字段。 如果想修改已经有数据的字段，只能通过创建中间索引的方式参考这里 对于没有数据的字段，是可以直接修改的，修改方式和新增字段是一样的。如下\n1 2 3 4 5 6 7 8 9 PUT test_index/_mappings { \"properties\": { \"field1\": { \"type\": \"text\", \"analyzer\": \"ik_max_word\" } } } 给刚才新增的字段，添加一些数据\n1 2 3 4 5 6 PUT test_index/_doc/1 { \"field1\":\"字段1\", \"field2\":\"字段2\", \"field3\":\"字段3\" } 查看是否新增成功 GET test_index/_search\n文档操作 新增 想要创建文档，必须告诉ES，文档所属的index和type。 语法：PUT /{索引}/{类型}/{文档的id}\n1 2 3 4 curl -XPUT 'localhost:9200/my_index/_doc/1?pretty' -d ' { \"name\": \"wjy\" } 响应如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 { \"_index\" : \"my_index\", \"_type\" : \"_doc\", \"_id\" : \"1\", \"_version\" : 5, \"result\" : \"updated\", \"_shards\" : { \"total\" : 2, \"successful\" : 1, \"failed\" : 0 }, \"_seq_no\" : 4, \"_primary_term\" : 1 } 创建文档的时候，如果索引和类型不存在，es会自动创建索引和类型。不需要提前创建索引和类型。 ID部分是可选的。如果不指定id，Elasticsearch将为这个文档创建一个随机的ID。需要注意的是，如果不指定id，只能使用POST命令，PUT不可以。\n1 2 3 4 POST /my_index/_doc/ { \"name\":\"wjy\" } 现在，让我们查看刚才创建的文档： curl -XGET 'localhost:9200/my_index/_doc/1?pretty' 响应如下：\n1 2 3 4 5 6 7 8 9 10 11 12 { \"_index\" : \"my_index\", \"_type\" : \"_doc\", \"_id\" : \"1\", \"_version\" : 5, \"_seq_no\" : 4, \"_primary_term\" : 1, \"found\" : true, \"_source\" : { \"name\" : \"wjy\" } } 仔细研究上边的命令，我们可以发现 ES 命令的规则： curl -X :/// 这个REST访问模式普遍适用于所有的API命令，如果你能记住它，你就会为掌握Elasticsearch 开一个好头。\n更新 ES底层不支持更新文档，如果想要更新文档，ES 会先删除旧文档，然后再创建新文档。\n语法：/{index}/_update/{id}\n1 2 3 4 5 6 POST /my_index/_update/1 { \"doc\":{ \"name\":\"wm\" } } 还可以在局部更新的同时，给文档添加新的字段\n1 2 3 4 5 6 7 POST /my_index/_update/1/ { \"doc\": { \"name\": \"wm\", \"age\": 20 } } 还可以通过脚本更新数据，下面使用一个脚本将age加5\n1 2 3 4 POST /my_index/_update/1 { \"script\" : \"ctx._source.age += 5\" } ctx._source指向当前被更新的文档。\n条件更新文档\n1 2 3 4 5 6 7 8 9 10 11 POST zw_paper/_update_by_query { \"script\": { // 需要更新的字段 \"source\":\"ctx._source['provinceCode']=110000;\" }, \"query\": { // 你的条件，如果更新全部数据，就写match_all \"match_all\": {} } } 删除 删除id为1的文档\ncurl -XDELETE 'localhost:9200/my_index/_doc/1\n根据条件，删除多条文档\n1 2 3 4 5 6 7 8 POST /my-index-000001/_delete_by_query { \"query\": { \"match\": { \"user.id\": \"elkbee\" } } } 删除某个索引下的所有文档\n1 2 3 4 5 6 POST my-index-000001/_delete_by_query?conflicts=proceed { \"query\": { \"match_all\": {} } } 文档查询 文档查询是重中之重，所以单独拿出来说。\n根据id查 语法： GET {index}/_doc/{id}\n查询id为0的数据： GET my-index-000001/_doc/0\n返回如下结果：\n1 2 3 4 5 6 7 8 9 10 11 12 13 { \"_index\" : \"my_index\", \"_type\" : \"_doc\", \"_id\" : \"1\", \"_version\" : 26, \"_seq_no\" : 160, \"_primary_term\" : 2, \"found\" : true, \"_source\" : { \"name\" : \"wjy\", \"age\" : 20 } } 只获取_source字段： GET my-index-000001/_source/1\n可以通过_source_includes控制_source返回的字段。 通过_source_excludes控制_source不返回的字段。\n判断数据是否存在 HEAD myIndex/_doc/1 如果存在，返回200，不存在返回404。\n分组 分组结果在es返回的最下边。\n1 2 3 4 5 6 7 8 9 10 11 GET zw_paper/_search { \"aggs\": { \"count\": { \"terms\": { // 如果字段是text类型，则必须加.keyword \"field\": \"paperTypeName.keyword\" } } } } es-java 规定es版本\n1 2 3 4 5 1.8 7.16.1 引入es\n1 2 3 4 org.springframework.boot spring-boot-starter-data-elasticsearch 编写配置类\n1 2 3 4 5 6 7 8 9 10 11 12 13 @Configuration public class ElasticSearchConfig { // 注册 rest高级客户端 @Bean public RestHighLevelClient restHighLevelClient(){ RestHighLevelClient client = new RestHighLevelClient( RestClient.builder( new HttpHost(\"127.0.0.1\",9200,\"http\") ) ); return client; } } 实体类\n1 2 3 4 5 6 7 @Data @NoArgsConstructor @AllArgsConstructor public class User implements Serializable { private String name; private Integer age; } 在测试类中注入es客户端：\n1 2 @Autowired public RestHighLevelClient restHighLevelClient; Index APIs 创建index 1 2 3 4 5 6 7 8 @Test public void testCreateIndex() throws IOException { CreateIndexRequest request = new CreateIndexRequest(\"wjy_index\"); CreateIndexResponse response = restHighLevelClient.indices().create(request,RequestOptions.DEFAULT); System.out.println(response.isAcknowledged());// 是否创建成功 System.out.println(response);// 返回对象 restHighLevelClient.close(); } 删除index 1 2 3 4 5 6 7 @Test public void testDeleteIndex() throws IOException { DeleteIndexRequest request = new DeleteIndexRequest(\"wjy_index\"); AcknowledgedResponse response = restHighLevelClient.indices().delete(request, RequestOptions.DEFAULT); System.out.println(response.isAcknowledged());// 是否删除成功 restHighLevelClient.close(); } 判断index是否存在 1 2 3 4 5 6 public void testIndexIsExists() throws IOException { GetIndexRequest request = new GetIndexRequest(\"wjy_index\"); boolean exists = restHighLevelClient.indices().exists(request, RequestOptions.DEFAULT); System.out.println(exists);// 索引是否存在 restHighLevelClient.close(); } Document APIs 创建文档 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Test public void testAddDocument() throws IOException { // 创建一个User对象 User user = new User(\"wjy\", 18); // 创建请求 IndexRequest request = new IndexRequest(\"wjy_index\"); // 制定规则 PUT /wjy_index/_doc/1 // 设置文档ID request.id(\"1\"); // 将数据放入请求中 request.source(JacksonUtils.objectToJsonStr(user), XContentType.JSON); // 客户端发送请求，获取响应的结果 IndexResponse response = restHighLevelClient.index(request, RequestOptions.DEFAULT); System.out.println(response.status());// 获取建立索引的状态信息 System.out.println(response);// 查看返回内容 } 根据id获取文档 1 2 3 4 5 6 7 8 9 @Test public void testDocumentIsExists() throws IOException { GetRequest request = new GetRequest(\"liuyou_index\", \"1\"); // 不获取返回的 _source的上下文了 request.fetchSourceContext(new FetchSourceContext(false)); request.storedFields(\"_none_\"); boolean exists = restHighLevelClient.exists(request, RequestOptions.DEFAULT); System.out.println(exists); } 判断文档是否存在 1 2 3 4 5 6 @Test public void testDocumentIsExists() throws IOException { GetRequest request = new GetRequest(\"wjy_index\", \"1\"); boolean exists = restHighLevelClient.exists(request, RequestOptions.DEFAULT); System.out.println(exists); } 更新文档 1 2 3 4 5 6 7 8 9 10 @Test public void testUpdateDocument() throws IOException { User user = new User(\"wm\", 20); UpdateRequest request = new UpdateRequest(\"wjy_index\", \"1\"); request.doc(JacksonUtils.objectToJsonStr(user), XContentType.JSON); UpdateResponse response = client.update(request, RequestOptions.DEFAULT); System.out.println(response.status()); // OK client.close(); } 删除文档 1 2 3 4 5 6 @Test public void testDeleteDocument() throws IOException { DeleteRequest request = new DeleteRequest(\"wjy_index\", \"1\"); DeleteResponse response = client.delete(request, RequestOptions.DEFAULT); System.out.println(response.status());// OK } 条件查询 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 @Test public void testSearch() throws IOException { // 1.创建查询请求对象 SearchRequest searchRequest = new SearchRequest(); // 2.构建搜索条件 SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder(); // (1)使用QueryBuilders工具类创建 // 查询条件-精确查询 TermQueryBuilder termQueryBuilder = QueryBuilders.termQuery(\"name\", \"wjy\"); // 条件投入 searchSourceBuilder.query(termQueryBuilder); // (2)其他 // 设置高亮 searchSourceBuilder.highlighter(new HighlightBuilder()); // 分页 //searchSourceBuilder.from(); //searchSourceBuilder.size(); // 设置超时时间 searchSourceBuilder.timeout(new TimeValue(60, TimeUnit.SECONDS)); // 3.添加请求条件 searchRequest.source(searchSourceBuilder); // 4.客户端查询 SearchResponse search = client.search(searchRequest, RequestOptions.DEFAULT); // 5.查看返回结果 SearchHits hits = search.getHits(); System.out.println(JacksonUtils.objectToJsonStr(hits)); System.out.println(\"=======================\"); for (SearchHit i : hits.getHits()) { System.out.println(i.getSourceAsMap()); } } 批量新增文档 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @Test public void testBulk() throws IOException { BulkRequest bulkRequest = new BulkRequest(); bulkRequest.timeout(\"10s\"); ArrayList users = new ArrayList\u003c\u003e(); users.add(new User(\"wjy-1\", 1)); users.add(new User(\"wjy-2\", 2)); users.add(new User(\"wjy-3\", 3)); users.add(new User(\"wjy-4\", 4)); users.add(new User(\"wjy-5\", 5)); users.add(new User(\"wjy-6\", 6)); String indexName = \"bulk_index\"; for (int i = 0; i \u003c users.size(); i++) { bulkRequest.add( // 这里是数据信息 new IndexRequest(indexName) .id(\"\" + (i + 1)) // 没有设置id 会自定生成一个随机id .source(JacksonUtils.objectToJsonStr(users.get(i)), XContentType.JSON) ); } //批量插入 BulkResponse bulk = client.bulk(bulkRequest, RequestOptions.DEFAULT); System.out.println(bulk.status()); } 其他 修改索引的mapping 修改索引的mapping\nhttps://www.cnblogs.com/Ace-suiyuan008/p/9985249.html es不能直接修改索引类型，需要通过下面的流程修改索引：\n创建中间索引 PUT index_new\n查旧索引的mapping： GET my_index/_mapping\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 { \"zw_paper\": { \"mappings\": { \"properties\": { \"approveStatus\": { \"type\": \"long\" }, \"approveTime\": { \"type\": \"long\" }, \"approver\": { \"type\": \"text\", \"fields\": { \"keyword\": { \"type\": \"keyword\", \"ignore_above\": 256 } } } } } } } 给中间索引设置mapping 根据刚才查的旧索引的mapping，修改需要修改的字段。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 POST index_new/_mapping { \"properties\": { \"approveStatus\": { \"type\": \"long\" }, \"approveTime\": { \"type\": \"long\" }, \"approver\": { \"type\": \"text\", \"fields\": { \"keyword\": { \"type\": \"keyword\", \"ignore_above\": 256 } } } } } 将旧索引的数据复制到中间索引 1 2 3 4 5 6 7 8 9 10 # 将旧索引的数据copy到新索引 POST _reindex { \"source\": { \"index\": \"my_index\" }, \"dest\": { \"index\": \"index_new\" } } 检查数据是否复制成功 GET /index_new/_doc/_search\n删除有问题的索引 DELETE my_index\n重新创建同名的索引(★字段类型修改正确★) PUT my_index\n给新索引设置mapping\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 POST my_index/_mapping { \"properties\": { \"approveStatus\": { \"type\": \"long\" }, \"approveTime\": { \"type\": \"long\" }, \"approver\": { \"type\": \"text\", \"fields\": { \"keyword\": { \"type\": \"keyword\", \"ignore_above\": 256 } } } } } 将中间索引的数据复制到重建的索引 1 2 3 4 5 6 7 8 9 10 # 将中间索引的数据复制到重建的索引 POST _reindex { \"source\": { \"index\": \"index_new\" }, \"dest\": { \"index\": \"my_index\" } } 删除中间索引 DELETE index_new 了解ELK ELK是Elasticsearch、Logstash、 Kibana三大开源框架首字母大写简称。市面上也被成为Elastic Stack。 其中Elasticsearch是一个基于Lucene、分布式、通过Restful方式进行交互的近实时搜索平台框架。 像类似百度、谷歌这种大数据全文搜索引擎的场景都可以使用Elasticsearch作为底层支持框架，可见Elasticsearch提供的搜索能力确实强大，市面上很多时候我们简称Elasticsearch为es。 Logstash是ELK的中央数据流引擎，用于从不同目标(文件/数据存储/MQ )收集的不同格式数据，经过过滤后支持输出到不同目的地(文件/MQ/redis/elasticsearch/kafka等)。 Kibana可以将elasticsearch的数据通过友好的页面展示出来，提供实时分析的功能。 市面上很多开发只要提到ELK能够一致说出它是一个日志分析架构技术栈总称，但实际上ELK不仅仅适用于日志分析，它还可以支持其它任何数据分析和收集的场景，日志分析和收集只是更具有代表性，并非唯一性。 收集清洗数据(Logstash) ==\u003e 搜索、存储(ElasticSearch) ==\u003e 展示(Kibana)\n",
  "wordCount" : "39677",
  "inLanguage": "en",
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://funny-toffee-4aa7c3.netlify.app/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/es/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://funny-toffee-4aa7c3.netlify.app/favicon.ico"
    }
  }
}
</script>

  <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml-full.min.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath:  [['\\(', '\\)'], ['$', '$']],  
    }
  };
</script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://funny-toffee-4aa7c3.netlify.app/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://funny-toffee-4aa7c3.netlify.app/">Home</a>&nbsp;»&nbsp;<a href="https://funny-toffee-4aa7c3.netlify.app/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      es
    </h1>
    <div class="post-meta">Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85" aria-label="安装">安装</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-%e4%b8%ad%e6%96%87%e5%88%86%e8%af%8d%e5%99%a8ik" aria-label="安装 中文分词器IK">安装 中文分词器IK</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-es" aria-label="安装 es">安装 es</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-elasticsearch-head%e5%b7%b2%e4%b8%8d%e5%86%8d%e7%bb%b4%e6%8a%a4" aria-label="安装 elasticsearch-head（已不再维护）">安装 elasticsearch-head（已不再维护）</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-kibana" aria-label="安装 kibana">安装 kibana</a></li></ul>
                </li>
                <li>
                    <a href="#es%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5" aria-label="es基本概念">es基本概念</a><ul>
                        
                <li>
                    <a href="#index%e7%b4%a2%e5%bc%95" aria-label="Index（索引）">Index（索引）</a></li>
                <li>
                    <a href="#type%e7%b1%bb%e5%9e%8b" aria-label="Type（类型）">Type（类型）</a></li>
                <li>
                    <a href="#document%e6%96%87%e6%a1%a3" aria-label="Document（文档）">Document（文档）</a></li>
                <li>
                    <a href="#%e5%80%92%e6%8e%92%e7%b4%a2%e5%bc%95" aria-label="倒排索引">倒排索引</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%88%86%e8%af%8d" aria-label="分词">分词</a><ul>
                        
                <li>
                    <a href="#ik_max_word" aria-label="ik_max_word">ik_max_word</a></li>
                <li>
                    <a href="#ik_smart" aria-label="ik_smart">ik_smart</a></li></ul>
                </li>
                <li>
                    <a href="#es%e9%9b%86%e7%be%a4%e6%a6%82%e5%bf%b5" aria-label="ES集群概念">ES集群概念</a><ul>
                        
                <li>
                    <a href="#%e8%8a%82%e7%82%b9node" aria-label="节点（node）">节点（node）</a></li>
                <li>
                    <a href="#%e9%9b%86%e7%be%a4cluster" aria-label="集群（cluster）">集群（cluster）</a></li>
                <li>
                    <a href="#%e5%88%86%e7%89%87shard" aria-label="分片（shard）">分片（shard）</a></li>
                <li>
                    <a href="#%e5%a4%8d%e5%88%b6%e5%88%86%e7%89%87replica-shard" aria-label="复制分片（replica shard）">复制分片（replica shard）</a></li></ul>
                </li>
                <li>
                    <a href="#es%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b" aria-label="es数据类型">es数据类型</a><ul>
                        
                <li>
                    <a href="#keyword" aria-label="keyword">keyword</a></li>
                <li>
                    <a href="#text" aria-label="text">text</a></li>
                <li>
                    <a href="#numeric" aria-label="numeric">numeric</a></li>
                <li>
                    <a href="#range" aria-label="range">range</a></li>
                <li>
                    <a href="#array" aria-label="array">array</a></li>
                <li>
                    <a href="#object" aria-label="object">object</a></li>
                <li>
                    <a href="#nested%e5%b5%8c%e5%a5%97%e7%9a%84" aria-label="nested（嵌套的）">nested（嵌套的）</a></li>
                <li>
                    <a href="#binary" aria-label="binary">binary</a></li>
                <li>
                    <a href="#boolean" aria-label="boolean">boolean</a></li>
                <li>
                    <a href="#date" aria-label="date">date</a></li></ul>
                </li>
                <li>
                    <a href="#dsl%e8%af%ad%e6%b3%95" aria-label="DSL语法">DSL语法</a><ul>
                        
                <li>
                    <a href="#%e6%9f%a5%e8%af%a2%e5%92%8c%e8%bf%87%e6%bb%a4%e4%b8%8a%e4%b8%8b%e6%96%87" aria-label="查询和过滤上下文">查询和过滤上下文</a><ul>
                        
                <li>
                    <a href="#%e7%9b%b8%e5%85%b3%e6%80%a7%e8%af%84%e5%88%86" aria-label="相关性评分">相关性评分</a></li>
                <li>
                    <a href="#query-context-%e6%9f%a5%e8%af%a2%e4%b8%8a%e4%b8%8b%e6%96%87" aria-label="Query context 查询上下文">Query context 查询上下文</a></li>
                <li>
                    <a href="#filter-context-%e8%bf%87%e6%bb%a4%e4%b8%8a%e4%b8%8b%e6%96%87" aria-label="Filter context 过滤上下文">Filter context 过滤上下文</a></li></ul>
                </li>
                <li>
                    <a href="#match_all" aria-label="match_all">match_all</a></li>
                <li>
                    <a href="#%e5%a4%8d%e5%90%88%e6%9f%a5%e8%af%a2" aria-label="复合查询">复合查询</a><ul>
                        
                <li>
                    <a href="#bool-query" aria-label="bool query">bool query</a></li>
                <li>
                    <a href="#bool-query-%e7%a4%ba%e4%be%8b" aria-label="bool query 示例">bool query 示例</a></li>
                <li>
                    <a href="#filter%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="filter的使用">filter的使用</a></li>
                <li>
                    <a href="#must-%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="must 的使用">must 的使用</a></li>
                <li>
                    <a href="#must_not-%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="must_not 的使用">must_not 的使用</a></li>
                <li>
                    <a href="#should-%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="should 的使用">should 的使用</a></li>
                <li>
                    <a href="#should-%e7%9a%84%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" aria-label="should 的注意事项">should 的注意事项</a></li>
                <li>
                    <a href="#minimum_should_match-%e5%8f%82%e6%95%b0%e5%80%bc%e8%af%b4%e6%98%8e" aria-label="minimum_should_match 参数值说明">minimum_should_match 参数值说明</a></li></ul>
                </li>
                <li>
                    <a href="#full-text-query-%e5%85%a8%e6%96%87%e6%a3%80%e7%b4%a2" aria-label="full text query 全文检索">full text query 全文检索</a><ul>
                        
                <li>
                    <a href="#match-query" aria-label="match query">match query</a></li>
                <li>
                    <a href="#match-phrase-query" aria-label="Match phrase query">Match phrase query</a></li>
                <li>
                    <a href="#match_phrase_prefix" aria-label="match_phrase_prefix">match_phrase_prefix</a></li>
                <li>
                    <a href="#multi_match" aria-label="multi_match">multi_match</a></li>
                <li>
                    <a href="#query_string" aria-label="query_string">query_string</a></li>
                <li>
                    <a href="#simple_query_string" aria-label="simple_query_string">simple_query_string</a></li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="总结">总结</a></li></ul>
                </li>
                <li>
                    <a href="#term-level-queries-%e6%9c%af%e8%af%ad%e6%9f%a5%e8%af%a2" aria-label="Term-level queries 术语查询">Term-level queries 术语查询</a><ul>
                        
                <li>
                    <a href="#term" aria-label="term">term</a></li>
                <li>
                    <a href="#terms" aria-label="terms">terms</a></li>
                <li>
                    <a href="#terms-set" aria-label="terms set">terms set</a></li>
                <li>
                    <a href="#range-1" aria-label="range">range</a></li>
                <li>
                    <a href="#rangedate%e7%b1%bb%e5%9e%8b" aria-label="range（date类型）">range（date类型）</a><ul>
                        
                <li>
                    <a href="#date-math-to-round" aria-label="date math to round">date math to round</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e6%97%a5%e6%9c%9f%e5%87%bd%e6%95%b0%e8%bf%9b%e8%a1%8c%e6%a3%80%e7%b4%a2" aria-label="使用日期函数进行检索">使用日期函数进行检索</a></li>
                <li>
                    <a href="#%e6%97%a5%e6%9c%9f%e6%a0%bc%e5%bc%8f" aria-label="日期格式">日期格式</a></li>
                <li>
                    <a href="#%e5%af%b9%e7%b1%bb%e5%9e%8b%e4%b8%ba-range-%e5%ad%97%e6%ae%b5%e7%9a%84%e6%9f%a5%e8%af%a2" aria-label="对类型为 range 字段的查询">对类型为 range 字段的查询</a></li></ul>
                </li>
                <li>
                    <a href="#exists" aria-label="exists">exists</a></li>
                <li>
                    <a href="#perfix" aria-label="perfix">perfix</a></li>
                <li>
                    <a href="#wildcard" aria-label="wildcard">wildcard</a></li>
                <li>
                    <a href="#regexp" aria-label="regexp">regexp</a></li>
                <li>
                    <a href="#fuzzy" aria-label="fuzzy">fuzzy</a></li>
                <li>
                    <a href="#ids" aria-label="ids">ids</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#mapping-%e8%ae%be%e7%bd%ae%e6%8c%87%e5%8d%97" aria-label="mapping 设置指南">mapping 设置指南</a><ul>
                        
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%af-mapping" aria-label="什么是 mapping？">什么是 mapping？</a></li>
                <li>
                    <a href="#%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae" aria-label="基础配置">基础配置</a></li>
                <li>
                    <a href="#%e5%88%86%e8%af%8d%e9%85%8d%e7%bd%ae" aria-label="分词配置">分词配置</a><ul>
                        
                <li>
                    <a href="#fields" aria-label="fields">fields</a></li>
                <li>
                    <a href="#analyzer" aria-label="analyzer">analyzer</a></li>
                <li>
                    <a href="#search_analyzer" aria-label="search_analyzer">search_analyzer</a></li>
                <li>
                    <a href="#normalizer" aria-label="normalizer">normalizer</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%9b%b8%e5%85%b3%e6%80%a7%e9%85%8d%e7%bd%ae" aria-label="&ldquo;相关性&quot;配置">&ldquo;相关性&quot;配置</a><ul>
                        
                <li>
                    <a href="#boost" aria-label="boost">boost</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86%e9%85%8d%e7%bd%ae" aria-label="数据处理配置">数据处理配置</a><ul>
                        
                <li>
                    <a href="#dynamic" aria-label="dynamic">dynamic</a></li>
                <li>
                    <a href="#format" aria-label="format">format</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%80%a7%e8%83%bd%e9%85%8d%e7%bd%ae" aria-label="性能配置">性能配置</a><ul>
                        
                <li>
                    <a href="#enabled" aria-label="enabled">enabled</a></li>
                <li>
                    <a href="#doc_values" aria-label="doc_values">doc_values</a></li>
                <li>
                    <a href="#index" aria-label="index">index</a></li>
                <li>
                    <a href="#fielddata" aria-label="fielddata">fielddata</a></li>
                <li>
                    <a href="#store-%e4%b8%8e-_source-%e5%af%b9%e6%af%94" aria-label="store 与 _source 对比">store 与 _source 对比</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%8c%e6%95%b4%e7%a4%ba%e4%be%8b" aria-label="完整示例">完整示例</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%81%9a%e5%90%88" aria-label="聚合">聚合</a><ul>
                        
                <li>
                    <a href="#bucket-aggregations-%e6%a1%b6%e8%81%9a%e5%90%88" aria-label="Bucket Aggregations 桶聚合">Bucket Aggregations 桶聚合</a><ul>
                        
                <li>
                    <a href="#terms-%e6%9c%af%e8%af%ad%e8%81%9a%e5%90%88" aria-label="Terms 术语聚合">Terms 术语聚合</a></li>
                <li>
                    <a href="#rare-terms-%e7%a8%80%e6%9c%89%e6%9c%af%e8%af%ad%e8%81%9a%e5%90%88" aria-label="Rare Terms 稀有术语聚合">Rare Terms 稀有术语聚合</a></li>
                <li>
                    <a href="#histogram-%e7%9b%b4%e6%96%b9%e5%9b%be%e8%81%9a%e5%90%88" aria-label="Histogram 直方图聚合">Histogram 直方图聚合</a></li>
                <li>
                    <a href="#date-histogram-%e6%97%a5%e6%9c%9f%e7%9b%b4%e6%96%b9%e5%9b%be%e8%81%9a%e5%90%88" aria-label="Date histogram 日期直方图聚合">Date histogram 日期直方图聚合</a></li>
                <li>
                    <a href="#auto-interval-date-histogram-%e8%87%aa%e5%8a%a8%e9%97%b4%e9%9a%94%e6%97%a5%e6%9c%9f%e7%9b%b4%e6%96%b9%e5%9b%be%e8%81%9a%e5%90%88" aria-label="Auto-interval Date Histogram 自动间隔日期直方图聚合">Auto-interval Date Histogram 自动间隔日期直方图聚合</a></li>
                <li>
                    <a href="#range-%e8%8c%83%e5%9b%b4%e8%81%9a%e5%90%88" aria-label="range 范围聚合">range 范围聚合</a></li>
                <li>
                    <a href="#date-range-%e6%97%a5%e6%9c%9f%e8%8c%83%e5%9b%b4%e8%81%9a%e5%90%88" aria-label="Date Range 日期范围聚合">Date Range 日期范围聚合</a></li>
                <li>
                    <a href="#ip-range-ip%e8%8c%83%e5%9b%b4%e8%81%9a%e5%90%88" aria-label="IP Range IP范围聚合">IP Range IP范围聚合</a></li>
                <li>
                    <a href="#composite-%e5%a4%8d%e5%90%88%e8%81%9a%e5%90%88" aria-label="Composite 复合聚合">Composite 复合聚合</a></li>
                <li>
                    <a href="#missing-%e7%bc%ba%e5%b0%91%e8%81%9a%e5%90%88" aria-label="missing 缺少聚合">missing 缺少聚合</a></li></ul>
                </li>
                <li>
                    <a href="#metrics-agg-%e6%8c%87%e6%a0%87%e8%81%9a%e5%90%88" aria-label="Metrics Agg 指标聚合">Metrics Agg 指标聚合</a><ul>
                        
                <li>
                    <a href="#avgmaxminsum" aria-label="avg、max、min、sum">avg、max、min、sum</a></li>
                <li>
                    <a href="#value-count-%e8%ae%a1%e6%95%b0%e8%81%9a%e5%90%88" aria-label="Value Count 计数聚合">Value Count 计数聚合</a></li>
                <li>
                    <a href="#stats-%e7%bb%9f%e8%ae%a1%e8%81%9a%e5%90%88" aria-label="Stats 统计聚合">Stats 统计聚合</a></li>
                <li>
                    <a href="#cardinality-%e5%9f%ba%e6%95%b0%e8%81%9a%e5%90%88" aria-label="cardinality 基数聚合">cardinality 基数聚合</a></li></ul>
                </li>
                <li>
                    <a href="#pipeline-agg" aria-label="Pipeline Agg">Pipeline Agg</a></li></ul>
                </li>
                <li>
                    <a href="#rest-apis" aria-label="Rest APIs">Rest APIs</a><ul>
                        
                <li>
                    <a href="#%e9%9b%86%e7%be%a4%e6%93%8d%e4%bd%9c" aria-label="集群操作">集群操作</a><ul>
                        
                <li>
                    <a href="#%e6%9f%a5%e9%9b%86%e7%be%a4%e5%81%a5%e5%ba%b7" aria-label="查集群健康">查集群健康</a></li>
                <li>
                    <a href="#%e6%9f%a5%e9%9b%86%e7%be%a4%e4%b8%ad%e7%9a%84%e8%8a%82%e7%82%b9%e5%88%97%e8%a1%a8" aria-label="查集群中的节点列表">查集群中的节点列表</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e6%93%8d%e4%bd%9c" aria-label="索引操作">索引操作</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e7%b4%a2%e5%bc%95" aria-label="创建索引">创建索引</a></li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4%e7%b4%a2%e5%bc%95" aria-label="删除索引">删除索引</a></li>
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e7%b4%a2%e5%bc%95" aria-label="获取索引">获取索引</a></li>
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9%e7%b4%a2%e5%bc%95" aria-label="修改索引">修改索引</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%96%87%e6%a1%a3%e6%93%8d%e4%bd%9c" aria-label="文档操作">文档操作</a><ul>
                        
                <li>
                    <a href="#%e6%96%b0%e5%a2%9e" aria-label="新增">新增</a></li>
                <li>
                    <a href="#%e6%9b%b4%e6%96%b0" aria-label="更新">更新</a></li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4" aria-label="删除">删除</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%96%87%e6%a1%a3%e6%9f%a5%e8%af%a2" aria-label="文档查询">文档查询</a><ul>
                        
                <li>
                    <a href="#%e6%a0%b9%e6%8d%aeid%e6%9f%a5" aria-label="根据id查">根据id查</a></li>
                <li>
                    <a href="#%e5%8f%aa%e8%8e%b7%e5%8f%96_source%e5%ad%97%e6%ae%b5" aria-label="只获取_source字段：">只获取_source字段：</a></li>
                <li>
                    <a href="#%e5%88%a4%e6%96%ad%e6%95%b0%e6%8d%ae%e6%98%af%e5%90%a6%e5%ad%98%e5%9c%a8" aria-label="判断数据是否存在">判断数据是否存在</a></li>
                <li>
                    <a href="#%e5%88%86%e7%bb%84" aria-label="分组">分组</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#es-java" aria-label="es-java">es-java</a><ul>
                        
                <li>
                    <a href="#index-apis" aria-label="Index APIs">Index APIs</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%baindex" aria-label="创建index">创建index</a></li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4index" aria-label="删除index">删除index</a></li>
                <li>
                    <a href="#%e5%88%a4%e6%96%adindex%e6%98%af%e5%90%a6%e5%ad%98%e5%9c%a8" aria-label="判断index是否存在">判断index是否存在</a></li></ul>
                </li>
                <li>
                    <a href="#document-apis" aria-label="Document APIs">Document APIs</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e6%96%87%e6%a1%a3" aria-label="创建文档">创建文档</a></li>
                <li>
                    <a href="#%e6%a0%b9%e6%8d%aeid%e8%8e%b7%e5%8f%96%e6%96%87%e6%a1%a3" aria-label="根据id获取文档">根据id获取文档</a></li>
                <li>
                    <a href="#%e5%88%a4%e6%96%ad%e6%96%87%e6%a1%a3%e6%98%af%e5%90%a6%e5%ad%98%e5%9c%a8" aria-label="判断文档是否存在">判断文档是否存在</a></li>
                <li>
                    <a href="#%e6%9b%b4%e6%96%b0%e6%96%87%e6%a1%a3" aria-label="更新文档">更新文档</a></li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4%e6%96%87%e6%a1%a3" aria-label="删除文档">删除文档</a></li>
                <li>
                    <a href="#%e6%9d%a1%e4%bb%b6%e6%9f%a5%e8%af%a2" aria-label="条件查询">条件查询</a></li>
                <li>
                    <a href="#%e6%89%b9%e9%87%8f%e6%96%b0%e5%a2%9e%e6%96%87%e6%a1%a3" aria-label="批量新增文档">批量新增文档</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96" aria-label="其他">其他</a><ul>
                        
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9%e7%b4%a2%e5%bc%95%e7%9a%84mapping" aria-label="修改索引的mapping">修改索引的mapping</a></li>
                <li>
                    <a href="#%e4%ba%86%e8%a7%a3elk" aria-label="了解ELK">了解ELK</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Elasticsearch</p>
<p><a href="https://www.kuangstudy.com/bbs/1354069127022583809">参考</a>
<a href="https://endymecy.gitbooks.io/elasticsearch-guide-chinese/content/index.html">参考</a></p>
<h1 id="安装">安装<a hidden class="anchor" aria-hidden="true" href="#安装">#</a></h1>
<h2 id="安装-中文分词器ik">安装 中文分词器IK<a hidden class="anchor" aria-hidden="true" href="#安装-中文分词器ik">#</a></h2>
<p>建议下载es前，先下载安装中文分词插件IK。
<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">github下载地址</a>
下载最上面的zip包。
注意版本：需要和es的版本对应。比如IK版本是<code>v7.15.2</code>，那么es也要下载对应版本的。
否则启动会报错。
下载并解压，然后将解压的包直接放到es的plugins目录下，然后启动es。</p>
<h2 id="安装-es">安装 es<a hidden class="anchor" aria-hidden="true" href="#安装-es">#</a></h2>
<p>官网：https://www.elastic.co/cn/
es需要jdk1.8以上环境。</p>
<p>官网下载es：https://www.elastic.co/cn/downloads/elasticsearch
下载完解压到理想位置。
进入bin目录下，双击执行<code>elasticsearch.bat</code>
访问http://localhost:9200/
Elastic 返回一个 JSON 对象，包含当前节点、集群、版本等信息。</p>
<p>默认情况下，Elastic 只允许本机访问，如果需要远程访问，可以修改 Elastic 安装目录的config/elasticsearch.yml文件，去掉network.host的注释，将它的值改成0.0.0.0，然后重新启动 Elastic。
<code>network.host: 0.0.0.0</code></p>
<p>上面代码中，写成0.0.0.0让任何人都可以访问。生产环境不要这样设置，要写成具体的 IP。</p>
<h2 id="安装-elasticsearch-head已不再维护">安装 elasticsearch-head（已不再维护）<a hidden class="anchor" aria-hidden="true" href="#安装-elasticsearch-head已不再维护">#</a></h2>
<p>elasticsearch-head
本机需要安装nodejs。
下载：https://github.com/mobz/elasticsearch-head
启动：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>git clone git://github.com/mobz/elasticsearch-head.git
</span></span><span style="display:flex;"><span>cd elasticsearch-head
</span></span><span style="display:flex;"><span>npm install
</span></span><span style="display:flex;"><span>npm run start
</span></span></code></pre></td></tr></table>
</div>
</div><p>访问：http://localhost:9100/
存在跨域问题（只有当两个页面同源，才能交互）
同源（端口，主机，协议三者都相同）
<a href="https://blog.csdn.net/qq_38128179/article/details/84956552">https://blog.csdn.net/qq_38128179/article/details/84956552</a></p>
<p>开启跨域（在elasticsearch解压目录config下elasticsearch.yml中添加）</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 开启跨域
</span></span><span style="display:flex;"><span>http.cors.enabled: true
</span></span><span style="display:flex;"><span># 所有人访问
</span></span><span style="display:flex;"><span>http.cors.allow-origin: &#34;*&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启elasticsearch。
访问：http://localhost:9100/</p>
<p>连接es：
在浏览器左上角输入：
<code>http://IP地址:9200/</code>
注意：一定要加<code>http://</code>。</p>
<h2 id="安装-kibana">安装 kibana<a hidden class="anchor" aria-hidden="true" href="#安装-kibana">#</a></h2>
<p>Kibana是一个针对ElasticSearch的开源分析及可视化平台，用来搜索、查看交互存储在Elasticsearch索引中的数据。使用Kibana，可以通过各种图表进行高级数据分析及展示。Kibana让海量数据更容易理解。它操作简单，基于浏览器的用户界面可以快速创建仪表板( dashboard )实时显示Elasticsearch查询动态。设置Kibana非常简单。无需编码或者额外的基础架构，几分钟内就可以完成Kibana安装并启动Elasticsearch索引监测。</p>
<p>注意：下载的版本需要与ElasticSearch版本对应。
官网下载：https://www.elastic.co/cn/downloads/kibana
历史版本下载：https://www.elastic.co/cn/downloads/past-releases#kibana</p>
<p>解压，修改配置文件<code>kibana/config/kibana.yml</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#007f7f"># 端口</span>
</span></span><span style="display:flex;"><span>server.port: <span style="color:#ff0;font-weight:bold">5601</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 允许远程访问的地址配置，默认只允许本机访问，需要把Kibana服务给远程主机访问，就改为远程的那台主机的ip地址，</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 那如果我们希望所有的远程主机都能访问，那就填写0.0.0.0</span>
</span></span><span style="display:flex;"><span>server.host: <span style="color:#0ff;font-weight:bold">&#34;localhost&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 连接Elasticsearch服务配置，根据自己情况修改。</span>
</span></span><span style="display:flex;"><span>elasticsearch.hosts: [<span style="color:#0ff;font-weight:bold">&#34;http://localhost:9200&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Elasticsearch的用户名和密码</span>
</span></span><span style="display:flex;"><span>elasticsearch.username: <span style="color:#0ff;font-weight:bold">&#34;kibana_system&#34;</span>
</span></span><span style="display:flex;"><span>elasticsearch.password: <span style="color:#0ff;font-weight:bold">&#34;pass&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 显示中文</span>
</span></span><span style="display:flex;"><span>i18n.locale: <span style="color:#0ff;font-weight:bold">&#34;zh-CN&#34;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行：进入bin目录，运行<code>kibana.bat</code>
访问：<code>localhost:5601</code>
控制台：http://localhost:5601/app/dev_tools#/console</p>
<h1 id="es基本概念">es基本概念<a hidden class="anchor" aria-hidden="true" href="#es基本概念">#</a></h1>
<p>ES中有几个基本概念：索引(index)、类型(type)、文档(document)、映射(mapping)等。我们将这几个概念与传统的关系型数据库中的库、表、行、列等概念进行对比，如下表：</p>
<table>
<thead>
<tr>
<th>RDBS</th>
<th>ES</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据库（database）</td>
<td>索引（index）</td>
</tr>
<tr>
<td>表（table）</td>
<td>类型（type）（ES7.0之后被废弃，es8.0中完全删除）</td>
</tr>
<tr>
<td>表结构（schema）</td>
<td>映射（mapping）</td>
</tr>
<tr>
<td>行（row）</td>
<td>文档（document）</td>
</tr>
<tr>
<td>列（column）</td>
<td>字段（field）</td>
</tr>
<tr>
<td>索引</td>
<td>反向索引</td>
</tr>
<tr>
<td>SQL</td>
<td>查询DSL</td>
</tr>
<tr>
<td>SELECT * FROM table</td>
<td>GET http://&hellip;..</td>
</tr>
<tr>
<td>UPDATE table SET</td>
<td>PUT  http://&hellip;&hellip;</td>
</tr>
<tr>
<td>DELETE</td>
<td>DELETE  http://&hellip;&hellip;</td>
</tr>
</tbody>
</table>
<h2 id="index索引">Index（索引）<a hidden class="anchor" aria-hidden="true" href="#index索引">#</a></h2>
<p>ES管理的顶层单位就叫做 Index（索引），对应关系型数据库中的库。</p>
<p>下面的命令可以查看当前节点的所有 Index。
<code>curl -X GET http://localhost:9200/_cat/indices?v</code></p>
<p>ES在后台把每个索引划分成多个分片，每个分片可以在集群中的不同服务器间迁移。</p>
<h2 id="type类型">Type（类型）<a hidden class="anchor" aria-hidden="true" href="#type类型">#</a></h2>
<p>ES中，一个索引可以存储多个用于不同用途的对象，可以通过类型来区分索引中的不同对象，对应关系型数据库中表的概念。但是在ES6.0开始，类型的概念被废弃，ES7中将它完全删除。删除type的原因：
我们一直认为ES中的“index”类似于关系型数据库的“database”，而“type”相当于一个数据表。ES的开发者们认为这是一个糟糕的认识。例如：关系型数据库中两个数据表示是独立的，即使他们里面有相同名称的列也不影响使用，但ES中不是这样的。</p>
<p>我们都知道elasticsearch是基于Lucene开发的搜索引擎，而ES中不同type下名称相同的filed最终在Lucene中的处理方式是一样的。举个例子，两个不同type下的两个user_name，在ES同一个索引下其实被认为是同一个filed，你必须在两个不同的type中定义相同的filed映射。否则，不同type中的相同字段名称就会在处理中出现冲突的情况，导致Lucene处理效率下降。</p>
<p>去掉type能够使数据存储在独立的index中，这样即使有相同的字段名称也不会出现冲突，就像ElasticSearch出现的第一句话一样“你知道的，为了搜索····”，去掉type就是为了提高ES处理数据的效率。</p>
<p>除此之外，在同一个索引的不同type下存储字段数不一样的实体会导致存储中出现稀疏数据，影响Lucene压缩文档的能力，导致ES查询效率的降低。</p>
<p>下面的命令可以列出每个 Index 所包含的 Type。
<code>curl localhost:9200/_mapping?pretty=true</code></p>
<h2 id="document文档">Document（文档）<a hidden class="anchor" aria-hidden="true" href="#document文档">#</a></h2>
<p>Document是ES存储的最小单位，可以理解为关系型数据库中的一条记录，每个文档由多个字段（field）组成。区别于关系型数据库的是，ES是一个非结构化的数据库，每个文档可以有不同的字段，并且有一个唯一标识  unique id。</p>
<p>文档（Document）是不可变的：它们不能被修改，只能被替换。因此对于 Document 的所有修改操作，在其内部都要经历检索-修改-重建索引的处理过程。</p>
<p>每个文档有一些默认的属性，称为文档的元数据，用于标注文档的相关信息。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>_id：文档唯一id
</span></span><span style="display:flex;"><span>_index：文档所属的索引名
</span></span><span style="display:flex;"><span>_type：文档所属的类型名
</span></span><span style="display:flex;"><span>_source：文档的原始Json数据
</span></span><span style="display:flex;"><span>_version：文档版本信息
</span></span><span style="display:flex;"><span>_score：文档相关度打分
</span></span></code></pre></td></tr></table>
</div>
</div><p>_score（相关度）是一个很重要的概念，表示 ES 在全文属性上搜索并返回相关性最强的结果，这是完全区别于传统关系型数据库的一个概念，关系数据库中的一条记录要么匹配要么不匹配。</p>
<h2 id="倒排索引">倒排索引<a hidden class="anchor" aria-hidden="true" href="#倒排索引">#</a></h2>
<p><a href="https://zhuanlan.zhihu.com/p/55296265">https://zhuanlan.zhihu.com/p/55296265</a></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>文章内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>今天天气不错</td>
</tr>
<tr>
<td>2</td>
<td>适合学习ES</td>
</tr>
</tbody>
</table>
<p>正常来说，我们是通过id去搜索文章内容的。<code>id-&gt;内容</code>
但是在搜索引擎上，我们肯定不会去搜id，而是搜索关键字。比如搜索<code>学习ES</code>，肯定不能通过id去搜索，只能全文扫描<code>文章内容</code>字段。当数据量很大的时候，效率是没办法接受的！
倒排索引，简单说就是<code>以内容的关键词</code>建立索引，映射关系为<code>内容的关键词-&gt;ID</code>。
这样的话，我们只需要在<code>关键词</code>中进行检索，效率肯定很快。</p>
<table>
<thead>
<tr>
<th>关键词</th>
<th>文档id=1</th>
<th>文档id=2</th>
</tr>
</thead>
<tbody>
<tr>
<td>今天</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>天气不错</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>学习ES</td>
<td></td>
<td>√</td>
</tr>
</tbody>
</table>
<h1 id="分词">分词<a hidden class="anchor" aria-hidden="true" href="#分词">#</a></h1>
<p>分词，就是把一段话分成一些关键字，便于检索。
比如：今天天气不错
分词后变成：今天、天气、不错、今天天气、天气不错，等组合。</p>
<p>es默认的分词器会把每个汉字都分成一个词，如：我吃西红柿，会被分成：我、吃、西、红、柿。
这不符合要求，我们需要支持中文的分词器，就是IK分词器。</p>
<p>IK分词器官网：https://github.com/medcl/elasticsearch-analysis-ik</p>
<p>IK提供了两个分词算法: ik_smart 和 ik_max_word。
其中ik_smart为最少切分，ik_max_word 为最细粒度划分。</p>
<h2 id="ik_max_word">ik_max_word<a hidden class="anchor" aria-hidden="true" href="#ik_max_word">#</a></h2>
<p>最细粒度划分，穷尽各种可能的组合，适合term query。如：今天天气不错，会被拆分成如下结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 获取分词结果
</span></span><span style="display:flex;"><span>GET /_analyze
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;text&#34;:&#34;今天天气不错&#34;,
</span></span><span style="display:flex;"><span>  &#34;analyzer&#34;: &#34;ik_max_word&#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;tokens&#34; : [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;token&#34; : &#34;今天天气&#34;,
</span></span><span style="display:flex;"><span>      &#34;start_offset&#34; : 0,
</span></span><span style="display:flex;"><span>      &#34;end_offset&#34; : 4,
</span></span><span style="display:flex;"><span>      &#34;type&#34; : &#34;CN_WORD&#34;,
</span></span><span style="display:flex;"><span>      &#34;position&#34; : 0
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;token&#34; : &#34;今天&#34;,
</span></span><span style="display:flex;"><span>      &#34;start_offset&#34; : 0,
</span></span><span style="display:flex;"><span>      &#34;end_offset&#34; : 2,
</span></span><span style="display:flex;"><span>      &#34;type&#34; : &#34;CN_WORD&#34;,
</span></span><span style="display:flex;"><span>      &#34;position&#34; : 1
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;token&#34; : &#34;天天&#34;,
</span></span><span style="display:flex;"><span>      &#34;start_offset&#34; : 1,
</span></span><span style="display:flex;"><span>      &#34;end_offset&#34; : 3,
</span></span><span style="display:flex;"><span>      &#34;type&#34; : &#34;CN_WORD&#34;,
</span></span><span style="display:flex;"><span>      &#34;position&#34; : 2
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;token&#34; : &#34;天气&#34;,
</span></span><span style="display:flex;"><span>      &#34;start_offset&#34; : 2,
</span></span><span style="display:flex;"><span>      &#34;end_offset&#34; : 4,
</span></span><span style="display:flex;"><span>      &#34;type&#34; : &#34;CN_WORD&#34;,
</span></span><span style="display:flex;"><span>      &#34;position&#34; : 3
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;token&#34; : &#34;不错&#34;,
</span></span><span style="display:flex;"><span>      &#34;start_offset&#34; : 4,
</span></span><span style="display:flex;"><span>      &#34;end_offset&#34; : 6,
</span></span><span style="display:flex;"><span>      &#34;type&#34; : &#34;CN_WORD&#34;,
</span></span><span style="display:flex;"><span>      &#34;position&#34; : 4
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ik_smart">ik_smart<a hidden class="anchor" aria-hidden="true" href="#ik_smart">#</a></h2>
<p>最少切分。还是上面的例子，分词结果如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 获取分词结果
</span></span><span style="display:flex;"><span>GET /_analyze
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;text&#34;:&#34;今天天气不错&#34;,
</span></span><span style="display:flex;"><span>  &#34;analyzer&#34;: &#34;ik_smart&#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;tokens&#34; : [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;token&#34; : &#34;今天天气&#34;,
</span></span><span style="display:flex;"><span>      &#34;start_offset&#34; : 0,
</span></span><span style="display:flex;"><span>      &#34;end_offset&#34; : 4,
</span></span><span style="display:flex;"><span>      &#34;type&#34; : &#34;CN_WORD&#34;,
</span></span><span style="display:flex;"><span>      &#34;position&#34; : 0
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;token&#34; : &#34;不错&#34;,
</span></span><span style="display:flex;"><span>      &#34;start_offset&#34; : 4,
</span></span><span style="display:flex;"><span>      &#34;end_offset&#34; : 6,
</span></span><span style="display:flex;"><span>      &#34;type&#34; : &#34;CN_WORD&#34;,
</span></span><span style="display:flex;"><span>      &#34;position&#34; : 1
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>建议：一般情况下，为了提高搜索的效果，需要这两种分词器配合使用。既建索引时用 ik_max_word 尽可能多的分词，而搜索时用 ik_smart 尽可能提高匹配准度，让用户的搜索尽可能的准确。比如一个常见的场景，就是搜索&quot;进口红酒&quot;的时候，尽可能的不要出现口红相关商品或者让口红不要排在前面。</p>
<h1 id="es集群概念">ES集群概念<a hidden class="anchor" aria-hidden="true" href="#es集群概念">#</a></h1>
<p>Elastic 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elastic 实例。单个 Elastic 实例称为一个节点（node）。一组节点构成一个集群（cluster）。</p>
<h2 id="节点node">节点（node）<a hidden class="anchor" aria-hidden="true" href="#节点node">#</a></h2>
<p>一个es实例就是一个节点，一台机器可以有多个节点，正常使用下每个实例都应该会部署在不同的机器上。</p>
<h2 id="集群cluster">集群（cluster）<a hidden class="anchor" aria-hidden="true" href="#集群cluster">#</a></h2>
<p>一组节点（node）构成一个集群（cluster）。</p>
<h2 id="分片shard">分片（shard）<a hidden class="anchor" aria-hidden="true" href="#分片shard">#</a></h2>
<p>如果索引（Index）存储的数据太多（就是文档太多），可以将索引进行分片。
比如，一个包含10亿个文档的索引占据1TB的磁盘空间，而索引所在的节点没有足够的磁盘空间来存储这么多的数据，或者本节点不能处理搜索请求，响应会太慢。</p>
<p>为了解决这个问题，ES提供了将索引划分成多片的能力，这些片叫做分片。当你创建一个索引的时候，你可以指定你想要的分片的数量。每个分片本身也是一个功能完善并且独立的“索引”，这个“索引” 可以被放置到集群中的任何节点上。</p>
<p>分片的特点：</p>
<ul>
<li>ES的一个索引可以包含多个分片（shard）</li>
<li>每一个分片（shard）都是一个最小的工作单元，承载部分数据；</li>
<li>每个shard都是一个lucene实例，有完整的简历索引和处理请求的能力；</li>
<li>增减节点时，shard会自动在nodes中负载均衡；</li>
<li>一个索引中含有shard的数量，默认值为5，在索引创建后这个值是不能被更改的。</li>
<li>可以水平分割和扩展内容容量</li>
<li>允许你在分片（位于多个节点上）之上进行分布式的、并行的操作，进而提高性能/吞吐量</li>
<li>每一个shard关联的副本分片（replica shard）的数量，默认值为1，这个设置在任何时候都可以修改。</li>
</ul>
<p>至于一个分片怎样分布，它的文档怎样聚合回搜索请求，是完全由Elasticsearch管理的，对于作为用户的你来说，这些都是透明的。</p>
<h2 id="复制分片replica-shard">复制分片（replica shard）<a hidden class="anchor" aria-hidden="true" href="#复制分片replica-shard">#</a></h2>
<p>在一个网络/云的环境里，失败随时都可能发生。在某个分片/节点因为某些原因处于离线状态或者消失的情况下，故障转移机制是非常有用且强烈推荐的。为此， Elasticsearch允许你创建分片的一份或多份拷贝，这些拷贝叫做复制分片，或者直接叫复制。复制分片的主要作用是：</p>
<ul>
<li>在分片/节点失败的情况下，复制提供了高可用性。复制分片不与原/主要分片置于同一节点上是非常重要的。</li>
<li>因为搜索可以在所有的复制上并行运行，复制可以扩展你的搜索量/吞吐量</li>
</ul>
<p>总之，每个索引可以被分成多个分片。一个索引也可以被复制0次（即没有复制） 或多次。一旦复制了，每个索引就有了主分片（作为复制源的分片）和复制分片（主分片的拷贝）。 分片和复制的数量可以在索引创建的时候指定。在索引创建之后，你可以在任何时候动态地改变复制的数量，但是你不能再改变分片的数量。
默认情况下，ES中的每个索引都由5个主分片构成，每一个主分片会有一个副本（复制分片）。</p>
<h1 id="es数据类型">es数据类型<a hidden class="anchor" aria-hidden="true" href="#es数据类型">#</a></h1>
<p>参考官网：https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html</p>
<p>每个字段都有一个字段数据类型，或字段类型。这种类型表明该字段所包含的数据种类，如字符串或布尔值，以及它的预期用途。例如，你可以将字符串索引到文本和关键字字段。然而，文本字段的值会被分析为全文搜索，而关键词字符串则被保留为过滤和排序的原样。</p>
<p>字段类型是按族来分组的。同一家族的类型具有完全相同的搜索行为，但可能具有不同的空间使用或性能特征。</p>
<p>目前，有两个类型家族，<code>keyword</code>和<code>text</code>。其他类型族只有一个字段类型。例如，布尔类型族由一个字段类型组成：<code>boolean</code></p>
<h2 id="keyword">keyword<a hidden class="anchor" aria-hidden="true" href="#keyword">#</a></h2>
<p>keyword 类型的字段只能通过精确值搜索到，适合需要过滤、排序、聚合的字段。
tip：不要用 keyword 字段进行全文搜索，应该使用 text 类型代替。</p>
<h2 id="text">text<a hidden class="anchor" aria-hidden="true" href="#text">#</a></h2>
<p>text 类型的字段用于全文检索。text字段的内容会被分词。
索引时将字符串转换为单个关键词的列表（倒排索引），搜索时es会根据<code>倒排索引</code>搜索包含搜索关键字的内容。
text字段不能被排序，很少用于聚合。
使用场景：不具备唯一性的字符串，如商品介绍，电子邮件正文。</p>
<p>可选参数：</p>
<ul>
<li>
<p>analyzer
应该用于文本字段的分析器，无论是在索引时还是在搜索时。默认的分析器是<code>standard analyzer</code>
注：搜索的分析器可以单独指定，属性是<code>search_analyzer</code></p>
</li>
<li>
<p>fields
允许text字段以多种方式被索引，用于不同的目的，如一个字段用于搜索，一个多字段用于排序和聚合，或同一字符串值被不同的分析器分析。</p>
</li>
<li>
<p>search_analyzer
在搜索时使用的分析器</p>
</li>
</ul>
<p>看下面的例子，不指定分词器，那么使用默认的分词器 <code>standard</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;text&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;我爱你中国&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用默认的分词器<code>standard</code>，分词结果就是将每个汉字分成一个词。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;tokens&#34;</span> : [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;token&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;我&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;start_offset&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;end_offset&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;&lt;IDEOGRAPHIC&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;position&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;token&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;爱&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;start_offset&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;end_offset&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;&lt;IDEOGRAPHIC&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;position&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;token&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;你&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;start_offset&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;end_offset&#34;</span> : <span style="color:#ff0;font-weight:bold">3</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;&lt;IDEOGRAPHIC&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;position&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;token&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;中&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;start_offset&#34;</span> : <span style="color:#ff0;font-weight:bold">3</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;end_offset&#34;</span> : <span style="color:#ff0;font-weight:bold">4</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;&lt;IDEOGRAPHIC&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;position&#34;</span> : <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;token&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;国&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;start_offset&#34;</span> : <span style="color:#ff0;font-weight:bold">4</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;end_offset&#34;</span> : <span style="color:#ff0;font-weight:bold">5</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;&lt;IDEOGRAPHIC&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;position&#34;</span> : <span style="color:#ff0;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这意味着，如果你使用text类型去储存你本不想分词的字段，你在查询的时候，查询结果将违背你的预期。示例如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">创建索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">test_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;field1&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">存入数据</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">/test_index/_doc/</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;field1&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;我爱你中国&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>查所有数据，确认可以查到数据。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET test_index/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;took&#34; : 62,
</span></span><span style="display:flex;"><span>  &#34;timed_out&#34; : false,
</span></span><span style="display:flex;"><span>  &#34;_shards&#34; : {
</span></span><span style="display:flex;"><span>    &#34;total&#34; : 1,
</span></span><span style="display:flex;"><span>    &#34;successful&#34; : 1,
</span></span><span style="display:flex;"><span>    &#34;skipped&#34; : 0,
</span></span><span style="display:flex;"><span>    &#34;failed&#34; : 0
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  &#34;hits&#34; : {
</span></span><span style="display:flex;"><span>    &#34;total&#34; : {
</span></span><span style="display:flex;"><span>      &#34;value&#34; : 1,
</span></span><span style="display:flex;"><span>      &#34;relation&#34; : &#34;eq&#34;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;max_score&#34; : 1.0,
</span></span><span style="display:flex;"><span>    &#34;hits&#34; : [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        &#34;_index&#34; : &#34;test_index&#34;,
</span></span><span style="display:flex;"><span>        &#34;_type&#34; : &#34;_doc&#34;,
</span></span><span style="display:flex;"><span>        &#34;_id&#34; : &#34;1&#34;,
</span></span><span style="display:flex;"><span>        &#34;_score&#34; : 1.0,
</span></span><span style="display:flex;"><span>        &#34;_source&#34; : {
</span></span><span style="display:flex;"><span>          &#34;field1&#34; : &#34;我爱你中国&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>条件搜索，等价于mysql的 <code>where field1 = &quot;中国我爱你&quot;</code>。发现居然查询不到数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET test_index/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;term&#34;: {
</span></span><span style="display:flex;"><span>            &#34;field1&#34;: {
</span></span><span style="display:flex;"><span>                &#34;value&#34;: &#34;我爱你中国&#34;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>再根据刚才的ES分词效果，我们检索其中一个字，居然神奇的检索到了。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET test_index/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;term&#34;: {
</span></span><span style="display:flex;"><span>            &#34;field1&#34;: {
</span></span><span style="display:flex;"><span>                &#34;value&#34;: &#34;我&#34;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用term查询（等价于mysql的=）时查不到数据，就是因为text类型被分词了，因为使用的是默认的分词器<code>standard </code>，所以<code>我爱你中国</code>这句话在es中被分成了5个单独的汉字，所以搜不到。
如果使用IK分词器呢？删除刚才的索引
<code>DELETE test_index</code></p>
<p>重新创建索引，并指定<code>analyzer为ik_max_word</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>PUT test_index
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;mappings&#34;: {
</span></span><span style="display:flex;"><span>        &#34;properties&#34;: {
</span></span><span style="display:flex;"><span>            &#34;field1&#34;: {
</span></span><span style="display:flex;"><span>                &#34;type&#34;: &#34;text&#34;,
</span></span><span style="display:flex;"><span>                &#34;analyzer&#34;: &#34;ik_max_word&#34;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>存入数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>POST /test_index/_doc/1
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;field1&#34;:&#34;我爱你中国&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>再次检索</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET test_index/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;term&#34;: {
</span></span><span style="display:flex;"><span>            &#34;field1&#34;: {
</span></span><span style="display:flex;"><span>                &#34;value&#34;: &#34;我爱你中国&#34;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>还是无数据，查看原因：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /_analyze
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;text&#34;:&#34;我爱你中国&#34;,
</span></span><span style="display:flex;"><span>  &#34;analyzer&#34;: &#34;ik_max_word&#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;tokens&#34; : [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;token&#34; : &#34;我爱你&#34;,
</span></span><span style="display:flex;"><span>      &#34;start_offset&#34; : 0,
</span></span><span style="display:flex;"><span>      &#34;end_offset&#34; : 3,
</span></span><span style="display:flex;"><span>      &#34;type&#34; : &#34;CN_WORD&#34;,
</span></span><span style="display:flex;"><span>      &#34;position&#34; : 0
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;token&#34; : &#34;爱你&#34;,
</span></span><span style="display:flex;"><span>      &#34;start_offset&#34; : 1,
</span></span><span style="display:flex;"><span>      &#34;end_offset&#34; : 3,
</span></span><span style="display:flex;"><span>      &#34;type&#34; : &#34;CN_WORD&#34;,
</span></span><span style="display:flex;"><span>      &#34;position&#34; : 1
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;token&#34; : &#34;中国&#34;,
</span></span><span style="display:flex;"><span>      &#34;start_offset&#34; : 3,
</span></span><span style="display:flex;"><span>      &#34;end_offset&#34; : 5,
</span></span><span style="display:flex;"><span>      &#34;type&#34; : &#34;CN_WORD&#34;,
</span></span><span style="display:flex;"><span>      &#34;position&#34; : 2
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>原来分词后，没有<code>我爱你中国</code>这个完整的词。这里不再分析了，详见IK分词器。</p>
<h2 id="numeric">numeric<a hidden class="anchor" aria-hidden="true" href="#numeric">#</a></h2>
<p>数字类型，这类数据类型都是以确切值索引的，可以使用<code>term</code>查询，精确匹配。</p>
<p>long：带符号的64位整数，<code>最小值-2^63，最大值2^63 -1</code>
integer：带符号的32位整数，<code>最小值-2^31，最大值2^31 -1</code>
short：带符号的16位整数，最小值-32768，最大值32767
byte：带符号的8位整数，最小值-128，最小值127
double：双精度64位IEEE 754 浮点数
float：单精度32位IEEE 754 浮点数
half_float：半精度16位IEEE 754 浮点数
scaled_float：带有缩放因子的缩放类型浮点数</p>
<p>注意：
double、float、half_float这3种浮点型数据类型，认为-0.0和0.0是不同的值。这意味着在-0.0上进行查询(match or term)匹配不到0.0，反之亦然；范围查询也是如此：如果上限为-0.0则0.0将不匹配，如果下限为0.0则-0.0将不匹配。</p>
<p>就整数类型（byte，short，integer和long）而言，要选择满足实际需求的最小类型，这有助于索引和搜索。但请注意：ES存储数据是根据存储的实际值进行优化的，因此选择一种类型而不是另一种类型，将不会影响存储要求。</p>
<p>scaled_float类型需要格外注意：必须指定缩放因子scaling_factor。ES索引时，原始值会乘以该缩放因子并四舍五入得到新值，ES内部储存的是这个新值，但返回结果仍是原始值。例如：scale_factor为10的scaled_float字段将在内部存储2.34为23，查询时，ES都会将查询参数*10再四舍五入得到的值与23匹配，若能匹配到返回结果为2.34。</p>
<h2 id="range">range<a hidden class="anchor" aria-hidden="true" href="#range">#</a></h2>
<p>参考官网：https://www.elastic.co/guide/en/elasticsearch/reference/master/range.html
范围数据类型。具有大小关系的一个值区间，所以会用到gt、gte、lt、lte..等逻辑表示符。
ES支持下面6种范围数据类型：
integer_range，带符号的32位整数区间，<code>最小值-2^31，最大值2^31 -1</code>
long_range，带符号的64位整数区间，<code>最小值-2^63，最大值2^63 -1</code>
float_range，单精度32位IEEE 754浮点数区间
double_range，双精度64位IEEE 754浮点数区间
date_range，日期值范围，支持各种日期格式。无论使用何种格式，日期值都被解析为一个无符号的64位整数，代表UTC中Unix纪元以来的毫秒。不支持包含now date数学表达式的值。
ip_range，支持IPv4或IPv6（或混合）地址ip值范围</p>
<h2 id="array">array<a hidden class="anchor" aria-hidden="true" href="#array">#</a></h2>
<p>数组类型。默认情况下，任何字段都可以包含零个或多个值，当包含多个值时，它就表示array datatype了。注意：</p>
<ul>
<li>数组中的所有值必须具有相同的数据类型（要么同为字符串，要么同为整型，不能数组中一些值为字符串，另一些值为整型）。</li>
<li>array类型，无需提前设置，es天生支持。</li>
<li>使用<code>_mapping</code>查看索引的映射类型时，array datatype不会被写出来，还是以数组的元素的基本类型来表示。</li>
</ul>
<h2 id="object">object<a hidden class="anchor" aria-hidden="true" href="#object">#</a></h2>
<p>对象类型，JSON文档在本质上是分层的：文档可能包含内部对象，而内部对象又可能包含内部对象本身。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>PUT my-index-000001/_doc/1
</span></span><span style="display:flex;"><span>{ 
</span></span><span style="display:flex;"><span>  &#34;region&#34;: &#34;US&#34;,
</span></span><span style="display:flex;"><span>  &#34;manager&#34;: { 
</span></span><span style="display:flex;"><span>    &#34;age&#34;:     30,
</span></span><span style="display:flex;"><span>    &#34;name&#34;: { 
</span></span><span style="display:flex;"><span>      &#34;first&#34;: &#34;John&#34;,
</span></span><span style="display:flex;"><span>      &#34;last&#34;:  &#34;Smith&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>整个外部文档是一个JSON对象，它包含一个名为manager的内部对象，而manager又包含一个名为name的内部对象。
在ES内部，这种文档会被索引成一种简单平坦的键值对列表，如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;region&#34;:             &#34;US&#34;,
</span></span><span style="display:flex;"><span>  &#34;manager.age&#34;:        30,
</span></span><span style="display:flex;"><span>  &#34;manager.name.first&#34;: &#34;John&#34;,
</span></span><span style="display:flex;"><span>  &#34;manager.name.last&#34;:  &#34;Smith&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看上述文档的mapping映射：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>PUT my-index-000001
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;mappings&#34;: {
</span></span><span style="display:flex;"><span>    &#34;properties&#34;: { 
</span></span><span style="display:flex;"><span>      &#34;region&#34;: {
</span></span><span style="display:flex;"><span>        &#34;type&#34;: &#34;keyword&#34;
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      &#34;manager&#34;: { 
</span></span><span style="display:flex;"><span>        &#34;properties&#34;: {
</span></span><span style="display:flex;"><span>          &#34;age&#34;:  { &#34;type&#34;: &#34;integer&#34; },
</span></span><span style="display:flex;"><span>          &#34;name&#34;: { 
</span></span><span style="display:flex;"><span>            &#34;properties&#34;: {
</span></span><span style="display:flex;"><span>              &#34;first&#34;: { &#34;type&#34;: &#34;text&#34; },
</span></span><span style="display:flex;"><span>              &#34;last&#34;:  { &#34;type&#34;: &#34;text&#34; }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>会发现，只要字段的数据类型是object datatype，它就会有一个properties映射，该映射罗列出该字段的内部对象字段，然后内部对象再定义其每个字段的数据类型。
无需显示的设置字段类型为object，因为这是默认的。
注意：object不允许彼此独立地索引查询。这句话啥意思呢，看下面的nested类型。</p>
<h2 id="nested嵌套的">nested（嵌套的）<a hidden class="anchor" aria-hidden="true" href="#nested嵌套的">#</a></h2>
<p>nested datatype，嵌套数据类型，是object datatype的专用版本，在文档属性是一个对象数组时使用，它允许<code>对象数组彼此独立地编制索引和查询</code>。这里需要说明：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;addr&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;id&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;北京&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>addr属性仅有一个内部对象，此时可以使用object 类型。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;addr&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;id&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;北京&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;id&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;河北&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>addr是对象数组，此时要使用nested 类型。因为object类型映射这种对象数组会有问题。
由于Lucene没有内部对象的概念，因此ES将对象层次结构展平为一个简单的字段名称和值列表。
若一个属性包含若干个内部对象，例如下面的文档结构，user属性包含两个内部对象：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index/_doc/</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;group&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;fans&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;user&#34;</span> : [ 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;name&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;age&#34;</span> :  <span style="color:#ff0;font-weight:bold">18</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;name&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;李四&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;age&#34;</span> :  <span style="color:#ff0;font-weight:bold">23</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果使用object datatype数据类型去映射，ES将在内部转换为看起来更像这样的文档：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;group&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;fans&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;user.name&#34;</span> : [ <span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;李四&#34;</span> ],
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;user.age&#34;</span> :  [ <span style="color:#ff0;font-weight:bold">18</span>, <span style="color:#ff0;font-weight:bold">23</span> ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>user.name</code>和<code>user.age</code>字段被展平为多值字段，并且<code>张三</code>和<code>18</code>(同理，<code>李四</code>和<code>23</code>)之间的关联将丢失。此文档将错误地匹配<code>张三</code>和<code>李四</code>的查询：(<code>张三</code> 是<code>18</code>不是<code>23</code>，但搜索结果还是会把整个文档匹配到)</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;must&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&#34;user.name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&#34;user.age&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;18&#34;</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">返回的结果</span>
</span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;hits&#34;</span> <span style="color:#f00">:</span> [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;_index&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;my_index&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;_type&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;_doc&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;_id&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;_score&#34;</span> : <span style="color:#ff0;font-weight:bold">0.5753642</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;_source&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;user&#34;</span> : [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;name&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;age&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;18&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;name&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;李四&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;age&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;23&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span></code></pre></td></tr></table>
</div>
</div><p>对于对象数组的映射，ES推出了nested datatype来取代object datatype。在内部，nested datatype将数组中的每个对象索引为单独的隐藏文档，这意味着可以使用嵌套查询独立于其它对象查询每个嵌套对象。同样以上面的的数据为例子，只不过在添加数据前，先将user的数据类型设置为nested datatype：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">82
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 删除刚才的索引
</span></span><span style="display:flex;"><span>DELETE my_index
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 新建索引，user字段被映射为nested类型，而不是object类型。
</span></span><span style="display:flex;"><span>PUT my-index-000001
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;mappings&#34;: {
</span></span><span style="display:flex;"><span>    &#34;properties&#34;: {
</span></span><span style="display:flex;"><span>      &#34;user&#34;: {
</span></span><span style="display:flex;"><span>        &#34;type&#34;: &#34;nested&#34; 
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 存入数据
</span></span><span style="display:flex;"><span>PUT my_index/_doc/1
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;group&#34; : &#34;fans&#34;,
</span></span><span style="display:flex;"><span>  &#34;user&#34; : [ 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;name&#34; : &#34;张三&#34;,
</span></span><span style="display:flex;"><span>      &#34;age&#34; :  18
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;name&#34; : &#34;李四&#34;,
</span></span><span style="display:flex;"><span>      &#34;age&#34; :  23
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 这个查询不匹配，因为张三和23不在同一个嵌套对象中
</span></span><span style="display:flex;"><span>GET my_index/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;nested&#34;: {
</span></span><span style="display:flex;"><span>            &#34;path&#34;: &#34;user&#34;,
</span></span><span style="display:flex;"><span>            &#34;query&#34;: {
</span></span><span style="display:flex;"><span>                &#34;bool&#34;: {
</span></span><span style="display:flex;"><span>                    &#34;must&#34;: [
</span></span><span style="display:flex;"><span>                        {
</span></span><span style="display:flex;"><span>                            &#34;match&#34;: {
</span></span><span style="display:flex;"><span>                                &#34;user.name&#34;: &#34;张三&#34;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        },
</span></span><span style="display:flex;"><span>                        {
</span></span><span style="display:flex;"><span>                            &#34;match&#34;: {
</span></span><span style="display:flex;"><span>                                &#34;user.age&#34;: &#34;23&#34;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    ]
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 这个查询匹配，因为张三和18在同一个嵌套对象中。
</span></span><span style="display:flex;"><span># inner_hits 可以突出显示嵌套对象的具体匹配内容
</span></span><span style="display:flex;"><span>GET my_index/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;nested&#34;: {
</span></span><span style="display:flex;"><span>      &#34;path&#34;: &#34;user&#34;,
</span></span><span style="display:flex;"><span>      &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;bool&#34;: {
</span></span><span style="display:flex;"><span>          &#34;must&#34;: [
</span></span><span style="display:flex;"><span>            { &#34;match&#34;: { &#34;user.name&#34;: &#34;张三&#34; }},
</span></span><span style="display:flex;"><span>            { &#34;match&#34;: { &#34;user.age&#34;:  &#34;18&#34; }} 
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      &#34;inner_hits&#34;: { 
</span></span><span style="display:flex;"><span>        &#34;highlight&#34;: {
</span></span><span style="display:flex;"><span>          &#34;fields&#34;: {
</span></span><span style="display:flex;"><span>            &#34;user.first&#34;: {}
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="binary">binary<a hidden class="anchor" aria-hidden="true" href="#binary">#</a></h2>
<p>编码为Base64字符串的二进制值。
二进制类型接受一个作为Base64编码字符串的二进制值。该字段默认不存储，也不可搜索。</p>
<h2 id="boolean">boolean<a hidden class="anchor" aria-hidden="true" href="#boolean">#</a></h2>
<p>true或false。
boolean字段接受JSON的<code>true</code>和<code>false</code>，但也可以接受被解释为真或假的字符串。
false：<code>false, &quot;false&quot;, &quot;&quot; (empty string)</code>
true：<code>true, &quot;true&quot;</code></p>
<h2 id="date">date<a hidden class="anchor" aria-hidden="true" href="#date">#</a></h2>
<p>JSON没有日期数据类型，所以Elasticsearch中的日期可以是</p>
<ul>
<li>包含格式化日期的字符串，例如 &ldquo;2015-01-01 &ldquo;或 &ldquo;2015/01/01 12:10:30&rdquo;。</li>
<li>秒级（毫秒级）时间戳</li>
</ul>
<p>如果没有自定义日期格式，那么按照默认的格式：
<code>strict_date_optional_time||epoch_millis</code></p>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my-index</span><span style="color:#ff0;font-weight:bold">-000001</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;date&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my-index</span><span style="color:#ff0;font-weight:bold">-000001</span><span style="color:#f00">/_doc/</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>{ <span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2015-01-01&#34;</span> } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my-index</span><span style="color:#ff0;font-weight:bold">-000001</span><span style="color:#f00">/_doc/</span><span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>{ <span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2015-01-01T12:10:30Z&#34;</span> } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my-index</span><span style="color:#ff0;font-weight:bold">-000001</span><span style="color:#f00">/_doc/</span><span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>{ <span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#ff0;font-weight:bold">1420070400001</span> } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">在使用date类型字段进行排序时，返回的排序值都是以毫秒为单位</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my-index</span><span style="color:#ff0;font-weight:bold">-000001</span><span style="color:#f00">/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;sort&#34;</span>: { <span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;asc&#34;</span>} 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可选参数：
format：自定义的日期格式，默认：<code>strict_date_optional_time || epoch_millis</code></p>
<h1 id="dsl语法">DSL语法<a hidden class="anchor" aria-hidden="true" href="#dsl语法">#</a></h1>
<p>参考官网：https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html
<a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzIxMjE3NjYwOQ==&amp;action=getalbum&amp;album_id=1337850434433744897&amp;scene=173&amp;from_msgid=2247483843&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect">其他参考</a></p>
<p>DSL，全称是 Domain Specific Language，域特定语言。
ES 提供了一个基于JSON的完整查询DSL来定义查询。
ES将Query DSL视为查询AST（抽象语法树），由两种类型子句组成：</p>
<ul>
<li>叶查询子句，查找特定字段中的特定值，例如匹配，术语或范围查询；</li>
<li>复合查询子句，包装其他叶子或复合查询，用于以逻辑方式组合多个查询</li>
</ul>
<h2 id="查询和过滤上下文">查询和过滤上下文<a hidden class="anchor" aria-hidden="true" href="#查询和过滤上下文">#</a></h2>
<h3 id="相关性评分">相关性评分<a hidden class="anchor" aria-hidden="true" href="#相关性评分">#</a></h3>
<p>默认情况下，Elasticsearch 按照相关性分数对匹配的搜索结果进行排序，相关性分数衡量每个文档与查询的匹配程度。
相关性分数是一个正的浮点数字，在 search API的_score元数据字段中返回。_score越高，文档就越相关。虽然每种查询类型可以以不同的方式计算相关性分数，但分数的计算也取决于查询子句是在查询还是在过滤器上下文中运行。</p>
<h3 id="query-context-查询上下文">Query context 查询上下文<a hidden class="anchor" aria-hidden="true" href="#query-context-查询上下文">#</a></h3>
<p>在查询上下文中，查询子句回答的问题是 <code>这个文档与这个查询子句的匹配程度如何？</code>。除了决定文档是否匹配，查询子句还在<code>_score</code>元数据字段中计算相关性分数。
每当查询子句被传递给一个查询参数时，查询上下文就会生效，例如 search API中的查询参数。</p>
<h3 id="filter-context-过滤上下文">Filter context 过滤上下文<a hidden class="anchor" aria-hidden="true" href="#filter-context-过滤上下文">#</a></h3>
<p>在一个过滤器的上下文中，一个查询子句回答了 <code>这个文档是否与这个查询子句相匹配</code> 的问题？答案是简单的 &ldquo;是 &ldquo;或 &ldquo;否&rdquo;，不计算分数。过滤器上下文主要用于过滤结构化数据，例如
这个时间戳是否属于2015至2016年的范围？
状态字段是否设置为 &ldquo;发布&rdquo;？</p>
<p>经常使用的过滤器会被 Elasticsearch 自动缓存，以加快性能。</p>
<p>只要查询子句被传递给一个 filter 参数，如bool查询中的 filter 或must_not参数、constant_score查询中的 filter 参数或过滤器聚合，过滤器上下文就生效。</p>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: { 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span>: { 
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;must&#34;</span>: [
</span></span><span style="display:flex;"><span>        { <span style="font-weight:bold">&#34;match&#34;</span>: { <span style="font-weight:bold">&#34;title&#34;</span>:   <span style="color:#0ff;font-weight:bold">&#34;Search&#34;</span>        }},
</span></span><span style="display:flex;"><span>        { <span style="font-weight:bold">&#34;match&#34;</span>: { <span style="font-weight:bold">&#34;content&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;Elasticsearch&#34;</span> }}
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;filter&#34;</span>: [ 
</span></span><span style="display:flex;"><span>        { <span style="font-weight:bold">&#34;term&#34;</span>:  { <span style="font-weight:bold">&#34;status&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;published&#34;</span> }},
</span></span><span style="display:flex;"><span>        { <span style="font-weight:bold">&#34;range&#34;</span>: { <span style="font-weight:bold">&#34;publish_date&#34;</span>: { <span style="font-weight:bold">&#34;gte&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2015-01-01&#34;</span> }}}
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>query字段表示query上下文。</li>
<li>bool和两个match子句是在查询上下文中使用的，这意味着它们被用来对每个文档的匹配程度进行评分。</li>
<li>filter 参数表示过滤器上下文。它的 term 和 range 子句是用于过滤上下文的。它们将过滤掉不匹配的文档，但它们不会影响匹配文档的得分。</li>
</ul>
<h2 id="match_all">match_all<a hidden class="anchor" aria-hidden="true" href="#match_all">#</a></h2>
<p>最简单的查询，它匹配所有的文档，给它们的分数都是1.0</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET my_index/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;match_all&#34;: {}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以通过 boost 参数修改分数：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;match_all&#34;: { &#34;boost&#34; : 1.2 }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="复合查询">复合查询<a hidden class="anchor" aria-hidden="true" href="#复合查询">#</a></h2>
<h3 id="bool-query">bool query<a hidden class="anchor" aria-hidden="true" href="#bool-query">#</a></h3>
<p>用于组合多个叶子或复合查询子句的默认查询，如 must、should、must_not、或 filter 子句。
Bool查询对应Lucene中的BooleanQuery，它由一个或者多个子句组成，每个子句都有特定的类型。</p>
<ul>
<li>must
文档必须满足must子句的条件，并且参与计算分值。
<code>where id = 1 and name = 'wjy'</code></li>
<li>must_not
文档必须不满足must_not定义的条件。
<code>where id != 1 and name != 'wjy'</code></li>
<li>filter
文档必须满足filter子句的条件，和must的唯一区别是不计算分值。
<code>where id = 1 and name = 'wjy'</code></li>
<li>should
文档可能满足should子句的条件，和must的区别是字句由<code>or</code>连接
<code>where id = 1 or name = 'wjy'</code></li>
</ul>
<p>注意：</p>
<ul>
<li>Bool query 只支持以上4种查询的子句。</li>
<li>以上4种查询的子句，只支持 Full text queries、Term-level queries  和 Bool query。</li>
<li>只有must 和 should 子句会计算相关性评分；filter 和 must_not 子句都是在过滤器上下文中执行，计分被忽略，并且子句被考虑用于缓存。</li>
<li>在一个Bool查询中，如果没有must或者filter，有一个或者多个should子句，那么只要满足一个就可以返回。<code>minimum_should_match</code>参数定义了至少满足几个子句。</li>
</ul>
<p>bool查询采用 more_matches_is_better 的机制，因此满足must和should子句的文档将会合并起来计算分值。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;must&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;term&#34;</span> : { <span style="font-weight:bold">&#34;user.id&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;kimchy&#34;</span> }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;filter&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;term&#34;</span> : { <span style="font-weight:bold">&#34;tags&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;production&#34;</span> }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;must_not&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;range&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;age&#34;</span> : { <span style="font-weight:bold">&#34;gte&#34;</span> : <span style="color:#ff0;font-weight:bold">10</span>, <span style="font-weight:bold">&#34;lte&#34;</span> : <span style="color:#ff0;font-weight:bold">20</span> }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;should&#34;</span> : [
</span></span><span style="display:flex;"><span>        { <span style="font-weight:bold">&#34;term&#34;</span> : { <span style="font-weight:bold">&#34;tags&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;env1&#34;</span> } },
</span></span><span style="display:flex;"><span>        { <span style="font-weight:bold">&#34;term&#34;</span> : { <span style="font-weight:bold">&#34;tags&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;deployed&#34;</span> } }
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;minimum_should_match&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;boost&#34;</span> : <span style="color:#ff0;font-weight:bold">1.0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="bool-query-示例">bool query 示例<a hidden class="anchor" aria-hidden="true" href="#bool-query-示例">#</a></h3>
<p>创建index</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">blogs_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;settings&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;index&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;number_of_shards&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;number_of_replicas&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;mappings&#34;</span>:
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;dynamic&#34;</span>: <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;properties&#34;</span>:
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;id&#34;</span>:
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;integer&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;author&#34;</span>:
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;title&#34;</span>:
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_smart&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;content&#34;</span>:
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_max_word&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;search_analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_smart&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;tag&#34;</span>:
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;influence&#34;</span>:
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;integer_range&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;createAt&#34;</span>:
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;format&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd HH:mm&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>导入数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">_bulk</span>
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>:{<span style="font-weight:bold">&#34;_index&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;blogs_index&#34;</span>,<span style="font-weight:bold">&#34;_id&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;id&#34;</span>:<span style="color:#ff0;font-weight:bold">1</span>,<span style="font-weight:bold">&#34;author&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>,<span style="font-weight:bold">&#34;title&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;关注我，系统学习es&#34;</span>,<span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;这是关于es的文章&#34;</span>,<span style="font-weight:bold">&#34;tag&#34;</span>:[<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">3</span>],<span style="font-weight:bold">&#34;influence&#34;</span>:{<span style="font-weight:bold">&#34;gte&#34;</span>:<span style="color:#ff0;font-weight:bold">10</span>,<span style="font-weight:bold">&#34;lte&#34;</span>:<span style="color:#ff0;font-weight:bold">12</span>},<span style="font-weight:bold">&#34;createAt&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;2020-05-24 10:56&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>:{<span style="font-weight:bold">&#34;_index&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;blogs_index&#34;</span>,<span style="font-weight:bold">&#34;_id&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;id&#34;</span>:<span style="color:#ff0;font-weight:bold">2</span>,<span style="font-weight:bold">&#34;author&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>,<span style="font-weight:bold">&#34;title&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;系统学习编程&#34;</span>,<span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;这是关于编程的文章&#34;</span>,<span style="font-weight:bold">&#34;tag&#34;</span>:[<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">3</span>,<span style="color:#ff0;font-weight:bold">4</span>],<span style="font-weight:bold">&#34;influence&#34;</span>:{<span style="font-weight:bold">&#34;gte&#34;</span>:<span style="color:#ff0;font-weight:bold">12</span>,<span style="font-weight:bold">&#34;lte&#34;</span>:<span style="color:#ff0;font-weight:bold">15</span>},<span style="font-weight:bold">&#34;createAt&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;2020-05-23 10:56&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>:{<span style="font-weight:bold">&#34;_index&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;blogs_index&#34;</span>,<span style="font-weight:bold">&#34;_id&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;3&#34;</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;id&#34;</span>:<span style="color:#ff0;font-weight:bold">3</span>,<span style="font-weight:bold">&#34;author&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>,<span style="font-weight:bold">&#34;title&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;关注我，必看文章&#34;</span>,<span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;这是关于关于es和编程的必看文章&#34;</span>,<span style="font-weight:bold">&#34;tag&#34;</span>:[<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">3</span>,<span style="color:#ff0;font-weight:bold">4</span>],<span style="font-weight:bold">&#34;influence&#34;</span>:{<span style="font-weight:bold">&#34;gte&#34;</span>:<span style="color:#ff0;font-weight:bold">12</span>,<span style="font-weight:bold">&#34;lte&#34;</span>:<span style="color:#ff0;font-weight:bold">15</span>},<span style="font-weight:bold">&#34;createAt&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;2020-05-22 10:56&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>:{<span style="font-weight:bold">&#34;_index&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;blogs_index&#34;</span>,<span style="font-weight:bold">&#34;_id&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;4&#34;</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;id&#34;</span>:<span style="color:#ff0;font-weight:bold">4</span>,<span style="font-weight:bold">&#34;author&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;方才&#34;</span>,<span style="font-weight:bold">&#34;title&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;关注我，系统学习es&#34;</span>,<span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;这是关于es的文章&#34;</span>,<span style="font-weight:bold">&#34;tag&#34;</span>:[<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">3</span>],<span style="font-weight:bold">&#34;influence&#34;</span>:{<span style="font-weight:bold">&#34;gte&#34;</span>:<span style="color:#ff0;font-weight:bold">10</span>,<span style="font-weight:bold">&#34;lte&#34;</span>:<span style="color:#ff0;font-weight:bold">15</span>},<span style="font-weight:bold">&#34;createAt&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;2020-05-24 10:56&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>:{<span style="font-weight:bold">&#34;_index&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;blogs_index&#34;</span>,<span style="font-weight:bold">&#34;_id&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;5&#34;</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;id&#34;</span>:<span style="color:#ff0;font-weight:bold">5</span>,<span style="font-weight:bold">&#34;author&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;方才&#34;</span>,<span style="font-weight:bold">&#34;title&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;系统学习编程&#34;</span>,<span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;这是关于编程的文章&#34;</span>,<span style="font-weight:bold">&#34;tag&#34;</span>:[<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">3</span>,<span style="color:#ff0;font-weight:bold">4</span>],<span style="font-weight:bold">&#34;influence&#34;</span>:{<span style="font-weight:bold">&#34;gte&#34;</span>:<span style="color:#ff0;font-weight:bold">12</span>,<span style="font-weight:bold">&#34;lte&#34;</span>:<span style="color:#ff0;font-weight:bold">18</span>},<span style="font-weight:bold">&#34;createAt&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;2020-05-25 10:56&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>:{<span style="font-weight:bold">&#34;_index&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;blogs_index&#34;</span>,<span style="font-weight:bold">&#34;_id&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;6&#34;</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;id&#34;</span>:<span style="color:#ff0;font-weight:bold">6</span>,<span style="font-weight:bold">&#34;author&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;方才&#34;</span>,<span style="font-weight:bold">&#34;title&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;关注我，必看文章&#34;</span>,<span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;这是关于关于es和编程的必看文章&#34;</span>,<span style="font-weight:bold">&#34;tag&#34;</span>:[<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">3</span>,<span style="color:#ff0;font-weight:bold">4</span>],<span style="font-weight:bold">&#34;influence&#34;</span>:{<span style="font-weight:bold">&#34;gte&#34;</span>:<span style="color:#ff0;font-weight:bold">15</span>,<span style="font-weight:bold">&#34;lte&#34;</span>:<span style="color:#ff0;font-weight:bold">18</span>},<span style="font-weight:bold">&#34;createAt&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;2020-05-20 10:56&#34;</span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="filter的使用">filter的使用<a hidden class="anchor" aria-hidden="true" href="#filter的使用">#</a></h3>
<p>filter 子句内可包含多个 Full text queries 和 Term-level queries 的子句。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;filter&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;author&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;tag&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;title&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>该DSL语句可以检索到文档1，检索逻辑是：
<code>author = '方才兄' and tag = 2  and title的PostingLIst包含'es'</code></p>
<p>filter 子句类可包含 bool query，实现更复杂的逻辑。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;filter&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;must&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;author&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;tag&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ],
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;should&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;title&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;content&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>该DSL语句可以检索到文档1和文档3，检索逻辑是：
<code>author = “方才兄” and tag 包含 2  and  （ title的PostingLIst包含“es”or  content的PostingLIst包含“es”）</code></p>
<p>注意：使用filter查询，是不会计算文档的相关性评分的，可以看一下结果。<code>_score：0</code></p>
<h3 id="must-的使用">must 的使用<a hidden class="anchor" aria-hidden="true" href="#must-的使用">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;must&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;author&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;tag&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;title&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以检索到文档1，检索逻辑和 filter 完全一致，唯一的区别就是must会计算相关性评分。</p>
<h3 id="must_not-的使用">must_not 的使用<a hidden class="anchor" aria-hidden="true" href="#must_not-的使用">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;must_not&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;author&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;title&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>该DSL可检索到文档5和文档6，检索逻辑为：
<code>author != 方才兄 and title的postingList 不包含“es”</code></p>
<h3 id="should-的使用">should 的使用<a hidden class="anchor" aria-hidden="true" href="#should-的使用">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;should&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;author&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;title&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>该DSL会检索到文档1、2、3、4，检索逻辑是：
<code>author = 方才兄 or title的PostingList包含 es</code></p>
<h3 id="should-的注意事项">should 的注意事项<a hidden class="anchor" aria-hidden="true" href="#should-的注意事项">#</a></h3>
<p>should 仅影响得分的情况。
如果 bool查询在Query context中并且 bool查询具有must或 filter子句，那么bool的 should查询即使没有匹配到，文档也将与查询匹配。在这种情况下，should的子句仅用于影响得分。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;must&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;must&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;author&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;tag&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ],
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;should&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;title&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;content&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>该DSL语句会检索到文档1、2、3。正常理解should语句至少满足一个条件而言，检索到文档1和文档3是没问题，但是文档2，也被检索出来了，那就证明此时的should子句仅用于影响得分。</p>
<p>should 至少匹配一个的情况。
如果bool 查询是 Filter context 或 既没有must也没filter，则文档至少与一个should的查询相匹配。
第一个例子：bool 查询是 Filter context。直接将上述的DSL的第一个must替换为filter即可：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;filter&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;must&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;author&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;tag&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ],
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;should&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;title&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;content&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述DSL就只能检索文档1和3了。说明should 至少匹配了一个。</p>
<p>第二个例子：既没有must也没filter，should 至少匹配一个的情况。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;should&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;author&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;title&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="minimum_should_match-参数值说明">minimum_should_match 参数值说明<a hidden class="anchor" aria-hidden="true" href="#minimum_should_match-参数值说明">#</a></h3>
<p>如果不管哪种情况，我们都希望should子句应该被匹配，或者应该被匹配多个，那应该怎么做呢？可以通过minimum_should_match 参数控制。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;must&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;must&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;author&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ],
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;should&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;title&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;content&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;content&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;编程&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          ],
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;minimum_should_match&#34;</span>:<span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>该DSL可以检索到文档1和3，检索逻辑为：author = 方才兄 and  （title的PostingList 包含“es” 、content的PostingList 包含“es” 、content的PostingList 包含“编程”）【这3个条件满足2个】</p>
<p>minimum_should_match 参数可以有以下形式的参数：
标记：N——应该匹配的子句数，S——子句总数，X——用户给定的参数值</p>
<ul>
<li>
<p>正整数
N = X，比如给定值为3，那么 N=3。</p>
</li>
<li>
<p>负整数
N = S - |X|，比如给定值为-2，那么 N= S - 2。</p>
</li>
<li>
<p>正百分比
N = min 取整（S*X），比如 S=5，X = 25% ，那么 N= 1</p>
</li>
<li>
<p>负百分比
N =S - min 取整（|S*X|），比如 S=5，X = -25% ，那么 N= 5 - 1 = 4。</p>
</li>
<li>
<p>组合，比如 3&lt;90%
当 S &lt;= 3，则全部都是必需的；当 S &gt; 3，则仅需要90％，按上面的正百分比计算。</p>
</li>
<li>
<p>多种组合，比如：2&lt;-25%  9&lt;3
多个条件规范可以用空格分隔。每个条件规范仅对大于其前一个的数字有效。
在此示例中：如果有1或2个子句，则都需要；如果有3-9个子句，则需要-25％(按负百分数计算)；如果有9个以上的子句，则需要3个。</p>
</li>
<li>
<p>注意：
当minimum_should_match的值大于子句数量数，DSL将检索不到值；
当minimum_should_match为0时，should子句失效。</p>
</li>
</ul>
<h2 id="full-text-query-全文检索">full text query 全文检索<a hidden class="anchor" aria-hidden="true" href="#full-text-query-全文检索">#</a></h2>
<p>即全文检索，先建立索引，再对索引进行搜索的过程就叫全文检索。</p>
<h3 id="match-query">match query<a hidden class="anchor" aria-hidden="true" href="#match-query">#</a></h3>
<p>匹配查询，接受  text、number、date 或 boolean 四种参数。在匹配之前，对所提供的文本进行分析（即分词）。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/zw_paper/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;match&#34;</span>:{
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;title&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;天气不错&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>title</code>，你想搜索的字段名。如果没有额外参数，可以将搜索内容直接写在title后面，如：
<code>&quot;title&quot;: &quot;想搜索的内容&quot;</code>。有额外参数，需要将查询文本放到<code>query</code>中。</p>
<p>查询内容是：天气不错。被分析器分词之后，假如产生两个词，<code>天气</code>和<code>不错</code>。就根据分词的结果构造一个布尔查询。引擎内部执行的查询逻辑是：只要 title 字段值中包含任意一个关键字：天气、不错，那么返回该文档。伪代码如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span>(doc.<span style="color:#007f7f">title</span>.<span style="color:#007f7f">contains</span>(<span style="color:#0ff;font-weight:bold">&#34;天气&#34;</span>) or doc.<span style="color:#007f7f">title</span>.<span style="color:#007f7f">contains</span>(<span style="color:#0ff;font-weight:bold">&#34;不错&#34;</span>)){
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> doc;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里有两个可选参数：
operator：表示单个字段如何匹配查询条件的分词。
minimum_should_match：表示字段匹配的数量。</p>
<p>默认情况下operator的值是or，在构造查询时设置分词之间的逻辑运算符，如果设置为and，那么引擎内部执行的查询逻辑是：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span>(doc.<span style="color:#007f7f">title</span>.<span style="color:#007f7f">contains</span>(<span style="color:#0ff;font-weight:bold">&#34;天气&#34;</span>) and doc.<span style="color:#007f7f">title</span>.<span style="color:#007f7f">contains</span>(<span style="color:#0ff;font-weight:bold">&#34;不错&#34;</span>)){
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> doc;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>对于 minimum_should_match 属性值，默认值是1，即文档的 title 字段包含任意一个关键词，就满足查询条件。如果设置为2，意思是文档的 title 字段需要包含任意两个关键词，才能满足查询条件。</p>
<p>其他可选参数：
query：希望搜索的内容，类型可以是<code>Text, number, boolean 或 date</code>
analyzer：query 中内容的分析器。如果不指定，那么使用该字段索引时的analyzer。</p>
<p>这里给一个完整的示例。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">创建索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;settings&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;index&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;number_of_shards&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;number_of_replicas&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;dynamic&#34;</span>: <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;id&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;integer&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;content&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;fields&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&#34;ik_max_analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_max_word&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&#34;search_analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_max_word&#34;</span>
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&#34;ik_smart_analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_smart&#34;</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;createAt&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>简单解释下，content字段的映射：【就是一个字段配置多个分词器】</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;content&#34;</span><span style="color:#f00">:</span> {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>, <span style="color:#f00">#</span> <span style="color:#f00">默认为</span> <span style="color:#f00">keyword类型</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;fields&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;ik_max_analyzer&#34;</span>: { <span style="color:#f00">#</span> <span style="color:#f00">创建名为</span> <span style="color:#f00">ik_max_analyzer</span> <span style="color:#f00">的子字段</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_max_word&#34;</span>, <span style="color:#f00">#</span> <span style="color:#f00">字段ik_max_analyzer</span> <span style="color:#f00">的倒排序索引分词器为ik_max_word</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;search_analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_max_word&#34;</span> <span style="color:#f00">#</span> <span style="color:#f00">检索关键词的分词器为ik_max_word</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;ik_smart_analyzer&#34;</span>: {  <span style="color:#f00">#</span> <span style="color:#f00">创建名为</span> <span style="color:#f00">ik_smart_analyzer的子字段</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_smart&#34;</span>, <span style="color:#f00">#</span> <span style="color:#f00">字段ik_smart_analyzer</span> <span style="color:#f00">的倒排序索引分词器为ik_smart</span>
</span></span><span style="display:flex;"><span>					<span style="color:#f00">#</span> <span style="color:#f00">字段ik_smart_analyzer</span> <span style="color:#f00">的检索关键词的分词器默认为ik_smart，无需单独设置</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>相对于粗暴的用不同的字段去实现配置不同的分词器而言，一个字段配置多个分词器在数据的存储和操作上方便许多，只用储存一个字段，即可得到不同的分词效果。</p>
<p>批量插入数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">_bulk</span>
</span></span><span style="display:flex;"><span>{ <span style="font-weight:bold">&#34;index&#34;</span> : { <span style="font-weight:bold">&#34;_index&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;my_index&#34;</span>, <span style="font-weight:bold">&#34;_id&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span> } }
</span></span><span style="display:flex;"><span>{ <span style="font-weight:bold">&#34;id&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,<span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;关注我，系统学编程&#34;</span> }
</span></span><span style="display:flex;"><span>{ <span style="font-weight:bold">&#34;index&#34;</span> : { <span style="font-weight:bold">&#34;_index&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;my_index&#34;</span>, <span style="font-weight:bold">&#34;_id&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2&#34;</span> } }
</span></span><span style="display:flex;"><span>{ <span style="font-weight:bold">&#34;id&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>,<span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;系统学编程,就关注我&#34;</span> }
</span></span><span style="display:flex;"><span>{ <span style="font-weight:bold">&#34;index&#34;</span> : { <span style="font-weight:bold">&#34;_index&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;my_index&#34;</span>, <span style="font-weight:bold">&#34;_id&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;3&#34;</span> } }
</span></span><span style="display:flex;"><span>{ <span style="font-weight:bold">&#34;id&#34;</span> : <span style="color:#ff0;font-weight:bold">3</span>,<span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;系统编程，关注我&#34;</span> }
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span> : { <span style="font-weight:bold">&#34;_index&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;my_index&#34;</span>, <span style="font-weight:bold">&#34;_id&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;4&#34;</span> } }
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;id&#34;</span> : <span style="color:#ff0;font-weight:bold">4</span>,<span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;关注我，间隔系统学编程&#34;</span> }
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：bulk api 对json语法有严格的要求，一个json串内部不能换行，只能放到一行。而且一个json串和其他json串之间必须要换行，否则会出现错误。</p>
<p>检查批量插入是否成功
<code>GET my_index/_search</code></p>
<p>使用 content 的默认字段检索【keword】</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">这样查不到数据</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>:{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;match&#34;</span>:{
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;系统学&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">可以查到数据</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>:{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;match&#34;</span>:{
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;content&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;关注我，系统学编程&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>语句1查不到数据，是因为此时content是keyword类型，是不会分词的，所以检索词需要和内容完全一样。语句2和第一个文档content内容完全一样，所以可以查到数据。</p>
<p>下面使用 <code>content.ik_max_analyzer</code> 字段检索【ik_max_word】</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">可以查到全部数据</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>:{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;match&#34;</span>:{
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;content.ik_max_analyzer&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;系统学&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">改变检索分词器为ik_smart，只能检索到文档</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">和文档</span><span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;content.ik_max_analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;系统学&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_smart&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>分析：
【语句1】能查到所有文档，因为检索词根据 ik_max_word 分词，得到Token（系统、系统学）。
【语句2】的检索词根据 ik_smart 分词，只能得到Token（系统学），所以无法匹配文档3。</p>
<p>可以自己执行以下的分词测试语句，查看分词效果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;text&#34;</span>: [<span style="color:#0ff;font-weight:bold">&#34;系统学&#34;</span>],
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_smart&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;text&#34;</span>: [<span style="color:#0ff;font-weight:bold">&#34;系统学&#34;</span>],
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_max_word&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="match-phrase-query">Match phrase query<a hidden class="anchor" aria-hidden="true" href="#match-phrase-query">#</a></h3>
<p>match_phrase查询，分析文本并根据分析的文本创建一个短语查询。
match_phrase 会将检索关键词分词。
match_phrase的分词结果必须在被检索字段的分词中都包含，而且顺序必须相同，而且默认必须都是连续的。</p>
<p>简单看个例子，与match query 对比下，就很好理解了。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">使用match_phrase查询，ik_smart分词，结果只有文档</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;match_phrase&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>          	<span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;关注我,系统学&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">改为match查询，ik_smart分词，可以查询出所有结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>          	<span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;关注我,系统学&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>分析：上面的例子使用的分词器是ik_smart，所以检索词“关注我，系统学”会被分词为3个Token【关注、我、系统学】；而文档1、文档2和文档4 的content被分词后都包含这3个关键词，但是只有文档1的Token的顺序和检索词一致，且连续。所以使用 match_phrase 查询只能查询到文档1（ps：文档2 Token顺序不一致；文档4 Token不连续；文档3 Token没有完全包含）。使用 match查询可以查询到所有文档，是因为所有文档都有【关注、我】这两个Token。</p>
<p>match_phrase 核心参数：<code>slop</code>，Token之间的位置距离，直接看例子。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">将上面的</span> <span style="color:#f00">match_phrase</span> <span style="color:#f00">查询新增一个</span> <span style="color:#f00">slop参数，文档</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">和文档</span><span style="color:#ff0;font-weight:bold">4</span><span style="color:#f00">都被检索出来</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/my_index/_doc/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;match_phrase&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>            	<span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;关注我,系统学&#34;</span>,
</span></span><span style="display:flex;"><span>            	<span style="font-weight:bold">&#34;slop&#34;</span>:<span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 analyze 接口分析下文档4的Token。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">文档</span><span style="color:#ff0;font-weight:bold">4</span> <span style="color:#f00">content</span> <span style="color:#f00">的分词</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;text&#34;</span>: [<span style="color:#0ff;font-weight:bold">&#34;关注我,间隔系统学编程&#34;</span>],
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_smart&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;tokens&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;token&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;关注&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;start_offset&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;end_offset&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;position&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;token&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;我&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;start_offset&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;end_offset&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;CN_CHAR&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;position&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;token&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;间隔&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;start_offset&#34;</span>: <span style="color:#ff0;font-weight:bold">4</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;end_offset&#34;</span>: <span style="color:#ff0;font-weight:bold">6</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;position&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;token&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;系统学&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;start_offset&#34;</span>: <span style="color:#ff0;font-weight:bold">6</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;end_offset&#34;</span>: <span style="color:#ff0;font-weight:bold">9</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;position&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;token&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;编程&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;start_offset&#34;</span>: <span style="color:#ff0;font-weight:bold">9</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;end_offset&#34;</span>: <span style="color:#ff0;font-weight:bold">11</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;position&#34;</span>: <span style="color:#ff0;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过分词测试，发现Token【我】与【系统学】的position差值为1(等于slop的值)，所以文档4也被检索出来了。</p>
<h3 id="match_phrase_prefix">match_phrase_prefix<a hidden class="anchor" aria-hidden="true" href="#match_phrase_prefix">#</a></h3>
<p>与match_phrase查询类似，但是会对最后一个Token在倒排序索引列表中进行通配符搜索。
重要参数：max_expansions，模糊匹配数控制： 默认值50，最小值为1。
示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">、先使用match_phrase查询，没有结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;match_phrase&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;系&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#ff0;font-weight:bold">2</span><span style="color:#f00">、使用match_phrase_prefix查询，</span> <span style="color:#0ff;font-weight:bold">&#34;max_expansions&#34;</span><span style="color:#f00">:</span> <span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">，得到文档</span><span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;match_phrase_prefix&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;系&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;max_expansions&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#ff0;font-weight:bold">3</span><span style="color:#f00">.match_phrase_prefix查询，</span> <span style="color:#0ff;font-weight:bold">&#34;max_expansions&#34;</span><span style="color:#f00">:</span> <span style="color:#ff0;font-weight:bold">2</span><span style="color:#f00">，得到所有文档</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;match_phrase_prefix&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;系&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;max_expansions&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果分析：【语句1】查不到结果，是因为根据ik_smart分词器生成的倒排序索引中，所有文档中都不包含Token【系】；【语句2】查询到文档3，是因为文档3包含Token【系统】，同时 &ldquo;max_expansions&rdquo;: 1，所以检索关键词【系】+ 1个通配符匹配，就可以匹配到一个Token【系统】；【语句3】查询到所有文档，是因为&quot;max_expansions&rdquo;: 2，所以检索关键词【系】+ 2个通配符匹配，就可以匹配到两个Token【系统、系统学】，所以就可以查询到所有。</p>
<h3 id="multi_match">multi_match<a hidden class="anchor" aria-hidden="true" href="#multi_match">#</a></h3>
<p>多重匹配查询，在match的基础上允许多个字段查询。multi_match默认带有2个属性：query 和 fields，query设置搜索文档，fields用于指定匹配字段。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;multi_match&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;this is a test&#34;</span>, 
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;fields&#34;</span>: [<span style="color:#0ff;font-weight:bold">&#34;subject&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;message&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>fields可以模糊匹配，如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;multi_match&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;Will Smith&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;fields&#34;</span>: [<span style="color:#0ff;font-weight:bold">&#34;title&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;*_name&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>搜索三个字段：title、first_name 和 last_name。</p>
<p>提升字段分数。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;multi_match&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;query&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;this is a test&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;fields&#34;</span> : [<span style="color:#0ff;font-weight:bold">&#34;subject^3&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;message&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>subject得分乘以3，message 字段不变。</p>
<p>可选参数：
type：设置multi_match在内部查询的执行方式，有5个可选项。</p>
<ul>
<li>best_fields：默认值，它可以查询与任何字段匹配的文档，但使用最佳字段的_score作为返回结果的_score(相关度)</li>
<li>most_fields：查找与任何字段匹配的文档，并组合每个字段的_score</li>
<li>cross_fields：使用相同的分析器处理每个字段</li>
<li>phrase：在每个字段上运行match_phrase查询，并组合每个字段的_score</li>
<li>phrase_prefix：在每个字段上运行match_phrase_prefix查询，并组合每个字段的_score</li>
</ul>
<p>再给一个上面的例子：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">、同时查询</span>  <span style="color:#0ff;font-weight:bold">&#34;content&#34;</span><span style="color:#f00">,</span> <span style="color:#0ff;font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span><span style="color:#f00">，得到文档</span><span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/tehero_index/_doc/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;multi_match&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;系统&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;fields&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;content&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span>
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#ff0;font-weight:bold">2</span><span style="color:#f00">、同时查询</span> <span style="color:#f00">所有字段</span> <span style="color:#f00">得到所有文档</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/tehero_index/_doc/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;multi_match&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;系统&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;fields&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;content&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;content.ik_max_analyzer&#34;</span>
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>需要注意的是，多个Fields之间的查询关系是 or ，就相当于mysql 的
<code>where 字段1=&quot;检索词&quot; or 字段2=&quot;检索词&quot; or 字段3=&quot;检索词&quot;</code></p>
<h3 id="query_string">query_string<a hidden class="anchor" aria-hidden="true" href="#query_string">#</a></h3>
<p>允许我们在单个查询字符串中指定AND | OR | NOT条件，同时也和 multi_match query 一样，支持多字段搜索。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">、检索同时包含Token【系统学、es】的文档，结果为空</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/tehero_index/_doc/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;query_string&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;query&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;系统学 AND es&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;fields&#34;</span> : [<span style="color:#0ff;font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span>],
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">等价sql：</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">where</span> <span style="color:#f00">Token</span> <span style="color:#f00">=</span> <span style="color:#f00">&#39;系统学&#39;</span> <span style="color:#f00">and</span> <span style="color:#f00">Token</span> <span style="color:#f00">=</span> <span style="color:#f00">&#39;es&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#ff0;font-weight:bold">2</span><span style="color:#f00">、检索包含Token【系统学、es】二者之一的文档，能检索到文档</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">、</span><span style="color:#ff0;font-weight:bold">2</span><span style="color:#f00">、</span><span style="color:#ff0;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/tehero_index/_doc/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;query_string&#34;</span> : {
</span></span><span style="display:flex;"><span>			<span style="font-weight:bold">&#34;query&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;系统学 OR es&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;fields&#34;</span> : [<span style="color:#0ff;font-weight:bold">&#34;content.ik_smart_analyzer&#34;</span>],
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意点：中间的连接词【AND | OR | NOT】必须是全大写。</p>
<h3 id="simple_query_string">simple_query_string<a hidden class="anchor" aria-hidden="true" href="#simple_query_string">#</a></h3>
<p>类似于query_string ，但是会忽略错误的语法，永远不会引发异常，并且会丢弃查询的无效部分。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>simple_query_string支持以下特殊字符：
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ 表示与运算，相当于query_string 的 AND
</span></span><span style="display:flex;"><span>| 表示或运算，相当于query_string  的 OR
</span></span><span style="display:flex;"><span>- 取反单个令牌,相当于query_string 的 NOT
</span></span><span style="display:flex;"><span>&#34;&#34; 表示对检索词进行 match_phrase query
</span></span><span style="display:flex;"><span>* 字词末尾表示前缀查询
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>+</code>表示与运算，相当于query_string 的 AND</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 1、检索到文档4
</span></span><span style="display:flex;"><span>GET /tehero_index/_doc/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;simple_query_string&#34; : {
</span></span><span style="display:flex;"><span>	        &#34;query&#34; : &#34;系统学 + 间隔&#34;
</span></span><span style="display:flex;"><span>            &#34;fields&#34; : [&#34;content.ik_smart_analyzer&#34;],
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>|</code> 表示或运算，相当于query_string  的 OR</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 2、检索到文档1、2、4
</span></span><span style="display:flex;"><span>GET /tehero_index/_doc/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;simple_query_string&#34; : {
</span></span><span style="display:flex;"><span>            &#34;fields&#34; : [&#34;content.ik_smart_analyzer&#34;],
</span></span><span style="display:flex;"><span>            &#34;query&#34; : &#34;系统学 | 间隔&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>-</code>取反单个令牌，相当于query_string 的 NOT</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 3、检索到文档1、2
</span></span><span style="display:flex;"><span>GET /tehero_index/_doc/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;simple_query_string&#34; : {
</span></span><span style="display:flex;"><span>            &#34;fields&#34; : [&#34;content.ik_smart_analyzer&#34;],
</span></span><span style="display:flex;"><span>            &#34;query&#34; : &#34;系统学 -间隔&#34;,
</span></span><span style="display:flex;"><span>            &#34;default_operator&#34;: &#34;and&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：参数<code>&quot;default_operator&quot;: &quot;and&quot;</code>。该参数的默认值为or。
上述DSL对应的sql语句为：<code>where Token = 系统学 and Token != 间隔</code></p>
<p><code>*</code>字词末尾表示前缀查询 -match_phrase_prefix query</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 6、检索到文档 3
</span></span><span style="display:flex;"><span>GET /tehero_index/_doc/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;simple_query_string&#34; : {
</span></span><span style="display:flex;"><span>            &#34;fields&#34; : [&#34;content.ik_smart_analyzer&#34;],
</span></span><span style="display:flex;"><span>            &#34;query&#34; : &#34;系统&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span># 6、检索到所有文档，等价于match_phrase_prefix query
</span></span><span style="display:flex;"><span>GET /tehero_index/_doc/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;simple_query_string&#34; : {
</span></span><span style="display:flex;"><span>            &#34;fields&#34; : [&#34;content.ik_smart_analyzer&#34;],
</span></span><span style="display:flex;"><span>            &#34;query&#34; : &#34;系统*&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="总结">总结<a hidden class="anchor" aria-hidden="true" href="#总结">#</a></h3>
<ul>
<li>match query：用于执行全文查询的标准查询，包括模糊匹配和短语或接近查询。重要参数：控制Token之间的布尔关系：operator：or/and</li>
<li>match_phrase query：与match查询类似，但用于匹配确切的短语或单词接近匹配。重要参数：Token之间的位置距离：slop 参数</li>
<li>match_phrase_prefix query：与match_phrase查询类似，但是会对最后一个Token在倒排序索引列表中进行通配符搜索。重要参数：模糊匹配数控制：max_expansions 默认值50，最小值为1</li>
<li>multi_match query：match查询 的多字段版本。该查询在实际中使用较多，可以降低DSL语句的复杂性。同时该语句有多个查询类型，后面TeHero会专门进行讲解。</li>
<li>common terms query：对于中文检索意义不大。</li>
<li>query_string query 和 simple_query_string query，其实就是以上 query语句的合集，使用非常灵活，DSL编写简单。但是，TeHero认为这两个查询语句，有一个很明显的弊端：类似于sql注入【建议使用flags参数进行控制】。如果用户在检索词输入了对应的“关键字”【比如OR、*】等，用户将获取到本不应该被查询到的数据。慎用！</li>
</ul>
<h2 id="term-level-queries-术语查询">Term-level queries 术语查询<a hidden class="anchor" aria-hidden="true" href="#term-level-queries-术语查询">#</a></h2>
<p>术语级查询就是根据结构化数据中的精确值查找文档。
所有属于term level query 的查询，都是给什么就查什么，不会对检索词进行，明显区别于<code>全文检索full text query</code>。
注意：只是<code>检索词</code>不会被分词，被检索的字段如果是 text 类型，还是会分词，和检索词无关。比如你的检索词是<code>天气不错</code>，<code>天气不错</code>不会被分词，如果被搜索的字段是 text 类型（会被分词），且有一列的值是<code>今天天气不错</code>，那么也会被搜出来。</p>
<h3 id="term">term<a hidden class="anchor" aria-hidden="true" href="#term">#</a></h3>
<p>根据查询内容，返回精确匹配的文档。等价于sql<code>where id = 123</code></p>
<p>注：不要用 term 查询搜索 text 类型的字段。因为es会对 text 类型的字段进行分词，所以会使精确匹配变得困难。想对 text 类型的字段进行检索，应该使用 match 。</p>
<p>term 使用示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;user.name&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;value&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;boost&#34;</span>: <span style="color:#ff0;font-weight:bold">1.0</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>term的参数：<code>&lt;field&gt; 你想要搜索的字段</code>
<code>&lt;field&gt;</code>的参数：</p>
<ul>
<li>
<p>value
你想搜索的内容</p>
</li>
<li>
<p>boost
用于减少或增加查询的相关性分数的浮点数字，默认为1.0。</p>
</li>
</ul>
<h3 id="terms">terms<a hidden class="anchor" aria-hidden="true" href="#terms">#</a></h3>
<p>精确匹配多个值，其他各方面都和term一致。等价sql<code>where id in(1,2,3)</code></p>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;user.name&#34;</span>: [ <span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;wm&#34;</span> ],
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;boost&#34;</span>: <span style="color:#ff0;font-weight:bold">1.0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="terms-set">terms set<a hidden class="anchor" aria-hidden="true" href="#terms-set">#</a></h3>
<p>terms_set 查询与 terms 查询相同，区别是可以定义返回文档所需的匹配词条数目。索引数据时，你需要创建一个<code>数字</code>字段映射来使用terms_set查询，这个数字字段包含了返回一个文档所需的匹配术语的数量。</p>
<p>terms_set query 在对Array类型的字段做检索时非常有用，特别是对于每个文档，需要匹配的数量不一致时。如果所有文档需要匹配的数量一致，可以使用match query替代。</p>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">创建index</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/job-candidates</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;name&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;programming_languages&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;required_matches&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 必须是数字类型
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;long&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">创建数据</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/job-candidates/_doc/</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">?refresh</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;Jane Smith&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;programming_languages&#34;</span>: [ <span style="color:#0ff;font-weight:bold">&#34;c++&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;java&#34;</span> ],
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;required_matches&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">创建数据</span><span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/job-candidates/_doc/</span><span style="color:#ff0;font-weight:bold">2</span><span style="color:#f00">?refresh</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;Jason Response&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;programming_languages&#34;</span>: [ <span style="color:#0ff;font-weight:bold">&#34;java&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;php&#34;</span> ],
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;required_matches&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">查询</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/job-candidates/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;terms_set&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;programming_languages&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;terms&#34;</span>: [ <span style="color:#0ff;font-weight:bold">&#34;c++&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;java&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;php&#34;</span> ],
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;minimum_should_match_field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;required_matches&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>两个文档都可以查到。因为两个文档的<code>required_matches</code>都是2，而我们查询了三个字符串。
如果<code>&quot;terms&quot;: [ &quot;c++&quot;, &quot;java&quot;]</code>，那么只能查到文档1，如果<code>&quot;terms&quot;: [&quot;java&quot;]</code>，那么查不到任何数据。</p>
<p>与match query的比较。
当每个文档的required_matches值都相同时，上述两句DSL与下面的match query 语句检索效果完全一致：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /job-candidates/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>        &#34;match&#34;: {
</span></span><span style="display:flex;"><span>            &#34;programming_languages&#34; : {
</span></span><span style="display:flex;"><span>                &#34;query&#34;:  &#34;c++ java php,
</span></span><span style="display:flex;"><span>                &#34;analyzer&#34;: &#34;whitespace&#34;,
</span></span><span style="display:flex;"><span>                &#34;minimum_should_match&#34;: 2
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&#34;analyzer&#34;: &#34;whitespace&#34;, 所以 query会被分词3个Token【c++】【java】【php】。&#34;minimum_should_match&#34;: 2，所以可以检索到文档1和2。
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="range-1">range<a hidden class="anchor" aria-hidden="true" href="#range-1">#</a></h3>
<p>查找指定字段指定范围内的值。</p>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;range&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;age&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;gte&#34;</span>: <span style="color:#ff0;font-weight:bold">10</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;lte&#34;</span>: <span style="color:#ff0;font-weight:bold">20</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;boost&#34;</span>: <span style="color:#ff0;font-weight:bold">2.0</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询10-20岁之间的数据。
查询字段的可选参数。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>gt（Greater than）：即大于 &gt;
</span></span><span style="display:flex;"><span>gte（Greater than or equal to）：即大于等于 &gt;=
</span></span><span style="display:flex;"><span>lt（Less than）：即小于 &lt;
</span></span><span style="display:flex;"><span>lte（Less than or equal to）：即小于等于 &lt;=
</span></span></code></pre></td></tr></table>
</div>
</div><p>boost：分值，默认1.0</p>
<h3 id="rangedate类型">range（date类型）<a hidden class="anchor" aria-hidden="true" href="#rangedate类型">#</a></h3>
<p>es的日期函数由两部分组成。
第一部分：
以固定日期开头，如：2022-03-31 16:16:55。
以 now 开头。
是以“||”结尾的时间字符串，如：2022-03-31||。</p>
<p>第二部分：固定日期后面可接一个或多个数学表达式。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>多个数学表达式，如：
</span></span><span style="display:flex;"><span>+1h：增加一小时
</span></span><span style="display:flex;"><span>-1d：减少一天
</span></span><span style="display:flex;"><span>/d：四舍五入到最近的一天
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>支持的时间单位：
</span></span><span style="display:flex;"><span>y-Years
</span></span><span style="display:flex;"><span>M-Months
</span></span><span style="display:flex;"><span>w-Weeks
</span></span><span style="display:flex;"><span>d-Days
</span></span><span style="display:flex;"><span>h-Hours
</span></span><span style="display:flex;"><span>H-Hours
</span></span><span style="display:flex;"><span>m-Minutes
</span></span><span style="display:flex;"><span>s-Seconds
</span></span></code></pre></td></tr></table>
</div>
</div><p>看几个Date Math 示例加以理解。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>比如当前时间：now = 2020-05-26 13:00:00
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>now + 1h ：now的毫秒值 + 1小时，结果为：2020-05-26 14:00:00
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>now-1h/d：now的毫秒值 - 1小时，再根据情况四舍五入到最近的一天的起始：2020-05-26 00:00:00 或者 结束：2020-05-26 23:59:59.999
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2020-05-26||-1M/M：2020-05-26 的毫秒值 - 1个月，再根据情况四舍五入到最近的一月的起始：2020-04-01 00:00:00 或者 结束：2020-04-30 23:59:59.999
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里说的“<strong>根据情况四舍五入</strong>”就是下面即将介绍的<code>date math to round</code></p>
<h4 id="date-math-to-round">date math to round<a hidden class="anchor" aria-hidden="true" href="#date-math-to-round">#</a></h4>
<p>当使用日期函数，将日期四舍五入到最接近的日期、月份、小时等，四舍五入的日期取决于范围的结尾是包含端点还是排除端点。</p>
<p>包含端点：gte（大于等于） 和 lte（小于等于） 就是包含端点。
不包含端点：gt（大于） 和 lt（小于） 就是不包含端点。</p>
<p>包含端点：按最大范围四舍五入
gte（大于或等于）四舍五入的日期：<code>2020-05-25||/M</code>变为<code>2020-05-01</code>，即包括整个月份。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;range&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;createAt&#34;</span> : {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;gte&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2020-05-25||/M&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">等价于sql【where</span> <span style="color:#f00">createAt</span> <span style="color:#f00">&gt;=</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-01 00:00:00&#34;</span><span style="color:#f00">】</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>lte （小于或等于）四舍五入的日期：<code>2020-05-25||/M</code>变为<code>2020-05-31T23:59:59.999</code>，即包括整个月份。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;range&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;createAt&#34;</span> : {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;lte&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2020-05-01||/M&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">等价于sql【where</span> <span style="color:#f00">createAt</span> <span style="color:#f00">&lt;=</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-31 23:59:59.999&#34;</span><span style="color:#f00">】</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>排除端点：按最小范围四舍五入。</p>
<p>gt 大于四舍五入的日期：<code>2020-05-01||/M</code>变为<code>2020-05-31T23:59:59.999</code>，即排除整个月份。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;range&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;createAt&#34;</span> : {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;gt&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2020-05-01||/M&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">等价于sql【where</span> <span style="color:#f00">createAt</span> <span style="color:#f00">&gt;</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-31T23:59:59.999&#34;</span><span style="color:#f00">】</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>lt 少于四舍五入的日期：<code>2020-05-31||/M</code>变为<code>2020-05-01</code>，即排除整个月份。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;range&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;createAt&#34;</span> : {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;lt&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2020-05-31||/M&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">等价于sql【where</span> <span style="color:#f00">createAt</span> <span style="color:#f00">&lt;</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-01 00:00:00&#34;</span><span style="color:#f00">】</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="使用日期函数进行检索">使用日期函数进行检索<a hidden class="anchor" aria-hidden="true" href="#使用日期函数进行检索">#</a></h4>
<p>以下示例，基于now = 2020-05-25 23:00:00</p>
<ul>
<li>获取昨天发布的博客</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;range&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;createAt&#34;</span> : {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;gte&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;now-1d/d&#34;</span>,
</span></span><span style="display:flex;"><span>               <span style="font-weight:bold">&#34;lt&#34;</span> :  <span style="color:#0ff;font-weight:bold">&#34;now/d&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">等价于sql【where</span> <span style="color:#f00">createAt</span> <span style="color:#f00">&gt;=</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-24 00:00:00&#34;</span> <span style="color:#f00">and</span> <span style="color:#f00">createAt</span>  <span style="color:#f00">&lt;</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-25 00:00:00&#34;</span><span style="color:#f00">】</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>获取一周内发布的博客</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;range&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;createAt&#34;</span> : {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;gte&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;now-1w/d&#34;</span>,
</span></span><span style="display:flex;"><span>               <span style="font-weight:bold">&#34;lt&#34;</span> :  <span style="color:#0ff;font-weight:bold">&#34;now/d&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">等价于sql【where</span> <span style="color:#f00">createAt</span> <span style="color:#f00">&gt;=</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-18 00:00:00&#34;</span> <span style="color:#f00">and</span> <span style="color:#f00">createAt</span>  <span style="color:#f00">&lt;</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-25 00:00:00&#34;</span><span style="color:#f00">】</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>获取本月内发布的博客</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;range&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;createAt&#34;</span> : {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;gte&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;now/M&#34;</span>,
</span></span><span style="display:flex;"><span>               <span style="font-weight:bold">&#34;lte&#34;</span> :  <span style="color:#0ff;font-weight:bold">&#34;now/M&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">等价于sql【where</span> <span style="color:#f00">createAt</span> <span style="color:#f00">&gt;=</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-01 00:00:00&#34;</span> <span style="color:#f00">and</span> <span style="color:#f00">createAt</span>  <span style="color:#f00">&lt;</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-31 23:59:59.999&#34;</span><span style="color:#f00">】</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="日期格式">日期格式<a hidden class="anchor" aria-hidden="true" href="#日期格式">#</a></h4>
<p>对日期字段进行检索时，默认使用被检索字段的format，但是可以通过<code>format</code>参数覆盖。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;range&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;createAt&#34;</span> : {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;gte&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;20/05/2020&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;lte&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;format&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;dd/MM/yyyy||yyyy&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">请注意，如果日期缺少年，月和日的某些坐标，则丢失的部分将以unix</span> <span style="color:#f00">time的开始（即</span><span style="color:#ff0;font-weight:bold">1970</span><span style="color:#f00">年</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">月</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">日）填充</span> <span style="color:#f00">。</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">这意味着，例如，当指定dd格式时，</span><span style="color:#0ff;font-weight:bold">&#34;gte&#34;</span> <span style="color:#f00">:</span> <span style="color:#ff0;font-weight:bold">10</span> <span style="color:#f00">将使用翻译成</span><span style="color:#ff0;font-weight:bold">1970-01-10</span><span style="color:#f00">T</span><span style="color:#ff0;font-weight:bold">00</span><span style="color:#f00">:</span><span style="color:#ff0;font-weight:bold">00</span><span style="color:#f00">:</span><span style="color:#ff0;font-weight:bold">0</span><span style="color:#ff0;font-weight:bold">0.000</span><span style="color:#f00">Z。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">等价于sql【where</span> <span style="color:#f00">createAt</span> <span style="color:#f00">&gt;=</span> <span style="color:#0ff;font-weight:bold">&#34;2020-05-24T00:00:00Z&#34;</span> <span style="color:#f00">and</span> <span style="color:#f00">createAt</span> <span style="color:#f00">&lt;</span> <span style="color:#0ff;font-weight:bold">&#34;2021-01-01T00:00:00.000Z&#34;</span> <span style="color:#f00">】</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果没有 <code>format</code>，上述DSL执行将报<code>parse_exception</code>异常，因为date类型默认只支持3种格式。</p>
<h4 id="对类型为-range-字段的查询">对类型为 range 字段的查询<a hidden class="anchor" aria-hidden="true" href="#对类型为-range-字段的查询">#</a></h4>
<p>文档1【&ldquo;gte&rdquo;:10,&ldquo;lte&rdquo;:15】
文档2【&ldquo;gte&rdquo;:10,&ldquo;lte&rdquo;:20】
文档3【&ldquo;gte&rdquo;:15,&ldquo;lte&rdquo;:18】
文档4【&ldquo;gte&rdquo;:15,&ldquo;lt&rdquo;:18】
文档5【&ldquo;gt&rdquo;:15,&ldquo;lt&rdquo;:18】</p>
<p>WITHIN：文档的范围字段要完全在检索关键词的范围里。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /blogs_index/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34; : {
</span></span><span style="display:flex;"><span>    &#34;range&#34; : {
</span></span><span style="display:flex;"><span>      &#34;age_range&#34;: {
</span></span><span style="display:flex;"><span>        &#34;gte&#34; : 12,
</span></span><span style="display:flex;"><span>        &#34;lte&#34; : 17,
</span></span><span style="display:flex;"><span>        &#34;relation&#34; : &#34;within&#34;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以检索到文档4和文档5，【15,18）完全在【12,17】范围里。</p>
<p>CONTAINS：文档的范围字段完全包含检索关键词的范围；</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /blogs_index/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34; : {
</span></span><span style="display:flex;"><span>    &#34;range&#34; : {
</span></span><span style="display:flex;"><span>      &#34;age_range&#34;: {
</span></span><span style="display:flex;"><span>        &#34;gte&#34; : 12,
</span></span><span style="display:flex;"><span>        &#34;lte&#34; : 17,
</span></span><span style="display:flex;"><span>        &#34;relation&#34; : &#34;CONTAINS&#34;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以检索到文档2，只有【10,20】完全包含【12,17】范围。</p>
<p>INTERSECTS：（为默认值）文档的范围字段与检索关键词的范围有交集即可。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /blogs_index/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34; : {
</span></span><span style="display:flex;"><span>    &#34;range&#34; : {
</span></span><span style="display:flex;"><span>      &#34;influence&#34;: {
</span></span><span style="display:flex;"><span>        &#34;gte&#34; : 12,
</span></span><span style="display:flex;"><span>        &#34;lte&#34; : 17,
</span></span><span style="display:flex;"><span>        &#34;relation&#34; : &#34;CONTAINS&#34;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以检索到所有文档，都有交集。</p>
<h3 id="exists">exists<a hidden class="anchor" aria-hidden="true" href="#exists">#</a></h3>
<p>查找指定字段包含至少包含一个非空值的文档。等价于sql<code>where name is not null</code>
空值的界定：</p>
<ul>
<li>null</li>
<li>空数组[]</li>
<li>该字段在映射中设置了 &ldquo;index&rdquo;：false</li>
<li>字段值的长度超过了映射中的ignore_above设置。</li>
</ul>
<p>注：<code>&quot;&quot;</code>会被查出来，因为<code>&quot;&quot;</code>不是null。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;exists&#34;: {
</span></span><span style="display:flex;"><span>      &#34;field&#34;: &#34;phone&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询 phone 字段不为空的文档。</p>
<p>查询某个为空的字段，可以用 <code>mast_not和exists</code>配合。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;bool&#34;: {
</span></span><span style="display:flex;"><span>      &#34;must_not&#34;: {
</span></span><span style="display:flex;"><span>        &#34;exists&#34;: {
</span></span><span style="display:flex;"><span>          &#34;field&#34;: &#34;user.id&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="perfix">perfix<a hidden class="anchor" aria-hidden="true" href="#perfix">#</a></h3>
<p>前缀匹配。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;prefix&#34;: {
</span></span><span style="display:flex;"><span>      &#34;address&#34;: {
</span></span><span style="display:flex;"><span>        &#34;value&#34;: &#34;北京&#34;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>等价于sql：where author like &#39;北京%&#39;
</span></span><span style="display:flex;"><span>等价于 wildcard query 的 &#34;wildcard&#34; : { &#34;author&#34;: &#34;方*&#34; }
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询address字段中，带有<code>北京</code>前缀的文档。</p>
<p>你可以使用<code>index_prefixes</code>映射参数来加快前缀查询的速度。如果启用，Elasticsearch会在一个单独的字段中为2到5个字符的前缀建立索引。这可以让Elasticsearch更有效地运行前缀查询，但代价是索引会变得更大。</p>
<h3 id="wildcard">wildcard<a hidden class="anchor" aria-hidden="true" href="#wildcard">#</a></h3>
<p>通配符查询。等价于mysql 的 like 查询。
下面的搜索会返回<code>user.name</code>字段包含以ki开头，以y结尾的术语的文档，这些匹配的术语可以包括kiy，kity，或kimchy。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;wildcard&#34;: {
</span></span><span style="display:flex;"><span>      &#34;user.name&#34;: {
</span></span><span style="display:flex;"><span>        &#34;value&#34;: &#34;ki*y&#34;,
</span></span><span style="display:flex;"><span>        &#34;boost&#34;: 1.0,
</span></span><span style="display:flex;"><span>        &#34;rewrite&#34;: &#34;constant_score&#34;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>支持两个通配符：
<code>*</code>：<strong>匹配任何字符</strong>序列（包括空字符）。
<code>?</code>：匹配任何<strong>单个字符</strong>。</p>
<h3 id="regexp">regexp<a hidden class="anchor" aria-hidden="true" href="#regexp">#</a></h3>
<p>正则表达式匹配。
正则表达式是一种使用占位符（称为操作符）来匹配数据模式的方法。
下面的搜索返回<code>user.id</code>字段包含任何以k开头，以y结尾的术语的文档。<code>.*</code>操作符匹配任何长度的字符，包括无字符。匹配的术语可以包括ky，kay，和kimchy。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;regexp&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;user.id&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;value&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;k.*y&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;flags&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ALL&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;case_insensitive&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;max_determinized_states&#34;</span>: <span style="color:#ff0;font-weight:bold">10000</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;rewrite&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;constant_score&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>regexp查询的性能和正则表达式相关。为了提高性能，避免使用通配符模式，如<code>.*或.*?+</code>，没有前缀或后缀。</p>
<h3 id="fuzzy">fuzzy<a hidden class="anchor" aria-hidden="true" href="#fuzzy">#</a></h3>
<p>模糊查询，返回与搜索内容相近的文档，依据编辑距离算法。
编辑距离：将一个字符串转化成另一个字符串所需的操作次数。如果它们的距离越大，说明它们越是不同。变化方式有以下几种：
改变一个字符 (box → fox)
移除一个字符 (black → lack)
插入一个字符 (sic → sick)
两个相邻字符换位置 (act → cat)</p>
<p>简单示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;fuzzy&#34;: {
</span></span><span style="display:flex;"><span>      &#34;username&#34;: {
</span></span><span style="display:flex;"><span>        &#34;value&#34;: &#34;王靖尧&#34;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用高级参数示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;fuzzy&#34;: {
</span></span><span style="display:flex;"><span>      &#34;username&#34;: {
</span></span><span style="display:flex;"><span>        &#34;value&#34;: &#34;王靖尧&#34;,
</span></span><span style="display:flex;"><span>        &#34;fuzziness&#34;: &#34;AUTO&#34;,
</span></span><span style="display:flex;"><span>        &#34;max_expansions&#34;: 50,
</span></span><span style="display:flex;"><span>        &#34;prefix_length&#34;: 0,
</span></span><span style="display:flex;"><span>        &#34;transpositions&#34;: true,
</span></span><span style="display:flex;"><span>        &#34;rewrite&#34;: &#34;constant_score&#34;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>参数：
value：必须参数，你想要匹配的内容。
fuzziness：最大编辑距离，默认auto。
max_expansions：模糊查询能扩展的最大词数，默认为50。
prefix_length：不会“模糊化”的初始字符数，这有助于减少必须检查的术语数量，默认为0。</p>
<h3 id="ids">ids<a hidden class="anchor" aria-hidden="true" href="#ids">#</a></h3>
<p>文档id查询，查文档的<code>_id</code>字段。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;ids&#34; : {
</span></span><span style="display:flex;"><span>      &#34;values&#34; : [&#34;1&#34;, &#34;4&#34;, &#34;100&#34;]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="mapping-设置指南">mapping 设置指南<a hidden class="anchor" aria-hidden="true" href="#mapping-设置指南">#</a></h1>
<h2 id="什么是-mapping">什么是 mapping？<a hidden class="anchor" aria-hidden="true" href="#什么是-mapping">#</a></h2>
<p>Mapping 类似于数据库中的表结构定义 schema，它有以下几个作用：</p>
<ul>
<li>定义索引中字段的名称；</li>
<li>定义字段的数据类型，比如 text、keyword、date；</li>
<li>倒排索引的相关配置，比如设置某个字段为不被索引；</li>
</ul>
<h2 id="基础配置">基础配置<a hidden class="anchor" aria-hidden="true" href="#基础配置">#</a></h2>
<p>properties。
mappings、object字段和nested字段包含的子字段就叫做 properties，示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: { 
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;manager&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;properties&#34;</span>: { 
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;age&#34;</span>:  { <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;integer&#34;</span> },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;name&#34;</span>: { <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>  }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;employees&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;nested&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;properties&#34;</span>: { 
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;age&#34;</span>:  { <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;integer&#34;</span> },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;name&#34;</span>: { <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>  }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="分词配置">分词配置<a hidden class="anchor" aria-hidden="true" href="#分词配置">#</a></h2>
<h3 id="fields">fields<a hidden class="anchor" aria-hidden="true" href="#fields">#</a></h3>
<p>对同一个字段建立不同的索引方式，即multi-field。示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;name&#34;</span>: { 
</span></span><span style="display:flex;"><span>       <span style="color:#f00">针对</span> <span style="color:#f00">name</span> <span style="color:#f00">字段，使用</span> <span style="color:#f00">standard</span> <span style="color:#f00">分词器建立索引</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;fields&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f00">针对</span> <span style="color:#f00">name.sub_name</span> <span style="color:#f00">字段，使用</span> <span style="color:#f00">english</span> <span style="color:#f00">分词器建立索引</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;sub_name&#34;</span>: { 
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;type&#34;</span>:     <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;english&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="analyzer">analyzer<a hidden class="anchor" aria-hidden="true" href="#analyzer">#</a></h3>
<p>analyzer就是分词器。设置text类型字段索引时的分词器。</p>
<p>es 是如何确定 analyzer 的？</p>
<ol>
<li>首先读取字段的“analyzer”配置</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>PUT my_index
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;mappings&#34;: {
</span></span><span style="display:flex;"><span>    &#34;properties&#34;: {
</span></span><span style="display:flex;"><span>      &#34;title&#34;: {
</span></span><span style="display:flex;"><span>        &#34;type&#34;: &#34;text&#34;,
</span></span><span style="display:flex;"><span>        &#34;analyzer&#34;: &#34;whitespace&#34;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 指定字段 title 建立倒排索引时的 analyzer 为 whitespace
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>如果字段没有配置分词器，再读取index的setting：<code>analysis.analyzer.default</code></li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;settings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;analysis&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;default&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;english&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>还没有，则使用默认的 standard 标准分词器。</li>
</ol>
<h3 id="search_analyzer">search_analyzer<a hidden class="anchor" aria-hidden="true" href="#search_analyzer">#</a></h3>
<p>设置 search 时使用的分词器。
ElasticSearch 如何确定 search 时的 analyzer ？</p>
<ol>
<li>首先找搜索时指定 analyzer</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;message&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;query&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;Quick foxes&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;stop&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>如果搜索时没指定 search_analyzer，则读取 index 的 mapping 字段配置 search_analyzer。</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;title&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;whitespace&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;search_analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;simple&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>还没有，则读取 index 的 setting 的 <code>analysis.analyzer.default_search</code></li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>PUT my_index
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;settings&#34;: {
</span></span><span style="display:flex;"><span>    &#34;analysis&#34;: {
</span></span><span style="display:flex;"><span>      &#34;analyzer&#34;: {
</span></span><span style="display:flex;"><span>        &#34;default&#34;: {
</span></span><span style="display:flex;"><span>          &#34;type&#34;: &#34;simple&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;default_search&#34;: {
</span></span><span style="display:flex;"><span>          &#34;type&#34;: &#34;whitespace&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>还没有，则使用 field 的 analyzer</li>
<li>都没有，使用默认的 standard analyzer</li>
</ol>
<h3 id="normalizer">normalizer<a hidden class="anchor" aria-hidden="true" href="#normalizer">#</a></h3>
<p>normalizer是 keyword的一个属性，可以对 keyword生成的单一 Term再做进一步的处理，比如 lowercase，即做小写变换。使用方法和自定义分词器有些类似，需要自定义，如下所示：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">DELETE</span> <span style="color:#f00">test_normalizer</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">自定义</span> <span style="color:#f00">normalizer</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">test_normalizer</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;settings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;analysis&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;normalizer&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;lowercase&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;custom&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;filter&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;lowercase&#34;</span>
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;doc&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type_normalizer&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;normalizer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;lowercase&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">test_normalizer/doc/</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;apple&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;type_normalizer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;apple&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">test_normalizer/doc/</span><span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;Apple&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;type_normalizer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;Apple&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">查询三</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">test_normalizer/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;term&#34;</span>:{
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;aPple&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">查询四</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">test_normalizer/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;term&#34;</span>:{
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;type_normalizer&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;aPple&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们第一步是自定义了名为 lowercase的 normalizer，其中filter 类似自定义分词器中的 filter ，但是可用的种类很少，详情大家可以查看官方文档。然后通过 normalizer属性设定到字段type_normalizer中，然后插入相同的2条文档。执行发现，查询三无结果返回，查询四返回2条文档。问题解决了！我们来看下是如何解决的</p>
<ol>
<li>文档写入时由于加入了 normalizer,所有的 term都会被做小写处理</li>
<li>查询时搜索词同样采用有 normalizer的配置，因此处理后的 term也是小写的</li>
<li>两边分词匹对，就得到了我们上面的结果</li>
</ol>
<h2 id="相关性配置">&ldquo;相关性&quot;配置<a hidden class="anchor" aria-hidden="true" href="#相关性配置">#</a></h2>
<h3 id="boost">boost<a hidden class="anchor" aria-hidden="true" href="#boost">#</a></h3>
<p>增加字段的权重。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;title&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;boost&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span> 
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;content&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="数据处理配置">数据处理配置<a hidden class="anchor" aria-hidden="true" href="#数据处理配置">#</a></h2>
<h3 id="dynamic">dynamic<a hidden class="anchor" aria-hidden="true" href="#dynamic">#</a></h3>
<p>是否可以动态添加新字段。可选参数：</p>
<ul>
<li>true：动态添加新的字段（默认）</li>
<li>false：忽略新的字段，但是会存在于<code>_source</code>中；</li>
<li>strict：如果遇到新字段抛出异常【推荐】。</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;my_type&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;dynamic&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;strict&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;title&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;string&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;stash&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;dynamic&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;strict&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="format">format<a hidden class="anchor" aria-hidden="true" href="#format">#</a></h3>
<p>为 date 类型的字段指定格式，ES的date类型允许我们规定格式，可以使用的格式有3种：
yyyy-MM-dd HH:mm:ss
yyyy-MM-dd
epoch_millis（毫秒值）
示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">规定格式如下：||</span> <span style="color:#f00">表示或者</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;_doc&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;createDate&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;type&#34;</span>:   <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;format&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">注意：一旦我们规定了格式，如果新增数据不符合这个格式，ES将会报错mapper_parsing_exception。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="性能配置">性能配置<a hidden class="anchor" aria-hidden="true" href="#性能配置">#</a></h2>
<h3 id="enabled">enabled<a hidden class="anchor" aria-hidden="true" href="#enabled">#</a></h3>
<p>设置成 false，仅做存储，不⽀持搜索和聚合分析，数据保存在 <code>_source</code>中。
enabled设置仅可应用于顶级映射定义和object字段，示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;user_id&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>:  <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;last_updated&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;session_data&#34;</span>: { 
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;enabled&#34;</span>: <span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">任何任意数据都可以传递到该session_data字段，因为它将被完全忽略。</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index/_doc/session_</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;user_id&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;kimchy&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;session_data&#34;</span>: { 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;arbitrary_object&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;some_array&#34;</span>: [ <span style="color:#0ff;font-weight:bold">&#34;foo&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;bar&#34;</span>, { <span style="font-weight:bold">&#34;baz&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span> } ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;last_updated&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2015-12-06T18:20:22&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index/_doc/session_</span><span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;user_id&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;jpountz&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;session_data&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;none&#34;</span>, 
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;last_updated&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2015-12-06T18:22:13&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="doc_values">doc_values<a hidden class="anchor" aria-hidden="true" href="#doc_values">#</a></h3>
<p>doc_values 默认对所有字段启用，除了 text。禁用 doc_values，可以节省磁盘空间，仍然可以查询，但字段不能被用于聚合、排序以及脚本操作。示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">创建索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;status_code&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;session_id&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;doc_values&#34;</span>: <span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">存数据</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/my_index/_doc/</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;session_id&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;关注我&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">可以检索到</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;session_id&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;value&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;关注我&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">聚合操作，直接报错</span> <span style="color:#f00">illegal_argument_exception</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span> <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>   <span style="font-weight:bold">&#34;test_agg&#34;</span>: {
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;session_id&#34;</span>,
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果你确定永远也不会对某些字段进行聚合、排序或是使用脚本操作，就可以通过禁用特定字段的 doc_values，这样可以节省磁盘空间。</p>
<h3 id="index">index<a hidden class="anchor" aria-hidden="true" href="#index">#</a></h3>
<p>设置为 false，不构建倒排索引，不能被查询，但还是⽀持 aggregation，排序，脚本，并出现在 <code>_source</code>，与doc_values 的效果相反。示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">创建索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;test_field&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>,
</span></span><span style="display:flex;"><span>         <span style="font-weight:bold">&#34;index&#34;</span>: <span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">存数据</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/my_index/_doc/</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;test_field&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;关注我&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">查询，直接报错</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;test_field&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;value&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;关注我&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">可以聚合</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span> <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>   <span style="font-weight:bold">&#34;test_agg&#34;</span>: {
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;test_field&#34;</span>,
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为倒排索引在index时会序列化到磁盘，所以该配置设置为false，也节约磁盘。</p>
<h3 id="fielddata">fielddata<a hidden class="anchor" aria-hidden="true" href="#fielddata">#</a></h3>
<p>对 text 字段，该参数默认是禁止的，所以直接对 text 字段进行聚合、排序或在脚本中使用时，es 会报错。如果需要对 text 字段进行聚合，可以开启该配置。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;test_field&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;fielddata&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;test_field2&#34;</span>:{
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/my_index/_doc/</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;test_field&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;点个在看&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;test_field2&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;可好&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">可以聚合</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>, 
</span></span><span style="display:flex;"><span> <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>   <span style="font-weight:bold">&#34;test_agg&#34;</span>: {
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;test_field&#34;</span>,
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">聚合报错</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>, 
</span></span><span style="display:flex;"><span> <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>   <span style="font-weight:bold">&#34;test_agg&#34;</span>: {
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;test_field2&#34;</span>,
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是，一旦将 fielddata 加载到 JVM 的 Heap 中，在该 segment 的生命周期内会一直保留在堆中，所以使用 fielddata 会占用大量的堆内存，影响性能。而对于非 text 类型字段的聚合，大多数使用的都是 doc_value，根据ElasticSearch官网对其的描述：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Doc Values 是在索引时与倒排索引同时生成。也就是说 Doc Values 和 倒排索引 一样，基于 Segement 生成并且是不可变的。同时 Doc Values 和 倒排索引 一样序列化到磁盘，这样对性能和扩展性有很大帮助。Doc Values 通过序列化把数据结构持久化到磁盘，我们可以充分利用操作系统的内存，而不是 JVM 的 Heap 。 当 working set 远小于系统的可用内存，系统会自动将 Doc Values 驻留在内存中，使得其读写十分快速；不过，当其远大于可用内存时，系统会根据需要从磁盘读取 Doc Values，然后选择性放到分页缓存中。很显然，这样性能会比在内存中差很多，但是它的大小就不再局限于服务器的内存了。
</span></span></code></pre></td></tr></table>
</div>
</div><p>综上，个人建议，如有对 text 类型字段进行聚合、排序等需求，建议通过 fields 配置多字段：新增 keyword类型，同时将 index 参数设置为false，示例如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;my_field&#34;</span>: { 
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;fields&#34;</span>: {
</span></span><span style="display:flex;"><span>         <span style="color:#f00">该字段只用于聚合、排序等，所以关闭了index</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;keyword&#34;</span>: { 
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;index&#34;</span>:<span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/my_index/_doc/</span><span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;my_field&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;点个在看,可好&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">可以聚合</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>, 
</span></span><span style="display:flex;"><span> <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>   <span style="font-weight:bold">&#34;test_agg&#34;</span>: {
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;my_field.keyword&#34;</span>,
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="store-与-_source-对比">store 与 _source 对比<a hidden class="anchor" aria-hidden="true" href="#store-与-_source-对比">#</a></h3>
<p>store：默认 false，不存储，数据默认存储在 <code>_source</code>中。
如果字段的 store 被设置为 true，则在 lucence 中该字段的值被单独存储。
设置为 true 后，通过<code>stored_filed</code> 显示。</p>
<p><code>_source</code>：以json格式存储在<code>_source</code>字段中。
在lucence 中<code>_source</code>只是一个字段。
官方不建议关闭，因为关闭后会由很多限制。</p>
<p>对比分析：
从每一个 stored field 中获取值都需要一次磁盘 io，如果想获取多个 field 的值，就需要多次磁盘 io ，但是，如果从 _source 中获取多个 field 的值，则只需要一次磁盘 io ，因为 _source 只是一个字段，而且_source是被压缩过的。所以在大多数情况下，从 _source 中获取是快速而高效的。</p>
<p>哪些情形下需要显式的指定 store 属性呢？
如果你的文档长度很长，存储 _source 或者从 _source 中获取 field 的代价很大，你可以显式的将某些 field 的 store 属性设置为 yes。此时只查询这一个字段的值的，效率高。</p>
<h2 id="完整示例">完整示例<a hidden class="anchor" aria-hidden="true" href="#完整示例">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">90
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/blogs_index/</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;settings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;index&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;number_of_shards&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;number_of_replicas&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;analysis&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;pinyin_analyzer&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;tokenizer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;standard&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;filter&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;my_pinyin&#34;</span>
</span></span><span style="display:flex;"><span>          ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;filter&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;my_pinyin&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;pinyin&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;keep_first_letter&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;keep_separate_first_letter&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;keep_full_pinyin&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;keep_original&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;limit_first_letter_length&#34;</span>: <span style="color:#ff0;font-weight:bold">16</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;lowercase&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f00">禁止新增字段</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;dynamic&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;strict&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;id&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;integer&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;author&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f00">对作者使用拼音分词</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;pinyin_analyzer&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;fields&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f00">建立多字段，用于聚合</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;keyword&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;index&#34;</span>:<span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f00">博客的分类，支持</span> <span style="color:#f00">term</span> <span style="color:#f00">查询</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;blog_sort&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f00">需要聚合，且数据量较大，但唯一值较少</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;eager_global_ordinals&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f00">提升该字段的权重</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;boost&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;title&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_max_word&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f00">检索的分词没必要细粒度，提升效率</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;search_analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_smart&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f00">对</span> <span style="color:#f00">标题</span> <span style="color:#f00">不需要聚合、排序</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;doc_values&#34;</span>: <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f00">提升该字段的权重</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;boost&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;content&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_max_word&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;search_analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_smart&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f00">博客内容为大字段，单独存储，用于查询返回</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;store&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f00">不需要聚合、排序</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;doc_values&#34;</span>: <span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;update_time&#34;</span>:{
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f00">规定格式，提高可读性</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;format&#34;</span>: [<span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd HH:mm:ss&#34;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#f00">该字段仅用于显示，不用检索、聚合、排序【非object类型，不能使用</span> <span style="color:#f00">enabled</span> <span style="color:#f00">参数】</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;index&#34;</span>:<span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;doc_values&#34;</span>: <span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;create_time&#34;</span>:{
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;format&#34;</span>: [<span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd HH:mm:ss&#34;</span>]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="聚合">聚合<a hidden class="anchor" aria-hidden="true" href="#聚合">#</a></h1>
<p>ES的聚合一共有4种类型。</p>
<ul>
<li>Bucket Aggregations：桶聚合，类似于SQL的分组(GROUP BY)。</li>
<li>Metrics Aggregations：指标聚合，一些数学运算，对文档字段进行统计分析，类似于sql的COUNT()、SUM()、MAX()等统计方法。</li>
<li>Pipeline Aggregations：管道聚合，对其他聚合结果进行二次聚合</li>
<li>Matrix Aggregations：矩阵聚合，支持对多个字段的操作并提供一个结果矩阵，此功能是试验性的，在将来的版本中可能会完全更改或删除。</li>
</ul>
<p>简单示例，学会agg语法：（aggregations 可以缩写为 aggs）</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/my_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">// 和query 同级别的关键字
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>  	<span style="color:#007f7f">// 自定义聚合名
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="font-weight:bold">&#34;first_agg_name&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// 聚合的类型
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>      <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 具体字段
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;color&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// 子聚合
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>      <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      	<span style="color:#007f7f">// 自定义聚合名
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="font-weight:bold">&#34;sub_agg_name1&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#007f7f">// 聚合类型
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>          <span style="font-weight:bold">&#34;avg&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 具体字段
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;price&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 可以包含多个同级的聚合
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="font-weight:bold">&#34;sub_agg_name2&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;make&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="bucket-aggregations-桶聚合">Bucket Aggregations 桶聚合<a hidden class="anchor" aria-hidden="true" href="#bucket-aggregations-桶聚合">#</a></h2>
<p>Bucket 就是桶的意思，即按照一定的规则将文档分配到不同的桶中，达到分类分析的目的。</p>
<h3 id="terms-术语聚合">Terms 术语聚合<a hidden class="anchor" aria-hidden="true" href="#terms-术语聚合">#</a></h3>
<p>使用场景：按照某个字段的值，将分档聚合分类。等价与sql的 group by
注意：默认根据 doc_count 降序排列。
text 类型的字段需要启用 fielddata。
默认情况下，返回排序前十的存储桶，可以通过设置size参数来更改此默认行为。
返回参数解析：
sum_other_doc_count：响应中未被包含的文档总和
doc_count_error_upper_bound：每个术语的文档计数上的错误上限</p>
<p>示例：将博客系统中的文档按作者分类，得到每位作者的博文总数</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/blogs_index/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>  	<span style="color:#007f7f">// 自定义聚合名
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="font-weight:bold">&#34;author_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// 聚合类型
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>      <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 聚合字段
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;author&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">返回结果</span>
</span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;aggregations&#34;</span> <span style="color:#f00">:</span> {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;author_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;doc_count_error_upper_bound&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;sum_other_doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;方才&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;方才兄&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="rare-terms-稀有术语聚合">Rare Terms 稀有术语聚合<a hidden class="anchor" aria-hidden="true" href="#rare-terms-稀有术语聚合">#</a></h3>
<p>作用：统计最少出现的文档
排序：按doc_count 升序排列（doc_count少的在前面）
参数：</p>
<ul>
<li>field：聚合的字段</li>
<li>max_doc_count：文档最多出现的次数，默认1</li>
<li>precision：精确度，默认0.01，不能比0.00001更小</li>
<li>include：包含的值</li>
<li>exclude：不包含的值</li>
<li>missing：缺省值</li>
</ul>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">创建索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/rare_terms_test</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;name&#34;</span>: {<span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">新增数据</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">/rare_terms_test/_bulk?routing=</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">&amp;refresh</span>
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;李四&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;王五&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">4</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">6</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">7</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;李四&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">8</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;赵六&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">搜索</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/rare_terms_test/_search?size=</span><span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;rare_terms_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;rare_terms&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;max_doc_count&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;include&#34;</span>: [<span style="color:#0ff;font-weight:bold">&#34;张三&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;李四&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;王五&#34;</span>],
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;exclude&#34;</span>: [<span style="color:#0ff;font-weight:bold">&#34;赵六&#34;</span>]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">返回结果：</span>
</span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;aggregations&#34;</span> <span style="color:#f00">:</span> {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;rare_terms_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;王五&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;李四&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="histogram-直方图聚合">Histogram 直方图聚合<a hidden class="anchor" aria-hidden="true" href="#histogram-直方图聚合">#</a></h3>
<p>使用场景：根据数值（或数值范围）字段，按固定间隔将文档分类。
例如：将商品按价格区间聚合，得到不同区间的商品数量。
配置字段：</p>
<ul>
<li>field：要聚合的字段</li>
<li>interval：间隔</li>
<li>min_doc_count：不返回doc_count小于该值的存储桶</li>
<li>order：排序</li>
<li>offset：偏移量</li>
<li>keyed：更改返回格式，将key作为键返回</li>
<li>missing：缺省值</li>
</ul>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">83
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">创建索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/histogram_test</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;num&#34;</span>: {<span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;integer&#34;</span>}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">索引数据</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">/histogram_test/_bulk?routing=</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">&amp;refresh</span>
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">4</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">10</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">80</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">搜索</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/histogram_test/_search?size=</span><span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>  	<span style="color:#007f7f">// 自定义聚合的名字
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="font-weight:bold">&#34;num_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// 聚合方式
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>      <span style="font-weight:bold">&#34;histogram&#34;</span>: {
</span></span><span style="display:flex;"><span>      	<span style="color:#007f7f">// 聚合的字段
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;num&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 间隔
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="font-weight:bold">&#34;interval&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>,
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">返回结果：</span>
</span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;aggregations&#34;</span> <span style="color:#f00">:</span> {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;num_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">10.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">20.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">30.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">40.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">50.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">60.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">70.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">80.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们看到返回了很多 doc_count 为0的数据。可以通过设置 min_doc_count 来过滤掉doc_count 为0的数据。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">搜索</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/histogram_test/_search?size=</span><span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;num_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;histogram&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;num&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;interval&#34;</span>: <span style="color:#ff0;font-weight:bold">10</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;min_doc_count&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">返回结果：</span>
</span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;aggregations&#34;</span> <span style="color:#f00">:</span> {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;num_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#007f7f">// 0到10之间有3个文档
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">0.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#007f7f">// 10到20之间有1个文档
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">10.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#007f7f">// 80到90之间有1个文档
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">80.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>正常返回的数据如上面所示，是按照数组的方式返回。如果要按照名字返回，可以设置keyed为true。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>搜索
</span></span><span style="display:flex;"><span>GET /histogram_test/_search?size=0
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;aggs&#34;: {
</span></span><span style="display:flex;"><span>    &#34;num_aggs&#34;: {
</span></span><span style="display:flex;"><span>      &#34;histogram&#34;: {
</span></span><span style="display:flex;"><span>        &#34;field&#34;: &#34;num&#34;,
</span></span><span style="display:flex;"><span>        &#34;interval&#34;: 10,
</span></span><span style="display:flex;"><span>        &#34;min_doc_count&#34;: 1,
</span></span><span style="display:flex;"><span>        &#34;keyed&#34;: true
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>返回结果
</span></span><span style="display:flex;"><span>&#34;aggregations&#34; : {
</span></span><span style="display:flex;"><span>    &#34;num_aggs&#34; : {
</span></span><span style="display:flex;"><span>      &#34;buckets&#34; : {
</span></span><span style="display:flex;"><span>        &#34;0.0&#34; : {
</span></span><span style="display:flex;"><span>          &#34;key&#34; : 0.0,
</span></span><span style="display:flex;"><span>          &#34;doc_count&#34; : 3
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;10.0&#34; : {
</span></span><span style="display:flex;"><span>          &#34;key&#34; : 10.0,
</span></span><span style="display:flex;"><span>          &#34;doc_count&#34; : 1
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;80.0&#34; : {
</span></span><span style="display:flex;"><span>          &#34;key&#34; : 80.0,
</span></span><span style="display:flex;"><span>          &#34;doc_count&#34; : 1
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="date-histogram-日期直方图聚合">Date histogram 日期直方图聚合<a hidden class="anchor" aria-hidden="true" href="#date-histogram-日期直方图聚合">#</a></h3>
<p>场景：按固定日期间隔将文档分类（根据date字段 或 date range 字段）
字段：</p>
<ul>
<li>calender_interval：日期间隔。如：minute（1m）、hour（1h）、day（1d）</li>
<li>fixed_interval：固定时间间隔，如：ms、s、m、h、d</li>
<li>format：格式化返回的时间字符串</li>
<li>time_zone：时区，如：+8:00</li>
<li>offset：时间偏移量，如：+1d</li>
<li>keyed：更改返回格式，将key作为键返回</li>
<li>min_doc_count：不返回 doc_count 小于该值的存储桶</li>
<li>missing：默认值，如果字段没有值，以该参数填充</li>
<li>extended_bounds：指定返回的doc_count范围</li>
</ul>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">删除</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">DELETE</span> <span style="color:#f00">/date_histogram_test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">创建索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/date_histogram_test</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;date&#34;</span>: {<span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">索引数据</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">/date_histogram_test/_bulk?routing=</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">&amp;refresh</span>
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-29&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-28&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-27&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">4</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-30&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#fff;font-weight:bold">null</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">搜索</span> <span style="color:#f00">-</span> <span style="color:#f00">missing要与format的格式一致</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/date_histogram_test/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;date_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;date_histogram&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;calendar_interval&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;day&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;format&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;keyed&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;missing&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-30&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;order&#34;</span>: {<span style="font-weight:bold">&#34;_key&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;desc&#34;</span>},
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;time_zone&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;+08:00&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;aggregations&#34;</span> <span style="color:#f00">:</span> {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;date_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;2021-09-30&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-30&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">1632931200000</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;2021-09-29&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-29&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">1632844800000</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;2021-09-28&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-28&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">1632758400000</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;2021-09-27&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-27&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">1632672000000</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">搜索</span> <span style="color:#f00">-</span> <span style="color:#f00">missing要与format的格式一致</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/date_histogram_test/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;date_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;date_histogram&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;fixed_interval&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2d&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;format&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;keyed&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;missing&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-30&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;order&#34;</span>: {<span style="font-weight:bold">&#34;_count&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;desc&#34;</span>},
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;offset&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;+1d&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;aggregations&#34;</span> <span style="color:#f00">:</span> {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;date_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;2021-09-29&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-29&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">1632873600000</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;2021-09-27&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-27&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#ff0;font-weight:bold">1632700800000</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="auto-interval-date-histogram-自动间隔日期直方图聚合">Auto-interval Date Histogram 自动间隔日期直方图聚合<a hidden class="anchor" aria-hidden="true" href="#auto-interval-date-histogram-自动间隔日期直方图聚合">#</a></h3>
<p>场景：和日期直方图类似，不同点是可以指定返回的结果数。
参数：
buckets：指定返回的存储桶数（返回的结果会&lt;=该值）
不支持的参数：
min_doc_count、extened_bounds、order。
其他参数和日期直方图一致。</p>
<h3 id="range-范围聚合">range 范围聚合<a hidden class="anchor" aria-hidden="true" href="#range-范围聚合">#</a></h3>
<p>场景：用户自定义范围聚合。
参数：</p>
<ul>
<li>field：要聚合的字段</li>
<li>keyed：更改返回格式，将key作为键返回</li>
<li>scipt：脚本</li>
<li>ranges：范围，包括from的值，不包括to的值，即左闭右开。</li>
</ul>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">删除</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">DELETE</span> <span style="color:#f00">/range_test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">映射</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/range_test</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;num&#34;</span>: {<span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;integer&#34;</span>}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">/range_test/_bulk?routing=</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">&amp;refresh</span>
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">18</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">19</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">78</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">4</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">75</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">搜索</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/range_test/_search?size=</span><span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;range_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;range&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;num&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;keyed&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>, 
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;ranges&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;from&#34;</span>: <span style="color:#ff0;font-weight:bold">10</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;to&#34;</span>: <span style="color:#ff0;font-weight:bold">20</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;from&#34;</span>: <span style="color:#ff0;font-weight:bold">50</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;to&#34;</span>: <span style="color:#ff0;font-weight:bold">100</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;num_stats_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;stats&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;num&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;took&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;timed_out&#34;</span> : <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_shards&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;successful&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;skipped&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;failed&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;hits&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;value&#34;</span> : <span style="color:#ff0;font-weight:bold">4</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;relation&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;eq&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;max_score&#34;</span> : <span style="color:#fff;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;hits&#34;</span> : [ ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggregations&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;range_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;10.0-20.0&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;from&#34;</span> : <span style="color:#ff0;font-weight:bold">10.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;to&#34;</span> : <span style="color:#ff0;font-weight:bold">20.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;num_stats_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;min&#34;</span> : <span style="color:#ff0;font-weight:bold">18.0</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;max&#34;</span> : <span style="color:#ff0;font-weight:bold">19.0</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;avg&#34;</span> : <span style="color:#ff0;font-weight:bold">18.5</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;sum&#34;</span> : <span style="color:#ff0;font-weight:bold">37.0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;50.0-100.0&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;from&#34;</span> : <span style="color:#ff0;font-weight:bold">50.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;to&#34;</span> : <span style="color:#ff0;font-weight:bold">100.0</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;num_stats_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;min&#34;</span> : <span style="color:#ff0;font-weight:bold">75.0</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;max&#34;</span> : <span style="color:#ff0;font-weight:bold">78.0</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;avg&#34;</span> : <span style="color:#ff0;font-weight:bold">76.5</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;sum&#34;</span> : <span style="color:#ff0;font-weight:bold">153.0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="date-range-日期范围聚合">Date Range 日期范围聚合<a hidden class="anchor" aria-hidden="true" href="#date-range-日期范围聚合">#</a></h3>
<p>场景：data类型的范围聚合。
参数：</p>
<ul>
<li>field：要聚合的字段</li>
<li>format：时间格式</li>
<li>missing：缺省值</li>
<li>time_zone：时区，如UTC</li>
<li>keyed：更改返回格式，将key作为键返回</li>
<li>ranges：范围，包括from的值，不包括to的值，即左闭右开。</li>
</ul>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">删除</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">DELETE</span> <span style="color:#f00">/date_range_test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">映射</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/date_range_test</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;date&#34;</span>: {<span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">/date_range_test/_bulk?routing=</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">&amp;refresh</span>
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-29&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-28&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-27&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">4</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-30&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#fff;font-weight:bold">null</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">搜索</span> <span style="color:#f00">-</span> <span style="color:#f00">missing要与format的格式一致</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/date_range_test/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;date_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;date_range&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;format&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;keyed&#34;</span>: <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;missing&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-30&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;time_zone&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;UTC&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;ranges&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;key&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;r_1&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;from&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-27&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;to&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-28&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;key&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;r_2&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;from&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-28&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;to&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-30&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;key&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;r_3&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;from&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-30&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;to&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;now/d&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;took&#34;</span> : <span style="color:#ff0;font-weight:bold">7</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;timed_out&#34;</span> : <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_shards&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;successful&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;skipped&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;failed&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;hits&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;value&#34;</span> : <span style="color:#ff0;font-weight:bold">5</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;relation&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;eq&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;max_score&#34;</span> : <span style="color:#fff;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;hits&#34;</span> : [ ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggregations&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;date_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;r_1&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;from&#34;</span> : <span style="color:#ff0;font-weight:bold">1.6327008E12</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;from_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-27&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;to&#34;</span> : <span style="color:#ff0;font-weight:bold">1.6327872E12</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;to_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-28&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;r_2&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;from&#34;</span> : <span style="color:#ff0;font-weight:bold">1.6327872E12</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;from_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-28&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;to&#34;</span> : <span style="color:#ff0;font-weight:bold">1.63296E12</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;to_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-30&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;r_3&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;from&#34;</span> : <span style="color:#ff0;font-weight:bold">1.63296E12</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;from_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-30&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;to&#34;</span> : <span style="color:#ff0;font-weight:bold">1.6337376E12</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;to_as_string&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-10-09&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ip-range-ip范围聚合">IP Range IP范围聚合<a hidden class="anchor" aria-hidden="true" href="#ip-range-ip范围聚合">#</a></h3>
<p>场景：指定IP范围聚合。
参数：</p>
<ul>
<li>field：要聚合的字段。</li>
<li>keyed：显示键</li>
<li>ranges：from（从）-to（到），key：键的名字</li>
</ul>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">92
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">删除</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">DELETE</span> <span style="color:#f00">/ip_range_test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">映射</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/ip_range_test</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;ip&#34;</span>: {<span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ip&#34;</span>}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">/ip_range_test/_bulk?routing=</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">&amp;refresh</span>
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;ip&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;192.168.2.8&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;ip&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;192.168.2.78&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;ip&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;192.168.2.38&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">4</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;ip&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;192.168.2.58&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;ip&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;192.168.2.88&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">搜索</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/ip_range_test/_search?size=</span><span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;ip_range_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;ip_range&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ip&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;ranges&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;to&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;192.168.2.10&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;from&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;192.168.2.37&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;to&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;192.168.2.59&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;from&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;192.168.2.60&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;took&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;timed_out&#34;</span> : <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_shards&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;successful&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;skipped&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;failed&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;hits&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;value&#34;</span> : <span style="color:#ff0;font-weight:bold">5</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;relation&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;eq&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;max_score&#34;</span> : <span style="color:#fff;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;hits&#34;</span> : [ ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggregations&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;ip_range_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;*-192.168.2.10&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;to&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;192.168.2.10&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;192.168.2.37-192.168.2.59&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;from&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;192.168.2.37&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;to&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;192.168.2.59&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;192.168.2.60-*&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;from&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;192.168.2.60&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="composite-复合聚合">Composite 复合聚合<a hidden class="anchor" aria-hidden="true" href="#composite-复合聚合">#</a></h3>
<p>场景：组合分组统计。</p>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">255
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">256
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">257
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">258
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">259
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">260
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">261
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">262
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">263
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">264
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">265
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">266
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">267
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">268
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">269
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">270
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">271
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">272
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">273
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">274
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">275
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">276
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">277
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">278
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">279
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">280
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">281
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">282
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">283
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">284
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">285
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">286
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">287
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">288
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">289
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">290
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">291
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">292
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">293
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">294
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">295
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">296
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">297
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">298
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">299
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">300
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">301
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">302
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">303
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">304
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">305
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">306
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">307
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">308
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">309
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">310
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">311
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">312
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">313
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">314
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">315
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">316
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">317
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">318
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">319
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">320
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">321
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">322
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">323
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">324
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">325
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">326
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">327
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">328
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">329
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">330
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">331
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">332
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">删除</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">DELETE</span> <span style="color:#f00">/composite_test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">映射</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/composite_test</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;name&#34;</span>: {<span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>},
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;num&#34;</span>: {<span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;integer&#34;</span>},
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;date&#34;</span>: {<span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">/composite_test/_bulk?routing=</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">&amp;refresh</span>
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>, <span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>, <span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2021-09-29&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;good&#34;</span>, <span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>, <span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2020-09-29&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;me&#34;</span>, <span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>, <span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2024-09-29&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">4</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>, <span style="font-weight:bold">&#34;num&#34;</span>: <span style="color:#ff0;font-weight:bold">7</span>, <span style="font-weight:bold">&#34;date&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;2024-09-29&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">搜索</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/composite_test/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;com_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;composite&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;sources&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;names&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;took&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;timed_out&#34;</span> : <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_shards&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;successful&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;skipped&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;failed&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;hits&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;value&#34;</span> : <span style="color:#ff0;font-weight:bold">4</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;relation&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;eq&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;max_score&#34;</span> : <span style="color:#fff;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;hits&#34;</span> : [ ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggregations&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;com_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;after_key&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;names&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;me&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;names&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;good&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;names&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;names&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;me&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">搜索</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/composite_test/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;com_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;composite&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;sources&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;nums&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;histogram&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;num&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;interval&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;took&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;timed_out&#34;</span> : <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_shards&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;successful&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;skipped&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;failed&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;hits&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;value&#34;</span> : <span style="color:#ff0;font-weight:bold">4</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;relation&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;eq&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;max_score&#34;</span> : <span style="color:#fff;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;hits&#34;</span> : [ ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggregations&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;com_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;after_key&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;nums&#34;</span> : <span style="color:#ff0;font-weight:bold">6.0</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;nums&#34;</span> : <span style="color:#ff0;font-weight:bold">2.0</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;nums&#34;</span> : <span style="color:#ff0;font-weight:bold">4.0</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;nums&#34;</span> : <span style="color:#ff0;font-weight:bold">6.0</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">搜索</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/composite_test/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;com_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;composite&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;sources&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;dates&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;date_histogram&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;calendar_interval&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;1d&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;format&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;took&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;timed_out&#34;</span> : <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_shards&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;successful&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;skipped&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;failed&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;hits&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;value&#34;</span> : <span style="color:#ff0;font-weight:bold">4</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;relation&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;eq&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;max_score&#34;</span> : <span style="color:#fff;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;hits&#34;</span> : [ ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggregations&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;com_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;after_key&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;dates&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2024-09-29&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;dates&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2020-09-29&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;dates&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-29&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;dates&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2024-09-29&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">搜索</span> <span style="color:#f00">-</span> <span style="color:#f00">组合统计</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/composite_test/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;com_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;composite&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;sources&#34;</span>: [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;names&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          },{
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;nums&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;histogram&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;num&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;interval&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          },{
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;dates&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">&#34;date_histogram&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;calendar_interval&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;1d&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;format&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;took&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;timed_out&#34;</span> : <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_shards&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;successful&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;skipped&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;failed&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;hits&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;value&#34;</span> : <span style="color:#ff0;font-weight:bold">4</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;relation&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;eq&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;max_score&#34;</span> : <span style="color:#fff;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;hits&#34;</span> : [ ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggregations&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;com_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;after_key&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;names&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;me&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;nums&#34;</span> : <span style="color:#ff0;font-weight:bold">4.0</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;dates&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2024-09-29&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;buckets&#34;</span> : [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;names&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;good&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;nums&#34;</span> : <span style="color:#ff0;font-weight:bold">4.0</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;dates&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2020-09-29&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;names&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;nums&#34;</span> : <span style="color:#ff0;font-weight:bold">2.0</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;dates&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2021-09-29&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;names&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;nums&#34;</span> : <span style="color:#ff0;font-weight:bold">6.0</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;dates&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2024-09-29&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;key&#34;</span> : {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;names&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;me&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;nums&#34;</span> : <span style="color:#ff0;font-weight:bold">4.0</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;dates&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;2024-09-29&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="missing-缺少聚合">missing 缺少聚合<a hidden class="anchor" aria-hidden="true" href="#missing-缺少聚合">#</a></h3>
<p>场景：获取指定字段没有值或配置为null的文档数
等价sql：<code>select count(*) from table_a where name is null</code></p>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">删除</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">DELETE</span> <span style="color:#f00">/missing_test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">映射</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">/missing_test</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;name&#34;</span>: {<span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">索引</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">/missing_test/_bulk?routing=</span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">&amp;refresh</span>
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;good&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;me&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">4</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#fff;font-weight:bold">null</span>}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;index&#34;</span>: {<span style="font-weight:bold">&#34;_id&#34;</span>: <span style="color:#ff0;font-weight:bold">5</span>}}
</span></span><span style="display:flex;"><span>{<span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#fff;font-weight:bold">null</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">搜索</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">/missing_test/_search?size=</span><span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;missing_aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;missing&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;took&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;timed_out&#34;</span> : <span style="color:#fff;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_shards&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;successful&#34;</span> : <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;skipped&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;failed&#34;</span> : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;hits&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;total&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;value&#34;</span> : <span style="color:#ff0;font-weight:bold">5</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;relation&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;eq&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;max_score&#34;</span> : <span style="color:#fff;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;hits&#34;</span> : [ ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggregations&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;missing_aggs&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;doc_count&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="metrics-agg-指标聚合">Metrics Agg 指标聚合<a hidden class="anchor" aria-hidden="true" href="#metrics-agg-指标聚合">#</a></h2>
<p>Metrics Aggregations 指标聚合，就是一些数学运算，对文档字段进行统计分析，类似于 sql 的 COUNT() 、 SUM() 、 MAX() 等统计方法。</p>
<h3 id="avgmaxminsum">avg、max、min、sum<a hidden class="anchor" aria-hidden="true" href="#avgmaxminsum">#</a></h3>
<p>平均、最大、最小、总和。</p>
<p>avg示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">exams/_search?size</span> <span style="color:#f00">=</span> <span style="color:#ff0;font-weight:bold">0</span> {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;avg_grade&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;avg&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;grade&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">结果：</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f00">...</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggregations&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;avg_grade&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;value&#34;</span>: <span style="color:#ff0;font-weight:bold">75.0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="value-count-计数聚合">Value Count 计数聚合<a hidden class="anchor" aria-hidden="true" href="#value-count-计数聚合">#</a></h3>
<p>统计字段不为空的文档数。
等价sql：<code>select count(*) from table_a where name is not null</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">POST</span> <span style="color:#f00">sales/_search?size</span> <span style="color:#f00">=</span> <span style="color:#ff0;font-weight:bold">0</span> 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;types_count&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;value_count&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;type&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{ <span style="color:#f00">...</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&#34;aggregations&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;types_count&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;value&#34;</span>: <span style="color:#ff0;font-weight:bold">7</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="stats-统计聚合">Stats 统计聚合<a hidden class="anchor" aria-hidden="true" href="#stats-统计聚合">#</a></h3>
<p>返回的结果包括：min、max、sun、avg、count。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">POST/exams/_search?size=</span><span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;grades_stats&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;stats&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;grade&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">结果</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{ <span style="color:#f00">...</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggregations&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;grades_stats&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;count&#34;</span>: <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;min&#34;</span>: <span style="color:#ff0;font-weight:bold">50.0</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;max&#34;</span>: <span style="color:#ff0;font-weight:bold">100.0</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;avg&#34;</span>: <span style="color:#ff0;font-weight:bold">75.0</span>,
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;sum&#34;</span>: <span style="color:#ff0;font-weight:bold">150.0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cardinality-基数聚合">cardinality 基数聚合<a hidden class="anchor" aria-hidden="true" href="#cardinality-基数聚合">#</a></h3>
<p>计算字段有多少不同的值。
等价sql：<code>select count(distinct age) from table</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">cars/_search</span> {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;size&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;distinct_colors&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;cardinality&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;color&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;aggregations&#34;</span><span style="color:#f00">:</span> {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;distinct_colors&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;value&#34;</span>: <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pipeline-agg">Pipeline Agg<a hidden class="anchor" aria-hidden="true" href="#pipeline-agg">#</a></h2>
<h1 id="rest-apis">Rest APIs<a hidden class="anchor" aria-hidden="true" href="#rest-apis">#</a></h1>
<p>参考官网
<a href="https://www.elastic.co/cn/">https://www.elastic.co/cn/</a></p>
<p>Rest一种软件架构风格，而不是标准，只是提供了一组设计原则和约束条件。它主要用于客户端和服务器交互类的软件。基于这个风格设计的软件可以更简洁，更有层次，更易于实现缓存等机制。</p>
<p>我们可以使用任何能发送HTTP请求的客户端与ES进行交互。比如：curl、PostMan，Es-Head、Kibana等。</p>
<h2 id="集群操作">集群操作<a hidden class="anchor" aria-hidden="true" href="#集群操作">#</a></h2>
<h3 id="查集群健康">查集群健康<a hidden class="anchor" aria-hidden="true" href="#查集群健康">#</a></h3>
<p><code>curl 'localhost:9200/_cat/health?v'</code></p>
<p>得到的响应</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>epoch      timestamp cluster       status node.total node.data shards pri relo init unassign
</span></span><span style="display:flex;"><span>1394735289 14:28:09  elasticsearch green           1         1      0   0    0    0        0
</span></span></code></pre></td></tr></table>
</div>
</div><p>cluster：集群名
status：集群的状态。有绿、黄、红，三种状态。
绿：集群功能齐全，一切正常。
黄：所有的数据都是可用的，但是某些复制没有被分配（集群功能齐全）
红：因为某些原因，某些数据不可用。注意，即使集群状态是红色的，集群仍然是部分可用的（它仍然会利用可用的分片来响应搜索请求），但是可能你需要尽快修复它，因为你有丢失的数据。</p>
<h3 id="查集群中的节点列表">查集群中的节点列表<a hidden class="anchor" aria-hidden="true" href="#查集群中的节点列表">#</a></h3>
<p><code>curl 'localhost:9200/_cat/nodes?v'</code></p>
<h2 id="索引操作">索引操作<a hidden class="anchor" aria-hidden="true" href="#索引操作">#</a></h2>
<h3 id="创建索引">创建索引<a hidden class="anchor" aria-hidden="true" href="#创建索引">#</a></h3>
<p>语法：
<code>PUT index_name</code></p>
<p>创建一个索引：<code>my-index</code>
<code>curl -X PUT &quot;localhost:9200/my-index?pretty&quot;</code></p>
<p>请求体</p>
<ul>
<li>aliases：索引的别名</li>
<li>mappings：索引中字段的映射</li>
<li>settings：索引的设置</li>
</ul>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">PUT</span> <span style="color:#f00">my_index/_mappings</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field1&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;ik_max_word&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;field2&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="删除索引">删除索引<a hidden class="anchor" aria-hidden="true" href="#删除索引">#</a></h3>
<p>语法：<code>DELETE index_name</code></p>
<p>删除一个索引：
<code>curl -X DELETE &quot;localhost:9200/my-index-000001?pretty&quot;</code></p>
<h3 id="获取索引">获取索引<a hidden class="anchor" aria-hidden="true" href="#获取索引">#</a></h3>
<p>语法：<code>GET index_name</code></p>
<p><code>curl -X GET &quot;localhost:9200/my-index-000001?pretty&quot;</code></p>
<p>查所有索引
<code>curl 'localhost:9200/_cat/indices?v'</code></p>
<h3 id="修改索引">修改索引<a hidden class="anchor" aria-hidden="true" href="#修改索引">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#f00">#</span> <span style="color:#f00">查看索引是否允许被修改</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">GET</span> <span style="color:#f00">my_index/_settings</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;test_index&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;settings&#34;</span> : {
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&#34;index&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;number_of_shards&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;blocks&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;read_only_allow_delete&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;provided_name&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;test_index&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;creation_date&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;1646452164709&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;number_of_replicas&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;uuid&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;7M9EvUSnRIuS_SWqk2I12A&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;version&#34;</span> : {
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&#34;created&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;7060199&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果没有<code>blocks</code>字段，说明索引是可以修改的。如果有<code>blocks</code>字段，且是 true，那么需要改一下这个值，才能修改索引。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>PUT test_index/_settings
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;index.blocks.read_only_allow_delete&#34;: null
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后可以给索引新增字段：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>PUT test_index/_mappings
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;properties&#34;: {
</span></span><span style="display:flex;"><span>        &#34;field1&#34;: {
</span></span><span style="display:flex;"><span>            &#34;type&#34;: &#34;text&#34;,
</span></span><span style="display:flex;"><span>            &#34;analyzer&#34;: &#34;ik_max_word&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;field2&#34;: {
</span></span><span style="display:flex;"><span>            &#34;type&#34;: &#34;keyword&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里新增了两个字段。
如果想修改已经有数据的字段，只能通过创建中间索引的方式<a href="#jump">参考这里</a>
对于没有数据的字段，是可以直接修改的，修改方式和新增字段是一样的。如下</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>PUT test_index/_mappings
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;properties&#34;: {
</span></span><span style="display:flex;"><span>        &#34;field1&#34;: {
</span></span><span style="display:flex;"><span>            &#34;type&#34;: &#34;text&#34;,
</span></span><span style="display:flex;"><span>            &#34;analyzer&#34;: &#34;ik_max_word&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>给刚才新增的字段，添加一些数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>PUT test_index/_doc/1
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;field1&#34;:&#34;字段1&#34;,
</span></span><span style="display:flex;"><span>  &#34;field2&#34;:&#34;字段2&#34;,
</span></span><span style="display:flex;"><span>  &#34;field3&#34;:&#34;字段3&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看是否新增成功
<code>GET test_index/_search</code></p>
<h2 id="文档操作">文档操作<a hidden class="anchor" aria-hidden="true" href="#文档操作">#</a></h2>
<h3 id="新增">新增<a hidden class="anchor" aria-hidden="true" href="#新增">#</a></h3>
<p>想要创建文档，必须告诉ES，文档所属的index和type。
语法：<code>PUT /{索引}/{类型}/{文档的id}</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>curl -XPUT &#39;localhost:9200/my_index/_doc/1?pretty&#39; -d &#39;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;name&#34;: &#34;wjy&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>响应如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;_index&#34; : &#34;my_index&#34;,
</span></span><span style="display:flex;"><span>  &#34;_type&#34; : &#34;_doc&#34;,
</span></span><span style="display:flex;"><span>  &#34;_id&#34; : &#34;1&#34;,
</span></span><span style="display:flex;"><span>  &#34;_version&#34; : 5,
</span></span><span style="display:flex;"><span>  &#34;result&#34; : &#34;updated&#34;,
</span></span><span style="display:flex;"><span>  &#34;_shards&#34; : {
</span></span><span style="display:flex;"><span>    &#34;total&#34; : 2,
</span></span><span style="display:flex;"><span>    &#34;successful&#34; : 1,
</span></span><span style="display:flex;"><span>    &#34;failed&#34; : 0
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  &#34;_seq_no&#34; : 4,
</span></span><span style="display:flex;"><span>  &#34;_primary_term&#34; : 1
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建文档的时候，如果索引和类型不存在，es会自动创建索引和类型。不需要提前创建索引和类型。
ID部分是可选的。如果不指定id，Elasticsearch将为这个文档创建一个随机的ID。需要注意的是，如果不指定id，只能使用POST命令，PUT不可以。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>POST /my_index/_doc/
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;name&#34;:&#34;wjy&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在，让我们查看刚才创建的文档：
<code>curl -XGET 'localhost:9200/my_index/_doc/1?pretty'</code>
响应如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;_index&#34; : &#34;my_index&#34;,
</span></span><span style="display:flex;"><span>  &#34;_type&#34; : &#34;_doc&#34;,
</span></span><span style="display:flex;"><span>  &#34;_id&#34; : &#34;1&#34;,
</span></span><span style="display:flex;"><span>  &#34;_version&#34; : 5,
</span></span><span style="display:flex;"><span>  &#34;_seq_no&#34; : 4,
</span></span><span style="display:flex;"><span>  &#34;_primary_term&#34; : 1,
</span></span><span style="display:flex;"><span>  &#34;found&#34; : true,
</span></span><span style="display:flex;"><span>  &#34;_source&#34; : {
</span></span><span style="display:flex;"><span>    &#34;name&#34; : &#34;wjy&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>仔细研究上边的命令，我们可以发现 ES 命令的规则：
<code>curl -X&lt;REST Verb&gt; &lt;Node&gt;:&lt;Port&gt;/&lt;Index&gt;/&lt;Type&gt;/&lt;ID&gt;</code>
这个REST访问模式普遍适用于所有的API命令，如果你能记住它，你就会为掌握Elasticsearch 开一个好头。</p>
<h3 id="更新">更新<a hidden class="anchor" aria-hidden="true" href="#更新">#</a></h3>
<p>ES底层不支持更新文档，如果想要更新文档，ES 会先删除旧文档，然后再创建新文档。</p>
<p>语法：<code>/{index}/_update/{id}</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>POST /my_index/_update/1
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;doc&#34;:{
</span></span><span style="display:flex;"><span>    &#34;name&#34;:&#34;wm&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>还可以在局部更新的同时，给文档添加新的字段</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>POST /my_index/_update/1/
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;doc&#34;: {
</span></span><span style="display:flex;"><span>    &#34;name&#34;: &#34;wm&#34;,
</span></span><span style="display:flex;"><span>    &#34;age&#34;: 20
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>还可以通过脚本更新数据，下面使用一个脚本将age加5</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>POST /my_index/_update/1
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;script&#34; : &#34;ctx._source.age += 5&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ctx._source</code>指向当前被更新的文档。</p>
<p>条件更新文档</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>POST zw_paper/_update_by_query
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;script&#34;: {
</span></span><span style="display:flex;"><span>    	// 需要更新的字段
</span></span><span style="display:flex;"><span>        &#34;source&#34;:&#34;ctx._source[&#39;provinceCode&#39;]=110000;&#34;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    	// 你的条件，如果更新全部数据，就写match_all
</span></span><span style="display:flex;"><span>        &#34;match_all&#34;: {}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="删除">删除<a hidden class="anchor" aria-hidden="true" href="#删除">#</a></h3>
<p>删除id为1的文档</p>
<p><code>curl -XDELETE 'localhost:9200/my_index/_doc/1</code></p>
<p>根据条件，删除多条文档</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>POST /my-index-000001/_delete_by_query
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;match&#34;: {
</span></span><span style="display:flex;"><span>      &#34;user.id&#34;: &#34;elkbee&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>删除某个索引下的所有文档</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>POST my-index-000001/_delete_by_query?conflicts=proceed
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;query&#34;: {
</span></span><span style="display:flex;"><span>    &#34;match_all&#34;: {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="文档查询">文档查询<a hidden class="anchor" aria-hidden="true" href="#文档查询">#</a></h2>
<p>文档查询是重中之重，所以单独拿出来说。</p>
<h3 id="根据id查">根据id查<a hidden class="anchor" aria-hidden="true" href="#根据id查">#</a></h3>
<p>语法：
<code>GET {index}/_doc/{id}</code></p>
<p>查询id为0的数据：
<code>GET my-index-000001/_doc/0</code></p>
<p>返回如下结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_index&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;my_index&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_type&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;_doc&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_id&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_version&#34;</span> : <span style="color:#ff0;font-weight:bold">26</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_seq_no&#34;</span> : <span style="color:#ff0;font-weight:bold">160</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_primary_term&#34;</span> : <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;found&#34;</span> : <span style="color:#fff;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&#34;_source&#34;</span> : {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;name&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;age&#34;</span> : <span style="color:#ff0;font-weight:bold">20</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="只获取_source字段">只获取<code>_source</code>字段：<a hidden class="anchor" aria-hidden="true" href="#只获取_source字段">#</a></h3>
<p><code>GET my-index-000001/_source/1</code></p>
<p>可以通过<code>_source_includes</code>控制_source返回的字段。
通过<code>_source_excludes</code>控制_source不返回的字段。</p>
<h3 id="判断数据是否存在">判断数据是否存在<a hidden class="anchor" aria-hidden="true" href="#判断数据是否存在">#</a></h3>
<p><code>HEAD myIndex/_doc/1</code>
如果存在，返回200，不存在返回404。</p>
<h3 id="分组">分组<a hidden class="anchor" aria-hidden="true" href="#分组">#</a></h3>
<p>分组结果在es返回的最下边。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET zw_paper/_search
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;aggs&#34;: {
</span></span><span style="display:flex;"><span>    &#34;count&#34;: {
</span></span><span style="display:flex;"><span>      &#34;terms&#34;: {
</span></span><span style="display:flex;"><span>      	// 如果字段是text类型，则必须加.keyword
</span></span><span style="display:flex;"><span>        &#34;field&#34;: &#34;paperTypeName.keyword&#34;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="es-java">es-java<a hidden class="anchor" aria-hidden="true" href="#es-java">#</a></h1>
<p>规定es版本</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;java.version&gt;</span>1.8<span style="font-weight:bold">&lt;/java.version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">&lt;!-- es版本 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;elasticsearch.version&gt;</span>7.16.1<span style="font-weight:bold">&lt;/elasticsearch.version&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/properties&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>引入es</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-data-elasticsearch<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>编写配置类</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ElasticSearchConfig {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 注册 rest高级客户端 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> RestHighLevelClient restHighLevelClient(){
</span></span><span style="display:flex;"><span>        RestHighLevelClient client = <span style="color:#fff;font-weight:bold">new</span> RestHighLevelClient(
</span></span><span style="display:flex;"><span>                RestClient.<span style="color:#007f7f">builder</span>(
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">new</span> HttpHost(<span style="color:#0ff;font-weight:bold">&#34;127.0.0.1&#34;</span>,<span style="color:#ff0;font-weight:bold">9200</span>,<span style="color:#0ff;font-weight:bold">&#34;http&#34;</span>)
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> client;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>实体类</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span>@NoArgsConstructor
</span></span><span style="display:flex;"><span>@AllArgsConstructor
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User <span style="color:#fff;font-weight:bold">implements</span> Serializable {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Integer age;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在测试类中注入es客户端：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Autowired
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> RestHighLevelClient restHighLevelClient;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="index-apis">Index APIs<a hidden class="anchor" aria-hidden="true" href="#index-apis">#</a></h2>
<h3 id="创建index">创建index<a hidden class="anchor" aria-hidden="true" href="#创建index">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testCreateIndex() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    CreateIndexRequest request = <span style="color:#fff;font-weight:bold">new</span> CreateIndexRequest(<span style="color:#0ff;font-weight:bold">&#34;wjy_index&#34;</span>);
</span></span><span style="display:flex;"><span>    CreateIndexResponse response = restHighLevelClient.<span style="color:#007f7f">indices</span>().<span style="color:#007f7f">create</span>(request,RequestOptions.<span style="color:#007f7f">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(response.<span style="color:#007f7f">isAcknowledged</span>());<span style="color:#007f7f">// 是否创建成功
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(response);<span style="color:#007f7f">// 返回对象
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    restHighLevelClient.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="删除index">删除index<a hidden class="anchor" aria-hidden="true" href="#删除index">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testDeleteIndex() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    DeleteIndexRequest request = <span style="color:#fff;font-weight:bold">new</span> DeleteIndexRequest(<span style="color:#0ff;font-weight:bold">&#34;wjy_index&#34;</span>);
</span></span><span style="display:flex;"><span>    AcknowledgedResponse response = restHighLevelClient.<span style="color:#007f7f">indices</span>().<span style="color:#007f7f">delete</span>(request, RequestOptions.<span style="color:#007f7f">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(response.<span style="color:#007f7f">isAcknowledged</span>());<span style="color:#007f7f">// 是否删除成功
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    restHighLevelClient.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="判断index是否存在">判断index是否存在<a hidden class="anchor" aria-hidden="true" href="#判断index是否存在">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testIndexIsExists() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    GetIndexRequest request = <span style="color:#fff;font-weight:bold">new</span> GetIndexRequest(<span style="color:#0ff;font-weight:bold">&#34;wjy_index&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> exists = restHighLevelClient.<span style="color:#007f7f">indices</span>().<span style="color:#007f7f">exists</span>(request, RequestOptions.<span style="color:#007f7f">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(exists);<span style="color:#007f7f">// 索引是否存在
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    restHighLevelClient.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="document-apis">Document APIs<a hidden class="anchor" aria-hidden="true" href="#document-apis">#</a></h2>
<h3 id="创建文档">创建文档<a hidden class="anchor" aria-hidden="true" href="#创建文档">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testAddDocument() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 创建一个User对象
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    User user = <span style="color:#fff;font-weight:bold">new</span> User(<span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>, <span style="color:#ff0;font-weight:bold">18</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 创建请求
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    IndexRequest request = <span style="color:#fff;font-weight:bold">new</span> IndexRequest(<span style="color:#0ff;font-weight:bold">&#34;wjy_index&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 制定规则 PUT /wjy_index/_doc/1
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// 设置文档ID
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    request.<span style="color:#007f7f">id</span>(<span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 将数据放入请求中
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    request.<span style="color:#007f7f">source</span>(JacksonUtils.<span style="color:#007f7f">objectToJsonStr</span>(user), XContentType.<span style="color:#007f7f">JSON</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 客户端发送请求，获取响应的结果
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    IndexResponse response = restHighLevelClient.<span style="color:#007f7f">index</span>(request, RequestOptions.<span style="color:#007f7f">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(response.<span style="color:#007f7f">status</span>());<span style="color:#007f7f">// 获取建立索引的状态信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(response);<span style="color:#007f7f">// 查看返回内容
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="根据id获取文档">根据id获取文档<a hidden class="anchor" aria-hidden="true" href="#根据id获取文档">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testDocumentIsExists() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    GetRequest request = <span style="color:#fff;font-weight:bold">new</span> GetRequest(<span style="color:#0ff;font-weight:bold">&#34;liuyou_index&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 不获取返回的 _source的上下文了
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    request.<span style="color:#007f7f">fetchSourceContext</span>(<span style="color:#fff;font-weight:bold">new</span> FetchSourceContext(<span style="color:#fff;font-weight:bold">false</span>));
</span></span><span style="display:flex;"><span>    request.<span style="color:#007f7f">storedFields</span>(<span style="color:#0ff;font-weight:bold">&#34;_none_&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> exists = restHighLevelClient.<span style="color:#007f7f">exists</span>(request, RequestOptions.<span style="color:#007f7f">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(exists);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="判断文档是否存在">判断文档是否存在<a hidden class="anchor" aria-hidden="true" href="#判断文档是否存在">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testDocumentIsExists() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    GetRequest request = <span style="color:#fff;font-weight:bold">new</span> GetRequest(<span style="color:#0ff;font-weight:bold">&#34;wjy_index&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> exists = restHighLevelClient.<span style="color:#007f7f">exists</span>(request, RequestOptions.<span style="color:#007f7f">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(exists);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="更新文档">更新文档<a hidden class="anchor" aria-hidden="true" href="#更新文档">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testUpdateDocument() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    User user = <span style="color:#fff;font-weight:bold">new</span> User(<span style="color:#0ff;font-weight:bold">&#34;wm&#34;</span>, <span style="color:#ff0;font-weight:bold">20</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UpdateRequest request = <span style="color:#fff;font-weight:bold">new</span> UpdateRequest(<span style="color:#0ff;font-weight:bold">&#34;wjy_index&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span>    request.<span style="color:#007f7f">doc</span>(JacksonUtils.<span style="color:#007f7f">objectToJsonStr</span>(user), XContentType.<span style="color:#007f7f">JSON</span>);
</span></span><span style="display:flex;"><span>    UpdateResponse response = client.<span style="color:#007f7f">update</span>(request, RequestOptions.<span style="color:#007f7f">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(response.<span style="color:#007f7f">status</span>()); <span style="color:#007f7f">// OK
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    client.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="删除文档">删除文档<a hidden class="anchor" aria-hidden="true" href="#删除文档">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testDeleteDocument() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    DeleteRequest request = <span style="color:#fff;font-weight:bold">new</span> DeleteRequest(<span style="color:#0ff;font-weight:bold">&#34;wjy_index&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span>    DeleteResponse response = client.<span style="color:#007f7f">delete</span>(request, RequestOptions.<span style="color:#007f7f">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(response.<span style="color:#007f7f">status</span>());<span style="color:#007f7f">// OK
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="条件查询">条件查询<a hidden class="anchor" aria-hidden="true" href="#条件查询">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testSearch() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.创建查询请求对象
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    SearchRequest searchRequest = <span style="color:#fff;font-weight:bold">new</span> SearchRequest();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 2.构建搜索条件
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    SearchSourceBuilder searchSourceBuilder = <span style="color:#fff;font-weight:bold">new</span> SearchSourceBuilder();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// (1)使用QueryBuilders工具类创建
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// 查询条件-精确查询
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    TermQueryBuilder termQueryBuilder = QueryBuilders.<span style="color:#007f7f">termQuery</span>(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 条件投入
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    searchSourceBuilder.<span style="color:#007f7f">query</span>(termQueryBuilder);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// (2)其他
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// 设置高亮
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    searchSourceBuilder.<span style="color:#007f7f">highlighter</span>(<span style="color:#fff;font-weight:bold">new</span> HighlightBuilder());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 分页
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#007f7f">//searchSourceBuilder.from();
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#007f7f">//searchSourceBuilder.size();
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 设置超时时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    searchSourceBuilder.<span style="color:#007f7f">timeout</span>(<span style="color:#fff;font-weight:bold">new</span> TimeValue(<span style="color:#ff0;font-weight:bold">60</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 3.添加请求条件
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    searchRequest.<span style="color:#007f7f">source</span>(searchSourceBuilder);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 4.客户端查询
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    SearchResponse search = client.<span style="color:#007f7f">search</span>(searchRequest, RequestOptions.<span style="color:#007f7f">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 5.查看返回结果
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    SearchHits hits = search.<span style="color:#007f7f">getHits</span>();
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(JacksonUtils.<span style="color:#007f7f">objectToJsonStr</span>(hits));
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=======================&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (SearchHit i : hits.<span style="color:#007f7f">getHits</span>()) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(i.<span style="color:#007f7f">getSourceAsMap</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="批量新增文档">批量新增文档<a hidden class="anchor" aria-hidden="true" href="#批量新增文档">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testBulk() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    BulkRequest bulkRequest = <span style="color:#fff;font-weight:bold">new</span> BulkRequest();
</span></span><span style="display:flex;"><span>    bulkRequest.<span style="color:#007f7f">timeout</span>(<span style="color:#0ff;font-weight:bold">&#34;10s&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ArrayList&lt;User&gt; users = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    users.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> User(<span style="color:#0ff;font-weight:bold">&#34;wjy-1&#34;</span>, <span style="color:#ff0;font-weight:bold">1</span>));
</span></span><span style="display:flex;"><span>    users.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> User(<span style="color:#0ff;font-weight:bold">&#34;wjy-2&#34;</span>, <span style="color:#ff0;font-weight:bold">2</span>));
</span></span><span style="display:flex;"><span>    users.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> User(<span style="color:#0ff;font-weight:bold">&#34;wjy-3&#34;</span>, <span style="color:#ff0;font-weight:bold">3</span>));
</span></span><span style="display:flex;"><span>    users.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> User(<span style="color:#0ff;font-weight:bold">&#34;wjy-4&#34;</span>, <span style="color:#ff0;font-weight:bold">4</span>));
</span></span><span style="display:flex;"><span>    users.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> User(<span style="color:#0ff;font-weight:bold">&#34;wjy-5&#34;</span>, <span style="color:#ff0;font-weight:bold">5</span>));
</span></span><span style="display:flex;"><span>    users.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> User(<span style="color:#0ff;font-weight:bold">&#34;wjy-6&#34;</span>, <span style="color:#ff0;font-weight:bold">6</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String indexName = <span style="color:#0ff;font-weight:bold">&#34;bulk_index&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; users.<span style="color:#007f7f">size</span>(); i++) {
</span></span><span style="display:flex;"><span>        bulkRequest.<span style="color:#007f7f">add</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 这里是数据信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                <span style="color:#fff;font-weight:bold">new</span> IndexRequest(indexName)
</span></span><span style="display:flex;"><span>                        .<span style="color:#007f7f">id</span>(<span style="color:#0ff;font-weight:bold">&#34;&#34;</span> + (i + <span style="color:#ff0;font-weight:bold">1</span>)) <span style="color:#007f7f">// 没有设置id 会自定生成一个随机id
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                        .<span style="color:#007f7f">source</span>(JacksonUtils.<span style="color:#007f7f">objectToJsonStr</span>(users.<span style="color:#007f7f">get</span>(i)), XContentType.<span style="color:#007f7f">JSON</span>)
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//批量插入
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    BulkResponse bulk = client.<span style="color:#007f7f">bulk</span>(bulkRequest, RequestOptions.<span style="color:#007f7f">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(bulk.<span style="color:#007f7f">status</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="其他">其他<a hidden class="anchor" aria-hidden="true" href="#其他">#</a></h1>
<h2 id="修改索引的mapping">修改索引的mapping<a hidden class="anchor" aria-hidden="true" href="#修改索引的mapping">#</a></h2>
<p><span id="jump">修改索引的mapping</span></p>
<p><a href="https://www.cnblogs.com/Ace-suiyuan008/p/9985249.html">https://www.cnblogs.com/Ace-suiyuan008/p/9985249.html</a>
es不能直接修改索引类型，需要通过下面的流程修改索引：</p>
<ol>
<li>
<p>创建中间索引
<code>PUT index_new</code></p>
</li>
<li>
<p>查旧索引的mapping：
<code>GET my_index/_mapping</code></p>
</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&#34;zw_paper&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;approveStatus&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;long&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;approveTime&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;long&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&#34;approver&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&#34;fields&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&#34;keyword&#34;</span>: {
</span></span><span style="display:flex;"><span>                            <span style="font-weight:bold">&#34;type&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;keyword&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="font-weight:bold">&#34;ignore_above&#34;</span>: <span style="color:#ff0;font-weight:bold">256</span>
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>给中间索引设置mapping
根据刚才查的旧索引的mapping，修改需要修改的字段。</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>POST index_new/_mapping
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;properties&#34;: {
</span></span><span style="display:flex;"><span>        &#34;approveStatus&#34;: {
</span></span><span style="display:flex;"><span>            &#34;type&#34;: &#34;long&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;approveTime&#34;: {
</span></span><span style="display:flex;"><span>            &#34;type&#34;: &#34;long&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;approver&#34;: {
</span></span><span style="display:flex;"><span>            &#34;type&#34;: &#34;text&#34;,
</span></span><span style="display:flex;"><span>            &#34;fields&#34;: {
</span></span><span style="display:flex;"><span>                &#34;keyword&#34;: {
</span></span><span style="display:flex;"><span>                    &#34;type&#34;: &#34;keyword&#34;,
</span></span><span style="display:flex;"><span>                    &#34;ignore_above&#34;: 256
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>将旧索引的数据复制到中间索引</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 将旧索引的数据copy到新索引
</span></span><span style="display:flex;"><span>POST _reindex
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;source&#34;: {
</span></span><span style="display:flex;"><span>    &#34;index&#34;: &#34;my_index&#34;
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  &#34;dest&#34;: {
</span></span><span style="display:flex;"><span>    &#34;index&#34;: &#34;index_new&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>
<p>检查数据是否复制成功
<code>GET /index_new/_doc/_search</code></p>
</li>
<li>
<p>删除有问题的索引
<code>DELETE my_index</code></p>
</li>
<li>
<p>重新创建同名的索引(★字段类型修改正确★)
<code>PUT my_index</code></p>
</li>
<li>
<p>给新索引设置mapping</p>
</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>POST my_index/_mapping
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;properties&#34;: {
</span></span><span style="display:flex;"><span>        &#34;approveStatus&#34;: {
</span></span><span style="display:flex;"><span>            &#34;type&#34;: &#34;long&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;approveTime&#34;: {
</span></span><span style="display:flex;"><span>            &#34;type&#34;: &#34;long&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;approver&#34;: {
</span></span><span style="display:flex;"><span>            &#34;type&#34;: &#34;text&#34;,
</span></span><span style="display:flex;"><span>            &#34;fields&#34;: {
</span></span><span style="display:flex;"><span>                &#34;keyword&#34;: {
</span></span><span style="display:flex;"><span>                    &#34;type&#34;: &#34;keyword&#34;,
</span></span><span style="display:flex;"><span>                    &#34;ignore_above&#34;: 256
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="9">
<li>将中间索引的数据复制到重建的索引</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 将中间索引的数据复制到重建的索引
</span></span><span style="display:flex;"><span>POST _reindex
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  &#34;source&#34;: {
</span></span><span style="display:flex;"><span>    &#34;index&#34;: &#34;index_new&#34;
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  &#34;dest&#34;: {
</span></span><span style="display:flex;"><span>    &#34;index&#34;: &#34;my_index&#34;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="10">
<li>删除中间索引
<code>DELETE index_new</code></li>
</ol>
<h2 id="了解elk">了解ELK<a hidden class="anchor" aria-hidden="true" href="#了解elk">#</a></h2>
<p>ELK是Elasticsearch、Logstash、 Kibana三大开源框架首字母大写简称。市面上也被成为Elastic Stack。
其中Elasticsearch是一个基于Lucene、分布式、通过Restful方式进行交互的近实时搜索平台框架。
像类似百度、谷歌这种大数据全文搜索引擎的场景都可以使用Elasticsearch作为底层支持框架，可见Elasticsearch提供的搜索能力确实强大，市面上很多时候我们简称Elasticsearch为es。
Logstash是ELK的中央数据流引擎，用于从不同目标(文件/数据存储/MQ )收集的不同格式数据，经过过滤后支持输出到不同目的地(文件/MQ/redis/elasticsearch/kafka等)。
Kibana可以将elasticsearch的数据通过友好的页面展示出来，提供实时分析的功能。
市面上很多开发只要提到ELK能够一致说出它是一个日志分析架构技术栈总称，但实际上ELK不仅仅适用于日志分析，它还可以支持其它任何数据分析和收集的场景，日志分析和收集只是更具有代表性，并非唯一性。
收集清洗数据(Logstash) ==&gt; 搜索、存储(ElasticSearch) ==&gt; 展示(Kibana)</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://funny-toffee-4aa7c3.netlify.app/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://funny-toffee-4aa7c3.netlify.app/">Wjy&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>