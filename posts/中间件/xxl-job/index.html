<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>xxl-job | Wjy&#39;s Blog</title>
<meta name="keywords" content="中间件">
<meta name="description" content="概述 官网： https://www.xuxueli.com/xxl-job/ 准备工作 环境准备： Maven3&#43; Jdk17&#43; (说明：版本3.x开始要求Jdk17；版本2.x及以下支持Jdk1.8。如对Jdk版本有诉求，可选择接入不">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://wjy6.netlify.app/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/xxl-job/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://wjy6.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://wjy6.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://wjy6.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://wjy6.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://wjy6.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://wjy6.netlify.app/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/xxl-job/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://wjy6.netlify.app/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/xxl-job/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="xxl-job">
  <meta property="og:description" content="概述 官网： https://www.xuxueli.com/xxl-job/ 准备工作 环境准备： Maven3&#43; Jdk17&#43; (说明：版本3.x开始要求Jdk17；版本2.x及以下支持Jdk1.8。如对Jdk版本有诉求，可选择接入不">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-10T20:08:55+00:00">
    <meta property="article:modified_time" content="2025-10-10T20:08:55+00:00">
    <meta property="article:tag" content="中间件">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="xxl-job">
<meta name="twitter:description" content="概述 官网： https://www.xuxueli.com/xxl-job/ 准备工作 环境准备： Maven3&#43; Jdk17&#43; (说明：版本3.x开始要求Jdk17；版本2.x及以下支持Jdk1.8。如对Jdk版本有诉求，可选择接入不">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://wjy6.netlify.app/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "xxl-job",
      "item": "https://wjy6.netlify.app/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/xxl-job/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "xxl-job",
  "name": "xxl-job",
  "description": "概述 官网： https://www.xuxueli.com/xxl-job/ 准备工作 环境准备： Maven3+ Jdk17+ (说明：版本3.x开始要求Jdk17；版本2.x及以下支持Jdk1.8。如对Jdk版本有诉求，可选择接入不",
  "keywords": [
    "中间件"
  ],
  "articleBody": "概述 官网：\nhttps://www.xuxueli.com/xxl-job/\n准备工作 环境准备：\nMaven3+ Jdk17+ (说明：版本3.x开始要求Jdk17；版本2.x及以下支持Jdk1.8。如对Jdk版本有诉求，可选择接入不同版本。) Mysql8.0+ 导入依赖：\nmaven：\n1 2 3 4 5 6 com.xuxueli xxl-job-core 3.2.0 gradle：\n1 2 // https://mvnrepository.com/artifact/com.xuxueli/xxl-job-core implementation(\"com.xuxueli:xxl-job-core:3.2.0\") 克隆源码：\n源码仓库地址 Release Download https://github.com/xuxueli/xxl-job Download http://gitee.com/xuxueli0323/xxl-job Download https://gitcode.com/xuxueli/xxl-job Download 二、快速开始 初始化“调度数据库” 直接用idea拉代码：\nhttp://gitee.com/xuxueli0323/xxl-job\n执行sql脚本，“调度数据库初始化SQL脚本” 位置为:\n1 /xxl-job/doc/db/tables_xxl_job.sql 配置部署“调度中心” 调度中心项目：xxl-job-admin 作用：统一管理任务调度平台上调度任务，负责触发调度执行，并且提供任务管理平台。 调度中心配置文件地址：\n1 /xxl-job/xxl-job-admin/src/main/resources/application.properties 修改配置文件：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ### 调度中心JDBC链接 spring.datasource.url=jdbc:mysql://127.0.0.1:3306/xxl_job?useUnicode=true\u0026characterEncoding=UTF-8\u0026autoReconnect=true\u0026serverTimezone=Asia/Shanghai spring.datasource.username=root spring.datasource.password=root_pwd spring.datasource.driver-class-name=com.mysql.jdbc.Driver ### 报警邮箱 spring.mail.host=smtp.qq.com spring.mail.port=25 spring.mail.username=xxx@qq.com spring.mail.password=xxx spring.mail.properties.mail.smtp.auth=true spring.mail.properties.mail.smtp.starttls.enable=true spring.mail.properties.mail.smtp.starttls.required=true spring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory ### 调度中心通讯TOKEN [选填]：非空时启用； xxl.job.accessToken= ### 调度中心通讯超时时间[选填]，单位秒；默认3s； xxl.job.timeout=3 ### 调度中心国际化配置 [必填]： 默认为 \"zh_CN\"/中文简体, 可选范围为 \"zh_CN\"/中文简体, \"zh_TC\"/中文繁体 and \"en\"/英文； xxl.job.i18n=zh_CN ## 调度线程池最大线程配置【必填】 xxl.job.triggerpool.fast.max=200 xxl.job.triggerpool.slow.max=100 ### 调度中心日志表数据保存天数 [必填]：过期日志自动清理；限制大于等于7时生效，否则, 如-1，关闭自动清理功能； xxl.job.logretentiondays=30 部署或运行项目：\n启动报错：\n1 Failed to create parent directories for [/data/applogs/xxl-job/xxl-job-admin.log] 原因：没有权限在根目录下创建文件。\n解决方案：\n找到logback.xml，修改日志路径为家目录：\n1 启动成功后访问：\n1 http://localhost:8888/xxl-job-admin (该地址执行器将会使用到，作为回调地址) 默认登录账号：\n1 admin/123456 至此“调度中心”项目已经部署成功。\n配置部署“执行器项目” “执行器”项目：xxl-job-executor-sample-springboot (提供多种版本执行器供选择，现以 springboot 版本为例，可直接使用，也可以参考其并将现有项目改造成执行器) 作用：负责接收“调度中心”的调度并执行；可直接部署执行器，也可以将执行器集成到现有业务项目中。 第一步：项目引入依赖，看上边的maven或gradle。\n第二部：修改配置文件：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ### 调度中心部署根地址 [选填]：如调度中心集群部署存在多个地址则用逗号分隔。执行器将会使用该地址进行\"执行器心跳注册\"和\"任务结果回调\"；为空则关闭自动注册； xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin ### 调度中心通讯TOKEN [选填]：非空时启用； xxl.job.admin.accessToken=default_token ### 调度中心通讯超时时间[选填]，单位秒；默认3s； xxl.job.admin.timeout=3 ### 执行器AppName [选填]：执行器心跳注册分组依据；为空则关闭自动注册 xxl.job.executor.appname=xxl-job-executor-sample ### 执行器注册 [选填]：优先使用该配置作为注册地址，为空时使用内嵌服务 ”IP:PORT“ 作为注册地址。从而更灵活的支持容器类型执行器动态IP和动态映射端口问题。 xxl.job.executor.address= ### 执行器IP [选填]：默认为空表示自动获取IP，多网卡时可手动设置指定IP，该IP不会绑定Host仅作为通讯使用；地址信息用于 \"执行器注册\" 和 \"调度中心请求并触发任务\"； xxl.job.executor.ip= ### 执行器端口号 [选填]：小于等于0则自动获取；默认端口为9999，单机部署多个执行器时，注意要配置不同执行器端口； xxl.job.executor.port=9999 ### 执行器运行日志文件存储磁盘路径 [选填] ：需要对该路径拥有读写权限；为空则使用默认路径； xxl.job.executor.logpath=/data/applogs/xxl-job/jobhandler ### 执行器日志文件保存天数 [选填] ： 过期日志自动清理, 限制值大于等于3时生效; 否则, 如-1, 关闭自动清理功能； xxl.job.executor.logretentiondays=30 ### 任务扫描排除路径 [选填] ：任务扫描时忽略指定包路径下的Bean；支持配置包路径前缀，多个逗号分隔； xxl.job.executor.excludedpackage=org.springframework,spring 第三步：执行器组件配置\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 package com.wjy.xxljob.config; import com.xxl.job.core.executor.impl.XxlJobSpringExecutor; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.beans.factory.annotation.Value; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; /** * xxl-job config * * @author xuxueli 2017-04-28 */@Configuration public class XxlJobConfig { private Logger logger = LoggerFactory.getLogger(XxlJobConfig.class); @Value(\"${xxl.job.admin.addresses}\") private String adminAddresses; @Value(\"${xxl.job.admin.accessToken}\") private String accessToken; @Value(\"${xxl.job.admin.timeout}\") private int timeout; @Value(\"${xxl.job.executor.appname}\") private String appname; @Value(\"${xxl.job.executor.address}\") private String address; @Value(\"${xxl.job.executor.ip}\") private String ip; @Value(\"${xxl.job.executor.port}\") private int port; @Value(\"${xxl.job.executor.logpath}\") private String logPath; @Value(\"${xxl.job.executor.logretentiondays}\") private int logRetentionDays; @Bean public XxlJobSpringExecutor xxlJobExecutor() { logger.info(\"\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e\u003e xxl-job config init.\"); XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor(); xxlJobSpringExecutor.setAdminAddresses(adminAddresses); xxlJobSpringExecutor.setAppname(appname); xxlJobSpringExecutor.setAddress(address); xxlJobSpringExecutor.setIp(ip); xxlJobSpringExecutor.setPort(port); xxlJobSpringExecutor.setAccessToken(accessToken); xxlJobSpringExecutor.setTimeout(timeout); xxlJobSpringExecutor.setLogPath(logPath); xxlJobSpringExecutor.setLogRetentionDays(logRetentionDays); return xxlJobSpringExecutor; } /** * 针对多网卡、容器内部署等情况，可借助 \"spring-cloud-commons\" 提供的 \"InetUtils\" 组件灵活定制注册IP； * * 1、引入依赖： * * org.springframework.cloud * spring-cloud-commons * ${version} * * * 2、配置文件，或者容器启动变量 * spring.cloud.inetutils.preferred-networks: 'xxx.xxx.xxx.' * * 3、获取IP * String ip_ = inetUtils.findFirstNonLoopbackHostInfo().getIpAddress(); */ } 第四步：部署执行器项目\n至此“执行器”项目已经部署结束。\n开发第一个任务“Hello World” 本示例以新建一个 “GLUE模式(Java)” 运行模式的任务为例。更多有关任务的详细配置，请查看“章节三：任务详解”。\n（ “GLUE模式(Java)”的执行代码托管到调度中心在线维护，相比“Bean模式任务”需要在执行器项目开发部署上线，更加简便轻量）\n前提：请确认“调度中心”和“执行器”项目已经成功部署并启动；\n步骤一：新建任务：\n登录调度中心，点击所示“新建任务”按钮，新建示例任务。\n基础配置：随便写。\n调度配置：随便写。\n任务配置：\n运行模式：GLUE(Java)\n步骤二：“GLUE模式(Java)” 任务开发：\n请点击任务右侧 “GLUE IDE” 按钮，进入 “GLUE编辑器开发界面” ，见下图。“GLUE模式(Java)” 运行模式的任务默认已经初始化了示例任务代码，即打印Hello World。\n（ “GLUE模式(Java)” 运行模式的任务实际上是一段继承自IJobHandler的Java类代码，它在执行器项目中运行，可使用Resource、Autowire注入执行器中的其他服务，详细介绍请查看第三章节）\n步骤三：触发执行：\n请点击任务右侧 “执行” 按钮，可手动触发一次任务执行（通常情况下，通过配置Cron表达式进行任务调度触发）。\n步骤四：查看日志：\n请点击任务右侧 “日志” 按钮，可前往任务日志界面查看任务日志。\n在任务日志界面中，可查看该任务的历史调度记录以及每一次调度的任务调度信息、执行参数和执行信息。运行中的任务点击右侧的“执行日志”按钮，可进入日志控制台查看实时执行日志。\n问题：调度失败\n日志：\n1 2 3 4 触发调度： address：http://172.18.0.1:9999/ code：500 msg：xxl-job remoting error(Connect timed out), for url : http://172.18.0.1:9999/run 到执行器管理查看机器地址：\n1 http://172.18.0.1:9999/ 修改为127.0.0.1:9999，调度成功。\n三、任务详解 配置属性详细说明：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 基础配置： - 执行器：任务的绑定的执行器，任务触发调度时将会自动发现注册成功的执行器, 实现任务自动发现功能; 另一方面也可以方便的进行任务分组。每个任务必须绑定一个执行器, 可在 \"执行器管理\" 进行设置; - 任务描述：任务的描述信息，便于任务管理； - 负责人：任务的负责人； - 报警邮件：任务调度失败时邮件通知的邮箱地址，支持配置多邮箱地址，配置多个邮箱地址时用逗号分隔； 触发配置： - 调度类型： 无：该类型不会主动触发调度； CRON：该类型将会通过CRON，触发任务调度； 固定速度：该类型将会以固定速度，触发任务调度；按照固定的间隔时间，周期性触发； 固定延迟：该类型将会以固定延迟，触发任务调度；按照固定的延迟时间，从上次调度结束后开始计算延迟时间，到达延迟时间后触发下次调度； - CRON：触发任务执行的Cron表达式； - 固定速度：固定速度的时间间隔，单位为秒； - 固定延迟：固定延迟的时间间隔，单位为秒； 任务配置： - 运行模式： BEAN模式：任务以JobHandler方式维护在执行器端；需要结合 \"JobHandler\" 属性匹配执行器中任务； GLUE模式(Java)：任务以源码方式维护在调度中心；该模式的任务实际上是一段继承自IJobHandler的Java类代码并以 \"groovy\" 源码方式维护，它在执行器项目中运行，可使用@Resource/@Autowire注入执行器中的其他服务； GLUE模式(Shell)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 \"shell\" 脚本； GLUE模式(Python)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 \"python\" 脚本； GLUE模式(PHP)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 \"php\" 脚本； GLUE模式(NodeJS)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 \"nodejs\" 脚本； GLUE模式(PowerShell)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 \"PowerShell\" 脚本； - JobHandler：运行模式为 \"BEAN模式\" 时生效，对应执行器中新开发的JobHandler类“@XxlJob”注解自定义的value值； - 执行参数：任务执行所需的参数； 高级配置： - 路由策略：当执行器集群部署时，提供丰富的路由策略，包括； FIRST（第一个）：固定选择第一个机器； LAST（最后一个）：固定选择最后一个机器； ROUND（轮询）：； RANDOM（随机）：随机选择在线的机器； CONSISTENT_HASH（一致性HASH）：每个任务按照Hash算法固定选择某一台机器，且所有任务均匀散列在不同机器上。 LEAST_FREQUENTLY_USED（最不经常使用）：使用频率最低的机器优先被选举； LEAST_RECENTLY_USED（最近最久未使用）：最久未使用的机器优先被选举； FAILOVER（故障转移）：按照顺序依次进行心跳检测，第一个心跳检测成功的机器选定为目标执行器并发起调度； BUSYOVER（忙碌转移）：按照顺序依次进行空闲检测，第一个空闲检测成功的机器选定为目标执行器并发起调度； SHARDING_BROADCAST(分片广播)：广播触发对应集群中所有机器执行一次任务，同时系统自动传递分片参数；可根据分片参数开发分片任务； - 子任务：每个任务都拥有一个唯一的任务ID(任务ID可以从任务列表获取)，当本任务执行结束并且执行成功时，将会触发子任务ID所对应的任务的一次主动调度。 - 调度过期策略： - 忽略：调度过期后，忽略过期的任务，从当前时间开始重新计算下次触发时间； - 立即执行一次：调度过期后，立即执行一次，并从当前时间开始重新计算下次触发时间； - 阻塞处理策略：调度过于密集执行器来不及处理时的处理策略； 单机串行（默认）：调度请求进入单机执行器后，调度请求进入FIFO队列并以串行方式运行； 丢弃后续调度：调度请求进入单机执行器后，发现执行器存在运行的调度任务，本次请求将会被丢弃并标记为失败； 覆盖之前调度：调度请求进入单机执行器后，发现执行器存在运行的调度任务，将会终止运行中的调度任务并清空队列，然后运行本地调度任务； - 任务超时时间：支持自定义任务超时时间，任务运行超时将会主动中断任务； - 失败重试次数；支持自定义任务失败重试次数，当任务失败时将会按照预设的失败重试次数主动进行重试； 3.1 BEAN模式（类形式） Bean模式任务，支持基于类的开发方式，每个任务对应一个Java类。\n优点：不限制项目环境，兼容性好。即使是无框架项目，如main方法直接启动的项目也可以提供支持，可以参考示例项目 “xxl-job-executor-sample-frameless”；\n缺点：\n每个任务需要占用一个Java类，造成类的浪费； 不支持自动扫描任务并注入到执行器容器，需要手动注入。 步骤一：执行器项目中，开发Job类：\n1、开发一个继承自\"com.xxl.job.core.handler.IJobHandler\"的JobHandler类，实现其中任务方法。\n2、手动通过如下方式注入到执行器容器。\n1 XxlJobExecutor.registJobHandler(\"demoJobHandler\", new DemoJobHandler()); 步骤二：调度中心，新建调度任务\n后续步骤和 “3.2 BEAN模式（方法形式）”一致，可以前往参考。\n3.2 BEAN模式（方法形式） Bean模式任务，支持基于方法的开发方式，每个任务对应一个方法。\n优点：\n每个任务只需要开发一个方法，并添加”@XxlJob”注解即可，更加方便、快速。 支持自动扫描任务并注入到执行器容器。 基于方法开发的任务，底层会生成JobHandler代理，和基于类的方式一样，任务也会以JobHandler的形式存在于执行器任务容器中。\n步骤一：执行器项目中，开发Job方法：\n1、任务开发：在Spring Bean实例中，开发Job方法；\n2、注解配置：为Job方法添加注解 “@XxlJob(value=“自定义jobhandler名称”, init = “JobHandler初始化方法”, destroy = “JobHandler销毁方法”)\"，注解value值对应的是调度中心新建任务的JobHandler属性的值。\n3、执行日志：需要通过 “XxlJobHelper.log” 打印执行日志；\n4、任务结果：默认任务结果为 “成功” 状态，不需要主动设置；如有诉求，比如设置任务结果为失败，可以通过 “XxlJobHelper.handleFail/handleSuccess” 自主设置任务结果；\n1 2 3 4 5 // 可参考Sample示例执行器中的 \"com.xxl.job.executor.jobhandler.SampleXxlJob\" ，如下： @XxlJob(\"demoJobHandler\") public void demoJobHandler() throws Exception { XxlJobHelper.log(\"XXL-JOB, Hello World.\"); } 步骤二：调度中心，新建调度任务\n参考上文“配置属性详细说明”对新建的任务进行参数配置，运行模式选中 “BEAN模式”，JobHandler属性填写任务注解“@XxlJob”中定义的值；\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 /** * XxlJob开发示例（Bean模式） * * 开发步骤： * 1、任务开发：在Spring Bean实例中，开发Job方法； * 2、注解配置：为Job方法添加注解 \"@XxlJob(value=\"自定义jobhandler名称\", init = \"JobHandler初始化方法\", destroy = \"JobHandler销毁方法\")\"，注解value值对应的是调度中心新建任务的JobHandler属性的值。 * 3、执行日志：需要通过 \"XxlJobHelper.log\" 打印执行日志； * 4、任务结果：默认任务结果为 \"成功\" 状态，不需要主动设置；如有诉求，比如设置任务结果为失败，可以通过 \"XxlJobHelper.handleFail/handleSuccess\" 自主设置任务结果； * * @author xuxueli 2019-12-11 21:52:51 */@Component public class SampleXxlJob { private static Logger logger = LoggerFactory.getLogger(SampleXxlJob.class); /** * 1、简单任务示例（Bean模式） */ @XxlJob(\"demoJobHandler\") public void demoJobHandler() throws Exception { XxlJobHelper.log(\"XXL-JOB, Hello World.\"); for (int i = 0; i \u003c 5; i++) { XxlJobHelper.log(\"beat at:\" + i); TimeUnit.SECONDS.sleep(2); } // default success } /** * 2、分片广播任务 */ @XxlJob(\"shardingJobHandler\") public void shardingJobHandler() throws Exception { // 分片参数 int shardIndex = XxlJobHelper.getShardIndex(); int shardTotal = XxlJobHelper.getShardTotal(); XxlJobHelper.log(\"分片参数：当前分片序号 = {}, 总分片数 = {}\", shardIndex, shardTotal); // 业务逻辑 for (int i = 0; i \u003c shardTotal; i++) { if (i == shardIndex) { XxlJobHelper.log(\"第 {} 片, 命中分片开始处理\", i); } else { XxlJobHelper.log(\"第 {} 片, 忽略\", i); } } } /** * 3、命令行任务 * * 参数示例：\"ls -a\" 或者 \"pwd\" */ @XxlJob(\"commandJobHandler\") public void commandJobHandler() throws Exception { String command = XxlJobHelper.getJobParam(); int exitValue = -1; BufferedReader bufferedReader = null; try { // valid if (command==null || command.trim().length()==0) { XxlJobHelper.handleFail(\"command empty.\"); return; } // command split String[] commandArray = command.split(\" \"); // command process ProcessBuilder processBuilder = new ProcessBuilder(); processBuilder.command(commandArray); processBuilder.redirectErrorStream(true); Process process = processBuilder.start(); //Process process = Runtime.getRuntime().exec(command); BufferedInputStream bufferedInputStream = new BufferedInputStream(process.getInputStream()); bufferedReader = new BufferedReader(new InputStreamReader(bufferedInputStream)); // command log String line; while ((line = bufferedReader.readLine()) != null) { XxlJobHelper.log(line); } // command exit process.waitFor(); exitValue = process.exitValue(); } catch (Exception e) { XxlJobHelper.log(e); } finally { if (bufferedReader != null) { bufferedReader.close(); } } if (exitValue == 0) { // default success } else { XxlJobHelper.handleFail(\"command exit value(\"+exitValue+\") is failed\"); } } /** * 4、跨平台Http任务 * * 参数示例： * * { * \"url\": \"http://www.baidu.com\", * \"method\": \"get\", * \"data\": \"hello world\" * } * */ @XxlJob(\"httpJobHandler\") public void httpJobHandler() throws Exception { // param String param = XxlJobHelper.getJobParam(); if (param==null || param.trim().length()==0) { XxlJobHelper.log(\"param[\"+ param +\"] invalid.\"); XxlJobHelper.handleFail(); return; } // param parse String url; String method; String data; try { Map paramMap =GsonTool.fromJson(param, Map.class); url = paramMap.get(\"url\"); method = paramMap.get(\"method\"); data = paramMap.get(\"data\"); } catch (Exception e) { XxlJobHelper.log(e); XxlJobHelper.handleFail(); return; } // param valid if (url==null || url.trim().isEmpty()) { XxlJobHelper.log(\"url[\"+ url +\"] invalid.\"); XxlJobHelper.handleFail(); return; } if (!isValidDomain( url)) { XxlJobHelper.log(\"url[\"+ url +\"] not allowed.\"); XxlJobHelper.handleFail(); return; } if (method==null || !Arrays.asList(\"GET\", \"POST\").contains(method.toUpperCase())) { XxlJobHelper.log(\"method[\"+ method +\"] invalid.\"); XxlJobHelper.handleFail(); return; } method = method.toUpperCase(); boolean isPostMethod = method.equals(\"POST\"); // request HttpURLConnection connection = null; BufferedReader bufferedReader = null; try { // connection URL realUrl = new URL(url); connection = (HttpURLConnection) realUrl.openConnection(); // connection setting connection.setRequestMethod(method); connection.setDoOutput(isPostMethod); connection.setDoInput(true); connection.setUseCaches(false); connection.setReadTimeout(5 * 1000); connection.setConnectTimeout(3 * 1000); connection.setRequestProperty(\"connection\", \"Keep-Alive\"); connection.setRequestProperty(\"Content-Type\", \"application/json;charset=UTF-8\"); connection.setRequestProperty(\"Accept-Charset\", \"application/json;charset=UTF-8\"); // do connection connection.connect(); // data if (isPostMethod \u0026\u0026 data!=null \u0026\u0026 !data.trim().isEmpty()) { DataOutputStream dataOutputStream = new DataOutputStream(connection.getOutputStream()); dataOutputStream.write(data.getBytes(StandardCharsets.UTF_8)); dataOutputStream.flush(); dataOutputStream.close(); } // valid StatusCode int statusCode = connection.getResponseCode(); if (statusCode != 200) { throw new RuntimeException(\"Http Request StatusCode(\" + statusCode + \") Invalid.\"); } // result bufferedReader = new BufferedReader(new InputStreamReader(connection.getInputStream(), StandardCharsets.UTF_8)); StringBuilder result = new StringBuilder(); String line; while ((line = bufferedReader.readLine()) != null) { result.append(line); } String responseMsg = result.toString(); XxlJobHelper.log(responseMsg); return; } catch (Exception e) { XxlJobHelper.log(e); XxlJobHelper.handleFail(); return; } finally { try { if (bufferedReader != null) { bufferedReader.close(); } if (connection != null) { connection.disconnect(); } } catch (Exception e2) { XxlJobHelper.log(e2); } } } // domain white-list, for httpJobHandler private static Set DOMAIN_WHITE_LIST = new HashSet(Arrays.asList( \"http://www.baidu.com\", \"http://cn.bing.com\" )); // valid if domain is in white-list private boolean isValidDomain(String url) { if (url == null || DOMAIN_WHITE_LIST.isEmpty()) { return false; } for (String prefix : DOMAIN_WHITE_LIST) { if (url.startsWith(prefix)) { return true; } } return false; } /** * 5、生命周期任务示例：任务初始化与销毁时，支持自定义相关逻辑； */ @XxlJob(value = \"demoJobHandler2\", init = \"init\", destroy = \"destroy\") public void demoJobHandler2() throws Exception { XxlJobHelper.log(\"XXL-JOB, Hello World.\"); } public void init(){ logger.info(\"init\"); } public void destroy(){ logger.info(\"destroy\"); } } 原生内置Bean模式任务（通用执行器）\n为方便用户参考与快速使用，提供 “通用执行器” 并内置多个Bean模式任务Handler，可以直接配置使用，如下：\n通用执行器说明：\nAppName：xxl-job-executor-sample 执行器代码： xxl-job-executor-sample-springboot：springboot版本 xxl-job-executor-sample-frameless：无框架版本 执行器内置任务列表：\na、demoJobHandler：简单示例任务，任务内部模拟耗时任务逻辑，用户可在线体验Rolling Log等功能； b、shardingJobHandler：分片示例任务，任务内部模拟处理分片参数，可参考熟悉分片任务； c、httpJobHandler：通用HTTP任务Handler；业务方只需要提供HTTP链接等信息即可，不限制语言、平台。任务入参示例如下： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // 1、简单示例： { \"url\": \"http://www.baidu.com\", \"method\": \"GET\", \"data\": \"hello world\" } // 2、完整参数示例： { \"url\": \"http://www.baidu.com\", // 请求URL \"method\": \"POST\", // 请求方法，支持：GET、POST、HEAD、OPTIONS、PUT、DELETE、TRACE \"contentType\": \"application/json\", // 请求内容类型，支持：application/json、application/x-www-form-urlencoded、application/xml、text/html、text/xml、text/plain \"headers\": { // 请求Header，key-value结构 \"header01\": \"value01\" }, \"cookies\": { // 请求Cookie，key-value结构 \"cookie01\": \"value01\" }, \"timeout\": 3000, // 请求超时时间，默认 3000；单位：毫秒； \"data\": \"request body data\", // 请求Body数据，仅针对 POST 请求有效 \"form\": { // 请求Form数据，仅针对 GET 请求有效 \"key01\": \"value01\" }, \"auth\": \"auth data\" // 请求认证信息, 通过Basic Auth方式认证 } d、commandJobHandler：通用命令行任务Handler；业务方只需要提供命令行即可，命令及参数之间通过空格隔开；如任务参数 “ls la” 或 “pwd” 将会执行命令并输出数据； 3.3 GLUE模式(Java) 任务以源码方式维护在调度中心，支持通过Web IDE在线更新，实时编译和生效，因此不需要指定JobHandler。开发流程如下：\n步骤一：调度中心，新建调度任务：\n参考上文“配置属性详细说明”对新建的任务进行参数配置，运行模式选中 “GLUE模式(Java)”；\n步骤二：开发任务代码：\n选中指定任务，点击该任务右侧“GLUE”按钮，将会前往GLUE任务的Web IDE界面，在该界面支持对任务代码进行开发（也可以在IDE中开发完成后，复制粘贴到编辑器中）。\n版本回溯功能（支持30个版本的版本回溯）：在GLUE任务的Web IDE界面，选择右上角下拉框“版本回溯”，会列出该GLUE的更新历史，选择相应版本即可显示该版本代码，保存后GLUE代码即回退到对应的历史版本；\n3.4 GLUE模式(Shell)、Python、NodeJS、PHP、PowerShell 四、操作指南 4.1 配置执行器 点击进入”执行器管理”界面，点击按钮 “+新增执行器” 弹框, 可新增执行器配置：\n执行器属性说明\nAppName: 是每个执行器集群的唯一标示AppName, 执行器会周期性以AppName为对象进行自动注册。可通过该配置自动发现注册成功的执行器, 供任务调度时使用; 名称: 执行器的名称, 因为AppName限制字母数字等组成,可读性不强, 名称为了提高执行器的可读性; 排序: 执行器的排序, 系统中需要执行器的地方,如任务新增, 将会按照该排序读取可用的执行器列表; 注册方式：调度中心获取执行器地址的方式； `自动注册：执行器自动进行执行器注册，调度中心通过底层注册表可以动态发现执行器机器地址；` `手动录入：人工手动录入执行器的地址信息，多地址逗号分隔，供调度中心使用；` 机器地址：\"注册方式\"为\"手动录入\"时有效，支持人工维护执行器的地址信息；注册地址格式可参考“http://127.0.0.1:9999/”，为执行器内嵌服务地址； 4.2 新建任务 进入任务管理界面，点击“新增任务”按钮，在弹出的“新增任务”界面配置任务属性后保存即可。详情页参考章节 “三、任务详解”。\n4.3 编辑任务 进入任务管理界面，选中指定任务。点击该任务右侧“编辑”按钮，在弹出的“编辑任务”界面更新任务属性后保存即可，可以修改设置的任务属性信息：\n4.4 编辑GLUE代码 该操作仅针对GLUE任务。\n选中指定任务，点击该任务右侧“GLUE”按钮，将会前往GLUE任务的Web IDE界面，在该界面支持对任务代码进行开发。可参考章节 “3.3 GLUE模式(Java)”。\n4.5 启动/停止任务 可对任务进行“启动”和“停止”操作。\n需要注意的是，此处的启动/停止仅针对任务的后续调度触发行为，不会影响到已经触发的调度任务，如需终止已经触发的调度任务，可查看“4.9 终止运行中的任务”\n4.6 手动触发一次调度 点击“执行一次”按钮，可手动触发一次任务调度，不影响原有调度规则。\n4.7 查看调度日志 点击“日志”按钮，可以查看任务历史调度日志。在历史调度日志界面可查看每次任务调度的调度结果、执行结果等，点击“执行日志”按钮可查看执行器完整日志。\n4.8 查看执行日志 点击执行日志右侧的 “执行日志” 按钮，可跳转至执行日志界面，可以查看业务代码中打印的完整日志。\n4.9 终止运行中的任务 仅针对执行中的任务。\n在任务日志界面，点击右侧的“终止任务”按钮，将会向本次任务对应的执行器发送任务终止请求，将会终止掉本次任务，同时会清空掉整个任务执行队列。\n任务终止时通过 “interrupt” 执行线程的方式实现, 将会触发 “InterruptedException” 异常。因此如果JobHandler内部catch到了该异常并消化掉的话, 任务终止功能将不可用。\n因此, 如果遇到上述任务终止不可用的情况, 需要在JobHandler中应该针对 “InterruptedException” 异常进行特殊处理 (向上抛出) , 正确逻辑如下:\n1 2 3 4 5 6 7 8 try{ // do something } catch (Exception e) { if (e instanceof InterruptedException) { throw e; } logger.warn(\"{}\", e); } 而且，在JobHandler中开启子线程时，子线程也不可catch处理”InterruptedException”，应该主动向上抛出。\n任务终止时会执行对应JobHandler的”destroy()”方法，可以借助该方法处理一些资源回收的逻辑。\n4.10 删除执行日志 在任务日志界面，选中执行器和任务之后，点击右侧的”删除”按钮将会出现”日志清理”弹框，弹框中支持选择不同类型的日志清理策略，选中后点击”确定”按钮即可进行日志清理操作；\n4.11 删除任务 点击删除按钮，可以删除对应任务。\n4.12 用户管理 进入 “用户管理” 界面，可查看和管理用户信息；\n目前用户分为两种角色：\n管理员：拥有全量权限，支持在线管理用户信息，为用户分配权限，权限分配粒度为执行器； 普通用户：仅拥有被分配权限的执行器，及相关任务的操作权限； 五、总体设计 5.1 源码目录介绍 1 2 3 4 5 /doc :文档资料 /db :“调度数据库”建表脚本 /xxl-job-admin :调度中心，项目源码 /xxl-job-core :公共Jar依赖 /xxl-job-executor-samples :执行器，Sample示例项目（大家可以在该项目上进行开发，也可以将现有项目改造生成执行器项目） 5.2 “调度数据库”配置 XXL-JOB调度模块基于自研调度组件并支持集群部署，调度数据库表说明如下：\n1 2 3 4 5 6 7 8 xl_job_lock：任务调度锁表； xxl_job_group：执行器信息表，维护任务执行器信息； xxl_job_info：调度扩展信息表： 用于保存XXL-JOB调度任务的扩展信息，如任务分组、任务名、机器地址、执行器、执行入参和报警邮件等等； xxl_job_log：调度日志表： 用于保存XXL-JOB任务调度的历史信息，如调度结果、执行结果、调度入参、调度机器和执行器等等； xxl_job_log_report：调度日志报表：用户存储XXL-JOB任务调度日志的报表，调度中心报表功能页面会用到； xxl_job_logglue：任务GLUE日志：用于保存GLUE更新历史，用于支持GLUE的版本回溯功能； xxl_job_registry：执行器注册表，维护在线的执行器和调度中心机器地址信息； xxl_job_user：系统用户表； 5.3 架构设计 5.3.1 设计思想 将调度行为抽象形成“调度中心”公共平台，而平台自身并不承担业务逻辑，“调度中心”负责发起调度请求。\n将任务抽象成分散的JobHandler，交由“执行器”统一管理，“执行器”负责接收调度请求并执行对应的JobHandler中的业务逻辑。\n因此，“调度”和“任务”两部分可以相互解耦，提高系统整体稳定性和扩展性；\n5.3.2 系统组成 调度模块（调度中心）：\n负责管理调度信息，按照调度配置发出调度请求，自身不承担业务代码。调度系统与任务解耦，提高了系统可用性和稳定性，同时调度系统性能不再受限于任务模块；\n支持可视化、简单且动态的管理调度信息，包括任务新建，更新，删除，GLUE开发和任务报警等，所有上述操作都会实时生效，同时支持监控调度结果以及执行日志，支持执行器Failover。 执行模块（执行器）：\n负责接收调度请求并执行任务逻辑。任务模块专注于任务的执行等操作，开发和维护更加简单和高效；\n接收“调度中心”的执行请求、终止请求和日志请求等。 5.3.3 架构图 5.4 调度模块剖析 5.4.1 quartz的不足 Quartz作为开源作业调度中的佼佼者，是作业调度的首选。但是集群环境中Quartz采用API的方式对任务进行管理，从而可以避免上述问题，但是同样存在以下问题：\n问题一：调用API的方式操作任务，不人性化； 问题二：需要持久化业务QuartzJobBean到底层数据表中，系统侵入性相当严重。 问题三：调度逻辑和QuartzJobBean耦合在同一个项目中，这将导致一个问题，在调度任务数量逐渐增多，同时调度任务逻辑逐渐加重的情况下，此时调度系统的性能将大大受限于业务； 问题四：quartz底层以“抢占式”获取DB锁并由抢占成功节点负责运行任务，会导致节点负载悬殊非常大；而XXL-JOB通过执行器实现“协同分配式”运行任务，充分发挥集群优势，负载各节点均衡。 XXL-JOB弥补了quartz的上述不足之处。\n5.4.2 自研调度模块 XXL-JOB最终选择自研调度组件（早期调度组件基于Quartz）；一方面是为了精简系统降低冗余依赖，另一方面是为了提供系统的可控度与稳定性；\nXXL-JOB中“调度模块”和“任务模块”完全解耦，调度模块进行任务调度时，将会解析不同的任务参数发起远程调用，调用各自的远程执行器服务。这种调用模型类似RPC调用，调度中心提供调用代理的功能，而执行器提供远程服务的功能。\n5.4.3 调度中心HA（集群） 基于数据库的集群方案，数据库选用Mysql；集群分布式并发环境中进行定时任务调度时，会在各个节点上报任务，存到数据库中，执行时会从数据库中取出触发器来执行，如果触发器的名称和执行时间相同，则只有一个节点去执行此任务。\n5.4.4 调度线程池 调度采用线程池方式实现，避免单线程因阻塞而引起任务调度延迟。\n5.4.5 并行调度 XXL-JOB调度模块默认采用并行机制，在多线程调度的情况下，调度模块被阻塞的几率很低，大大提高了调度系统的承载量。\nXXL-JOB的不同任务之间并行调度、并行执行。\nXXL-JOB的单个任务，针对多个执行器是并行运行的，针对单个执行器是串行执行的。同时支持任务终止。\n5.4.6 过期处理策略 任务调度错过触发时间时的处理策略：\n可能原因：服务重启；调度线程被阻塞，线程被耗尽；上次调度持续阻塞，下次调度被错过； 处理策略： 过期超5s：本次忽略，当前时间开始计算下次触发时间 过期5s内：立即触发一次，当前时间开始计算下次触发时间 5.4.7 日志回调服务 调度模块的“调度中心”作为Web服务部署时，一方面承担调度中心功能，另一方面也为执行器提供API服务。\n调度中心提供的”日志回调服务API服务”代码位置如下：\nxxl-job-admin#com.xxl.job.admin.controller.JobApiController.callback “执行器”在接收到任务执行请求后，执行任务，在执行结束之后会将执行结果回调通知“调度中心”：\n5.4.8 任务HA（Failover） 执行器如若集群部署，调度中心将会感知到在线的所有执行器，如“127.0.0.1:9997, 127.0.0.1:9998, 127.0.0.1:9999”。\n当任务”路由策略”选择”故障转移(FAILOVER)”时，当调度中心每次发起调度请求时，会按照顺序对执行器发出心跳检测请求，第一个检测为存活状态的执行器将会被选定并发送调度请求。\n调度成功后，可在日志监控界面查看“调度备注”，如下；\n“调度备注”可以看出本地调度运行轨迹，执行器的”注册方式”、”地址列表”和任务的”路由策略”。”故障转移(FAILOVER)”路由策略下，调度中心首先对第一个地址进行心跳检测，心跳失败因此自动跳过，第二个依然心跳检测失败……\n直至心跳检测第三个地址“127.0.0.1:9999”成功，选定为“目标执行器”；然后对“目标执行器”发送调度请求，调度流程结束，等待执行器回调执行结果。\n5.4.9 调度日志 调度中心每次进行任务调度，都会记录一条任务日志，任务日志主要包括以下三部分内容：\n任务信息：包括“执行器地址”、“JobHandler”和“执行参数”等属性，点击任务ID按钮可查看，根据这些参数，可以精确的定位任务执行的具体机器和任务代码； 调度信息：包括“调度时间”、“调度结果”和“调度日志”等，根据这些参数，可以了解“调度中心”发起调度请求时的具体情况。 执行信息：包括“执行时间”、“执行结果”和“执行日志”等，根据这些参数，可以了解在“执行器”端任务执行的具体情况； 调度日志，针对单次调度，属性说明如下：\n执行器地址：任务执行的机器地址； JobHandler：Bean模式表示任务执行的JobHandler名称； 任务参数：任务执行的入参； 调度时间：调度中心，发起调度的时间； 调度结果：调度中心，发起调度的结果，SUCCESS或FAIL； 调度备注：调度中心，发起调度的备注信息，如地址心跳检测日志等； 执行时间：执行器，任务执行结束后回调的时间； 执行结果：执行器，任务执行的结果，SUCCESS或FAIL； 执行备注：执行器，任务执行的备注信息，如异常日志等； 执行日志：任务执行过程中，业务代码中打印的完整执行日志，见“4.8 查看执行日志”； 5.4.10 任务依赖 原理：XXL-JOB中每个任务都对应有一个任务ID，同时，每个任务支持设置属性“子任务ID”，因此，通过“任务ID”可以匹配任务依赖关系。\n当父任务执行结束并且执行成功时，将会根据“子任务ID”匹配子任务依赖，如果匹配到子任务，将会主动触发一次子任务的执行。\n在任务日志界面，点击任务的“执行备注”的“查看”按钮，可以看到匹配子任务以及触发子任务执行的日志信息，如无信息则表示未触发子任务执行，可参考下图。\n5.4.11 全异步化 \u0026 轻量级 全异步化设计：XXL-JOB系统中业务逻辑在远程执行器执行，触发流程全异步化设计。相比直接在调度中心内部执行业务逻辑，极大的降低了调度线程占用时间； 异步调度：调度中心每次任务触发时仅发送一次调度请求，该调度请求首先推送“异步调度队列”，然后异步推送给远程执行器 异步执行：执行器会将请求存入“异步执行队列”并且立即响应调度中心，异步运行。 轻量级设计：XXL-JOB调度中心中每个JOB逻辑非常 “轻”，在全异步化的基础上，单个JOB一次运行平均耗时基本在 “10ms” 之内（基本为一次请求的网络开销）；因此，可以保证使用有限的线程支撑大量的JOB并发运行； 得益于上述两点优化，理论上默认配置下的调度中心，单机能够支撑 5000 任务并发运行稳定运行；\n实际场景中，由于调度中心与执行器网络ping延迟不同、DB读写耗时不同、任务调度密集程度不同，会导致任务量上限上下波动。\n如若需要支撑更多的任务量，可以通过 “调大调度线程数” 、”降低调度中心与执行器ping延迟” 和 “提升机器配置” 几种方式优化。\n5.4.12 均衡调度 调度中心在集群部署时会自动进行任务平均分配，触发组件每次获取与线程池数量（调度中心支持自定义调度线程池大小）相关数量的任务，避免大量任务集中在单个调度中心集群节点；\n5.5 任务 “运行模式” 剖析 5.5.1 “Bean模式” 任务 开发步骤：可参考 “章节三” ；\n原理：每个Bean模式任务都是一个Spring的Bean类实例，它被维护在“执行器”项目的Spring容器中。任务类需要加“@JobHandler(value=”名称”)”注解，因为“执行器”会根据该注解识别Spring容器中的任务。任务类需要继承统一接口“IJobHandler”，任务逻辑在execute方法中开发，因为“执行器”在接收到调度中心的调度请求时，将会调用“IJobHandler”的execute方法，执行任务逻辑。\n5.5.2 “GLUE模式(Java)” 任务 开发步骤：可参考 “章节三” ；\n原理：每个 “GLUE模式(Java)” 任务的代码，实际上是“一个继承自“IJobHandler”的实现类的类代码”，“执行器”接收到“调度中心”的调度请求时，会通过Groovy类加载器加载此代码，实例化成Java对象，同时注入此代码中声明的Spring服务（请确保Glue代码中的服务和类引用在“执行器”项目中存在），然后调用该对象的execute方法，执行任务逻辑。\n5.5.3 GLUE模式(Shell) + GLUE模式(Python) + GLUE模式(PHP) + GLUE模式(NodeJS) + GLUE模式(Powershell) 开发步骤：可参考 “章节三” ；\n原理：脚本任务的源码托管在调度中心，脚本逻辑在执行器运行。当触发脚本任务时，执行器会加载脚本源码在执行器机器上生成一份脚本文件，然后通过Java代码调用该脚本；并且实时将脚本输出日志写到任务日志文件中，从而在调度中心可以实时监控脚本运行情况；\n目前支持的脚本类型如下：\n1 2 3 4 5 - shell脚本：任务运行模式选择为 \"GLUE模式(Shell)\"时支持 \"Shell\" 脚本任务； - python脚本：任务运行模式选择为 \"GLUE模式(Python)\"时支持 \"Python\" 脚本任务； - php脚本：任务运行模式选择为 \"GLUE模式(PHP)\"时支持 \"PHP\" 脚本任务； - nodejs脚本：任务运行模式选择为 \"GLUE模式(NodeJS)\"时支持 \"NodeJS\" 脚本任务； - powershell：任务运行模式选择为 \"GLUE模式(PowerShell)\"时支持 \"PowerShell\" 脚本任务； 脚本任务通过 Exit Code 判断任务执行结果，状态码可参考章节 “5.15 任务执行结果说明”；\n5.5.4 执行器 执行器实际上是一个内嵌的Server，默认端口9999（配置项：xxl.job.executor.port）。\n在项目启动时，执行器会通过“@XxlJob”识别Spring容器中“Bean模式任务”，以注解的value属性为key管理起来。\n“执行器”接收到“调度中心”的调度请求时，如果任务类型为“Bean模式”，将会匹配Spring容器中的“Bean模式任务”，然后调用其execute方法，执行任务逻辑。如果任务类型为“GLUE模式”，将会加载GLue代码，实例化Java对象，注入依赖的Spring服务（注意：Glue代码中注入的Spring服务，必须存在与该“执行器”项目的Spring容器中），然后调用execute方法，执行任务逻辑。\n5.5.5 任务日志 XXL-JOB会为每次调度请求生成一个单独的日志文件，需要通过 “XxlJobHelper.log” 打印执行日志，“调度中心”查看执行日志时将会加载对应的日志文件。\n(历史版本通过重写LOG4J的Appender实现，存在依赖限制，该方式在新版本已经被抛弃)\n日志文件存放的位置可在“执行器”配置文件进行自定义，默认目录格式为：/data/applogs/xxl-job/jobhandler/“格式化日期”/“数据库调度日志记录的主键ID.log”。\n在JobHandler中开启子线程时，子线程将会把日志打印在父线程即JobHandler的执行日志中，方便日志追踪。\n5.6 通讯模块剖析 5.6.1 一次完整的任务调度通讯流程 1 2 3 - 1、“调度中心”向“执行器”发送http调度请求: “执行器”中接收请求的服务，实际上是一台内嵌Server，默认端口9999; - 2、“执行器”执行任务逻辑； - 3、“执行器”http回调“调度中心”调度结果: “调度中心”中接收回调的服务，是针对执行器开放一套API服务; 5.6.2 通讯数据加密 调度中心向执行器发送的调度请求时使用RequestModel和ResponseModel两个对象封装调度请求参数和响应数据, 在进行通讯之前底层会将上述两个对象对象序列化，并进行数据协议以及时间戳检验,从而达到数据加密的功能;\n5.7 任务注册, 任务自动发现 自v1.5版本之后, 任务取消了”任务执行机器”属性, 改为通过任务注册和自动发现的方式, 动态获取远程执行器地址并执行。\n1 2 3 4 AppName: 每个执行器机器集群的唯一标示, 任务注册以 \"执行器\" 为最小粒度进行注册; 每个任务通过其绑定的执行器可感知对应的执行器机器列表; 注册表: 见\"xxl_job_registry\"表, \"执行器\" 在进行任务注册时将会周期性维护一条注册记录，即机器地址和AppName的绑定关系; \"调度中心\" 从而可以动态感知每个AppName在线的机器列表; 执行器注册: 任务注册Beat周期默认30s; 执行器以一倍Beat进行执行器注册, 调度中心以一倍Beat进行动态任务发现; 注册信息的失效时间为三倍Beat; 执行器注册摘除：执行器销毁时，将会主动上报调度中心并摘除对应的执行器机器信息，提高心跳注册的实时性； 为保证系统”轻量级”并且降低学习部署成本，没有采用Zookeeper作为注册中心，采用DB方式进行任务注册发现；\n5.8 任务执行结果 自v1.6.2之后，任务执行结果通过 “IJobHandler” 的返回值 “ReturnT” 进行判断；\n当返回值符合 “ReturnT#code == 200” 时表示任务执行成功，否则表示任务执行失败，而且可以通过 “ReturnT#msg” 回调错误信息给调度中心；\n从而，在任务逻辑中可以方便的控制任务执行结果；\n5.9 分片广播 \u0026 动态分片 执行器集群部署时，任务路由策略选择”分片广播”情况下，一次任务调度将会广播触发对应集群中所有执行器执行一次任务，同时系统自动传递分片参数；可根据分片参数开发分片任务；\n“分片广播” 以执行器为维度进行分片，支持动态扩容执行器集群从而动态增加分片数量，协同进行业务处理；在进行大数据量业务操作时可显著提升任务处理能力和速度。\n“分片广播” 和普通任务开发流程一致，不同之处在于可以获取分片参数，获取分片参数进行分片业务处理。\nJava语言任务获取分片参数方式：BEAN、GLUE模式(Java)\n1 2 3 // 可参考Sample示例执行器中的示例任务\"ShardingJobHandler\"了解试用 int shardIndex = XxlJobHelper.getShardIndex(); int shardTotal = XxlJobHelper.getShardTotal(); 脚本语言任务获取分片参数方式：GLUE模式(Shell)、GLUE模式(Python)、GLUE模式(Nodejs)\n1 2 3 // 脚本任务入参固定为三个，依次为：任务传参、分片序号、分片总数。以Shell模式任务为例，获取分片参数代码如下 cho \"分片序号 index = $2\" echo \"分片总数 total = $3\" 分片参数属性说明：\nindex：当前分片序号(从0开始)，执行器集群列表中当前执行器的序号； total：总分片数，执行器集群的总机器数量； 5.10 访问令牌（AccessToken） 为提升系统安全性，调度中心和执行器进行安全性校验，双方AccessToken匹配才允许通讯；\n调度中心和执行器，可通过配置项 “xxl.job.accessToken” 进行AccessToken的设置。\n调度中心和执行器，如果需要正常通讯，只有两种设置；\n设置一：调度中心和执行器，均不设置AccessToken；关闭安全性校验； 设置二：调度中心和执行器，设置了相同的AccessToken； 5.11 故障转移 \u0026 失败重试 一次完整任务流程包括”调度（调度中心） + 执行（执行器）”两个阶段。\n“故障转移”发生在调度阶段，在执行器集群部署时，如果某一台执行器发生故障，该策略支持自动进行Failover切换到一台正常的执行器机器并且完成调度请求流程。 “失败重试”发生在”调度 + 执行”两个阶段，支持通过自定义任务失败重试次数，当任务失败时将会按照预设的失败重试次数主动进行重试； 5.12 执行器灰度上线 调度中心与业务解耦，只需部署一次后常年不需要维护。但是，执行器中托管运行着业务作业，作业上线和变更需要重启执行器，尤其是Bean模式任务。\n执行器重启可能会中断运行中的任务。但是，XXL-JOB得益于自建执行器与自建注册中心，可以通过灰度上线的方式，避免因重启导致的任务中断的问题。\n步骤如下：\n1、执行器改为手动注册，下线一半机器列表（A组），线上运行另一半机器列表（B组）； 2、等待A组机器任务运行结束并编译上线；执行器注册地址替换为A组； 3、等待B组机器任务运行结束并编译上线；执行器注册地址替换为A组+B组；\n操作结束； 5.13 任务执行结果说明 系统根据以下标准判断任务执行结果，可参考之。\n— Bean/Glue(Java) Glue(Shell) 等脚本任务 成功 IJobHandler.SUCCESS 0 失败 IJobHandler.FAIL -1（非0状态码） 5.14 任务超时控制 支持设置任务超时时间，任务运行超时的情况下，将会主动中断任务；\n需要注意的是，任务超时中断时与任务终止机制（可查看“4.9 终止运行中的任务”）类似，也是通过 “interrupt” 中断任务，因此业务代码需要将 “InterruptedException” 外抛，否则功能不可用。\n5.15 跨语言 XXL-JOB是一个跨语言的任务调度平台，主要体现在如下几个方面：\n1、OpenApi（RESTful 格式）：调度中心与执行器提供语言无关的 RESTful API 服务，第三方任意语言可据此对接调度中心或者实现执行器，实现多语言支持。（可参考章节 “调度中心/执行器 RESTful API” ） 2、多任务模式：提供Java、Python、PHP……等十来种任务模式，可参考章节 “5.5 任务 “运行模式” ”；理论上可扩展任意语言任务模式； 2、提供基于HTTP的任务Handler（Bean任务，JobHandler=”httpJobHandler”）；业务方只需要提供HTTP链接等相关信息即可，不限制语言、平台；（可参考章节 “原生内置Bean模式任务” ） 5.16 任务失败告警 默认提供邮件失败告警，可扩展短信、钉钉等方式。如果需要新增一种告警方式，只需要新增一个实现 “com.xxl.job.admin.core.alarm.JobAlarm” 接口的告警实现即可。可以参考默认提供邮箱告警实现 “EmailJobAlarm”。\n5.17 调度中心Docker镜像构建 可以通过以下命令快速构建调度中心，并启动运行；\nmvn clean package docker build -t xuxueli/xxl-job-admin:{version} ./xxl-job-admin docker run --name xxl-job-admin -p 8080:8080 -d xuxueli/xxl-job-admin 5.20 避免任务重复执行 调度密集或者耗时任务可能会导致任务阻塞，集群情况下调度组件小概率情况下会重复触发；\n针对上述情况，可以通过结合 “单机路由策略（如：第一台、一致性哈希）” + “阻塞策略（如：单机串行、丢弃后续调度）” 来规避，最终避免任务重复执行。\n5.21 命令行任务 原生提供通用命令行任务Handler（Bean任务，”CommandJobHandler”）；业务方只需要提供命令行即可，命令及参数之间通过空格隔开；\n如任务参数 “ls la” 或 “pwd” 将会执行命令并输出数据；\n5.22 日志自动清理 XXL-JOB日志主要包含如下两部分，均支持日志自动清理，说明如下：\n调度中心日志表数据：可借助配置项 “xxl.job.logretentiondays” 设置日志表数据保存天数，过期日志自动清理；详情可查看上文配置说明； 执行器日志文件数据：可借助配置项 “xxl.job.executor.logretentiondays” 设置日志文件数据保存天数，过期日志自动清理；详情可查看上文配置说明； 5.23 调度结果丢失处理 执行器因网络抖动回调失败或宕机等异常情况，会导致任务调度结果丢失。由于调度中心依赖执行器回调来感知调度结果，因此会导致调度日志永远处于 “运行中” 状态。\n针对该问题，调度中心提供内置组件进行处理，逻辑为：调度记录停留在 “运行中” 状态超过10min，且对应执行器心跳注册失败不在线，则将本地调度主动标记失败；\n六、调度中心/执行器 OpenApi XXL-JOB 目标是一种跨平台、跨语言的任务调度规范和协议。\n针对Java应用，可以直接通过官方提供的调度中心与执行器，方便快速的接入和使用调度中心，可以参考上文 “快速入门” 章节。\n针对非Java应用，可借助 XXL-JOB 的标准 OpenApi（RESTful API） 方便的实现多语言支持。\n调度中心 RESTful API： 说明：调度中心提供给执行器使用的API；不局限于官方执行器使用，第三方可使用该API来实现执行器； API列表：执行器注册、任务结果回调等； 执行器 RESTful API ： 说明：执行器提供给调度中心使用的API；官方执行器默认已实现，第三方执行器需要实现并对接提供给调度中心； API列表：任务触发、任务终止、任务日志查询……等； 此处 RESTful API 主要用于非Java语言定制个性化执行器使用，实现跨语言。除此之外，如果有需要通过API操作调度中心，可以个性化扩展 “调度中心 RESTful API” 并使用。\n6.1 调度中心 RESTful API API服务位置：com.xxl.job.core.biz.AdminBiz （ com.xxl.job.admin.controller.JobApiController ）\nAPI服务请求参考代码：com.xxl.job.adminbiz.AdminBizTest\na、任务回调 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 说明：执行器执行完任务后，回调任务结果时使用 ------ 地址格式：{调度中心根地址}/api/callback Header： XXL-JOB-ACCESS-TOKEN : {请求令牌} 请求数据格式如下，放置在 RequestBody 中，JSON格式： [{ \"logId\":1, // 本次调度日志ID \"logDateTim\":0, // 本次调度日志时间 \"handleCode\":200, // 200 表示任务执行正常，500表示失败 \"handleMsg\": null } }] 响应数据格式： { \"code\": 200, // 200 表示正常、其他失败 \"msg\": null // 错误提示消息 } b、执行器注册 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 说明：执行器注册时使用，调度中心会实时感知注册成功的执行器并发起任务调度 ------ 地址格式：{调度中心根地址}/api/registry Header： XXL-JOB-ACCESS-TOKEN : {请求令牌} 请求数据格式如下，放置在 RequestBody 中，JSON格式： { \"registryGroup\":\"EXECUTOR\", // 固定值 \"registryKey\":\"xxl-job-executor-example\", // 执行器AppName \"registryValue\":\"http://127.0.0.1:9999/\" // 执行器地址，内置服务跟地址 } 响应数据格式： { \"code\": 200, // 200 表示正常、其他失败 \"msg\": null // 错误提示消息 } c、执行器注册摘除 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 说明：执行器注册摘除时使用，注册摘除后的执行器不参与任务调度与执行 ------ 地址格式：{调度中心根地址}/api/registryRemove Header： XXL-JOB-ACCESS-TOKEN : {请求令牌} 请求数据格式如下，放置在 RequestBody 中，JSON格式： { \"registryGroup\":\"EXECUTOR\", // 固定值 \"registryKey\":\"xxl-job-executor-example\", // 执行器AppName \"registryValue\":\"http://127.0.0.1:9999/\" // 执行器地址，内置服务跟地址 } 响应数据格式： { \"code\": 200, // 200 表示正常、其他失败 \"msg\": null // 错误提示消息 } 6.2 执行器 RESTful API API服务位置：com.xxl.job.core.biz.ExecutorBiz\nAPI服务请求参考代码：com.xxl.job.executorbiz.ExecutorBizTest\na、心跳检测 1 2 3 4 5 6 7 8 9 10 11 说明：调度中心检测执行器是否在线时使用 ------ 地址格式：{执行器内嵌服务根地址}/beat Header： XXL-JOB-ACCESS-TOKEN : {请求令牌} 请求数据格式如下，放置在 RequestBody 中，JSON格式： 响应数据格式： { \"code\": 200, // 200 表示正常、其他失败 \"msg\": null // 错误提示消息 } b、忙碌检测 1 2 3 4 5 6 7 8 9 10 11 12 13 14 说明：调度中心检测指定执行器上指定任务是否忙碌（运行中）时使用 ------ 地址格式：{执行器内嵌服务根地址}/idleBeat Header： XXL-JOB-ACCESS-TOKEN : {请求令牌} 请求数据格式如下，放置在 RequestBody 中，JSON格式： { \"jobId\":1 // 任务ID } 响应数据格式： { \"code\": 200, // 200 表示正常、其他失败 \"msg\": null // 错误提示消息 } c、触发任务 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 说明：触发任务执行 ------ 地址格式：{执行器内嵌服务根地址}/run Header： XXL-JOB-ACCESS-TOKEN : {请求令牌} 请求数据格式如下，放置在 RequestBody 中，JSON格式： { \"jobId\":1, // 任务ID \"executorHandler\":\"demoJobHandler\", // 任务标识 \"executorParams\":\"demoJobHandler\", // 任务参数 \"executorBlockStrategy\":\"COVER_EARLY\", // 任务阻塞策略，可选值参考 com.xxl.job.core.enums.ExecutorBlockStrategyEnum \"executorTimeout\":0, // 任务超时时间，单位秒，大于零时生效 \"logId\":1, // 本次调度日志ID \"logDateTime\":1586629003729, // 本次调度日志时间 \"glueType\":\"BEAN\", // 任务模式，可选值参考 com.xxl.job.core.glue.GlueTypeEnum \"glueSource\":\"xxx\", // GLUE脚本代码 \"glueUpdatetime\":1586629003727, // GLUE脚本更新时间，用于判定脚本是否变更以及是否需要刷新 \"broadcastIndex\":0, // 分片参数：当前分片 \"broadcastTotal\":0 // 分片参数：总分片 } 响应数据格式： { \"code\": 200, // 200 表示正常、其他失败 \"msg\": null // 错误提示消息 } d、终止任务 1 2 3 4 5 6 7 8 9 10 11 12 13 14 说明：终止任务 ------ 地址格式：{执行器内嵌服务根地址}/kill Header： XXL-JOB-ACCESS-TOKEN : {请求令牌} 请求数据格式如下，放置在 RequestBody 中，JSON格式： { \"jobId\":1 // 任务ID } 响应数据格式： { \"code\": 200, // 200 表示正常、其他失败 \"msg\": null // 错误提示消息 } e、查看执行日志 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 说明：查看任务日志，滚动方式加载 ------ 地址格式：{执行器内嵌服务根地址}/log Header： XXL-JOB-ACCESS-TOKEN : {请求令牌} 请求数据格式如下，放置在 RequestBody 中，JSON格式： { \"logDateTim\":0, // 本次调度日志时间 \"logId\":0, // 本次调度日志ID \"fromLineNum\":0 // 日志开始行号，滚动加载日志 } 响应数据格式： { \"code\":200, // 200 表示正常、其他失败 \"msg\": null // 错误提示消息 \"content\":{ \"fromLineNum\":0, // 本次请求，日志开始行数 \"toLineNum\":100, // 本次请求，日志结束行号 \"logContent\":\"xxx\", // 本次请求日志内容 \"isEnd\":true // 日志是否全部加载完 } } ",
  "wordCount" : "20217",
  "inLanguage": "en",
  "datePublished": "2025-10-10T20:08:55Z",
  "dateModified": "2025-10-10T20:08:55Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://wjy6.netlify.app/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/xxl-job/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://wjy6.netlify.app/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://wjy6.netlify.app/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://wjy6.netlify.app/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://wjy6.netlify.app/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://wjy6.netlify.app/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://wjy6.netlify.app/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://wjy6.netlify.app/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://wjy6.netlify.app/">Home</a>&nbsp;»&nbsp;<a href="https://wjy6.netlify.app/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      xxl-job
    </h1>
    <div class="post-meta"><span title='2025-10-10 20:08:55 +0000 UTC'>2025-10-10</span>&nbsp;·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%a6%82%e8%bf%b0" aria-label="概述">概述</a></li>
                <li>
                    <a href="#%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c" aria-label="准备工作">准备工作</a></li>
                <li>
                    <a href="#%e4%ba%8c%e5%bf%ab%e9%80%9f%e5%bc%80%e5%a7%8b" aria-label="二、快速开始">二、快速开始</a><ul>
                        
                <li>
                    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96%e8%b0%83%e5%ba%a6%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="初始化“调度数据库”">初始化“调度数据库”</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae%e9%83%a8%e7%bd%b2%e8%b0%83%e5%ba%a6%e4%b8%ad%e5%bf%83" aria-label="配置部署“调度中心”">配置部署“调度中心”</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae%e9%83%a8%e7%bd%b2%e6%89%a7%e8%a1%8c%e5%99%a8%e9%a1%b9%e7%9b%ae" aria-label="配置部署“执行器项目”">配置部署“执行器项目”</a></li>
                <li>
                    <a href="#%e5%bc%80%e5%8f%91%e7%ac%ac%e4%b8%80%e4%b8%aa%e4%bb%bb%e5%8a%a1hello-world" aria-label="开发第一个任务“Hello World”">开发第一个任务“Hello World”</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%89%e4%bb%bb%e5%8a%a1%e8%af%a6%e8%a7%a3" aria-label="三、任务详解">三、任务详解</a><ul>
                        
                <li>
                    <a href="#31-bean%e6%a8%a1%e5%bc%8f%e7%b1%bb%e5%bd%a2%e5%bc%8f" aria-label="3.1 BEAN模式（类形式）">3.1 BEAN模式（类形式）</a></li>
                <li>
                    <a href="#32-bean%e6%a8%a1%e5%bc%8f%e6%96%b9%e6%b3%95%e5%bd%a2%e5%bc%8f" aria-label="3.2 BEAN模式（方法形式）">3.2 BEAN模式（方法形式）</a></li>
                <li>
                    <a href="#33-glue%e6%a8%a1%e5%bc%8fjava" aria-label="3.3 GLUE模式(Java)">3.3 GLUE模式(Java)</a></li>
                <li>
                    <a href="#34-glue%e6%a8%a1%e5%bc%8fshellpythonnodejsphppowershell" aria-label="3.4 GLUE模式(Shell)、Python、NodeJS、PHP、PowerShell">3.4 GLUE模式(Shell)、Python、NodeJS、PHP、PowerShell</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%9b%9b%e6%93%8d%e4%bd%9c%e6%8c%87%e5%8d%97" aria-label="四、操作指南">四、操作指南</a><ul>
                        
                <li>
                    <a href="#41-%e9%85%8d%e7%bd%ae%e6%89%a7%e8%a1%8c%e5%99%a8" aria-label="4.1 配置执行器">4.1 配置执行器</a></li>
                <li>
                    <a href="#42-%e6%96%b0%e5%bb%ba%e4%bb%bb%e5%8a%a1" aria-label="4.2 新建任务">4.2 新建任务</a></li>
                <li>
                    <a href="#43-%e7%bc%96%e8%be%91%e4%bb%bb%e5%8a%a1" aria-label="4.3 编辑任务">4.3 编辑任务</a></li>
                <li>
                    <a href="#44-%e7%bc%96%e8%be%91glue%e4%bb%a3%e7%a0%81" aria-label="4.4 编辑GLUE代码">4.4 编辑GLUE代码</a></li>
                <li>
                    <a href="#45-%e5%90%af%e5%8a%a8%e5%81%9c%e6%ad%a2%e4%bb%bb%e5%8a%a1" aria-label="4.5 启动/停止任务">4.5 启动/停止任务</a></li>
                <li>
                    <a href="#46-%e6%89%8b%e5%8a%a8%e8%a7%a6%e5%8f%91%e4%b8%80%e6%ac%a1%e8%b0%83%e5%ba%a6" aria-label="4.6 手动触发一次调度">4.6 手动触发一次调度</a></li>
                <li>
                    <a href="#47-%e6%9f%a5%e7%9c%8b%e8%b0%83%e5%ba%a6%e6%97%a5%e5%bf%97" aria-label="4.7 查看调度日志">4.7 查看调度日志</a></li>
                <li>
                    <a href="#48-%e6%9f%a5%e7%9c%8b%e6%89%a7%e8%a1%8c%e6%97%a5%e5%bf%97" aria-label="4.8 查看执行日志">4.8 查看执行日志</a></li>
                <li>
                    <a href="#49-%e7%bb%88%e6%ad%a2%e8%bf%90%e8%a1%8c%e4%b8%ad%e7%9a%84%e4%bb%bb%e5%8a%a1" aria-label="4.9 终止运行中的任务">4.9 终止运行中的任务</a></li>
                <li>
                    <a href="#410-%e5%88%a0%e9%99%a4%e6%89%a7%e8%a1%8c%e6%97%a5%e5%bf%97" aria-label="4.10 删除执行日志">4.10 删除执行日志</a></li>
                <li>
                    <a href="#411-%e5%88%a0%e9%99%a4%e4%bb%bb%e5%8a%a1" aria-label="4.11 删除任务">4.11 删除任务</a></li>
                <li>
                    <a href="#412-%e7%94%a8%e6%88%b7%e7%ae%a1%e7%90%86" aria-label="4.12 用户管理">4.12 用户管理</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%94%e6%80%bb%e4%bd%93%e8%ae%be%e8%ae%a1" aria-label="五、总体设计">五、总体设计</a><ul>
                        
                <li>
                    <a href="#51-%e6%ba%90%e7%a0%81%e7%9b%ae%e5%bd%95%e4%bb%8b%e7%bb%8d" aria-label="5.1 源码目录介绍">5.1 源码目录介绍</a></li>
                <li>
                    <a href="#52-%e8%b0%83%e5%ba%a6%e6%95%b0%e6%8d%ae%e5%ba%93%e9%85%8d%e7%bd%ae" aria-label="5.2 “调度数据库”配置">5.2 “调度数据库”配置</a></li>
                <li>
                    <a href="#53-%e6%9e%b6%e6%9e%84%e8%ae%be%e8%ae%a1" aria-label="5.3 架构设计">5.3 架构设计</a><ul>
                        
                <li>
                    <a href="#531-%e8%ae%be%e8%ae%a1%e6%80%9d%e6%83%b3" aria-label="5.3.1 设计思想">5.3.1 设计思想</a></li>
                <li>
                    <a href="#532-%e7%b3%bb%e7%bb%9f%e7%bb%84%e6%88%90" aria-label="5.3.2 系统组成">5.3.2 系统组成</a></li>
                <li>
                    <a href="#533-%e6%9e%b6%e6%9e%84%e5%9b%be" aria-label="5.3.3 架构图">5.3.3 架构图</a></li></ul>
                </li>
                <li>
                    <a href="#54-%e8%b0%83%e5%ba%a6%e6%a8%a1%e5%9d%97%e5%89%96%e6%9e%90" aria-label="5.4 调度模块剖析">5.4 调度模块剖析</a><ul>
                        
                <li>
                    <a href="#541-quartz%e7%9a%84%e4%b8%8d%e8%b6%b3" aria-label="5.4.1 quartz的不足">5.4.1 quartz的不足</a></li>
                <li>
                    <a href="#542-%e8%87%aa%e7%a0%94%e8%b0%83%e5%ba%a6%e6%a8%a1%e5%9d%97" aria-label="5.4.2 自研调度模块">5.4.2 自研调度模块</a></li>
                <li>
                    <a href="#543-%e8%b0%83%e5%ba%a6%e4%b8%ad%e5%bf%83ha%e9%9b%86%e7%be%a4" aria-label="5.4.3 调度中心HA（集群）">5.4.3 调度中心HA（集群）</a></li>
                <li>
                    <a href="#544-%e8%b0%83%e5%ba%a6%e7%ba%bf%e7%a8%8b%e6%b1%a0" aria-label="5.4.4 调度线程池">5.4.4 调度线程池</a></li>
                <li>
                    <a href="#545-%e5%b9%b6%e8%a1%8c%e8%b0%83%e5%ba%a6" aria-label="5.4.5 并行调度">5.4.5 并行调度</a></li>
                <li>
                    <a href="#546-%e8%bf%87%e6%9c%9f%e5%a4%84%e7%90%86%e7%ad%96%e7%95%a5" aria-label="5.4.6 过期处理策略">5.4.6 过期处理策略</a></li>
                <li>
                    <a href="#547-%e6%97%a5%e5%bf%97%e5%9b%9e%e8%b0%83%e6%9c%8d%e5%8a%a1" aria-label="5.4.7 日志回调服务">5.4.7 日志回调服务</a></li>
                <li>
                    <a href="#548-%e4%bb%bb%e5%8a%a1hafailover" aria-label="5.4.8 任务HA（Failover）">5.4.8 任务HA（Failover）</a></li>
                <li>
                    <a href="#549-%e8%b0%83%e5%ba%a6%e6%97%a5%e5%bf%97" aria-label="5.4.9 调度日志">5.4.9 调度日志</a></li>
                <li>
                    <a href="#5410-%e4%bb%bb%e5%8a%a1%e4%be%9d%e8%b5%96" aria-label="5.4.10 任务依赖">5.4.10 任务依赖</a></li>
                <li>
                    <a href="#5411-%e5%85%a8%e5%bc%82%e6%ad%a5%e5%8c%96--%e8%bd%bb%e9%87%8f%e7%ba%a7" aria-label="5.4.11 全异步化 &amp; 轻量级">5.4.11 全异步化 &amp; 轻量级</a></li>
                <li>
                    <a href="#5412-%e5%9d%87%e8%a1%a1%e8%b0%83%e5%ba%a6" aria-label="5.4.12 均衡调度">5.4.12 均衡调度</a></li></ul>
                </li>
                <li>
                    <a href="#55-%e4%bb%bb%e5%8a%a1-%e8%bf%90%e8%a1%8c%e6%a8%a1%e5%bc%8f-%e5%89%96%e6%9e%90" aria-label="5.5 任务 “运行模式” 剖析">5.5 任务 “运行模式” 剖析</a><ul>
                        
                <li>
                    <a href="#551-bean%e6%a8%a1%e5%bc%8f-%e4%bb%bb%e5%8a%a1" aria-label="5.5.1 “Bean模式” 任务">5.5.1 “Bean模式” 任务</a></li>
                <li>
                    <a href="#552-glue%e6%a8%a1%e5%bc%8fjava-%e4%bb%bb%e5%8a%a1" aria-label="5.5.2 “GLUE模式(Java)” 任务">5.5.2 “GLUE模式(Java)” 任务</a></li>
                <li>
                    <a href="#553-glue%e6%a8%a1%e5%bc%8fshell--glue%e6%a8%a1%e5%bc%8fpython--glue%e6%a8%a1%e5%bc%8fphp--glue%e6%a8%a1%e5%bc%8fnodejs--glue%e6%a8%a1%e5%bc%8fpowershell" aria-label="5.5.3 GLUE模式(Shell) &#43; GLUE模式(Python) &#43; GLUE模式(PHP) &#43; GLUE模式(NodeJS) &#43; GLUE模式(Powershell)">5.5.3 GLUE模式(Shell) + GLUE模式(Python) + GLUE模式(PHP) + GLUE模式(NodeJS) + GLUE模式(Powershell)</a></li>
                <li>
                    <a href="#554-%e6%89%a7%e8%a1%8c%e5%99%a8" aria-label="5.5.4 执行器">5.5.4 执行器</a></li>
                <li>
                    <a href="#555-%e4%bb%bb%e5%8a%a1%e6%97%a5%e5%bf%97" aria-label="5.5.5 任务日志">5.5.5 任务日志</a></li></ul>
                </li>
                <li>
                    <a href="#56-%e9%80%9a%e8%ae%af%e6%a8%a1%e5%9d%97%e5%89%96%e6%9e%90" aria-label="5.6 通讯模块剖析">5.6 通讯模块剖析</a><ul>
                        
                <li>
                    <a href="#561-%e4%b8%80%e6%ac%a1%e5%ae%8c%e6%95%b4%e7%9a%84%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6%e9%80%9a%e8%ae%af%e6%b5%81%e7%a8%8b" aria-label="5.6.1 一次完整的任务调度通讯流程">5.6.1 一次完整的任务调度通讯流程</a></li>
                <li>
                    <a href="#562-%e9%80%9a%e8%ae%af%e6%95%b0%e6%8d%ae%e5%8a%a0%e5%af%86" aria-label="5.6.2 通讯数据加密">5.6.2 通讯数据加密</a></li></ul>
                </li>
                <li>
                    <a href="#57-%e4%bb%bb%e5%8a%a1%e6%b3%a8%e5%86%8c-%e4%bb%bb%e5%8a%a1%e8%87%aa%e5%8a%a8%e5%8f%91%e7%8e%b0" aria-label="5.7 任务注册, 任务自动发现">5.7 任务注册, 任务自动发现</a></li>
                <li>
                    <a href="#58-%e4%bb%bb%e5%8a%a1%e6%89%a7%e8%a1%8c%e7%bb%93%e6%9e%9c" aria-label="5.8 任务执行结果">5.8 任务执行结果</a></li>
                <li>
                    <a href="#59-%e5%88%86%e7%89%87%e5%b9%bf%e6%92%ad--%e5%8a%a8%e6%80%81%e5%88%86%e7%89%87" aria-label="5.9 分片广播 &amp; 动态分片">5.9 分片广播 &amp; 动态分片</a></li>
                <li>
                    <a href="#510-%e8%ae%bf%e9%97%ae%e4%bb%a4%e7%89%8caccesstoken" aria-label="5.10 访问令牌（AccessToken）">5.10 访问令牌（AccessToken）</a></li>
                <li>
                    <a href="#511-%e6%95%85%e9%9a%9c%e8%bd%ac%e7%a7%bb--%e5%a4%b1%e8%b4%a5%e9%87%8d%e8%af%95" aria-label="5.11 故障转移 &amp; 失败重试">5.11 故障转移 &amp; 失败重试</a></li>
                <li>
                    <a href="#512-%e6%89%a7%e8%a1%8c%e5%99%a8%e7%81%b0%e5%ba%a6%e4%b8%8a%e7%ba%bf" aria-label="5.12 执行器灰度上线">5.12 执行器灰度上线</a></li>
                <li>
                    <a href="#513-%e4%bb%bb%e5%8a%a1%e6%89%a7%e8%a1%8c%e7%bb%93%e6%9e%9c%e8%af%b4%e6%98%8e" aria-label="5.13 任务执行结果说明">5.13 任务执行结果说明</a></li>
                <li>
                    <a href="#514-%e4%bb%bb%e5%8a%a1%e8%b6%85%e6%97%b6%e6%8e%a7%e5%88%b6" aria-label="5.14 任务超时控制">5.14 任务超时控制</a></li>
                <li>
                    <a href="#515-%e8%b7%a8%e8%af%ad%e8%a8%80" aria-label="5.15 跨语言">5.15 跨语言</a></li>
                <li>
                    <a href="#516-%e4%bb%bb%e5%8a%a1%e5%a4%b1%e8%b4%a5%e5%91%8a%e8%ad%a6" aria-label="5.16 任务失败告警">5.16 任务失败告警</a></li>
                <li>
                    <a href="#517-%e8%b0%83%e5%ba%a6%e4%b8%ad%e5%bf%83docker%e9%95%9c%e5%83%8f%e6%9e%84%e5%bb%ba" aria-label="5.17 调度中心Docker镜像构建">5.17 调度中心Docker镜像构建</a></li>
                <li>
                    <a href="#520-%e9%81%bf%e5%85%8d%e4%bb%bb%e5%8a%a1%e9%87%8d%e5%a4%8d%e6%89%a7%e8%a1%8c" aria-label="5.20 避免任务重复执行">5.20 避免任务重复执行</a></li>
                <li>
                    <a href="#521-%e5%91%bd%e4%bb%a4%e8%a1%8c%e4%bb%bb%e5%8a%a1" aria-label="5.21 命令行任务">5.21 命令行任务</a></li>
                <li>
                    <a href="#522-%e6%97%a5%e5%bf%97%e8%87%aa%e5%8a%a8%e6%b8%85%e7%90%86" aria-label="5.22 日志自动清理">5.22 日志自动清理</a></li>
                <li>
                    <a href="#523-%e8%b0%83%e5%ba%a6%e7%bb%93%e6%9e%9c%e4%b8%a2%e5%a4%b1%e5%a4%84%e7%90%86" aria-label="5.23 调度结果丢失处理">5.23 调度结果丢失处理</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%85%ad%e8%b0%83%e5%ba%a6%e4%b8%ad%e5%bf%83%e6%89%a7%e8%a1%8c%e5%99%a8-openapi" aria-label="六、调度中心/执行器 OpenApi">六、调度中心/执行器 OpenApi</a><ul>
                        
                <li>
                    <a href="#61-%e8%b0%83%e5%ba%a6%e4%b8%ad%e5%bf%83-restful-api" aria-label="6.1 调度中心 RESTful API">6.1 调度中心 RESTful API</a><ul>
                        
                <li>
                    <a href="#a%e4%bb%bb%e5%8a%a1%e5%9b%9e%e8%b0%83" aria-label="a、任务回调">a、任务回调</a></li>
                <li>
                    <a href="#b%e6%89%a7%e8%a1%8c%e5%99%a8%e6%b3%a8%e5%86%8c" aria-label="b、执行器注册">b、执行器注册</a></li>
                <li>
                    <a href="#c%e6%89%a7%e8%a1%8c%e5%99%a8%e6%b3%a8%e5%86%8c%e6%91%98%e9%99%a4" aria-label="c、执行器注册摘除">c、执行器注册摘除</a></li></ul>
                </li>
                <li>
                    <a href="#62-%e6%89%a7%e8%a1%8c%e5%99%a8-restful-api" aria-label="6.2 执行器 RESTful API">6.2 执行器 RESTful API</a><ul>
                        
                <li>
                    <a href="#a%e5%bf%83%e8%b7%b3%e6%a3%80%e6%b5%8b" aria-label="a、心跳检测">a、心跳检测</a></li>
                <li>
                    <a href="#b%e5%bf%99%e7%a2%8c%e6%a3%80%e6%b5%8b" aria-label="b、忙碌检测">b、忙碌检测</a></li>
                <li>
                    <a href="#c%e8%a7%a6%e5%8f%91%e4%bb%bb%e5%8a%a1" aria-label="c、触发任务">c、触发任务</a></li>
                <li>
                    <a href="#d%e7%bb%88%e6%ad%a2%e4%bb%bb%e5%8a%a1" aria-label="d、终止任务">d、终止任务</a></li>
                <li>
                    <a href="#e%e6%9f%a5%e7%9c%8b%e6%89%a7%e8%a1%8c%e6%97%a5%e5%bf%97" aria-label="e、查看执行日志">e、查看执行日志</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="概述">概述<a hidden class="anchor" aria-hidden="true" href="#概述">#</a></h1>
<p>官网：<br>
<a href="https://www.xuxueli.com/xxl-job/">https://www.xuxueli.com/xxl-job/</a></p>
<h1 id="准备工作">准备工作<a hidden class="anchor" aria-hidden="true" href="#准备工作">#</a></h1>
<p>环境准备：</p>
<ul>
<li>Maven3+</li>
<li>Jdk17+ (说明：版本3.x开始要求Jdk17；版本2.x及以下支持Jdk1.8。如对Jdk版本有诉求，可选择接入不同版本。)</li>
<li>Mysql8.0+</li>
</ul>
<p>导入依赖：<br>
maven：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#007f7f">&lt;!-- https://mvnrepository.com/artifact/com.xuxueli/xxl-job-core --&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>com.xuxueli<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>xxl-job-core<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;version&gt;</span>3.2.0<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>gradle：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// https://mvnrepository.com/artifact/com.xuxueli/xxl-job-core
</span></span><span style="display:flex;"><span>implementation(&#34;com.xuxueli:xxl-job-core:3.2.0&#34;)
</span></span></code></pre></td></tr></table>
</div>
</div><p>克隆源码：</p>
<table>
<thead>
<tr>
<th>源码仓库地址</th>
<th>Release Download</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/xuxueli/xxl-job">https://github.com/xuxueli/xxl-job</a></td>
<td><a href="https://github.com/xuxueli/xxl-job/releases">Download</a></td>
</tr>
<tr>
<td><a href="http://gitee.com/xuxueli0323/xxl-job">http://gitee.com/xuxueli0323/xxl-job</a></td>
<td><a href="http://gitee.com/xuxueli0323/xxl-job/releases">Download</a></td>
</tr>
<tr>
<td><a href="https://gitcode.com/xuxueli/xxl-job">https://gitcode.com/xuxueli/xxl-job</a></td>
<td><a href="https://gitcode.com/xuxueli/xxl-job/tags">Download</a></td>
</tr>
</tbody>
</table>
<h1 id="二快速开始">二、快速开始<a hidden class="anchor" aria-hidden="true" href="#二快速开始">#</a></h1>
<h2 id="初始化调度数据库">初始化“调度数据库”<a hidden class="anchor" aria-hidden="true" href="#初始化调度数据库">#</a></h2>
<p>直接用idea拉代码：<br>
<a href="http://gitee.com/xuxueli0323/xxl-job">http://gitee.com/xuxueli0323/xxl-job</a></p>
<p>执行sql脚本，“调度数据库初始化SQL脚本” 位置为:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/xxl-job/doc/db/tables_xxl_job.sql
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="配置部署调度中心">配置部署“调度中心”<a hidden class="anchor" aria-hidden="true" href="#配置部署调度中心">#</a></h2>
<ol>
<li><code>调度中心项目：xxl-job-admin</code></li>
<li><code>作用：统一管理任务调度平台上调度任务，负责触发调度执行，并且提供任务管理平台。</code></li>
</ol>
<p>调度中心配置文件地址：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/xxl-job/xxl-job-admin/src/main/resources/application.properties
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改配置文件：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>### 调度中心JDBC链接
</span></span><span style="display:flex;"><span>spring.datasource.url=jdbc:mysql://127.0.0.1:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai
</span></span><span style="display:flex;"><span>spring.datasource.username=root
</span></span><span style="display:flex;"><span>spring.datasource.password=root_pwd
</span></span><span style="display:flex;"><span>spring.datasource.driver-class-name=com.mysql.jdbc.Driver
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>### 报警邮箱
</span></span><span style="display:flex;"><span>spring.mail.host=smtp.qq.com
</span></span><span style="display:flex;"><span>spring.mail.port=25
</span></span><span style="display:flex;"><span>spring.mail.username=xxx@qq.com
</span></span><span style="display:flex;"><span>spring.mail.password=xxx
</span></span><span style="display:flex;"><span>spring.mail.properties.mail.smtp.auth=true
</span></span><span style="display:flex;"><span>spring.mail.properties.mail.smtp.starttls.enable=true
</span></span><span style="display:flex;"><span>spring.mail.properties.mail.smtp.starttls.required=true
</span></span><span style="display:flex;"><span>spring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>### 调度中心通讯TOKEN [选填]：非空时启用；
</span></span><span style="display:flex;"><span>xxl.job.accessToken=
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>### 调度中心通讯超时时间[选填]，单位秒；默认3s；
</span></span><span style="display:flex;"><span>xxl.job.timeout=3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>### 调度中心国际化配置 [必填]： 默认为 &#34;zh_CN&#34;/中文简体, 可选范围为 &#34;zh_CN&#34;/中文简体, &#34;zh_TC&#34;/中文繁体 and &#34;en&#34;/英文；
</span></span><span style="display:flex;"><span>xxl.job.i18n=zh_CN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>## 调度线程池最大线程配置【必填】
</span></span><span style="display:flex;"><span>xxl.job.triggerpool.fast.max=200
</span></span><span style="display:flex;"><span>xxl.job.triggerpool.slow.max=100
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>### 调度中心日志表数据保存天数 [必填]：过期日志自动清理；限制大于等于7时生效，否则, 如-1，关闭自动清理功能；
</span></span><span style="display:flex;"><span>xxl.job.logretentiondays=30
</span></span></code></pre></td></tr></table>
</div>
</div><p>部署或运行项目：</p>
<p>启动报错：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Failed to create parent directories for [/data/applogs/xxl-job/xxl-job-admin.log]
</span></span></code></pre></td></tr></table>
</div>
</div><p>原因：没有权限在根目录下创建文件。</p>
<p>解决方案：<br>
找到logback.xml，修改日志路径为家目录：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;property name=&#34;log.path&#34; value=&#34;${LOG_HOME:-/Users/wjy/data/applogs}/xxl-job/xxl-job-admin.log&#34; /&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动成功后访问：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>http://localhost:8888/xxl-job-admin (该地址执行器将会使用到，作为回调地址)
</span></span></code></pre></td></tr></table>
</div>
</div><p>默认登录账号：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>admin/123456
</span></span></code></pre></td></tr></table>
</div>
</div><p>至此“调度中心”项目已经部署成功。</p>
<h2 id="配置部署执行器项目">配置部署“执行器项目”<a hidden class="anchor" aria-hidden="true" href="#配置部署执行器项目">#</a></h2>
<ul>
<li><code>“执行器”项目：xxl-job-executor-sample-springboot (提供多种版本执行器供选择，现以 springboot 版本为例，可直接使用，也可以参考其并将现有项目改造成执行器)</code></li>
<li><code>作用：负责接收“调度中心”的调度并执行；可直接部署执行器，也可以将执行器集成到现有业务项目中。</code></li>
</ul>
<p>第一步：项目引入依赖，看上边的maven或gradle。</p>
<p>第二部：修改配置文件：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>### 调度中心部署根地址 [选填]：如调度中心集群部署存在多个地址则用逗号分隔。执行器将会使用该地址进行&#34;执行器心跳注册&#34;和&#34;任务结果回调&#34;；为空则关闭自动注册；
</span></span><span style="display:flex;"><span>xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin
</span></span><span style="display:flex;"><span>### 调度中心通讯TOKEN [选填]：非空时启用；
</span></span><span style="display:flex;"><span>xxl.job.admin.accessToken=default_token
</span></span><span style="display:flex;"><span>### 调度中心通讯超时时间[选填]，单位秒；默认3s；
</span></span><span style="display:flex;"><span>xxl.job.admin.timeout=3
</span></span><span style="display:flex;"><span>### 执行器AppName [选填]：执行器心跳注册分组依据；为空则关闭自动注册
</span></span><span style="display:flex;"><span>xxl.job.executor.appname=xxl-job-executor-sample
</span></span><span style="display:flex;"><span>### 执行器注册 [选填]：优先使用该配置作为注册地址，为空时使用内嵌服务 ”IP:PORT“ 作为注册地址。从而更灵活的支持容器类型执行器动态IP和动态映射端口问题。
</span></span><span style="display:flex;"><span>xxl.job.executor.address=
</span></span><span style="display:flex;"><span>### 执行器IP [选填]：默认为空表示自动获取IP，多网卡时可手动设置指定IP，该IP不会绑定Host仅作为通讯使用；地址信息用于 &#34;执行器注册&#34; 和 &#34;调度中心请求并触发任务&#34;；
</span></span><span style="display:flex;"><span>xxl.job.executor.ip=
</span></span><span style="display:flex;"><span>### 执行器端口号 [选填]：小于等于0则自动获取；默认端口为9999，单机部署多个执行器时，注意要配置不同执行器端口；
</span></span><span style="display:flex;"><span>xxl.job.executor.port=9999
</span></span><span style="display:flex;"><span>### 执行器运行日志文件存储磁盘路径 [选填] ：需要对该路径拥有读写权限；为空则使用默认路径；
</span></span><span style="display:flex;"><span>xxl.job.executor.logpath=/data/applogs/xxl-job/jobhandler
</span></span><span style="display:flex;"><span>### 执行器日志文件保存天数 [选填] ： 过期日志自动清理, 限制值大于等于3时生效; 否则, 如-1, 关闭自动清理功能；
</span></span><span style="display:flex;"><span>xxl.job.executor.logretentiondays=30
</span></span><span style="display:flex;"><span>### 任务扫描排除路径 [选填] ：任务扫描时忽略指定包路径下的Bean；支持配置包路径前缀，多个逗号分隔；
</span></span><span style="display:flex;"><span>xxl.job.executor.excludedpackage=org.springframework,spring
</span></span></code></pre></td></tr></table>
</div>
</div><p>第三步：执行器组件配置</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.xxljob.config;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.xxl.job.core.executor.impl.XxlJobSpringExecutor;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.slf4j.Logger;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.slf4j.LoggerFactory;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Value;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Bean;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * xxl-job config * * @author xuxueli 2017-04-28  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>@Configuration  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> XxlJobConfig {  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Logger logger = LoggerFactory.<span style="color:#007f7f">getLogger</span>(XxlJobConfig.<span style="color:#007f7f">class</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${xxl.job.admin.addresses}&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String adminAddresses;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${xxl.job.admin.accessToken}&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String accessToken;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${xxl.job.admin.timeout}&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> timeout;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${xxl.job.executor.appname}&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String appname;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${xxl.job.executor.address}&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String address;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${xxl.job.executor.ip}&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String ip;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${xxl.job.executor.port}&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> port;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${xxl.job.executor.logpath}&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String logPath;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${xxl.job.executor.logretentiondays}&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> logRetentionDays;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Bean  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> XxlJobSpringExecutor xxlJobExecutor() {  
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job config init.&#34;</span>);  
</span></span><span style="display:flex;"><span>        XxlJobSpringExecutor xxlJobSpringExecutor = <span style="color:#fff;font-weight:bold">new</span> XxlJobSpringExecutor();  
</span></span><span style="display:flex;"><span>        xxlJobSpringExecutor.<span style="color:#007f7f">setAdminAddresses</span>(adminAddresses);  
</span></span><span style="display:flex;"><span>        xxlJobSpringExecutor.<span style="color:#007f7f">setAppname</span>(appname);  
</span></span><span style="display:flex;"><span>        xxlJobSpringExecutor.<span style="color:#007f7f">setAddress</span>(address);  
</span></span><span style="display:flex;"><span>        xxlJobSpringExecutor.<span style="color:#007f7f">setIp</span>(ip);  
</span></span><span style="display:flex;"><span>        xxlJobSpringExecutor.<span style="color:#007f7f">setPort</span>(port);  
</span></span><span style="display:flex;"><span>        xxlJobSpringExecutor.<span style="color:#007f7f">setAccessToken</span>(accessToken);  
</span></span><span style="display:flex;"><span>        xxlJobSpringExecutor.<span style="color:#007f7f">setTimeout</span>(timeout);  
</span></span><span style="display:flex;"><span>        xxlJobSpringExecutor.<span style="color:#007f7f">setLogPath</span>(logPath);  
</span></span><span style="display:flex;"><span>        xxlJobSpringExecutor.<span style="color:#007f7f">setLogRetentionDays</span>(logRetentionDays);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> xxlJobSpringExecutor;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 针对多网卡、容器内部署等情况，可借助 &#34;spring-cloud-commons&#34; 提供的 &#34;InetUtils&#34; 组件灵活定制注册IP；  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *      1、引入依赖：  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *          &lt;dependency&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *             &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *             &lt;artifactId&gt;spring-cloud-commons&lt;/artifactId&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *             &lt;version&gt;${version}&lt;/version&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *         &lt;/dependency&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *      2、配置文件，或者容器启动变量  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *          spring.cloud.inetutils.preferred-networks: &#39;xxx.xxx.xxx.&#39;  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *     *      3、获取IP  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *          String ip_ = inetUtils.findFirstNonLoopbackHostInfo().getIpAddress();     */</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>第四步：部署执行器项目</p>
<p>至此“执行器”项目已经部署结束。</p>
<h2 id="开发第一个任务hello-world">开发第一个任务“Hello World”<a hidden class="anchor" aria-hidden="true" href="#开发第一个任务hello-world">#</a></h2>
<p>本示例以新建一个 “GLUE模式(Java)” 运行模式的任务为例。更多有关任务的详细配置，请查看“章节三：任务详解”。<br>
（ “GLUE模式(Java)”的执行代码托管到调度中心在线维护，相比“Bean模式任务”需要在执行器项目开发部署上线，更加简便轻量）</p>
<p>前提：请确认“调度中心”和“执行器”项目已经成功部署并启动；</p>
<p>步骤一：新建任务：</p>
<p>登录调度中心，点击所示“新建任务”按钮，新建示例任务。</p>
<p>基础配置：随便写。<br>
调度配置：随便写。</p>
<p>任务配置：<br>
运行模式：GLUE(Java)</p>
<p>步骤二：“GLUE模式(Java)” 任务开发：</p>
<p>请点击任务右侧 “GLUE IDE” 按钮，进入 “GLUE编辑器开发界面” ，见下图。“GLUE模式(Java)” 运行模式的任务默认已经初始化了示例任务代码，即打印Hello World。<br>
（ “GLUE模式(Java)” 运行模式的任务实际上是一段继承自IJobHandler的Java类代码，它在执行器项目中运行，可使用Resource、Autowire注入执行器中的其他服务，详细介绍请查看第三章节）</p>
<p>步骤三：触发执行：<br>
请点击任务右侧 “执行” 按钮，可手动触发一次任务执行（通常情况下，通过配置Cron表达式进行任务调度触发）。</p>
<p>步骤四：查看日志：<br>
请点击任务右侧 “日志” 按钮，可前往任务日志界面查看任务日志。<br>
在任务日志界面中，可查看该任务的历史调度记录以及每一次调度的任务调度信息、执行参数和执行信息。运行中的任务点击右侧的“执行日志”按钮，可进入日志控制台查看实时执行日志。</p>
<p>问题：调度失败</p>
<p>日志：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>触发调度：  
</span></span><span style="display:flex;"><span>address：http://172.18.0.1:9999/  
</span></span><span style="display:flex;"><span>code：500  
</span></span><span style="display:flex;"><span>msg：xxl-job remoting error(Connect timed out), for url : http://172.18.0.1:9999/run
</span></span></code></pre></td></tr></table>
</div>
</div><p>到执行器管理查看机器地址：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>http://172.18.0.1:9999/
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改为<code>127.0.0.1:9999</code>，调度成功。</p>
<h1 id="三任务详解">三、任务详解<a hidden class="anchor" aria-hidden="true" href="#三任务详解">#</a></h1>
<p>配置属性详细说明：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>基础配置：
</span></span><span style="display:flex;"><span>    - 执行器：任务的绑定的执行器，任务触发调度时将会自动发现注册成功的执行器, 实现任务自动发现功能; 另一方面也可以方便的进行任务分组。每个任务必须绑定一个执行器, 可在 &#34;执行器管理&#34; 进行设置;
</span></span><span style="display:flex;"><span>    - 任务描述：任务的描述信息，便于任务管理；
</span></span><span style="display:flex;"><span>    - 负责人：任务的负责人；
</span></span><span style="display:flex;"><span>    - 报警邮件：任务调度失败时邮件通知的邮箱地址，支持配置多邮箱地址，配置多个邮箱地址时用逗号分隔；
</span></span><span style="display:flex;"><span>触发配置：
</span></span><span style="display:flex;"><span>    - 调度类型：
</span></span><span style="display:flex;"><span>        无：该类型不会主动触发调度；
</span></span><span style="display:flex;"><span>        CRON：该类型将会通过CRON，触发任务调度；
</span></span><span style="display:flex;"><span>        固定速度：该类型将会以固定速度，触发任务调度；按照固定的间隔时间，周期性触发；
</span></span><span style="display:flex;"><span>        固定延迟：该类型将会以固定延迟，触发任务调度；按照固定的延迟时间，从上次调度结束后开始计算延迟时间，到达延迟时间后触发下次调度；
</span></span><span style="display:flex;"><span>    - CRON：触发任务执行的Cron表达式；
</span></span><span style="display:flex;"><span>    - 固定速度：固定速度的时间间隔，单位为秒；
</span></span><span style="display:flex;"><span>    - 固定延迟：固定延迟的时间间隔，单位为秒；
</span></span><span style="display:flex;"><span>任务配置：
</span></span><span style="display:flex;"><span>    - 运行模式：
</span></span><span style="display:flex;"><span>        BEAN模式：任务以JobHandler方式维护在执行器端；需要结合 &#34;JobHandler&#34; 属性匹配执行器中任务；
</span></span><span style="display:flex;"><span>        GLUE模式(Java)：任务以源码方式维护在调度中心；该模式的任务实际上是一段继承自IJobHandler的Java类代码并以 &#34;groovy&#34; 源码方式维护，它在执行器项目中运行，可使用@Resource/@Autowire注入执行器中的其他服务；
</span></span><span style="display:flex;"><span>        GLUE模式(Shell)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 &#34;shell&#34; 脚本；
</span></span><span style="display:flex;"><span>        GLUE模式(Python)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 &#34;python&#34; 脚本；
</span></span><span style="display:flex;"><span>        GLUE模式(PHP)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 &#34;php&#34; 脚本；
</span></span><span style="display:flex;"><span>        GLUE模式(NodeJS)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 &#34;nodejs&#34; 脚本；
</span></span><span style="display:flex;"><span>        GLUE模式(PowerShell)：任务以源码方式维护在调度中心；该模式的任务实际上是一段 &#34;PowerShell&#34; 脚本；
</span></span><span style="display:flex;"><span>    - JobHandler：运行模式为 &#34;BEAN模式&#34; 时生效，对应执行器中新开发的JobHandler类“@XxlJob”注解自定义的value值；
</span></span><span style="display:flex;"><span>    - 执行参数：任务执行所需的参数；     
</span></span><span style="display:flex;"><span>高级配置：
</span></span><span style="display:flex;"><span>    - 路由策略：当执行器集群部署时，提供丰富的路由策略，包括；
</span></span><span style="display:flex;"><span>        FIRST（第一个）：固定选择第一个机器；
</span></span><span style="display:flex;"><span>        LAST（最后一个）：固定选择最后一个机器；
</span></span><span style="display:flex;"><span>        ROUND（轮询）：；
</span></span><span style="display:flex;"><span>        RANDOM（随机）：随机选择在线的机器；
</span></span><span style="display:flex;"><span>        CONSISTENT_HASH（一致性HASH）：每个任务按照Hash算法固定选择某一台机器，且所有任务均匀散列在不同机器上。
</span></span><span style="display:flex;"><span>        LEAST_FREQUENTLY_USED（最不经常使用）：使用频率最低的机器优先被选举；
</span></span><span style="display:flex;"><span>        LEAST_RECENTLY_USED（最近最久未使用）：最久未使用的机器优先被选举；
</span></span><span style="display:flex;"><span>        FAILOVER（故障转移）：按照顺序依次进行心跳检测，第一个心跳检测成功的机器选定为目标执行器并发起调度；
</span></span><span style="display:flex;"><span>        BUSYOVER（忙碌转移）：按照顺序依次进行空闲检测，第一个空闲检测成功的机器选定为目标执行器并发起调度；
</span></span><span style="display:flex;"><span>        SHARDING_BROADCAST(分片广播)：广播触发对应集群中所有机器执行一次任务，同时系统自动传递分片参数；可根据分片参数开发分片任务；
</span></span><span style="display:flex;"><span>    - 子任务：每个任务都拥有一个唯一的任务ID(任务ID可以从任务列表获取)，当本任务执行结束并且执行成功时，将会触发子任务ID所对应的任务的一次主动调度。
</span></span><span style="display:flex;"><span>    - 调度过期策略：
</span></span><span style="display:flex;"><span>        - 忽略：调度过期后，忽略过期的任务，从当前时间开始重新计算下次触发时间；
</span></span><span style="display:flex;"><span>        - 立即执行一次：调度过期后，立即执行一次，并从当前时间开始重新计算下次触发时间；
</span></span><span style="display:flex;"><span>    - 阻塞处理策略：调度过于密集执行器来不及处理时的处理策略；
</span></span><span style="display:flex;"><span>        单机串行（默认）：调度请求进入单机执行器后，调度请求进入FIFO队列并以串行方式运行；
</span></span><span style="display:flex;"><span>        丢弃后续调度：调度请求进入单机执行器后，发现执行器存在运行的调度任务，本次请求将会被丢弃并标记为失败；
</span></span><span style="display:flex;"><span>        覆盖之前调度：调度请求进入单机执行器后，发现执行器存在运行的调度任务，将会终止运行中的调度任务并清空队列，然后运行本地调度任务；
</span></span><span style="display:flex;"><span>    - 任务超时时间：支持自定义任务超时时间，任务运行超时将会主动中断任务；
</span></span><span style="display:flex;"><span>    - 失败重试次数；支持自定义任务失败重试次数，当任务失败时将会按照预设的失败重试次数主动进行重试；
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="31-bean模式类形式">3.1 BEAN模式（类形式）<a hidden class="anchor" aria-hidden="true" href="#31-bean模式类形式">#</a></h2>
<p>Bean模式任务，支持基于类的开发方式，每个任务对应一个Java类。</p>
<p>优点：不限制项目环境，兼容性好。即使是无框架项目，如main方法直接启动的项目也可以提供支持，可以参考示例项目 “xxl-job-executor-sample-frameless”；</p>
<p>缺点：</p>
<ul>
<li>每个任务需要占用一个Java类，造成类的浪费；</li>
<li>不支持自动扫描任务并注入到执行器容器，需要手动注入。</li>
</ul>
<p>步骤一：执行器项目中，开发Job类：<br>
1、开发一个继承自&quot;com.xxl.job.core.handler.IJobHandler&quot;的JobHandler类，实现其中任务方法。<br>
2、手动通过如下方式注入到执行器容器。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>XxlJobExecutor.registJobHandler(&#34;demoJobHandler&#34;, new DemoJobHandler());
</span></span></code></pre></td></tr></table>
</div>
</div><p>步骤二：调度中心，新建调度任务<br>
后续步骤和 “3.2 BEAN模式（方法形式）”一致，可以前往参考。</p>
<h2 id="32-bean模式方法形式">3.2 BEAN模式（方法形式）<a hidden class="anchor" aria-hidden="true" href="#32-bean模式方法形式">#</a></h2>
<p>Bean模式任务，支持基于方法的开发方式，每个任务对应一个方法。</p>
<p>优点：</p>
<ul>
<li>每个任务只需要开发一个方法，并添加”@XxlJob”注解即可，更加方便、快速。</li>
<li>支持自动扫描任务并注入到执行器容器。</li>
</ul>
<p>基于方法开发的任务，底层会生成JobHandler代理，和基于类的方式一样，任务也会以JobHandler的形式存在于执行器任务容器中。</p>
<p>步骤一：执行器项目中，开发Job方法：<br>
1、任务开发：在Spring Bean实例中，开发Job方法；<br>
2、注解配置：为Job方法添加注解 &ldquo;@XxlJob(value=&ldquo;自定义jobhandler名称&rdquo;, init = &ldquo;JobHandler初始化方法&rdquo;, destroy = &ldquo;JobHandler销毁方法&rdquo;)&quot;，注解value值对应的是调度中心新建任务的JobHandler属性的值。<br>
3、执行日志：需要通过 &ldquo;XxlJobHelper.log&rdquo; 打印执行日志；<br>
4、任务结果：默认任务结果为 &ldquo;成功&rdquo; 状态，不需要主动设置；如有诉求，比如设置任务结果为失败，可以通过 &ldquo;XxlJobHelper.handleFail/handleSuccess&rdquo; 自主设置任务结果；</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 可参考Sample示例执行器中的 &#34;com.xxl.job.executor.jobhandler.SampleXxlJob&#34; ，如下：</span>
</span></span><span style="display:flex;"><span>@XxlJob(<span style="color:#0ff;font-weight:bold">&#34;demoJobHandler&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> demoJobHandler() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;XXL-JOB, Hello World.&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>步骤二：调度中心，新建调度任务</p>
<p>参考上文“配置属性详细说明”对新建的任务进行参数配置，运行模式选中 “BEAN模式”，JobHandler属性填写任务注解“@XxlJob”中定义的值；</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">221
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * XxlJob开发示例（Bean模式）  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 开发步骤：  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *      1、任务开发：在Spring Bean实例中，开发Job方法；  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *      2、注解配置：为Job方法添加注解 &#34;@XxlJob(value=&#34;自定义jobhandler名称&#34;, init = &#34;JobHandler初始化方法&#34;, destroy = &#34;JobHandler销毁方法&#34;)&#34;，注解value值对应的是调度中心新建任务的JobHandler属性的值。  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *      3、执行日志：需要通过 &#34;XxlJobHelper.log&#34; 打印执行日志；  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *      4、任务结果：默认任务结果为 &#34;成功&#34; 状态，不需要主动设置；如有诉求，比如设置任务结果为失败，可以通过 &#34;XxlJobHelper.handleFail/handleSuccess&#34; 自主设置任务结果；  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @author xuxueli 2019-12-11 21:52:51  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>@Component  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SampleXxlJob {  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> Logger logger = LoggerFactory.<span style="color:#007f7f">getLogger</span>(SampleXxlJob.<span style="color:#007f7f">class</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 1、简单任务示例（Bean模式）  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    @XxlJob(<span style="color:#0ff;font-weight:bold">&#34;demoJobHandler&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> demoJobHandler() <span style="color:#fff;font-weight:bold">throws</span> Exception {  
</span></span><span style="display:flex;"><span>        XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;XXL-JOB, Hello World.&#34;</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 5; i++) {  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;beat at:&#34;</span> + i);  
</span></span><span style="display:flex;"><span>            TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(2);  
</span></span><span style="display:flex;"><span>        }        <span style="color:#007f7f">// default success  </span>
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 2、分片广播任务  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    @XxlJob(<span style="color:#0ff;font-weight:bold">&#34;shardingJobHandler&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> shardingJobHandler() <span style="color:#fff;font-weight:bold">throws</span> Exception {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 分片参数  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> shardIndex = XxlJobHelper.<span style="color:#007f7f">getShardIndex</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> shardTotal = XxlJobHelper.<span style="color:#007f7f">getShardTotal</span>();  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;分片参数：当前分片序号 = {}, 总分片数 = {}&#34;</span>, shardIndex, shardTotal);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 业务逻辑  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; shardTotal; i++) {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (i == shardIndex) {  
</span></span><span style="display:flex;"><span>                XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;第 {} 片, 命中分片开始处理&#34;</span>, i);  
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> {  
</span></span><span style="display:flex;"><span>                XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;第 {} 片, 忽略&#34;</span>, i);  
</span></span><span style="display:flex;"><span>            }        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 3、命令行任务  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  参数示例：&#34;ls -a&#34; 或者 &#34;pwd&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>    @XxlJob(<span style="color:#0ff;font-weight:bold">&#34;commandJobHandler&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> commandJobHandler() <span style="color:#fff;font-weight:bold">throws</span> Exception {  
</span></span><span style="display:flex;"><span>        String command = XxlJobHelper.<span style="color:#007f7f">getJobParam</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> exitValue = -1;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        BufferedReader bufferedReader = <span style="color:#fff;font-weight:bold">null</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// valid  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (command==<span style="color:#fff;font-weight:bold">null</span> || command.<span style="color:#007f7f">trim</span>().<span style="color:#007f7f">length</span>()==0) {  
</span></span><span style="display:flex;"><span>                XxlJobHelper.<span style="color:#007f7f">handleFail</span>(<span style="color:#0ff;font-weight:bold">&#34;command empty.&#34;</span>);  
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span>;  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// command split  </span>
</span></span><span style="display:flex;"><span>            String[] commandArray = command.<span style="color:#007f7f">split</span>(<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// command process  </span>
</span></span><span style="display:flex;"><span>            ProcessBuilder processBuilder = <span style="color:#fff;font-weight:bold">new</span> ProcessBuilder();  
</span></span><span style="display:flex;"><span>            processBuilder.<span style="color:#007f7f">command</span>(commandArray);            processBuilder.<span style="color:#007f7f">redirectErrorStream</span>(<span style="color:#fff;font-weight:bold">true</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            Process process = processBuilder.<span style="color:#007f7f">start</span>();            <span style="color:#007f7f">//Process process = Runtime.getRuntime().exec(command);  </span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            BufferedInputStream bufferedInputStream = <span style="color:#fff;font-weight:bold">new</span> BufferedInputStream(process.<span style="color:#007f7f">getInputStream</span>());  
</span></span><span style="display:flex;"><span>            bufferedReader = <span style="color:#fff;font-weight:bold">new</span> BufferedReader(<span style="color:#fff;font-weight:bold">new</span> InputStreamReader(bufferedInputStream));  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// command log  </span>
</span></span><span style="display:flex;"><span>            String line;  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">while</span> ((line = bufferedReader.<span style="color:#007f7f">readLine</span>()) != <span style="color:#fff;font-weight:bold">null</span>) {  
</span></span><span style="display:flex;"><span>                XxlJobHelper.<span style="color:#007f7f">log</span>(line);  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// command exit  </span>
</span></span><span style="display:flex;"><span>            process.<span style="color:#007f7f">waitFor</span>();  
</span></span><span style="display:flex;"><span>            exitValue = process.<span style="color:#007f7f">exitValue</span>();        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">log</span>(e);  
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (bufferedReader != <span style="color:#fff;font-weight:bold">null</span>) {  
</span></span><span style="display:flex;"><span>                bufferedReader.<span style="color:#007f7f">close</span>();            }        }  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (exitValue == 0) {  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// default success  </span>
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">handleFail</span>(<span style="color:#0ff;font-weight:bold">&#34;command exit value(&#34;</span>+exitValue+<span style="color:#0ff;font-weight:bold">&#34;) is failed&#34;</span>);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 4、跨平台Http任务  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  参数示例：  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  &lt;pre&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *      {  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *          &#34;url&#34;: &#34;http://www.baidu.com&#34;,     *          &#34;method&#34;: &#34;get&#34;,     *          &#34;data&#34;: &#34;hello world&#34;     *      }     *  &lt;/pre&gt;  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    @XxlJob(<span style="color:#0ff;font-weight:bold">&#34;httpJobHandler&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> httpJobHandler() <span style="color:#fff;font-weight:bold">throws</span> Exception {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// param  </span>
</span></span><span style="display:flex;"><span>        String param = XxlJobHelper.<span style="color:#007f7f">getJobParam</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (param==<span style="color:#fff;font-weight:bold">null</span> || param.<span style="color:#007f7f">trim</span>().<span style="color:#007f7f">length</span>()==0) {  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;param[&#34;</span>+ param +<span style="color:#0ff;font-weight:bold">&#34;] invalid.&#34;</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">handleFail</span>();  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// param parse  </span>
</span></span><span style="display:flex;"><span>        String url;  
</span></span><span style="display:flex;"><span>        String method;        String data;        <span style="color:#fff;font-weight:bold">try</span> {  
</span></span><span style="display:flex;"><span>            Map&lt;String, String&gt; paramMap =GsonTool.<span style="color:#007f7f">fromJson</span>(param, Map.<span style="color:#007f7f">class</span>);  
</span></span><span style="display:flex;"><span>            url = paramMap.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;url&#34;</span>);  
</span></span><span style="display:flex;"><span>            method = paramMap.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;method&#34;</span>);  
</span></span><span style="display:flex;"><span>            data = paramMap.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;data&#34;</span>);  
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">log</span>(e);  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">handleFail</span>();  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// param valid  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (url==<span style="color:#fff;font-weight:bold">null</span> || url.<span style="color:#007f7f">trim</span>().<span style="color:#007f7f">isEmpty</span>()) {  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;url[&#34;</span>+ url +<span style="color:#0ff;font-weight:bold">&#34;] invalid.&#34;</span>);  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">handleFail</span>();  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;  
</span></span><span style="display:flex;"><span>        }        <span style="color:#fff;font-weight:bold">if</span> (!isValidDomain( url)) {  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;url[&#34;</span>+ url +<span style="color:#0ff;font-weight:bold">&#34;] not allowed.&#34;</span>);  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">handleFail</span>();  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;  
</span></span><span style="display:flex;"><span>        }        <span style="color:#fff;font-weight:bold">if</span> (method==<span style="color:#fff;font-weight:bold">null</span> || !Arrays.<span style="color:#007f7f">asList</span>(<span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;POST&#34;</span>).<span style="color:#007f7f">contains</span>(method.<span style="color:#007f7f">toUpperCase</span>())) {  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;method[&#34;</span>+ method +<span style="color:#0ff;font-weight:bold">&#34;] invalid.&#34;</span>);  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">handleFail</span>();  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;  
</span></span><span style="display:flex;"><span>        }        method = method.<span style="color:#007f7f">toUpperCase</span>();        <span style="color:#fff;font-weight:bold">boolean</span> isPostMethod = method.<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;POST&#34;</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// request  </span>
</span></span><span style="display:flex;"><span>        HttpURLConnection connection = <span style="color:#fff;font-weight:bold">null</span>;  
</span></span><span style="display:flex;"><span>        BufferedReader bufferedReader = <span style="color:#fff;font-weight:bold">null</span>;  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// connection  </span>
</span></span><span style="display:flex;"><span>            URL realUrl = <span style="color:#fff;font-weight:bold">new</span> URL(url);  
</span></span><span style="display:flex;"><span>            connection = (HttpURLConnection) realUrl.<span style="color:#007f7f">openConnection</span>();  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// connection setting  </span>
</span></span><span style="display:flex;"><span>            connection.<span style="color:#007f7f">setRequestMethod</span>(method);  
</span></span><span style="display:flex;"><span>            connection.<span style="color:#007f7f">setDoOutput</span>(isPostMethod);            connection.<span style="color:#007f7f">setDoInput</span>(<span style="color:#fff;font-weight:bold">true</span>);  
</span></span><span style="display:flex;"><span>            connection.<span style="color:#007f7f">setUseCaches</span>(<span style="color:#fff;font-weight:bold">false</span>);  
</span></span><span style="display:flex;"><span>            connection.<span style="color:#007f7f">setReadTimeout</span>(5 * 1000);  
</span></span><span style="display:flex;"><span>            connection.<span style="color:#007f7f">setConnectTimeout</span>(3 * 1000);  
</span></span><span style="display:flex;"><span>            connection.<span style="color:#007f7f">setRequestProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;connection&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Keep-Alive&#34;</span>);  
</span></span><span style="display:flex;"><span>            connection.<span style="color:#007f7f">setRequestProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;Content-Type&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;application/json;charset=UTF-8&#34;</span>);  
</span></span><span style="display:flex;"><span>            connection.<span style="color:#007f7f">setRequestProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;Accept-Charset&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;application/json;charset=UTF-8&#34;</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// do connection  </span>
</span></span><span style="display:flex;"><span>            connection.<span style="color:#007f7f">connect</span>();  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// data  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (isPostMethod &amp;&amp; data!=<span style="color:#fff;font-weight:bold">null</span> &amp;&amp; !data.<span style="color:#007f7f">trim</span>().<span style="color:#007f7f">isEmpty</span>()) {  
</span></span><span style="display:flex;"><span>                DataOutputStream dataOutputStream = <span style="color:#fff;font-weight:bold">new</span> DataOutputStream(connection.<span style="color:#007f7f">getOutputStream</span>());  
</span></span><span style="display:flex;"><span>                dataOutputStream.<span style="color:#007f7f">write</span>(data.<span style="color:#007f7f">getBytes</span>(StandardCharsets.<span style="color:#007f7f">UTF_8</span>));  
</span></span><span style="display:flex;"><span>                dataOutputStream.<span style="color:#007f7f">flush</span>();                dataOutputStream.<span style="color:#007f7f">close</span>();            }  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// valid StatusCode  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> statusCode = connection.<span style="color:#007f7f">getResponseCode</span>();  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (statusCode != 200) {  
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;Http Request StatusCode(&#34;</span> + statusCode + <span style="color:#0ff;font-weight:bold">&#34;) Invalid.&#34;</span>);  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// result  </span>
</span></span><span style="display:flex;"><span>            bufferedReader = <span style="color:#fff;font-weight:bold">new</span> BufferedReader(<span style="color:#fff;font-weight:bold">new</span> InputStreamReader(connection.<span style="color:#007f7f">getInputStream</span>(), StandardCharsets.<span style="color:#007f7f">UTF_8</span>));  
</span></span><span style="display:flex;"><span>            StringBuilder result = <span style="color:#fff;font-weight:bold">new</span> StringBuilder();  
</span></span><span style="display:flex;"><span>            String line;            <span style="color:#fff;font-weight:bold">while</span> ((line = bufferedReader.<span style="color:#007f7f">readLine</span>()) != <span style="color:#fff;font-weight:bold">null</span>) {  
</span></span><span style="display:flex;"><span>                result.<span style="color:#007f7f">append</span>(line);            }            String responseMsg = result.<span style="color:#007f7f">toString</span>();  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">log</span>(responseMsg);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;  
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">log</span>(e);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>            XxlJobHelper.<span style="color:#007f7f">handleFail</span>();  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;  
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {  
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (bufferedReader != <span style="color:#fff;font-weight:bold">null</span>) {  
</span></span><span style="display:flex;"><span>                    bufferedReader.<span style="color:#007f7f">close</span>();                }                <span style="color:#fff;font-weight:bold">if</span> (connection != <span style="color:#fff;font-weight:bold">null</span>) {  
</span></span><span style="display:flex;"><span>                    connection.<span style="color:#007f7f">disconnect</span>();                }            } <span style="color:#fff;font-weight:bold">catch</span> (Exception e2) {  
</span></span><span style="display:flex;"><span>                XxlJobHelper.<span style="color:#007f7f">log</span>(e2);  
</span></span><span style="display:flex;"><span>            }        }  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// domain white-list, for httpJobHandler  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> Set&lt;String&gt; DOMAIN_WHITE_LIST = <span style="color:#fff;font-weight:bold">new</span> HashSet&lt;String&gt;(Arrays.<span style="color:#007f7f">asList</span>(  
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;http://www.baidu.com&#34;</span>,  
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;http://cn.bing.com&#34;</span>  
</span></span><span style="display:flex;"><span>    ));  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// valid if domain is in white-list  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">boolean</span> isValidDomain(String url) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (url == <span style="color:#fff;font-weight:bold">null</span> || DOMAIN_WHITE_LIST.<span style="color:#007f7f">isEmpty</span>()) {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;  
</span></span><span style="display:flex;"><span>        }        <span style="color:#fff;font-weight:bold">for</span> (String prefix : DOMAIN_WHITE_LIST) {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (url.<span style="color:#007f7f">startsWith</span>(prefix)) {  
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>            }        }        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 5、生命周期任务示例：任务初始化与销毁时，支持自定义相关逻辑；  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    @XxlJob(value = <span style="color:#0ff;font-weight:bold">&#34;demoJobHandler2&#34;</span>, init = <span style="color:#0ff;font-weight:bold">&#34;init&#34;</span>, destroy = <span style="color:#0ff;font-weight:bold">&#34;destroy&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> demoJobHandler2() <span style="color:#fff;font-weight:bold">throws</span> Exception {  
</span></span><span style="display:flex;"><span>        XxlJobHelper.<span style="color:#007f7f">log</span>(<span style="color:#0ff;font-weight:bold">&#34;XXL-JOB, Hello World.&#34;</span>);  
</span></span><span style="display:flex;"><span>    }    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> init(){  
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;init&#34;</span>);  
</span></span><span style="display:flex;"><span>    }    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> destroy(){  
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;destroy&#34;</span>);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>原生内置Bean模式任务（通用执行器）</p>
<p>为方便用户参考与快速使用，提供 “通用执行器” 并内置多个Bean模式任务Handler，可以直接配置使用，如下：</p>
<p><strong>通用执行器说明：</strong></p>
<ul>
<li>AppName：xxl-job-executor-sample</li>
<li>执行器代码：
<ul>
<li>xxl-job-executor-sample-springboot：springboot版本</li>
<li>xxl-job-executor-sample-frameless：无框架版本</li>
</ul>
</li>
</ul>
<p><strong>执行器内置任务列表：</strong></p>
<ul>
<li>a、demoJobHandler：简单示例任务，任务内部模拟耗时任务逻辑，用户可在线体验Rolling Log等功能；</li>
<li>b、shardingJobHandler：分片示例任务，任务内部模拟处理分片参数，可参考熟悉分片任务；</li>
<li>c、httpJobHandler：通用HTTP任务Handler；业务方只需要提供HTTP链接等信息即可，不限制语言、平台。任务入参示例如下：</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// 1、简单示例：
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;url&#34;: &#34;http://www.baidu.com&#34;,
</span></span><span style="display:flex;"><span>    &#34;method&#34;: &#34;GET&#34;,
</span></span><span style="display:flex;"><span>    &#34;data&#34;: &#34;hello world&#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>// 2、完整参数示例：
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;url&#34;: &#34;http://www.baidu.com&#34;,              // 请求URL
</span></span><span style="display:flex;"><span>    &#34;method&#34;: &#34;POST&#34;,                           // 请求方法，支持：GET、POST、HEAD、OPTIONS、PUT、DELETE、TRACE
</span></span><span style="display:flex;"><span>    &#34;contentType&#34;: &#34;application/json&#34;,          // 请求内容类型，支持：application/json、application/x-www-form-urlencoded、application/xml、text/html、text/xml、text/plain
</span></span><span style="display:flex;"><span>    &#34;headers&#34;: {                                // 请求Header，key-value结构
</span></span><span style="display:flex;"><span>        &#34;header01&#34;: &#34;value01&#34;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;cookies&#34;: {                                // 请求Cookie，key-value结构
</span></span><span style="display:flex;"><span>        &#34;cookie01&#34;: &#34;value01&#34;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;timeout&#34;: 3000,                            // 请求超时时间，默认 3000；单位：毫秒；
</span></span><span style="display:flex;"><span>    &#34;data&#34;: &#34;request body data&#34;,                // 请求Body数据，仅针对 POST 请求有效
</span></span><span style="display:flex;"><span>    &#34;form&#34;: {                                   // 请求Form数据，仅针对 GET 请求有效
</span></span><span style="display:flex;"><span>        &#34;key01&#34;: &#34;value01&#34;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;auth&#34;: &#34;auth data&#34;                         // 请求认证信息, 通过Basic Auth方式认证
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>d、commandJobHandler：通用命令行任务Handler；业务方只需要提供命令行即可，命令及参数之间通过空格隔开；如任务参数 “ls la” 或 “pwd” 将会执行命令并输出数据；</li>
</ul>
<h2 id="33-glue模式java">3.3 GLUE模式(Java)<a hidden class="anchor" aria-hidden="true" href="#33-glue模式java">#</a></h2>
<p>任务以源码方式维护在调度中心，支持通过Web IDE在线更新，实时编译和生效，因此不需要指定JobHandler。开发流程如下：</p>
<p>步骤一：调度中心，新建调度任务：</p>
<p>参考上文“配置属性详细说明”对新建的任务进行参数配置，运行模式选中 “GLUE模式(Java)”；</p>
<p>步骤二：开发任务代码：</p>
<p>选中指定任务，点击该任务右侧“GLUE”按钮，将会前往GLUE任务的Web IDE界面，在该界面支持对任务代码进行开发（也可以在IDE中开发完成后，复制粘贴到编辑器中）。</p>
<p>版本回溯功能（支持30个版本的版本回溯）：在GLUE任务的Web IDE界面，选择右上角下拉框“版本回溯”，会列出该GLUE的更新历史，选择相应版本即可显示该版本代码，保存后GLUE代码即回退到对应的历史版本；</p>
<h2 id="34-glue模式shellpythonnodejsphppowershell">3.4 GLUE模式(Shell)、Python、NodeJS、PHP、PowerShell<a hidden class="anchor" aria-hidden="true" href="#34-glue模式shellpythonnodejsphppowershell">#</a></h2>
<h1 id="四操作指南">四、操作指南<a hidden class="anchor" aria-hidden="true" href="#四操作指南">#</a></h1>
<h2 id="41-配置执行器">4.1 配置执行器<a hidden class="anchor" aria-hidden="true" href="#41-配置执行器">#</a></h2>
<p>点击进入”执行器管理”界面，点击按钮 “+新增执行器” 弹框, 可新增执行器配置：</p>
<p>执行器属性说明</p>
<ol>
<li><code>AppName: 是每个执行器集群的唯一标示AppName, 执行器会周期性以AppName为对象进行自动注册。可通过该配置自动发现注册成功的执行器, 供任务调度时使用;</code></li>
<li><code>名称: 执行器的名称, 因为AppName限制字母数字等组成,可读性不强, 名称为了提高执行器的可读性;</code></li>
<li><code>排序: 执行器的排序, 系统中需要执行器的地方,如任务新增, 将会按照该排序读取可用的执行器列表;</code></li>
<li><code>注册方式：调度中心获取执行器地址的方式；</code></li>
<li>
<pre><code>`自动注册：执行器自动进行执行器注册，调度中心通过底层注册表可以动态发现执行器机器地址；`
</code></pre>
</li>
<li>
<pre><code>`手动录入：人工手动录入执行器的地址信息，多地址逗号分隔，供调度中心使用；`
</code></pre>
</li>
<li><code>机器地址：&quot;注册方式&quot;为&quot;手动录入&quot;时有效，支持人工维护执行器的地址信息；注册地址格式可参考“http://127.0.0.1:9999/”，为执行器内嵌服务地址；</code></li>
</ol>
<h2 id="42-新建任务">4.2 新建任务<a hidden class="anchor" aria-hidden="true" href="#42-新建任务">#</a></h2>
<p>进入任务管理界面，点击“新增任务”按钮，在弹出的“新增任务”界面配置任务属性后保存即可。详情页参考章节 “三、任务详解”。</p>
<h2 id="43-编辑任务">4.3 编辑任务<a hidden class="anchor" aria-hidden="true" href="#43-编辑任务">#</a></h2>
<p>进入任务管理界面，选中指定任务。点击该任务右侧“编辑”按钮，在弹出的“编辑任务”界面更新任务属性后保存即可，可以修改设置的任务属性信息：</p>
<h2 id="44-编辑glue代码">4.4 编辑GLUE代码<a hidden class="anchor" aria-hidden="true" href="#44-编辑glue代码">#</a></h2>
<p>该操作仅针对GLUE任务。</p>
<p>选中指定任务，点击该任务右侧“GLUE”按钮，将会前往GLUE任务的Web IDE界面，在该界面支持对任务代码进行开发。可参考章节 “3.3 GLUE模式(Java)”。</p>
<h2 id="45-启动停止任务">4.5 启动/停止任务<a hidden class="anchor" aria-hidden="true" href="#45-启动停止任务">#</a></h2>
<p>可对任务进行“启动”和“停止”操作。<br>
需要注意的是，此处的启动/停止仅针对任务的后续调度触发行为，不会影响到已经触发的调度任务，如需终止已经触发的调度任务，可查看“4.9 终止运行中的任务”</p>
<h2 id="46-手动触发一次调度">4.6 手动触发一次调度<a hidden class="anchor" aria-hidden="true" href="#46-手动触发一次调度">#</a></h2>
<p>点击“执行一次”按钮，可手动触发一次任务调度，不影响原有调度规则。</p>
<h2 id="47-查看调度日志">4.7 查看调度日志<a hidden class="anchor" aria-hidden="true" href="#47-查看调度日志">#</a></h2>
<p>点击“日志”按钮，可以查看任务历史调度日志。在历史调度日志界面可查看每次任务调度的调度结果、执行结果等，点击“执行日志”按钮可查看执行器完整日志。</p>
<h2 id="48-查看执行日志">4.8 查看执行日志<a hidden class="anchor" aria-hidden="true" href="#48-查看执行日志">#</a></h2>
<p>点击执行日志右侧的 “执行日志” 按钮，可跳转至执行日志界面，可以查看业务代码中打印的完整日志。</p>
<h2 id="49-终止运行中的任务">4.9 终止运行中的任务<a hidden class="anchor" aria-hidden="true" href="#49-终止运行中的任务">#</a></h2>
<p>仅针对执行中的任务。<br>
在任务日志界面，点击右侧的“终止任务”按钮，将会向本次任务对应的执行器发送任务终止请求，将会终止掉本次任务，同时会清空掉整个任务执行队列。</p>
<p>任务终止时通过 “interrupt” 执行线程的方式实现, 将会触发 “InterruptedException” 异常。因此如果JobHandler内部catch到了该异常并消化掉的话, 任务终止功能将不可用。</p>
<p>因此, 如果遇到上述任务终止不可用的情况, 需要在JobHandler中应该针对 “InterruptedException” 异常进行特殊处理 (向上抛出) , 正确逻辑如下:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// do something</span>
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (e <span style="color:#fff;font-weight:bold">instanceof</span> InterruptedException) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> e;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    logger.<span style="color:#007f7f">warn</span>(<span style="color:#0ff;font-weight:bold">&#34;{}&#34;</span>, e);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>而且，在JobHandler中开启子线程时，子线程也不可catch处理”InterruptedException”，应该主动向上抛出。</p>
<p>任务终止时会执行对应JobHandler的”destroy()”方法，可以借助该方法处理一些资源回收的逻辑。</p>
<h2 id="410-删除执行日志">4.10 删除执行日志<a hidden class="anchor" aria-hidden="true" href="#410-删除执行日志">#</a></h2>
<p>在任务日志界面，选中执行器和任务之后，点击右侧的”删除”按钮将会出现”日志清理”弹框，弹框中支持选择不同类型的日志清理策略，选中后点击”确定”按钮即可进行日志清理操作；</p>
<h2 id="411-删除任务">4.11 删除任务<a hidden class="anchor" aria-hidden="true" href="#411-删除任务">#</a></h2>
<p>点击删除按钮，可以删除对应任务。</p>
<h2 id="412-用户管理">4.12 用户管理<a hidden class="anchor" aria-hidden="true" href="#412-用户管理">#</a></h2>
<p>进入 “用户管理” 界面，可查看和管理用户信息；</p>
<p>目前用户分为两种角色：</p>
<ul>
<li>管理员：拥有全量权限，支持在线管理用户信息，为用户分配权限，权限分配粒度为执行器；</li>
<li>普通用户：仅拥有被分配权限的执行器，及相关任务的操作权限；</li>
</ul>
<h1 id="五总体设计">五、总体设计<a hidden class="anchor" aria-hidden="true" href="#五总体设计">#</a></h1>
<h2 id="51-源码目录介绍">5.1 源码目录介绍<a hidden class="anchor" aria-hidden="true" href="#51-源码目录介绍">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/doc :文档资料
</span></span><span style="display:flex;"><span>/db :“调度数据库”建表脚本
</span></span><span style="display:flex;"><span>/xxl-job-admin :调度中心，项目源码
</span></span><span style="display:flex;"><span>/xxl-job-core :公共Jar依赖
</span></span><span style="display:flex;"><span>/xxl-job-executor-samples :执行器，Sample示例项目（大家可以在该项目上进行开发，也可以将现有项目改造生成执行器项目）
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="52-调度数据库配置">5.2 “调度数据库”配置<a hidden class="anchor" aria-hidden="true" href="#52-调度数据库配置">#</a></h2>
<p>XXL-JOB调度模块基于自研调度组件并支持集群部署，调度数据库表说明如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>xl_job_lock：任务调度锁表；
</span></span><span style="display:flex;"><span>xxl_job_group：执行器信息表，维护任务执行器信息；
</span></span><span style="display:flex;"><span>xxl_job_info：调度扩展信息表： 用于保存XXL-JOB调度任务的扩展信息，如任务分组、任务名、机器地址、执行器、执行入参和报警邮件等等；
</span></span><span style="display:flex;"><span>xxl_job_log：调度日志表： 用于保存XXL-JOB任务调度的历史信息，如调度结果、执行结果、调度入参、调度机器和执行器等等；
</span></span><span style="display:flex;"><span>xxl_job_log_report：调度日志报表：用户存储XXL-JOB任务调度日志的报表，调度中心报表功能页面会用到；
</span></span><span style="display:flex;"><span>xxl_job_logglue：任务GLUE日志：用于保存GLUE更新历史，用于支持GLUE的版本回溯功能；
</span></span><span style="display:flex;"><span>xxl_job_registry：执行器注册表，维护在线的执行器和调度中心机器地址信息；
</span></span><span style="display:flex;"><span>xxl_job_user：系统用户表；
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="53-架构设计">5.3 架构设计<a hidden class="anchor" aria-hidden="true" href="#53-架构设计">#</a></h2>
<h3 id="531-设计思想">5.3.1 设计思想<a hidden class="anchor" aria-hidden="true" href="#531-设计思想">#</a></h3>
<p>将调度行为抽象形成“调度中心”公共平台，而平台自身并不承担业务逻辑，“调度中心”负责发起调度请求。</p>
<p>将任务抽象成分散的JobHandler，交由“执行器”统一管理，“执行器”负责接收调度请求并执行对应的JobHandler中的业务逻辑。</p>
<p>因此，“调度”和“任务”两部分可以相互解耦，提高系统整体稳定性和扩展性；</p>
<h3 id="532-系统组成">5.3.2 系统组成<a hidden class="anchor" aria-hidden="true" href="#532-系统组成">#</a></h3>
<ul>
<li><strong>调度模块（调度中心）</strong>：<br>
负责管理调度信息，按照调度配置发出调度请求，自身不承担业务代码。调度系统与任务解耦，提高了系统可用性和稳定性，同时调度系统性能不再受限于任务模块；<br>
支持可视化、简单且动态的管理调度信息，包括任务新建，更新，删除，GLUE开发和任务报警等，所有上述操作都会实时生效，同时支持监控调度结果以及执行日志，支持执行器Failover。</li>
<li><strong>执行模块（执行器）</strong>：<br>
负责接收调度请求并执行任务逻辑。任务模块专注于任务的执行等操作，开发和维护更加简单和高效；<br>
接收“调度中心”的执行请求、终止请求和日志请求等。</li>
</ul>
<h3 id="533-架构图">5.3.3 架构图<a hidden class="anchor" aria-hidden="true" href="#533-架构图">#</a></h3>
<p><img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/xxl-job/xxljob%E6%9E%B6%E6%9E%84%E5%9B%BE.png"></p>
<h2 id="54-调度模块剖析">5.4 调度模块剖析<a hidden class="anchor" aria-hidden="true" href="#54-调度模块剖析">#</a></h2>
<h3 id="541-quartz的不足">5.4.1 quartz的不足<a hidden class="anchor" aria-hidden="true" href="#541-quartz的不足">#</a></h3>
<p>Quartz作为开源作业调度中的佼佼者，是作业调度的首选。但是集群环境中Quartz采用API的方式对任务进行管理，从而可以避免上述问题，但是同样存在以下问题：</p>
<ul>
<li>问题一：调用API的方式操作任务，不人性化；</li>
<li>问题二：需要持久化业务QuartzJobBean到底层数据表中，系统侵入性相当严重。</li>
<li>问题三：调度逻辑和QuartzJobBean耦合在同一个项目中，这将导致一个问题，在调度任务数量逐渐增多，同时调度任务逻辑逐渐加重的情况下，此时调度系统的性能将大大受限于业务；</li>
<li>问题四：quartz底层以“抢占式”获取DB锁并由抢占成功节点负责运行任务，会导致节点负载悬殊非常大；而XXL-JOB通过执行器实现“协同分配式”运行任务，充分发挥集群优势，负载各节点均衡。</li>
</ul>
<p>XXL-JOB弥补了quartz的上述不足之处。</p>
<h3 id="542-自研调度模块">5.4.2 自研调度模块<a hidden class="anchor" aria-hidden="true" href="#542-自研调度模块">#</a></h3>
<p>XXL-JOB最终选择自研调度组件（早期调度组件基于Quartz）；一方面是为了精简系统降低冗余依赖，另一方面是为了提供系统的可控度与稳定性；</p>
<p>XXL-JOB中“调度模块”和“任务模块”完全解耦，调度模块进行任务调度时，将会解析不同的任务参数发起远程调用，调用各自的远程执行器服务。这种调用模型类似RPC调用，调度中心提供调用代理的功能，而执行器提供远程服务的功能。</p>
<h3 id="543-调度中心ha集群">5.4.3 调度中心HA（集群）<a hidden class="anchor" aria-hidden="true" href="#543-调度中心ha集群">#</a></h3>
<p>基于数据库的集群方案，数据库选用Mysql；集群分布式并发环境中进行定时任务调度时，会在各个节点上报任务，存到数据库中，执行时会从数据库中取出触发器来执行，如果触发器的名称和执行时间相同，则只有一个节点去执行此任务。</p>
<h3 id="544-调度线程池">5.4.4 调度线程池<a hidden class="anchor" aria-hidden="true" href="#544-调度线程池">#</a></h3>
<p>调度采用线程池方式实现，避免单线程因阻塞而引起任务调度延迟。</p>
<h3 id="545-并行调度">5.4.5 并行调度<a hidden class="anchor" aria-hidden="true" href="#545-并行调度">#</a></h3>
<p>XXL-JOB调度模块默认采用并行机制，在多线程调度的情况下，调度模块被阻塞的几率很低，大大提高了调度系统的承载量。</p>
<p>XXL-JOB的不同任务之间并行调度、并行执行。<br>
XXL-JOB的单个任务，针对多个执行器是并行运行的，针对单个执行器是串行执行的。同时支持任务终止。</p>
<h3 id="546-过期处理策略">5.4.6 过期处理策略<a hidden class="anchor" aria-hidden="true" href="#546-过期处理策略">#</a></h3>
<p>任务调度错过触发时间时的处理策略：</p>
<ul>
<li>可能原因：服务重启；调度线程被阻塞，线程被耗尽；上次调度持续阻塞，下次调度被错过；</li>
<li>处理策略：
<ul>
<li>过期超5s：本次忽略，当前时间开始计算下次触发时间</li>
<li>过期5s内：立即触发一次，当前时间开始计算下次触发时间</li>
</ul>
</li>
</ul>
<h3 id="547-日志回调服务">5.4.7 日志回调服务<a hidden class="anchor" aria-hidden="true" href="#547-日志回调服务">#</a></h3>
<p>调度模块的“调度中心”作为Web服务部署时，一方面承担调度中心功能，另一方面也为执行器提供API服务。</p>
<p>调度中心提供的”日志回调服务API服务”代码位置如下：</p>
<ol>
<li><code>xxl-job-admin#com.xxl.job.admin.controller.JobApiController.callback</code></li>
</ol>
<p>“执行器”在接收到任务执行请求后，执行任务，在执行结束之后会将执行结果回调通知“调度中心”：</p>
<h3 id="548-任务hafailover">5.4.8 任务HA（Failover）<a hidden class="anchor" aria-hidden="true" href="#548-任务hafailover">#</a></h3>
<p>执行器如若集群部署，调度中心将会感知到在线的所有执行器，如“127.0.0.1:9997, 127.0.0.1:9998, 127.0.0.1:9999”。</p>
<p>当任务”路由策略”选择”故障转移(FAILOVER)”时，当调度中心每次发起调度请求时，会按照顺序对执行器发出心跳检测请求，第一个检测为存活状态的执行器将会被选定并发送调度请求。</p>
<p>调度成功后，可在日志监控界面查看“调度备注”，如下；<br>
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/xxl-job/%E8%B0%83%E5%BA%A6%E5%A4%87%E6%B3%A8.png"></p>
<p>“调度备注”可以看出本地调度运行轨迹，执行器的”注册方式”、”地址列表”和任务的”路由策略”。”故障转移(FAILOVER)”路由策略下，调度中心首先对第一个地址进行心跳检测，心跳失败因此自动跳过，第二个依然心跳检测失败……<br>
直至心跳检测第三个地址“127.0.0.1:9999”成功，选定为“目标执行器”；然后对“目标执行器”发送调度请求，调度流程结束，等待执行器回调执行结果。</p>
<h3 id="549-调度日志">5.4.9 调度日志<a hidden class="anchor" aria-hidden="true" href="#549-调度日志">#</a></h3>
<p>调度中心每次进行任务调度，都会记录一条任务日志，任务日志主要包括以下三部分内容：</p>
<ul>
<li>任务信息：包括“执行器地址”、“JobHandler”和“执行参数”等属性，点击任务ID按钮可查看，根据这些参数，可以精确的定位任务执行的具体机器和任务代码；</li>
<li>调度信息：包括“调度时间”、“调度结果”和“调度日志”等，根据这些参数，可以了解“调度中心”发起调度请求时的具体情况。</li>
<li>执行信息：包括“执行时间”、“执行结果”和“执行日志”等，根据这些参数，可以了解在“执行器”端任务执行的具体情况；</li>
</ul>
<p>调度日志，针对单次调度，属性说明如下：</p>
<ul>
<li>执行器地址：任务执行的机器地址；</li>
<li>JobHandler：Bean模式表示任务执行的JobHandler名称；</li>
<li>任务参数：任务执行的入参；</li>
<li>调度时间：调度中心，发起调度的时间；</li>
<li>调度结果：调度中心，发起调度的结果，SUCCESS或FAIL；</li>
<li>调度备注：调度中心，发起调度的备注信息，如地址心跳检测日志等；</li>
<li>执行时间：执行器，任务执行结束后回调的时间；</li>
<li>执行结果：执行器，任务执行的结果，SUCCESS或FAIL；</li>
<li>执行备注：执行器，任务执行的备注信息，如异常日志等；</li>
<li>执行日志：任务执行过程中，业务代码中打印的完整执行日志，见“4.8 查看执行日志”；</li>
</ul>
<h3 id="5410-任务依赖">5.4.10 任务依赖<a hidden class="anchor" aria-hidden="true" href="#5410-任务依赖">#</a></h3>
<p>原理：XXL-JOB中每个任务都对应有一个任务ID，同时，每个任务支持设置属性“子任务ID”，因此，通过“任务ID”可以匹配任务依赖关系。</p>
<p>当父任务执行结束并且执行成功时，将会根据“子任务ID”匹配子任务依赖，如果匹配到子任务，将会主动触发一次子任务的执行。</p>
<p>在任务日志界面，点击任务的“执行备注”的“查看”按钮，可以看到匹配子任务以及触发子任务执行的日志信息，如无信息则表示未触发子任务执行，可参考下图。</p>
<p><img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/xxl-job/img_Wb2o.png"></p>
<p><img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/xxl-job/img_jOAU.png"></p>
<h3 id="5411-全异步化--轻量级">5.4.11 全异步化 &amp; 轻量级<a hidden class="anchor" aria-hidden="true" href="#5411-全异步化--轻量级">#</a></h3>
<ul>
<li>全异步化设计：XXL-JOB系统中业务逻辑在远程执行器执行，触发流程全异步化设计。相比直接在调度中心内部执行业务逻辑，极大的降低了调度线程占用时间；
<ul>
<li>异步调度：调度中心每次任务触发时仅发送一次调度请求，该调度请求首先推送“异步调度队列”，然后异步推送给远程执行器</li>
<li>异步执行：执行器会将请求存入“异步执行队列”并且立即响应调度中心，异步运行。</li>
</ul>
</li>
<li>轻量级设计：XXL-JOB调度中心中每个JOB逻辑非常 “轻”，在全异步化的基础上，单个JOB一次运行平均耗时基本在 “10ms” 之内（基本为一次请求的网络开销）；因此，可以保证使用有限的线程支撑大量的JOB并发运行；</li>
</ul>
<p>得益于上述两点优化，理论上默认配置下的调度中心，单机能够支撑 5000 任务并发运行稳定运行；</p>
<p>实际场景中，由于调度中心与执行器网络ping延迟不同、DB读写耗时不同、任务调度密集程度不同，会导致任务量上限上下波动。</p>
<p>如若需要支撑更多的任务量，可以通过 “调大调度线程数” 、”降低调度中心与执行器ping延迟” 和 “提升机器配置” 几种方式优化。</p>
<h3 id="5412-均衡调度">5.4.12 均衡调度<a hidden class="anchor" aria-hidden="true" href="#5412-均衡调度">#</a></h3>
<p>调度中心在集群部署时会自动进行任务平均分配，触发组件每次获取与线程池数量（调度中心支持自定义调度线程池大小）相关数量的任务，避免大量任务集中在单个调度中心集群节点；</p>
<h2 id="55-任务-运行模式-剖析">5.5 任务 “运行模式” 剖析<a hidden class="anchor" aria-hidden="true" href="#55-任务-运行模式-剖析">#</a></h2>
<h3 id="551-bean模式-任务">5.5.1 “Bean模式” 任务<a hidden class="anchor" aria-hidden="true" href="#551-bean模式-任务">#</a></h3>
<p>开发步骤：可参考 “章节三” ；<br>
原理：每个Bean模式任务都是一个Spring的Bean类实例，它被维护在“执行器”项目的Spring容器中。任务类需要加“<a href="https://github.com/JobHandler" title="@JobHandler">@JobHandler</a>(value=”名称”)”注解，因为“执行器”会根据该注解识别Spring容器中的任务。任务类需要继承统一接口“IJobHandler”，任务逻辑在execute方法中开发，因为“执行器”在接收到调度中心的调度请求时，将会调用“IJobHandler”的execute方法，执行任务逻辑。</p>
<h3 id="552-glue模式java-任务">5.5.2 “GLUE模式(Java)” 任务<a hidden class="anchor" aria-hidden="true" href="#552-glue模式java-任务">#</a></h3>
<p>开发步骤：可参考 “章节三” ；<br>
原理：每个 “GLUE模式(Java)” 任务的代码，实际上是“一个继承自“IJobHandler”的实现类的类代码”，“执行器”接收到“调度中心”的调度请求时，会通过Groovy类加载器加载此代码，实例化成Java对象，同时注入此代码中声明的Spring服务（请确保Glue代码中的服务和类引用在“执行器”项目中存在），然后调用该对象的execute方法，执行任务逻辑。</p>
<h3 id="553-glue模式shell--glue模式python--glue模式php--glue模式nodejs--glue模式powershell">5.5.3 GLUE模式(Shell) + GLUE模式(Python) + GLUE模式(PHP) + GLUE模式(NodeJS) + GLUE模式(Powershell)<a hidden class="anchor" aria-hidden="true" href="#553-glue模式shell--glue模式python--glue模式php--glue模式nodejs--glue模式powershell">#</a></h3>
<p>开发步骤：可参考 “章节三” ；<br>
原理：脚本任务的源码托管在调度中心，脚本逻辑在执行器运行。当触发脚本任务时，执行器会加载脚本源码在执行器机器上生成一份脚本文件，然后通过Java代码调用该脚本；并且实时将脚本输出日志写到任务日志文件中，从而在调度中心可以实时监控脚本运行情况；</p>
<p>目前支持的脚本类型如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>- shell脚本：任务运行模式选择为 &#34;GLUE模式(Shell)&#34;时支持 &#34;Shell&#34; 脚本任务；
</span></span><span style="display:flex;"><span>- python脚本：任务运行模式选择为 &#34;GLUE模式(Python)&#34;时支持 &#34;Python&#34; 脚本任务；
</span></span><span style="display:flex;"><span>- php脚本：任务运行模式选择为 &#34;GLUE模式(PHP)&#34;时支持 &#34;PHP&#34; 脚本任务；
</span></span><span style="display:flex;"><span>- nodejs脚本：任务运行模式选择为 &#34;GLUE模式(NodeJS)&#34;时支持 &#34;NodeJS&#34; 脚本任务；
</span></span><span style="display:flex;"><span>- powershell：任务运行模式选择为 &#34;GLUE模式(PowerShell)&#34;时支持 &#34;PowerShell&#34; 脚本任务；
</span></span></code></pre></td></tr></table>
</div>
</div><p>脚本任务通过 Exit Code 判断任务执行结果，状态码可参考章节 “5.15 任务执行结果说明”；</p>
<h3 id="554-执行器">5.5.4 执行器<a hidden class="anchor" aria-hidden="true" href="#554-执行器">#</a></h3>
<p>执行器实际上是一个内嵌的Server，默认端口9999（配置项：xxl.job.executor.port）。</p>
<p>在项目启动时，执行器会通过“<a href="https://github.com/XxlJob" title="@XxlJob">@XxlJob</a>”识别Spring容器中“Bean模式任务”，以注解的value属性为key管理起来。</p>
<p>“执行器”接收到“调度中心”的调度请求时，如果任务类型为“Bean模式”，将会匹配Spring容器中的“Bean模式任务”，然后调用其execute方法，执行任务逻辑。如果任务类型为“GLUE模式”，将会加载GLue代码，实例化Java对象，注入依赖的Spring服务（注意：Glue代码中注入的Spring服务，必须存在与该“执行器”项目的Spring容器中），然后调用execute方法，执行任务逻辑。</p>
<h3 id="555-任务日志">5.5.5 任务日志<a hidden class="anchor" aria-hidden="true" href="#555-任务日志">#</a></h3>
<p>XXL-JOB会为每次调度请求生成一个单独的日志文件，需要通过 “XxlJobHelper.log” 打印执行日志，“调度中心”查看执行日志时将会加载对应的日志文件。</p>
<p>(历史版本通过重写LOG4J的Appender实现，存在依赖限制，该方式在新版本已经被抛弃)</p>
<p>日志文件存放的位置可在“执行器”配置文件进行自定义，默认目录格式为：/data/applogs/xxl-job/jobhandler/“格式化日期”/“数据库调度日志记录的主键ID.log”。</p>
<p>在JobHandler中开启子线程时，子线程将会把日志打印在父线程即JobHandler的执行日志中，方便日志追踪。</p>
<h2 id="56-通讯模块剖析">5.6 通讯模块剖析<a hidden class="anchor" aria-hidden="true" href="#56-通讯模块剖析">#</a></h2>
<h3 id="561-一次完整的任务调度通讯流程">5.6.1 一次完整的任务调度通讯流程<a hidden class="anchor" aria-hidden="true" href="#561-一次完整的任务调度通讯流程">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>- 1、“调度中心”向“执行器”发送http调度请求: “执行器”中接收请求的服务，实际上是一台内嵌Server，默认端口9999;
</span></span><span style="display:flex;"><span>- 2、“执行器”执行任务逻辑；
</span></span><span style="display:flex;"><span>- 3、“执行器”http回调“调度中心”调度结果: “调度中心”中接收回调的服务，是针对执行器开放一套API服务;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="562-通讯数据加密">5.6.2 通讯数据加密<a hidden class="anchor" aria-hidden="true" href="#562-通讯数据加密">#</a></h3>
<p>调度中心向执行器发送的调度请求时使用RequestModel和ResponseModel两个对象封装调度请求参数和响应数据, 在进行通讯之前底层会将上述两个对象对象序列化，并进行数据协议以及时间戳检验,从而达到数据加密的功能;</p>
<h2 id="57-任务注册-任务自动发现">5.7 任务注册, 任务自动发现<a hidden class="anchor" aria-hidden="true" href="#57-任务注册-任务自动发现">#</a></h2>
<p>自v1.5版本之后, 任务取消了”任务执行机器”属性, 改为通过任务注册和自动发现的方式, 动态获取远程执行器地址并执行。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>AppName: 每个执行器机器集群的唯一标示, 任务注册以 &#34;执行器&#34; 为最小粒度进行注册; 每个任务通过其绑定的执行器可感知对应的执行器机器列表;
</span></span><span style="display:flex;"><span>注册表: 见&#34;xxl_job_registry&#34;表, &#34;执行器&#34; 在进行任务注册时将会周期性维护一条注册记录，即机器地址和AppName的绑定关系; &#34;调度中心&#34; 从而可以动态感知每个AppName在线的机器列表;
</span></span><span style="display:flex;"><span>执行器注册: 任务注册Beat周期默认30s; 执行器以一倍Beat进行执行器注册, 调度中心以一倍Beat进行动态任务发现; 注册信息的失效时间为三倍Beat; 
</span></span><span style="display:flex;"><span>执行器注册摘除：执行器销毁时，将会主动上报调度中心并摘除对应的执行器机器信息，提高心跳注册的实时性；
</span></span></code></pre></td></tr></table>
</div>
</div><p>为保证系统”轻量级”并且降低学习部署成本，没有采用Zookeeper作为注册中心，采用DB方式进行任务注册发现；</p>
<h2 id="58-任务执行结果">5.8 任务执行结果<a hidden class="anchor" aria-hidden="true" href="#58-任务执行结果">#</a></h2>
<p>自v1.6.2之后，任务执行结果通过 “IJobHandler” 的返回值 “ReturnT” 进行判断；<br>
当返回值符合 “ReturnT#code == 200” 时表示任务执行成功，否则表示任务执行失败，而且可以通过 “ReturnT#msg” 回调错误信息给调度中心；<br>
从而，在任务逻辑中可以方便的控制任务执行结果；</p>
<h2 id="59-分片广播--动态分片">5.9 分片广播 &amp; 动态分片<a hidden class="anchor" aria-hidden="true" href="#59-分片广播--动态分片">#</a></h2>
<p>执行器集群部署时，任务路由策略选择”分片广播”情况下，一次任务调度将会广播触发对应集群中所有执行器执行一次任务，同时系统自动传递分片参数；可根据分片参数开发分片任务；</p>
<p>“分片广播” 以执行器为维度进行分片，支持动态扩容执行器集群从而动态增加分片数量，协同进行业务处理；在进行大数据量业务操作时可显著提升任务处理能力和速度。</p>
<p>“分片广播” 和普通任务开发流程一致，不同之处在于可以获取分片参数，获取分片参数进行分片业务处理。</p>
<p>Java语言任务获取分片参数方式：BEAN、GLUE模式(Java)</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// 可参考Sample示例执行器中的示例任务&#34;ShardingJobHandler&#34;了解试用
</span></span><span style="display:flex;"><span>int shardIndex = XxlJobHelper.getShardIndex();
</span></span><span style="display:flex;"><span>int shardTotal = XxlJobHelper.getShardTotal();
</span></span></code></pre></td></tr></table>
</div>
</div><p>脚本语言任务获取分片参数方式：GLUE模式(Shell)、GLUE模式(Python)、GLUE模式(Nodejs)</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// 脚本任务入参固定为三个，依次为：任务传参、分片序号、分片总数。以Shell模式任务为例，获取分片参数代码如下
</span></span><span style="display:flex;"><span>cho &#34;分片序号 index = $2&#34;
</span></span><span style="display:flex;"><span>echo &#34;分片总数 total = $3&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>分片参数属性说明：</p>
<ol>
<li><code>index：当前分片序号(从0开始)，执行器集群列表中当前执行器的序号；</code></li>
<li><code>total：总分片数，执行器集群的总机器数量；</code></li>
</ol>
<h2 id="510-访问令牌accesstoken">5.10 访问令牌（AccessToken）<a hidden class="anchor" aria-hidden="true" href="#510-访问令牌accesstoken">#</a></h2>
<p>为提升系统安全性，调度中心和执行器进行安全性校验，双方AccessToken匹配才允许通讯；</p>
<p>调度中心和执行器，可通过配置项 “xxl.job.accessToken” 进行AccessToken的设置。</p>
<p>调度中心和执行器，如果需要正常通讯，只有两种设置；</p>
<ul>
<li>设置一：调度中心和执行器，均不设置AccessToken；关闭安全性校验；</li>
<li>设置二：调度中心和执行器，设置了相同的AccessToken；</li>
</ul>
<h2 id="511-故障转移--失败重试">5.11 故障转移 &amp; 失败重试<a hidden class="anchor" aria-hidden="true" href="#511-故障转移--失败重试">#</a></h2>
<p>一次完整任务流程包括”调度（调度中心） + 执行（执行器）”两个阶段。</p>
<ul>
<li>“故障转移”发生在调度阶段，在执行器集群部署时，如果某一台执行器发生故障，该策略支持自动进行Failover切换到一台正常的执行器机器并且完成调度请求流程。</li>
<li>“失败重试”发生在”调度 + 执行”两个阶段，支持通过自定义任务失败重试次数，当任务失败时将会按照预设的失败重试次数主动进行重试；</li>
</ul>
<h2 id="512-执行器灰度上线">5.12 执行器灰度上线<a hidden class="anchor" aria-hidden="true" href="#512-执行器灰度上线">#</a></h2>
<p>调度中心与业务解耦，只需部署一次后常年不需要维护。但是，执行器中托管运行着业务作业，作业上线和变更需要重启执行器，尤其是Bean模式任务。<br>
执行器重启可能会中断运行中的任务。但是，XXL-JOB得益于自建执行器与自建注册中心，可以通过灰度上线的方式，避免因重启导致的任务中断的问题。</p>
<p>步骤如下：</p>
<ul>
<li>1、执行器改为手动注册，下线一半机器列表（A组），线上运行另一半机器列表（B组）；</li>
<li>2、等待A组机器任务运行结束并编译上线；执行器注册地址替换为A组；</li>
<li>3、等待B组机器任务运行结束并编译上线；执行器注册地址替换为A组+B组；<br>
操作结束；</li>
</ul>
<h2 id="513-任务执行结果说明">5.13 任务执行结果说明<a hidden class="anchor" aria-hidden="true" href="#513-任务执行结果说明">#</a></h2>
<p>系统根据以下标准判断任务执行结果，可参考之。</p>
<table>
<thead>
<tr>
<th>—</th>
<th>Bean/Glue(Java)</th>
<th>Glue(Shell) 等脚本任务</th>
</tr>
</thead>
<tbody>
<tr>
<td>成功</td>
<td>IJobHandler.SUCCESS</td>
<td>0</td>
</tr>
<tr>
<td>失败</td>
<td>IJobHandler.FAIL</td>
<td>-1（非0状态码）</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="514-任务超时控制">5.14 任务超时控制<a hidden class="anchor" aria-hidden="true" href="#514-任务超时控制">#</a></h2>
<p>支持设置任务超时时间，任务运行超时的情况下，将会主动中断任务；</p>
<p>需要注意的是，任务超时中断时与任务终止机制（可查看“4.9 终止运行中的任务”）类似，也是通过 “interrupt” 中断任务，因此业务代码需要将 “InterruptedException” 外抛，否则功能不可用。</p>
<h2 id="515-跨语言">5.15 跨语言<a hidden class="anchor" aria-hidden="true" href="#515-跨语言">#</a></h2>
<p>XXL-JOB是一个跨语言的任务调度平台，主要体现在如下几个方面：</p>
<ul>
<li>1、OpenApi（RESTful 格式）：调度中心与执行器提供语言无关的 RESTful API 服务，第三方任意语言可据此对接调度中心或者实现执行器，实现多语言支持。（可参考章节 “调度中心/执行器 RESTful API” ）</li>
<li>2、多任务模式：提供Java、Python、PHP……等十来种任务模式，可参考章节 “5.5 任务 “运行模式” ”；理论上可扩展任意语言任务模式；</li>
<li>2、提供基于HTTP的任务Handler（Bean任务，JobHandler=”httpJobHandler”）；业务方只需要提供HTTP链接等相关信息即可，不限制语言、平台；（可参考章节 “原生内置Bean模式任务” ）</li>
</ul>
<h2 id="516-任务失败告警">5.16 任务失败告警<a hidden class="anchor" aria-hidden="true" href="#516-任务失败告警">#</a></h2>
<p>默认提供邮件失败告警，可扩展短信、钉钉等方式。如果需要新增一种告警方式，只需要新增一个实现 “com.xxl.job.admin.core.alarm.JobAlarm” 接口的告警实现即可。可以参考默认提供邮箱告警实现 “EmailJobAlarm”。</p>
<h2 id="517-调度中心docker镜像构建">5.17 调度中心Docker镜像构建<a hidden class="anchor" aria-hidden="true" href="#517-调度中心docker镜像构建">#</a></h2>
<p>可以通过以下命令快速构建调度中心，并启动运行；</p>
<ol>
<li><code>mvn clean package</code></li>
<li><code>docker build -t xuxueli/xxl-job-admin:{version} ./xxl-job-admin</code></li>
<li><code>docker run --name xxl-job-admin -p 8080:8080 -d xuxueli/xxl-job-admin</code></li>
</ol>
<h2 id="520-避免任务重复执行">5.20 避免任务重复执行<a hidden class="anchor" aria-hidden="true" href="#520-避免任务重复执行">#</a></h2>
<p>调度密集或者耗时任务可能会导致任务阻塞，集群情况下调度组件小概率情况下会重复触发；<br>
针对上述情况，可以通过结合 “单机路由策略（如：第一台、一致性哈希）” + “阻塞策略（如：单机串行、丢弃后续调度）” 来规避，最终避免任务重复执行。</p>
<h2 id="521-命令行任务">5.21 命令行任务<a hidden class="anchor" aria-hidden="true" href="#521-命令行任务">#</a></h2>
<p>原生提供通用命令行任务Handler（Bean任务，”CommandJobHandler”）；业务方只需要提供命令行即可，命令及参数之间通过空格隔开；<br>
如任务参数 “ls la” 或 “pwd” 将会执行命令并输出数据；</p>
<h2 id="522-日志自动清理">5.22 日志自动清理<a hidden class="anchor" aria-hidden="true" href="#522-日志自动清理">#</a></h2>
<p>XXL-JOB日志主要包含如下两部分，均支持日志自动清理，说明如下：</p>
<ul>
<li>调度中心日志表数据：可借助配置项 “xxl.job.logretentiondays” 设置日志表数据保存天数，过期日志自动清理；详情可查看上文配置说明；</li>
<li>执行器日志文件数据：可借助配置项 “xxl.job.executor.logretentiondays” 设置日志文件数据保存天数，过期日志自动清理；详情可查看上文配置说明；</li>
</ul>
<h2 id="523-调度结果丢失处理">5.23 调度结果丢失处理<a hidden class="anchor" aria-hidden="true" href="#523-调度结果丢失处理">#</a></h2>
<p>执行器因网络抖动回调失败或宕机等异常情况，会导致任务调度结果丢失。由于调度中心依赖执行器回调来感知调度结果，因此会导致调度日志永远处于 “运行中” 状态。</p>
<p>针对该问题，调度中心提供内置组件进行处理，逻辑为：调度记录停留在 “运行中” 状态超过10min，且对应执行器心跳注册失败不在线，则将本地调度主动标记失败；</p>
<h1 id="六调度中心执行器-openapi">六、调度中心/执行器 OpenApi<a hidden class="anchor" aria-hidden="true" href="#六调度中心执行器-openapi">#</a></h1>
<p>XXL-JOB 目标是一种跨平台、跨语言的任务调度规范和协议。</p>
<p>针对Java应用，可以直接通过官方提供的调度中心与执行器，方便快速的接入和使用调度中心，可以参考上文 “快速入门” 章节。</p>
<p>针对非Java应用，可借助 XXL-JOB 的标准 OpenApi（RESTful API） 方便的实现多语言支持。</p>
<ul>
<li>调度中心 RESTful API：
<ul>
<li>说明：调度中心提供给执行器使用的API；不局限于官方执行器使用，第三方可使用该API来实现执行器；</li>
<li>API列表：执行器注册、任务结果回调等；</li>
</ul>
</li>
<li>执行器 RESTful API ：
<ul>
<li>说明：执行器提供给调度中心使用的API；官方执行器默认已实现，第三方执行器需要实现并对接提供给调度中心；</li>
<li>API列表：任务触发、任务终止、任务日志查询……等；</li>
</ul>
</li>
</ul>
<p>此处 RESTful API 主要用于非Java语言定制个性化执行器使用，实现跨语言。除此之外，如果有需要通过API操作调度中心，可以个性化扩展 “调度中心 RESTful API” 并使用。</p>
<h2 id="61-调度中心-restful-api">6.1 调度中心 RESTful API<a hidden class="anchor" aria-hidden="true" href="#61-调度中心-restful-api">#</a></h2>
<p>API服务位置：com.xxl.job.core.biz.AdminBiz （ com.xxl.job.admin.controller.JobApiController ）<br>
API服务请求参考代码：com.xxl.job.adminbiz.AdminBizTest</p>
<h3 id="a任务回调">a、任务回调<a hidden class="anchor" aria-hidden="true" href="#a任务回调">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>说明：执行器执行完任务后，回调任务结果时使用
</span></span><span style="display:flex;"><span>------
</span></span><span style="display:flex;"><span>地址格式：{调度中心根地址}/api/callback
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Header：
</span></span><span style="display:flex;"><span>    XXL-JOB-ACCESS-TOKEN : {请求令牌}
</span></span><span style="display:flex;"><span>请求数据格式如下，放置在 RequestBody 中，JSON格式：
</span></span><span style="display:flex;"><span>    [{
</span></span><span style="display:flex;"><span>        &#34;logId&#34;:1,              // 本次调度日志ID
</span></span><span style="display:flex;"><span>        &#34;logDateTim&#34;:0,         // 本次调度日志时间
</span></span><span style="display:flex;"><span>        &#34;handleCode&#34;:200,       // 200 表示任务执行正常，500表示失败
</span></span><span style="display:flex;"><span>        &#34;handleMsg&#34;: null
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>响应数据格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;code&#34;: 200,      // 200 表示正常、其他失败
</span></span><span style="display:flex;"><span>      &#34;msg&#34;: null      // 错误提示消息
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="b执行器注册">b、执行器注册<a hidden class="anchor" aria-hidden="true" href="#b执行器注册">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>说明：执行器注册时使用，调度中心会实时感知注册成功的执行器并发起任务调度
</span></span><span style="display:flex;"><span>------
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>地址格式：{调度中心根地址}/api/registry
</span></span><span style="display:flex;"><span>Header：
</span></span><span style="display:flex;"><span>    XXL-JOB-ACCESS-TOKEN : {请求令牌}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>请求数据格式如下，放置在 RequestBody 中，JSON格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &#34;registryGroup&#34;:&#34;EXECUTOR&#34;,                     // 固定值
</span></span><span style="display:flex;"><span>        &#34;registryKey&#34;:&#34;xxl-job-executor-example&#34;,       // 执行器AppName
</span></span><span style="display:flex;"><span>        &#34;registryValue&#34;:&#34;http://127.0.0.1:9999/&#34;        // 执行器地址，内置服务跟地址
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>响应数据格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;code&#34;: 200,      // 200 表示正常、其他失败
</span></span><span style="display:flex;"><span>      &#34;msg&#34;: null      // 错误提示消息
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="c执行器注册摘除">c、执行器注册摘除<a hidden class="anchor" aria-hidden="true" href="#c执行器注册摘除">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>说明：执行器注册摘除时使用，注册摘除后的执行器不参与任务调度与执行
</span></span><span style="display:flex;"><span>------
</span></span><span style="display:flex;"><span>地址格式：{调度中心根地址}/api/registryRemove
</span></span><span style="display:flex;"><span>Header：
</span></span><span style="display:flex;"><span>    XXL-JOB-ACCESS-TOKEN : {请求令牌}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>请求数据格式如下，放置在 RequestBody 中，JSON格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &#34;registryGroup&#34;:&#34;EXECUTOR&#34;,                     // 固定值
</span></span><span style="display:flex;"><span>        &#34;registryKey&#34;:&#34;xxl-job-executor-example&#34;,       // 执行器AppName
</span></span><span style="display:flex;"><span>        &#34;registryValue&#34;:&#34;http://127.0.0.1:9999/&#34;        // 执行器地址，内置服务跟地址
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>响应数据格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;code&#34;: 200,      // 200 表示正常、其他失败
</span></span><span style="display:flex;"><span>      &#34;msg&#34;: null      // 错误提示消息
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="62-执行器-restful-api">6.2 执行器 RESTful API<a hidden class="anchor" aria-hidden="true" href="#62-执行器-restful-api">#</a></h2>
<p>API服务位置：com.xxl.job.core.biz.ExecutorBiz<br>
API服务请求参考代码：com.xxl.job.executorbiz.ExecutorBizTest</p>
<h3 id="a心跳检测">a、心跳检测<a hidden class="anchor" aria-hidden="true" href="#a心跳检测">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>说明：调度中心检测执行器是否在线时使用
</span></span><span style="display:flex;"><span>------
</span></span><span style="display:flex;"><span>地址格式：{执行器内嵌服务根地址}/beat
</span></span><span style="display:flex;"><span>Header：
</span></span><span style="display:flex;"><span>    XXL-JOB-ACCESS-TOKEN : {请求令牌}
</span></span><span style="display:flex;"><span>请求数据格式如下，放置在 RequestBody 中，JSON格式：
</span></span><span style="display:flex;"><span>响应数据格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;code&#34;: 200,      // 200 表示正常、其他失败
</span></span><span style="display:flex;"><span>      &#34;msg&#34;: null       // 错误提示消息
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="b忙碌检测">b、忙碌检测<a hidden class="anchor" aria-hidden="true" href="#b忙碌检测">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>说明：调度中心检测指定执行器上指定任务是否忙碌（运行中）时使用
</span></span><span style="display:flex;"><span>------
</span></span><span style="display:flex;"><span>地址格式：{执行器内嵌服务根地址}/idleBeat
</span></span><span style="display:flex;"><span>Header：
</span></span><span style="display:flex;"><span>    XXL-JOB-ACCESS-TOKEN : {请求令牌}
</span></span><span style="display:flex;"><span>请求数据格式如下，放置在 RequestBody 中，JSON格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &#34;jobId&#34;:1       // 任务ID
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>响应数据格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;code&#34;: 200,      // 200 表示正常、其他失败
</span></span><span style="display:flex;"><span>      &#34;msg&#34;: null       // 错误提示消息
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="c触发任务">c、触发任务<a hidden class="anchor" aria-hidden="true" href="#c触发任务">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f00">说明：触发任务执行</span>
</span></span><span style="display:flex;"><span>------
</span></span><span style="display:flex;"><span><span style="color:#f00">地址格式：</span>{<span style="color:#f00">执行器内嵌服务根地址</span>}/run
</span></span><span style="display:flex;"><span>Header<span style="color:#f00">：</span>
</span></span><span style="display:flex;"><span>    XXL-JOB-ACCESS-TOKEN : {<span style="color:#f00">请求令牌</span>}
</span></span><span style="display:flex;"><span><span style="color:#f00">请求数据格式如下，放置在</span> RequestBody <span style="color:#f00">中，</span>JSON格式<span style="color:#f00">：</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;jobId&#34;</span>:<span style="color:#ff0;font-weight:bold">1</span>,                                  // <span style="color:#f00">任务</span>ID
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;executorHandler&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;demoJobHandler&#34;</span>,         // <span style="color:#f00">任务标识</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;executorParams&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;demoJobHandler&#34;</span>,          // <span style="color:#f00">任务参数</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;executorBlockStrategy&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;COVER_EARLY&#34;</span>,      // <span style="color:#f00">任务阻塞策略，可选值参考</span> com.xxl.job.core.enums.ExecutorBlockStrategyEnum
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;executorTimeout&#34;</span>:<span style="color:#ff0;font-weight:bold">0</span>,                        // <span style="color:#f00">任务超时时间，单位秒，大于零时生效</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;logId&#34;</span>:<span style="color:#ff0;font-weight:bold">1</span>,                                  // <span style="color:#f00">本次调度日志</span>ID
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;logDateTime&#34;</span>:<span style="color:#ff0;font-weight:bold">1586629003729</span>,                // <span style="color:#f00">本次调度日志时间</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;glueType&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;BEAN&#34;</span>,                          // <span style="color:#f00">任务模式，可选值参考</span> com.xxl.job.core.glue.GlueTypeEnum
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;glueSource&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;xxx&#34;</span>,                         // GLUE脚本代码
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;glueUpdatetime&#34;</span>:<span style="color:#ff0;font-weight:bold">1586629003727</span>,             // GLUE脚本更新时间<span style="color:#f00">，用于判定脚本是否变更以及是否需要刷新</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;broadcastIndex&#34;</span>:<span style="color:#ff0;font-weight:bold">0</span>,                         // <span style="color:#f00">分片参数：当前分片</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;broadcastTotal&#34;</span>:<span style="color:#ff0;font-weight:bold">0</span>                          // <span style="color:#f00">分片参数：总分片</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#f00">响应数据格式：</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#0ff;font-weight:bold">&#34;code&#34;</span>: <span style="color:#ff0;font-weight:bold">200</span>,      // <span style="color:#ff0;font-weight:bold">200</span> <span style="color:#f00">表示正常、其他失败</span>
</span></span><span style="display:flex;"><span>      <span style="color:#0ff;font-weight:bold">&#34;msg&#34;</span>: null       // <span style="color:#f00">错误提示消息</span>
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="d终止任务">d、终止任务<a hidden class="anchor" aria-hidden="true" href="#d终止任务">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>说明：终止任务
</span></span><span style="display:flex;"><span>------
</span></span><span style="display:flex;"><span>地址格式：{执行器内嵌服务根地址}/kill
</span></span><span style="display:flex;"><span>Header：
</span></span><span style="display:flex;"><span>    XXL-JOB-ACCESS-TOKEN : {请求令牌}
</span></span><span style="display:flex;"><span>请求数据格式如下，放置在 RequestBody 中，JSON格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &#34;jobId&#34;:1       // 任务ID
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>响应数据格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      &#34;code&#34;: 200,      // 200 表示正常、其他失败
</span></span><span style="display:flex;"><span>      &#34;msg&#34;: null       // 错误提示消息
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="e查看执行日志">e、查看执行日志<a hidden class="anchor" aria-hidden="true" href="#e查看执行日志">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>说明：查看任务日志，滚动方式加载
</span></span><span style="display:flex;"><span>------
</span></span><span style="display:flex;"><span>地址格式：{执行器内嵌服务根地址}/log
</span></span><span style="display:flex;"><span>Header：
</span></span><span style="display:flex;"><span>    XXL-JOB-ACCESS-TOKEN : {请求令牌}
</span></span><span style="display:flex;"><span>请求数据格式如下，放置在 RequestBody 中，JSON格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &#34;logDateTim&#34;:0,     // 本次调度日志时间
</span></span><span style="display:flex;"><span>        &#34;logId&#34;:0,          // 本次调度日志ID
</span></span><span style="display:flex;"><span>        &#34;fromLineNum&#34;:0     // 日志开始行号，滚动加载日志
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>响应数据格式：
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &#34;code&#34;:200,         // 200 表示正常、其他失败
</span></span><span style="display:flex;"><span>        &#34;msg&#34;: null         // 错误提示消息
</span></span><span style="display:flex;"><span>        &#34;content&#34;:{
</span></span><span style="display:flex;"><span>            &#34;fromLineNum&#34;:0,        // 本次请求，日志开始行数
</span></span><span style="display:flex;"><span>            &#34;toLineNum&#34;:100,        // 本次请求，日志结束行号
</span></span><span style="display:flex;"><span>            &#34;logContent&#34;:&#34;xxx&#34;,     // 本次请求日志内容
</span></span><span style="display:flex;"><span>            &#34;isEnd&#34;:true            // 日志是否全部加载完
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://wjy6.netlify.app/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://wjy6.netlify.app/">Wjy&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
