<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>搜索引擎 | Wjy&#39;s Blog</title>
<meta name="keywords" content="中间件">
<meta name="description" content="全文搜索引擎
全文搜索引擎是目前广泛应用的主流搜索引擎。它的工作原理是计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://009965.xyz/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://009965.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://009965.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://009965.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://009965.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://009965.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://009965.xyz/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://009965.xyz/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="搜索引擎">
  <meta property="og:description" content="全文搜索引擎 全文搜索引擎是目前广泛应用的主流搜索引擎。它的工作原理是计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-10-21T16:07:30+00:00">
    <meta property="article:modified_time" content="2019-10-21T16:07:30+00:00">
    <meta property="article:tag" content="中间件">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="搜索引擎">
<meta name="twitter:description" content="全文搜索引擎
全文搜索引擎是目前广泛应用的主流搜索引擎。它的工作原理是计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://009965.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "搜索引擎",
      "item": "https://009965.xyz/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "搜索引擎",
  "name": "搜索引擎",
  "description": "全文搜索引擎 全文搜索引擎是目前广泛应用的主流搜索引擎。它的工作原理是计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。\n",
  "keywords": [
    "中间件"
  ],
  "articleBody": "全文搜索引擎 全文搜索引擎是目前广泛应用的主流搜索引擎。它的工作原理是计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。\n我们生活中的数据总体分为两种：结构化数据 和 非结构化数据。 结构化数据： 指具有固定格式或有限长度的数据，如数据库，元数据等。 非结构化数据： 非结构化数据又可称为全文数据，指不定长或无固定格式的数据，如邮件，word文档等。 当然有的地方还会有第三种：半结构化数据，如XML，HTML等，当根据需要可按结构化数据来处理，也可抽取出纯文本按非结构化数据来处理。\n根据两种数据分类，搜索也分为相应的两种：结构化数据搜索和非结构化数据搜索。 对于结构化数据，我们一般都是可以通过关系型数据库(mysql，oracle等)的 table 的方式存储和搜索，也可以建立索引。 对于非结构化数据，即对全文数据的搜索主要有两种方法：顺序扫描法、全文检索。 顺序扫描：通过文字名称也可了解到它的大概搜索方式，即按照顺序扫描的方式查询特定的关键字。 例如给你一张报纸，让你找到该报纸中“dota2”的文字在哪些地方出现过。你肯定需要从头到尾把报纸阅读扫描一遍然后标记出关键字在哪些版块出现过以及它的出现位置。 这种方式无疑是最耗时的最低效的，如果报纸排版字体小，而且版块较多甚至有多份报纸，等你扫描完你的眼睛也差不多了。\n全文搜索：对非结构化数据顺序扫描很慢，我们是否可以进行优化？把我们的非结构化数据想办法弄得有一定结构不就行了吗？将非结构化数据中的一部分信息提取出来，重新组织，使其变得有一定结构，然后对此有一定结构的数据进行搜索，从而达到搜索相对较快的目的。这种方式就构成了全文检索的基本思路。这部分从非结构化数据中提取出的然后重新组织的信息，我们称之索引。 还以读报纸为例，我们想关注最近TI10的新闻，假如都是 PSG.LGD 的粉丝，如何快速找到 LGD 新闻的报纸和版块呢？全文搜索的方式就是，将所有报纸中所有版块中关键字进行提取，如\"LGD\"，“Liquid”，“FW”，“战队”，“DOTA2\"等。然后对这些关键字建立索引，通过索引我们就可以对应到该关键词出现的报纸和版块。注意区别目录搜索引擎。\n为何要用搜索引擎 之前，有同事问我，为什么要用搜索引擎？我们的所有数据在数据库里面都有，而且 Oracle、SQL Server 等数据库里也能提供查询检索或者聚类分析功能，直接通过数据库查询不就可以了吗？确实，我们大部分的查询功能都可以通过数据库查询获得，如果查询效率低下，还可以通过建数据库索引，优化SQL等方式进行提升效率，甚至通过引入缓存来加快数据的返回速度。如果数据量更大，就可以分库分表来分担查询压力。 那为什么还要全文搜索引擎呢？我们主要从以下几个原因分析：\n数据类型 全文索引搜索支持非结构化数据的搜索，可以更好地快速搜索大量存在的任何单词或单词组的非结构化文本。 例如 Google，百度类的网站搜索，它们都是根据网页中的关键字生成索引，我们在搜索的时候输入关键字，它们会将该关键字即索引匹配到的所有网页返回；还有常见的项目中应用日志的搜索等等。对于这些非结构化的数据文本，关系型数据库搜索不是能很好的支持。 索引的维护 一般传统数据库，全文检索都实现的很鸡肋，因为一般也没人用数据库存文本字段。进行全文检索需要扫描整个表，如果数据量大的话即使对SQL的语法优化，也收效甚微。建立了索引，但是维护起来也很麻烦，对于 insert 和 update 操作都会重新构建索引。 什么时候使用全文搜索引擎： 搜索的数据对象是大量的非结构化的文本数据。 文件记录量达到数十万或数百万个甚至更多。 支持大量基于交互式文本的查询。 需求非常灵活的全文搜索查询。 对高度相关的搜索结果的有特殊需求，但是没有可用的关系数据库可以满足。 对不同记录类型、非文本数据操作或安全事务处理的需求相对较少的情况。\nLucene，Solr，ElasticSearch 现在主流的搜索引擎大概就是：Lucene，Solr，ElasticSearch。 它们的索引建立都是根据倒排索引的方式生成索引，何谓倒排索引？ 维基百科 倒排索引（英语：Inverted index），也常被称为反向索引、置入档案或反向档案，是一种索引方法，被用来存储在全文搜索下某个单词在一个文档或者一组文档中的存储位置的映射。它是文档检索系统中最常用的数据结构。\nLucene Lucene是一个Java全文搜索引擎，完全用Java编写。Lucene不是一个完整的应用程序，而是一个代码库和API，可以很容易地用于向应用程序添加搜索功能。 Lucene通过简单的API提供强大的功能： 可扩展的高性能索引\n在现代硬件上超过150GB /小时 小RAM要求 - 只有1MB堆 增量索引与批量索引一样快 索引大小约为索引文本大小的20-30％ 强大，准确，高效的搜索算法\n排名搜索 - 首先返回最佳结果 许多强大的查询类型：短语查询，通配符查询，邻近查询，范围查询等 现场搜索（例如标题，作者，内容） 按任何字段排序 使用合并结果进行多索引搜索 允许同时更新和搜索 灵活的分面，突出显示，连接和结果分组 快速，内存效率和错误容忍的建议 可插拔排名模型，包括矢量空间模型和Okapi BM25 可配置存储引擎（编解码器） 跨平台解决方案\n作为Apache许可下的开源软件提供 ，允许您在商业和开源程序中使用Lucene 100％-pure Java 可用的其他编程语言中的实现是索引兼容的 Apache软件基金会 在Apache软件基金会提供的开源软件项目的Apache社区的支持。 但是Lucene只是一个框架，要充分利用它的功能，需要使用JAVA，并且在程序中集成Lucene。需要很多的学习了解，才能明白它是如何运行的，熟练运用Lucene确实非常复杂。\nSolr Apache Solr是一个基于名为Lucene的Java库构建的开源搜索平台。它以用户友好的方式提供Apache Lucene的搜索功能。作为一个行业参与者近十年，它是一个成熟的产品，拥有强大而广泛的用户社区。它提供分布式索引，复制，负载平衡查询以及自动故障转移和恢复。如果它被正确部署然后管理得好，它就能够成为一个高度可靠，可扩展且容错的搜索引擎。很多互联网巨头，如Netflix，eBay，Instagram和亚马逊（CloudSearch）都使用Solr，因为它能够索引和搜索多个站点。\n主要功能列表包括：\n全文搜索 突出 分面搜索 实时索引 动态群集 数据库集成 NoSQL功能和丰富的文档处理（例如Word和PDF文件） ElasticSearch Elasticsearch是一个开源（Apache 2许可证），是一个基于Apache Lucene库构建的RESTful搜索引擎。Elasticsearch是在Solr之后几年推出的。它提供了一个分布式，多租户能力的全文搜索引擎，具有HTTP Web界面（REST）和无架构JSON文档。Elasticsearch的官方客户端库提供Java，Groovy，PHP，Ruby，Perl，Python，.NET和Javascript。 分布式搜索引擎包括可以划分为分片的索引，并且每个分片可以具有多个副本。每个Elasticsearch节点都可以有一个或多个分片，其引擎也可以充当协调器，将操作委派给正确的分片。 Elasticsearch可通过近实时搜索进行扩展。其主要功能之一是多租户。 主要功能列表包括：\n分布式搜索 多租户 分析搜索 分组和聚合 ElasticSearch vs solr 由于Lucene的复杂性，一般很少会考虑它作为搜索的第一选择，排除一些公司需要自研搜索框架，底层需要依赖Lucene。所以这里我们重点分析 Elasticsearch 和 Solr。 Elasticsearch vs. Solr。哪一个更好？他们有什么不同？你应该使用哪一个？\n历史比较 Apache Solr是一个成熟的项目，拥有庞大而活跃的开发和用户社区，以及Apache品牌。Solr于2006年首次发布到开源，长期以来一直占据着搜索引擎领域，并且是任何需要搜索功能的人的首选引擎。它的成熟转化为丰富的功能，而不仅仅是简单的文本索引和搜索； 如分面，分组，强大的过滤，可插入的文档处理，可插入的搜索链组件，语言检测等。 Solr 在搜索领域占据了多年的主导地位。然后，在2010年左右，Elasticsearch成为市场上的另一种选择。那时候，它远没有Solr那么稳定，没有Solr的功能深度，没有思想分享，品牌等等。 Elasticsearch虽然很年轻，但它也自己的一些优势，Elasticsearch 建立在更现代的原则上，针对更现代的用例，并且是为了更容易处理大型索引和高查询率而构建的。此外，由于它太年轻，没有社区可以合作，它可以自由地向前推进，而不需要与其他人（用户或开发人员）达成任何共识或合作，向后兼容，或任何其他更成熟的软件通常必须处理。 因此，它在Solr之前就公开了一些非常受欢迎的功能(例如，接近实时搜索，英文：Near Real-Time Search)。从技术上讲，NRT搜索的能力确实来自Lucene，它是 Solr 和 Elasticsearch 使用的基础搜索库。具有讽刺意味的是，因为 Elasticsearch 首先公开了NRT搜索，所以人们将NRT搜索与Elasticsearch 联系在一起，尽管 Solr 和 Lucene 都是同一个 Apache 项目的一部分，因此，人们会首先期望 Solr 具有如此高要求的功能。\n特征差异比较 这两个搜索引擎都是流行的，先进的的开源搜索引擎。它们都是围绕核心底层搜索库 - Lucene构建的 - 但它们又是不同的。像所有东西一样，每个都有其优点和缺点，根据您的需求和期望，每个都可能更好或更差。Solr和Elasticsearch都在快速发展，所以，话不多说，先来看下它们的差异清单：\n特征 Solr/SolrCloud Elasticsearch 社区和开发者 Apache 软件基金和社区支持 单一商业实体及其员工 节点发现 Apache Zookeeper，在大量项目中成熟且经过实战测试 Zen内置于Elasticsearch本身，需要专用的主节点才能进行分裂脑保护 碎片放置 本质上是静态，需要手动工作来迁移分片，从Solr 7开始 - Autoscaling API允许一些动态操作 动态，可以根据群集状态按需移动分片 高速缓存 全局，每个段更改无效 每段，更适合动态更改数据 分析引擎性能 非常适合精确计算的静态数据\t结果的准确性取决于数据放置 全文搜索功能 基于Lucene的语言分析，多建议，拼写检查，丰富的高亮显示支持 基于Lucene的语言分析，单一建议API实现，高亮显示重新计算 DevOps支持 尚未完全，但即将到来 非常好的API 非平面数据处理 嵌套文档和父-子支持 嵌套和对象类型的自然支持允许几乎无限的嵌套和父-子支持 查询DSL JSON（有限），XML（有限）或URL参数 JSON 索引/收集领导控制 领导者安置控制和领导者重新平衡甚至可以节点上的负载 不可能 机器学 内置 - 在流聚合之上，专注于逻辑回归和学习排名贡献模块 商业功能，专注于异常和异常值以及时间序列数据 了解更多\n综合比较 另外，我们在从以下几个方面来分析下：\n近几年的流行趋势 我们查看一下这两种产品的Google搜索趋势。谷歌趋势表明，与 Solr 相比，Elasticsearch具有很大的吸引力，但这并不意味着Apache Solr已经死亡。虽然有些人可能不这么认为，但Solr仍然是最受欢迎的搜索引擎之一，拥有强大的社区和开源支持。 安装和配置 与Solr相比，Elasticsearch易于安装且非常轻巧。此外，您可以在几分钟内安装并运行Elasticsearch。 但是，如果Elasticsearch管理不当，这种易于部署和使用可能会成为一个问题。基于JSON的配置很简单，但如果要为文件中的每个配置指定注释，那么它不适合您。 总的来说，如果您的应用使用的是JSON，那么Elasticsearch是一个更好的选择。否则，请使用Solr，因为它的schema.xml和solrconfig.xml都有很好的文档记录。 社区 Solr拥有更大，更成熟的用户，开发者和贡献者社区。ES虽拥有的规模较小但活跃的用户社区以及不断增长的贡献者社区。 Solr是真正的开源社区代码。任何人都可以为Solr做出贡献，并且根据优点选出新的Solr开发人员（也称为提交者）。Elasticsearch在技术上是开源的，但在精神上却不那么重要。任何人都可以看到来源，任何人都可以更改它并提供贡献，但只有Elasticsearch的员工才能真正对Elasticsearch进行更改。 Solr贡献者和提交者来自许多不同的组织，而Elasticsearch提交者来自单个公司。 成熟度 Solr更成熟，但ES增长迅速，我认为它稳定。 文档 Solr在这里得分很高。它是一个非常有据可查的产品，具有清晰的示例和API用例场景。 Elasticsearch的文档组织良好，但它缺乏好的示例和清晰的配置说明。 总结 那么，到底是Solr还是Elasticsearch？ 有时很难找到明确的答案。无论您选择Solr还是Elasticsearch，首先需要了解正确的用例和未来需求。总结他们的每个属性。\n由于易于使用，Elasticsearch在新开发者中更受欢迎。但是，如果您已经习惯了与Solr合作，请继续使用它，因为迁移到Elasticsearch没有特定的优势。 如果除了搜索文本之外还需要它来处理分析查询，Elasticsearch是更好的选择。 如果需要分布式索引，则需要选择Elasticsearch。对于需要良好可伸缩性和性能的云和分布式环境，Elasticsearch是更好的选择。 两者都有良好的商业支持（咨询，生产支持，整合等） 两者都有很好的操作工具，尽管Elasticsearch因其易于使用的API而更多地吸引了DevOps人群，因此可以围绕它创建一个更加生动的工具生态系统。 Elasticsearch在开源日志管理用例中占据主导地位，许多组织在Elasticsearch中索引它们的日志以使其可搜索。虽然Solr现在也可以用于此目的，但它只是错过了这一想法。 Solr仍然更加面向文本搜索。另一方面，Elasticsearch 通常用于过滤和分组 - 分析查询工作负载 - 而不一定是文本搜索。Elasticsearch 开发人员在 Lucene 和 Elasticsearch 级别上投入了大量精力使此类查询更高效(降低内存占用和CPU使用)。因此，对于不仅需要进行文本搜索，而且需要复杂的搜索时间聚合的应用程序，Elasticsearch是一个更好的选择。 Elasticsearch更容易上手，一个下载和一个命令就可以启动一切。Solr传统上需要更多的工作和知识，但Solr最近在消除这一点上取得了巨大的进步，现在只需努力改变它的声誉。 在性能方面，它们大致相同。我说“大致”，因为没有人做过全面和无偏见的基准测试。对于95％的用例，任何一种选择在性能方面都会很好，剩下的5％需要用它们的特定数据和特定的访问模式来测试这两种解决方案。 从操作上讲，Elasticsearch使用起来比较简单 - 它只有一个进程。Solr在其类似Elasticsearch的完全分布式部署模式SolrCloud中依赖于Apache ZooKeeper。ZooKeeper是超级成熟，超级广泛使用等等，但它仍然是另一个活跃的部分。也就是说，如果您使用的是Hadoop，HBase，Spark，Kafka或其他一些较新的分布式软件，您可能已经在组织的某个地方运行ZooKeeper。 虽然Elasticsearch内置了类似ZooKeeper的组件Xen，但ZooKeeper可以更好地防止有时在Elasticsearch集群中出现的可怕的裂脑问题。公平地说，Elasticsearch开发人员已经意识到这个问题，并致力于改进Elasticsearch的这个方面。 如果您喜欢监控和指标，那么使用Elasticsearch，您将会进入天堂。这个东西比新年前夜在时代广场可以挤压的人有更多的指标！Solr暴露了关键指标，但远不及Elasticsearch那么多。 思维导图 全文搜索 Elastic基础 参考地址 参考地址\nsolr solr官网 下载最新的Binary releases，解压得到 Solr的运行分为单机运行和集群运行，这里以单机为例。 进入到solr的bin目录执行命令： solr start 提示Started Solr server on port 8983 (pid=). Happy searching!，说明启动成功。 然后在浏览器输入http://localhost:8983/solr 就会进入到solr的管理界面。 注意：一定要用windows的cmd启动，而且启动之后cmd窗口不能关闭，git的bash是不行的，虽然提示happy searching，但是无法访问web界面。 一些solr常用命令： solr start –p 端口号：单机版启动solr服务 solr restart –p 端口号：重启solr服务 solr stop –p 端口号：关闭solr服务 solr create –c name：创建一个core实例(core概念后面介绍) 更多命令参考官方文档\n创建core实例 简单说core就是solr的一个实例，一个solr服务下可以有多个core，每个core下都有自己的索引库和与之相应的配置文件，所以在操作solr创建索引之前要创建一个core，因为索引都存在core下面。\n在bin目录下执行solr create –c name，创建一个core，默认创建出来的位置如下图 第二种方式是直接使用AdminUI页面创建一个core，如下图 创建的时候报错： Can't find resource 'solrconfig.xml' in classpath orc 找到solr-8.2.0/server/configsets/sample_techproducts_configs/conf 把这个conf文件夹copy到新建的文件夹中。 配置schema schema介绍 schema是用来告诉solr如何建立索引的，他的配置围绕着一个schema配置文件，这个配置文件决定着solr如何建立索引，每个字段的数据类型，分词方式等，老版本的schema配置文件的名字叫做schema.xml他的配置方式就是手工编辑，但是现在新版本的schema配置文件的名字叫做managed-schema，他的配置方式不再是用手工编辑而是使用schemaAPI来配置，官方给出的解释是使用schemaAPI修改managed-schema内容后不需要重新加载core或者重启solr更适合在生产环境下维护，如果使用手工编辑的方式更改配置不进行重加载core有可能会造成配置丢失，配置文件所在的路径如下图： schema主要成员： fieldType：为field定义类型，最主要作用是定义分词器，分词器决定着如何从文档中检索关键字。 analyzer：他是fieldType下的子元素，这就是传说中的分词器，他由一组tokenizer和filter组成，如下图所示 field：他是创建索引用的字段，如果想要这个字段生成索引需要配置他的indexed属性为true，stored属性为true表示存储该索引。如下所示每个field都要引用一种fieldType由type属性定义 这里描述的只是最常用的三个元素，关于更多schema的介绍请参考 Schema API Schema API其实就是用post请求向solr服务器发送携带json参数的请求，所有操作内容都封装在json中，如果是linux系统直接使用curl工具，如果是windows系统推荐使用Postman 这里以添加一个field为例，下面列出其他API： add-field: add a new field with parameters youprovide. delete-field: delete a field. replace-field: replace an existing field withone that is differently configured. 更多api请参考\n中文分词器 分词，即文本分析，是指把整个文本分解成一系列单词的过程。比如说：北京大学 是一个词那么进行拆分可以得到：北京与大学，甚至北京大学整个词也是一个语义。 solr自带了一些中文分词器，比较好用的是SmartChineseAnalyzer，但是扩展性比较差不能自定义扩展中文词库，所以这里选择使用IKAnalyzer，这是第三方的一个分词器可以很好的扩展中文词库。 下载IKAnalyzer的jar包 将下载好的jar包放入solr-7.4.0/server/solr-webapp/webapp/WEB-INF/lib目录中。\n复制新项目的配置文件\n1 2 3 cd /usr/local/solr-7.4.0 mkdir server/solr/ik cp -r server/solr/configsets/_default/conf server/solr/ik/ 然后到server/solr/ik/conf目录中打开managed-schema文件，增加如下代码\n1 2 3 4 5 6 7 8 9 10 11 定义了一个text_ik这个字段类型并采用Ik分词器，接下来在field元素定义式指定type=text_ik就可以把这个分词器应用在这个field中。\n重启solr bin/solr restart -force 新增core：ik，或是在旧的core的manage-schema中增加上边的配置。\nsolr7自带分词中文分词器 复制jar包 cp contrib/analysis-extras/lucene-libs/lucene-analyzers-smartcn-7.4.0.jar server/solr-webapp/webapp/WEB-INF/lib 复制新项目的配置文件\n1 2 3 cd /root/tar/solr-7.4.0 mkdir server/solr/test cp -r server/solr/configsets/_default/conf server/solr/test/ 然后到server/solr/test/conf目录中打开managed-schema文件，增加如下代码\n1 2 3 4 5 6 7 8 定义了一个text_hmm_chinese这个字段类型并采用自带中文分词器，接下来在field元素定义式指定type=text_hmm_chinese就可以把这个分词器应用在这个field中。\n重启solr bin/solr restart -force 新增一个core：test\n对比两个分词的效果 IK分词器 自带分词器 我感觉IK的语义分析更好些。 参考\nDIH导入索引数据 DIH全称是Data Import Handler 数据导入处理器，顾名思义这是向solr中导入数据的，我们的solr目的就是为了能让我们的应用程序更快的查询出用户想要的数据，而数据存储在应用中的各种地方如：xml、pdf、关系数据库中，那么solr首先就要能够获取这些数据并在这些数据中建立索引来达成快速搜索的目的，这里就列举我们最常用的从关系型数据库中向solr导入索引数据。\n在我们自己建立的core的目录下有conf目录，这里面有着几个很重要的配置文件，之前我们用到的managed-schema(老版本是schema.xml)也在其中，另外还有一个solrconfig.xml文件，这是我们DIH配置的第一步，需要在此文件中配置数据导入文件的映射位置如下图： 第二步配置数据导入文件，这个文件可以在solr根目录下的示例文件中copy一份到core/conf目录下，也就是跟solrconfig.xml在一个目录下，因为solrconfig.xml中配置的相对路径就是这里，当然也可以写绝对路径。如下图： Copy过去之后这个文件名可以自定义，我就改成了MyDataConfig.xml，下面开始配置如下图： 首先配置数据源关系型数据库基本四项，驱动类，url，用户名，密码。 配置document，可以把它当作与mysql中数据库一个层级的对象。 配置entity，可以把它当作与数据库中一个表对应，在query中书写查询sql。 配置field与表中的字段与之对应。 注意这里容易与schema中的配置混淆，我的理解是schema中配置的是创建索引的配置，而索引的创建需要有数据基础，而现在讲的数据导入文件就是建立索引的数据基础，他是创建索引的元数据。现在配置文件完成后可以用DIH命令执行了。 DIH 命令 DIH命令就是用来执行数据导入的，命令种类繁多这里只列出简单常用。DIH命令采用的方式是URL的方式。 full-import：全部数据导入例如： 接下来验证下数据是否真的导入成功了，如下图 fq:过滤的字段，df：默认查询字段，start，rows：分页配置，sort：排序，更多关于查询语句的介绍请参考\nsolrJ(java客户端) solrJ是java访问solr的客户端工具包，solr也提供了其他语言访问的客户端，可以到官方文档查看，现在solr的索引和数据导入都已经有，但是作为项目中应用的一个组件，少不了java与solr的沟通。\n导入solrJ依赖\n1 2 3 4 5 org.apache.solr solr-solrj 7.4.0 从solr中查询索引 向solr添加更改索引，java实体对象与solr索引映射 向solr添加或更新索引，如果此实体在solr索引库中已有则作为更新操作 参考地址\n如果是springb boot项目，只需要导入starter即可。\n1 2 3 4 org.springframework.boot spring-boot-starter-data-solr 在配置文件application.properties中加入如下配置： spring.data.solr.host=http://localhost:8983/solr/new_core 路径solr/后面的内容，是新建的core的名字。这里可以理解为数据库的概念。在操作的时，如果有多个core，可以切换数据库，也就是切换 core。\nsolr加上baseAuth安全认证后，使用solrj查询数据和添加索引 在SolrJ中使用BasicAuth 在SolrJ中，需要为每个请求设置基本的身份验证凭证，如下例所示：\n1 2 3 4 5 6 7 8 //create a new request object SolrRequest req ; req.setBasicAuthCredentials(userName, password); solrClient.request(req); Query example: QueryRequest req = new QueryRequest(new SolrQuery(\"*:*\")); req.setBasicAuthCredentials(userName, password); QueryResponse rsp = req.process(solrClient); solr操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 @RestController @RequestMapping(\"solr\") public class SolrController { @Autowired private SolrClient client; /** * 新增/修改 索引 * 当id存在的时候, 此方法是修改 * @return */ @RequestMapping(\"add\") public String add() { try { SolrInputDocument doc = new SolrInputDocument(); doc.setField(\"id\", uuid); doc.setField(\"content_ik\", \"我是中国人, 我爱中国\"); //如果spring.data.solr.host 里面配置core了, 那么这里就不需要传 collection1 这个参数 client.add(\"collection1\", doc); //client.commit(); client.commit(\"collection1\"); return 1; } catch (Exception e) { e.printStackTrace(); } return \"error\"; } /** * 根据id删除索引 * @param id * @return */ @RequestMapping(\"delete\") public String delete(String id) { try { client.deleteById(\"collection1\",id); client.commit(\"collection1\"); return id; } catch (Exception e) { e.printStackTrace(); } return \"error\"; } /** * 删除所有的索引 * @return */ @RequestMapping(\"deleteAll\") public String deleteAll(){ try { client.deleteByQuery(\"collection1\",\"*:*\"); client.commit(\"collection1\"); return \"success\"; } catch (Exception e) { e.printStackTrace(); } return \"error\"; } /** * 根据id查询索引 * @return * @throws Exception */ @RequestMapping(\"getById\") public String getById() throws Exception { SolrDocument document = client.getById(\"collection1\", \"536563\"); System.out.println(document); return document.toString(); } /** * 综合查询: 在综合查询中, 有按条件查询, 条件过滤, 排序, 分页, 高亮显示, 获取部分域信息 * @return */ @RequestMapping(\"search\") public Map",
  "wordCount" : "12600",
  "inLanguage": "en",
  "datePublished": "2019-10-21T16:07:30Z",
  "dateModified": "2019-10-21T16:07:30Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://009965.xyz/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://009965.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      搜索引擎
    </h1>
    <div class="post-meta"><span title='2019-10-21 16:07:30 +0000 UTC'>2019-10-21</span>&nbsp;·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%bc%95%e6%93%8e" aria-label="全文搜索引擎">全文搜索引擎</a></li>
                <li>
                    <a href="#%e4%b8%ba%e4%bd%95%e8%a6%81%e7%94%a8%e6%90%9c%e7%b4%a2%e5%bc%95%e6%93%8e" aria-label="为何要用搜索引擎">为何要用搜索引擎</a></li>
                <li>
                    <a href="#lucenesolrelasticsearch" aria-label="Lucene，Solr，ElasticSearch">Lucene，Solr，ElasticSearch</a><ul>
                        
                <li>
                    <a href="#lucene" aria-label="Lucene">Lucene</a></li>
                <li>
                    <a href="#solr" aria-label="Solr">Solr</a></li>
                <li>
                    <a href="#elasticsearch" aria-label="ElasticSearch">ElasticSearch</a></li>
                <li>
                    <a href="#elasticsearch-vs-solr" aria-label="ElasticSearch vs solr">ElasticSearch vs solr</a><ul>
                        
                <li>
                    <a href="#%e5%8e%86%e5%8f%b2%e6%af%94%e8%be%83" aria-label="历史比较">历史比较</a></li>
                <li>
                    <a href="#%e7%89%b9%e5%be%81%e5%b7%ae%e5%bc%82%e6%af%94%e8%be%83" aria-label="特征差异比较">特征差异比较</a></li>
                <li>
                    <a href="#%e7%bb%bc%e5%90%88%e6%af%94%e8%be%83" aria-label="综合比较">综合比较</a></li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="总结">总结</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%80%9d%e7%bb%b4%e5%af%bc%e5%9b%be" aria-label="思维导图">思维导图</a><ul>
                        
                <li>
                    <a href="#%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2" aria-label="全文搜索">全文搜索</a></li>
                <li>
                    <a href="#elastic%e5%9f%ba%e7%a1%80" aria-label="Elastic基础">Elastic基础</a></li></ul>
                </li>
                <li>
                    <a href="#solr-1" aria-label="solr">solr</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%bacore%e5%ae%9e%e4%be%8b" aria-label="创建core实例">创建core实例</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%aeschema" aria-label="配置schema">配置schema</a><ul>
                        
                <li>
                    <a href="#schema%e4%bb%8b%e7%bb%8d" aria-label="schema介绍">schema介绍</a></li>
                <li>
                    <a href="#schema%e4%b8%bb%e8%a6%81%e6%88%90%e5%91%98" aria-label="schema主要成员：">schema主要成员：</a></li>
                <li>
                    <a href="#schema-api" aria-label="Schema API">Schema API</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%ad%e6%96%87%e5%88%86%e8%af%8d%e5%99%a8" aria-label="中文分词器">中文分词器</a><ul>
                        
                <li>
                    <a href="#solr7%e8%87%aa%e5%b8%a6%e5%88%86%e8%af%8d%e4%b8%ad%e6%96%87%e5%88%86%e8%af%8d%e5%99%a8" aria-label="solr7自带分词中文分词器">solr7自带分词中文分词器</a></li></ul>
                </li>
                <li>
                    <a href="#dih%e5%af%bc%e5%85%a5%e7%b4%a2%e5%bc%95%e6%95%b0%e6%8d%ae" aria-label="DIH导入索引数据">DIH导入索引数据</a><ul>
                        
                <li>
                    <a href="#dih-%e5%91%bd%e4%bb%a4" aria-label="DIH 命令">DIH 命令</a></li></ul>
                </li>
                <li>
                    <a href="#solrjjava%e5%ae%a2%e6%88%b7%e7%ab%af" aria-label="solrJ(java客户端)">solrJ(java客户端)</a></li>
                <li>
                    <a href="#solr%e5%8a%a0%e4%b8%8abaseauth%e5%ae%89%e5%85%a8%e8%ae%a4%e8%af%81%e5%90%8e%e4%bd%bf%e7%94%a8solrj%e6%9f%a5%e8%af%a2%e6%95%b0%e6%8d%ae%e5%92%8c%e6%b7%bb%e5%8a%a0%e7%b4%a2%e5%bc%95" aria-label="solr加上baseAuth安全认证后，使用solrj查询数据和添加索引">solr加上baseAuth安全认证后，使用solrj查询数据和添加索引</a></li>
                <li>
                    <a href="#solr%e6%93%8d%e4%bd%9c" aria-label="solr操作">solr操作</a><ul>
                        
                <li>
                    <a href="#solr%e6%9f%a5%e8%af%a2%e5%8f%82%e6%95%b0" aria-label="solr查询参数">solr查询参数</a><ul>
                        
                <li>
                    <a href="#%e5%a4%9a%e6%9d%a1%e4%bb%b6%e6%9f%a5%e8%af%a2" aria-label="多条件查询">多条件查询</a></li></ul>
                </li>
                <li>
                    <a href="#solr%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae" aria-label="solr删除数据">solr删除数据</a></li>
                <li>
                    <a href="#solr%e8%ae%be%e7%bd%ae%e5%af%86%e7%a0%81%e5%90%8e%e4%bb%a3%e7%a0%81%e8%ae%bf%e9%97%aesolr" aria-label="solr设置密码后代码访问solr">solr设置密码后代码访问solr</a></li>
                <li>
                    <a href="#solr%e6%8a%a5%e9%94%99" aria-label="solr报错">solr报错</a></li>
                <li>
                    <a href="#solr%e6%9f%a5%e5%87%ba%e7%9a%84%e6%95%b0%e6%8d%ae%e4%b8%8d%e5%8c%b9%e9%85%8d" aria-label="solr查出的数据不匹配">solr查出的数据不匹配</a></li>
                <li>
                    <a href="#solr%e5%85%b3%e9%94%ae%e5%ad%97%e5%8c%b9%e9%85%8d%e9%97%ae%e9%a2%98" aria-label="solr关键字匹配问题">solr关键字匹配问题</a></li>
                <li>
                    <a href="#facet%e7%bb%93%e6%9e%9c%e5%88%86%e7%bb%84" aria-label="facet结果分组">facet结果分组</a></li>
                <li>
                    <a href="#id%e7%9b%b8%e5%90%8c%e6%95%b0%e6%8d%ae%e8%a6%86%e7%9b%96%e9%97%ae%e9%a2%98" aria-label="id相同数据覆盖问题">id相同数据覆盖问题</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e5%ae%9e%e4%bd%93%e7%b1%bb%e8%bf%94%e5%9b%9esolr%e6%95%b0%e6%8d%ae" aria-label="使用实体类返回solr数据">使用实体类返回solr数据</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="全文搜索引擎">全文搜索引擎<a hidden class="anchor" aria-hidden="true" href="#全文搜索引擎">#</a></h1>
<p>全文搜索引擎是目前广泛应用的主流搜索引擎。它的工作原理是计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。</p>
<p>我们生活中的数据总体分为两种：结构化数据 和 非结构化数据。
结构化数据： 指具有固定格式或有限长度的数据，如数据库，元数据等。
非结构化数据： 非结构化数据又可称为全文数据，指不定长或无固定格式的数据，如邮件，word文档等。
当然有的地方还会有第三种：半结构化数据，如XML，HTML等，当根据需要可按结构化数据来处理，也可抽取出纯文本按非结构化数据来处理。</p>
<p>根据两种数据分类，搜索也分为相应的两种：结构化数据搜索和非结构化数据搜索。
对于结构化数据，我们一般都是可以通过关系型数据库(mysql，oracle等)的 table 的方式存储和搜索，也可以建立索引。
对于非结构化数据，即对全文数据的搜索主要有两种方法：顺序扫描法、全文检索。
顺序扫描：通过文字名称也可了解到它的大概搜索方式，即按照顺序扫描的方式查询特定的关键字。
例如给你一张报纸，让你找到该报纸中“dota2”的文字在哪些地方出现过。你肯定需要从头到尾把报纸阅读扫描一遍然后标记出关键字在哪些版块出现过以及它的出现位置。
这种方式无疑是最耗时的最低效的，如果报纸排版字体小，而且版块较多甚至有多份报纸，等你扫描完你的眼睛也差不多了。</p>
<p>全文搜索：对非结构化数据顺序扫描很慢，我们是否可以进行优化？把我们的非结构化数据想办法弄得有一定结构不就行了吗？将非结构化数据中的一部分信息提取出来，重新组织，使其变得有一定结构，然后对此有一定结构的数据进行搜索，从而达到搜索相对较快的目的。这种方式就构成了全文检索的基本思路。这部分从非结构化数据中提取出的然后重新组织的信息，我们称之索引。
还以读报纸为例，我们想关注最近TI10的新闻，假如都是 PSG.LGD 的粉丝，如何快速找到 LGD 新闻的报纸和版块呢？全文搜索的方式就是，将所有报纸中所有版块中关键字进行提取，如&quot;LGD&quot;，&ldquo;Liquid&rdquo;，&ldquo;FW&rdquo;，&ldquo;战队&rdquo;，&ldquo;DOTA2&quot;等。然后对这些关键字建立索引，通过索引我们就可以对应到该关键词出现的报纸和版块。注意区别目录搜索引擎。</p>
<h1 id="为何要用搜索引擎">为何要用搜索引擎<a hidden class="anchor" aria-hidden="true" href="#为何要用搜索引擎">#</a></h1>
<p>之前，有同事问我，为什么要用搜索引擎？我们的所有数据在数据库里面都有，而且 Oracle、SQL Server 等数据库里也能提供查询检索或者聚类分析功能，直接通过数据库查询不就可以了吗？确实，我们大部分的查询功能都可以通过数据库查询获得，如果查询效率低下，还可以通过建数据库索引，优化SQL等方式进行提升效率，甚至通过引入缓存来加快数据的返回速度。如果数据量更大，就可以分库分表来分担查询压力。
那为什么还要全文搜索引擎呢？我们主要从以下几个原因分析：</p>
<ul>
<li>数据类型
全文索引搜索支持非结构化数据的搜索，可以更好地快速搜索大量存在的任何单词或单词组的非结构化文本。
例如 Google，百度类的网站搜索，它们都是根据网页中的关键字生成索引，我们在搜索的时候输入关键字，它们会将该关键字即索引匹配到的所有网页返回；还有常见的项目中应用日志的搜索等等。对于这些非结构化的数据文本，关系型数据库搜索不是能很好的支持。</li>
<li>索引的维护
一般传统数据库，全文检索都实现的很鸡肋，因为一般也没人用数据库存文本字段。进行全文检索需要扫描整个表，如果数据量大的话即使对SQL的语法优化，也收效甚微。建立了索引，但是维护起来也很麻烦，对于 insert 和 update 操作都会重新构建索引。</li>
</ul>
<p>什么时候使用全文搜索引擎：
搜索的数据对象是大量的非结构化的文本数据。
文件记录量达到数十万或数百万个甚至更多。
支持大量基于交互式文本的查询。
需求非常灵活的全文搜索查询。
对高度相关的搜索结果的有特殊需求，但是没有可用的关系数据库可以满足。
对不同记录类型、非文本数据操作或安全事务处理的需求相对较少的情况。</p>
<h1 id="lucenesolrelasticsearch">Lucene，Solr，ElasticSearch<a hidden class="anchor" aria-hidden="true" href="#lucenesolrelasticsearch">#</a></h1>
<p>现在主流的搜索引擎大概就是：Lucene，Solr，ElasticSearch。
它们的索引建立都是根据倒排索引的方式生成索引，何谓倒排索引？
维基百科
倒排索引（英语：Inverted index），也常被称为反向索引、置入档案或反向档案，是一种索引方法，被用来存储在全文搜索下某个单词在一个文档或者一组文档中的存储位置的映射。它是文档检索系统中最常用的数据结构。</p>
<h2 id="lucene">Lucene<a hidden class="anchor" aria-hidden="true" href="#lucene">#</a></h2>
<p>Lucene是一个Java全文搜索引擎，完全用Java编写。Lucene不是一个完整的应用程序，而是一个代码库和API，可以很容易地用于向应用程序添加搜索功能。
Lucene通过简单的API提供强大的功能：
<strong>可扩展的高性能索引</strong></p>
<ul>
<li>在现代硬件上超过150GB /小时</li>
<li>小RAM要求 - 只有1MB堆</li>
<li>增量索引与批量索引一样快</li>
<li>索引大小约为索引文本大小的20-30％</li>
</ul>
<p><strong>强大，准确，高效的搜索算法</strong></p>
<ul>
<li>排名搜索 - 首先返回最佳结果</li>
<li>许多强大的查询类型：短语查询，通配符查询，邻近查询，范围查询等</li>
<li>现场搜索（例如标题，作者，内容）</li>
<li>按任何字段排序</li>
<li>使用合并结果进行多索引搜索</li>
<li>允许同时更新和搜索</li>
<li>灵活的分面，突出显示，连接和结果分组</li>
<li>快速，内存效率和错误容忍的建议</li>
<li>可插拔排名模型，包括矢量空间模型和Okapi BM25</li>
<li>可配置存储引擎（编解码器）</li>
</ul>
<p><strong>跨平台解决方案</strong></p>
<ul>
<li>作为Apache许可下的开源软件提供 ，允许您在商业和开源程序中使用Lucene</li>
<li>100％-pure Java</li>
<li>可用的其他编程语言中的实现是索引兼容的</li>
</ul>
<p>Apache软件基金会
在Apache软件基金会提供的开源软件项目的Apache社区的支持。
但是Lucene只是一个框架，要充分利用它的功能，需要使用JAVA，并且在程序中集成Lucene。需要很多的学习了解，才能明白它是如何运行的，熟练运用Lucene确实非常复杂。</p>
<h2 id="solr">Solr<a hidden class="anchor" aria-hidden="true" href="#solr">#</a></h2>
<p>Apache Solr是一个基于名为Lucene的Java库构建的开源搜索平台。它以用户友好的方式提供Apache Lucene的搜索功能。作为一个行业参与者近十年，它是一个成熟的产品，拥有强大而广泛的用户社区。它提供分布式索引，复制，负载平衡查询以及自动故障转移和恢复。如果它被正确部署然后管理得好，它就能够成为一个高度可靠，可扩展且容错的搜索引擎。很多互联网巨头，如Netflix，eBay，Instagram和亚马逊（CloudSearch）都使用Solr，因为它能够索引和搜索多个站点。</p>
<p>主要功能列表包括：</p>
<ul>
<li>全文搜索</li>
<li>突出</li>
<li>分面搜索</li>
<li>实时索引</li>
<li>动态群集</li>
<li>数据库集成</li>
<li>NoSQL功能和丰富的文档处理（例如Word和PDF文件）</li>
</ul>
<h2 id="elasticsearch">ElasticSearch<a hidden class="anchor" aria-hidden="true" href="#elasticsearch">#</a></h2>
<p>Elasticsearch是一个开源（Apache 2许可证），是一个基于Apache Lucene库构建的RESTful搜索引擎。Elasticsearch是在Solr之后几年推出的。它提供了一个分布式，多租户能力的全文搜索引擎，具有HTTP Web界面（REST）和无架构JSON文档。Elasticsearch的官方客户端库提供Java，Groovy，PHP，Ruby，Perl，Python，.NET和Javascript。
分布式搜索引擎包括可以划分为分片的索引，并且每个分片可以具有多个副本。每个Elasticsearch节点都可以有一个或多个分片，其引擎也可以充当协调器，将操作委派给正确的分片。
Elasticsearch可通过近实时搜索进行扩展。其主要功能之一是多租户。
主要功能列表包括：</p>
<ul>
<li>分布式搜索</li>
<li>多租户</li>
<li>分析搜索</li>
<li>分组和聚合</li>
</ul>
<h2 id="elasticsearch-vs-solr">ElasticSearch vs solr<a hidden class="anchor" aria-hidden="true" href="#elasticsearch-vs-solr">#</a></h2>
<p>由于Lucene的复杂性，一般很少会考虑它作为搜索的第一选择，排除一些公司需要自研搜索框架，底层需要依赖Lucene。所以这里我们重点分析 Elasticsearch 和 Solr。
Elasticsearch vs. Solr。哪一个更好？他们有什么不同？你应该使用哪一个？</p>
<h3 id="历史比较">历史比较<a hidden class="anchor" aria-hidden="true" href="#历史比较">#</a></h3>
<p>Apache Solr是一个成熟的项目，拥有庞大而活跃的开发和用户社区，以及Apache品牌。Solr于2006年首次发布到开源，长期以来一直占据着搜索引擎领域，并且是任何需要搜索功能的人的首选引擎。它的成熟转化为丰富的功能，而不仅仅是简单的文本索引和搜索； 如分面，分组，强大的过滤，可插入的文档处理，可插入的搜索链组件，语言检测等。
Solr 在搜索领域占据了多年的主导地位。然后，在2010年左右，Elasticsearch成为市场上的另一种选择。那时候，它远没有Solr那么稳定，没有Solr的功能深度，没有思想分享，品牌等等。
Elasticsearch虽然很年轻，但它也自己的一些优势，Elasticsearch 建立在更现代的原则上，针对更现代的用例，并且是为了更容易处理大型索引和高查询率而构建的。此外，由于它太年轻，没有社区可以合作，它可以自由地向前推进，而不需要与其他人（用户或开发人员）达成任何共识或合作，向后兼容，或任何其他更成熟的软件通常必须处理。
因此，它在Solr之前就公开了一些非常受欢迎的功能(例如，接近实时搜索，英文：Near Real-Time Search)。从技术上讲，NRT搜索的能力确实来自Lucene，它是 Solr 和 Elasticsearch 使用的基础搜索库。具有讽刺意味的是，因为 Elasticsearch 首先公开了NRT搜索，所以人们将NRT搜索与Elasticsearch 联系在一起，尽管 Solr 和 Lucene 都是同一个 Apache 项目的一部分，因此，人们会首先期望 Solr 具有如此高要求的功能。</p>
<h3 id="特征差异比较">特征差异比较<a hidden class="anchor" aria-hidden="true" href="#特征差异比较">#</a></h3>
<p>这两个搜索引擎都是流行的，先进的的开源搜索引擎。它们都是围绕核心底层搜索库 - Lucene构建的 - 但它们又是不同的。像所有东西一样，每个都有其优点和缺点，根据您的需求和期望，每个都可能更好或更差。Solr和Elasticsearch都在快速发展，所以，话不多说，先来看下它们的差异清单：</p>
<table>
<thead>
<tr>
<th>特征</th>
<th>Solr/SolrCloud</th>
<th>Elasticsearch</th>
</tr>
</thead>
<tbody>
<tr>
<td>社区和开发者</td>
<td>Apache 软件基金和社区支持</td>
<td>单一商业实体及其员工</td>
</tr>
<tr>
<td>节点发现</td>
<td>Apache Zookeeper，在大量项目中成熟且经过实战测试</td>
<td>Zen内置于Elasticsearch本身，需要专用的主节点才能进行分裂脑保护</td>
</tr>
<tr>
<td>碎片放置</td>
<td>本质上是静态，需要手动工作来迁移分片，从Solr 7开始 - Autoscaling API允许一些动态操作</td>
<td>动态，可以根据群集状态按需移动分片</td>
</tr>
<tr>
<td>高速缓存</td>
<td>全局，每个段更改无效</td>
<td>每段，更适合动态更改数据</td>
</tr>
<tr>
<td>分析引擎性能</td>
<td>非常适合精确计算的静态数据	结果的准确性取决于数据放置</td>
<td></td>
</tr>
<tr>
<td>全文搜索功能</td>
<td>基于Lucene的语言分析，多建议，拼写检查，丰富的高亮显示支持</td>
<td>基于Lucene的语言分析，单一建议API实现，高亮显示重新计算</td>
</tr>
<tr>
<td>DevOps支持</td>
<td>尚未完全，但即将到来</td>
<td>非常好的API</td>
</tr>
<tr>
<td>非平面数据处理</td>
<td>嵌套文档和父-子支持</td>
<td>嵌套和对象类型的自然支持允许几乎无限的嵌套和父-子支持</td>
</tr>
<tr>
<td>查询DSL</td>
<td>JSON（有限），XML（有限）或URL参数</td>
<td>JSON</td>
</tr>
<tr>
<td>索引/收集领导控制</td>
<td>领导者安置控制和领导者重新平衡甚至可以节点上的负载</td>
<td>不可能</td>
</tr>
<tr>
<td>机器学</td>
<td>内置 - 在流聚合之上，专注于逻辑回归和学习排名贡献模块</td>
<td>商业功能，专注于异常和异常值以及时间序列数据</td>
</tr>
</tbody>
</table>
<p><a href="http://solr-vs-elasticsearch.com/">了解更多</a></p>
<h3 id="综合比较">综合比较<a hidden class="anchor" aria-hidden="true" href="#综合比较">#</a></h3>
<p>另外，我们在从以下几个方面来分析下：</p>
<ul>
<li>近几年的流行趋势
我们查看一下这两种产品的Google搜索趋势。谷歌趋势表明，与 Solr 相比，Elasticsearch具有很大的吸引力，但这并不意味着Apache Solr已经死亡。虽然有些人可能不这么认为，但Solr仍然是最受欢迎的搜索引擎之一，拥有强大的社区和开源支持。</li>
<li>安装和配置
与Solr相比，Elasticsearch易于安装且非常轻巧。此外，您可以在几分钟内安装并运行Elasticsearch。
但是，如果Elasticsearch管理不当，这种易于部署和使用可能会成为一个问题。基于JSON的配置很简单，但如果要为文件中的每个配置指定注释，那么它不适合您。
总的来说，如果您的应用使用的是JSON，那么Elasticsearch是一个更好的选择。否则，请使用Solr，因为它的schema.xml和solrconfig.xml都有很好的文档记录。</li>
<li>社区
Solr拥有更大，更成熟的用户，开发者和贡献者社区。ES虽拥有的规模较小但活跃的用户社区以及不断增长的贡献者社区。
Solr是真正的开源社区代码。任何人都可以为Solr做出贡献，并且根据优点选出新的Solr开发人员（也称为提交者）。Elasticsearch在技术上是开源的，但在精神上却不那么重要。任何人都可以看到来源，任何人都可以更改它并提供贡献，但只有Elasticsearch的员工才能真正对Elasticsearch进行更改。
Solr贡献者和提交者来自许多不同的组织，而Elasticsearch提交者来自单个公司。</li>
<li>成熟度
Solr更成熟，但ES增长迅速，我认为它稳定。</li>
<li>文档
Solr在这里得分很高。它是一个非常有据可查的产品，具有清晰的示例和API用例场景。 Elasticsearch的文档组织良好，但它缺乏好的示例和清晰的配置说明。</li>
</ul>
<h3 id="总结">总结<a hidden class="anchor" aria-hidden="true" href="#总结">#</a></h3>
<p>那么，到底是Solr还是Elasticsearch？
有时很难找到明确的答案。无论您选择Solr还是Elasticsearch，首先需要了解正确的用例和未来需求。总结他们的每个属性。</p>
<ul>
<li>由于易于使用，Elasticsearch在新开发者中更受欢迎。但是，如果您已经习惯了与Solr合作，请继续使用它，因为迁移到Elasticsearch没有特定的优势。</li>
<li>如果除了搜索文本之外还需要它来处理分析查询，Elasticsearch是更好的选择。</li>
<li>如果需要分布式索引，则需要选择Elasticsearch。对于需要良好可伸缩性和性能的云和分布式环境，Elasticsearch是更好的选择。</li>
<li>两者都有良好的商业支持（咨询，生产支持，整合等）</li>
<li>两者都有很好的操作工具，尽管Elasticsearch因其易于使用的API而更多地吸引了DevOps人群，因此可以围绕它创建一个更加生动的工具生态系统。</li>
<li>Elasticsearch在开源日志管理用例中占据主导地位，许多组织在Elasticsearch中索引它们的日志以使其可搜索。虽然Solr现在也可以用于此目的，但它只是错过了这一想法。</li>
<li>Solr仍然更加面向文本搜索。另一方面，Elasticsearch 通常用于过滤和分组 - 分析查询工作负载 - 而不一定是文本搜索。Elasticsearch 开发人员在 Lucene 和 Elasticsearch 级别上投入了大量精力使此类查询更高效(降低内存占用和CPU使用)。因此，对于不仅需要进行文本搜索，而且需要复杂的搜索时间聚合的应用程序，Elasticsearch是一个更好的选择。</li>
<li>Elasticsearch更容易上手，一个下载和一个命令就可以启动一切。Solr传统上需要更多的工作和知识，但Solr最近在消除这一点上取得了巨大的进步，现在只需努力改变它的声誉。</li>
<li>在性能方面，它们大致相同。我说“大致”，因为没有人做过全面和无偏见的基准测试。对于95％的用例，任何一种选择在性能方面都会很好，剩下的5％需要用它们的特定数据和特定的访问模式来测试这两种解决方案。</li>
<li>从操作上讲，Elasticsearch使用起来比较简单 - 它只有一个进程。Solr在其类似Elasticsearch的完全分布式部署模式SolrCloud中依赖于Apache ZooKeeper。ZooKeeper是超级成熟，超级广泛使用等等，但它仍然是另一个活跃的部分。也就是说，如果您使用的是Hadoop，HBase，Spark，Kafka或其他一些较新的分布式软件，您可能已经在组织的某个地方运行ZooKeeper。</li>
<li>虽然Elasticsearch内置了类似ZooKeeper的组件Xen，但ZooKeeper可以更好地防止有时在Elasticsearch集群中出现的可怕的裂脑问题。公平地说，Elasticsearch开发人员已经意识到这个问题，并致力于改进Elasticsearch的这个方面。</li>
<li>如果您喜欢监控和指标，那么使用Elasticsearch，您将会进入天堂。这个东西比新年前夜在时代广场可以挤压的人有更多的指标！Solr暴露了关键指标，但远不及Elasticsearch那么多。</li>
</ul>
<h1 id="思维导图">思维导图<a hidden class="anchor" aria-hidden="true" href="#思维导图">#</a></h1>
<h2 id="全文搜索">全文搜索<a hidden class="anchor" aria-hidden="true" href="#全文搜索">#</a></h2>
<p><img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/full_text_search_overview.png"></p>
<h2 id="elastic基础">Elastic基础<a hidden class="anchor" aria-hidden="true" href="#elastic基础">#</a></h2>
<p><img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/elastic_basic.png"></p>
<p><a href="https://www.cnblogs.com/jajian/p/9801154.html">参考地址</a>
<a href="https://www.cnblogs.com/reycg-blog/p/10048815.html">参考地址</a></p>
<h1 id="solr-1">solr<a hidden class="anchor" aria-hidden="true" href="#solr-1">#</a></h1>
<p><a href="https://lucene.apache.org/solr/">solr官网</a>
下载最新的<code>Binary releases</code>，解压得到
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/1.png"></p>
<p>Solr的运行分为单机运行和集群运行，这里以单机为例。
进入到solr的bin目录执行命令：
<code>solr start</code>
提示<code>Started Solr server on port 8983 (pid=). Happy searching!</code>，说明启动成功。
然后在浏览器输入http://localhost:8983/solr 就会进入到solr的管理界面。
注意：一定要用windows的cmd启动，而且启动之后cmd窗口不能关闭，git的bash是不行的，虽然提示happy searching，但是无法访问web界面。
一些solr常用命令：
<code>solr start –p 端口号</code>：单机版启动solr服务
<code>solr restart –p 端口号</code>：重启solr服务
<code>solr stop –p 端口号</code>：关闭solr服务
<code>solr create –c name</code>：创建一个core实例(core概念后面介绍)
<a href="https://lucene.apache.org/solr/guide/7_4/solr-control-script-reference.html">更多命令参考官方文档</a></p>
<h2 id="创建core实例">创建core实例<a hidden class="anchor" aria-hidden="true" href="#创建core实例">#</a></h2>
<p>简单说core就是solr的一个实例，一个solr服务下可以有多个core，每个core下都有自己的索引库和与之相应的配置文件，所以在操作solr创建索引之前要创建一个core，因为索引都存在core下面。</p>
<ul>
<li>在bin目录下执行solr create –c name，创建一个core，默认创建出来的位置如下图
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/2.png"></li>
<li>第二种方式是直接使用AdminUI页面创建一个core，如下图
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/3.png">
创建的时候报错：
<code>Can't find resource 'solrconfig.xml' in classpath orc</code>
找到<code>solr-8.2.0/server/configsets/sample_techproducts_configs/conf</code>
把这个conf文件夹copy到新建的文件夹中。</li>
</ul>
<h2 id="配置schema">配置schema<a hidden class="anchor" aria-hidden="true" href="#配置schema">#</a></h2>
<h3 id="schema介绍">schema介绍<a hidden class="anchor" aria-hidden="true" href="#schema介绍">#</a></h3>
<p>schema是用来告诉solr如何建立索引的，他的配置围绕着一个schema配置文件，这个配置文件决定着solr如何建立索引，每个字段的数据类型，分词方式等，老版本的schema配置文件的名字叫做schema.xml他的配置方式就是手工编辑，但是现在新版本的schema配置文件的名字叫做managed-schema，他的配置方式不再是用手工编辑而是使用schemaAPI来配置，官方给出的解释是使用schemaAPI修改managed-schema内容后不需要重新加载core或者重启solr更适合在生产环境下维护，如果使用手工编辑的方式更改配置不进行重加载core有可能会造成配置丢失，配置文件所在的路径如下图：
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/4.png"></p>
<h3 id="schema主要成员">schema主要成员：<a hidden class="anchor" aria-hidden="true" href="#schema主要成员">#</a></h3>
<ul>
<li>fieldType：为field定义类型，最主要作用是定义分词器，分词器决定着如何从文档中检索关键字。</li>
<li>analyzer：他是fieldType下的子元素，这就是传说中的分词器，他由一组tokenizer和filter组成，如下图所示
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/5.png"></li>
<li>field：他是创建索引用的字段，如果想要这个字段生成索引需要配置他的indexed属性为true，stored属性为true表示存储该索引。如下所示每个field都要引用一种fieldType由type属性定义
<code>&lt;field name=&quot;description&quot; type=&quot;text_tr&quot; indexed=&quot;true&quot; stored=&quot;true&quot;&gt;</code>
这里描述的只是最常用的三个元素，<a href="http://lucene.apache.org/solr/guide/7_4/documents-fields-and-schema-design.html">关于更多schema的介绍请参考</a></li>
</ul>
<h3 id="schema-api">Schema API<a hidden class="anchor" aria-hidden="true" href="#schema-api">#</a></h3>
<p>Schema API其实就是用post请求向solr服务器发送携带json参数的请求，所有操作内容都封装在json中，如果是linux系统直接使用curl工具，如果是windows系统推荐使用Postman
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/6.png">
这里以添加一个field为例，下面列出其他API：
add-field: add a new field with parameters youprovide.
delete-field: delete a field.
replace-field: replace an existing field withone that is differently configured.
<a href="http://lucene.apache.org/solr/guide/7_4/schema-api.html">更多api请参考</a></p>
<h2 id="中文分词器">中文分词器<a hidden class="anchor" aria-hidden="true" href="#中文分词器">#</a></h2>
<p>分词，即文本分析，是指把整个文本分解成一系列单词的过程。比如说：北京大学 是一个词那么进行拆分可以得到：北京与大学，甚至北京大学整个词也是一个语义。
solr自带了一些中文分词器，比较好用的是SmartChineseAnalyzer，但是扩展性比较差不能自定义扩展中文词库，所以这里选择使用IKAnalyzer，这是第三方的一个分词器可以很好的扩展中文词库。
<a href="https://search.maven.org/search?q=com.github.magese">下载IKAnalyzer的jar包</a>
将下载好的jar包放入solr-7.4.0/server/solr-webapp/webapp/WEB-INF/lib目录中。</p>
<p>复制新项目的配置文件</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cd /usr/local/solr-7.4.0
</span></span><span style="display:flex;"><span>mkdir server/solr/ik
</span></span><span style="display:flex;"><span>cp -r server/solr/configsets/_default/conf  server/solr/ik/
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后到server/solr/ik/conf目录中打开managed-schema文件，增加如下代码</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;!-- ik分词器 --&gt;
</span></span><span style="display:flex;"><span>&lt;fieldType name=&#34;text_ik&#34; class=&#34;solr.TextField&#34;&gt;
</span></span><span style="display:flex;"><span>  &lt;analyzer type=&#34;index&#34;&gt;
</span></span><span style="display:flex;"><span>      &lt;tokenizer class=&#34;org.wltea.analyzer.lucene.IKTokenizerFactory&#34; useSmart=&#34;false&#34; conf=&#34;ik.conf&#34;/&gt;
</span></span><span style="display:flex;"><span>      &lt;filter class=&#34;solr.LowerCaseFilterFactory&#34;/&gt;
</span></span><span style="display:flex;"><span>  &lt;/analyzer&gt;
</span></span><span style="display:flex;"><span>  &lt;analyzer type=&#34;query&#34;&gt;
</span></span><span style="display:flex;"><span>      &lt;tokenizer class=&#34;org.wltea.analyzer.lucene.IKTokenizerFactory&#34; useSmart=&#34;true&#34; conf=&#34;ik.conf&#34;/&gt;
</span></span><span style="display:flex;"><span>      &lt;filter class=&#34;solr.LowerCaseFilterFactory&#34;/&gt;
</span></span><span style="display:flex;"><span>  &lt;/analyzer&gt;
</span></span><span style="display:flex;"><span>&lt;/fieldType&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>定义了一个text_ik这个字段类型并采用Ik分词器，接下来在field元素定义式指定type=text_ik就可以把这个分词器应用在这个field中。</p>
<p>重启solr
<code>bin/solr restart -force</code>
新增core：ik，或是在旧的core的manage-schema中增加上边的配置。</p>
<h3 id="solr7自带分词中文分词器">solr7自带分词中文分词器<a hidden class="anchor" aria-hidden="true" href="#solr7自带分词中文分词器">#</a></h3>
<p>复制jar包
<code> cp contrib/analysis-extras/lucene-libs/lucene-analyzers-smartcn-7.4.0.jar  server/solr-webapp/webapp/WEB-INF/lib</code>
复制新项目的配置文件</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cd /root/tar/solr-7.4.0
</span></span><span style="display:flex;"><span>mkdir server/solr/test
</span></span><span style="display:flex;"><span>cp -r server/solr/configsets/_default/conf  server/solr/test/
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后到server/solr/test/conf目录中打开managed-schema文件，增加如下代码</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;fieldType name=&#34;text_hmm_chinese&#34; class=&#34;solr.TextField&#34; positionIncrementGap=&#34;100&#34;&gt;
</span></span><span style="display:flex;"><span>	&lt;analyzer type=&#34;index&#34;&gt;
</span></span><span style="display:flex;"><span>		&lt;tokenizer class=&#34;org.apache.lucene.analysis.cn.smart.HMMChineseTokenizerFactory&#34;/&gt;
</span></span><span style="display:flex;"><span>	&lt;/analyzer&gt;
</span></span><span style="display:flex;"><span>	&lt;analyzer type=&#34;query&#34;&gt;
</span></span><span style="display:flex;"><span>		&lt;tokenizer class=&#34;org.apache.lucene.analysis.cn.smart.HMMChineseTokenizerFactory&#34;/&gt;
</span></span><span style="display:flex;"><span>	&lt;/analyzer&gt;
</span></span><span style="display:flex;"><span>&lt;/fieldType&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>定义了一个text_hmm_chinese这个字段类型并采用自带中文分词器，接下来在field元素定义式指定type=text_hmm_chinese就可以把这个分词器应用在这个field中。</p>
<p>重启solr
<code>bin/solr restart -force</code>
新增一个core：test</p>
<p>对比两个分词的效果
IK分词器
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/a1.png"></p>
<p>自带分词器
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/a2.png"></p>
<p>我感觉IK的语义分析更好些。
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/12.png"></p>
<p><a href="https://blog.csdn.net/guyan0319/article/details/81188977">参考</a></p>
<h2 id="dih导入索引数据">DIH导入索引数据<a hidden class="anchor" aria-hidden="true" href="#dih导入索引数据">#</a></h2>
<p>DIH全称是Data Import Handler 数据导入处理器，顾名思义这是向solr中导入数据的，我们的solr目的就是为了能让我们的应用程序更快的查询出用户想要的数据，而数据存储在应用中的各种地方如：xml、pdf、关系数据库中，那么solr首先就要能够获取这些数据并在这些数据中建立索引来达成快速搜索的目的，这里就列举我们最常用的从关系型数据库中向solr导入索引数据。</p>
<p>在我们自己建立的core的目录下有conf目录，这里面有着几个很重要的配置文件，之前我们用到的managed-schema(老版本是schema.xml)也在其中，另外还有一个solrconfig.xml文件，这是我们DIH配置的第一步，需要在此文件中配置数据导入文件的映射位置如下图：
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/13.png">
第二步配置数据导入文件，这个文件可以在solr根目录下的示例文件中copy一份到core/conf目录下，也就是跟solrconfig.xml在一个目录下，因为solrconfig.xml中配置的相对路径就是这里，当然也可以写绝对路径。如下图：
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/14.png">
Copy过去之后这个文件名可以自定义，我就改成了MyDataConfig.xml，下面开始配置如下图：
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/15.png"></p>
<ul>
<li>首先配置数据源关系型数据库基本四项，驱动类，url，用户名，密码。</li>
<li>配置document，可以把它当作与mysql中数据库一个层级的对象。</li>
<li>配置entity，可以把它当作与数据库中一个表对应，在query中书写查询sql。</li>
<li>配置field与表中的字段与之对应。
注意这里容易与schema中的配置混淆，我的理解是schema中配置的是创建索引的配置，而索引的创建需要有数据基础，而现在讲的数据导入文件就是建立索引的数据基础，他是创建索引的元数据。现在配置文件完成后可以用DIH命令执行了。</li>
</ul>
<h3 id="dih-命令">DIH 命令<a hidden class="anchor" aria-hidden="true" href="#dih-命令">#</a></h3>
<p>DIH命令就是用来执行数据导入的，命令种类繁多这里只列出简单常用。DIH命令采用的方式是URL的方式。
full-import：全部数据导入例如：
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/16.png"></p>
<p>接下来验证下数据是否真的导入成功了，如下图
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/17.png">
fq:过滤的字段，df：默认查询字段，start，rows：分页配置，sort：排序，<a href="http://lucene.apache.org/solr/guide/7_4/searching.html">更多关于查询语句的介绍请参考</a></p>
<h2 id="solrjjava客户端">solrJ(java客户端)<a hidden class="anchor" aria-hidden="true" href="#solrjjava客户端">#</a></h2>
<p>solrJ是java访问solr的客户端工具包，solr也提供了其他语言访问的客户端，可以到官方文档查看，现在solr的索引和数据导入都已经有，但是作为项目中应用的一个组件，少不了java与solr的沟通。</p>
<p>导入solrJ依赖</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;dependency&gt;
</span></span><span style="display:flex;"><span>	&lt;groupId&gt;org.apache.solr&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>	&lt;artifactId&gt;solr-solrj&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>	&lt;version&gt;7.4.0&lt;/version&gt;
</span></span><span style="display:flex;"><span>&lt;/dependency&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>从solr中查询索引
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/18.png"></p>
<p>向solr添加更改索引，java实体对象与solr索引映射
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/19.png"></p>
<p>向solr添加或更新索引，如果此实体在solr索引库中已有则作为更新操作
<img loading="lazy" src="/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/20.png">
<a href="https://blog.csdn.net/u010510107/article/details/81051795">参考地址</a></p>
<p>如果是springb boot项目，只需要导入starter即可。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;dependency&gt;
</span></span><span style="display:flex;"><span>	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>	&lt;artifactId&gt;spring-boot-starter-data-solr&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>&lt;/dependency&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在配置文件<code>application.properties</code>中加入如下配置：
<code>spring.data.solr.host=http://localhost:8983/solr/new_core</code>
路径<code>solr/</code>后面的内容，是新建的core的名字。这里可以理解为数据库的概念。在操作的时，如果有多个core，可以切换数据库，也就是切换 core。</p>
<h2 id="solr加上baseauth安全认证后使用solrj查询数据和添加索引">solr加上baseAuth安全认证后，使用solrj查询数据和添加索引<a hidden class="anchor" aria-hidden="true" href="#solr加上baseauth安全认证后使用solrj查询数据和添加索引">#</a></h2>
<p>在SolrJ中使用BasicAuth
在SolrJ中，需要为每个请求设置基本的身份验证凭证，如下例所示：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//create a new request object </span>
</span></span><span style="display:flex;"><span>SolrRequest req ;
</span></span><span style="display:flex;"><span>req.<span style="color:#007f7f">setBasicAuthCredentials</span>(userName, password); solrClient.<span style="color:#007f7f">request</span>(req);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Query example:
</span></span><span style="display:flex;"><span>QueryRequest req = <span style="color:#fff;font-weight:bold">new</span> QueryRequest(<span style="color:#fff;font-weight:bold">new</span> SolrQuery(<span style="color:#0ff;font-weight:bold">&#34;*:*&#34;</span>));
</span></span><span style="display:flex;"><span>req.<span style="color:#007f7f">setBasicAuthCredentials</span>(userName, password); 
</span></span><span style="display:flex;"><span>QueryResponse rsp = req.<span style="color:#007f7f">process</span>(solrClient);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="solr操作">solr操作<a hidden class="anchor" aria-hidden="true" href="#solr操作">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span>@RequestMapping(<span style="color:#0ff;font-weight:bold">&#34;solr&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SolrController {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> SolrClient client;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 新增/修改 索引
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 当id存在的时候, 此方法是修改
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    @RequestMapping(<span style="color:#0ff;font-weight:bold">&#34;add&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String add() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            SolrInputDocument doc = <span style="color:#fff;font-weight:bold">new</span> SolrInputDocument();
</span></span><span style="display:flex;"><span>            doc.<span style="color:#007f7f">setField</span>(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>, uuid);
</span></span><span style="display:flex;"><span>            doc.<span style="color:#007f7f">setField</span>(<span style="color:#0ff;font-weight:bold">&#34;content_ik&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;我是中国人, 我爱中国&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//如果spring.data.solr.host 里面配置core了, 那么这里就不需要传 collection1 这个参数</span>
</span></span><span style="display:flex;"><span>            client.<span style="color:#007f7f">add</span>(<span style="color:#0ff;font-weight:bold">&#34;collection1&#34;</span>, doc);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//client.commit();</span>
</span></span><span style="display:flex;"><span>            client.<span style="color:#007f7f">commit</span>(<span style="color:#0ff;font-weight:bold">&#34;collection1&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> 1;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;error&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 根据id删除索引
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    @RequestMapping(<span style="color:#0ff;font-weight:bold">&#34;delete&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String delete(String id)  {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            client.<span style="color:#007f7f">deleteById</span>(<span style="color:#0ff;font-weight:bold">&#34;collection1&#34;</span>,id);
</span></span><span style="display:flex;"><span>            client.<span style="color:#007f7f">commit</span>(<span style="color:#0ff;font-weight:bold">&#34;collection1&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> id;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;error&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 删除所有的索引
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    @RequestMapping(<span style="color:#0ff;font-weight:bold">&#34;deleteAll&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String deleteAll(){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            client.<span style="color:#007f7f">deleteByQuery</span>(<span style="color:#0ff;font-weight:bold">&#34;collection1&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;*:*&#34;</span>);
</span></span><span style="display:flex;"><span>            client.<span style="color:#007f7f">commit</span>(<span style="color:#0ff;font-weight:bold">&#34;collection1&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;error&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 根据id查询索引
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @throws Exception
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    @RequestMapping(<span style="color:#0ff;font-weight:bold">&#34;getById&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getById() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        SolrDocument document = client.<span style="color:#007f7f">getById</span>(<span style="color:#0ff;font-weight:bold">&#34;collection1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;536563&#34;</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(document);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> document.<span style="color:#007f7f">toString</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 综合查询: 在综合查询中, 有按条件查询, 条件过滤, 排序, 分页, 高亮显示, 获取部分域信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    @RequestMapping(<span style="color:#0ff;font-weight:bold">&#34;search&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; search(){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            SolrQuery params = <span style="color:#fff;font-weight:bold">new</span> SolrQuery();
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//查询条件, 这里的 q 对应 下面图片标红的地方</span>
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;q&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;手机&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//过滤条件</span>
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;fq&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;product_price:[100 TO 100000]&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//排序</span>
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">addSort</span>(<span style="color:#0ff;font-weight:bold">&#34;product_price&#34;</span>, SolrQuery.<span style="color:#007f7f">ORDER</span>.<span style="color:#007f7f">asc</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//分页</span>
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">setStart</span>(0);
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">setRows</span>(20);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//默认域</span>
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;df&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;product_title&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//只查询指定域</span>
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;fl&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;id,product_title,product_price&#34;</span>);
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//高亮</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//打开开关</span>
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">setHighlight</span>(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//指定高亮域</span>
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">addHighlightField</span>(<span style="color:#0ff;font-weight:bold">&#34;product_title&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//设置前缀</span>
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">setHighlightSimplePre</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;span style=&#39;color:red&#39;&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//设置后缀</span>
</span></span><span style="display:flex;"><span>            params.<span style="color:#007f7f">setHighlightSimplePost</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;/span&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//执行查询</span>
</span></span><span style="display:flex;"><span>            QueryResponse queryResponse = client.<span style="color:#007f7f">query</span>(params);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//获取查询结果</span>
</span></span><span style="display:flex;"><span>            SolrDocumentList results = queryResponse.<span style="color:#007f7f">getResults</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//结果条数</span>
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(results.<span style="color:#007f7f">getNumFound</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>　　　　　　<span style="color:#007f7f">//获取高亮显示的结果, 高亮显示的结果和查询结果是分开放的</span>
</span></span><span style="display:flex;"><span>            Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; highlight = queryResponse.<span style="color:#007f7f">getHighlighting</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (SolrDocument result : results) {
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>));
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;product_title&#34;</span>));
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//System.out.println(result.get(&#34;product_num&#34;));</span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;product_price&#34;</span>));
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//System.out.println(result.get(&#34;product_image&#34;));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                Map&lt;String, List&lt;String&gt;&gt; map = highlight.<span style="color:#007f7f">get</span>(result.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>));
</span></span><span style="display:flex;"><span>                List&lt;String&gt; list = map.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;product_title&#34;</span>);
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(list.<span style="color:#007f7f">get</span>(0));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;------------------&#34;</span>);
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> highlight;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://blog.csdn.net/ryuenkyo/article/details/81061144">高亮查询参考</a>
<a href="https://www.cnblogs.com/chinaifae/articles/10218885.html">高亮查询</a></p>
<p>新增索引时发现报错：
<code>solr Expected mime type application/octet-stream but got text/html</code>
解决：
在代码中，重复指定了core
<code>client.commit(&quot;test_core&quot;);</code>
commit中就不要带参数了。</p>
<p><a href="https://www.cnblogs.com/elvinle/p/8149256.html">参考一</a>
<a href="https://www.jianshu.com/p/05a161add1a6">参考二</a>
<a href="https://blog.csdn.net/qixiang_chen/article/details/82562410">参考三</a></p>
<h3 id="solr查询参数">solr查询参数<a hidden class="anchor" aria-hidden="true" href="#solr查询参数">#</a></h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>q</td>
<td>查询的关键字，此参数最为重要，例如，q=id:1，默认为q=:，</td>
</tr>
<tr>
<td>fl</td>
<td>指定返回哪些字段，用逗号或空格分隔，注意：字段区分大小写，例如，fl= id,title,sort</td>
</tr>
<tr>
<td>start</td>
<td>返回结果的第几条记录开始，一般分页用，默认0开始</td>
</tr>
<tr>
<td>rows</td>
<td>指定返回结果最多有多少条记录，默认值为 10，配合start实现分页</td>
</tr>
<tr>
<td>sort</td>
<td>排序方式，例如id desc 表示按照 “id” 降序</td>
</tr>
<tr>
<td>wt</td>
<td>(writer type)指定输出格式，有 xml, json, php等</td>
</tr>
<tr>
<td>fq</td>
<td>（filter query）过虑查询，提供一个可选的筛选器查询。返回在q查询符合结果中同时符合的fq条件的查询结果，例如：q=id:1&amp;fq=sort:[1 TO 5]，找关键字id为1 的，并且sort是1到5之间的。</td>
</tr>
<tr>
<td>df</td>
<td>默认的查询字段，一般默认指定。</td>
</tr>
<tr>
<td>qt</td>
<td>（query type）指定那个类型来处理查询请求，一般不用指定，默认是standard。</td>
</tr>
<tr>
<td>indent</td>
<td>返回的结果是否缩进，默认关闭，用 indent=true</td>
</tr>
<tr>
<td>version</td>
<td>查询语法的版本，建议不使用它，由服务器指定默认值。</td>
</tr>
</tbody>
</table>
<p><a href="https://www.cnblogs.com/cuihongyu3503319/p/9875628.html">参考</a>
<a href="https://blog.csdn.net/zuihongyan518/article/details/90060175">参考</a>
<a href="https://www.cnblogs.com/zhangweizhong/p/5056884.html">参考</a></p>
<h4 id="多条件查询">多条件查询<a hidden class="anchor" aria-hidden="true" href="#多条件查询">#</a></h4>
<p><strong>请求参数：</strong></p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>必选</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>pageNum</td>
<td>是</td>
<td>string</td>
<td>页码</td>
</tr>
<tr>
<td>pageSize</td>
<td>是</td>
<td>string</td>
<td>步长</td>
</tr>
<tr>
<td>params</td>
<td>是</td>
<td>string</td>
<td>条件字符串</td>
</tr>
</tbody>
</table>
<p>params拼接格式：
<code>字段1：值 AND 字段2：值 AND 字段3：值</code>
<strong>AND必须大写</strong>，且前后要有空格</p>
<p>如果需要模糊查询，需要在<code>值</code>的两端拼上<code>*</code>，示例：
<code>title:*测试*</code></p>
<p>每新增一个条件在后边拼接一个参数即可。</p>
<p>后台service实现类代码：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @author: wjy
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @description: 综合查询
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> Map&lt;String, Object&gt; solrQuery(Map&lt;String,String&gt; paramMap) {
</span></span><span style="display:flex;"><span>	Map&lt;String,Object&gt; resultMap = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//创建查询对象</span>
</span></span><span style="display:flex;"><span>		SolrQuery q = <span style="color:#fff;font-weight:bold">new</span> SolrQuery();
</span></span><span style="display:flex;"><span>		q.<span style="color:#007f7f">setQuery</span>(paramMap.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;params&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//设置分页</span>
</span></span><span style="display:flex;"><span>		q.<span style="color:#007f7f">setStart</span>(paramMap.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;pageNum&#34;</span>) == <span style="color:#fff;font-weight:bold">null</span> ? 0 : Integer.<span style="color:#007f7f">parseInt</span>(paramMap.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;pageNum&#34;</span>)));
</span></span><span style="display:flex;"><span>		q.<span style="color:#007f7f">setRows</span>(paramMap.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;pageSize&#34;</span>) == <span style="color:#fff;font-weight:bold">null</span> ? 10 : Integer.<span style="color:#007f7f">parseInt</span>(paramMap.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;pageSize&#34;</span>)));
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//执行查询</span>
</span></span><span style="display:flex;"><span>		QueryResponse queryResponse = client.<span style="color:#007f7f">query</span>(q);
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//取查询结果</span>
</span></span><span style="display:flex;"><span>		SolrDocumentList solrDocumentList = queryResponse.<span style="color:#007f7f">getResults</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//转换成对象</span>
</span></span><span style="display:flex;"><span>		resultMap.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;data&#34;</span>, SolrUtil.<span style="color:#007f7f">getBeans</span>(Archive.<span style="color:#007f7f">class</span>, solrDocumentList));
</span></span><span style="display:flex;"><span>	} <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>		e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> resultMap;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="solr删除数据">solr删除数据<a hidden class="anchor" aria-hidden="true" href="#solr删除数据">#</a></h3>
<p>solr的web页面删除
左侧列表选择你的索引库，选择<code>Documents</code>，<code>Document Type</code>选择xml，在下面输入</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;
</span></span><span style="display:flex;"><span>&lt;commit/&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="solr设置密码后代码访问solr">solr设置密码后代码访问solr<a hidden class="anchor" aria-hidden="true" href="#solr设置密码后代码访问solr">#</a></h3>
<p>url 格式修改成下边这种：
<code>http://test:admin123@localhost:8983/solr/my_core</code></p>
<p>引入必备依赖：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;!-- https://mvnrepository.com/artifact/commons-codec/commons-codec --&gt;
</span></span><span style="display:flex;"><span>&lt;dependency&gt; 
</span></span><span style="display:flex;"><span>  &lt;groupId&gt;commons-codec&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>  &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>  &lt;version&gt;1.7&lt;/version&gt;
</span></span><span style="display:flex;"><span>&lt;/dependency&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://blog.csdn.net/lbf5210/article/details/51207043">参考</a></p>
<h3 id="solr报错">solr报错<a hidden class="anchor" aria-hidden="true" href="#solr报错">#</a></h3>
<p><code>Exception writing document id 7 to the index; possible analysis error: cannot change DocValues type from SORTED_NUMERIC to SORTED for field &quot;archive_no&quot;</code>
solr新增或者修改字段的类型后出现该异常, 可以通过以下两种方法解决。</p>
<ul>
<li>reload对应的core
solr的控制台左侧列表<code>Core Admin</code>，找到你的core，点击右侧的<code>Reload</code></li>
<li>若第一种方法不行, 则需要清空当前core的所有数据</li>
</ul>
<h3 id="solr查出的数据不匹配">solr查出的数据不匹配<a hidden class="anchor" aria-hidden="true" href="#solr查出的数据不匹配">#</a></h3>
<p>如我查
<code>title:测试</code>
把和测试完全不相干的数据也查出来了。
这时需要在索引词的两端加上<code>&quot;&quot;</code>双引号即可。</p>
<h3 id="solr关键字匹配问题">solr关键字匹配问题<a hidden class="anchor" aria-hidden="true" href="#solr关键字匹配问题">#</a></h3>
<p><a href="https://segmentfault.com/q/1010000012584778">参考</a></p>
<h3 id="facet结果分组">facet结果分组<a hidden class="anchor" aria-hidden="true" href="#facet结果分组">#</a></h3>
<p>在solr控制台(web页面)找到
<code>Raw Query Parameters</code>
在下面填入：
<code>facet=true&amp;facet.field=category_name</code></p>
<p>需要注意，被匹配的字段在solr的配置文件<code>managed-schema</code>中，必须是<code>string</code>类型，不能是<code>text_general</code>类型，否则如果该字段有中文的话，他会把中文的每个字都按一组划分。
更改字段类型后，需要</p>
<ol>
<li>重启solr</li>
<li>将数据全部删除</li>
<li>在solr控制台reload你的core</li>
</ol>
<h3 id="id相同数据覆盖问题">id相同数据覆盖问题<a hidden class="anchor" aria-hidden="true" href="#id相同数据覆盖问题">#</a></h3>
<p>由于之前大意没有配置UUID出现ID覆盖问题导致每个ID只能显示一个 重复的ID数据只有一个</p>
<p>修改managed-schema配置
<code>vim managed-schema</code></p>
<p>添加UUID fieldType
<code>&lt;fieldType name=&quot;uuid&quot; class=&quot;solr.UUIDField&quot; indexed=&quot;true&quot;/&gt;</code></p>
<p>然后找到field为id，修改id的type为uuid</p>
<p>修改后发现solr控制台报错
<code>_root_ field must be defined using the exact same fieldType as the uniqueKey field (id) uses: uuid</code></p>
<p>发现<code>_root_</code>这个字段的类型是string，遂将改字段的type修改为和id相同的类型<code>uuid</code></p>
<p>因为数据库里的数据也叫id，遂给id起个别名，dataId，就可以保证不同表的数据都能存入solr了。</p>
<h3 id="使用实体类返回solr数据">使用实体类返回solr数据<a hidden class="anchor" aria-hidden="true" href="#使用实体类返回solr数据">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.archive.util;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.lang.reflect.Field;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.ArrayList;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.List;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.commons.beanutils.BeanUtils;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.solr.common.SolrDocument;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.solr.common.SolrDocumentList;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @author: wjy
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Date: Create in 12:26 2019/11/3
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @description :
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SolrUtil {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> &lt;T&gt; List&lt;T&gt; getBeans(Class&lt;T&gt; clazz,
</span></span><span style="display:flex;"><span>                                             SolrDocumentList solrDocumentList) <span style="color:#fff;font-weight:bold">throws</span> Exception{
</span></span><span style="display:flex;"><span>        List&lt;T&gt; list = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;T&gt;();
</span></span><span style="display:flex;"><span>        T t = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (SolrDocument solrDocument : solrDocumentList)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//反射出实例</span>
</span></span><span style="display:flex;"><span>            t = clazz.<span style="color:#007f7f">newInstance</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//获取所有属性</span>
</span></span><span style="display:flex;"><span>            Field[] fields = clazz.<span style="color:#007f7f">getDeclaredFields</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (Field field : fields)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                Object val = solrDocument.<span style="color:#007f7f">get</span>(field.<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span>(val != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    String val2 = val.<span style="color:#007f7f">toString</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">if</span>(val2.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;[&#34;</span>) &amp;&amp; val2.<span style="color:#007f7f">endsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;]&#34;</span>))
</span></span><span style="display:flex;"><span>                        val2 = val2.<span style="color:#007f7f">substring</span>(1,val2.<span style="color:#007f7f">length</span>()-1);
</span></span><span style="display:flex;"><span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(field.<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;,&#34;</span>+val2);
</span></span><span style="display:flex;"><span>                    BeanUtils.<span style="color:#007f7f">setProperty</span>(t, field.<span style="color:#007f7f">getName</span>(), val2);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            list.<span style="color:#007f7f">add</span>(t);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> list;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> &lt;T&gt; T getBean(Class&lt;T&gt; clazz,
</span></span><span style="display:flex;"><span>                                      SolrDocument solrDocument) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//反射出实例</span>
</span></span><span style="display:flex;"><span>        T t = clazz.<span style="color:#007f7f">newInstance</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//获取所有属性</span>
</span></span><span style="display:flex;"><span>        Field[] fields = clazz.<span style="color:#007f7f">getDeclaredFields</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (Field field : fields) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 如果注解为默认的 采用此属性的name来从solr中获取值</span>
</span></span><span style="display:flex;"><span>            BeanUtils.<span style="color:#007f7f">setProperty</span>(t, field.<span style="color:#007f7f">getName</span>(), solrDocument.<span style="color:#007f7f">get</span>(field.<span style="color:#007f7f">getName</span>()));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>调用方法
<code>resultMap.put(&quot;data&quot;, SolrUtil.getBeans(SolrDto.class, solrDocumentList));</code></p>
<p>需要注意，实体类字段名必须和solr里存的字段名一致。
如：实体类中是<code>pageNo</code>，solr里也要是<code>pageNo</code>，
实体类中是<code>page_no</code>，solr里也要是<code>page_no</code>，否则会映射不上。</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
