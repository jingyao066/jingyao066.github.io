<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>å¸¸è§ Java ä»£ç ç¼ºé™·åŠè§„é¿æ–¹å¼ | Wjy&#39;s Blog</title>
<meta name="keywords" content="java">
<meta name="description" content="ç©ºæŒ‡é’ˆå¼‚å¸¸ ä½¿ç”¨ JSR-305/jetbrain ç­‰æ³¨è§£ NotNull Nullable 1 2 3 4 @Nullable public static String getString(){ return null; } é€šè¿‡åœ¨æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€å­—æ®µç­‰ä½ç½®æ˜¾å¼æ ‡è®°å€¼æ˜¯å¦å¯èƒ½ä¸º Nullï¼Œé…åˆä»£ç æ£€æŸ¥å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ç¼–">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://funny-toffee-4aa7c3.netlify.app/posts/java/%E5%B8%B8%E8%A7%81-java-%E4%BB%A3%E7%A0%81%E7%BC%BA%E9%99%B7%E5%8F%8A%E8%A7%84%E9%81%BF%E6%96%B9%E5%BC%8F/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://funny-toffee-4aa7c3.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://funny-toffee-4aa7c3.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://funny-toffee-4aa7c3.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://funny-toffee-4aa7c3.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://funny-toffee-4aa7c3.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="å¸¸è§ Java ä»£ç ç¼ºé™·åŠè§„é¿æ–¹å¼" />
<meta property="og:description" content="ç©ºæŒ‡é’ˆå¼‚å¸¸ ä½¿ç”¨ JSR-305/jetbrain ç­‰æ³¨è§£ NotNull Nullable 1 2 3 4 @Nullable public static String getString(){ return null; } é€šè¿‡åœ¨æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€å­—æ®µç­‰ä½ç½®æ˜¾å¼æ ‡è®°å€¼æ˜¯å¦å¯èƒ½ä¸º Nullï¼Œé…åˆä»£ç æ£€æŸ¥å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ç¼–" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://funny-toffee-4aa7c3.netlify.app/posts/java/%E5%B8%B8%E8%A7%81-java-%E4%BB%A3%E7%A0%81%E7%BC%BA%E9%99%B7%E5%8F%8A%E8%A7%84%E9%81%BF%E6%96%B9%E5%BC%8F/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-09T17:36:57+00:00" />
<meta property="article:modified_time" content="2020-10-09T17:36:57+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="å¸¸è§ Java ä»£ç ç¼ºé™·åŠè§„é¿æ–¹å¼"/>
<meta name="twitter:description" content="ç©ºæŒ‡é’ˆå¼‚å¸¸ ä½¿ç”¨ JSR-305/jetbrain ç­‰æ³¨è§£ NotNull Nullable 1 2 3 4 @Nullable public static String getString(){ return null; } é€šè¿‡åœ¨æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€å­—æ®µç­‰ä½ç½®æ˜¾å¼æ ‡è®°å€¼æ˜¯å¦å¯èƒ½ä¸º Nullï¼Œé…åˆä»£ç æ£€æŸ¥å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ç¼–"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "å¸¸è§ Java ä»£ç ç¼ºé™·åŠè§„é¿æ–¹å¼",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/java/%E5%B8%B8%E8%A7%81-java-%E4%BB%A3%E7%A0%81%E7%BC%BA%E9%99%B7%E5%8F%8A%E8%A7%84%E9%81%BF%E6%96%B9%E5%BC%8F/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "å¸¸è§ Java ä»£ç ç¼ºé™·åŠè§„é¿æ–¹å¼",
  "name": "å¸¸è§ Java ä»£ç ç¼ºé™·åŠè§„é¿æ–¹å¼",
  "description": "ç©ºæŒ‡é’ˆå¼‚å¸¸ ä½¿ç”¨ JSR-305/jetbrain ç­‰æ³¨è§£ NotNull Nullable 1 2 3 4 @Nullable public static String getString(){ return null; } é€šè¿‡åœ¨æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€å­—æ®µç­‰ä½ç½®æ˜¾å¼æ ‡è®°å€¼æ˜¯å¦å¯èƒ½ä¸º Nullï¼Œé…åˆä»£ç æ£€æŸ¥å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ç¼–",
  "keywords": [
    "java"
  ],
  "articleBody": "ç©ºæŒ‡é’ˆå¼‚å¸¸ ä½¿ç”¨ JSR-305/jetbrain ç­‰æ³¨è§£ NotNull Nullable 1 2 3 4 @Nullable public static String getString(){ return null; } é€šè¿‡åœ¨æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€å­—æ®µç­‰ä½ç½®æ˜¾å¼æ ‡è®°å€¼æ˜¯å¦å¯èƒ½ä¸º Nullï¼Œé…åˆä»£ç æ£€æŸ¥å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ç¼–ç é˜¶æ®µè§„é¿ç»å¤§éƒ¨åˆ†çš„ NPE é—®é¢˜ï¼Œå»ºè®®è‡³å°‘åœ¨å¸¸ç”¨æ–¹æ³•æˆ–è€…å¯¹å¤– API ä¸­ä½¿ç”¨è¯¥æ³¨è§£ï¼Œèƒ½å¤Ÿå¯¹è°ƒç”¨æ–¹æä¾›æ˜¾è‘—çš„å¸®åŠ©ã€‚\nç”¨ Optional å¤„ç†é“¾å¼è°ƒç”¨ Optional æºäº Guava ä¸­çš„ Optional ç±»ï¼Œå Java 8 å†…ç½®åˆ° JDK ä¸­ã€‚Optional ä¸€èˆ¬ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼Œå¼ºåˆ¶æé†’è°ƒç”¨è€…è¿”å›å€¼å¯èƒ½ä¸å­˜åœ¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡é“¾å¼è°ƒç”¨ä¼˜é›…çš„å¤„ç†ç©ºå€¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 public class OptionalExample { public static void main(String[] args) { // ä½¿ç”¨ä¼ ç»Ÿç©ºå€¼å¤„ç†æ–¹å¼ User user = getUser(); String city = \"DEFAULT\"; if (user != null \u0026\u0026 user.isValid()) { Address address = user.getAddress(); if (adress != null) { city = adress.getCity(); } } System.out.println(city); // ä½¿ç”¨ Optional çš„æ–¹å¼ Optional optional = getUserOptional(); city = optional.filter(User::isValid) .map(User::getAddress) .map(Adress::getCity) .orElse(\"DEFAULT\") System.out.println(city); } @Nullable public static User getUser() { return null; } public static Optional getUserOptional() { return Optional.empty(); } @Data public static class User { private Adress address; private boolean valid; } @Data public static class Address { private String city; } } ç”¨ Objects.equals(a,b) ä»£æ›¿ a.equals(b) equalsæ–¹æ³•æ˜¯ NPE çš„é«˜å‘åœ°ç‚¹ï¼Œç”¨ Objects.euqalsæ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼Œèƒ½å¤Ÿé¿å…ä»»æ„å¯¹è±¡ä¸º null æ—¶çš„ NPEã€‚\nä½¿ç”¨ç©ºå¯¹è±¡æ¨¡å¼ ç©ºå¯¹åƒæ¨¡å¼é€šè¿‡ä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ä»£æ›¿ä¸å­˜åœ¨çš„æƒ…å†µï¼Œä»£è¡¨å¯¹è±¡ä¸å­˜åœ¨æ—¶çš„é»˜è®¤è¡Œä¸ºæ¨¡å¼ã€‚å¸¸è§ä¾‹å­ï¼š\nç”¨ Empty List ä»£æ›¿ nullï¼ŒEmptyList èƒ½å¤Ÿæ­£å¸¸éå†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 public class EmptyListExample { public static void main(String[] args) { List listNullable = getListNullable(); if (listNullable != null) { for (String s : listNullable) { System.out.println(s); } } List listNotNull = getListNotNull(); for (String s : listNotNull) { System.out.println(s); } } @Nullable public static List getListNullable() { return null; } @NotNull public static List getListNotNull() { return Collections.emptyList(); } } ç©ºç­–ç•¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 public class NullStrategyExample { private static final Map strategyMap = new HashMap\u003c\u003e(); public static void handle(String strategy, String content) { findStrategy(strategy).handle(content); } @NotNull private static Strategy findStrategy(String strategyKey) { return strategyMap.getOrDefault(strategyKey, new DoNothing()); } public interface Strategy { void handle(String s); } // å½“æ‰¾ä¸åˆ°å¯¹åº”ç­–ç•¥æ—¶, ä»€ä¹ˆä¹Ÿä¸åš public static class DoNothing implements Strategy { @Override public void handle(String s) { } } } å¯¹è±¡è½¬åŒ– åœ¨ä¸šåŠ¡åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬çš„ä»£ç ç»“æ„å¾€å¾€æ˜¯å¤šå±‚æ¬¡çš„ï¼Œä¸åŒå±‚æ¬¡ä¹‹é—´ç»å¸¸æ¶‰åŠåˆ°å¯¹è±¡çš„è½¬åŒ–ï¼Œè™½ç„¶å¾ˆç®€å•ï¼Œä½†å®é™…ä¸Šç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // åä¾‹ 1ï¼š public class UserConverter { public static UserDTO toDTO(UserDO userDO) { UserDTO userDTO = new UserDTO(); userDTO.setAge(userDO.getAge()); // é—®é¢˜ 1: è‡ªå·±èµ‹å€¼ç»™è‡ªå·± userDTO.setName(userDTO.getName()); return userDTO; } @Data public static class UserDO { private String name; private Integer age; // é—®é¢˜ 2: æ–°å¢å­—æ®µæœªèµ‹å€¼ private String address; } @Data public static class UserDTO { private String name; private Integer age; } } // åä¾‹2ï¼š public class UserBeanCopyConvert { public UserDTO toDTO(UserDO userDO) { UserDTO userDTO = new UserDTO(); // ç”¨åå°„å¤åˆ¶ä¸åŒç±»å‹å¯¹è±¡. // 1. é‡æ„ä¸å‹å¥½, å½“æˆ‘è¦åˆ é™¤æˆ–ä¿®æ”¹ UserDO çš„å­—æ®µæ—¶, æ— æ³•å¾—çŸ¥è¯¥å­—æ®µæ˜¯å¦é€šè¿‡åå°„è¢«å…¶ä»–å­—æ®µä¾èµ– BeanUtils.copyProperties(userDO, userDTO); return userDTO; } } ä½¿ç”¨ Mapstruct Mapstruct ä½¿ç”¨ç¼–è¯‘æœŸä»£ç ç”ŸæˆæŠ€æœ¯ï¼Œæ ¹æ®æ³¨è§£, å…¥å‚ï¼Œå‡ºå‚è‡ªåŠ¨ç”Ÿæˆè½¬åŒ–ï¼Œä»£ç ï¼Œå¹¶ä¸”æ”¯æŒå„ç§é«˜çº§ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼š\næœªæ˜ å°„å­—æ®µçš„å¤„ç†ç­–ç•¥ï¼Œåœ¨ç¼–è¯‘æœŸå‘ç°æ˜ å°„é—®é¢˜ å¤ç”¨å·¥å…·ï¼Œæ–¹ä¾¿å­—æ®µç±»å‹è½¬åŒ– ç”Ÿæˆ spring Component æ³¨è§£ï¼Œé€šè¿‡ spring ç®¡ç† ç­‰ç­‰å…¶ä»–ç‰¹æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 @Mapper( componentModel = \"spring\", unmappedSourcePolicy = ReportingPolicy.ERROR, unmappedTargetPolicy = ReportingPolicy.ERROR, // convert é€»è¾‘ä¾èµ– DateUtil åšæ—¥æœŸè½¬åŒ– uses = DateUtil.class ) public interface UserConvertor { UserDTO toUserDTO(UserDO userDO); @Data class UserDO { private String name; private Integer age; //private String address; private Date birthDay; } @Data class UserDTO { private String name; private Integer age; private String birthDay; } } public class DateUtil { public static String format(Date date) { SimpleDateFormat simpleDateFormat = new SimpleDateFormat(\"yyyy-MM-dd\"); return simpleDateFormat.format(date); } } ä½¿ç”¨ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 @RequiredArgsConstructor @Component public class UserService { private final UserDao userDao; private final UserCovertor userCovertor; public UserDTO getUser(String userId){ UserDO userDO = userDao.getById(userId); return userCovertor.toUserDTO(userDO); } } ç”Ÿæˆçš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Generated( value = \"org.mapstruct.ap.MappingProcessor\", date = \"2023-12-18T20:17:00+0800\", comments = \"version: 1.3.1.Final, compiler: javac, environment: Java 11.0.12 (GraalVM Community)\" ) @Component public class UserConvertorImpl implements UserConvertor { @Override public UserDTO toUserDTO(UserDO userDO) { if ( userDO == null ) { return null; } UserDTO userDTO = new UserDTO(); userDTO.setName( userDO.getName() ); userDTO.setAge( userDO.getAge() ); userDTO.setBirthDay( DateUtil.format( userDO.getBirthDay() ) ); return userDTO; } } çº¿ç¨‹å®‰å…¨é—®é¢˜ ç†Ÿç»ƒä½¿ç”¨çº¿ç¨‹å®‰å…¨ç±» ConcurrentHashMap\nåä¾‹ï¼š\nmap.get ä»¥åŠ map.put æ“ä½œæ˜¯éåŸå­æ“ä½œï¼Œå¤šçº¿ç¨‹å¹¶å‘ä¿®æ”¹çš„æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´ä¸€è‡´æ€§é—®é¢˜ã€‚æ¯”å¦‚çº¿ç¨‹ A è°ƒç”¨ append æ–¹æ³•ï¼Œåœ¨ç¬¬ 6 è¡Œæ—¶ï¼Œçº¿ç¨‹ B åˆ é™¤äº† keyã€‚\n1 2 3 4 5 6 7 8 9 10 public class ConcurrentHashMapExample { private Map map = new ConcurrentHashMap\u003c\u003e(); public void appendIfExists(String key, String suffix) { String value = map.get(key); if (value != null) { map.put(key, value + suffix); } } } æ­£ä¾‹ï¼š\n1 2 3 4 5 6 7 8 public class ConcurrentHashMapExample { private Map map = new ConcurrentHashMap\u003c\u003e(); public void append(String key, String suffix) { // ä½¿ç”¨ computeIfPresent åŸå­æ“ä½œ map.computeIfPresent(key, (k, v) -\u003e v + suffix); } } ä¿è¯å˜æ›´çš„åŸå­æ€§ åä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @Getter public class NoAtomicDiamondParser { private volatile int start; private volatile int end; public NoAtomicDiamondParser() { Diamond.addListener(\"dataId\", \"groupId\", new ManagerListenerAdapter() { @Override public void receiveConfigInfo(String s) { JSONObject jsonObject = JSON.parseObject(s); start = jsonObject.getIntValue(\"start\"); end = jsonObject.getIntValue(\"end\"); } }); } } public class MyController{ private final NoAtomicDiamondParser noAtomicDiamondParser; public void handleRange(){ // end è¯»å–çš„æ—§å€¼, start è¯»å–çš„æ–°å€¼, start å¯èƒ½å¤§äº end int end = noAtomicDiamondParser.getEnd(); int start = noAtomicDiamondParser.getStart(); } } æ­£ä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 @Getter public class AtomicDiamondParser { private volatile Range range; public AtomicDiamondParser() { Diamond.addListener(\"dataId\", \"groupId\", new ManagerListenerAdapter() { @Override public void receiveConfigInfo(String s) { range = JSON.parseObject(s, Range.class); } }); } @Data public static class Range { private int start; private int end; } } public class MyController { private final AtomicDiamondParser atomicDiamondParser; public void handleRange() { Range range = atomicDiamondParser.getRange(); System.out.println(range.getStart()); System.out.println(range.getEnd()); } } ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ å½“ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œé‚£è¿™ä¸ªå¯¹è±¡å†…å°±è‡ªç„¶ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ï¼Œé‚£å°±å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ç§æ–¹å¼é€‚ç”¨äºç®€å•çš„å€¼å¯¹è±¡ç±»å‹ï¼Œå¸¸è§çš„ä¾‹å­å°±æ˜¯ java ä¸­çš„ String å’Œ BigDecimalã€‚å¯¹äºä¸Šé¢ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°† Range è®¾è®¡ä¸ºä¸€ä¸ªé€šç”¨çš„å€¼å¯¹è±¡ã€‚\næ­£ä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Getter public class AtomicDiamondParser { private volatile Range range; public AtomicDiamondParser() { Diamond.addListener(\"dataId\", \"groupId\", new ManagerListenerAdapter() { @Override public void receiveConfigInfo(String s) { JSONObject jsonObject = JSON.parseObject(s); int start = jsonObject.getIntValue(\"start\"); int end = jsonObject.getIntValue(\"end\"); range = new Range(start, end); } }); } // lombok æ³¨è§£ä¼šä¿è¯ Range ç±»çš„ä¸å˜æ€§ @Value public static class Range { private int start; private int end; } } æ­£ç¡®æ€§ä¼˜å…ˆäºæ€§èƒ½ ä¸è¦å› ä¸ºæ‹…å¿ƒæ€§èƒ½é—®é¢˜è€Œæ”¾å¼ƒä½¿ç”¨ synchronizedï¼Œvolatile ç­‰å…³é”®å­—ï¼Œæˆ–è€…é‡‡ç”¨ä¸€äº›éå¸¸è§„å†™æ³•\nåä¾‹ åŒé‡æ£€æŸ¥é”ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 class Foo { // ç¼ºå°‘ volatile å…³é”®å­— private Helper helper = null; public Helper getHelper() { if (helper == null) synchronized(this) { if (helper == null) helper = new Helper(); } return helper; } } åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œåœ¨ helper å­—æ®µä¸Šå¢åŠ  volatile å…³é”®å­—ï¼Œèƒ½å¤Ÿåœ¨ java 5 åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚\næ­£ä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 class Foo { private volatile Helper helper = null; public Helper getHelper() { if (helper == null) synchronized(this) { if (helper == null) helper = new Helper(); } return helper; } } æ­£ä¾‹3ï¼ˆæ¨èï¼‰ï¼š\n1 2 3 4 5 6 7 8 class Foo { private Helper helper = null; public synchronized Helper getHelper() { if (helper == null) helper = new Helper(); } return helper; } å¹¶ä¸ä¸¥è°¨çš„ Diamond Parserï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /** * çœç•¥å¼‚å¸¸å¤„ç†ç­‰å…¶ä»–é€»è¾‘ */ @Getter public class DiamondParser { // ç¼ºå°‘ volatile å…³é”®å­— private Config config; public DiamondParser() { Diamond.addListener(\"dataId\", \"groupId\", new ManagerListenerAdapter() { @Override public void receiveConfigInfo(String s) { config = JSON.parseObject(s, Config.class); } }); } @Data public static class Config { private String name; } } è¿™ç§ Diamond å†™æ³•å¯èƒ½ä»æ¥æ²¡æœ‰å‘ç”Ÿè¿‡çº¿ä¸Šé—®é¢˜ï¼Œä½†è¿™ç§å†™æ³•ä¹Ÿç¡®å®æ˜¯ä¸ç¬¦åˆ JVM çº¿ç¨‹å®‰å…¨åŸåˆ™ã€‚æœªæ¥æŸä¸€å¤©ä½ çš„ä»£ç è·‘åœ¨å¦ä¸€ä¸ª JVM å®ç°ä¸Šï¼Œå¯èƒ½å°±æœ‰é—®é¢˜äº†ã€‚\nçº¿ç¨‹æ± ä½¿ç”¨ä¸å½“ åä¾‹ 1ï¼š\n1 2 3 4 public class ThreadPoolExample { // æ²¡æœ‰ä»»ä½•é™åˆ¶çš„çº¿ç¨‹æ± , ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿, ä½†å½“ä¸€æ³¢è¯·æ±‚é«˜å³°åˆ°è¾¾æ—¶, å¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹, å¯¼è‡´ç³»ç»Ÿå´©æºƒ private static Executor executor = Executors.newCachedThreadPool(); } åä¾‹2ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 public class StreamParallelExample { public List batchQuery(List ids){ // çœ‹ä¸Šå»å¾ˆä¼˜é›…, ä½† ForkJoinPool çš„é˜Ÿåˆ—æ˜¯æ²¡æœ‰å¤§å°é™åˆ¶çš„, å¹¶ä¸”çº¿ç¨‹æ•°é‡å¾ˆå°‘, å¦‚æœ ids åˆ—è¡¨å¾ˆå¤§å¯èƒ½å¯¼è‡´ OOM // parallelStream æ›´é€‚åˆè®¡ç®—å¯†é›†å‹ä»»åŠ¡, ä¸è¦åœ¨ä»»åŠ¡ä¸­åšè¿œç¨‹è°ƒç”¨ return ids.parallelStream() .map(this::queryFromRemote) .collect(Collectors.toList()); } private String queryFromRemote(String id){ // ä»è¿œç¨‹æŸ¥è¯¢ } } æ­£ä¾‹ï¼šæ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± \n1 2 3 4 5 6 public class ManualCreateThreadPool { // æ‰‹åŠ¨åˆ›å»ºèµ„æºæœ‰é™çš„çº¿ç¨‹æ±  private Executor executor = new ThreadPoolExecutor(10, 10, 1, TimeUnit.MINUTES, new ArrayBlockingQueue\u003c\u003e(1000), new ThreadFactoryBuilder().setNameFormat(\"work-%d\").build()); } å¼‚å¸¸å¤„ç†ä¸å½“ å’Œ NPE ä¸€æ ·ï¼Œå¼‚å¸¸å¤„ç†ä¹ŸåŒæ ·æ˜¯æˆ‘ä»¬æ¯å¤©éƒ½éœ€è¦é¢å¯¹çš„é—®é¢˜ï¼Œä½†å¾ˆå¤šä»£ç ä¸­å¾€å¾€ä¼šå‡ºç°ï¼š\nåä¾‹ 1ï¼š\né‡å¤ä¸”ç¹ççš„çš„å¼‚å¸¸å¤„ç†é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Slf4j public class DuplicatedExceptionHandlerExample { private UserService userService; public User query(String id) { try { return userService.query(id); } catch (Exception e) { log.error(\"query error, userId: {}\", id, e); return null; } } public User create(String id) { try { return userService.create(id); } catch (Exception e) { log.error(\"query error, userId: {}\", id, e); return null; } } } åä¾‹ 2ï¼š\nå¼‚å¸¸è¢«åæ‰æˆ–è€…ä¸¢å¤±éƒ¨åˆ†ä¿¡æ¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @Slf4j public class ExceptionShouldLogOrThrowExample { private UserService userService; public User query(String id) { try { return userService.query(id); } catch (Exception e) { // å¼‚å¸¸è¢«åå¹¶, é—®é¢˜è¢«éšè— return null; } } public User create(String id) { try { return userService.create(id); } catch (Exception e) { // å †æ ˆä¸¢å¤±, åç»­éš¾ä»¥å®šä½é—®é¢˜ log.error(\"query error, userId: {}, error: {}\", id,e.getMessage() ); return null; } } } åä¾‹ 3ï¼šå¯¹å¤–æŠ›å‡ºæœªçŸ¥å¼‚å¸¸, å¯¼è‡´è°ƒç”¨æ–¹åºåˆ—åŒ–å¤±è´¥\n1 2 3 4 5 6 7 public class OpenAPIService { public void handle(){ // HSF æœåŠ¡å¯¹å¤–æŠ›å‡º client ä¸­æœªå®šä¹‰çš„å¼‚å¸¸, è°ƒç”¨æ–¹ååºåˆ—åŒ–å¤±è´¥ throw new InternalSystemException(\"\"); } } é€šè¿‡ AOP ç»Ÿä¸€å¼‚å¸¸å¤„ç† æœªçŸ¥å¼‚å¸¸æŠ›ç»™è°ƒç”¨æ–¹, å°†æœªçŸ¥å¼‚å¸¸è½¬ä¸º Result æˆ–è€…é€šç”¨å¼‚å¸¸ç±»å‹ ç»Ÿä¸€å¼‚å¸¸æ—¥å¿—çš„æ‰“å°å’Œç›‘æ§ å¤„ç† Checked Exception Checked Exception æ˜¯åœ¨ç¼–è¯‘æœŸè¦æ±‚å¿…é¡»å¤„ç†çš„å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯é RuntimeException ç±»å‹çš„å¼‚å¸¸ï¼Œä½† Java Checked çš„å¼‚å¸¸ç»™æ¥å£çš„è°ƒç”¨è€…é€ æˆäº†ä¸€å®šçš„è´Ÿæ‹…ï¼Œå¯¼è‡´å¼‚å¸¸å£°æ˜å±‚å±‚ä¼ é€’ï¼Œå¦‚æœé¡¶å±‚èƒ½å¤Ÿå¤„ç†è¯¥å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ lombok çš„ @SneakyThrows æ³¨è§£è§„é¿ Checked exception\nTry catch çº¿ç¨‹é€»è¾‘ åä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 @RequiredArgsConstructor public class ThreadNotTryCatch { private final ExecutorService executorService; public void handle() { executorService.submit(new Runnable() { @Override public void run() { // æœªæ•è·å¼‚å¸¸, çº¿ç¨‹ç›´æ¥é€€å‡º, å¼‚å¸¸ä¿¡æ¯ä¸¢å¤± remoteInvoke(); } }); } } æ­£ä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 @RequiredArgsConstructor @Slf4j public class ThreadNotTryCatch { private final ExecutorService executorService; public void handle() { executorService.submit(new Runnable() { @Override public void run() { try { remoteInvoke(); } catch (Exception e) { log.error(\"handle failed\", e); } } }); } } ç‰¹æ®Šå¼‚å¸¸çš„å¤„ç† InterruptedException ä¸€èˆ¬æ˜¯ä¸Šå±‚è°ƒåº¦è€…ä¸»åŠ¨å‘èµ·çš„ä¸­æ–­ä¿¡å·ï¼Œä¾‹å¦‚æŸä¸ªä»»åŠ¡æ‰§è¡Œè¶…æ—¶ï¼Œé‚£ä¹ˆè°ƒåº¦è€…é€šè¿‡å°†çº¿ç¨‹ç½®ä¸º interuppted æ¥ä¸­æ–­ä»»åŠ¡ï¼Œå¯¹äºè¿™ç±»å¼‚å¸¸æˆ‘ä»¬ä¸åº”è¯¥åœ¨ catch ä¹‹åå¿½ç•¥ï¼Œåº”è¯¥å‘ä¸ŠæŠ›å‡ºæˆ–è€…å°†å½“å‰çº¿ç¨‹ç½®ä¸º interupptedã€‚\nåä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 public class InterruptedExceptionExample { private ExecutorService executorService = Executors.newSingleThreadExecutor(); public void handleWithTimeout() throws InterruptedException { Future\u003c?\u003e future = executorService.submit(() -\u003e { try { // sleep æ¨¡æ‹Ÿå¤„ç†é€»è¾‘ Thread.sleep(1000); } catch (InterruptedException e) { System.out.println(\"interrupted\"); } System.out.println(\"continue task\"); // å¼‚å¸¸è¢«å¿½ç•¥, ç»§ç»­å¤„ç† }); // ç­‰å¾…ä»»åŠ¡ç»“æœ, å¦‚æœè¶…è¿‡ 500ms åˆ™ä¸­æ–­ Thread.sleep(500); if (!future.isDone()) { System.out.println(\"cancel\"); future.cancel(true); } } } é¿å… catch Error ä¸è¦åå¹¶ Errorï¼ŒError è®¾è®¡æœ¬èº«å°±æ˜¯åŒºåˆ«äºå¼‚å¸¸ï¼Œä¸€èˆ¬ä¸åº”è¯¥è¢« catchï¼Œæ›´ä¸èƒ½è¢«åæ‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒOOM æœ‰å¯èƒ½å‘ç”Ÿåœ¨ä»»æ„ä»£ç ä½ç½®ï¼Œå¦‚æœåå¹¶ Errorï¼Œè®©ç¨‹åºç»§ç»­è¿è¡Œï¼Œé‚£ä¹ˆä»¥ä¸‹ä»£ç çš„ start å’Œ end å°±æ— æ³•ä¿è¯ä¸€è‡´æ€§ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 public class ErrorExample { private Date start; private Date end; public synchronized void update(long start, long end) { if (start \u003e end) { throw new IllegalArgumentException(\"start after end\"); } this.start = new Date(start); // å¦‚æœ new Date(end) å‘ç”Ÿ OOM, start æœ‰å¯èƒ½å¤§äº end this.end = new Date(end); } } Spring Bean éšå¼ä¾èµ– åä¾‹ 1: SpringContext ä½œä¸ºé™æ€å˜é‡ UserController å’Œ SpringContextUtils ç±»æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œ SpringContextUtils.getApplication() å¯èƒ½è¿”å›ç©ºã€‚å¹¶ä¸” Spring éä¾èµ–å…³ç³»çš„ Bean ä¹‹é—´çš„åˆå§‹åŒ–é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œè™½ç„¶å¯èƒ½å½“å‰åˆå§‹åŒ–é¡ºåºæ°å¥½ç¬¦åˆæœŸæœ›ï¼Œä½†åç»­å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Component public class SpringContextUtils { @Getter private static ApplicationContext applicationContext; public SpringContextUtils(ApplicationContext context) { applicationContext = context; } } @Component public class UserController { public void handle(){ MyService bean = SpringContextUtils.getApplicationContext().getBean(MyService.class); } } åä¾‹ 2: Switch åœ¨ Spring Bean ä¸­æ³¨å†Œ, ä½†é€šè¿‡é™æ€æ–¹å¼è¯»å–\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Component public class SwitchConfig { @PostConstruct public void init() { SwitchManager.register(\"appName\", MySwitch.class); } public static class MySwitch { @AppSwitch(des = \"config\", level = Switch.Level.p1) public static String config; } } @Component public class UserController{ public String getConfig(){ // UserController å’Œ SwitchConfig ç±»æ²¡æœ‰ä¾èµ–å…³ç³», MySwitch.config å¯èƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ– return MySwitch.config; } } æ­£ä¾‹ï¼š é€šè¿‡ SpringBeanFactory ä¿è¯åˆå§‹åŒ–é¡ºåºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 public class PreInitializer implements BeanFactoryPostProcessor, PriorityOrdered { @Override public int getOrder() { return Ordered.HIGHEST_PRECEDENCE; } @Override public void postProcessBeanFactory( ConfigurableListableBeanFactory beanFactory) throws BeansException { try { SwitchManager.init(åº”ç”¨å, å¼€å…³ç±».class); } catch (SwitchCenterException e) { // æ­¤å¤„æŠ›é”™æœ€å¥½é˜»æ–­ç¨‹åºå¯åŠ¨ï¼Œé¿å…å¼€å…³è¯»ä¸åˆ°æŒä¹…å€¼å¼•å‘é—®é¢˜ } catch (SwitchCenterError e) { System.exit(1); } } } @Component public class SpringContextUtilPostProcessor implements BeanFactoryPostProcessor, PriorityOrdered, ApplicationContextAware { private ApplicationContext applicationContext; @Override public int getOrder() { return Ordered.HIGHEST_PRECEDENCE; } @Override public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException { SpringContextUtils.setApplicationContext(applicationContext); } @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException { this.applicationContext = applicationContext; } } å†…å­˜/èµ„æºæ³„æ¼ è™½ç„¶ JVM æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä½†å¹¶ä¸æ„å‘³ç€å†…å­˜æ³„æ¼é—®é¢˜ä¸å­˜åœ¨ï¼Œä¸€èˆ¬å†…å­˜æ³„æ¼å‘ç”Ÿåœ¨åœ¨é•¿æ—¶é—´æŒå¯¹è±¡æ— æ³•é‡Šæ”¾çš„åœºæ™¯ï¼Œæ¯”å¦‚é™æ€é›†åˆï¼Œå†…å­˜ä¸­çš„ç¼“å­˜æ•°æ®ï¼Œè¿è¡Œæ—¶ç±»ç”ŸæˆæŠ€æœ¯ç­‰ã€‚\nLoadingCache ä»£æ›¿å…¨å±€ Map 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 @Service public class MetaInfoManager { // å¯¹äºå°‘é‡çš„å…ƒæ•°æ®æ¥è¯´, æ”¾åˆ°å†…å­˜ä¸­ä¼¼ä¹å¹¶æ— å¤§ç¢, ä½†å¦‚æœåç»­å…ƒæ•°æ®é‡å¢å¤§, åˆ™å¤§é‡å¯¹è±¡åˆ™å†…å­˜ä¸­æ— æ³•é‡Šæ”¾, å¯¼è‡´å†…å­˜æ³„æ¼ private Map cache = new HashMap\u003c\u003e(); public MetaInfo getMetaInfo(String id) { return cache.computeIfAbsent(id, k -\u003e loadFromRemote(id)); } private LoadingCache loadingCache = CacheBuilder.newBuilder() // loadingCache è®¾ç½®æœ€å¤§ size æˆ–è€…è¿‡æœŸæ—¶é—´, èƒ½å¤Ÿé™åˆ¶ç¼“å­˜æ¡ç›®çš„æ•°é‡ .maximumSize(1000) .build(new CacheLoader() { @Override public MetaInfo load(String key) throws Exception { return loadFromRemote(key); } }); public MetaInfo getMetaInfoFromLoadingCache(String id) { return loadingCache.getUnchecked(id); } private MetaInfo loadFromRemote(String id) { return null; } @Data public static class MetaInfo { private String id; private String name; } } è°¨æ…ä½¿ç”¨è¿è¡Œæ—¶ç±»ç”ŸæˆæŠ€æœ¯ Cglib, Javasisit æˆ–è€… Groovy è„šæœ¬ä¼šåœ¨è¿è¡Œæ—¶åˆ›å»ºä¸´æ—¶ç±», Jvm å¯¹äºç±»çš„å›æ”¶æ¡ä»¶ååˆ†è‹›åˆ», æ‰€ä»¥è¿™äº›ä¸´æ—¶ç±»åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½ä¸ä¼šå›æ”¶, ç›´åˆ°è§¦å‘ FullGCã€‚\nä½¿ç”¨ Java 8 try wiht Resource è¯­æ³•ï¼š 1 2 3 4 5 6 7 8 public class TryWithResourceExample { public static void main(String[] args) throws IOException { try (InputStream in = Files.newInputStream(Paths.get(\"\"))) { // read } } } æ€§èƒ½é—®é¢˜ URL çš„ hashCodeã€euqals æ–¹æ³• URL çš„ hashCodeï¼Œequals æ–¹æ³•çš„å®ç°æ¶‰åŠåˆ°äº†å¯¹åŸŸå ip åœ°å€è§£æï¼Œæ‰€ä»¥åœ¨æ˜¾ç¤ºè°ƒç”¨æˆ–è€…æ”¾åˆ° Map è¿™æ ·çš„æ•°æ®ç»“æ„ä¸­ï¼Œæœ‰å¯èƒ½è§¦å‘è¿œç¨‹è°ƒç”¨ã€‚ç”¨ URI ä»£æ›¿ URL åˆ™å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚\nåä¾‹1ï¼š\n1 2 3 4 5 6 7 public class URLExample { public void handle(URL a, URL b) { if (Objects.equals(a, b)) { } } } åä¾‹ 2ï¼š\n1 2 3 4 public class URLMapExample { private static final Map urlObjectMap = new HashMap\u003c\u003e(); } å¾ªç¯è¿œç¨‹è°ƒç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 public class HSFLoopInvokeExample { @HSFConsumer private UserService userService; public List batchQuery(List ids){ // ä½¿ç”¨æ‰¹é‡æ¥å£æˆ–è€…é™åˆ¶æ‰¹é‡å¤§å° return ids.stream() .map(userService::getUser) .collect(Collectors.toList()); } } äº†è§£å¸¸è§æ€§èƒ½æŒ‡æ ‡\u0026ç“¶é¢ˆ äº†è§£ä¸€äº›åŸºç¡€æ€§èƒ½æŒ‡æ ‡ï¼Œæœ‰åŠ©äºæˆ‘ä»¬å‡†ç¡®è¯„ä¼°å½“å‰é—®é¢˜çš„æ€§èƒ½ç“¶é¢ˆï¼Œè¿™é‡Œæ¨èçœ‹ä¸€ä¸‹ã€Šæ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥çŸ¥é“çš„å»¶è¿Ÿæ•°å­—ã€‹ã€‚æ¯”å¦‚å°†å­—æ®µè®¾ç½®ä¸º volatileï¼Œç›¸å½“äºæ¯æ¬¡éƒ½éœ€è¦è¯»ä¸»å­˜ï¼Œè¯»ä¸»å­˜æ€§èƒ½å¤§æ¦‚åœ¨çº³ç§’çº§åˆ«ï¼Œåœ¨ä¸€æ¬¡ HSF è°ƒç”¨ä¸­ä¸å¤ªå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚åå°„ç›¸æ¯”æ™®é€šæ“ä½œå¤šå‡ æ¬¡å†…å­˜è¯»å–ï¼Œä¸€èˆ¬è®¤ä¸ºæ€§èƒ½è¾ƒå·®ï¼Œä½†æ˜¯åŒç†åœ¨ä¸€æ¬¡ HSF è°ƒç”¨ä¸­ä¹Ÿä¸å¤ªå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚\nåœ¨æœåŠ¡ç«¯å¼€å‘ä¸­, æ€§èƒ½ç“¶é¢ˆä¸€èˆ¬é›†ä¸­åœ¨ï¼š\nå¤§é‡æ—¥å¿—æ‰“å° å¤§å¯¹è±¡åºåˆ—åŒ– ç½‘ç»œè°ƒç”¨: æ¯”å¦‚ HSFï¼ŒHTTP ç­‰è¿œç¨‹è°ƒç”¨ æ•°æ®åº“æ“ä½œ ä½¿ç”¨ä¸“ä¸šæ€§èƒ½æµ‹è¯•å·¥å…·ä¼°æ€§èƒ½ ä¸è¦å°è¯•è‡ªå·±å®ç°ä¸€ä¸ªç®€é™‹çš„æ€§èƒ½æµ‹è¯•ï¼Œåœ¨æµ‹è¯•ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨ï¼ŒJVMï¼Œ æ“ä½œç³»ç»Ÿå„ä¸ªå±‚çº§ä¸Šéƒ½æœ‰å¯èƒ½å­˜åœ¨ä½ æ„æ–™ä¹‹å¤–çš„ä¼˜åŒ–ï¼Œå¯¼è‡´æµ‹è¯•ç»“æœè¿‡äºä¹è§‚ã€‚å»ºè®®ä½¿ç”¨ jmhï¼Œarthas ç«ç„°å›¾ï¼Œè¿™æ ·çš„ä¸“ä¸šå·¥å…·åšæ€§èƒ½æµ‹è¯•\nåä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public class ManualPerformanceTest { public void testPerformance() { long start = System.currentTimeMillis(); for (int i = 0; i \u003c 1000; i++) { // è¿™é‡Œ mutiply æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨, æœ‰å¯èƒ½è¢«ä¼˜åŒ–ä¹‹åè¢«å¹²æ‰ mutiply(10, 10); } System.out.println(\"avg rt: \" + (System.currentTimeMillis() - start) / 1000); } private int mutiply(int a, int b) { return a * b; } } æ­£ä¾‹:\nä½¿ç”¨ç«ç„°å›¾\nä½¿ç”¨ jmh è¯„ä¼°æ€§èƒ½\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Warmup(iterations = 5, time = 1, timeUnit = TimeUnit.SECONDS) @Measurement(iterations = 5, time = 1, timeUnit = TimeUnit.SECONDS) @Fork(3) @BenchmarkMode(Mode.AverageTime) @OutputTimeUnit(TimeUnit.NANOSECONDS) public class JMHExample { @Benchmark public void testPerformance(Blackhole bh) { bh.consume(mutiply(10, 10)); } private int mutiply(int a, int b) { return a * b; } } Spring äº‹åŠ¡é—®é¢˜ æ³¨æ„äº‹åŠ¡æ³¨è§£å¤±æ•ˆçš„åœºæ™¯\nå½“æ‰“ä¸Š @Transactional æ³¨è§£çš„ spring bean è¢«æ³¨å…¥æ—¶ï¼Œspring ä¼šç”¨äº‹åŠ¡ä»£ç†è¿‡çš„å¯¹è±¡ä»£æ›¿åŸå¯¹è±¡æ³¨å…¥ã€‚\nä½†æ˜¯å¦‚æœæ³¨è§£æ–¹æ³•è¢«åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„å¦ä¸€ä¸ªæ–¹æ³•é‡Œé¢è°ƒç”¨ï¼Œåˆ™è¯¥è°ƒç”¨æ— æ³•è¢« Spring å¹²é¢„ï¼Œè‡ªç„¶äº‹åŠ¡æ³¨è§£ä¹Ÿå°±å¤±æ•ˆäº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 @Component public class TransactionNotWork { public void doTheThing() { actuallyDoTheThing(); } @Transactional public void actuallyDoTheThing() { } } ",
  "wordCount" : "5202",
  "inLanguage": "en",
  "datePublished": "2020-10-09T17:36:57Z",
  "dateModified": "2020-10-09T17:36:57Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://funny-toffee-4aa7c3.netlify.app/posts/java/%E5%B8%B8%E8%A7%81-java-%E4%BB%A3%E7%A0%81%E7%BC%BA%E9%99%B7%E5%8F%8A%E8%A7%84%E9%81%BF%E6%96%B9%E5%BC%8F/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://funny-toffee-4aa7c3.netlify.app/favicon.ico"
    }
  }
}
</script>

  <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.min.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath:  [['\\(', '\\)'], ['$', '$']],  
    }
  };
</script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://funny-toffee-4aa7c3.netlify.app/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://funny-toffee-4aa7c3.netlify.app/">Home</a>&nbsp;Â»&nbsp;<a href="https://funny-toffee-4aa7c3.netlify.app/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      å¸¸è§ Java ä»£ç ç¼ºé™·åŠè§„é¿æ–¹å¼
    </h1>
    <div class="post-meta"><span title='2020-10-09 17:36:57 +0000 UTC'>2020-10-09</span>&nbsp;Â·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%a9%ba%e6%8c%87%e9%92%88%e5%bc%82%e5%b8%b8" aria-label="ç©ºæŒ‡é’ˆå¼‚å¸¸">ç©ºæŒ‡é’ˆå¼‚å¸¸</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-jsr-305jetbrain-%e7%ad%89%e6%b3%a8%e8%a7%a3" aria-label="ä½¿ç”¨ JSR-305/jetbrain ç­‰æ³¨è§£">ä½¿ç”¨ JSR-305/jetbrain ç­‰æ³¨è§£</a></li>
                <li>
                    <a href="#%e7%94%a8-optional-%e5%a4%84%e7%90%86%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8" aria-label="ç”¨ Optional å¤„ç†é“¾å¼è°ƒç”¨">ç”¨ Optional å¤„ç†é“¾å¼è°ƒç”¨</a></li>
                <li>
                    <a href="#%e7%94%a8-objectsequalsab-%e4%bb%a3%e6%9b%bf-aequalsb" aria-label="ç”¨ Objects.equals(a,b) ä»£æ›¿ a.equals(b)">ç”¨ Objects.equals(a,b) ä»£æ›¿ a.equals(b)</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e7%a9%ba%e5%af%b9%e8%b1%a1%e6%a8%a1%e5%bc%8f" aria-label="ä½¿ç”¨ç©ºå¯¹è±¡æ¨¡å¼">ä½¿ç”¨ç©ºå¯¹è±¡æ¨¡å¼</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%af%b9%e8%b1%a1%e8%bd%ac%e5%8c%96" aria-label="å¯¹è±¡è½¬åŒ–">å¯¹è±¡è½¬åŒ–</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-mapstruct" aria-label="ä½¿ç”¨ Mapstruct">ä½¿ç”¨ Mapstruct</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8%e9%97%ae%e9%a2%98" aria-label="çº¿ç¨‹å®‰å…¨é—®é¢˜">çº¿ç¨‹å®‰å…¨é—®é¢˜</a><ul>
                        
                <li>
                    <a href="#%e7%86%9f%e7%bb%83%e4%bd%bf%e7%94%a8%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8%e7%b1%bb" aria-label="ç†Ÿç»ƒä½¿ç”¨çº¿ç¨‹å®‰å…¨ç±»">ç†Ÿç»ƒä½¿ç”¨çº¿ç¨‹å®‰å…¨ç±»</a></li>
                <li>
                    <a href="#%e4%bf%9d%e8%af%81%e5%8f%98%e6%9b%b4%e7%9a%84%e5%8e%9f%e5%ad%90%e6%80%a7" aria-label="ä¿è¯å˜æ›´çš„åŸå­æ€§">ä¿è¯å˜æ›´çš„åŸå­æ€§</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e4%b8%8d%e5%8f%af%e5%8f%98%e5%af%b9%e8%b1%a1" aria-label="ä½¿ç”¨ä¸å¯å˜å¯¹è±¡">ä½¿ç”¨ä¸å¯å˜å¯¹è±¡</a></li>
                <li>
                    <a href="#%e6%ad%a3%e7%a1%ae%e6%80%a7%e4%bc%98%e5%85%88%e4%ba%8e%e6%80%a7%e8%83%bd" aria-label="æ­£ç¡®æ€§ä¼˜å…ˆäºæ€§èƒ½">æ­£ç¡®æ€§ä¼˜å…ˆäºæ€§èƒ½</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e4%bd%bf%e7%94%a8%e4%b8%8d%e5%bd%93" aria-label="çº¿ç¨‹æ± ä½¿ç”¨ä¸å½“">çº¿ç¨‹æ± ä½¿ç”¨ä¸å½“</a></li>
                <li>
                    <a href="#%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86%e4%b8%8d%e5%bd%93" aria-label="å¼‚å¸¸å¤„ç†ä¸å½“">å¼‚å¸¸å¤„ç†ä¸å½“</a><ul>
                        
                <li>
                    <a href="#%e9%80%9a%e8%bf%87-aop-%e7%bb%9f%e4%b8%80%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86" aria-label="é€šè¿‡ AOP ç»Ÿä¸€å¼‚å¸¸å¤„ç†">é€šè¿‡ AOP ç»Ÿä¸€å¼‚å¸¸å¤„ç†</a></li>
                <li>
                    <a href="#%e5%a4%84%e7%90%86-checked-exception" aria-label="å¤„ç† Checked Exception">å¤„ç† Checked Exception</a></li>
                <li>
                    <a href="#try-catch-%e7%ba%bf%e7%a8%8b%e9%80%bb%e8%be%91" aria-label="Try catch çº¿ç¨‹é€»è¾‘">Try catch çº¿ç¨‹é€»è¾‘</a></li>
                <li>
                    <a href="#%e7%89%b9%e6%ae%8a%e5%bc%82%e5%b8%b8%e7%9a%84%e5%a4%84%e7%90%86" aria-label="ç‰¹æ®Šå¼‚å¸¸çš„å¤„ç†">ç‰¹æ®Šå¼‚å¸¸çš„å¤„ç†</a></li>
                <li>
                    <a href="#%e9%81%bf%e5%85%8d-catch-error" aria-label="é¿å… catch Error">é¿å… catch Error</a></li></ul>
                </li>
                <li>
                    <a href="#spring-bean-%e9%9a%90%e5%bc%8f%e4%be%9d%e8%b5%96" aria-label="Spring Bean éšå¼ä¾èµ–">Spring Bean éšå¼ä¾èµ–</a><ul>
                        
                <li>
                    <a href="#%e5%8f%8d%e4%be%8b-1-springcontext-%e4%bd%9c%e4%b8%ba%e9%9d%99%e6%80%81%e5%8f%98%e9%87%8f" aria-label="åä¾‹ 1: SpringContext ä½œä¸ºé™æ€å˜é‡">åä¾‹ 1: SpringContext ä½œä¸ºé™æ€å˜é‡</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%86%85%e5%ad%98%e8%b5%84%e6%ba%90%e6%b3%84%e6%bc%8f" aria-label="å†…å­˜/èµ„æºæ³„æ¼">å†…å­˜/èµ„æºæ³„æ¼</a><ul>
                        
                <li>
                    <a href="#loadingcache-%e4%bb%a3%e6%9b%bf%e5%85%a8%e5%b1%80-map" aria-label="LoadingCache ä»£æ›¿å…¨å±€ Map">LoadingCache ä»£æ›¿å…¨å±€ Map</a></li>
                <li>
                    <a href="#%e8%b0%a8%e6%85%8e%e4%bd%bf%e7%94%a8%e8%bf%90%e8%a1%8c%e6%97%b6%e7%b1%bb%e7%94%9f%e6%88%90%e6%8a%80%e6%9c%af" aria-label="è°¨æ…ä½¿ç”¨è¿è¡Œæ—¶ç±»ç”ŸæˆæŠ€æœ¯">è°¨æ…ä½¿ç”¨è¿è¡Œæ—¶ç±»ç”ŸæˆæŠ€æœ¯</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-java-8-try-wiht-resource-%e8%af%ad%e6%b3%95" aria-label="ä½¿ç”¨ Java 8 try wiht Resource è¯­æ³•ï¼š">ä½¿ç”¨ Java 8 try wiht Resource è¯­æ³•ï¼š</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%80%a7%e8%83%bd%e9%97%ae%e9%a2%98" aria-label="æ€§èƒ½é—®é¢˜">æ€§èƒ½é—®é¢˜</a><ul>
                        
                <li>
                    <a href="#url-%e7%9a%84-hashcodeeuqals-%e6%96%b9%e6%b3%95" aria-label="URL çš„ hashCodeã€euqals æ–¹æ³•">URL çš„ hashCodeã€euqals æ–¹æ³•</a></li>
                <li>
                    <a href="#%e4%ba%86%e8%a7%a3%e5%b8%b8%e8%a7%81%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87%e7%93%b6%e9%a2%88" aria-label="äº†è§£å¸¸è§æ€§èƒ½æŒ‡æ ‡&amp;ç“¶é¢ˆ">äº†è§£å¸¸è§æ€§èƒ½æŒ‡æ ‡&amp;ç“¶é¢ˆ</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e4%b8%93%e4%b8%9a%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e5%b7%a5%e5%85%b7%e4%bc%b0%e6%80%a7%e8%83%bd" aria-label="ä½¿ç”¨ä¸“ä¸šæ€§èƒ½æµ‹è¯•å·¥å…·ä¼°æ€§èƒ½">ä½¿ç”¨ä¸“ä¸šæ€§èƒ½æµ‹è¯•å·¥å…·ä¼°æ€§èƒ½</a></li></ul>
                </li>
                <li>
                    <a href="#spring-%e4%ba%8b%e5%8a%a1%e9%97%ae%e9%a2%98" aria-label="Spring äº‹åŠ¡é—®é¢˜">Spring äº‹åŠ¡é—®é¢˜</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="ç©ºæŒ‡é’ˆå¼‚å¸¸">ç©ºæŒ‡é’ˆå¼‚å¸¸<a hidden class="anchor" aria-hidden="true" href="#ç©ºæŒ‡é’ˆå¼‚å¸¸">#</a></h1>
<h2 id="ä½¿ç”¨-jsr-305jetbrain-ç­‰æ³¨è§£">ä½¿ç”¨ JSR-305/jetbrain ç­‰æ³¨è§£<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨-jsr-305jetbrain-ç­‰æ³¨è§£">#</a></h2>
<ol>
<li>NotNull</li>
<li>Nullable</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Nullable
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> String getString(){
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡åœ¨æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€å­—æ®µç­‰ä½ç½®æ˜¾å¼æ ‡è®°å€¼æ˜¯å¦å¯èƒ½ä¸º Nullï¼Œé…åˆä»£ç æ£€æŸ¥å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ç¼–ç é˜¶æ®µè§„é¿ç»å¤§éƒ¨åˆ†çš„ NPE é—®é¢˜ï¼Œå»ºè®®è‡³å°‘åœ¨å¸¸ç”¨æ–¹æ³•æˆ–è€…å¯¹å¤– API ä¸­ä½¿ç”¨è¯¥æ³¨è§£ï¼Œèƒ½å¤Ÿå¯¹è°ƒç”¨æ–¹æä¾›æ˜¾è‘—çš„å¸®åŠ©ã€‚</p>
<h2 id="ç”¨-optional-å¤„ç†é“¾å¼è°ƒç”¨">ç”¨ Optional å¤„ç†é“¾å¼è°ƒç”¨<a hidden class="anchor" aria-hidden="true" href="#ç”¨-optional-å¤„ç†é“¾å¼è°ƒç”¨">#</a></h2>
<p>Optional æºäº Guava ä¸­çš„ Optional ç±»ï¼Œå Java 8 å†…ç½®åˆ° JDK ä¸­ã€‚Optional ä¸€èˆ¬ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼Œå¼ºåˆ¶æé†’è°ƒç”¨è€…è¿”å›å€¼å¯èƒ½ä¸å­˜åœ¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡é“¾å¼è°ƒç”¨ä¼˜é›…çš„å¤„ç†ç©ºå€¼ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> OptionalExample {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä½¿ç”¨ä¼ ç»Ÿç©ºå€¼å¤„ç†æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        User user = getUser();
</span></span><span style="display:flex;"><span>        String city = <span style="color:#0ff;font-weight:bold">&#34;DEFAULT&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (user != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; user.<span style="color:#007f7f">isValid</span>()) {
</span></span><span style="display:flex;"><span>            Address address = user.<span style="color:#007f7f">getAddress</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (adress != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                city = adress.<span style="color:#007f7f">getCity</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(city);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä½¿ç”¨ Optional çš„æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Optional&lt;User&gt; optional = getUserOptional();
</span></span><span style="display:flex;"><span>        city = optional.<span style="color:#007f7f">filter</span>(User::isValid)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">map</span>(User::getAddress)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">map</span>(Adress::getCity)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">orElse</span>(<span style="color:#0ff;font-weight:bold">&#34;DEFAULT&#34;</span>)
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(city);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Nullable
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> User getUser() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> Optional&lt;User&gt; getUserOptional() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Optional.<span style="color:#007f7f">empty</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Data
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> Adress address;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">boolean</span> valid;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Data
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> Address {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> String city;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç”¨-objectsequalsab-ä»£æ›¿-aequalsb">ç”¨ Objects.equals(a,b) ä»£æ›¿ a.equals(b)<a hidden class="anchor" aria-hidden="true" href="#ç”¨-objectsequalsab-ä»£æ›¿-aequalsb">#</a></h2>
<p><code>equals</code>æ–¹æ³•æ˜¯ NPE çš„é«˜å‘åœ°ç‚¹ï¼Œç”¨ <code>Objects.euqals</code>æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼Œèƒ½å¤Ÿé¿å…ä»»æ„å¯¹è±¡ä¸º null æ—¶çš„ NPEã€‚</p>
<h2 id="ä½¿ç”¨ç©ºå¯¹è±¡æ¨¡å¼">ä½¿ç”¨ç©ºå¯¹è±¡æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨ç©ºå¯¹è±¡æ¨¡å¼">#</a></h2>
<p>ç©ºå¯¹åƒæ¨¡å¼é€šè¿‡ä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ä»£æ›¿ä¸å­˜åœ¨çš„æƒ…å†µï¼Œä»£è¡¨å¯¹è±¡ä¸å­˜åœ¨æ—¶çš„é»˜è®¤è¡Œä¸ºæ¨¡å¼ã€‚å¸¸è§ä¾‹å­ï¼š</p>
<p>ç”¨ Empty List ä»£æ›¿ nullï¼ŒEmptyList èƒ½å¤Ÿæ­£å¸¸éå†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> EmptyListExample {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        List&lt;String&gt; listNullable = getListNullable();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (listNullable != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (String s : listNullable) {
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(s);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        List&lt;String&gt; listNotNull = getListNotNull();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (String s : listNotNull) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(s);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Nullable
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> List&lt;String&gt; getListNullable() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @NotNull
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> List&lt;String&gt; getListNotNull() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Collections.<span style="color:#007f7f">emptyList</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç©ºç­–ç•¥</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> NullStrategyExample {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> Map&lt;String, Strategy&gt; strategyMap = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> handle(String strategy, String content) {
</span></span><span style="display:flex;"><span>        findStrategy(strategy).<span style="color:#007f7f">handle</span>(content);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @NotNull
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> Strategy findStrategy(String strategyKey) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> strategyMap.<span style="color:#007f7f">getOrDefault</span>(strategyKey, <span style="color:#fff;font-weight:bold">new</span> DoNothing());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Strategy {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">void</span> handle(String s);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å½“æ‰¾ä¸åˆ°å¯¹åº”ç­–ç•¥æ—¶, ä»€ä¹ˆä¹Ÿä¸åš
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> DoNothing <span style="color:#fff;font-weight:bold">implements</span> Strategy {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(String s) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="å¯¹è±¡è½¬åŒ–">å¯¹è±¡è½¬åŒ–<a hidden class="anchor" aria-hidden="true" href="#å¯¹è±¡è½¬åŒ–">#</a></h1>
<p>åœ¨ä¸šåŠ¡åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬çš„ä»£ç ç»“æ„å¾€å¾€æ˜¯å¤šå±‚æ¬¡çš„ï¼Œä¸åŒå±‚æ¬¡ä¹‹é—´ç»å¸¸æ¶‰åŠåˆ°å¯¹è±¡çš„è½¬åŒ–ï¼Œè™½ç„¶å¾ˆç®€å•ï¼Œä½†å®é™…ä¸Šç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// åä¾‹ 1ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserConverter {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> UserDTO toDTO(UserDO userDO) {
</span></span><span style="display:flex;"><span>        UserDTO userDTO = <span style="color:#fff;font-weight:bold">new</span> UserDTO();
</span></span><span style="display:flex;"><span>        userDTO.<span style="color:#007f7f">setAge</span>(userDO.<span style="color:#007f7f">getAge</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// é—®é¢˜ 1: è‡ªå·±èµ‹å€¼ç»™è‡ªå·±
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        userDTO.<span style="color:#007f7f">setName</span>(userDTO.<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> userDTO;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Data
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> UserDO {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> Integer age;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// é—®é¢˜ 2: æ–°å¢å­—æ®µæœªèµ‹å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">private</span> String address;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Data
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> UserDTO {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> Integer age;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åä¾‹2ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserBeanCopyConvert {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> UserDTO toDTO(UserDO userDO) {
</span></span><span style="display:flex;"><span>        UserDTO userDTO = <span style="color:#fff;font-weight:bold">new</span> UserDTO();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ç”¨åå°„å¤åˆ¶ä¸åŒç±»å‹å¯¹è±¡.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">// 1. é‡æ„ä¸å‹å¥½, å½“æˆ‘è¦åˆ é™¤æˆ–ä¿®æ”¹ UserDO çš„å­—æ®µæ—¶, æ— æ³•å¾—çŸ¥è¯¥å­—æ®µæ˜¯å¦é€šè¿‡åå°„è¢«å…¶ä»–å­—æ®µä¾èµ–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        BeanUtils.<span style="color:#007f7f">copyProperties</span>(userDO, userDTO);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> userDTO;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä½¿ç”¨-mapstruct">ä½¿ç”¨ Mapstruct<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨-mapstruct">#</a></h2>
<p>Mapstruct ä½¿ç”¨ç¼–è¯‘æœŸä»£ç ç”ŸæˆæŠ€æœ¯ï¼Œæ ¹æ®æ³¨è§£, å…¥å‚ï¼Œå‡ºå‚è‡ªåŠ¨ç”Ÿæˆè½¬åŒ–ï¼Œä»£ç ï¼Œå¹¶ä¸”æ”¯æŒå„ç§é«˜çº§ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>æœªæ˜ å°„å­—æ®µçš„å¤„ç†ç­–ç•¥ï¼Œåœ¨ç¼–è¯‘æœŸå‘ç°æ˜ å°„é—®é¢˜</li>
<li>å¤ç”¨å·¥å…·ï¼Œæ–¹ä¾¿å­—æ®µç±»å‹è½¬åŒ–</li>
<li>ç”Ÿæˆ spring Component æ³¨è§£ï¼Œé€šè¿‡ spring ç®¡ç†</li>
<li>ç­‰ç­‰å…¶ä»–ç‰¹æ€§</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Mapper(
</span></span><span style="display:flex;"><span>    componentModel = <span style="color:#0ff;font-weight:bold">&#34;spring&#34;</span>,
</span></span><span style="display:flex;"><span>    unmappedSourcePolicy = ReportingPolicy.<span style="color:#007f7f">ERROR</span>,
</span></span><span style="display:flex;"><span>    unmappedTargetPolicy = ReportingPolicy.<span style="color:#007f7f">ERROR</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// convert é€»è¾‘ä¾èµ– DateUtil åšæ—¥æœŸè½¬åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    uses = DateUtil.<span style="color:#007f7f">class</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> UserConvertor  {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UserDTO toUserDTO(UserDO userDO);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Data
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">class</span> UserDO {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> Integer age;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//private String address;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">private</span> Date birthDay;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Data
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">class</span> UserDTO {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> Integer age;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> String birthDay;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DateUtil {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> String format(Date date) {
</span></span><span style="display:flex;"><span>        SimpleDateFormat simpleDateFormat = <span style="color:#fff;font-weight:bold">new</span> SimpleDateFormat(<span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> simpleDateFormat.<span style="color:#007f7f">format</span>(date);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@RequiredArgsConstructor
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> UserDao userDao;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> UserCovertor userCovertor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> UserDTO getUser(String userId){
</span></span><span style="display:flex;"><span>        UserDO userDO = userDao.<span style="color:#007f7f">getById</span>(userId);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> userCovertor.<span style="color:#007f7f">toUserDTO</span>(userDO);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”Ÿæˆçš„ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Generated(
</span></span><span style="display:flex;"><span>    value = <span style="color:#0ff;font-weight:bold">&#34;org.mapstruct.ap.MappingProcessor&#34;</span>,
</span></span><span style="display:flex;"><span>    date = <span style="color:#0ff;font-weight:bold">&#34;2023-12-18T20:17:00+0800&#34;</span>,
</span></span><span style="display:flex;"><span>    comments = <span style="color:#0ff;font-weight:bold">&#34;version: 1.3.1.Final, compiler: javac, environment: Java 11.0.12 (GraalVM Community)&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserConvertorImpl <span style="color:#fff;font-weight:bold">implements</span> UserConvertor {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> UserDTO toUserDTO(UserDO userDO) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ( userDO == <span style="color:#fff;font-weight:bold">null</span> ) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        UserDTO userDTO = <span style="color:#fff;font-weight:bold">new</span> UserDTO();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        userDTO.<span style="color:#007f7f">setName</span>( userDO.<span style="color:#007f7f">getName</span>() );
</span></span><span style="display:flex;"><span>        userDTO.<span style="color:#007f7f">setAge</span>( userDO.<span style="color:#007f7f">getAge</span>() );
</span></span><span style="display:flex;"><span>        userDTO.<span style="color:#007f7f">setBirthDay</span>( DateUtil.<span style="color:#007f7f">format</span>( userDO.<span style="color:#007f7f">getBirthDay</span>() ) );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> userDTO;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="çº¿ç¨‹å®‰å…¨é—®é¢˜">çº¿ç¨‹å®‰å…¨é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹å®‰å…¨é—®é¢˜">#</a></h1>
<h2 id="ç†Ÿç»ƒä½¿ç”¨çº¿ç¨‹å®‰å…¨ç±»">ç†Ÿç»ƒä½¿ç”¨çº¿ç¨‹å®‰å…¨ç±»<a hidden class="anchor" aria-hidden="true" href="#ç†Ÿç»ƒä½¿ç”¨çº¿ç¨‹å®‰å…¨ç±»">#</a></h2>
<p>ConcurrentHashMap</p>
<p>åä¾‹ï¼š</p>
<p>map.get ä»¥åŠ map.put æ“ä½œæ˜¯éåŸå­æ“ä½œï¼Œå¤šçº¿ç¨‹å¹¶å‘ä¿®æ”¹çš„æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´ä¸€è‡´æ€§é—®é¢˜ã€‚æ¯”å¦‚çº¿ç¨‹ A è°ƒç”¨ append æ–¹æ³•ï¼Œåœ¨ç¬¬ 6 è¡Œæ—¶ï¼Œçº¿ç¨‹ B åˆ é™¤äº† keyã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ConcurrentHashMapExample {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Map&lt;String, String&gt; map = <span style="color:#fff;font-weight:bold">new</span> ConcurrentHashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> appendIfExists(String key, String suffix) {
</span></span><span style="display:flex;"><span>        String value = map.<span style="color:#007f7f">get</span>(key);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (value != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            map.<span style="color:#007f7f">put</span>(key, value + suffix);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£ä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ConcurrentHashMapExample {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Map&lt;String, String&gt; map = <span style="color:#fff;font-weight:bold">new</span> ConcurrentHashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> append(String key, String suffix) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä½¿ç”¨ computeIfPresent åŸå­æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        map.<span style="color:#007f7f">computeIfPresent</span>(key, (k, v) -&gt; v + suffix);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¿è¯å˜æ›´çš„åŸå­æ€§">ä¿è¯å˜æ›´çš„åŸå­æ€§<a hidden class="anchor" aria-hidden="true" href="#ä¿è¯å˜æ›´çš„åŸå­æ€§">#</a></h2>
<p>åä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Getter
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> NoAtomicDiamondParser {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> <span style="color:#fff;font-weight:bold">int</span> start;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> <span style="color:#fff;font-weight:bold">int</span> end;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> NoAtomicDiamondParser() {
</span></span><span style="display:flex;"><span>        Diamond.<span style="color:#007f7f">addListener</span>(<span style="color:#0ff;font-weight:bold">&#34;dataId&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;groupId&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> ManagerListenerAdapter() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> receiveConfigInfo(String s) {
</span></span><span style="display:flex;"><span>                JSONObject jsonObject = JSON.<span style="color:#007f7f">parseObject</span>(s);
</span></span><span style="display:flex;"><span>                start = jsonObject.<span style="color:#007f7f">getIntValue</span>(<span style="color:#0ff;font-weight:bold">&#34;start&#34;</span>);
</span></span><span style="display:flex;"><span>                end  = jsonObject.<span style="color:#007f7f">getIntValue</span>(<span style="color:#0ff;font-weight:bold">&#34;end&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MyController{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> NoAtomicDiamondParser noAtomicDiamondParser;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handleRange(){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// end è¯»å–çš„æ—§å€¼, start è¯»å–çš„æ–°å€¼, start å¯èƒ½å¤§äº end
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">int</span> end = noAtomicDiamondParser.<span style="color:#007f7f">getEnd</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> start = noAtomicDiamondParser.<span style="color:#007f7f">getStart</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£ä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Getter
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AtomicDiamondParser {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> Range range;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> AtomicDiamondParser() {
</span></span><span style="display:flex;"><span>        Diamond.<span style="color:#007f7f">addListener</span>(<span style="color:#0ff;font-weight:bold">&#34;dataId&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;groupId&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> ManagerListenerAdapter() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> receiveConfigInfo(String s) {
</span></span><span style="display:flex;"><span>                range = JSON.<span style="color:#007f7f">parseObject</span>(s, Range.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Data
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> Range {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> start;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> end;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MyController {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> AtomicDiamondParser atomicDiamondParser;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handleRange() {
</span></span><span style="display:flex;"><span>        Range range = atomicDiamondParser.<span style="color:#007f7f">getRange</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(range.<span style="color:#007f7f">getStart</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(range.<span style="color:#007f7f">getEnd</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä½¿ç”¨ä¸å¯å˜å¯¹è±¡">ä½¿ç”¨ä¸å¯å˜å¯¹è±¡<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨ä¸å¯å˜å¯¹è±¡">#</a></h2>
<p>å½“ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œé‚£è¿™ä¸ªå¯¹è±¡å†…å°±è‡ªç„¶ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ï¼Œé‚£å°±å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ç§æ–¹å¼é€‚ç”¨äºç®€å•çš„å€¼å¯¹è±¡ç±»å‹ï¼Œå¸¸è§çš„ä¾‹å­å°±æ˜¯ java ä¸­çš„ <code>String</code> å’Œ <code>BigDecimal</code>ã€‚å¯¹äºä¸Šé¢ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°† <code>Range</code> è®¾è®¡ä¸ºä¸€ä¸ªé€šç”¨çš„å€¼å¯¹è±¡ã€‚</p>
<p>æ­£ä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Getter
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AtomicDiamondParser {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> Range range;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> AtomicDiamondParser() {
</span></span><span style="display:flex;"><span>        Diamond.<span style="color:#007f7f">addListener</span>(<span style="color:#0ff;font-weight:bold">&#34;dataId&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;groupId&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> ManagerListenerAdapter() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> receiveConfigInfo(String s) {
</span></span><span style="display:flex;"><span>                JSONObject jsonObject = JSON.<span style="color:#007f7f">parseObject</span>(s);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">int</span> start = jsonObject.<span style="color:#007f7f">getIntValue</span>(<span style="color:#0ff;font-weight:bold">&#34;start&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">int</span> end  = jsonObject.<span style="color:#007f7f">getIntValue</span>(<span style="color:#0ff;font-weight:bold">&#34;end&#34;</span>);
</span></span><span style="display:flex;"><span>                range = <span style="color:#fff;font-weight:bold">new</span> Range(start, end);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// lombok æ³¨è§£ä¼šä¿è¯ Range ç±»çš„ä¸å˜æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    @Value
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> Range {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> start;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> end;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ­£ç¡®æ€§ä¼˜å…ˆäºæ€§èƒ½">æ­£ç¡®æ€§ä¼˜å…ˆäºæ€§èƒ½<a hidden class="anchor" aria-hidden="true" href="#æ­£ç¡®æ€§ä¼˜å…ˆäºæ€§èƒ½">#</a></h2>
<p>ä¸è¦å› ä¸ºæ‹…å¿ƒæ€§èƒ½é—®é¢˜è€Œæ”¾å¼ƒä½¿ç”¨ <code>synchronized</code>ï¼Œ<code>volatile</code> ç­‰å…³é”®å­—ï¼Œæˆ–è€…é‡‡ç”¨ä¸€äº›éå¸¸è§„å†™æ³•</p>
<p><strong>åä¾‹ åŒé‡æ£€æŸ¥é”ï¼š</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Foo { 
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ç¼ºå°‘ volatile å…³é”®å­—
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">private</span> Helper helper = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Helper getHelper() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (helper == <span style="color:#fff;font-weight:bold">null</span>) 
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">synchronized</span>(<span style="color:#fff;font-weight:bold">this</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (helper == <span style="color:#fff;font-weight:bold">null</span>) 
</span></span><span style="display:flex;"><span>                helper = <span style="color:#fff;font-weight:bold">new</span> Helper();
</span></span><span style="display:flex;"><span>        }    
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> helper;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œåœ¨ helper å­—æ®µä¸Šå¢åŠ  volatile å…³é”®å­—ï¼Œèƒ½å¤Ÿåœ¨ java 5 åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>æ­£ä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Foo {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> Helper helper = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Helper getHelper() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (helper == <span style="color:#fff;font-weight:bold">null</span>) 
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">synchronized</span>(<span style="color:#fff;font-weight:bold">this</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (helper == <span style="color:#fff;font-weight:bold">null</span>) 
</span></span><span style="display:flex;"><span>                helper = <span style="color:#fff;font-weight:bold">new</span> Helper();
</span></span><span style="display:flex;"><span>        }    
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> helper;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£ä¾‹3ï¼ˆæ¨èï¼‰ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Foo { 
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Helper helper = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">synchronized</span> Helper getHelper() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (helper == <span style="color:#fff;font-weight:bold">null</span>) 
</span></span><span style="display:flex;"><span>            helper = <span style="color:#fff;font-weight:bold">new</span> Helper();
</span></span><span style="display:flex;"><span>    }    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> helper;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¹¶ä¸ä¸¥è°¨çš„ <strong>Diamond Parserï¼š</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * çœç•¥å¼‚å¸¸å¤„ç†ç­‰å…¶ä»–é€»è¾‘
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span>@Getter
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DiamondParser {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ç¼ºå°‘ volatile å…³é”®å­—
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">private</span> Config config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> DiamondParser() {
</span></span><span style="display:flex;"><span>        Diamond.<span style="color:#007f7f">addListener</span>(<span style="color:#0ff;font-weight:bold">&#34;dataId&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;groupId&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> ManagerListenerAdapter() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> receiveConfigInfo(String s) {
</span></span><span style="display:flex;"><span>                config = JSON.<span style="color:#007f7f">parseObject</span>(s, Config.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Data
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> Config {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§ Diamond å†™æ³•å¯èƒ½ä»æ¥æ²¡æœ‰å‘ç”Ÿè¿‡çº¿ä¸Šé—®é¢˜ï¼Œä½†è¿™ç§å†™æ³•ä¹Ÿç¡®å®æ˜¯ä¸ç¬¦åˆ JVM çº¿ç¨‹å®‰å…¨åŸåˆ™ã€‚æœªæ¥æŸä¸€å¤©ä½ çš„ä»£ç è·‘åœ¨å¦ä¸€ä¸ª JVM å®ç°ä¸Šï¼Œå¯èƒ½å°±æœ‰é—®é¢˜äº†ã€‚</p>
<h1 id="çº¿ç¨‹æ± ä½¿ç”¨ä¸å½“">çº¿ç¨‹æ± ä½¿ç”¨ä¸å½“<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± ä½¿ç”¨ä¸å½“">#</a></h1>
<p>åä¾‹ 1ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadPoolExample {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ²¡æœ‰ä»»ä½•é™åˆ¶çš„çº¿ç¨‹æ± , ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿, ä½†å½“ä¸€æ³¢è¯·æ±‚é«˜å³°åˆ°è¾¾æ—¶, å¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹, å¯¼è‡´ç³»ç»Ÿå´©æºƒ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> Executor executor = Executors.<span style="color:#007f7f">newCachedThreadPool</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åä¾‹2ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> StreamParallelExample {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> List&lt;String&gt; batchQuery(List&lt;String&gt; ids){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// çœ‹ä¸Šå»å¾ˆä¼˜é›…, ä½† ForkJoinPool çš„é˜Ÿåˆ—æ˜¯æ²¡æœ‰å¤§å°é™åˆ¶çš„, å¹¶ä¸”çº¿ç¨‹æ•°é‡å¾ˆå°‘, å¦‚æœ ids åˆ—è¡¨å¾ˆå¤§å¯èƒ½å¯¼è‡´ OOM
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">// parallelStream æ›´é€‚åˆè®¡ç®—å¯†é›†å‹ä»»åŠ¡, ä¸è¦åœ¨ä»»åŠ¡ä¸­åšè¿œç¨‹è°ƒç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">return</span> ids.<span style="color:#007f7f">parallelStream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">map</span>(<span style="color:#fff;font-weight:bold">this</span>::queryFromRemote)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String queryFromRemote(String id){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä»è¿œç¨‹æŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£ä¾‹ï¼šæ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ManualCreateThreadPool {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ‰‹åŠ¨åˆ›å»ºèµ„æºæœ‰é™çš„çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">private</span> Executor executor = <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(<span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">1</span>, TimeUnit.<span style="color:#007f7f">MINUTES</span>, <span style="color:#fff;font-weight:bold">new</span> ArrayBlockingQueue&lt;&gt;(<span style="color:#ff0;font-weight:bold">1000</span>),
</span></span><span style="display:flex;"><span>                                                       <span style="color:#fff;font-weight:bold">new</span> ThreadFactoryBuilder().<span style="color:#007f7f">setNameFormat</span>(<span style="color:#0ff;font-weight:bold">&#34;work-%d&#34;</span>).<span style="color:#007f7f">build</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="å¼‚å¸¸å¤„ç†ä¸å½“">å¼‚å¸¸å¤„ç†ä¸å½“<a hidden class="anchor" aria-hidden="true" href="#å¼‚å¸¸å¤„ç†ä¸å½“">#</a></h1>
<p>å’Œ NPE ä¸€æ ·ï¼Œå¼‚å¸¸å¤„ç†ä¹ŸåŒæ ·æ˜¯æˆ‘ä»¬æ¯å¤©éƒ½éœ€è¦é¢å¯¹çš„é—®é¢˜ï¼Œä½†å¾ˆå¤šä»£ç ä¸­å¾€å¾€ä¼šå‡ºç°ï¼š</p>
<p>åä¾‹ 1ï¼š</p>
<p>é‡å¤ä¸”ç¹ççš„çš„å¼‚å¸¸å¤„ç†é€»è¾‘</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Slf4j
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DuplicatedExceptionHandlerExample {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User query(String id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> userService.<span style="color:#007f7f">query</span>(id);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            log.<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;query error, userId: {}&#34;</span>, id, e);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User create(String id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> userService.<span style="color:#007f7f">create</span>(id);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            log.<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;query error, userId: {}&#34;</span>, id, e);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åä¾‹ 2ï¼š</p>
<p>å¼‚å¸¸è¢«åæ‰æˆ–è€…ä¸¢å¤±éƒ¨åˆ†ä¿¡æ¯</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Slf4j
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ExceptionShouldLogOrThrowExample {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User query(String id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> userService.<span style="color:#007f7f">query</span>(id);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¼‚å¸¸è¢«åå¹¶, é—®é¢˜è¢«éšè—
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User create(String id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> userService.<span style="color:#007f7f">create</span>(id);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å †æ ˆä¸¢å¤±, åç»­éš¾ä»¥å®šä½é—®é¢˜
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            log.<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;query error, userId: {}, error: {}&#34;</span>, id,e.<span style="color:#007f7f">getMessage</span>() );
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åä¾‹ 3ï¼šå¯¹å¤–æŠ›å‡ºæœªçŸ¥å¼‚å¸¸, å¯¼è‡´è°ƒç”¨æ–¹åºåˆ—åŒ–å¤±è´¥</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> OpenAPIService {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// HSF æœåŠ¡å¯¹å¤–æŠ›å‡º client ä¸­æœªå®šä¹‰çš„å¼‚å¸¸, è°ƒç”¨æ–¹ååºåˆ—åŒ–å¤±è´¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> InternalSystemException(<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é€šè¿‡-aop-ç»Ÿä¸€å¼‚å¸¸å¤„ç†">é€šè¿‡ AOP ç»Ÿä¸€å¼‚å¸¸å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#é€šè¿‡-aop-ç»Ÿä¸€å¼‚å¸¸å¤„ç†">#</a></h2>
<ul>
<li>æœªçŸ¥å¼‚å¸¸æŠ›ç»™è°ƒç”¨æ–¹, å°†æœªçŸ¥å¼‚å¸¸è½¬ä¸º Result æˆ–è€…é€šç”¨å¼‚å¸¸ç±»å‹</li>
<li>ç»Ÿä¸€å¼‚å¸¸æ—¥å¿—çš„æ‰“å°å’Œç›‘æ§</li>
</ul>
<h2 id="å¤„ç†-checked-exception">å¤„ç† Checked Exception<a hidden class="anchor" aria-hidden="true" href="#å¤„ç†-checked-exception">#</a></h2>
<p>Checked Exception æ˜¯åœ¨ç¼–è¯‘æœŸè¦æ±‚å¿…é¡»å¤„ç†çš„å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯é RuntimeException ç±»å‹çš„å¼‚å¸¸ï¼Œä½† Java Checked çš„å¼‚å¸¸ç»™æ¥å£çš„è°ƒç”¨è€…é€ æˆäº†ä¸€å®šçš„è´Ÿæ‹…ï¼Œå¯¼è‡´å¼‚å¸¸å£°æ˜å±‚å±‚ä¼ é€’ï¼Œå¦‚æœé¡¶å±‚èƒ½å¤Ÿå¤„ç†è¯¥å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ lombok çš„ <code>@SneakyThrows</code> æ³¨è§£è§„é¿ Checked exception</p>
<h2 id="try-catch-çº¿ç¨‹é€»è¾‘">Try catch çº¿ç¨‹é€»è¾‘<a hidden class="anchor" aria-hidden="true" href="#try-catch-çº¿ç¨‹é€»è¾‘">#</a></h2>
<p>åä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@RequiredArgsConstructor
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadNotTryCatch {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> ExecutorService executorService;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle() {
</span></span><span style="display:flex;"><span>        executorService.<span style="color:#007f7f">submit</span>(<span style="color:#fff;font-weight:bold">new</span> Runnable() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// æœªæ•è·å¼‚å¸¸, çº¿ç¨‹ç›´æ¥é€€å‡º, å¼‚å¸¸ä¿¡æ¯ä¸¢å¤±
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                remoteInvoke();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£ä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@RequiredArgsConstructor
</span></span><span style="display:flex;"><span>@Slf4j
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadNotTryCatch {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> ExecutorService executorService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle() {
</span></span><span style="display:flex;"><span>        executorService.<span style="color:#007f7f">submit</span>(<span style="color:#fff;font-weight:bold">new</span> Runnable() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                    remoteInvoke();
</span></span><span style="display:flex;"><span>                } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>                    log.<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;handle failed&#34;</span>, e);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ç‰¹æ®Šå¼‚å¸¸çš„å¤„ç†">ç‰¹æ®Šå¼‚å¸¸çš„å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#ç‰¹æ®Šå¼‚å¸¸çš„å¤„ç†">#</a></h2>
<p>InterruptedException ä¸€èˆ¬æ˜¯ä¸Šå±‚è°ƒåº¦è€…ä¸»åŠ¨å‘èµ·çš„ä¸­æ–­ä¿¡å·ï¼Œä¾‹å¦‚æŸä¸ªä»»åŠ¡æ‰§è¡Œè¶…æ—¶ï¼Œé‚£ä¹ˆè°ƒåº¦è€…é€šè¿‡å°†çº¿ç¨‹ç½®ä¸º interuppted æ¥ä¸­æ–­ä»»åŠ¡ï¼Œå¯¹äºè¿™ç±»å¼‚å¸¸æˆ‘ä»¬ä¸åº”è¯¥åœ¨ catch ä¹‹åå¿½ç•¥ï¼Œåº”è¯¥å‘ä¸ŠæŠ›å‡ºæˆ–è€…å°†å½“å‰çº¿ç¨‹ç½®ä¸º interupptedã€‚</p>
<p><strong>åä¾‹ï¼š</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> InterruptedExceptionExample {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> ExecutorService executorService = Executors.<span style="color:#007f7f">newSingleThreadExecutor</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handleWithTimeout() <span style="color:#fff;font-weight:bold">throws</span> InterruptedException {
</span></span><span style="display:flex;"><span>        Future&lt;?&gt; future = executorService.<span style="color:#007f7f">submit</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// sleep æ¨¡æ‹Ÿå¤„ç†é€»è¾‘
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                Thread.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">1000</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;interrupted&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;continue task&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¼‚å¸¸è¢«å¿½ç•¥, ç»§ç»­å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ç­‰å¾…ä»»åŠ¡ç»“æœ, å¦‚æœè¶…è¿‡ 500ms åˆ™ä¸­æ–­
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Thread.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">500</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!future.<span style="color:#007f7f">isDone</span>()) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;cancel&#34;</span>);
</span></span><span style="display:flex;"><span>            future.<span style="color:#007f7f">cancel</span>(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é¿å…-catch-error">é¿å… catch Error<a hidden class="anchor" aria-hidden="true" href="#é¿å…-catch-error">#</a></h2>
<p>ä¸è¦åå¹¶ Errorï¼ŒError è®¾è®¡æœ¬èº«å°±æ˜¯åŒºåˆ«äºå¼‚å¸¸ï¼Œä¸€èˆ¬ä¸åº”è¯¥è¢« catchï¼Œæ›´ä¸èƒ½è¢«åæ‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒOOM æœ‰å¯èƒ½å‘ç”Ÿåœ¨ä»»æ„ä»£ç ä½ç½®ï¼Œå¦‚æœåå¹¶ Errorï¼Œè®©ç¨‹åºç»§ç»­è¿è¡Œï¼Œé‚£ä¹ˆä»¥ä¸‹ä»£ç çš„ start å’Œ end å°±æ— æ³•ä¿è¯ä¸€è‡´æ€§ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ErrorExample {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Date start;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Date end;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">synchronized</span> <span style="color:#fff;font-weight:bold">void</span> update(<span style="color:#fff;font-weight:bold">long</span> start, <span style="color:#fff;font-weight:bold">long</span> end) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (start &gt; end) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalArgumentException(<span style="color:#0ff;font-weight:bold">&#34;start after end&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">start</span> = <span style="color:#fff;font-weight:bold">new</span> Date(start);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¦‚æœ new Date(end) å‘ç”Ÿ OOM, start æœ‰å¯èƒ½å¤§äº end
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">end</span> = <span style="color:#fff;font-weight:bold">new</span> Date(end);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="spring-bean-éšå¼ä¾èµ–">Spring Bean éšå¼ä¾èµ–<a hidden class="anchor" aria-hidden="true" href="#spring-bean-éšå¼ä¾èµ–">#</a></h1>
<h2 id="åä¾‹-1-springcontext-ä½œä¸ºé™æ€å˜é‡">åä¾‹ 1: SpringContext ä½œä¸ºé™æ€å˜é‡<a hidden class="anchor" aria-hidden="true" href="#åä¾‹-1-springcontext-ä½œä¸ºé™æ€å˜é‡">#</a></h2>
<p>UserController å’Œ SpringContextUtils ç±»æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œ SpringContextUtils.getApplication() å¯èƒ½è¿”å›ç©ºã€‚å¹¶ä¸” Spring éä¾èµ–å…³ç³»çš„ Bean ä¹‹é—´çš„åˆå§‹åŒ–é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œè™½ç„¶å¯èƒ½å½“å‰åˆå§‹åŒ–é¡ºåºæ°å¥½ç¬¦åˆæœŸæœ›ï¼Œä½†åç»­å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SpringContextUtils {
</span></span><span style="display:flex;"><span>    @Getter
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> ApplicationContext applicationContext;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> SpringContextUtils(ApplicationContext context) {
</span></span><span style="display:flex;"><span>        applicationContext = context;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserController {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(){
</span></span><span style="display:flex;"><span>        MyService bean = SpringContextUtils.<span style="color:#007f7f">getApplicationContext</span>().<span style="color:#007f7f">getBean</span>(MyService.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åä¾‹ 2: Switch åœ¨ Spring Bean ä¸­æ³¨å†Œ, ä½†é€šè¿‡é™æ€æ–¹å¼è¯»å–</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SwitchConfig {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PostConstruct
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> init() {
</span></span><span style="display:flex;"><span>        SwitchManager.<span style="color:#007f7f">register</span>(<span style="color:#0ff;font-weight:bold">&#34;appName&#34;</span>, MySwitch.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> MySwitch {
</span></span><span style="display:flex;"><span>        @AppSwitch(des = <span style="color:#0ff;font-weight:bold">&#34;config&#34;</span>, level = Switch.<span style="color:#007f7f">Level</span>.<span style="color:#007f7f">p1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> String config;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserController{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getConfig(){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// UserController å’Œ SwitchConfig ç±»æ²¡æœ‰ä¾èµ–å…³ç³», MySwitch.config å¯èƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">return</span> MySwitch.<span style="color:#007f7f">config</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£ä¾‹ï¼š é€šè¿‡ SpringBeanFactory ä¿è¯åˆå§‹åŒ–é¡ºåºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> PreInitializer <span style="color:#fff;font-weight:bold">implements</span> BeanFactoryPostProcessor, PriorityOrdered {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> getOrder() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Ordered.<span style="color:#007f7f">HIGHEST_PRECEDENCE</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> postProcessBeanFactory(
</span></span><span style="display:flex;"><span>        ConfigurableListableBeanFactory beanFactory) <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            SwitchManager.<span style="color:#007f7f">init</span>(<span style="color:#f00">åº”ç”¨å</span>, <span style="color:#f00">å¼€å…³ç±»</span>.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (SwitchCenterException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ­¤å¤„æŠ›é”™æœ€å¥½é˜»æ–­ç¨‹åºå¯åŠ¨ï¼Œé¿å…å¼€å…³è¯»ä¸åˆ°æŒä¹…å€¼å¼•å‘é—®é¢˜
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        } <span style="color:#fff;font-weight:bold">catch</span> (SwitchCenterError e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">exit</span>(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SpringContextUtilPostProcessor <span style="color:#fff;font-weight:bold">implements</span> BeanFactoryPostProcessor, PriorityOrdered, ApplicationContextAware {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> ApplicationContext applicationContext;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> getOrder() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Ordered.<span style="color:#007f7f">HIGHEST_PRECEDENCE</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>        SpringContextUtils.<span style="color:#007f7f">setApplicationContext</span>(applicationContext);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setApplicationContext(ApplicationContext applicationContext) <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">applicationContext</span> = applicationContext;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="å†…å­˜èµ„æºæ³„æ¼">å†…å­˜/èµ„æºæ³„æ¼<a hidden class="anchor" aria-hidden="true" href="#å†…å­˜èµ„æºæ³„æ¼">#</a></h1>
<p>è™½ç„¶ JVM æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä½†å¹¶ä¸æ„å‘³ç€å†…å­˜æ³„æ¼é—®é¢˜ä¸å­˜åœ¨ï¼Œä¸€èˆ¬å†…å­˜æ³„æ¼å‘ç”Ÿåœ¨åœ¨é•¿æ—¶é—´æŒå¯¹è±¡æ— æ³•é‡Šæ”¾çš„åœºæ™¯ï¼Œæ¯”å¦‚é™æ€é›†åˆï¼Œå†…å­˜ä¸­çš„ç¼“å­˜æ•°æ®ï¼Œè¿è¡Œæ—¶ç±»ç”ŸæˆæŠ€æœ¯ç­‰ã€‚</p>
<h2 id="loadingcache-ä»£æ›¿å…¨å±€-map">LoadingCache ä»£æ›¿å…¨å±€ Map<a hidden class="anchor" aria-hidden="true" href="#loadingcache-ä»£æ›¿å…¨å±€-map">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Service
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MetaInfoManager {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¯¹äºå°‘é‡çš„å…ƒæ•°æ®æ¥è¯´, æ”¾åˆ°å†…å­˜ä¸­ä¼¼ä¹å¹¶æ— å¤§ç¢, ä½†å¦‚æœåç»­å…ƒæ•°æ®é‡å¢å¤§, åˆ™å¤§é‡å¯¹è±¡åˆ™å†…å­˜ä¸­æ— æ³•é‡Šæ”¾, å¯¼è‡´å†…å­˜æ³„æ¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">private</span> Map&lt;String, MetaInfo&gt; cache = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> MetaInfo getMetaInfo(String id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> cache.<span style="color:#007f7f">computeIfAbsent</span>(id, k -&gt; loadFromRemote(id));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> LoadingCache&lt;String, MetaInfo&gt; loadingCache = CacheBuilder.<span style="color:#007f7f">newBuilder</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// loadingCache è®¾ç½®æœ€å¤§ size æˆ–è€…è¿‡æœŸæ—¶é—´, èƒ½å¤Ÿé™åˆ¶ç¼“å­˜æ¡ç›®çš„æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        .<span style="color:#007f7f">maximumSize</span>(<span style="color:#ff0;font-weight:bold">1000</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">build</span>(<span style="color:#fff;font-weight:bold">new</span> CacheLoader&lt;String, MetaInfo&gt;() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> MetaInfo load(String key) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> loadFromRemote(key);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> MetaInfo getMetaInfoFromLoadingCache(String id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> loadingCache.<span style="color:#007f7f">getUnchecked</span>(id);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> MetaInfo loadFromRemote(String id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Data
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> MetaInfo {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> String id;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è°¨æ…ä½¿ç”¨è¿è¡Œæ—¶ç±»ç”ŸæˆæŠ€æœ¯">è°¨æ…ä½¿ç”¨è¿è¡Œæ—¶ç±»ç”ŸæˆæŠ€æœ¯<a hidden class="anchor" aria-hidden="true" href="#è°¨æ…ä½¿ç”¨è¿è¡Œæ—¶ç±»ç”ŸæˆæŠ€æœ¯">#</a></h2>
<p>Cglib, Javasisit æˆ–è€… Groovy è„šæœ¬ä¼šåœ¨è¿è¡Œæ—¶åˆ›å»ºä¸´æ—¶ç±», Jvm å¯¹äºç±»çš„å›æ”¶æ¡ä»¶ååˆ†è‹›åˆ», æ‰€ä»¥è¿™äº›ä¸´æ—¶ç±»åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½ä¸ä¼šå›æ”¶, ç›´åˆ°è§¦å‘ FullGCã€‚</p>
<h2 id="ä½¿ç”¨-java-8-try-wiht-resource-è¯­æ³•">ä½¿ç”¨ Java 8 try wiht Resource è¯­æ³•ï¼š<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨-java-8-try-wiht-resource-è¯­æ³•">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TryWithResourceExample {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> (InputStream in = Files.<span style="color:#007f7f">newInputStream</span>(Paths.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>))) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// read
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="æ€§èƒ½é—®é¢˜">æ€§èƒ½é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#æ€§èƒ½é—®é¢˜">#</a></h1>
<h2 id="url-çš„-hashcodeeuqals-æ–¹æ³•"><code>URL</code> çš„ <code>hashCodeã€euqals</code> æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#url-çš„-hashcodeeuqals-æ–¹æ³•">#</a></h2>
<p>URL çš„ hashCodeï¼Œequals æ–¹æ³•çš„å®ç°æ¶‰åŠåˆ°äº†å¯¹åŸŸå ip åœ°å€è§£æï¼Œæ‰€ä»¥åœ¨æ˜¾ç¤ºè°ƒç”¨æˆ–è€…æ”¾åˆ° Map è¿™æ ·çš„æ•°æ®ç»“æ„ä¸­ï¼Œæœ‰å¯èƒ½è§¦å‘è¿œç¨‹è°ƒç”¨ã€‚ç”¨ URI ä»£æ›¿ URL åˆ™å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>åä¾‹1ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> URLExample {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(URL a, URL b) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (Objects.<span style="color:#007f7f">equals</span>(a, b)) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åä¾‹ 2ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> URLMapExample {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> Map&lt;URL, Object&gt; urlObjectMap = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¾ªç¯è¿œç¨‹è°ƒç”¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HSFLoopInvokeExample {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @HSFConsumer
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> List&lt;User&gt; batchQuery(List&lt;String&gt; ids){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä½¿ç”¨æ‰¹é‡æ¥å£æˆ–è€…é™åˆ¶æ‰¹é‡å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">return</span> ids.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">map</span>(userService::getUser)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äº†è§£å¸¸è§æ€§èƒ½æŒ‡æ ‡ç“¶é¢ˆ">äº†è§£å¸¸è§æ€§èƒ½æŒ‡æ ‡&amp;ç“¶é¢ˆ<a hidden class="anchor" aria-hidden="true" href="#äº†è§£å¸¸è§æ€§èƒ½æŒ‡æ ‡ç“¶é¢ˆ">#</a></h2>
<p>äº†è§£ä¸€äº›åŸºç¡€æ€§èƒ½æŒ‡æ ‡ï¼Œæœ‰åŠ©äºæˆ‘ä»¬å‡†ç¡®è¯„ä¼°å½“å‰é—®é¢˜çš„æ€§èƒ½ç“¶é¢ˆï¼Œè¿™é‡Œæ¨èçœ‹ä¸€ä¸‹ã€Šæ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥çŸ¥é“çš„å»¶è¿Ÿæ•°å­—ã€‹ã€‚æ¯”å¦‚å°†å­—æ®µè®¾ç½®ä¸º volatileï¼Œç›¸å½“äºæ¯æ¬¡éƒ½éœ€è¦è¯»ä¸»å­˜ï¼Œè¯»ä¸»å­˜æ€§èƒ½å¤§æ¦‚åœ¨çº³ç§’çº§åˆ«ï¼Œåœ¨ä¸€æ¬¡ HSF è°ƒç”¨ä¸­ä¸å¤ªå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚åå°„ç›¸æ¯”æ™®é€šæ“ä½œå¤šå‡ æ¬¡å†…å­˜è¯»å–ï¼Œä¸€èˆ¬è®¤ä¸ºæ€§èƒ½è¾ƒå·®ï¼Œä½†æ˜¯åŒç†åœ¨ä¸€æ¬¡ HSF è°ƒç”¨ä¸­ä¹Ÿä¸å¤ªå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</p>
<p>åœ¨æœåŠ¡ç«¯å¼€å‘ä¸­, æ€§èƒ½ç“¶é¢ˆä¸€èˆ¬é›†ä¸­åœ¨ï¼š</p>
<ul>
<li>å¤§é‡æ—¥å¿—æ‰“å°</li>
<li>å¤§å¯¹è±¡åºåˆ—åŒ–</li>
<li>ç½‘ç»œè°ƒç”¨: æ¯”å¦‚ HSFï¼ŒHTTP ç­‰è¿œç¨‹è°ƒç”¨</li>
<li>æ•°æ®åº“æ“ä½œ</li>
</ul>
<h2 id="ä½¿ç”¨ä¸“ä¸šæ€§èƒ½æµ‹è¯•å·¥å…·ä¼°æ€§èƒ½">ä½¿ç”¨ä¸“ä¸šæ€§èƒ½æµ‹è¯•å·¥å…·ä¼°æ€§èƒ½<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨ä¸“ä¸šæ€§èƒ½æµ‹è¯•å·¥å…·ä¼°æ€§èƒ½">#</a></h2>
<p>ä¸è¦å°è¯•è‡ªå·±å®ç°ä¸€ä¸ªç®€é™‹çš„æ€§èƒ½æµ‹è¯•ï¼Œåœ¨æµ‹è¯•ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨ï¼ŒJVMï¼Œ æ“ä½œç³»ç»Ÿå„ä¸ªå±‚çº§ä¸Šéƒ½æœ‰å¯èƒ½å­˜åœ¨ä½ æ„æ–™ä¹‹å¤–çš„ä¼˜åŒ–ï¼Œå¯¼è‡´æµ‹è¯•ç»“æœè¿‡äºä¹è§‚ã€‚å»ºè®®ä½¿ç”¨ jmhï¼Œarthas ç«ç„°å›¾ï¼Œè¿™æ ·çš„ä¸“ä¸šå·¥å…·åšæ€§èƒ½æµ‹è¯•</p>
<p>åä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ManualPerformanceTest {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testPerformance() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span> start = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">1000</span>; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è¿™é‡Œ mutiply æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨, æœ‰å¯èƒ½è¢«ä¼˜åŒ–ä¹‹åè¢«å¹²æ‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            mutiply(<span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">10</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;avg rt: &#34;</span> + (System.<span style="color:#007f7f">currentTimeMillis</span>() - start) / <span style="color:#ff0;font-weight:bold">1000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> mutiply(<span style="color:#fff;font-weight:bold">int</span> a, <span style="color:#fff;font-weight:bold">int</span> b) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> a * b;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£ä¾‹:</p>
<ul>
<li>
<p>ä½¿ç”¨ç«ç„°å›¾</p>
</li>
<li>
<p>ä½¿ç”¨ jmh è¯„ä¼°æ€§èƒ½</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Warmup(iterations = <span style="color:#ff0;font-weight:bold">5</span>, time = <span style="color:#ff0;font-weight:bold">1</span>, timeUnit = TimeUnit.<span style="color:#007f7f">SECONDS</span>)
</span></span><span style="display:flex;"><span>@Measurement(iterations = <span style="color:#ff0;font-weight:bold">5</span>, time = <span style="color:#ff0;font-weight:bold">1</span>, timeUnit = TimeUnit.<span style="color:#007f7f">SECONDS</span>)
</span></span><span style="display:flex;"><span>@Fork(<span style="color:#ff0;font-weight:bold">3</span>)
</span></span><span style="display:flex;"><span>@BenchmarkMode(Mode.<span style="color:#007f7f">AverageTime</span>)
</span></span><span style="display:flex;"><span>@OutputTimeUnit(TimeUnit.<span style="color:#007f7f">NANOSECONDS</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JMHExample {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Benchmark
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testPerformance(Blackhole bh) {
</span></span><span style="display:flex;"><span>        bh.<span style="color:#007f7f">consume</span>(mutiply(<span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">10</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> mutiply(<span style="color:#fff;font-weight:bold">int</span> a, <span style="color:#fff;font-weight:bold">int</span> b) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> a * b;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h1 id="spring-äº‹åŠ¡é—®é¢˜"><strong>Spring äº‹åŠ¡é—®é¢˜</strong><a hidden class="anchor" aria-hidden="true" href="#spring-äº‹åŠ¡é—®é¢˜">#</a></h1>
<p>æ³¨æ„äº‹åŠ¡æ³¨è§£å¤±æ•ˆçš„åœºæ™¯</p>
<p>å½“æ‰“ä¸Š @Transactional æ³¨è§£çš„ spring bean è¢«æ³¨å…¥æ—¶ï¼Œspring ä¼šç”¨äº‹åŠ¡ä»£ç†è¿‡çš„å¯¹è±¡ä»£æ›¿åŸå¯¹è±¡æ³¨å…¥ã€‚</p>
<p>ä½†æ˜¯å¦‚æœæ³¨è§£æ–¹æ³•è¢«åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„å¦ä¸€ä¸ªæ–¹æ³•é‡Œé¢è°ƒç”¨ï¼Œåˆ™è¯¥è°ƒç”¨æ— æ³•è¢« Spring å¹²é¢„ï¼Œè‡ªç„¶äº‹åŠ¡æ³¨è§£ä¹Ÿå°±å¤±æ•ˆäº†ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TransactionNotWork {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doTheThing() {
</span></span><span style="display:flex;"><span>        actuallyDoTheThing();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Transactional
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> actuallyDoTheThing() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://funny-toffee-4aa7c3.netlify.app/tags/java/">java</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://funny-toffee-4aa7c3.netlify.app/">Wjy&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>