<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>æ‰‹å†™Tomcat | Wjy&#39;s Blog</title>
<meta name="keywords" content="java">
<meta name="description" content="å¯¹äºJavaåç«¯å¼€å‘çš„åŒå­¦æ¥è¯´ï¼ŒTomcatæœåŠ¡å™¨è‚¯å®šä¸é™Œç”Ÿã€‚å¼€å‘Java Web Appï¼Œæœ€åé€šå¸¸éƒ½ä¼šéƒ¨ç½²åˆ°Tomcatè¿™æ ·çš„æœåŠ¡å™¨ä¸Šã€‚ å¾ˆå¤šåŒå­¦å¯">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://funny-toffee-4aa7c3.netlify.app/posts/java/%E6%89%8B%E5%86%99tomcat/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://funny-toffee-4aa7c3.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://funny-toffee-4aa7c3.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://funny-toffee-4aa7c3.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://funny-toffee-4aa7c3.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://funny-toffee-4aa7c3.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="æ‰‹å†™Tomcat" />
<meta property="og:description" content="å¯¹äºJavaåç«¯å¼€å‘çš„åŒå­¦æ¥è¯´ï¼ŒTomcatæœåŠ¡å™¨è‚¯å®šä¸é™Œç”Ÿã€‚å¼€å‘Java Web Appï¼Œæœ€åé€šå¸¸éƒ½ä¼šéƒ¨ç½²åˆ°Tomcatè¿™æ ·çš„æœåŠ¡å™¨ä¸Šã€‚ å¾ˆå¤šåŒå­¦å¯" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://funny-toffee-4aa7c3.netlify.app/posts/java/%E6%89%8B%E5%86%99tomcat/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-06T18:18:52+00:00" />
<meta property="article:modified_time" content="2024-03-06T18:18:52+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="æ‰‹å†™Tomcat"/>
<meta name="twitter:description" content="å¯¹äºJavaåç«¯å¼€å‘çš„åŒå­¦æ¥è¯´ï¼ŒTomcatæœåŠ¡å™¨è‚¯å®šä¸é™Œç”Ÿã€‚å¼€å‘Java Web Appï¼Œæœ€åé€šå¸¸éƒ½ä¼šéƒ¨ç½²åˆ°Tomcatè¿™æ ·çš„æœåŠ¡å™¨ä¸Šã€‚ å¾ˆå¤šåŒå­¦å¯"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "æ‰‹å†™Tomcat",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/java/%E6%89%8B%E5%86%99tomcat/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "æ‰‹å†™Tomcat",
  "name": "æ‰‹å†™Tomcat",
  "description": "å¯¹äºJavaåç«¯å¼€å‘çš„åŒå­¦æ¥è¯´ï¼ŒTomcatæœåŠ¡å™¨è‚¯å®šä¸é™Œç”Ÿã€‚å¼€å‘Java Web Appï¼Œæœ€åé€šå¸¸éƒ½ä¼šéƒ¨ç½²åˆ°Tomcatè¿™æ ·çš„æœåŠ¡å™¨ä¸Šã€‚ å¾ˆå¤šåŒå­¦å¯",
  "keywords": [
    "java"
  ],
  "articleBody": "å¯¹äºJavaåç«¯å¼€å‘çš„åŒå­¦æ¥è¯´ï¼ŒTomcatæœåŠ¡å™¨è‚¯å®šä¸é™Œç”Ÿã€‚å¼€å‘Java Web Appï¼Œæœ€åé€šå¸¸éƒ½ä¼šéƒ¨ç½²åˆ°Tomcatè¿™æ ·çš„æœåŠ¡å™¨ä¸Šã€‚\nå¾ˆå¤šåŒå­¦å¯èƒ½è§‰å¾—å¼€å‘Web Appæ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œå¼€å‘WebæœåŠ¡å™¨å°±æ¯”è¾ƒå›°éš¾äº†ã€‚å®é™…ä¸Šï¼Œè™½ç„¶å¼€å‘WebæœåŠ¡å™¨çš„éš¾åº¦æ¯”å¼€å‘Web Appè¦é«˜ï¼Œä½†ä¹Ÿä¸æ˜¯é«˜å¾—ç‰¹åˆ«ç¦»è°±ã€‚\nå¯¹äºå·²ç»èƒ½ç†Ÿç»ƒå¼€å‘Web Appçš„åŒå­¦æ¥è¯´ï¼Œè¦è¿›ä¸€æ­¥æå‡è‡ªå·±çš„æ¶æ„æ°´å¹³ï¼Œä¸å¦‚è‡ªå·±åŠ¨æ‰‹ï¼Œä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªTomcatæœåŠ¡å™¨ã€‚\næœ¬æ•™ç¨‹çš„ç›®æ ‡å°±æ˜¯ä»¥TomcatæœåŠ¡å™¨ä¸ºåŸå‹ï¼Œä¸“æ³¨äºå®ç°ä¸€ä¸ªæ”¯æŒServletæ ‡å‡†çš„WebæœåŠ¡å™¨ï¼Œå³å®ç°ä¸€ä¸ªè¿·ä½ ç‰ˆçš„Tomcat Serverï¼Œæˆ‘ä»¬æŠŠå®ƒå‘½åä¸ºJerrymouse Serverï¼Œä¸Tomcatä¸»è¦åŒºåˆ«åœ¨äºï¼Œå®ƒä¿©çš„å›¾æ ‡æœ‰æ‰€ä¸åŒã€‚\nJerrymouse Serverè®¾è®¡ç›®æ ‡å¦‚ä¸‹ï¼š\næ”¯æŒServlet 6çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼š æ”¯æŒServletç»„ä»¶ï¼› æ”¯æŒFilterç»„ä»¶ï¼› æ”¯æŒListenerç»„ä»¶ï¼› æ”¯æŒSesssionï¼ˆä»…é™Cookieæ¨¡å¼ï¼‰ï¼› ä¸æ”¯æŒJSPï¼› ä¸æ”¯æŒasyncæ¨¡å¼ä¸WebSocketï¼› å¯éƒ¨ç½²ä¸€ä¸ªæ ‡å‡†çš„Web Appï¼› ä¸æ”¯æŒåŒæ—¶éƒ¨ç½²å¤šä¸ªWeb Appï¼› ä¸æ”¯æŒçƒ­éƒ¨ç½²ã€‚ æˆ‘ä»¬ä¼šä¸€æ­¥ä¸€æ­¥å®ç°ä¸€ä¸ªå®Œæ•´çš„Web Serverï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šéƒ¨ç½²ä¸€ä¸ªå®Œæ•´çš„Webåº”ç”¨ç¨‹åºã€‚\næœ¬æ•™ç¨‹çš„æ‰€æœ‰æºç å‡å¯ä»GitHubæˆ–Giteeä¸‹è½½ã€‚\nå‚è€ƒï¼šæ‰‹å†™Tomcat - å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™ (liaoxuefeng.com)\nè®¾è®¡æœåŠ¡å™¨æ¶æ„ åœ¨å¼€å‘æˆ‘ä»¬è‡ªå·±çš„WebæœåŠ¡å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Tomcatçš„æ¶æ„ã€‚\nTomcatæ˜¯ä¸€ä¸ªå¼€æºçš„WebæœåŠ¡å™¨ï¼Œå®ƒçš„æ¶æ„æ˜¯åŸºäºç»„ä»¶çš„è®¾è®¡ï¼Œå¯ä»¥å°†å¤šä¸ªç»„ä»¶ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œç”¨ä¸€å¼ å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Tomcat Server â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Service â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ Engine â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ Host â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚Connectors â”‚ â”‚ â”‚ â”‚ Host â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”‚Connectorâ”‚â”‚ â”‚ â”‚ â”‚ â”‚ Host â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ Context â”‚ â”‚ â”‚ â”‚ â”‚ â—€â”€â”¼â”€â”¼â–¶â”‚â”‚Connectorâ”‚â”‚â—€â”€â–¶â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ Context â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”‚Connectorâ”‚â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”¤ â”‚ Context â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â””â”€â”¤ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”¤ â”‚ Web App â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”¤ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ä¸€ä¸ªTomcat Serverå†…éƒ¨å¯ä»¥æœ‰å¤šä¸ªServiceï¼ˆæœåŠ¡ï¼‰ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªServiceã€‚Serviceå†…éƒ¨åŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼š\nConnectorsï¼šä»£è¡¨ä¸€ç»„Connectorï¼ˆè¿æ¥å™¨ï¼‰ï¼Œè‡³å°‘å®šä¹‰ä¸€ä¸ªConnectorï¼Œä¹Ÿå…è®¸å®šä¹‰å¤šä¸ªConnectorï¼Œä¾‹å¦‚ï¼ŒHTTPå’ŒHTTPSä¸¤ä¸ªConnectorï¼› Engineï¼šä»£è¡¨ä¸€ä¸ªå¼•æ“ï¼Œæ‰€æœ‰HTTPè¯·æ±‚ç»è¿‡Connectoråä¼ é€’ç»™Engineã€‚ åœ¨ä¸€ä¸ªEngineå†…éƒ¨ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªHostï¼ˆä¸»æœºï¼‰ï¼ŒHostå¯ä»¥æ ¹æ®åŸŸååŒºåˆ†ï¼Œåœ¨Hostå†…éƒ¨ï¼Œåˆå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªContextï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼Œæ¯ä¸ªContextå¯¹åº”ä¸€ä¸ªWeb Appã€‚Contextæ˜¯ç”±è·¯å¾„å‰ç¼€åŒºåˆ†çš„ï¼Œå¦‚/abcã€/xyzã€/åˆ†åˆ«ä»£è¡¨3ä¸ªWeb Appï¼Œ/è¡¨ç¤ºçš„Web Appåœ¨Tomcatä¸­è¡¨ç¤ºæ ¹Web Appã€‚\nå› æ­¤ï¼Œä¸€ä¸ªHTTPè¯·æ±‚ï¼š\n1 http://www.example.com/abc/hello é¦–å…ˆæ ¹æ®åŸŸåwww.example.comå®šä½åˆ°æŸä¸ªHostï¼Œç„¶åï¼Œæ ¹æ®è·¯å¾„å‰ç¼€/abcå®šä½åˆ°æŸä¸ªContextï¼Œè‹¥è·¯å¾„å‰ç¼€æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•Contextï¼Œåˆ™åŒ¹é…/Contextã€‚åœ¨Contextå†…éƒ¨ï¼Œå°±æ˜¯å¼€å‘è€…ç¼–å†™çš„Web Appï¼Œä¸€ä¸ªContextä»…åŒ…å«ä¸€ä¸ªWeb Appã€‚\nå¯è§Tomcat Serveræ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„WebæœåŠ¡å™¨ï¼Œå®ƒæ”¯æŒHTTPã€HTTPSå’ŒAJPç­‰å¤šç§Connectorï¼Œåˆèƒ½åŒæ—¶è¿è¡Œå¤šä¸ªHostï¼Œæ¯ä¸ªHostå†…éƒ¨ï¼Œè¿˜å¯ä»¥æŒ‚è½½ä¸€ä¸ªæˆ–å¤šä¸ªContextï¼Œå¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªWeb Appã€‚\næˆ‘ä»¬è®¾è®¡Jerrymouse Serverå°±æ²¡å¿…è¦æè¿™ä¹ˆå¤æ‚ï¼Œå¯ä»¥å¤§å¹…ç®€åŒ–ä¸ºï¼š\nä»…ä¸€ä¸ªHTTP Connectorï¼Œä¸æ”¯æŒHTTPSï¼› ä»…æ”¯æŒæŒ‚è½½åˆ°/çš„ä¸€ä¸ªContextï¼Œä¸æ”¯æŒå¤šä¸ªHostä¸å¤šä¸ªContextã€‚ å› ä¸ºåªæœ‰ä¸€ä¸ªContextï¼Œæ‰€ä»¥ä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªWeb Appã€‚Jerrymouse Serverçš„æ¶æ„å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Jerrymouse Server â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Context â”‚ â”‚ â”‚ â”‚ HTTP â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â—€â”€â”¼â”€â–¶â”‚Connectorâ”‚â—€â”€â”€â–¶â”‚â”‚ Web App â”‚â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ æœ‰çš„åŒå­¦ä¼šæ‹…å¿ƒï¼Œå¦‚æœè¦è¿è¡Œå¤šä¸ªWeb Appæ€ä¹ˆåŠï¼Ÿ\nè¿™ä¸ªé—®é¢˜å¾ˆå®¹æ˜“è§£å†³ï¼šè¿è¡Œå¤šä¸ªJerrymouse Serverå°±å¯ä»¥è¿è¡Œå¤šä¸ªWeb Appäº†ã€‚\nè¿˜æœ‰çš„åŒå­¦ä¼šæ‹…å¿ƒï¼Œåªæ”¯æŒHTTPï¼Œå¦‚æœä¸€å®šè¦ä½¿ç”¨HTTPSæ€ä¹ˆåŠï¼Ÿ\nHTTPSå¯ä»¥éƒ¨ç½²åœ¨ç½‘å…³ï¼Œé€šè¿‡ç½‘å…³å°†HTTPSè¯·æ±‚è½¬å‘ä¸ºHTTPè¯·æ±‚ç»™Jerrymouse Serverå³å¯ã€‚éƒ¨ç½²ä¸€ä¸ªNginxå°±å¯ä»¥å……å½“ç½‘å…³ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Jerrymouse Server â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚ â”‚ Jerrymouse Server â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚ â”‚â—€â”€â”¼â”€â”‚ â”‚ Jerrymouse Server â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â—€â”€â”€â–¶â”‚ Nginx â”‚â—€â”€â”¼â”€â”¼â”€â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Context â”‚ â”‚ â”‚ â”‚ â””â”€â”¤ â”‚ â”‚ HTTP â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚ â”‚â—€â”€â”€â”€â”¼â”€â”¼â”€â–¶â”‚Connectorâ”‚â—€â”€â”€â–¶â”‚â”‚ Web App â”‚â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ æ­¤å¤–ï¼ŒNginxè¿˜å¯ä»¥å®šä¹‰å¤šä¸ªHostï¼Œæ ¹æ®Hostè½¬å‘ç»™ä¸åŒçš„Jerrymouse Serverï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸“æ³¨äºå®ç°ä¸€ä¸ªä»…æ”¯æŒHTTPã€ä»…æ”¯æŒä¸€ä¸ªWeb Appçš„WebæœåŠ¡å™¨ï¼ŒæŠŠHTTPSã€HTTP/2ã€HTTP/3ã€Hostã€Clusterï¼ˆé›†ç¾¤ï¼‰ç­‰åŠŸèƒ½å…¨éƒ¨æ‰”ç»™Nginxå³å¯ã€‚\nServletè§„èŒƒ åœ¨Java Webåº”ç”¨ä¸­ï¼Œé™¤äº†TomcatæœåŠ¡å™¨å¤–ï¼Œå…¶å®è¿˜æœ‰Jettyã€GlassFishã€Undertowç­‰å¤šç§WebæœåŠ¡å™¨ã€‚\nä¸€ä¸ªJava Web Appé€šå¸¸æ‰“åŒ…ä¸º.waræ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥éƒ¨ç½²åˆ°Tomcatã€Jettyç­‰å¤šç§WebæœåŠ¡å™¨ä¸Šã€‚ä¸ºä»€ä¹ˆä¸€ä¸ªJava Web AppåŸºæœ¬ä¸Šå¯ä»¥æ— ä¿®æ”¹åœ°éƒ¨ç½²åˆ°å¤šç§WebæœåŠ¡å™¨ä¸Šå‘¢ï¼ŸåŸå› å°±åœ¨äºServletè§„èŒƒã€‚\nServletè§„èŒƒæ˜¯Java Servlet APIçš„è§„èŒƒï¼Œç”¨äºå®šä¹‰WebæœåŠ¡å™¨å¦‚ä½•å¤„ç†HTTPè¯·æ±‚å’Œå“åº”ã€‚Servletè§„èŒƒæœ‰ä¸€ç»„æ¥å£ï¼Œå¯¹äºWeb Appæ¥è¯´ï¼Œæ“ä½œçš„æ˜¯æ¥å£ï¼Œè€ŒçœŸæ­£å¯¹åº”çš„å®ç°ç±»ï¼Œåˆ™ç”±å„ä¸ªWeb Serverå®ç°ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒJava Web Appå®é™…ä¸Šç¼–è¯‘çš„æ—¶å€™ä»…ç”¨åˆ°äº†Servletè§„èŒƒå®šä¹‰çš„æ¥å£ï¼Œåªè¦æ¯ä¸ªWebæœåŠ¡å™¨åœ¨å®ç°Servletæ¥å£æ—¶ä¸¥æ ¼æŒ‰ç…§è§„èŒƒå®ç°ï¼Œå°±å¯ä»¥ä¿è¯ä¸€ä¸ªWeb Appå¯ä»¥æ­£å¸¸è¿è¡Œåœ¨å¤šç§WebæœåŠ¡å™¨ä¸Šï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Web App â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â–² â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”¤Servlet Interfaceâ”œâ”€â” â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â–² â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Servlet â”‚ â”‚ â”‚ â”‚ Implementation â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ Server â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å¯¹äºWebåº”ç”¨ç¨‹åºï¼ŒServletè§„èŒƒæ˜¯éå¸¸é‡è¦çš„ã€‚Servletè§„èŒƒæœ‰å¥½å‡ ä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰ä¸€äº›æ–°çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§ç‰ˆæœ¬çš„æ–°åŠŸèƒ½ï¼š\nServlet 1.0ï¼šå®šä¹‰äº†Servletç»„ä»¶ï¼Œä¸€ä¸ªServletç»„ä»¶è¿è¡Œåœ¨Servletå®¹å™¨ï¼ˆContainerï¼‰ä¸­ï¼Œé€šè¿‡ä¸å®¹å™¨äº¤äº’ï¼Œå°±å¯ä»¥å“åº”ä¸€ä¸ªHTTPè¯·æ±‚ï¼›\nServlet 2.0ï¼šå®šä¹‰äº†JSPç»„ä»¶ï¼Œä¸€ä¸ªJSPé¡µé¢å¯ä»¥è¢«åŠ¨æ€ç¼–è¯‘ä¸ºServletç»„ä»¶ï¼›\nServlet 2.4ï¼šå®šä¹‰äº†Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ç»„ä»¶ï¼Œå¯ä»¥å®ç°è¿‡æ»¤åŠŸèƒ½ï¼›\nServlet 2.5ï¼šæ”¯æŒæ³¨è§£ï¼Œæä¾›äº†ServletContextListeneræ¥å£ï¼Œå¢åŠ äº†ä¸€äº›å®‰å…¨æ€§ç›¸å…³çš„ç‰¹æ€§ï¼›\nServlet 3.0ï¼šæ”¯æŒå¼‚æ­¥å¤„ç†çš„Servletï¼Œæ”¯æŒæ³¨è§£é…ç½®Servletå’Œè¿‡æ»¤å™¨ï¼Œå¢åŠ äº†SessionCookieConfigæ¥å£ï¼›\nServlet 3.1ï¼šæä¾›äº†WebSocketçš„æ”¯æŒï¼Œå¢åŠ äº†å¯¹HTTPè¯·æ±‚å’Œå“åº”çš„æµå¼æ“ä½œçš„æ”¯æŒï¼Œå¢åŠ äº†å¯¹HTTPåè®®çš„æ–°ç‰¹æ€§çš„æ”¯æŒï¼›\nServlet 4.0ï¼šæ”¯æŒHTTP/2çš„æ–°ç‰¹æ€§ï¼Œæä¾›äº†HTTP/2çš„Server Pushç­‰ç‰¹æ€§ï¼›\nServlet 5.0ï¼šä¸»è¦æ˜¯æŠŠjavax.servletåŒ…åæ”¹æˆäº†jakarta.servletï¼›\nServlet 6.0ï¼šç»§ç»­å¢åŠ ä¸€äº›æ–°åŠŸèƒ½ï¼Œå¹¶åºŸé™¤ä¸€éƒ¨åˆ†åŠŸèƒ½ã€‚\nç›®å‰æœ€æ–°çš„Servletç‰ˆæœ¬æ˜¯6.0ï¼Œæˆ‘ä»¬å¼€å‘Jerrymouse Serverä¹Ÿæ˜¯åŸºäºæœ€æ–°çš„Servlet 6.0ã€‚\nServletå¤„ç†æµç¨‹ å½“Servletå®¹å™¨æ¥æ”¶åˆ°ç”¨æˆ·çš„HTTPè¯·æ±‚åï¼Œç”±å®¹å™¨è´Ÿè´£æŠŠè¯·æ±‚è½¬æ¢ä¸ºHttpServletRequestå’ŒHttpServletResponseå¯¹è±¡ï¼Œåˆ†åˆ«ä»£è¡¨HTTPè¯·æ±‚å’Œå“åº”ï¼Œç„¶åï¼Œç»è¿‡è‹¥å¹²ä¸ªFilterç»„ä»¶åï¼Œåˆ°è¾¾æœ€ç»ˆçš„Servletç»„ä»¶ï¼Œç”±Servletç»„ä»¶å®ŒæˆHTTPå¤„ç†ï¼Œå°†å“åº”å†™å…¥HttpServletResponseå¯¹è±¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ServletContext â”‚ â”‚ â”‚ â”‚HttpServletRequest â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Filter â”‚ â”‚ â”‚HttpServletResponse â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Filter â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â–¼ â”‚ â”‚ â”‚Listener â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ Filter â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚Listener â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚Listener â”‚ â”‚ Servlet â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å…¶ä¸­ï¼ŒServletContextä»£è¡¨æ•´ä¸ªå®¹å™¨çš„ä¿¡æ¯ï¼Œå¦‚æœå®¹å™¨å®ç°äº†ServletContextæ¥å£ï¼Œä¹Ÿå¯ä»¥æŠŠServletContextå¯ä»¥çœ‹ä½œå®¹å™¨æœ¬èº«ã€‚ServletContextã€HttpServletRequestå’ŒHttpServletResponseéƒ½æ˜¯æ¥å£ï¼Œå…·ä½“å®ç°ç”±WebæœåŠ¡å™¨å®Œæˆã€‚Filterã€Servletç»„ä»¶ä¹Ÿæ˜¯æ¥å£ï¼Œä½†å…·ä½“å®ç°ç”±Web Appå®Œæˆã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§Listeneræ¥å£ï¼Œå¯ä»¥ç›‘å¬å„ç§äº‹ä»¶ï¼Œä½†ä¸ç›´æ¥å‚ä¸å¤„ç†HTTPè¯·æ±‚ï¼Œå…·ä½“å®ç°ç”±Web Appå®Œæˆï¼Œä½•æ—¶è°ƒç”¨åˆ™ç”±å®¹å™¨å†³å®šã€‚å› æ­¤ï¼Œé’ˆå¯¹Web Appçš„ä¸‰å¤§ç»„ä»¶ï¼šServletã€Filterå’ŒListeneréƒ½æ˜¯è¿è¡Œåœ¨å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œåªæœ‰å®¹å™¨æ‰èƒ½ä¸»åŠ¨è°ƒç”¨å®ƒä»¬ã€‚ï¼ˆæ­¤å¤„ç•¥å»JSPç»„ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ‰“ç®—æ”¯æŒJSPï¼‰\nå¯¹äºJerrymouseæœåŠ¡å™¨æ¥è¯´ï¼Œå¼€å‘æœåŠ¡å™¨å°±å¿…é¡»å®ç°Servletå®¹å™¨æœ¬èº«ï¼Œå®¹å™¨å®ç°ServletContextæ¥å£ï¼Œå®¹å™¨å†…éƒ¨ç®¡ç†è‹¥å¹²ä¸ªServletã€Filterå’ŒListenerç»„ä»¶ã€‚\nå¯¹æ¯ä¸ªè¯·æ±‚ï¼Œéœ€è¦åˆ›å»ºHttpServletRequestå’ŒHttpServletResponseå®ä¾‹ï¼ŒæŸ¥æ‰¾å¹¶åŒ¹é…åˆé€‚çš„ä¸€ç»„Filterå’Œä¸€ä¸ªServletï¼Œè®©å®ƒä»¬å¤„ç†HTTPè¯·æ±‚ã€‚\nåœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå„ç§äº‹ä»¶ï¼Œå®¹å™¨è´Ÿè´£å°†äº§ç”Ÿçš„äº‹ä»¶å‘é€åˆ°Listenerç»„ä»¶å¤„ç†ã€‚\nä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬ç¼–å†™Servletå®¹å™¨æŒ‰ç…§Servletè§„èŒƒæ‰€å¿…é¡»çš„å…¨éƒ¨åŠŸèƒ½ã€‚\nå®ç°HTTPæœåŠ¡å™¨ æˆ‘ä»¬è®¾è®¡çš„Jerrymouse Serverçš„æ¶æ„å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Jerrymouse Server â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Context â”‚ â”‚ â”‚ â”‚ HTTP â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â—€â”€â”¼â”€â–¶â”‚Connectorâ”‚â—€â”€â”€â–¶â”‚â”‚ Web App â”‚â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ åœ¨å®ç°Servletæ”¯æŒä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå®ç°ä¸€ä¸ªHTTP Connectorã€‚\næ‰€è°“Connectorï¼Œè¿™é‡Œå¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªèƒ½å¤„ç†HTTPè¯·æ±‚çš„æœåŠ¡å™¨ï¼ŒHTTP/1.xåè®®æ˜¯åŸºäºTCPè¿æ¥çš„ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œé¦–å…ˆç”±æµè§ˆå™¨å‘é€è¯·æ±‚ï¼š\n1 2 3 4 GET /hello HTTP/1.1 Host: www.example.com User-Agent: curl/7.88.1 Accept: */* è¯·æ±‚å¤´æŒ‡å‡ºäº†è¯·æ±‚çš„æ–¹æ³•GETï¼Œä¸»æœºwww.example.comï¼Œè·¯å¾„/helloï¼Œæ¥ä¸‹æ¥æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œè¾“å‡ºå“åº”ï¼š\n1 2 3 4 5 6 7 8 HTTP/1.1 200 OK Server: Simple HttpServer/1.0 Date: Fri, 07 Jul 2023 23:15:09 GMT Content-Type: text/html; charset=utf-8 Content-Length: 22 Connection: keep-alive Hello, world. å“åº”è¿”å›çŠ¶æ€ç 200ï¼Œæ¯ä¸ªå“åº”å¤´Header: Valueï¼Œæœ€åæ˜¯ä»¥\\r\\n\\r\\nåˆ†éš”çš„å“åº”å†…å®¹ã€‚\næ‰€ä»¥æˆ‘ä»¬ç¼–å†™HTTP Serverå®é™…ä¸Šå°±æ˜¯ï¼š\nç›‘å¬TCPç«¯å£ï¼Œç­‰å¾…æµè§ˆå™¨è¿æ¥ï¼› æ¥å—TCPè¿æ¥åï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¤„ç†è¯¥TCPè¿æ¥ï¼š æ¥æ”¶æµè§ˆå™¨å‘é€çš„HTTPè¯·æ±‚ï¼› è§£æHTTPè¯·æ±‚ï¼› å¤„ç†è¯·æ±‚ï¼› å‘é€HTTPå“åº”ï¼› é‡å¤1ï½4ç›´åˆ°TCPè¿æ¥å…³é—­ã€‚ æ•´ä¸ªæµç¨‹ä¸å¤æ‚ï¼Œä½†æ˜¯å¤„ç†æ­¥éª¤æ¯”è¾ƒç¹çï¼Œå°¤å…¶æ˜¯è§£æHTTPè¯·æ±‚ï¼Œæ˜¯ä¸ªä½“åŠ›æ´»ï¼Œä¸ä½†è¦å»è¯»HTTPåè®®æ‰‹å†Œï¼Œè¿˜è¦åšå¤§é‡çš„å…¼å®¹æ€§æµ‹è¯•ã€‚\næ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ç›´æ¥ä½¿ç”¨JDKå†…ç½®çš„jdk.httpserverã€‚jdk.httpserverä»JDK 9å¼€å§‹ä½œä¸ºä¸€ä¸ªå…¬å¼€æ¨¡å—å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå®ƒçš„åŒ…æ˜¯com.sun.net.httpserverï¼Œä¸»è¦æä¾›ä»¥ä¸‹å‡ ä¸ªç±»ï¼š\nHttpServerï¼šé€šè¿‡æŒ‡å®šIPåœ°å€å’Œç«¯å£å·ï¼Œå®šä¹‰ä¸€ä¸ªHTTPæœåŠ¡å®ä¾‹ï¼› HttpHandlerï¼šå¤„ç†HTTPè¯·æ±‚çš„æ ¸å¿ƒæ¥å£ï¼Œå¿…é¡»å®ç°handle(HttpExchange)æ–¹æ³•ï¼› HttpExchangeï¼šå¯ä»¥è¯»å–HTTPè¯·æ±‚çš„è¾“å…¥ï¼Œå¹¶å°†HTTPå“åº”è¾“å‡ºç»™å®ƒã€‚ ä¸€ä¸ªèƒ½å¤„ç†HTTPè¯·æ±‚çš„ç®€å•ç±»å®ç°å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 class SimpleHttpHandler implements HttpHandler { final Logger logger = LoggerFactory.getLogger(getClass()); @Override public void handle(HttpExchange exchange) throws IOException { // è·å–è¯·æ±‚æ–¹æ³•ã€URIã€Pathã€Queryç­‰: String method = exchange.getRequestMethod(); URI uri = exchange.getRequestURI(); String path = uri.getPath(); String query = uri.getRawQuery(); logger.info(\"{}: {}?{}\", method, path, query); // è¾“å‡ºå“åº”çš„Header: Headers respHeaders = exchange.getResponseHeaders(); respHeaders.set(\"Content-Type\", \"text/html; charset=utf-8\"); respHeaders.set(\"Cache-Control\", \"no-cache\"); // è®¾ç½®200å“åº”: exchange.sendResponseHeaders(200, 0); // è¾“å‡ºå“åº”çš„å†…å®¹: String s = \"Hello, world.\" + LocalDateTime.now().withNano(0) + \"\n\"; try (OutputStream out = exchange.getResponseBody()) { out.write(s.getBytes(StandardCharsets.UTF_8)); } } } å¯è§ï¼ŒHttpExchangeå°è£…äº†HTTPè¯·æ±‚å’Œå“åº”ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è§£æåŸå§‹çš„HTTPè¯·æ±‚ï¼Œä¹Ÿæ— éœ€æ„é€ åŸå§‹çš„HTTPå“åº”ï¼Œè€Œæ˜¯é€šè¿‡HttpExchangeé—´æ¥æ“ä½œï¼Œå¤§å¤§ç®€åŒ–äº†HTTPè¯·æ±‚çš„å¤„ç†ã€‚\næœ€åå†™ä¸€ä¸ªSimpleHttpServeræŠŠå¯åŠ¨HttpServerã€å¤„ç†è¯·æ±‚è¿èµ·æ¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 public class SimpleHttpServer implements HttpHandler, AutoCloseable { final Logger logger = LoggerFactory.getLogger(getClass()); public static void main(String[] args) { String host = \"0.0.0.0\"; int port = 8080; try (SimpleHttpServer connector = new SimpleHttpServer(host, port)) { for (;;) { try { Thread.sleep(1000); } catch (InterruptedException e) { break; } } } catch (Exception e) { e.printStackTrace(); } } final HttpServer httpServer; final String host; final int port; public SimpleHttpServer(String host, int port) throws IOException { this.host = host; this.port = port; this.httpServer = HttpServer.create(new InetSocketAddress(\"0.0.0.0\", 8080), 0, \"/\", this); this.httpServer.start(); logger.info(\"start jerrymouse http server at {}:{}\", host, port); } @Override public void close() { this.httpServer.stop(3); } @Override public void handle(HttpExchange exchange) throws IOException { ... } } è¿è¡Œåæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®http://localhost:8080ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\nè¿™æ ·ï¼Œæˆ‘ä»¬å°±æˆåŠŸå®ç°äº†ä¸€ä¸ªç®€å•çš„HTTP Serverã€‚\nå®ç°ServletæœåŠ¡å™¨ åœ¨ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†ä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡å™¨ï¼Œä½†æ˜¯ï¼Œå¥½åƒå’ŒServletæ²¡å•¥å…³ç³»ï¼Œå› ä¸ºæ•´ä¸ªæ“ä½œéƒ½æ˜¯åŸºäºHttpExchangeæ¥å£åšçš„ã€‚\nè€ŒServletå¤„ç†HTTPçš„æ¥å£æ˜¯åŸºäºHttpServletRequestå’ŒHttpServletResponseï¼Œå‰è€…è´Ÿè´£è¯»å–HTTPè¯·æ±‚ï¼Œåè€…è´Ÿè´£å†™å…¥HTTPå“åº”ã€‚\næ€ä¹ˆæŠŠåŸºäºHttpExchangeçš„æ“ä½œè½¬æ¢ä¸ºåŸºäºHttpServletRequestå’ŒHttpServletResponseï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨Adapteræ¨¡å¼ã€‚\né¦–å…ˆæˆ‘ä»¬å®šä¹‰HttpExchangeAdapterï¼Œå®ƒæŒæœ‰ä¸€ä¸ªHttpExchangeå®ä¾‹ï¼Œå¹¶å®ç°HttpExchangeRequestå’ŒHttpExchangeResponseæ¥å£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 interface HttpExchangeRequest { String getRequestMethod(); URI getRequestURI(); } interface HttpExchangeResponse { Headers getResponseHeaders(); void sendResponseHeaders(int rCode, long responseLength) throws IOException; OutputStream getResponseBody(); } public class HttpExchangeAdapter implements HttpExchangeRequest, HttpExchangeResponse { final HttpExchange exchange; public HttpExchangeAdapter(HttpExchange exchange) { this.exchange = exchange; } // å®ç°æ–¹æ³• ... } ç´§æ¥ç€æˆ‘ä»¬ç¼–å†™HttpServletRequestImplï¼Œå®ƒå†…éƒ¨æŒæœ‰HttpServletRequestï¼Œå¹¶å®ç°äº†HttpServletRequestæ¥å£ï¼š\n1 2 3 4 5 6 7 8 9 10 public class HttpServletRequestImpl implements HttpServletRequest { final HttpExchangeRequest exchangeRequest; public HttpServletRequestImpl(HttpExchangeRequest exchangeRequest) { this.exchangeRequest = exchangeRequest; } // å®ç°æ–¹æ³• ... } åŒç†ï¼Œç¼–å†™HttpServletResponseImplå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 public class HttpServletResponseImpl implements HttpServletResponse { final HttpExchangeResponse exchangeResponse; public HttpServletResponseImpl(HttpExchangeResponse exchangeResponse) { this.exchangeResponse = exchangeResponse; } // å®ç°æ–¹æ³• ... } ç”¨ä¸€ä¸ªå›¾è¡¨ç¤ºä»HttpExchangeè½¬æ¢ä¸ºHttpServletRequestå’ŒHttpServletResponseå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ HttpServletRequest â”‚ â”‚ HttpServletResponse â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â–² â–² â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚HttpServletRequestImplâ”‚ â”‚HttpServletResponseImplâ”‚ â”Œâ”€â”€â”‚- exchangeRequest â”‚ â”‚- exchangeResponse â”€â”€â”€â”€â”¼â”€â”€â” â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â””â”€â–¶â”‚ HttpExchangeRequest â”‚ â”‚ HttpExchangeResponse â”‚â—€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â–² â–² â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚HttpExchangeAdapterâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚- httpExchange â”€â”€â”€â”€â”¼â”€â”€â–¶â”‚HttpExchangeâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ æ¥ä¸‹æ¥æˆ‘ä»¬æ”¹é€ å¤„ç†HTTPè¯·æ±‚çš„HttpHandleræ¥å£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 public class HttpConnector implements HttpHandler { @Override public void handle(HttpExchange exchange) throws IOException { var adapter = new HttpExchangeAdapter(exchange); var request = new HttpServletRequestImpl(adapter); var response = new HttpServletResponseImpl(adapter); process(request, response); } void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { // TODO } } åœ¨handle(HttpExchange)æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡å¦‚ä¸‹ï¼š\nHttpExchangeAdapterå®ä¾‹ï¼šå®ƒå†…éƒ¨å¼•ç”¨äº†jdk.httpserveræä¾›çš„HttpExchangeå®ä¾‹ï¼› HttpServletRequestImplå®ä¾‹ï¼šå®ƒå†…éƒ¨å¼•ç”¨äº†HttpExchangeAdapterå®ä¾‹ï¼Œä½†æ˜¯è½¬æ¢ä¸ºHttpExchangeRequestæ¥å£ï¼› HttpServletResponseImplå®ä¾‹ï¼šå®ƒå†…éƒ¨å¼•ç”¨äº†HttpExchangeAdapterå®ä¾‹ï¼Œä½†æ˜¯è½¬æ¢ä¸ºHttpExchangeResponseæ¥å£ã€‚ æ‰€ä»¥å®é™…ä¸Šåˆ›å»ºçš„å®ä¾‹åªæœ‰3ä¸ªã€‚æœ€åè°ƒç”¨process(HttpServletRequest, HttpServletResponse)æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨å°±å¯ä»¥æŒ‰ç…§Servletæ ‡å‡†æ¥å¤„ç†HTTPè¯·æ±‚äº†ï¼Œå› ä¸ºæ–¹æ³•å‚æ•°æ˜¯æ ‡å‡†çš„Servletæ¥å£ï¼š\n1 2 3 4 5 6 7 8 void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { String name = request.getParameter(\"name\"); String html = \"Hello, \" + (name == null ? \"world\" : name) + \".\"; response.setContentType(\"text/html\"); PrintWriter pw = response.getWriter(); pw.write(html); pw.close(); } ç›®å‰ï¼Œæˆ‘ä»¬ä»…å®ç°äº†ä»£ç è°ƒç”¨æ—¶ç”¨åˆ°çš„getParameter()ã€setContentType()å’ŒgetWriter()è¿™å‡ ä¸ªæ–¹æ³•ã€‚å¦‚æœè¡¥å…¨HttpServletRequestå’ŒHttpServletResponseæ¥å£æ‰€æœ‰çš„æ–¹æ³•å®šä¹‰ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†å®Œæ•´çš„HttpServletRequestå’ŒHttpServletResponseæ¥å£å®ç°ã€‚\nè¿è¡Œä»£ç ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥http://localhost:8080/?name=Worldï¼Œç»“æœå¦‚ä¸‹ï¼š\nå®ç°Servletç»„ä»¶ ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†ä¸€ä¸ªHttpConnectorï¼Œå¹¶ä¸”ï¼Œå°†jdk.httpserveræä¾›çš„è¾“å…¥è¾“å‡ºHttpExchangeè½¬æ¢ä¸ºServletæ ‡å‡†å®šä¹‰çš„HttpServletRequestå’ŒHttpServletResponseæ¥å£ï¼Œæœ€ç»ˆå¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š\n1 2 3 void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { // TODO } è¿™æ ·ï¼Œæˆ‘ä»¬å°±æœ‰äº†å¤„ç†HttpServletRequestå’ŒHttpServletResponseçš„å…¥å£ï¼Œå›é¡¾ä¸€ä¸‹Jerrymouseè®¾è®¡çš„æ¶æ„å›¾ï¼š\n1 2 3 4 5 6 7 8 9 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Jerrymouse Server â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Context â”‚ â”‚ â”‚ â”‚ HTTP â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â—€â”€â”¼â”€â–¶â”‚Connectorâ”‚â—€â”€â”€â–¶â”‚â”‚ Web App â”‚â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ æˆ‘ä»¬è®©HttpConnectoræŒæœ‰ä¸€ä¸ªContextå®ä¾‹ï¼Œåœ¨Contextå®šä¹‰process(req, resp)æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ HttpConnector â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Context â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚process(req, resp) â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ è¿™ä¸ªContextç»„ä»¶æœ¬è´¨ä¸Šå¯ä»¥è§†ä¸ºServletè§„èŒƒå®šä¹‰çš„ServletContextï¼Œè€Œè§„èŒƒå®šä¹‰çš„Servletã€Filterã€Listenerç­‰ç»„ä»¶ï¼Œå°±å¯ä»¥è®©ServletContextç®¡ç†ï¼Œåç»­çš„æœåŠ¡å™¨è®¾è®¡å°±ç®€åŒ–ä¸ºå¦‚ä½•å®ç°ServletContextï¼Œä»¥åŠå¦‚ä½•ç®¡ç†Servletã€Filterã€Listenerç­‰ç»„ä»¶ã€‚\nå®ç°ServletContext åœ¨Java Webåº”ç”¨ç¨‹åºä¸­ï¼ŒServletContextä»£è¡¨åº”ç”¨ç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼Œä¸€ä¸ªWebåº”ç”¨ç¨‹åºå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„ServletContextå®ä¾‹ï¼ŒServletContextå¯ä»¥ç”¨äºï¼š\næä¾›åˆå§‹åŒ–å’Œå…¨å±€é…ç½®ï¼šå¯ä»¥ä»ServletContextè·å–Web Appé…ç½®çš„åˆå§‹åŒ–å‚æ•°ã€èµ„æºè·¯å¾„ç­‰ä¿¡æ¯ï¼› å…±äº«å…¨å±€æ•°æ®ï¼šServletContextå­˜å‚¨çš„æ•°æ®å¯ä»¥è¢«æ•´ä¸ªWeb Appçš„æ‰€æœ‰ç»„ä»¶è¯»å†™ã€‚ æ—¢ç„¶ServletContextæ˜¯ä¸€ä¸ªWeb Appçš„å…¨å±€å”¯ä¸€å®ä¾‹ï¼Œè€ŒWeb Appåˆè¿è¡Œåœ¨Servletå®¹å™¨ä¸­ï¼Œæˆ‘ä»¬åœ¨å®ç°ServletContextæ—¶ï¼Œå®Œå…¨å¯ä»¥æŠŠå®ƒå½“ä½œServletå®¹å™¨æ¥å®ç°ï¼Œå®ƒåœ¨å†…éƒ¨ç»´æŠ¤ä¸€ç»„Servletå®ä¾‹ï¼Œå¹¶æ ¹æ®Servleté…ç½®çš„è·¯ç”±ä¿¡æ¯å°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„Servletå¤„ç†ã€‚å‡è®¾æˆ‘ä»¬ç¼–å†™äº†ä¸¤ä¸ªServletï¼š\nIndexServletï¼šæ˜ å°„è·¯å¾„ä¸º/ï¼› HelloServletï¼šæ˜ å°„è·¯å¾„ä¸º/helloã€‚ é‚£ä¹ˆï¼Œå¤„ç†HTTPè¯·æ±‚çš„è·¯å¾„å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ServletContext â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â–¶â”‚IndexServletâ”‚ â”‚ â”€â”€â”€â–¶â”‚HttpConnectorâ”‚â”€â”€â”¼â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â–¶â”‚HelloServletâ”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ServletContextã€‚é¦–å…ˆå®šä¹‰ServletMappingï¼Œå®ƒåŒ…å«ä¸€ä¸ªServletå®ä¾‹ï¼Œä»¥åŠå°†æ˜ å°„è·¯å¾„ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼š\n1 2 3 4 5 6 7 8 public class ServletMapping { final Pattern pattern; // ç¼–è¯‘åçš„æ­£åˆ™è¡¨è¾¾å¼ final Servlet servlet; // Servletå®ä¾‹ public ServletMapping(String urlPattern, Servlet servlet) { this.pattern = buildPattern(urlPattern); // ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼ this.servlet = servlet; } } æ¥ä¸‹æ¥å®ç°ServletContextï¼š\n1 2 3 public class ServletContextImpl implements ServletContext { final List servletMappings = new ArrayList\u003c\u003e(); } è¿™ä¸ªæ•°æ®ç»“æ„è¶³å¤Ÿèƒ½è®©æˆ‘ä»¬å®ç°æ ¹æ®è¯·æ±‚è·¯å¾„è·¯ç”±åˆ°æŸä¸ªç‰¹å®šçš„Servletï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 public class ServletContextImpl implements ServletContext { ... // HTTPè¯·æ±‚å¤„ç†å…¥å£: public void process(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException { // è¯·æ±‚è·¯å¾„: String path = request.getRequestURI(); // æœç´¢Servlet: Servlet servlet = null; for (ServletMapping mapping : this.servletMappings) { if (mapping.matches(path)) { // è·¯å¾„åŒ¹é…: servlet = mapping.servlet; break; } } if (servlet == null) { // æœªåŒ¹é…åˆ°ä»»ä½•Servletæ˜¾ç¤º404 Not Found: PrintWriter pw = response.getWriter(); pw.write(\"404 Not FoundNo mapping for URL: \" + path + \"\n\"); pw.close(); return; } // ç”±Servletç»§ç»­å¤„ç†è¯·æ±‚: servlet.service(request, response); } } è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†ServletContextï¼\nä¸è¿‡ï¼Œç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæˆ‘ä»¬ç¼–å†™çš„ä¸¤ä¸ªServletï¼šIndexServletå’ŒHelloServletï¼Œè¿˜æ²¡æœ‰è¢«æ·»åŠ åˆ°ServletContextä¸­ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šServletåœ¨ä»€ä¹ˆæ—¶å€™è¢«åˆå§‹åŒ–ï¼Ÿ\nç­”æ¡ˆæ˜¯åœ¨åˆ›å»ºServletContextå®ä¾‹åï¼Œå°±ç«‹åˆ»åˆå§‹åŒ–æ‰€æœ‰çš„Servletã€‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªinitialize()æ–¹æ³•ï¼Œç”¨äºåˆå§‹åŒ–Servletï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 public class ServletContextImpl implements ServletContext { Map servletRegistrations = new HashMap\u003c\u003e(); Map nameToServlets = new HashMap\u003c\u003e(); List servletMappings = new ArrayList\u003c\u003e(); public void initialize(List",
  "wordCount" : "27350",
  "inLanguage": "en",
  "datePublished": "2024-03-06T18:18:52Z",
  "dateModified": "2024-03-06T18:18:52Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://funny-toffee-4aa7c3.netlify.app/posts/java/%E6%89%8B%E5%86%99tomcat/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://funny-toffee-4aa7c3.netlify.app/favicon.ico"
    }
  }
}
</script>

  <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.min.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath:  [['\\(', '\\)'], ['$', '$']],  
    }
  };
</script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://funny-toffee-4aa7c3.netlify.app/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://funny-toffee-4aa7c3.netlify.app/">Home</a>&nbsp;Â»&nbsp;<a href="https://funny-toffee-4aa7c3.netlify.app/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      æ‰‹å†™Tomcat
    </h1>
    <div class="post-meta"><span title='2024-03-06 18:18:52 +0000 UTC'>2024-03-06</span>&nbsp;Â·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e8%ae%be%e8%ae%a1%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%9e%b6%e6%9e%84" aria-label="è®¾è®¡æœåŠ¡å™¨æ¶æ„">è®¾è®¡æœåŠ¡å™¨æ¶æ„</a></li>
                <li>
                    <a href="#servlet%e8%a7%84%e8%8c%83" aria-label="Servletè§„èŒƒ">Servletè§„èŒƒ</a><ul>
                        <ul>
                        
                <li>
                    <a href="#servlet%e5%a4%84%e7%90%86%e6%b5%81%e7%a8%8b" aria-label="Servletå¤„ç†æµç¨‹">Servletå¤„ç†æµç¨‹</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0http%e6%9c%8d%e5%8a%a1%e5%99%a8" aria-label="å®ç°HTTPæœåŠ¡å™¨">å®ç°HTTPæœåŠ¡å™¨</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0servlet%e6%9c%8d%e5%8a%a1%e5%99%a8" aria-label="å®ç°ServletæœåŠ¡å™¨">å®ç°ServletæœåŠ¡å™¨</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0servlet%e7%bb%84%e4%bb%b6" aria-label="å®ç°Servletç»„ä»¶">å®ç°Servletç»„ä»¶</a><ul>
                        
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0servletcontext" aria-label="å®ç°ServletContext">å®ç°ServletContext</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0filterchain" aria-label="å®ç°FilterChain">å®ç°FilterChain</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0httpsession" aria-label="å®ç°HttpSession">å®ç°HttpSession</a><ul>
                        
                <li>
                    <a href="#session%e5%8e%9f%e7%90%86" aria-label="SessionåŸç†">SessionåŸç†</a></li>
                <li>
                    <a href="#session%e7%94%a8%e9%80%94" aria-label="Sessionç”¨é€”">Sessionç”¨é€”</a></li>
                <li>
                    <a href="#httpsession%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" aria-label="HttpSessionçš„ç”Ÿå‘½å‘¨æœŸ">HttpSessionçš„ç”Ÿå‘½å‘¨æœŸ</a></li>
                <li>
                    <a href="#httpsession%e6%8e%a5%e5%8f%a3" aria-label="HttpSessionæ¥å£">HttpSessionæ¥å£</a></li>
                <li>
                    <a href="#%e6%b5%8b%e8%af%95httpsession" aria-label="æµ‹è¯•HttpSession">æµ‹è¯•HttpSession</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0listener" aria-label="å®ç°Listener">å®ç°Listener</a><ul>
                        
                <li>
                    <a href="#listener%e5%8e%9f%e7%90%86" aria-label="ListeneråŸç†">ListeneråŸç†</a></li>
                <li>
                    <a href="#listener%e7%b1%bb%e5%9e%8b" aria-label="Listenerç±»å‹">Listenerç±»å‹</a></li>
                <li>
                    <a href="#%e6%b5%8b%e8%af%95listener" aria-label="æµ‹è¯•Listener">æµ‹è¯•Listener</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%8a%a0%e8%bd%bdweb-app" aria-label="åŠ è½½Web App">åŠ è½½Web App</a><ul>
                        
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0classloader" aria-label="å®ç°ClassLoader">å®ç°ClassLoader</a><ul>
                        
                <li>
                    <a href="#%e7%bc%96%e5%86%99classloader" aria-label="ç¼–å†™ClassLoader">ç¼–å†™ClassLoader</a></li>
                <li>
                    <a href="#%e8%ae%be%e7%bd%aecontextclassloader" aria-label="è®¾ç½®ContextClassLoader">è®¾ç½®ContextClassLoader</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%83%a8%e7%bd%b2web-app" aria-label="éƒ¨ç½²Web App">éƒ¨ç½²Web App</a></li>
                <li>
                    <a href="#%e9%83%a8%e7%bd%b2spring-web-app" aria-label="éƒ¨ç½²Spring Web App">éƒ¨ç½²Spring Web App</a></li></ul>
                </li>
                <li>
                    <a href="#faq" aria-label="FAQ">FAQ</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98" aria-label="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e6%ad%a3%e7%a1%ae%e5%ae%9e%e7%8e%b0getoutputstream%e5%92%8cgetwriter" aria-label="å¦‚ä½•æ­£ç¡®å®ç°getOutputStream()å’ŒgetWriter()ï¼Ÿ">å¦‚ä½•æ­£ç¡®å®ç°getOutputStream()å’ŒgetWriter()ï¼Ÿ</a></li>
                <li>
                    <a href="#httpservletresponse%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e5%ae%9e%e7%8e%b0cleanup" aria-label="HttpServletResponseä¸ºä»€ä¹ˆè¦å®ç°cleanup()ï¼Ÿ">HttpServletResponseä¸ºä»€ä¹ˆè¦å®ç°cleanup()ï¼Ÿ</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e5%af%b9servlet%e6%8e%92%e5%ba%8f" aria-label="å¦‚ä½•å¯¹Servletæ’åºï¼Ÿ">å¦‚ä½•å¯¹Servletæ’åºï¼Ÿ</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e5%a4%84%e7%90%86%e6%98%a0%e5%b0%84" aria-label="å¦‚ä½•å¤„ç†â€œ/â€æ˜ å°„ï¼Ÿ">å¦‚ä½•å¤„ç†â€œ/â€æ˜ å°„ï¼Ÿ</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e5%a4%84%e7%90%86%e9%9d%99%e6%80%81%e6%96%87%e4%bb%b6" aria-label="å¦‚ä½•å¤„ç†é™æ€æ–‡ä»¶ï¼Ÿ">å¦‚ä½•å¤„ç†é™æ€æ–‡ä»¶ï¼Ÿ</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e5%af%b9filter%e6%8e%92%e5%ba%8f" aria-label="å¦‚ä½•å¯¹Filteræ’åºï¼Ÿ">å¦‚ä½•å¯¹Filteræ’åºï¼Ÿ</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e5%90%af%e7%94%a8%e8%99%9a%e6%8b%9f%e7%ba%bf%e7%a8%8b" aria-label="å¦‚ä½•å¯ç”¨è™šæ‹Ÿçº¿ç¨‹ï¼Ÿ">å¦‚ä½•å¯ç”¨è™šæ‹Ÿçº¿ç¨‹ï¼Ÿ</a>
                </li>
            </ul>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>å¯¹äºJavaåç«¯å¼€å‘çš„åŒå­¦æ¥è¯´ï¼Œ<a href="https://tomcat.apache.org/">Tomcat</a>æœåŠ¡å™¨è‚¯å®šä¸é™Œç”Ÿã€‚å¼€å‘Java Web Appï¼Œæœ€åé€šå¸¸éƒ½ä¼šéƒ¨ç½²åˆ°Tomcatè¿™æ ·çš„æœåŠ¡å™¨ä¸Šã€‚</p>
<p>å¾ˆå¤šåŒå­¦å¯èƒ½è§‰å¾—å¼€å‘Web Appæ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œå¼€å‘WebæœåŠ¡å™¨å°±æ¯”è¾ƒå›°éš¾äº†ã€‚å®é™…ä¸Šï¼Œè™½ç„¶å¼€å‘WebæœåŠ¡å™¨çš„éš¾åº¦æ¯”å¼€å‘Web Appè¦é«˜ï¼Œä½†ä¹Ÿä¸æ˜¯é«˜å¾—ç‰¹åˆ«ç¦»è°±ã€‚</p>
<p>å¯¹äºå·²ç»èƒ½ç†Ÿç»ƒå¼€å‘Web Appçš„åŒå­¦æ¥è¯´ï¼Œè¦è¿›ä¸€æ­¥æå‡è‡ªå·±çš„æ¶æ„æ°´å¹³ï¼Œä¸å¦‚è‡ªå·±åŠ¨æ‰‹ï¼Œä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªTomcatæœåŠ¡å™¨ã€‚</p>
<p>æœ¬æ•™ç¨‹çš„ç›®æ ‡å°±æ˜¯ä»¥TomcatæœåŠ¡å™¨ä¸ºåŸå‹ï¼Œä¸“æ³¨äºå®ç°ä¸€ä¸ªæ”¯æŒServletæ ‡å‡†çš„WebæœåŠ¡å™¨ï¼Œå³å®ç°ä¸€ä¸ªè¿·ä½ ç‰ˆçš„Tomcat Serverï¼Œæˆ‘ä»¬æŠŠå®ƒå‘½åä¸ºJerrymouse Serverï¼Œä¸Tomcatä¸»è¦åŒºåˆ«åœ¨äºï¼Œå®ƒä¿©çš„å›¾æ ‡æœ‰æ‰€ä¸åŒã€‚</p>
<p>Jerrymouse Serverè®¾è®¡ç›®æ ‡å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ”¯æŒServlet 6çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼š
<ul>
<li>æ”¯æŒServletç»„ä»¶ï¼›</li>
<li>æ”¯æŒFilterç»„ä»¶ï¼›</li>
<li>æ”¯æŒListenerç»„ä»¶ï¼›</li>
<li>æ”¯æŒSesssionï¼ˆä»…é™Cookieæ¨¡å¼ï¼‰ï¼›</li>
<li>ä¸æ”¯æŒJSPï¼›</li>
<li>ä¸æ”¯æŒasyncæ¨¡å¼ä¸WebSocketï¼›</li>
</ul>
</li>
<li>å¯éƒ¨ç½²ä¸€ä¸ªæ ‡å‡†çš„Web Appï¼›</li>
<li>ä¸æ”¯æŒåŒæ—¶éƒ¨ç½²å¤šä¸ªWeb Appï¼›</li>
<li>ä¸æ”¯æŒçƒ­éƒ¨ç½²ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä¼šä¸€æ­¥ä¸€æ­¥å®ç°ä¸€ä¸ªå®Œæ•´çš„Web Serverï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šéƒ¨ç½²ä¸€ä¸ªå®Œæ•´çš„Webåº”ç”¨ç¨‹åºã€‚</p>
<p>æœ¬æ•™ç¨‹çš„æ‰€æœ‰æºç å‡å¯ä»<a href="https://github.com/michaelliao/jerrymouse">GitHub</a>æˆ–<a href="https://gitee.com/liaoxuefeng/jerrymouse">Gitee</a>ä¸‹è½½ã€‚</p>
<p>å‚è€ƒï¼š<a href="https://www.liaoxuefeng.com/wiki/1545956031987744">æ‰‹å†™Tomcat - å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™ (liaoxuefeng.com)</a></p>
<h1 id="è®¾è®¡æœåŠ¡å™¨æ¶æ„">è®¾è®¡æœåŠ¡å™¨æ¶æ„<a hidden class="anchor" aria-hidden="true" href="#è®¾è®¡æœåŠ¡å™¨æ¶æ„">#</a></h1>
<p>åœ¨å¼€å‘æˆ‘ä»¬è‡ªå·±çš„WebæœåŠ¡å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Tomcatçš„æ¶æ„ã€‚</p>
<p>Tomcatæ˜¯ä¸€ä¸ªå¼€æºçš„WebæœåŠ¡å™¨ï¼Œå®ƒçš„æ¶æ„æ˜¯åŸºäºç»„ä»¶çš„è®¾è®¡ï¼Œå¯ä»¥å°†å¤šä¸ªç»„ä»¶ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œç”¨ä¸€å¼ å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>  â”‚                    Tomcat Server                    â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚                     Service                     â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚                 â”‚           Engine            â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚                 â”‚ â”‚        Host         â”‚     â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”   â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”‚Connectors â”‚   â”‚ â”‚ â”‚        Host         â”‚   â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”‚â”‚Connectorâ”‚â”‚   â”‚ â”‚ â”‚ â”‚        Host         â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚ â”‚ â”‚ â”‚ â”‚   Context   â”‚     â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>â—€â”€â”¼â”€â”¼â–¶â”‚â”‚Connectorâ”‚â”‚â—€â”€â–¶â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”   â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚ â”‚ â”‚ â”‚ â”‚ â”‚   Context   â”‚   â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”‚â”‚Connectorâ”‚â”‚   â”‚ â”‚ â”‚ â”‚ â””â”€â”¤ â”‚   Context   â”‚ â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚ â””â”€â”¤ â”‚   â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚ â”‚   â””â”€â”¤ â”‚ Web App â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚                 â”‚   â””â”€â”¤     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚                 â”‚     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚                 â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€ä¸ªTomcat Serverå†…éƒ¨å¯ä»¥æœ‰å¤šä¸ªServiceï¼ˆæœåŠ¡ï¼‰ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªServiceã€‚Serviceå†…éƒ¨åŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼š</p>
<ul>
<li>Connectorsï¼šä»£è¡¨ä¸€ç»„Connectorï¼ˆè¿æ¥å™¨ï¼‰ï¼Œè‡³å°‘å®šä¹‰ä¸€ä¸ªConnectorï¼Œä¹Ÿå…è®¸å®šä¹‰å¤šä¸ªConnectorï¼Œä¾‹å¦‚ï¼ŒHTTPå’ŒHTTPSä¸¤ä¸ªConnectorï¼›</li>
<li>Engineï¼šä»£è¡¨ä¸€ä¸ªå¼•æ“ï¼Œæ‰€æœ‰HTTPè¯·æ±‚ç»è¿‡Connectoråä¼ é€’ç»™Engineã€‚</li>
</ul>
<p>åœ¨ä¸€ä¸ªEngineå†…éƒ¨ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªHostï¼ˆä¸»æœºï¼‰ï¼ŒHostå¯ä»¥æ ¹æ®åŸŸååŒºåˆ†ï¼Œåœ¨Hostå†…éƒ¨ï¼Œåˆå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªContextï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼Œæ¯ä¸ªContextå¯¹åº”ä¸€ä¸ªWeb Appã€‚Contextæ˜¯ç”±è·¯å¾„å‰ç¼€åŒºåˆ†çš„ï¼Œå¦‚<code>/abc</code>ã€<code>/xyz</code>ã€<code>/</code>åˆ†åˆ«ä»£è¡¨3ä¸ªWeb Appï¼Œ<code>/</code>è¡¨ç¤ºçš„Web Appåœ¨Tomcatä¸­è¡¨ç¤ºæ ¹Web Appã€‚</p>
<p>å› æ­¤ï¼Œä¸€ä¸ªHTTPè¯·æ±‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>http://www.example.com/abc/hello
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆæ ¹æ®åŸŸå<code>www.example.com</code>å®šä½åˆ°æŸä¸ªHostï¼Œç„¶åï¼Œæ ¹æ®è·¯å¾„å‰ç¼€<code>/abc</code>å®šä½åˆ°æŸä¸ªContextï¼Œè‹¥è·¯å¾„å‰ç¼€æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•Contextï¼Œåˆ™åŒ¹é…<code>/</code>Contextã€‚åœ¨Contextå†…éƒ¨ï¼Œå°±æ˜¯å¼€å‘è€…ç¼–å†™çš„Web Appï¼Œä¸€ä¸ªContextä»…åŒ…å«ä¸€ä¸ªWeb Appã€‚</p>
<p>å¯è§Tomcat Serveræ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„WebæœåŠ¡å™¨ï¼Œå®ƒæ”¯æŒHTTPã€HTTPSå’ŒAJPç­‰å¤šç§Connectorï¼Œåˆèƒ½åŒæ—¶è¿è¡Œå¤šä¸ªHostï¼Œæ¯ä¸ªHostå†…éƒ¨ï¼Œè¿˜å¯ä»¥æŒ‚è½½ä¸€ä¸ªæˆ–å¤šä¸ªContextï¼Œå¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªWeb Appã€‚</p>
<p>æˆ‘ä»¬è®¾è®¡Jerrymouse Serverå°±æ²¡å¿…è¦æè¿™ä¹ˆå¤æ‚ï¼Œå¯ä»¥å¤§å¹…ç®€åŒ–ä¸ºï¼š</p>
<ul>
<li>ä»…ä¸€ä¸ªHTTP Connectorï¼Œä¸æ”¯æŒHTTPSï¼›</li>
<li>ä»…æ”¯æŒæŒ‚è½½åˆ°<code>/</code>çš„ä¸€ä¸ªContextï¼Œä¸æ”¯æŒå¤šä¸ªHostä¸å¤šä¸ªContextã€‚</li>
</ul>
<p>å› ä¸ºåªæœ‰ä¸€ä¸ªContextï¼Œæ‰€ä»¥ä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªWeb Appã€‚Jerrymouse Serverçš„æ¶æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>  â”‚       Jerrymouse Server       â”‚
</span></span><span style="display:flex;"><span>  â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  Context  â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚  â”‚  HTTP   â”‚    â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
</span></span><span style="display:flex;"><span>â—€â”€â”¼â”€â–¶â”‚Connectorâ”‚â—€â”€â”€â–¶â”‚â”‚ Web App â”‚â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰çš„åŒå­¦ä¼šæ‹…å¿ƒï¼Œå¦‚æœè¦è¿è¡Œå¤šä¸ªWeb Appæ€ä¹ˆåŠï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜å¾ˆå®¹æ˜“è§£å†³ï¼šè¿è¡Œå¤šä¸ªJerrymouse Serverå°±å¯ä»¥è¿è¡Œå¤šä¸ªWeb Appäº†ã€‚</p>
<p>è¿˜æœ‰çš„åŒå­¦ä¼šæ‹…å¿ƒï¼Œåªæ”¯æŒHTTPï¼Œå¦‚æœä¸€å®šè¦ä½¿ç”¨HTTPSæ€ä¹ˆåŠï¼Ÿ</p>
<p>HTTPSå¯ä»¥éƒ¨ç½²åœ¨ç½‘å…³ï¼Œé€šè¿‡ç½‘å…³å°†HTTPSè¯·æ±‚è½¬å‘ä¸ºHTTPè¯·æ±‚ç»™Jerrymouse Serverå³å¯ã€‚éƒ¨ç½²ä¸€ä¸ªNginxå°±å¯ä»¥å……å½“ç½‘å…³ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>               â”‚       Jerrymouse Server       â”‚
</span></span><span style="display:flex;"><span>               â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”
</span></span><span style="display:flex;"><span>               â”‚ â”‚       Jerrymouse Server       â”‚
</span></span><span style="display:flex;"><span>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”
</span></span><span style="display:flex;"><span>    â”‚       â”‚â—€â”€â”¼â”€â”‚ â”‚       Jerrymouse Server       â”‚
</span></span><span style="display:flex;"><span>    â”‚       â”‚  â”‚ â”‚ â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>â—€â”€â”€â–¶â”‚ Nginx â”‚â—€â”€â”¼â”€â”¼â”€â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  Context  â”‚ â”‚
</span></span><span style="display:flex;"><span>    â”‚       â”‚  â””â”€â”¤ â”‚  â”‚  HTTP   â”‚    â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
</span></span><span style="display:flex;"><span>    â”‚       â”‚â—€â”€â”€â”€â”¼â”€â”¼â”€â–¶â”‚Connectorâ”‚â—€â”€â”€â–¶â”‚â”‚ Web App â”‚â”‚ â”‚
</span></span><span style="display:flex;"><span>    â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”¤  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
</span></span><span style="display:flex;"><span>                   â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤–ï¼ŒNginxè¿˜å¯ä»¥å®šä¹‰å¤šä¸ªHostï¼Œæ ¹æ®Hostè½¬å‘ç»™ä¸åŒçš„Jerrymouse Serverï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸“æ³¨äºå®ç°ä¸€ä¸ªä»…æ”¯æŒHTTPã€ä»…æ”¯æŒä¸€ä¸ªWeb Appçš„WebæœåŠ¡å™¨ï¼ŒæŠŠHTTPSã€HTTP/2ã€HTTP/3ã€Hostã€Clusterï¼ˆé›†ç¾¤ï¼‰ç­‰åŠŸèƒ½å…¨éƒ¨æ‰”ç»™Nginxå³å¯ã€‚</p>
<h1 id="servletè§„èŒƒ">Servletè§„èŒƒ<a hidden class="anchor" aria-hidden="true" href="#servletè§„èŒƒ">#</a></h1>
<p>åœ¨Java Webåº”ç”¨ä¸­ï¼Œé™¤äº†TomcatæœåŠ¡å™¨å¤–ï¼Œå…¶å®è¿˜æœ‰<a href="https://eclipse.dev/jetty/">Jetty</a>ã€<a href="https://javaee.github.io/glassfish/">GlassFish</a>ã€<a href="https://undertow.io/">Undertow</a>ç­‰å¤šç§WebæœåŠ¡å™¨ã€‚</p>
<p>ä¸€ä¸ªJava Web Appé€šå¸¸æ‰“åŒ…ä¸º<code>.war</code>æ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥éƒ¨ç½²åˆ°Tomcatã€Jettyç­‰å¤šç§WebæœåŠ¡å™¨ä¸Šã€‚ä¸ºä»€ä¹ˆä¸€ä¸ªJava Web AppåŸºæœ¬ä¸Šå¯ä»¥æ— ä¿®æ”¹åœ°éƒ¨ç½²åˆ°å¤šç§WebæœåŠ¡å™¨ä¸Šå‘¢ï¼ŸåŸå› å°±åœ¨äºServletè§„èŒƒã€‚</p>
<p>Servletè§„èŒƒæ˜¯Java Servlet APIçš„è§„èŒƒï¼Œç”¨äºå®šä¹‰WebæœåŠ¡å™¨å¦‚ä½•å¤„ç†HTTPè¯·æ±‚å’Œå“åº”ã€‚Servletè§„èŒƒæœ‰ä¸€ç»„æ¥å£ï¼Œå¯¹äºWeb Appæ¥è¯´ï¼Œæ“ä½œçš„æ˜¯æ¥å£ï¼Œè€ŒçœŸæ­£å¯¹åº”çš„å®ç°ç±»ï¼Œåˆ™ç”±å„ä¸ªWeb Serverå®ç°ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒJava Web Appå®é™…ä¸Šç¼–è¯‘çš„æ—¶å€™ä»…ç”¨åˆ°äº†Servletè§„èŒƒå®šä¹‰çš„æ¥å£ï¼Œåªè¦æ¯ä¸ªWebæœåŠ¡å™¨åœ¨å®ç°Servletæ¥å£æ—¶ä¸¥æ ¼æŒ‰ç…§è§„èŒƒå®ç°ï¼Œå°±å¯ä»¥ä¿è¯ä¸€ä¸ªWeb Appå¯ä»¥æ­£å¸¸è¿è¡Œåœ¨å¤šç§WebæœåŠ¡å™¨ä¸Šï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>  â”‚     Web App     â”‚
</span></span><span style="display:flex;"><span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>           â–²
</span></span><span style="display:flex;"><span>           â”‚
</span></span><span style="display:flex;"><span>           â–¼
</span></span><span style="display:flex;"><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”Œâ”€â”¤Servlet Interfaceâ”œâ”€â”
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>â”‚          â–²          â”‚
</span></span><span style="display:flex;"><span>â”‚          â”‚          â”‚
</span></span><span style="display:flex;"><span>â”‚          â–¼          â”‚
</span></span><span style="display:flex;"><span>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>â”‚ â”‚     Servlet     â”‚ â”‚
</span></span><span style="display:flex;"><span>â”‚ â”‚ Implementation  â”‚ â”‚
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>â”‚       Server        â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºWebåº”ç”¨ç¨‹åºï¼ŒServletè§„èŒƒæ˜¯éå¸¸é‡è¦çš„ã€‚Servletè§„èŒƒæœ‰å¥½å‡ ä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰ä¸€äº›æ–°çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§ç‰ˆæœ¬çš„æ–°åŠŸèƒ½ï¼š</p>
<p>Servlet 1.0ï¼šå®šä¹‰äº†Servletç»„ä»¶ï¼Œä¸€ä¸ªServletç»„ä»¶è¿è¡Œåœ¨Servletå®¹å™¨ï¼ˆContainerï¼‰ä¸­ï¼Œé€šè¿‡ä¸å®¹å™¨äº¤äº’ï¼Œå°±å¯ä»¥å“åº”ä¸€ä¸ªHTTPè¯·æ±‚ï¼›</p>
<p>Servlet 2.0ï¼šå®šä¹‰äº†JSPç»„ä»¶ï¼Œä¸€ä¸ªJSPé¡µé¢å¯ä»¥è¢«åŠ¨æ€ç¼–è¯‘ä¸ºServletç»„ä»¶ï¼›</p>
<p>Servlet 2.4ï¼šå®šä¹‰äº†Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ç»„ä»¶ï¼Œå¯ä»¥å®ç°è¿‡æ»¤åŠŸèƒ½ï¼›</p>
<p>Servlet 2.5ï¼šæ”¯æŒæ³¨è§£ï¼Œæä¾›äº†ServletContextListeneræ¥å£ï¼Œå¢åŠ äº†ä¸€äº›å®‰å…¨æ€§ç›¸å…³çš„ç‰¹æ€§ï¼›</p>
<p>Servlet 3.0ï¼šæ”¯æŒå¼‚æ­¥å¤„ç†çš„Servletï¼Œæ”¯æŒæ³¨è§£é…ç½®Servletå’Œè¿‡æ»¤å™¨ï¼Œå¢åŠ äº†SessionCookieConfigæ¥å£ï¼›</p>
<p>Servlet 3.1ï¼šæä¾›äº†WebSocketçš„æ”¯æŒï¼Œå¢åŠ äº†å¯¹HTTPè¯·æ±‚å’Œå“åº”çš„æµå¼æ“ä½œçš„æ”¯æŒï¼Œå¢åŠ äº†å¯¹HTTPåè®®çš„æ–°ç‰¹æ€§çš„æ”¯æŒï¼›</p>
<p>Servlet 4.0ï¼šæ”¯æŒHTTP/2çš„æ–°ç‰¹æ€§ï¼Œæä¾›äº†HTTP/2çš„Server Pushç­‰ç‰¹æ€§ï¼›</p>
<p>Servlet 5.0ï¼šä¸»è¦æ˜¯æŠŠ<code>javax.servlet</code>åŒ…åæ”¹æˆäº†<code>jakarta.servlet</code>ï¼›</p>
<p>Servlet 6.0ï¼šç»§ç»­å¢åŠ ä¸€äº›æ–°åŠŸèƒ½ï¼Œå¹¶åºŸé™¤ä¸€éƒ¨åˆ†åŠŸèƒ½ã€‚</p>
<p>ç›®å‰æœ€æ–°çš„Servletç‰ˆæœ¬æ˜¯6.0ï¼Œæˆ‘ä»¬å¼€å‘Jerrymouse Serverä¹Ÿæ˜¯åŸºäºæœ€æ–°çš„Servlet 6.0ã€‚</p>
<h3 id="servletå¤„ç†æµç¨‹">Servletå¤„ç†æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#servletå¤„ç†æµç¨‹">#</a></h3>
<p>å½“Servletå®¹å™¨æ¥æ”¶åˆ°ç”¨æˆ·çš„HTTPè¯·æ±‚åï¼Œç”±å®¹å™¨è´Ÿè´£æŠŠè¯·æ±‚è½¬æ¢ä¸º<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å¯¹è±¡ï¼Œåˆ†åˆ«ä»£è¡¨HTTPè¯·æ±‚å’Œå“åº”ï¼Œç„¶åï¼Œç»è¿‡è‹¥å¹²ä¸ªFilterç»„ä»¶åï¼Œåˆ°è¾¾æœ€ç»ˆçš„Servletç»„ä»¶ï¼Œç”±Servletç»„ä»¶å®ŒæˆHTTPå¤„ç†ï¼Œå°†å“åº”å†™å…¥<code>HttpServletResponse</code>å¯¹è±¡ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span> â”‚         ServletContext         â”‚
</span></span><span style="display:flex;"><span> â”‚                                â”‚
</span></span><span style="display:flex;"><span> â”‚HttpServletRequest  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Filter  â”‚ â”‚
</span></span><span style="display:flex;"><span> â”‚HttpServletResponse â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span> â”‚                         â”‚      â”‚
</span></span><span style="display:flex;"><span> â”‚                         â–¼      â”‚
</span></span><span style="display:flex;"><span> â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span> â”‚                    â”‚ Filter  â”‚ â”‚
</span></span><span style="display:flex;"><span> â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span> â”‚                         â”‚      â”‚
</span></span><span style="display:flex;"><span> â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â–¼      â”‚
</span></span><span style="display:flex;"><span> â”‚ â”‚Listener â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span> â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ Filter  â”‚ â”‚
</span></span><span style="display:flex;"><span> â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span> â”‚ â”‚Listener â”‚             â”‚      â”‚
</span></span><span style="display:flex;"><span> â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â–¼      â”‚
</span></span><span style="display:flex;"><span> â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span> â”‚ â”‚Listener â”‚        â”‚ Servlet â”‚ â”‚
</span></span><span style="display:flex;"><span> â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œ<code>ServletContext</code>ä»£è¡¨æ•´ä¸ªå®¹å™¨çš„ä¿¡æ¯ï¼Œå¦‚æœå®¹å™¨å®ç°äº†<code>ServletContext</code>æ¥å£ï¼Œä¹Ÿå¯ä»¥æŠŠ<code>ServletContext</code>å¯ä»¥çœ‹ä½œå®¹å™¨æœ¬èº«ã€‚<code>ServletContext</code>ã€<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>éƒ½æ˜¯æ¥å£ï¼Œå…·ä½“å®ç°ç”±WebæœåŠ¡å™¨å®Œæˆã€‚<code>Filter</code>ã€<code>Servlet</code>ç»„ä»¶ä¹Ÿæ˜¯æ¥å£ï¼Œä½†å…·ä½“å®ç°ç”±Web Appå®Œæˆã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§<code>Listener</code>æ¥å£ï¼Œå¯ä»¥ç›‘å¬å„ç§äº‹ä»¶ï¼Œä½†ä¸ç›´æ¥å‚ä¸å¤„ç†HTTPè¯·æ±‚ï¼Œå…·ä½“å®ç°ç”±Web Appå®Œæˆï¼Œä½•æ—¶è°ƒç”¨åˆ™ç”±å®¹å™¨å†³å®šã€‚å› æ­¤ï¼Œé’ˆå¯¹Web Appçš„ä¸‰å¤§ç»„ä»¶ï¼š<code>Servlet</code>ã€<code>Filter</code>å’Œ<code>Listener</code>éƒ½æ˜¯è¿è¡Œåœ¨å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œåªæœ‰å®¹å™¨æ‰èƒ½ä¸»åŠ¨è°ƒç”¨å®ƒä»¬ã€‚ï¼ˆæ­¤å¤„ç•¥å»JSPç»„ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ‰“ç®—æ”¯æŒJSPï¼‰</p>
<p>å¯¹äºJerrymouseæœåŠ¡å™¨æ¥è¯´ï¼Œå¼€å‘æœåŠ¡å™¨å°±å¿…é¡»å®ç°Servletå®¹å™¨æœ¬èº«ï¼Œå®¹å™¨å®ç°<code>ServletContext</code>æ¥å£ï¼Œå®¹å™¨å†…éƒ¨ç®¡ç†è‹¥å¹²ä¸ª<code>Servlet</code>ã€<code>Filter</code>å’Œ<code>Listener</code>ç»„ä»¶ã€‚</p>
<p>å¯¹æ¯ä¸ªè¯·æ±‚ï¼Œéœ€è¦åˆ›å»º<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å®ä¾‹ï¼ŒæŸ¥æ‰¾å¹¶åŒ¹é…åˆé€‚çš„ä¸€ç»„<code>Filter</code>å’Œä¸€ä¸ª<code>Servlet</code>ï¼Œè®©å®ƒä»¬å¤„ç†HTTPè¯·æ±‚ã€‚</p>
<p>åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå„ç§äº‹ä»¶ï¼Œå®¹å™¨è´Ÿè´£å°†äº§ç”Ÿçš„äº‹ä»¶å‘é€åˆ°<code>Listener</code>ç»„ä»¶å¤„ç†ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬ç¼–å†™Servletå®¹å™¨æŒ‰ç…§Servletè§„èŒƒæ‰€å¿…é¡»çš„å…¨éƒ¨åŠŸèƒ½ã€‚</p>
<h1 id="å®ç°httpæœåŠ¡å™¨">å®ç°HTTPæœåŠ¡å™¨<a hidden class="anchor" aria-hidden="true" href="#å®ç°httpæœåŠ¡å™¨">#</a></h1>
<p>æˆ‘ä»¬è®¾è®¡çš„Jerrymouse Serverçš„æ¶æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>  â”‚       Jerrymouse Server       â”‚
</span></span><span style="display:flex;"><span>  â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  Context  â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚  â”‚  HTTP   â”‚    â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
</span></span><span style="display:flex;"><span>â—€â”€â”¼â”€â–¶â”‚Connectorâ”‚â—€â”€â”€â–¶â”‚â”‚ Web App â”‚â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å®ç°Servletæ”¯æŒä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå®ç°ä¸€ä¸ªHTTP Connectorã€‚</p>
<p>æ‰€è°“Connectorï¼Œè¿™é‡Œå¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªèƒ½å¤„ç†HTTPè¯·æ±‚çš„æœåŠ¡å™¨ï¼ŒHTTP/1.xåè®®æ˜¯åŸºäºTCPè¿æ¥çš„ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œé¦–å…ˆç”±æµè§ˆå™¨å‘é€è¯·æ±‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /hello HTTP/1.1
</span></span><span style="display:flex;"><span>Host: www.example.com
</span></span><span style="display:flex;"><span>User-Agent: curl/7.88.1
</span></span><span style="display:flex;"><span>Accept: */*
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯·æ±‚å¤´æŒ‡å‡ºäº†è¯·æ±‚çš„æ–¹æ³•<code>GET</code>ï¼Œä¸»æœº<code>www.example.com</code>ï¼Œè·¯å¾„<code>/hello</code>ï¼Œæ¥ä¸‹æ¥æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œè¾“å‡ºå“åº”ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>HTTP/1.1 200 OK
</span></span><span style="display:flex;"><span>Server: Simple HttpServer/1.0
</span></span><span style="display:flex;"><span>Date: Fri, 07 Jul 2023 23:15:09 GMT
</span></span><span style="display:flex;"><span>Content-Type: text/html; charset=utf-8
</span></span><span style="display:flex;"><span>Content-Length: 22
</span></span><span style="display:flex;"><span>Connection: keep-alive
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;h1&gt;Hello, world.&lt;/h1&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å“åº”è¿”å›çŠ¶æ€ç <code>200</code>ï¼Œæ¯ä¸ªå“åº”å¤´<code>Header: Value</code>ï¼Œæœ€åæ˜¯ä»¥<code>\r\n\r\n</code>åˆ†éš”çš„å“åº”å†…å®¹ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬ç¼–å†™HTTP Serverå®é™…ä¸Šå°±æ˜¯ï¼š</p>
<ol>
<li>ç›‘å¬TCPç«¯å£ï¼Œç­‰å¾…æµè§ˆå™¨è¿æ¥ï¼›</li>
<li>æ¥å—TCPè¿æ¥åï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¤„ç†è¯¥TCPè¿æ¥ï¼š
<ol>
<li>æ¥æ”¶æµè§ˆå™¨å‘é€çš„HTTPè¯·æ±‚ï¼›</li>
<li>è§£æHTTPè¯·æ±‚ï¼›</li>
<li>å¤„ç†è¯·æ±‚ï¼›</li>
<li>å‘é€HTTPå“åº”ï¼›</li>
<li>é‡å¤1ï½4ç›´åˆ°TCPè¿æ¥å…³é—­ã€‚</li>
</ol>
</li>
</ol>
<p>æ•´ä¸ªæµç¨‹ä¸å¤æ‚ï¼Œä½†æ˜¯å¤„ç†æ­¥éª¤æ¯”è¾ƒç¹çï¼Œå°¤å…¶æ˜¯è§£æHTTPè¯·æ±‚ï¼Œæ˜¯ä¸ªä½“åŠ›æ´»ï¼Œä¸ä½†è¦å»è¯»HTTPåè®®æ‰‹å†Œï¼Œè¿˜è¦åšå¤§é‡çš„å…¼å®¹æ€§æµ‹è¯•ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ç›´æ¥ä½¿ç”¨JDKå†…ç½®çš„<code>jdk.httpserver</code>ã€‚<code>jdk.httpserver</code>ä»JDK 9å¼€å§‹ä½œä¸ºä¸€ä¸ªå…¬å¼€æ¨¡å—å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå®ƒçš„åŒ…æ˜¯<code>com.sun.net.httpserver</code>ï¼Œä¸»è¦æä¾›ä»¥ä¸‹å‡ ä¸ªç±»ï¼š</p>
<ul>
<li>HttpServerï¼šé€šè¿‡æŒ‡å®šIPåœ°å€å’Œç«¯å£å·ï¼Œå®šä¹‰ä¸€ä¸ªHTTPæœåŠ¡å®ä¾‹ï¼›</li>
<li>HttpHandlerï¼šå¤„ç†HTTPè¯·æ±‚çš„æ ¸å¿ƒæ¥å£ï¼Œå¿…é¡»å®ç°<code>handle(HttpExchange)</code>æ–¹æ³•ï¼›</li>
<li>HttpExchangeï¼šå¯ä»¥è¯»å–HTTPè¯·æ±‚çš„è¾“å…¥ï¼Œå¹¶å°†HTTPå“åº”è¾“å‡ºç»™å®ƒã€‚</li>
</ul>
<p>ä¸€ä¸ªèƒ½å¤„ç†HTTPè¯·æ±‚çš„ç®€å•ç±»å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> SimpleHttpHandler <span style="color:#fff;font-weight:bold">implements</span> HttpHandler {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Logger logger = LoggerFactory.<span style="color:#007f7f">getLogger</span>(getClass());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(HttpExchange exchange) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–è¯·æ±‚æ–¹æ³•ã€URIã€Pathã€Queryç­‰:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        String method = exchange.<span style="color:#007f7f">getRequestMethod</span>();
</span></span><span style="display:flex;"><span>        URI uri = exchange.<span style="color:#007f7f">getRequestURI</span>();
</span></span><span style="display:flex;"><span>        String path = uri.<span style="color:#007f7f">getPath</span>();
</span></span><span style="display:flex;"><span>        String query = uri.<span style="color:#007f7f">getRawQuery</span>();
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;{}: {}?{}&#34;</span>, method, path, query);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¾“å‡ºå“åº”çš„Header:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Headers respHeaders = exchange.<span style="color:#007f7f">getResponseHeaders</span>();
</span></span><span style="display:flex;"><span>        respHeaders.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;Content-Type&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;text/html; charset=utf-8&#34;</span>);
</span></span><span style="display:flex;"><span>        respHeaders.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;Cache-Control&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;no-cache&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ç½®200å“åº”:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        exchange.<span style="color:#007f7f">sendResponseHeaders</span>(<span style="color:#ff0;font-weight:bold">200</span>, <span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¾“å‡ºå“åº”çš„å†…å®¹:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        String s = <span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;Hello, world.&lt;/h1&gt;&lt;p&gt;&#34;</span> + LocalDateTime.<span style="color:#007f7f">now</span>().<span style="color:#007f7f">withNano</span>(<span style="color:#ff0;font-weight:bold">0</span>) + <span style="color:#0ff;font-weight:bold">&#34;&lt;/p&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> (OutputStream out = exchange.<span style="color:#007f7f">getResponseBody</span>()) {
</span></span><span style="display:flex;"><span>            out.<span style="color:#007f7f">write</span>(s.<span style="color:#007f7f">getBytes</span>(StandardCharsets.<span style="color:#007f7f">UTF_8</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼Œ<code>HttpExchange</code>å°è£…äº†HTTPè¯·æ±‚å’Œå“åº”ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è§£æåŸå§‹çš„HTTPè¯·æ±‚ï¼Œä¹Ÿæ— éœ€æ„é€ åŸå§‹çš„HTTPå“åº”ï¼Œè€Œæ˜¯é€šè¿‡<code>HttpExchange</code>é—´æ¥æ“ä½œï¼Œå¤§å¤§ç®€åŒ–äº†HTTPè¯·æ±‚çš„å¤„ç†ã€‚</p>
<p>æœ€åå†™ä¸€ä¸ª<code>SimpleHttpServer</code>æŠŠå¯åŠ¨<code>HttpServer</code>ã€å¤„ç†è¯·æ±‚è¿èµ·æ¥ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SimpleHttpServer <span style="color:#fff;font-weight:bold">implements</span> HttpHandler, AutoCloseable {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Logger logger = LoggerFactory.<span style="color:#007f7f">getLogger</span>(getClass());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        String host = <span style="color:#0ff;font-weight:bold">&#34;0.0.0.0&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> port = <span style="color:#ff0;font-weight:bold">8080</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> (SimpleHttpServer connector = <span style="color:#fff;font-weight:bold">new</span> SimpleHttpServer(host, port)) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                    Thread.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">1000</span>);
</span></span><span style="display:flex;"><span>                } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> HttpServer httpServer;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> String host;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> port;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> SimpleHttpServer(String host, <span style="color:#fff;font-weight:bold">int</span> port) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">host</span> = host;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">port</span> = port;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">httpServer</span> = HttpServer.<span style="color:#007f7f">create</span>(<span style="color:#fff;font-weight:bold">new</span> InetSocketAddress(<span style="color:#0ff;font-weight:bold">&#34;0.0.0.0&#34;</span>, <span style="color:#ff0;font-weight:bold">8080</span>), <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>, <span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">httpServer</span>.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;start jerrymouse http server at {}:{}&#34;</span>, host, port);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> close() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">httpServer</span>.<span style="color:#007f7f">stop</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(HttpExchange exchange) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œåæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®<code>http://localhost:8080</code>ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1556276528021568/l" alt="simple-http-server"  />
</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æˆåŠŸå®ç°äº†ä¸€ä¸ªç®€å•çš„HTTP Serverã€‚</p>
<h1 id="å®ç°servletæœåŠ¡å™¨">å®ç°ServletæœåŠ¡å™¨<a hidden class="anchor" aria-hidden="true" href="#å®ç°servletæœåŠ¡å™¨">#</a></h1>
<p>åœ¨ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†ä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡å™¨ï¼Œä½†æ˜¯ï¼Œå¥½åƒå’ŒServletæ²¡å•¥å…³ç³»ï¼Œå› ä¸ºæ•´ä¸ªæ“ä½œéƒ½æ˜¯åŸºäº<code>HttpExchange</code>æ¥å£åšçš„ã€‚</p>
<p>è€ŒServletå¤„ç†HTTPçš„æ¥å£æ˜¯åŸºäº<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>ï¼Œå‰è€…è´Ÿè´£è¯»å–HTTPè¯·æ±‚ï¼Œåè€…è´Ÿè´£å†™å…¥HTTPå“åº”ã€‚</p>
<p>æ€ä¹ˆæŠŠåŸºäº<code>HttpExchange</code>çš„æ“ä½œè½¬æ¢ä¸ºåŸºäº<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1281319245971489">Adapteræ¨¡å¼</a>ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰<code>HttpExchangeAdapter</code>ï¼Œå®ƒæŒæœ‰ä¸€ä¸ª<code>HttpExchange</code>å®ä¾‹ï¼Œå¹¶å®ç°<code>HttpExchangeRequest</code>å’Œ<code>HttpExchangeResponse</code>æ¥å£ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">interface</span> HttpExchangeRequest {
</span></span><span style="display:flex;"><span>    String getRequestMethod();
</span></span><span style="display:flex;"><span>    URI getRequestURI();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">interface</span> HttpExchangeResponse {
</span></span><span style="display:flex;"><span>    Headers getResponseHeaders();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> sendResponseHeaders(<span style="color:#fff;font-weight:bold">int</span> rCode, <span style="color:#fff;font-weight:bold">long</span> responseLength) <span style="color:#fff;font-weight:bold">throws</span> IOException;
</span></span><span style="display:flex;"><span>    OutputStream getResponseBody();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HttpExchangeAdapter <span style="color:#fff;font-weight:bold">implements</span> HttpExchangeRequest, HttpExchangeResponse {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> HttpExchange exchange;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> HttpExchangeAdapter(HttpExchange exchange) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">exchange</span> = exchange;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å®ç°æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç´§æ¥ç€æˆ‘ä»¬ç¼–å†™<code>HttpServletRequestImpl</code>ï¼Œå®ƒå†…éƒ¨æŒæœ‰<code>HttpServletRequest</code>ï¼Œå¹¶å®ç°äº†<code>HttpServletRequest</code>æ¥å£ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HttpServletRequestImpl <span style="color:#fff;font-weight:bold">implements</span> HttpServletRequest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> HttpExchangeRequest exchangeRequest;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> HttpServletRequestImpl(HttpExchangeRequest exchangeRequest) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">exchangeRequest</span> = exchangeRequest;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å®ç°æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŒç†ï¼Œç¼–å†™<code>HttpServletResponseImpl</code>å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HttpServletResponseImpl <span style="color:#fff;font-weight:bold">implements</span> HttpServletResponse {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> HttpExchangeResponse exchangeResponse;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> HttpServletResponseImpl(HttpExchangeResponse exchangeResponse) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">exchangeResponse</span> = exchangeResponse;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å®ç°æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨ä¸€ä¸ªå›¾è¡¨ç¤ºä»<code>HttpExchange</code>è½¬æ¢ä¸º<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>   â”‚  HttpServletRequest  â”‚ â”‚  HttpServletResponse  â”‚
</span></span><span style="display:flex;"><span>   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>               â–²                        â–²
</span></span><span style="display:flex;"><span>               â”‚                        â”‚
</span></span><span style="display:flex;"><span>   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>   â”‚HttpServletRequestImplâ”‚ â”‚HttpServletResponseImplâ”‚
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”‚- exchangeRequest     â”‚ â”‚- exchangeResponse â”€â”€â”€â”€â”¼â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
</span></span><span style="display:flex;"><span>â”‚                                                      â”‚
</span></span><span style="display:flex;"><span>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
</span></span><span style="display:flex;"><span>â””â”€â–¶â”‚ HttpExchangeRequest  â”‚ â”‚ HttpExchangeResponse  â”‚â—€â”€â”˜
</span></span><span style="display:flex;"><span>   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>                      â–²         â–²
</span></span><span style="display:flex;"><span>                      â”‚         â”‚
</span></span><span style="display:flex;"><span>                      â”‚         â”‚
</span></span><span style="display:flex;"><span>                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                 â”‚HttpExchangeAdapterâ”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                 â”‚- httpExchange â”€â”€â”€â”€â”¼â”€â”€â–¶â”‚HttpExchangeâ”‚
</span></span><span style="display:flex;"><span>                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ”¹é€ å¤„ç†HTTPè¯·æ±‚çš„<code>HttpHandler</code>æ¥å£ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HttpConnector <span style="color:#fff;font-weight:bold">implements</span> HttpHandler {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(HttpExchange exchange) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        var adapter = <span style="color:#fff;font-weight:bold">new</span> HttpExchangeAdapter(exchange);
</span></span><span style="display:flex;"><span>        var request = <span style="color:#fff;font-weight:bold">new</span> HttpServletRequestImpl(adapter);
</span></span><span style="display:flex;"><span>        var response = <span style="color:#fff;font-weight:bold">new</span> HttpServletResponseImpl(adapter);
</span></span><span style="display:flex;"><span>        process(request, response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> process(HttpServletRequest request, HttpServletResponse response) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// TODO
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>handle(HttpExchange)</code>æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡å¦‚ä¸‹ï¼š</p>
<ol>
<li>HttpExchangeAdapterå®ä¾‹ï¼šå®ƒå†…éƒ¨å¼•ç”¨äº†jdk.httpserveræä¾›çš„HttpExchangeå®ä¾‹ï¼›</li>
<li>HttpServletRequestImplå®ä¾‹ï¼šå®ƒå†…éƒ¨å¼•ç”¨äº†HttpExchangeAdapterå®ä¾‹ï¼Œä½†æ˜¯è½¬æ¢ä¸ºHttpExchangeRequestæ¥å£ï¼›</li>
<li>HttpServletResponseImplå®ä¾‹ï¼šå®ƒå†…éƒ¨å¼•ç”¨äº†HttpExchangeAdapterå®ä¾‹ï¼Œä½†æ˜¯è½¬æ¢ä¸ºHttpExchangeResponseæ¥å£ã€‚</li>
</ol>
<p>æ‰€ä»¥å®é™…ä¸Šåˆ›å»ºçš„å®ä¾‹åªæœ‰3ä¸ªã€‚æœ€åè°ƒç”¨<code>process(HttpServletRequest, HttpServletResponse)</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨å°±å¯ä»¥æŒ‰ç…§Servletæ ‡å‡†æ¥å¤„ç†HTTPè¯·æ±‚äº†ï¼Œå› ä¸ºæ–¹æ³•å‚æ•°æ˜¯æ ‡å‡†çš„Servletæ¥å£ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> process(HttpServletRequest request, HttpServletResponse response) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>    String name = request.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>);
</span></span><span style="display:flex;"><span>    String html = <span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;Hello, &#34;</span> + (name == <span style="color:#fff;font-weight:bold">null</span> ? <span style="color:#0ff;font-weight:bold">&#34;world&#34;</span> : name) + <span style="color:#0ff;font-weight:bold">&#34;.&lt;/h1&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    response.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;text/html&#34;</span>);
</span></span><span style="display:flex;"><span>    PrintWriter pw = response.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>    pw.<span style="color:#007f7f">write</span>(html);
</span></span><span style="display:flex;"><span>    pw.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›®å‰ï¼Œæˆ‘ä»¬ä»…å®ç°äº†ä»£ç è°ƒç”¨æ—¶ç”¨åˆ°çš„<code>getParameter()</code>ã€<code>setContentType()</code>å’Œ<code>getWriter()</code>è¿™å‡ ä¸ªæ–¹æ³•ã€‚å¦‚æœè¡¥å…¨<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>æ¥å£æ‰€æœ‰çš„æ–¹æ³•å®šä¹‰ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†å®Œæ•´çš„<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>æ¥å£å®ç°ã€‚</p>
<p>è¿è¡Œä»£ç ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥<code>http://localhost:8080/?name=World</code>ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1556283320696896/l" alt="simple-servlet-server"  />
</p>
<h1 id="å®ç°servletç»„ä»¶">å®ç°Servletç»„ä»¶<a hidden class="anchor" aria-hidden="true" href="#å®ç°servletç»„ä»¶">#</a></h1>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†ä¸€ä¸ª<code>HttpConnector</code>ï¼Œå¹¶ä¸”ï¼Œå°†jdk.httpserveræä¾›çš„è¾“å…¥è¾“å‡º<code>HttpExchange</code>è½¬æ¢ä¸ºServletæ ‡å‡†å®šä¹‰çš„<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>æ¥å£ï¼Œæœ€ç»ˆå¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> process(HttpServletRequest request, HttpServletResponse response) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// TODO
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æœ‰äº†å¤„ç†<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>çš„å…¥å£ï¼Œå›é¡¾ä¸€ä¸‹Jerrymouseè®¾è®¡çš„æ¶æ„å›¾ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>  â”‚       Jerrymouse Server       â”‚
</span></span><span style="display:flex;"><span>  â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  Context  â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚  â”‚  HTTP   â”‚    â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
</span></span><span style="display:flex;"><span>â—€â”€â”¼â”€â–¶â”‚Connectorâ”‚â—€â”€â”€â–¶â”‚â”‚ Web App â”‚â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬è®©<code>HttpConnector</code>æŒæœ‰ä¸€ä¸ªContextå®ä¾‹ï¼Œåœ¨Contextå®šä¹‰<code>process(req, resp)</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>          â”‚
</span></span><span style="display:flex;"><span>          â–¼
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚   HttpConnector   â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>          â”‚
</span></span><span style="display:flex;"><span>          â–¼
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚      Context      â”‚
</span></span><span style="display:flex;"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span style="display:flex;"><span>â”‚process(req, resp) â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªContextç»„ä»¶æœ¬è´¨ä¸Šå¯ä»¥è§†ä¸ºServletè§„èŒƒå®šä¹‰çš„<code>ServletContext</code>ï¼Œè€Œè§„èŒƒå®šä¹‰çš„Servletã€Filterã€Listenerç­‰ç»„ä»¶ï¼Œå°±å¯ä»¥è®©<code>ServletContext</code>ç®¡ç†ï¼Œåç»­çš„æœåŠ¡å™¨è®¾è®¡å°±ç®€åŒ–ä¸ºå¦‚ä½•å®ç°<code>ServletContext</code>ï¼Œä»¥åŠå¦‚ä½•ç®¡ç†Servletã€Filterã€Listenerç­‰ç»„ä»¶ã€‚</p>
<h2 id="å®ç°servletcontext">å®ç°ServletContext<a hidden class="anchor" aria-hidden="true" href="#å®ç°servletcontext">#</a></h2>
<p>åœ¨Java Webåº”ç”¨ç¨‹åºä¸­ï¼Œ<code>ServletContext</code>ä»£è¡¨åº”ç”¨ç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼Œä¸€ä¸ªWebåº”ç”¨ç¨‹åºå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„<code>ServletContext</code>å®ä¾‹ï¼Œ<code>ServletContext</code>å¯ä»¥ç”¨äºï¼š</p>
<ul>
<li>æä¾›åˆå§‹åŒ–å’Œå…¨å±€é…ç½®ï¼šå¯ä»¥ä»<code>ServletContext</code>è·å–Web Appé…ç½®çš„åˆå§‹åŒ–å‚æ•°ã€èµ„æºè·¯å¾„ç­‰ä¿¡æ¯ï¼›</li>
<li>å…±äº«å…¨å±€æ•°æ®ï¼š<code>ServletContext</code>å­˜å‚¨çš„æ•°æ®å¯ä»¥è¢«æ•´ä¸ªWeb Appçš„æ‰€æœ‰ç»„ä»¶è¯»å†™ã€‚</li>
</ul>
<p>æ—¢ç„¶<code>ServletContext</code>æ˜¯ä¸€ä¸ªWeb Appçš„å…¨å±€å”¯ä¸€å®ä¾‹ï¼Œè€ŒWeb Appåˆè¿è¡Œåœ¨Servletå®¹å™¨ä¸­ï¼Œæˆ‘ä»¬åœ¨å®ç°<code>ServletContext</code>æ—¶ï¼Œå®Œå…¨å¯ä»¥æŠŠå®ƒå½“ä½œServletå®¹å™¨æ¥å®ç°ï¼Œå®ƒåœ¨å†…éƒ¨ç»´æŠ¤ä¸€ç»„Servletå®ä¾‹ï¼Œå¹¶æ ¹æ®Servleté…ç½®çš„è·¯ç”±ä¿¡æ¯å°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„Servletå¤„ç†ã€‚å‡è®¾æˆ‘ä»¬ç¼–å†™äº†ä¸¤ä¸ªServletï¼š</p>
<ul>
<li>IndexServletï¼šæ˜ å°„è·¯å¾„ä¸º<code>/</code>ï¼›</li>
<li>HelloServletï¼šæ˜ å°„è·¯å¾„ä¸º<code>/hello</code>ã€‚</li>
</ul>
<p>é‚£ä¹ˆï¼Œå¤„ç†HTTPè¯·æ±‚çš„è·¯å¾„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                     â”‚   ServletContext   â”‚
</span></span><span style="display:flex;"><span>                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span style="display:flex;"><span>                     â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”Œâ”€â”€â–¶â”‚IndexServletâ”‚ â”‚
</span></span><span style="display:flex;"><span>â”€â”€â”€â–¶â”‚HttpConnectorâ”‚â”€â”€â”¼â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
</span></span><span style="display:flex;"><span>    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â””â”€â”€â–¶â”‚HelloServletâ”‚ â”‚
</span></span><span style="display:flex;"><span>                     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°<code>ServletContext</code>ã€‚é¦–å…ˆå®šä¹‰<code>ServletMapping</code>ï¼Œå®ƒåŒ…å«ä¸€ä¸ªServletå®ä¾‹ï¼Œä»¥åŠå°†æ˜ å°„è·¯å¾„ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletMapping {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Pattern pattern; <span style="color:#007f7f">// ç¼–è¯‘åçš„æ­£åˆ™è¡¨è¾¾å¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">final</span> Servlet servlet; <span style="color:#007f7f">// Servletå®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">public</span> ServletMapping(String urlPattern, Servlet servlet) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">pattern</span> = buildPattern(urlPattern); <span style="color:#007f7f">// ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servlet</span> = servlet;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥å®ç°<code>ServletContext</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletContextImpl <span style="color:#fff;font-weight:bold">implements</span> ServletContext {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> List&lt;ServletMapping&gt; servletMappings = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªæ•°æ®ç»“æ„è¶³å¤Ÿèƒ½è®©æˆ‘ä»¬å®ç°æ ¹æ®è¯·æ±‚è·¯å¾„è·¯ç”±åˆ°æŸä¸ªç‰¹å®šçš„Servletï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletContextImpl <span style="color:#fff;font-weight:bold">implements</span> ServletContext {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// HTTPè¯·æ±‚å¤„ç†å…¥å£:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> process(HttpServletRequest request, HttpServletResponse response) <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¯·æ±‚è·¯å¾„:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        String path = request.<span style="color:#007f7f">getRequestURI</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æœç´¢Servlet:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Servlet servlet = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (ServletMapping mapping : <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletMappings</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (mapping.<span style="color:#007f7f">matches</span>(path)) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// è·¯å¾„åŒ¹é…:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                servlet = mapping.<span style="color:#007f7f">servlet</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (servlet == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æœªåŒ¹é…åˆ°ä»»ä½•Servletæ˜¾ç¤º404 Not Found:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            PrintWriter pw = response.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>            pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;p&gt;No mapping for URL: &#34;</span> + path + <span style="color:#0ff;font-weight:bold">&#34;&lt;/p&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>            pw.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ç”±Servletç»§ç»­å¤„ç†è¯·æ±‚:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        servlet.<span style="color:#007f7f">service</span>(request, response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†<code>ServletContext</code>ï¼</p>
<p>ä¸è¿‡ï¼Œç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæˆ‘ä»¬ç¼–å†™çš„ä¸¤ä¸ªServletï¼š<code>IndexServlet</code>å’Œ<code>HelloServlet</code>ï¼Œè¿˜æ²¡æœ‰è¢«æ·»åŠ åˆ°<code>ServletContext</code>ä¸­ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šServletåœ¨ä»€ä¹ˆæ—¶å€™è¢«åˆå§‹åŒ–ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯åœ¨åˆ›å»º<code>ServletContext</code>å®ä¾‹åï¼Œå°±ç«‹åˆ»åˆå§‹åŒ–æ‰€æœ‰çš„Servletã€‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ª<code>initialize()</code>æ–¹æ³•ï¼Œç”¨äºåˆå§‹åŒ–Servletï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletContextImpl <span style="color:#fff;font-weight:bold">implements</span> ServletContext {
</span></span><span style="display:flex;"><span>    Map&lt;String, ServletRegistrationImpl&gt; servletRegistrations = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>    Map&lt;String, Servlet&gt; nameToServlets = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>    List&lt;ServletMapping&gt; servletMappings = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> initialize(List&lt;Class&lt;?&gt;&gt; servletClasses) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä¾æ¬¡æ·»åŠ æ¯ä¸ªServlet:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (Class&lt;?&gt; c : servletClasses) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è·å–@WebServletæ³¨è§£:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            WebServlet ws = c.<span style="color:#007f7f">getAnnotation</span>(WebServlet.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>            Class&lt;? <span style="color:#fff;font-weight:bold">extends</span> Servlet&gt; clazz = (Class&lt;? <span style="color:#fff;font-weight:bold">extends</span> Servlet&gt;) c;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªServletRegistration.Dynamic:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            ServletRegistration.<span style="color:#007f7f">Dynamic</span> registration = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">addServlet</span>(AnnoUtils.<span style="color:#007f7f">getServletName</span>(clazz), clazz);
</span></span><span style="display:flex;"><span>            registration.<span style="color:#007f7f">addMapping</span>(AnnoUtils.<span style="color:#007f7f">getServletUrlPatterns</span>(clazz));
</span></span><span style="display:flex;"><span>            registration.<span style="color:#007f7f">setInitParameters</span>(AnnoUtils.<span style="color:#007f7f">getServletInitParams</span>(clazz));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å®ä¾‹åŒ–Servlet:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (String name : <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletRegistrations</span>.<span style="color:#007f7f">keySet</span>()) {
</span></span><span style="display:flex;"><span>            var registration = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletRegistrations</span>.<span style="color:#007f7f">get</span>(name);
</span></span><span style="display:flex;"><span>            registration.<span style="color:#007f7f">servlet</span>.<span style="color:#007f7f">init</span>(registration.<span style="color:#007f7f">getServletConfig</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">nameToServlets</span>.<span style="color:#007f7f">put</span>(name, registration.<span style="color:#007f7f">servlet</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (String urlPattern : registration.<span style="color:#007f7f">getMappings</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletMappings</span>.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> ServletMapping(urlPattern, registration.<span style="color:#007f7f">servlet</span>));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            registration.<span style="color:#007f7f">initialized</span> = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ServletRegistration.<span style="color:#007f7f">Dynamic</span> addServlet(String name, Servlet servlet) {
</span></span><span style="display:flex;"><span>        var registration = <span style="color:#fff;font-weight:bold">new</span> ServletRegistrationImpl(<span style="color:#fff;font-weight:bold">this</span>, name, servlet);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletRegistrations</span>.<span style="color:#007f7f">put</span>(name, registration);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> registration;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»Servlet 3.0è§„èŒƒå¼€å§‹ï¼Œæˆ‘ä»¬å¿…é¡»è¦æä¾›<code>addServlet()</code>åŠ¨æ€æ·»åŠ ä¸€ä¸ªServletï¼Œå¹¶ä¸”è¿”å›<code>ServletRegistration.Dynamic</code>ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>initialize()</code>æ–¹æ³•ä¸­è°ƒç”¨<code>addServlet()</code>ï¼Œå®Œæˆæ‰€æœ‰Servletçš„åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚</p>
<p>æœ€åæˆ‘ä»¬ä¿®æ”¹<code>HttpConnector</code>ï¼Œå®ä¾‹åŒ–<code>ServletContextImpl</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HttpConnector <span style="color:#fff;font-weight:bold">implements</span> HttpHandler {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æŒæœ‰ServletContextå®ä¾‹:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">final</span> ServletContextImpl servletContext;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> HttpServer httpServer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> HttpConnector() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºServletContext:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span> = <span style="color:#fff;font-weight:bold">new</span> ServletContextImpl();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆå§‹åŒ–Servlet:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>.<span style="color:#007f7f">initialize</span>(List.<span style="color:#007f7f">of</span>(IndexServlet.<span style="color:#007f7f">class</span>, HelloServlet.<span style="color:#007f7f">class</span>));
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(HttpExchange exchange) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        var adapter = <span style="color:#fff;font-weight:bold">new</span> HttpExchangeAdapter(exchange);
</span></span><span style="display:flex;"><span>        var request = <span style="color:#fff;font-weight:bold">new</span> HttpServletRequestImpl(adapter);
</span></span><span style="display:flex;"><span>        var response = <span style="color:#fff;font-weight:bold">new</span> HttpServletResponseImpl(adapter);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// process:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>.<span style="color:#007f7f">process</span>(request, response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡ŒæœåŠ¡å™¨ï¼Œè¾“å…¥<code>http://localhost:8080/</code>ï¼ŒæŸ¥çœ‹<code>IndexServlet</code>çš„è¾“å‡ºï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1556731440136257/l" alt="index"  />
</p>
<p>è¾“å…¥<code>http://localhost:8080/hello?name=Bob</code>ï¼ŒæŸ¥çœ‹<code>HelloServlet</code>çš„è¾“å‡ºï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1556731521925184/l" alt="hello"  />
</p>
<p>è¾“å…¥é”™è¯¯çš„è·¯å¾„ï¼ŒæŸ¥çœ‹404è¾“å‡ºï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1556731565965377/l" alt="404"  />
</p>
<p>å¯è§ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå®Œæˆäº†<code>ServletContext</code>å’Œæ‰€æœ‰Servletçš„ç®¡ç†ï¼Œå¹¶å®ç°äº†æ­£ç¡®çš„è·¯ç”±ã€‚</p>
<p>æœ‰çš„åŒå­¦ä¼šé—®ï¼šServletæœ¬èº«åº”è¯¥æ˜¯Web Appå¼€å‘äººå‘˜å®ç°ï¼Œè€Œä¸æ˜¯ç”±æœåŠ¡å™¨å®ç°ã€‚æˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸­å´å†™æ­»äº†ä¸¤ä¸ªServletï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚æ­£ç¡®çš„æ–¹å¼æ˜¯ä»å¤–éƒ¨waråŒ…åŠ è½½Servletï¼Œä½†æ˜¯è¿™ä¸ªé—®é¢˜æˆ‘ä»¬æ”¾åˆ°åé¢è§£å†³ã€‚</p>
<h2 id="å®ç°filterchain">å®ç°FilterChain<a hidden class="anchor" aria-hidden="true" href="#å®ç°filterchain">#</a></h2>
<p>ä¸Šä¸€èŠ‚æˆ‘ä»¬å®ç°äº†<code>ServletContext</code>ï¼Œå¹¶ä¸”èƒ½å¤Ÿç®¡ç†æ‰€æœ‰çš„Servletç»„ä»¶ã€‚æœ¬èŠ‚æˆ‘ä»¬ç»§ç»­å¢åŠ å¯¹Filterç»„ä»¶çš„æ”¯æŒã€‚</p>
<p>Filteræ˜¯Servletè§„èŒƒä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨HTTPè¯·æ±‚åˆ°è¾¾Servletä¹‹å‰è¿›è¡Œé¢„å¤„ç†ã€‚å®ƒå¯ä»¥è¢«ä¸€ä¸ªæˆ–å¤šä¸ªFilteræŒ‰ç…§ä¸€å®šçš„é¡ºåºç»„æˆä¸€ä¸ªå¤„ç†é“¾ï¼ˆFilterChainï¼‰ï¼Œç”¨æ¥å¤„ç†ä¸€äº›å…¬å…±é€»è¾‘ï¼Œæ¯”å¦‚æ‰“å°æ—¥å¿—ã€ç™»å½•æ£€æŸ¥ç­‰ã€‚</p>
<p>Filterè¿˜å¯ä»¥æœ‰é’ˆå¯¹æ€§åœ°æ‹¦æˆªæˆ–è€…æ”¾è¡ŒHTTPè¯·æ±‚ï¼Œæœ¬è´¨ä¸Šä¸€ä¸ª<code>FilterChain</code>å°±æ˜¯ä¸€ä¸ª<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1281319474561057">è´£ä»»é“¾</a>æ¨¡å¼ã€‚åœ¨Servletå®¹å™¨ä¸­ï¼Œå¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>  â”‚ ServletContext  â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â” â”‚
</span></span><span style="display:flex;"><span>  â”‚   FilterChain   â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
</span></span><span style="display:flex;"><span>â”€â”€â”¼â”€â”€â–¶â”‚ Filter  â”‚   â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚        â”‚        â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚      â–¼      â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”‚ Filter  â”‚ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚      â”‚      â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚        â–¼        â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚   â”‚ Filter  â”‚   â”‚
</span></span><span style="display:flex;"><span>  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
</span></span><span style="display:flex;"><span>  â”‚  â”€ â”€ â”€ â”¬ â”€ â”€ â”€  â”‚
</span></span><span style="display:flex;"><span>  â”‚        â–¼        â”‚
</span></span><span style="display:flex;"><span>  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
</span></span><span style="display:flex;"><span>  â”‚   â”‚ Servlet â”‚   â”‚
</span></span><span style="display:flex;"><span>  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
</span></span><span style="display:flex;"><span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ol>
<li>æœ€ç»ˆå¤„ç†è¯·æ±‚çš„Servletæ˜¯æ ¹æ®è¯·æ±‚è·¯å¾„é€‰æ‹©çš„ï¼›</li>
<li>Filteré“¾ä¸Šçš„Filteræ˜¯æ ¹æ®è¯·æ±‚è·¯å¾„åŒ¹é…çš„ï¼Œå¯èƒ½åŒ¹é…0ä¸ªæˆ–å¤šä¸ªFilterï¼›</li>
<li>åŒ¹é…çš„Filterå°†ç»„æˆFilterChainè¿›è¡Œè°ƒç”¨ã€‚</li>
</ol>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬é¦–å…ˆå°†<code>Filter</code>çº³å…¥<code>ServletContext</code>ä¸­ç®¡ç†ã€‚å’Œ<code>ServletMapping</code>ç±»ä¼¼ï¼Œå…ˆå®šä¹‰<code>FilterMapping</code>ï¼Œå®ƒåŒ…å«ä¸€ä¸ª<code>Filter</code>å®ä¾‹ï¼Œä»¥åŠå°†æ˜ å°„è·¯å¾„ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> FilterMapping {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Pattern pattern; <span style="color:#007f7f">// ç¼–è¯‘åçš„æ­£åˆ™è¡¨è¾¾å¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">final</span> Filter filter;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> FilterMapping(String urlPattern, Filter filter) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">pattern</span> = buildPattern(urlPattern); <span style="color:#007f7f">// ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">filter</span> = filter;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ç€ï¼Œæ ¹æ®Servletè§„èŒƒï¼Œæˆ‘ä»¬éœ€è¦æä¾›<code>addFilter()</code>åŠ¨æ€æ·»åŠ ä¸€ä¸ª<code>Filter</code>ï¼Œå¹¶ä¸”è¿”å›<code>FilterRegistration.Dynamic</code>ï¼Œæ‰€ä»¥éœ€è¦åœ¨<code>ServletContext</code>ä¸­å®ç°ç›¸å…³æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletContextImpl <span style="color:#fff;font-weight:bold">implements</span> ServletContext {
</span></span><span style="display:flex;"><span>    Map&lt;String, FilterRegistrationImpl&gt; filterRegistrations = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>    Map&lt;String, Filter&gt; nameToFilters = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>    List&lt;FilterMapping&gt; filterMappings = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ ¹æ®Class Nameæ·»åŠ Filter:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> FilterRegistration.<span style="color:#007f7f">Dynamic</span> addFilter(String name, String className) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> addFilter(name, Class.<span style="color:#007f7f">forName</span>(className));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ ¹æ®Classæ·»åŠ Filter:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> FilterRegistration.<span style="color:#007f7f">Dynamic</span> addFilter(String name, Class&lt;? <span style="color:#fff;font-weight:bold">extends</span> Filter&gt; clazz) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> addFilter(name, clazz.<span style="color:#007f7f">newInstance</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ ¹æ®Filterå®ä¾‹æ·»åŠ Filter:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> FilterRegistration.<span style="color:#007f7f">Dynamic</span> addFilter(String name, Filter filter) {
</span></span><span style="display:flex;"><span>        var registration = <span style="color:#fff;font-weight:bold">new</span> FilterRegistrationImpl(<span style="color:#fff;font-weight:bold">this</span>, name, filter);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">filterRegistrations</span>.<span style="color:#007f7f">put</span>(name, registration);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> registration;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†æ·»åŠ ä¸€ä¸ª<code>initFilters()</code>æ–¹æ³•ç”¨äºå‘å®¹å™¨æ·»åŠ <code>Filter</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletContextImpl <span style="color:#fff;font-weight:bold">implements</span> ServletContext {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> initFilters(List&lt;Class&lt;?&gt;&gt; filterClasses) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (Class&lt;?&gt; c : filterClasses) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è·å–@WebFilteræ³¨è§£:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            WebFilter wf = c.<span style="color:#007f7f">getAnnotation</span>(WebFilter.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ·»åŠ Filter:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            FilterRegistration.<span style="color:#007f7f">Dynamic</span> registration = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">addFilter</span>(AnnoUtils.<span style="color:#007f7f">getFilterName</span>(clazz), clazz);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ·»åŠ URLæ˜ å°„:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            registration.<span style="color:#007f7f">addMappingForUrlPatterns</span>(EnumSet.<span style="color:#007f7f">of</span>(DispatcherType.<span style="color:#007f7f">REQUEST</span>), <span style="color:#fff;font-weight:bold">true</span>, AnnoUtils.<span style="color:#007f7f">getFilterUrlPatterns</span>(clazz));
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è®¾ç½®åˆå§‹åŒ–å‚æ•°:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            registration.<span style="color:#007f7f">setInitParameters</span>(AnnoUtils.<span style="color:#007f7f">getFilterInitParams</span>(clazz));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (String name : <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">filterRegistrations</span>.<span style="color:#007f7f">keySet</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// ä¾æ¬¡å¤„ç†æ¯ä¸ªFilterRegistration.Dynamic:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            var registration = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">filterRegistrations</span>.<span style="color:#007f7f">get</span>(name);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è°ƒç”¨Filter.init()æ–¹æ³•:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            registration.<span style="color:#007f7f">filter</span>.<span style="color:#007f7f">init</span>(registration.<span style="color:#007f7f">getFilterConfig</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">nameToFilters</span>.<span style="color:#007f7f">put</span>(name, registration.<span style="color:#007f7f">filter</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å°†Filterå®šä¹‰çš„æ¯ä¸ªURLæ˜ å°„ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">for</span> (String urlPattern : registration.<span style="color:#007f7f">getUrlPatternMappings</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">filterMappings</span>.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> FilterMapping(urlPattern, registration.<span style="color:#007f7f">filter</span>));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†å¯¹Filterç»„ä»¶çš„ç®¡ç†ã€‚</p>
<p>ä¸‹ä¸€æ­¥ï¼Œæ˜¯æ”¹é€ <code>process()</code>æ–¹æ³•ï¼ŒæŠŠåŸæ¥ç›´æ¥æŠŠè¯·æ±‚æ‰”ç»™<code>Servlet</code>å¤„ç†ï¼Œæ”¹æˆå…ˆåŒ¹é…<code>Filter</code>ï¼Œå¤„ç†åå†æ‰”ç»™æœ€ç»ˆçš„<code>Servlet</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletContextImpl <span style="color:#fff;font-weight:bold">implements</span> ServletContext {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> process(HttpServletRequest request, HttpServletResponse response) <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–è¯·æ±‚è·¯å¾„:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        String path = request.<span style="color:#007f7f">getRequestURI</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æŸ¥æ‰¾Servlet:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Servlet servlet = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (ServletMapping mapping : <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletMappings</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (mapping.<span style="color:#007f7f">matches</span>(path)) {
</span></span><span style="display:flex;"><span>                servlet = mapping.<span style="color:#007f7f">servlet</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (servlet == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 404é”™è¯¯:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            PrintWriter pw = response.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>            pw.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;p&gt;No mapping for URL: &#34;</span> + path + <span style="color:#0ff;font-weight:bold">&#34;&lt;/p&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>            pw.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æŸ¥æ‰¾Filter:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        List&lt;Filter&gt; enabledFilters = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (FilterMapping mapping : <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">filterMappings</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (mapping.<span style="color:#007f7f">matches</span>(path)) {
</span></span><span style="display:flex;"><span>                enabledFilters.<span style="color:#007f7f">add</span>(mapping.<span style="color:#007f7f">filter</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Filter[] filters = enabledFilters.<span style="color:#007f7f">toArray</span>(Filter[]::<span style="color:#fff;font-weight:bold">new</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ„é€ FilterChainå®ä¾‹:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        FilterChain chain = <span style="color:#fff;font-weight:bold">new</span> FilterChainImpl(filters, servlet);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ç”±FilterChainå¤„ç†:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        chain.<span style="color:#007f7f">doFilter</span>(request, response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ä¸Šè¿°<code>FilterChain</code>ä¸ä»…åŒ…å«ä¸€ä¸ª<code>Filter[]</code>æ•°ç»„ï¼Œè¿˜åŒ…å«ä¸€ä¸ª<code>Servlet</code>ï¼Œè¿™æ ·æˆ‘ä»¬è°ƒç”¨<code>chain.doFilter()</code>æ—¶ï¼Œåœ¨<code>FilterChain</code>ä¸­æœ€åä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å°±æ˜¯<code>Servlet</code>ï¼Œè¿™æ ·è®¾è®¡å¯ä»¥ç®€åŒ–æˆ‘ä»¬å®ç°<code>FilterChain</code>çš„ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> FilterChainImpl <span style="color:#fff;font-weight:bold">implements</span> FilterChain {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Filter[] filters;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Servlet servlet;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> total; <span style="color:#007f7f">// Filteræ€»æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">int</span> index = <span style="color:#ff0;font-weight:bold">0</span>; <span style="color:#007f7f">// ä¸‹ä¸€ä¸ªè¦å¤„ç†çš„Filter[index]
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> FilterChainImpl(Filter[] filters, Servlet servlet) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">filters</span> = filters;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servlet</span> = servlet;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">total</span> = filters.<span style="color:#007f7f">length</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(ServletRequest request, ServletResponse response) <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (index &lt; total) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> current = index;
</span></span><span style="display:flex;"><span>            index++;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è°ƒç”¨ä¸‹ä¸€ä¸ªFilterå¤„ç†:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            filters[current].<span style="color:#007f7f">doFilter</span>(request, response, <span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è°ƒç”¨Servletå¤„ç†:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            servlet.<span style="color:#007f7f">service</span>(request, response);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„<code>FilterChain</code>æ˜¯ä¸€ä¸ªé€’å½’è°ƒç”¨ï¼Œå› ä¸ºåœ¨æ‰§è¡Œ<code>Filter.doFilter()</code>æ—¶ï¼Œéœ€è¦æŠŠ<code>FilterChain</code>è‡ªèº«ä¼ è¿›å»ï¼Œåœ¨æ‰§è¡Œ<code>Filter.doFilter()</code>ä¹‹å‰ï¼Œå°±è¦æŠŠ<code>index</code>è°ƒæ•´åˆ°æ­£ç¡®çš„å€¼ã€‚</p>
<p>æˆ‘ä»¬ç¼–å†™ä¸¤ä¸ªæµ‹è¯•ç”¨çš„Filterï¼š</p>
<ul>
<li>LogFilterï¼šåŒ¹é…<code>/*</code>ï¼Œæ‰“å°è¯·æ±‚æ–¹æ³•ã€è·¯å¾„ç­‰ä¿¡æ¯ï¼›</li>
<li>HelloFilterï¼šåŒ¹é…<code>/hello</code>ï¼Œæ ¹æ®è¯·æ±‚å‚æ•°å†³å®šæ”¾è¡Œè¿˜æ˜¯è¿”å›403é”™è¯¯ã€‚</li>
</ul>
<p>åœ¨åˆå§‹åŒ–ServletContextImplæ—¶å°†FilteråŠ è¿›å»ï¼Œå…ˆæµ‹è¯•<code>http://localhost:8080/</code>ï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1556731440136257/l" alt="index"  />
</p>
<p>è§‚å¯Ÿåå°è¾“å‡ºï¼Œ<code>LogFilter</code>åº”è¯¥èµ·ä½œç”¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>16:48:00.304 [HTTP-Dispatcher] INFO  c.i.j.engine.filter.LogFilter -- GET: /
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†æµ‹è¯•<code>http://localhost:8080/hello?name=Bob</code>ï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1556731521925184/l" alt="hello"  />
</p>
<p>è§‚å¯Ÿåå°è¾“å‡ºï¼Œ<code>HelloFilter</code>å’Œ<code>LogFilter</code>åº”è¯¥èµ·ä½œç”¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>16:49:31.409 [HTTP-Dispatcher] INFO  c.i.j.engine.filter.HelloFilter -- Check parameter name = Bob
</span></span><span style="display:flex;"><span>16:49:31.409 [HTTP-Dispatcher] INFO  c.i.j.engine.filter.LogFilter -- GET: /hello
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åæµ‹è¯•<code>http://localhost:8080/hello?name=Jim</code>ï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1556743431651392/l" alt="403"  />
</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>HelloFilter</code>æ‹¦æˆªäº†è¯·æ±‚ï¼Œè¿”å›403é”™è¯¯ï¼Œæœ€ç»ˆçš„<code>HelloServlet</code>å¹¶æ²¡æœ‰å¤„ç†è¯¥è¯·æ±‚ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±æˆåŠŸåœ°åœ¨<code>ServletContext</code>ä¸­å®ç°äº†å¯¹<code>Filter</code>çš„ç®¡ç†ï¼Œä»¥åŠæ ¹æ®æ¯ä¸ªè¯·æ±‚ï¼Œæ„é€ å¯¹åº”çš„<code>FilterChain</code>æ¥å¤„ç†è¯·æ±‚ã€‚ç›®å‰è¿˜æœ‰å‡ ä¸ªå°é—®é¢˜ï¼š</p>
<p>ä¸€æ˜¯å’ŒServletä¸€æ ·ï¼ŒFilteræœ¬èº«åº”è¯¥æ˜¯Web Appå¼€å‘äººå‘˜å®ç°ï¼Œè€Œä¸æ˜¯ç”±æœåŠ¡å™¨å®ç°ã€‚æˆ‘ä»¬åœ¨åœ¨æœåŠ¡å™¨ä¸­å†™æ­»äº†ä¸¤ä¸ªFilterï¼Œè¿™ä¸ªé—®é¢˜åç»­è§£å†³ï¼›</p>
<p>äºŒæ˜¯Servletè§„èŒƒå¹¶æ²¡æœ‰è§„å®šå¤šä¸ªFilteråº”è¯¥å¦‚ä½•æ’åºï¼Œæˆ‘ä»¬åœ¨å®ç°æ—¶ä¹Ÿæ²¡æœ‰å¯¹Filterè¿›è¡Œæ’åºã€‚å¦‚æœè¦æŒ‰å›ºå®šé¡ºåºç»™Filteræ’åºï¼Œä»Servletè§„èŒƒæ¥è¯´æ€ä¹ˆæ’åºéƒ½å¯ä»¥ï¼Œé€šå¸¸æ˜¯æŒ‰<code>@WebFilter</code>å®šä¹‰çš„<code>filterName</code>è¿›è¡Œæ’åºï¼ŒSpring Bootæä¾›çš„ä¸€ä¸ª<code>FilterRegistrationBean</code>å…è®¸å¼€å‘äººå‘˜è‡ªå·±å®šä¹‰Filterçš„é¡ºåºã€‚</p>
<h2 id="å®ç°httpsession">å®ç°HttpSession<a hidden class="anchor" aria-hidden="true" href="#å®ç°httpsession">#</a></h2>
<p>HttpSessionæ˜¯Java Web Appçš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç»´æŠ¤ä¼šè¯çŠ¶æ€ä¿¡æ¯ã€‚</p>
<h3 id="sessionåŸç†">SessionåŸç†<a hidden class="anchor" aria-hidden="true" href="#sessionåŸç†">#</a></h3>
<p>å½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚Webåº”ç”¨ç¨‹åºæ—¶ï¼ŒæœåŠ¡å™¨ä¼šä¸ºè¯¥å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„Session IDï¼Œè¯¥IDæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œç„¶åï¼Œå°†è¯¥IDå­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ä¸€ä¸ªåä¸º<code>JSESSIONID</code>çš„Cookieä¸­ã€‚ä¸æ­¤åŒæ—¶ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ª<code>HttpSession</code>å¯¹è±¡ï¼Œä¸Session IDå…³è”ï¼Œç”¨äºå­˜å‚¨ä¸è¯¥å®¢æˆ·ç«¯ç›¸å…³çš„çŠ¶æ€ä¿¡æ¯ã€‚</p>
<p>å½“å®¢æˆ·ç«¯å‘é€åç»­è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯å‘é€çš„åä¸º<code>JSESSIONID</code>çš„Cookieä¸­è·å¾—Session IDï¼Œç„¶åæŸ¥æ‰¾å¯¹åº”çš„<code>HttpSession</code>å¯¹è±¡ï¼Œå¹¶ä»ä¸­è¯»å–æˆ–ç»§ç»­å†™å…¥çŠ¶æ€ä¿¡æ¯ã€‚</p>
<h3 id="sessionç”¨é€”">Sessionç”¨é€”<a hidden class="anchor" aria-hidden="true" href="#sessionç”¨é€”">#</a></h3>
<p>Sessionä¸»è¦ç”¨äºç»´æŠ¤ä¸€ä¸ªå®¢æˆ·ç«¯çš„ä¼šè¯çŠ¶æ€ã€‚é€šå¸¸ï¼Œç”¨æˆ·æˆåŠŸç™»å½•åï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªæ–°çš„<code>HttpSession</code>ï¼Œå¹¶å°†ç”¨æˆ·IDã€ç”¨æˆ·åç­‰ä¿¡æ¯æ”¾å…¥<code>HttpSession</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/login&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LoginServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doPost(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        String username = req.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;username&#34;</span>);
</span></span><span style="display:flex;"><span>        String password = req.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (loginOk(username, password)) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// ç™»å½•æˆåŠŸï¼Œè·å–Session:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            HttpSession session = req.<span style="color:#007f7f">getSession</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å°†ç”¨æˆ·åæ”¾å…¥Session:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            session.<span style="color:#007f7f">setAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;username&#34;</span>, username);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è¿”å›é¦–é¡µ:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            resp.<span style="color:#007f7f">sendRedirect</span>(<span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// ç™»å½•å¤±è´¥:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            resp.<span style="color:#007f7f">sendRedirect</span>(<span style="color:#0ff;font-weight:bold">&#34;/error&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å…¶ä»–é¡µé¢ï¼Œå¯ä»¥éšæ—¶è·å–<code>HttpSession</code>å¹¶å–å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œç„¶ååœ¨é¡µé¢å±•ç¤ºç»™ç”¨æˆ·ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> IndexServlet <span style="color:#fff;font-weight:bold">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–Session:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        HttpSession session = req.<span style="color:#007f7f">getSession</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä»Sessionä¸­å–å‡ºç”¨æˆ·å:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        String username = (String) session.<span style="color:#007f7f">getAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;username&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (username == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æœªè·å–åˆ°ç”¨æˆ·åï¼Œè¯´æ˜æœªç™»å½•:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            resp.<span style="color:#007f7f">sendRedirect</span>(<span style="color:#0ff;font-weight:bold">&#34;/login&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è·å–åˆ°ç”¨æˆ·åï¼Œè¯´æ˜å·²ç™»å½•:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            String html = <span style="color:#0ff;font-weight:bold">&#34;&lt;p&gt;Welcome, &#34;</span> + username + <span style="color:#0ff;font-weight:bold">&#34;!&lt;/p&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>            resp.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;text/html&#34;</span>);
</span></span><span style="display:flex;"><span>            PrintWriter pw = resp.<span style="color:#007f7f">getWriter</span>();
</span></span><span style="display:flex;"><span>            pw.<span style="color:#007f7f">write</span>(html);
</span></span><span style="display:flex;"><span>            pw.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç”¨æˆ·ç™»å‡ºæ—¶ï¼Œéœ€è¦è°ƒç”¨<code>HttpSession</code>çš„<code>invalidate()</code>æ–¹æ³•ï¼Œè®©ä¼šè¯å¤±æ•ˆï¼Œè¿™æ ·ï¼Œç”¨æˆ·å°†é‡æ–°å›åˆ°æœªç™»å½•çŠ¶æ€ï¼Œå› ä¸ºåç»­è°ƒç”¨<code>req.getSession()</code>å°†è¿”å›ä¸€ä¸ªæ–°çš„<code>HttpSession</code>ï¼Œä»è¿™ä¸ªæ–°çš„<code>HttpSession</code>å–å‡ºçš„<code>username</code>å°†æ˜¯<code>null</code>ã€‚</p>
<h3 id="httpsessionçš„ç”Ÿå‘½å‘¨æœŸ">HttpSessionçš„ç”Ÿå‘½å‘¨æœŸ<a hidden class="anchor" aria-hidden="true" href="#httpsessionçš„ç”Ÿå‘½å‘¨æœŸ">#</a></h3>
<p>ç¬¬ä¸€æ¬¡è°ƒç”¨<code>req.getSession()</code>æ—¶ï¼ŒæœåŠ¡å™¨ä¼šä¸ºè¯¥å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæ–°çš„<code>HttpSession</code>å¯¹è±¡ï¼›</p>
<p>åç»­è°ƒç”¨<code>req.getSession()</code>æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸ä¹‹å…³è”çš„<code>HttpSession</code>å¯¹è±¡ï¼›</p>
<p>è°ƒç”¨<code>req.getSession().invalidate()</code>æ—¶ï¼ŒæœåŠ¡å™¨ä¼šé”€æ¯è¯¥å®¢æˆ·ç«¯å¯¹åº”çš„<code>HttpSession</code>å¯¹è±¡ï¼›</p>
<p>å½“å®¢æˆ·ç«¯ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ–°çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®Sessionè¶…æ—¶è‡ªåŠ¨é”€æ¯è¶…æ—¶çš„<code>HttpSession</code>å¯¹è±¡ã€‚</p>
<h3 id="httpsessionæ¥å£">HttpSessionæ¥å£<a hidden class="anchor" aria-hidden="true" href="#httpsessionæ¥å£">#</a></h3>
<p><code>HttpSession</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼ŒJavaçš„Webåº”ç”¨è°ƒç”¨<code>HttpServletRequest</code>çš„<code>getSession()</code>æ–¹æ³•æ—¶ï¼Œéœ€è¦è¿”å›ä¸€ä¸ª<code>HttpSession</code>çš„å®ç°ç±»ã€‚</p>
<p>äº†è§£äº†ä»¥ä¸Šå…³äº<code>HttpSession</code>çš„ç›¸å…³è§„èŒƒåï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å®ç°å¯¹<code>HttpSession</code>çš„æ”¯æŒã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª<code>SessionManager</code>ï¼Œç”¨æ¥ç®¡ç†æ‰€æœ‰çš„Sessionï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SessionManager {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¼•ç”¨ServletContext:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ServletContextImpl servletContext;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æŒæœ‰SessionID -&gt; Session:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    Map&lt;String, HttpSessionImpl&gt; sessions = <span style="color:#fff;font-weight:bold">new</span> ConcurrentHashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Sessioné»˜è®¤è¿‡æœŸæ—¶é—´(ç§’):
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">int</span> inactiveInterval;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ ¹æ®SessionIDè·å–ä¸€ä¸ªSession:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">public</span> HttpSession getSession(String sessionId) {
</span></span><span style="display:flex;"><span>        HttpSessionImpl session = sessions.<span style="color:#007f7f">get</span>(sessionId);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (session == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Sessionæœªæ‰¾åˆ°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Session:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            session = <span style="color:#fff;font-weight:bold">new</span> HttpSessionImpl(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>, sessionId, inactiveInterval);
</span></span><span style="display:flex;"><span>            sessions.<span style="color:#007f7f">put</span>(sessionId, session);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Sessionå·²å­˜åœ¨ï¼Œæ›´æ–°æœ€åè®¿é—®æ—¶é—´:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            session.<span style="color:#007f7f">lastAccessedTime</span> = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> session;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ é™¤Session:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> remove(HttpSession session) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">sessions</span>.<span style="color:#007f7f">remove</span>(session.<span style="color:#007f7f">getId</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>SessionManager</code>ç”±<code>ServletContextImpl</code>æŒæœ‰å”¯ä¸€å®ä¾‹ã€‚</p>
<p>å†ç¼–å†™ä¸€ä¸ª<code>HttpSession</code>çš„å®ç°ç±»<code>HttpSessionImpl</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HttpSessionImpl <span style="color:#fff;font-weight:bold">implements</span> HttpSession {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ServletContextImpl servletContext; <span style="color:#007f7f">// ServletContext
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    String sessionId; <span style="color:#007f7f">// SessionID
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">int</span> maxInactiveInterval; <span style="color:#007f7f">// è¿‡æœŸæ—¶é—´(s)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">long</span> creationTime; <span style="color:#007f7f">// åˆ›å»ºæ—¶é—´(ms)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">long</span> lastAccessedTime; <span style="color:#007f7f">// æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´(ms)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    Attributes attributes; <span style="color:#007f7f">// getAttribute/setAttribute
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹ç”¨æˆ·è°ƒç”¨Sessionçš„ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>HttpSession session = request.<span style="color:#007f7f">getSession</span>();
</span></span><span style="display:flex;"><span>session.<span style="color:#007f7f">invalidate</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äº<code>HttpSession</code>æ˜¯ä»<code>HttpServletRequest</code>è·å¾—çš„ï¼Œå› æ­¤ï¼Œå¿…é¡»åœ¨<code>HttpServletRequestImpl</code>ä¸­å¼•ç”¨<code>ServletContextImpl</code>ï¼Œæ‰èƒ½è®¿é—®<code>SessionManager</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HttpServletRequestImpl <span style="color:#fff;font-weight:bold">implements</span> HttpServletRequest {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¼•ç”¨ServletContextImpl:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    ServletContextImpl servletContext;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¼•ç”¨HttpServletResponse:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    HttpServletResponse response;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> HttpSession getSession(<span style="color:#fff;font-weight:bold">boolean</span> create) {
</span></span><span style="display:flex;"><span>        String sessionId = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–æ‰€æœ‰Cookie:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Cookie[] cookies = getCookies();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (cookies != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æŸ¥æ‰¾JSESSIONID:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">for</span> (Cookie cookie : cookies) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#0ff;font-weight:bold">&#34;JSESSIONID&#34;</span>.<span style="color:#007f7f">equals</span>(cookie.<span style="color:#007f7f">getName</span>())) {
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// æ‹¿åˆ°Session ID:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                    sessionId = cookie.<span style="color:#007f7f">getValue</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æœªè·å–åˆ°SessionIDï¼Œä¸”create=falseï¼Œè¿”å›null:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">if</span> (sessionId == <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; !create) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æœªè·å–åˆ°SessionIDï¼Œä½†create=trueï¼Œåˆ›å»ºæ–°çš„Session:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">if</span> (sessionId == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¦‚æœHeaderå·²ç»å‘é€ï¼Œåˆ™æ— æ³•åˆ›å»ºSessionï¼Œå› ä¸ºæ— æ³•æ·»åŠ Cookie:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">response</span>.<span style="color:#007f7f">isCommitted</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalStateException(<span style="color:#0ff;font-weight:bold">&#34;Cannot create session for response is commited.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// åˆ›å»ºéšæœºå­—ç¬¦ä¸²ä½œä¸ºSessionID:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            sessionId = UUID.<span style="color:#007f7f">randomUUID</span>().<span style="color:#007f7f">toString</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ„é€ ä¸€ä¸ªåä¸ºJSESSIONIDçš„Cookie:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            String cookieValue = <span style="color:#0ff;font-weight:bold">&#34;JSESSIONID=&#34;</span> + sessionId + <span style="color:#0ff;font-weight:bold">&#34;; Path=/; SameSite=Strict; HttpOnly&#34;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ·»åŠ åˆ°HttpServletResponseçš„Header:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">response</span>.<span style="color:#007f7f">addHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Set-Cookie&#34;</span>, cookieValue);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¿”å›ä¸€ä¸ªSessionå¯¹è±¡:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>.<span style="color:#007f7f">sessionManager</span>.<span style="color:#007f7f">getSession</span>(sessionId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> HttpSession getSession() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> getSession(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹<code>HttpServletRequestImpl</code>çš„æ”¹é€ ä¸»è¦æ˜¯åŠ å…¥äº†<code>ServletContextImpl</code>å’Œ<code>HttpServletResponse</code>çš„å¼•ç”¨ï¼šå¯ä»¥é€šè¿‡å‰è€…è®¿é—®åˆ°<code>SessionManager</code>ï¼Œè€Œåˆ›å»ºçš„æ–°çš„SessionIDéœ€è¦é€šè¿‡åè€…æŠŠCookieå‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå› æ­¤ï¼Œåœ¨<code>HttpConnector</code>ä¸­ï¼Œåšç›¸åº”çš„ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HttpConnector <span style="color:#fff;font-weight:bold">implements</span> HttpHandler {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(HttpExchange exchange) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        var adapter = <span style="color:#fff;font-weight:bold">new</span> HttpExchangeAdapter(exchange);
</span></span><span style="display:flex;"><span>        var response = <span style="color:#fff;font-weight:bold">new</span> HttpServletResponseImpl(adapter);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºRequestæ—¶ï¼Œéœ€è¦å¼•ç”¨servletContextå’Œresponse:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        var request = <span style="color:#fff;font-weight:bold">new</span> HttpServletRequestImpl(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>, adapter, response);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// process:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>.<span style="color:#007f7f">process</span>(request, response);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#007f7f">error</span>(e.<span style="color:#007f7f">getMessage</span>(), e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç”¨æˆ·è°ƒç”¨<code>session.invalidate()</code>æ—¶ï¼Œè¦è®©Sessionå¤±æ•ˆï¼Œå°±éœ€è¦ä»<code>SessionManager</code>ä¸­ç§»é™¤ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HttpSessionImpl <span style="color:#fff;font-weight:bold">implements</span> HttpSession {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> invalidate() {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä»SessionManagerä¸­ç§»é™¤:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>.<span style="color:#007f7f">sessionManager</span>.<span style="color:#007f7f">remove</span>(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">sessionId</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®ç°Sessionçš„è‡ªåŠ¨è¿‡æœŸã€‚ç”±äºæˆ‘ä»¬ç®¡ç†çš„Sessionå®é™…ä¸Šæ˜¯ä»¥<code>Map&lt;String, HttpSession&gt;</code>å­˜å‚¨çš„ï¼Œæ‰€ä»¥ï¼Œè®©Sessionè‡ªåŠ¨è¿‡æœŸå°±æ˜¯å®šæœŸæ‰«ææ‰€æœ‰çš„Sessionï¼Œç„¶åæ ¹æ®æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´å°†è¿‡æœŸçš„Sessionè‡ªåŠ¨åˆ é™¤ã€‚ç»™<code>SessionManager</code>åŠ ä¸€ä¸ª<code>Runnable</code>æ¥å£ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªDaemonçº¿ç¨‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SessionManager <span style="color:#fff;font-weight:bold">implements</span> Runnable {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> SessionManager(ServletContextImpl servletContext, <span style="color:#fff;font-weight:bold">int</span> interval) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¯åŠ¨Daemonçº¿ç¨‹:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Thread t = <span style="color:#fff;font-weight:bold">new</span> Thread(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>        t.<span style="color:#007f7f">setDaemon</span>(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>        t.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ‰«æçº¿ç¨‹:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ¯60ç§’æ‰«æä¸€æ¬¡:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                Thread.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">60_000L</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å½“å‰æ—¶é—´:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">long</span> now = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// éå†Session:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">for</span> (String sessionId : sessions.<span style="color:#007f7f">keySet</span>()) {
</span></span><span style="display:flex;"><span>                HttpSession session = sessions.<span style="color:#007f7f">get</span>(sessionId);
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// åˆ¤æ–­æ˜¯å¦è¿‡æœŸ:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                <span style="color:#fff;font-weight:bold">if</span> (session.<span style="color:#007f7f">getLastAccessedTime</span>() + session.<span style="color:#007f7f">getMaxInactiveInterval</span>() * <span style="color:#ff0;font-weight:bold">1000L</span> &lt; now) {
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// åˆ é™¤è¿‡æœŸçš„Session:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                    logger.<span style="color:#007f7f">warn</span>(<span style="color:#0ff;font-weight:bold">&#34;remove expired session: {}, last access time: {}&#34;</span>, sessionId, DateUtils.<span style="color:#007f7f">formatDateTimeGMT</span>(session.<span style="color:#007f7f">getLastAccessedTime</span>()));
</span></span><span style="display:flex;"><span>                    session.<span style="color:#007f7f">invalidate</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°†<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>ä¸Cookieç›¸å…³çš„å®ç°æ–¹æ³•è¡¥å…¨ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªåŸºäºCookieçš„<code>HttpSession</code>å®ç°ï¼</p>
<p>æœ€åéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå’Œ<code>HttpServletRequest</code>ä¸åŒï¼Œè®¿é—®<code>HttpServletRequest</code>å®ä¾‹çš„ä¸€å®šæ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå› æ­¤ï¼Œ<code>HttpServletRequest</code>çš„<code>getAttribute()</code>å’Œ<code>setAttribute()</code>ä¸éœ€è¦åŒæ­¥ï¼Œåº•å±‚å­˜å‚¨ç”¨<code>HashMap</code>å³å¯ã€‚ä½†æ˜¯ï¼Œè®¿é—®<code>HttpSession</code>å®ä¾‹çš„å¯èƒ½æ˜¯å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥ï¼Œ<code>HttpSession</code>çš„<code>getAttribute()</code>å’Œ<code>setAttribute()</code>éœ€è¦å®ç°å¹¶å‘è®¿é—®ï¼Œåº•å±‚å­˜å‚¨ç”¨<code>ConcurrentHashMap</code>å³å¯ã€‚</p>
<h3 id="æµ‹è¯•httpsession">æµ‹è¯•HttpSession<a hidden class="anchor" aria-hidden="true" href="#æµ‹è¯•httpsession">#</a></h3>
<p>è®¿é—®<code>IndexServlet</code>ï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œå°†è·å–åˆ°æ–°çš„<code>HttpSession</code>ï¼Œæ­¤æ—¶ï¼Œ<code>HttpSession</code>æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œå› æ­¤æ˜¾ç¤ºç™»å½•è¡¨å•ï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1557468186411073/l" alt="index-login"  />
</p>
<p>ç™»å½•æˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°ç”¨æˆ·åå·²æ”¾å…¥<code>HttpSession</code>ï¼Œ<code>IndexServlet</code>ä»<code>HttpSession</code>è·å–åˆ°ç”¨æˆ·ååå°†ç”¨æˆ·åæ˜¾ç¤ºå‡ºæ¥ï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1557467855061056/l" alt="index-page"  />
</p>
<p>åˆ·æ–°é¡µé¢ï¼Œ<code>IndexServlet</code>ä»å°†æ˜¾ç¤ºç™»å½•çš„ç”¨æˆ·åï¼Œå› ä¸ºæ ¹æ®Cookieæ‹¿åˆ°ç›¸åŒçš„SessionIDåï¼Œè·å–çš„<code>HttpSession</code>æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>ç”±äºæˆ‘ä»¬è®¾å®šçš„<code>HttpSession</code>è¿‡æœŸæ—¶é—´æ˜¯10åˆ†é’Ÿï¼Œç­‰å¾…è‡³å°‘10åˆ†é’Ÿï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>21:41:38.001 [HTTP-Dispatcher] INFO  c.i.j.engine.filter.LogFilter -- GET: /
</span></span><span style="display:flex;"><span>21:42:05.586 [HTTP-Dispatcher] INFO  c.i.j.engine.filter.LogFilter -- GET: /
</span></span><span style="display:flex;"><span>21:52:15.578 [Thread-0] WARN  c.i.j.engine.SessionManagerImpl -- remove expired session: 899eb456-5aa3-40d4-8c64-ddc97d39c0d2, last access time: Fri, 14 Jul 2023 13:42:05 GMT
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§çº¦åœ¨21:52:15æ—¶æ¸…ç†äº†è¿‡æœŸçš„Sessionï¼Œæœ€åä¸€æ¬¡è®¿é—®æ—¶é—´æ˜¯21:42:05ï¼ˆæ³¨æ„æ—¶é—´éœ€è¦ç»è¿‡æ—¶åŒºè°ƒæ•´ï¼‰ï¼Œå†æ¬¡åˆ·æ–°é¡µé¢å°†æ˜¾ç¤ºç™»å½•è¡¨å•ï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1557468186411073/l" alt="index-login"  />
</p>
<h2 id="å®ç°listener">å®ç°Listener<a hidden class="anchor" aria-hidden="true" href="#å®ç°listener">#</a></h2>
<p>åœ¨Java Web Appä¸­ï¼Œé™¤äº†Servletã€Filterå’ŒHttpSessionå¤–ï¼Œè¿˜æœ‰ä¸€ç§Listenerç»„ä»¶ï¼Œç”¨äºäº‹ä»¶ç›‘å¬ã€‚</p>
<h3 id="listeneråŸç†">ListeneråŸç†<a hidden class="anchor" aria-hidden="true" href="#listeneråŸç†">#</a></h3>
<p>Listeneræ˜¯Java Web Appä¸­çš„ä¸€ç§äº‹ä»¶ç›‘å¬æœºåˆ¶ï¼Œç”¨äºç›‘å¬Webåº”ç”¨ç¨‹åºä¸­äº§ç”Ÿçš„äº‹ä»¶ï¼Œä¾‹å¦‚ï¼Œåœ¨<code>ServletContext</code>åˆå§‹åŒ–å®Œæˆåï¼Œä¼šè§¦å‘<code>contextInitialized</code>äº‹ä»¶ï¼Œå®ç°äº†<code>ServletContextListener</code>æ¥å£çš„Listenerå°±å¯ä»¥æ¥æ”¶åˆ°äº‹ä»¶é€šçŸ¥ï¼Œå¯ä»¥åœ¨å†…éƒ¨åšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œå¦‚åŠ è½½é…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ç­‰ã€‚å®ç°äº†<code>HttpSessionListener</code>æ¥å£çš„Listenerå¯ä»¥æ¥æ”¶åˆ°Sessionçš„åˆ›å»ºå’Œæ¶ˆè€—äº‹ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°ã€‚</p>
<p>Listeneræœºåˆ¶æ˜¯åŸºäº<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1281319577321505">è§‚å¯Ÿè€…æ¨¡å¼</a>å®ç°çš„ï¼Œå³å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒListenerä¼šæ¥æ”¶åˆ°é€šçŸ¥å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p>
<h3 id="listenerç±»å‹">Listenerç±»å‹<a hidden class="anchor" aria-hidden="true" href="#listenerç±»å‹">#</a></h3>
<p>Servletè§„èŒƒå®šä¹‰äº†å¾ˆå¤šç§Listeneræ¥å£ï¼Œå¸¸ç”¨çš„ListeneråŒ…æ‹¬ï¼š</p>
<ul>
<li><code>ServletContextListener</code>ï¼šç”¨äºç›‘å¬<code>ServletContext</code>çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼›</li>
<li><code>HttpSessionListener</code>ï¼šç”¨äºç›‘å¬<code>HttpSession</code>çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼›</li>
<li><code>ServletRequestListener</code>ï¼šç”¨äºç›‘å¬<code>ServletRequest</code>çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼›</li>
<li><code>ServletContextAttributeListener</code>ï¼šç”¨äºç›‘å¬<code>ServletContext</code>å±æ€§çš„æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤äº‹ä»¶ï¼›</li>
<li><code>HttpSessionAttributeListener</code>ï¼šç”¨äºç›‘å¬<code>HttpSession</code>å±æ€§çš„æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤äº‹ä»¶ï¼›</li>
<li><code>ServletRequestAttributeListener</code>ï¼šç”¨äºç›‘å¬<code>ServletRequest</code>å±æ€§çš„æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤äº‹ä»¶ã€‚</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬å°±æ¥å®ç°ä¸Šè¿°å¸¸ç”¨çš„Listenerã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨<code>ServletContextImpl</code>ä¸­æ³¨å†Œå¹¶ç®¡ç†æ‰€æœ‰çš„Listenerï¼Œæ‰€ä»¥ç”¨ä¸åŒçš„<code>List</code>æŒæœ‰æ³¨å†Œçš„Listenerï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletContextImpl <span style="color:#fff;font-weight:bold">implements</span> ServletContext {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> List&lt;ServletContextListener&gt; servletContextListeners = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> List&lt;ServletContextAttributeListener&gt; servletContextAttributeListeners = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> List&lt;ServletRequestListener&gt; servletRequestListeners = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> List&lt;ServletRequestAttributeListener&gt; servletRequestAttributeListeners = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> List&lt;HttpSessionAttributeListener&gt; httpSessionAttributeListeners = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> List&lt;HttpSessionListener&gt; httpSessionListeners = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œå®ç°<code>ServletContext</code>çš„<code>addListener()</code>æ¥å£ï¼Œç”¨äºæ³¨å†ŒListenerï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletContextImpl <span style="color:#fff;font-weight:bold">implements</span> ServletContext {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addListener(String className) {
</span></span><span style="display:flex;"><span>        addListener(Class.<span style="color:#007f7f">forName</span>(className));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addListener(Class&lt;? <span style="color:#fff;font-weight:bold">extends</span> EventListener&gt; clazz) {
</span></span><span style="display:flex;"><span>        addListener(clazz.<span style="color:#007f7f">newInstance</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T <span style="color:#fff;font-weight:bold">extends</span> EventListener&gt; <span style="color:#fff;font-weight:bold">void</span> addListener(T t) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ ¹æ®Listenerç±»å‹æ”¾å…¥ä¸åŒçš„List:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">if</span> (t <span style="color:#fff;font-weight:bold">instanceof</span> ServletContextListener listener) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextListeners</span> == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextListeners</span> = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextListeners</span>.<span style="color:#007f7f">add</span>(listener);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (t <span style="color:#fff;font-weight:bold">instanceof</span> ServletContextAttributeListener listener) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextAttributeListeners</span> == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextAttributeListeners</span> = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextAttributeListeners</span>.<span style="color:#007f7f">add</span>(listener);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> ...
</span></span><span style="display:flex;"><span>            ...<span style="color:#f00">ä»£ç ç•¥</span>...
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalArgumentException(<span style="color:#0ff;font-weight:bold">&#34;Unsupported listener: &#34;</span> + t.<span style="color:#007f7f">getClass</span>().<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œå°±æ˜¯åœ¨åˆé€‚çš„æ—¶æœºï¼Œè§¦å‘è¿™äº›Listenerã€‚ä»¥<code>ServletContextAttributeListener</code>ä¸ºä¾‹ï¼Œç»Ÿä¸€è§¦å‘çš„æ–¹æ³•æ”¾åœ¨<code>ServletContextImpl</code>ä¸­ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletContextImpl <span style="color:#fff;font-weight:bold">implements</span> ServletContext {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> invokeServletContextAttributeAdded(String name, Object value) {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;invoke ServletContextAttributeAdded: {} = {}&#34;</span>, name, value);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextAttributeListeners</span> != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            var event = <span style="color:#fff;font-weight:bold">new</span> ServletContextAttributeEvent(<span style="color:#fff;font-weight:bold">this</span>, name, value);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (var listener : <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextAttributeListeners</span>) {
</span></span><span style="display:flex;"><span>                listener.<span style="color:#007f7f">attributeAdded</span>(event);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> invokeServletContextAttributeRemoved(String name, Object value) {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;invoke ServletContextAttributeRemoved: {} = {}&#34;</span>, name, value);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextAttributeListeners</span> != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            var event = <span style="color:#fff;font-weight:bold">new</span> ServletContextAttributeEvent(<span style="color:#fff;font-weight:bold">this</span>, name, value);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (var listener : <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextAttributeListeners</span>) {
</span></span><span style="display:flex;"><span>                listener.<span style="color:#007f7f">attributeRemoved</span>(event);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> invokeServletContextAttributeReplaced(String name, Object value) {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;invoke ServletContextAttributeReplaced: {} = {}&#34;</span>, name, value);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextAttributeListeners</span> != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            var event = <span style="color:#fff;font-weight:bold">new</span> ServletContextAttributeEvent(<span style="color:#fff;font-weight:bold">this</span>, name, value);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (var listener : <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContextAttributeListeners</span>) {
</span></span><span style="display:flex;"><span>                listener.<span style="color:#007f7f">attributeReplaced</span>(event);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“Web Appçš„ä»»ä½•ç»„ä»¶è°ƒç”¨<code>ServletContext</code>çš„<code>setAttribute()</code>æˆ–<code>removeAttribute()</code>æ—¶ï¼Œå°±å¯ä»¥è§¦å‘äº‹ä»¶é€šçŸ¥ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ServletContextImpl <span style="color:#fff;font-weight:bold">implements</span> ServletContext {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setAttribute(String name, Object value) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (value == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            removeAttribute(name);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            Object old = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">attributes</span>.<span style="color:#007f7f">setAttribute</span>(name, value);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (old == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// è§¦å‘attributeAdded:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">invokeServletContextAttributeAdded</span>(name, value);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// è§¦å‘attributeReplaced:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">invokeServletContextAttributeReplaced</span>(name, value);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> removeAttribute(String name) {
</span></span><span style="display:flex;"><span>        Object old = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">attributes</span>.<span style="color:#007f7f">removeAttribute</span>(name);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è§¦å‘attributeRemoved:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">invokeServletContextAttributeRemoved</span>(name, old);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä»–äº‹ä»¶è§¦å‘ä¹Ÿæ˜¯ç±»ä¼¼çš„å†™æ³•ï¼Œæ­¤å¤„ä¸å†é‡å¤ã€‚</p>
<h3 id="æµ‹è¯•listener">æµ‹è¯•Listener<a hidden class="anchor" aria-hidden="true" href="#æµ‹è¯•listener">#</a></h3>
<p>ä¸ºäº†æµ‹è¯•Listeneræœºåˆ¶æ˜¯å¦ç”Ÿæ•ˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦å…ˆç¼–å†™ä¸åŒç±»å‹çš„Listenerï¼Œä¾‹å¦‚ï¼Œ<code>HelloHttpSessionAttributeListener</code>å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebListener
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HelloHelloHttpSessionAttributeListener <span style="color:#fff;font-weight:bold">implements</span> HttpSessionAttributeListener {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Logger logger = LoggerFactory.<span style="color:#007f7f">getLogger</span>(getClass());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> attributeAdded(HttpSessionBindingEvent event) {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;&gt;&gt;&gt; HttpSession attribute added: {} = {}&#34;</span>, event.<span style="color:#007f7f">getName</span>(), event.<span style="color:#007f7f">getValue</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> attributeRemoved(HttpSessionBindingEvent event) {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;&gt;&gt;&gt; HttpSession attribute removed: {} = {}&#34;</span>, event.<span style="color:#007f7f">getName</span>(), event.<span style="color:#007f7f">getValue</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> attributeReplaced(HttpSessionBindingEvent event) {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;&gt;&gt;&gt; HttpSession attribute replaced: {} = {}&#34;</span>, event.<span style="color:#007f7f">getName</span>(), event.<span style="color:#007f7f">getValue</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶ååœ¨<code>HttpConnector</code>ä¸­æ³¨å†Œæ‰€æœ‰çš„Listenerï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Class&lt;? <span style="color:#fff;font-weight:bold">extends</span> EventListener&gt;&gt; listenerClasses = List.<span style="color:#007f7f">of</span>(HelloHttpSessionAttributeListener.<span style="color:#007f7f">class</span>, ...);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span> (Class&lt;? <span style="color:#fff;font-weight:bold">extends</span> EventListener&gt; listenerClass : listenerClasses) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>.<span style="color:#007f7f">addListener</span>(listenerClass);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯åŠ¨æœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨ä¸­ç™»å½•æˆ–ç™»å‡ºï¼Œè§‚å¯Ÿæ—¥å¿—è¾“å‡ºï¼Œåœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†å‰åï¼Œå¯ä»¥çœ‹åˆ°<code>ServletRequestListener</code>çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">08</span>:<span style="color:#ff0;font-weight:bold">58</span>:<span style="color:#ff0;font-weight:bold">23.944</span> [HTTP-Dispatcher] INFO  c.<span style="color:#007f7f">i</span>.<span style="color:#007f7f">j</span>.<span style="color:#007f7f">e</span>.<span style="color:#007f7f">l</span>.<span style="color:#007f7f">HelloServletRequestListener</span> -- &gt;&gt;&gt; ServletRequest initialized: HttpServletRequestImpl<span style="color:#f00">@</span><span style="color:#ff0;font-weight:bold">71</span>a49a97[GET:/]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">08</span>:<span style="color:#ff0;font-weight:bold">58</span>:<span style="color:#ff0;font-weight:bold">24.008</span> [HTTP-Dispatcher] INFO  c.<span style="color:#007f7f">i</span>.<span style="color:#007f7f">j</span>.<span style="color:#007f7f">e</span>.<span style="color:#007f7f">l</span>.<span style="color:#007f7f">HelloServletRequestListener</span> -- &gt;&gt;&gt; ServletRequest destroyed: HttpServletRequestImpl<span style="color:#f00">@</span><span style="color:#ff0;font-weight:bold">71</span>a49a97[GET:/]
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ç¬¬ä¸€æ¬¡è®¿é—®é¡µé¢å’Œç™»å‡ºæ—¶ï¼Œå¯ä»¥çœ‹åˆ°<code>HttpSessionListener</code>çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">08</span>:<span style="color:#ff0;font-weight:bold">58</span>:<span style="color:#ff0;font-weight:bold">23.947</span> [HTTP-Dispatcher] INFO  c.<span style="color:#007f7f">i</span>.<span style="color:#007f7f">j</span>.<span style="color:#007f7f">e</span>.<span style="color:#007f7f">l</span>.<span style="color:#007f7f">HelloHttpSessionListener</span> -- &gt;&gt;&gt; HttpSession created: com.<span style="color:#007f7f">itranswarp</span>.<span style="color:#007f7f">jerrymouse</span>.<span style="color:#007f7f">engine</span>.<span style="color:#007f7f">HttpSessionImpl</span><span style="color:#f00">@</span><span style="color:#ff0;font-weight:bold">15037</span>a31
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">08</span>:<span style="color:#ff0;font-weight:bold">58</span>:<span style="color:#ff0;font-weight:bold">36.766</span> [HTTP-Dispatcher] INFO  c.<span style="color:#007f7f">i</span>.<span style="color:#007f7f">j</span>.<span style="color:#007f7f">e</span>.<span style="color:#007f7f">l</span>.<span style="color:#007f7f">HelloHttpSessionListener</span> -- &gt;&gt;&gt; HttpSession destroyed: com.<span style="color:#007f7f">itranswarp</span>.<span style="color:#007f7f">jerrymouse</span>.<span style="color:#007f7f">engine</span>.<span style="color:#007f7f">HttpSessionImpl</span><span style="color:#f00">@</span><span style="color:#ff0;font-weight:bold">15037</span>a31
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä»–äº‹ä»¶çš„è§¦å‘ä¹Ÿå¯ä»¥åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°ï¼Œè¿™è¯´æ˜æˆ‘ä»¬æˆåŠŸåœ°å®ç°äº†Servletè§„èŒƒçš„Listeneræœºåˆ¶ã€‚</p>
<h1 id="åŠ è½½web-app">åŠ è½½Web App<a hidden class="anchor" aria-hidden="true" href="#åŠ è½½web-app">#</a></h1>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†<code>ServletContext</code>å®¹å™¨ï¼Œæ”¯æŒ<code>Servlet</code>ã€<code>Filter</code>å’Œ<code>Listener</code>ç»„ä»¶ï¼Œæ”¯æŒ<code>HttpSession</code>ï¼Œä½†æ˜¯ï¼ŒåŠ è½½<code>Servlet</code>ã€<code>Filter</code>å’Œ<code>Listener</code>ç»„ä»¶æ—¶ï¼Œæ˜¯å†™æ­»åœ¨æœåŠ¡å™¨é‡Œé¢çš„<code>IndexServlet</code>ã€<code>LogFilter</code>å’Œ<code>HelloHttpSessionListener</code>è¿™æ ·çš„ç±»ã€‚</p>
<p>è€Œä¸€ä¸ªæ­£å¸¸çš„WebæœåŠ¡å™¨æ˜¯ä»å¤–éƒ¨åŠ è½½è¿™äº›ç»„ä»¶çš„ï¼Œæ ¹æ®Servletè§„èŒƒï¼ŒWeb Appå¼€å‘è€…å®Œæˆäº†<code>Servlet</code>ã€<code>Filter</code>å’Œ<code>Listener</code>ç­‰ç»„ä»¶åï¼Œéœ€è¦æŒ‰è§„èŒƒæŠŠå®ƒä»¬æ‰“åŒ…æˆ<code>.war</code>æ–‡ä»¶ã€‚<code>.war</code>æ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªjaråŒ…ï¼Œä½†å®ƒçš„ç›®å½•ç»„ç»‡å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>hello-webapp
</span></span><span style="display:flex;"><span>â”œâ”€â”€ WEB-INF
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ classes
</span></span><span style="display:flex;"><span>â”‚   â”‚   â””â”€â”€ com
</span></span><span style="display:flex;"><span>â”‚   â”‚       â””â”€â”€ example
</span></span><span style="display:flex;"><span>â”‚   â”‚           â”œâ”€â”€ filter
</span></span><span style="display:flex;"><span>â”‚   â”‚           â”‚   â””â”€â”€ LogFilter.class
</span></span><span style="display:flex;"><span>â”‚   â”‚           â”œâ”€â”€ listener
</span></span><span style="display:flex;"><span>â”‚   â”‚           â”‚   â”œâ”€â”€ HelloHttpSessionListener.class
</span></span><span style="display:flex;"><span>â”‚   â”‚           â”‚   â””â”€â”€ HelloServletContextAttributeListener.class
</span></span><span style="display:flex;"><span>â”‚   â”‚           â”œâ”€â”€ servlet
</span></span><span style="display:flex;"><span>â”‚   â”‚           â”‚   â”œâ”€â”€ HelloServlet.class
</span></span><span style="display:flex;"><span>â”‚   â”‚           â”‚   â””â”€â”€ IndexServlet.class
</span></span><span style="display:flex;"><span>â”‚   â”‚           â””â”€â”€ util
</span></span><span style="display:flex;"><span>â”‚   â”‚               â””â”€â”€ DateUtil.class
</span></span><span style="display:flex;"><span>â”‚   â””â”€â”€ lib
</span></span><span style="display:flex;"><span>â”‚       â”œâ”€â”€ logback-classic-1.4.6.jar
</span></span><span style="display:flex;"><span>â”‚       â”œâ”€â”€ logback-core-1.4.6.jar
</span></span><span style="display:flex;"><span>â”‚       â””â”€â”€ slf4j-api-2.0.4.jar
</span></span><span style="display:flex;"><span>â”œâ”€â”€ contact.html
</span></span><span style="display:flex;"><span>â””â”€â”€ favicon.ico
</span></span></code></pre></td></tr></table>
</div>
</div><p>Servletè§„èŒƒè§„å®šï¼Œä¸€ä¸ª<code>.war</code>åŒ…è§£å‹åï¼Œç›®å½•<code>/WEB-INF/classes</code>å­˜æ”¾æ‰€æœ‰ç¼–è¯‘åçš„<code>.class</code>æ–‡ä»¶ï¼Œç›®å½•<code>/WEB-INF/lib</code>å­˜æ”¾æ‰€æœ‰ä¾èµ–çš„ç¬¬ä¸‰æ–¹jaråŒ…ï¼Œå…¶ä»–æ–‡ä»¶å¯æŒ‰ä»»æ„ç›®å½•å­˜æ”¾ã€‚</p>
<p>WebæœåŠ¡å™¨é€šå¸¸ä¼šæä¾›ä¸€ä¸ªç”¨äºè®¿é—®æ–‡ä»¶çš„Servletï¼Œå¯¹äºä»¥<code>/WEB-INF/</code>å¼€å¤´çš„è·¯å¾„ï¼ŒWebæœåŠ¡å™¨ä¼šæ‹’ç»è®¿é—®ï¼Œå…¶ä»–è·¯å¾„åˆ™æŒ‰æ­£å¸¸æ–‡ä»¶è®¿é—®ï¼Œå› æ­¤ï¼Œè·¯å¾„<code>/contact.html</code>å¯ä»¥è¢«è®¿é—®åˆ°ï¼Œè€Œè·¯å¾„<code>/WEB-INF/contact.html</code>åˆ™ä¸èƒ½è¢«è®¿é—®åˆ°ã€‚æ³¨æ„è¿™ä¸ªé™åˆ¶æ˜¯é’ˆå¯¹æµè§ˆå™¨å‘å‡ºçš„è¯·æ±‚çš„è·¯å¾„é™åˆ¶ï¼Œå¦‚æœåœ¨Servletå†…éƒ¨è¯»å†™<code>/WEB-INF/</code>ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ™æ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚åˆ©ç”¨è¿™ä¸ªé™åˆ¶ï¼Œå¾ˆå¤šMVCæ¡†æ¶çš„æ¨¡ç‰ˆé¡µé€šå¸¸ä¼šå­˜æ”¾åœ¨<code>/WEB-INF/templates</code>ç›®å½•ä¸‹ã€‚</p>
<p>ä»¥ä¸Šæ˜¯å…³äº<code>.war</code>åŒ…çš„ç›®å½•è§„èŒƒã€‚æˆ‘ä»¬è¦æŠŠå†™æ­»çš„<code>Servlet</code>ã€<code>Filter</code>å’Œ<code>Listener</code>ç»„ä»¶ä»æœåŠ¡å™¨é¡¹ç›®ä¸­æ‘˜å‡ºæ¥ï¼Œå•ç‹¬å®ç°ä¸€ä¸ª<code>.war</code>åŒ…ï¼Œç„¶åï¼Œæˆ‘ä»¬éœ€è¦å®ç°æœåŠ¡å™¨å¯åŠ¨ååŠ¨æ€åŠ è½½<code>war</code>åŒ…ï¼Œå°±å®ç°äº†ä¸€ä¸ªæ¯”è¾ƒå®Œå–„çš„WebæœåŠ¡å™¨ã€‚</p>
<h2 id="å®ç°classloader">å®ç°ClassLoader<a hidden class="anchor" aria-hidden="true" href="#å®ç°classloader">#</a></h2>
<p>è¦é€šè¿‡WebæœåŠ¡å™¨åŠ è½½<code>war</code>åŒ…ï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£JVMçš„ClassLoaderï¼ˆç±»åŠ è½½å™¨ï¼‰çš„æœºåˆ¶ã€‚</p>
<p>åœ¨Javaä¸­ï¼Œæ‰€æœ‰çš„ç±»ï¼Œéƒ½æ˜¯ç”±ClassLoaderåŠ è½½åˆ°JVMä¸­æ‰§è¡Œçš„ï¼Œä½†JVMä¸­ä¸æ­¢ä¸€ç§ClassLoaderã€‚å†™ä¸ªç®€å•çš„ç¨‹åºå°±å¯ä»¥æµ‹è¯•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Main {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(String.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">getClassLoader</span>()); <span style="color:#007f7f">// null
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(DataSource.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">getClassLoader</span>()); <span style="color:#007f7f">// PlatformClassLoader
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Main.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">getClassLoader</span>()); <span style="color:#007f7f">// AppClassLoader
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºJavaæ ¸å¿ƒç±»ï¼Œå¦‚<code>java.lang.String</code>ï¼Œè¿”å›<code>null</code>è¡¨ç¤ºä½¿ç”¨çš„æ˜¯JVMå†…éƒ¨çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆ<code>BootClassLoader</code>ï¼‰ï¼Œå¯¹äºéæ ¸å¿ƒçš„JDKç±»ï¼Œå¦‚<code>javax.sql.DataSource</code>ï¼Œä½¿ç”¨çš„æ˜¯<code>PlatformClassLoader</code>ï¼Œå¯¹äºç”¨æˆ·ç¼–å†™çš„ç±»ï¼Œå¦‚<code>Main</code>ï¼Œä½¿ç”¨çš„æ˜¯<code>AppClassLoader</code>ã€‚</p>
<p>æˆ‘ä»¬é€šå¸¸è¯´çš„ClassPathæœºåˆ¶ï¼Œå³JVMåº”è¯¥åœ¨å“ªäº›ç›®å½•å’Œå“ªäº›jaråŒ…é‡Œå»æ‰¾Classï¼Œå®é™…ä¸Šè¯´çš„æ˜¯<code>AppClassLoader</code>ä½¿ç”¨çš„ClassPathï¼Œè¿™3ä¸ªClassLoaderæŒ‰ä¼˜å…ˆçº§æ’åºå¦‚ä¸‹ï¼š</p>
<ol>
<li>BootClassLoader</li>
<li>PlatformClassLoader</li>
<li>AppClassLoader</li>
</ol>
<p>ç”¨AppClassLoaderåŠ è½½ä¸€ä¸ªClassæ—¶ï¼Œå®ƒé¦–å…ˆä¼šå§”æ‰˜çˆ¶çº§ClassLoaderå°è¯•åŠ è½½ï¼Œå¦‚æœåŠ è½½å¤±è´¥ï¼Œæ‰å°è¯•è‡ªå·±åŠ è½½ï¼Œè¿™å°±æ˜¯JVMçš„ClassLoaderä½¿ç”¨çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå®ƒæ˜¯ä¸ºäº†é˜²æ­¢ç”¨AppClassLoaderåŠ è½½ç”¨æˆ·è‡ªå·±ç¼–å†™çš„<code>java.lang.String</code>å¯¼è‡´ç ´åJDKçš„æ ¸å¿ƒç±»ã€‚</p>
<p>å› æ­¤ï¼Œå¯¹äºä¸€ä¸ªClassæ¥è¯´ï¼Œå®ƒå§‹ç»ˆå…³è”ç€ä¸€ä¸ªåŠ è½½å®ƒè‡ªå·±çš„ClassLoaderï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚java.lang.String               â”‚
</span></span><span style="display:flex;"><span>â”‚  BootClassLoader  â”‚â—€â”€ â”€ â”€â”‚java.util.List                 â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚...                            â”‚
</span></span><span style="display:flex;"><span>          â–²                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>          â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚javax.sql.DataSource           â”‚
</span></span><span style="display:flex;"><span>â”‚PlatformClassLoaderâ”‚â—€â”€ â”€ â”€â”‚javax.transaction.xa.XAResourceâ”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚...                            â”‚
</span></span><span style="display:flex;"><span>          â–²                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>          â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚com.example.Main               â”‚
</span></span><span style="display:flex;"><span>â”‚  AppClassLoader   â”‚â—€â”€ â”€ â”€â”‚org.slf4j.Logger               â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚...                            â”‚
</span></span><span style="display:flex;"><span>                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬å®Œæˆäº†JerrymouseæœåŠ¡å™¨çš„å¼€å‘ï¼Œé‚£ä¹ˆæœ€åå¾—åˆ°çš„å°±æ˜¯<code>jerrymouse.jar</code>è¿™æ ·çš„jaråŒ…ï¼Œå¦‚æœè¦è¿è¡Œä¸€ä¸ª<code>hello-webapp.war</code>ï¼Œæˆ‘ä»¬æœŸå¾…çš„å‘½ä»¤è¡Œå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ java -jar jerrymouse.jar --war hello-webapp.war
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°å‘½ä»¤è¡Œçš„classpathå®é™…ä¸Šæ˜¯<code>jerrymouse.jar</code>ï¼ŒæœåŠ¡å™¨çš„ç±»å‡å¯ä»¥è¢«JVMçš„<code>AppClassLoader</code>åŠ è½½ï¼Œä½†æ˜¯ï¼Œ<code>AppClassLoader</code>æ— æ³•åŠ è½½<code>hello-webapp.war</code>åœ¨<code>/WEB-INF/classes</code>å­˜æ”¾çš„<code>.class</code>æ–‡ä»¶ï¼Œä¹Ÿæ— æ³•åŠ è½½åœ¨<code>/WEB-INF/lib</code>å­˜æ”¾çš„jaræ–‡ä»¶ï¼ŒåŸå› æ˜¯å®ƒä»¬å‡ä¸åœ¨classpathä¸­ï¼Œä¸”è¿è¡ŒæœŸæ— æ³•ä¿®æ”¹classpathã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªå·±ç¼–å†™ClassLoaderï¼Œæ‰èƒ½åŠ è½½åˆ°<code>hello-webapp.war</code>é‡Œçš„<code>.class</code>æ–‡ä»¶å’Œ<code>jar</code>åŒ…ã€‚</p>
<h3 id="ç¼–å†™classloader">ç¼–å†™ClassLoader<a hidden class="anchor" aria-hidden="true" href="#ç¼–å†™classloader">#</a></h3>
<p>ä¸ºäº†åŠ è½½<code>war</code>åŒ…é‡Œçš„<code>.class</code>æ–‡ä»¶å’Œ<code>jar</code>åŒ…ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>WebAppClassLoader</code>ã€‚ç›´æ¥ä»<code>ClassLoader</code>ç»§æ‰¿ä¸æ˜¯ä¸å¯ä»¥ï¼Œä½†æ˜¯è¦è‡ªå·±ç¼–å†™çš„ä»£ç å¤ªå¤šã€‚ClassLoaderçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œå®é™…ä¸Šå°±æ˜¯æƒ³åŠæ³•ä»¥ä»»ä½•æ–¹å¼æ‹¿åˆ°<code>.class</code>æ–‡ä»¶çš„ç”¨<code>byte[]</code>è¡¨ç¤ºçš„å†…å®¹ï¼Œç„¶åç”¨<code>ClassLoader</code>çš„<code>defineClass()</code>è·å¾—JVMåŠ è½½åçš„<code>Class</code>å®ä¾‹ã€‚å¤§å¤šæ•°ClassLoaderéƒ½æ˜¯åŸºäºæ–‡ä»¶çš„åŠ è½½ï¼Œå› æ­¤ï¼ŒJDKæä¾›äº†ä¸€ä¸ª<code>URLClassLoader</code>æ–¹ä¾¿ç¼–å†™ä»æ–‡ä»¶åŠ è½½çš„ClassLoaderï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WebAppClassLoader <span style="color:#fff;font-weight:bold">extends</span> URLClassLoader {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> WebAppClassLoader(Path classPath, Path libPath) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(<span style="color:#0ff;font-weight:bold">&#34;WebAppClassLoader&#34;</span>, createUrls(classPath, libPath), ClassLoader.<span style="color:#007f7f">getSystemClassLoader</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è¿”å›ä¸€ç»„URLç”¨äºæœç´¢class:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">static</span> URL[] createUrls(Path classPath, Path libPath) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        List&lt;URL&gt; urls = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>        urls.<span style="color:#007f7f">add</span>(toDirURL(classPath));
</span></span><span style="display:flex;"><span>        Files.<span style="color:#007f7f">list</span>(libPath).<span style="color:#007f7f">filter</span>(p -&gt; p.<span style="color:#007f7f">toString</span>().<span style="color:#007f7f">endsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;.jar&#34;</span>)).<span style="color:#007f7f">sorted</span>().<span style="color:#007f7f">forEach</span>(p -&gt; {
</span></span><span style="display:flex;"><span>            urls.<span style="color:#007f7f">add</span>(toJarURL(p));
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> urls.<span style="color:#007f7f">toArray</span>(URL[]::<span style="color:#fff;font-weight:bold">new</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> URL toDirURL(Path p) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†ç›®å½•è½¬æ¢ä¸ºURL:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> URL toJarURL(Path p) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†jaråŒ…è½¬æ¢ä¸ºURL:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åªè¦ä¼ å…¥æ­£ç¡®çš„ç›®å½•å’Œä¸€ç»„jaråŒ…ï¼Œ<code>WebAppClassLoader</code>å°±å¯ä»¥åŠ è½½åˆ°å¯¹åº”çš„<code>.class</code>æ–‡ä»¶ã€‚</p>
<p>ä¸‹ä¸€æ­¥æ˜¯ä¿®æ”¹å¯åŠ¨æµç¨‹ï¼Œå…ˆè§£æå‘½ä»¤è¡Œå‚æ•°<code>--war</code>æ‹¿åˆ°<code>war</code>åŒ…çš„è·¯å¾„ï¼Œç„¶åè§£å‹åˆ°ä¸´æ—¶ç›®å½•ï¼Œè·å–åˆ°<code>/tmp/xxx/WEB-INF/classes</code>è·¯å¾„ä»¥åŠ<code>/tmp/xxx/WEB-INF/lib</code>è·¯å¾„ï¼Œå°±å¯ä»¥æ„é€ <code>WebAppClassLoader</code>äº†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Path classesPath = ...
</span></span><span style="display:flex;"><span>Path libPath = ...
</span></span><span style="display:flex;"><span>ClassLoader classLoader = <span style="color:#fff;font-weight:bold">new</span> WebAppClassLoader(classesPath, libPath);
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œéœ€è¦è·å–åˆ°æ‰€æœ‰çš„<code>Servlet</code>ã€<code>Filter</code>å’Œ<code>Listener</code>ç»„ä»¶ï¼Œå› æ­¤éœ€è¦åœ¨<code>WebAppClassLoader</code>çš„èŒƒå›´å†…æ‰«ææ‰€æœ‰<code>.class</code>æ–‡ä»¶ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Set&lt;Class&lt;?&gt;&gt; classSet = ... <span style="color:#007f7f">// æ‰«æè·å¾—æ‰€æœ‰Class
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹<code>HttpConnector</code>ï¼Œä¼ å…¥<code>ClassLoader</code>å’Œæ‰«æçš„Classï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰<code>Servlet</code>ã€<code>Filter</code>å’Œ<code>Listener</code>æ·»åŠ åˆ°<code>ServletContext</code>ä¸­ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠå†™æ­»çš„Servletç»„ä»¶ä»æœåŠ¡å™¨ä¸­ç§»é™¤æ‰ï¼Œå¹¶å®ç°äº†ä»å¤–éƒ¨waråŒ…åŠ¨æ€åŠ è½½Servletç»„ä»¶ã€‚</p>
<h3 id="è®¾ç½®contextclassloader">è®¾ç½®ContextClassLoader<a hidden class="anchor" aria-hidden="true" href="#è®¾ç½®contextclassloader">#</a></h3>
<p>åœ¨<code>HttpConnector</code>ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹<code>handler()</code>æ–¹æ³•è¿›è¡Œæ”¹è¿›ï¼Œæ­£ç¡®è®¾ç½®çº¿ç¨‹çš„ContextClassLoaderï¼ˆä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼‰ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(HttpExchange exchange) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    var adapter = <span style="color:#fff;font-weight:bold">new</span> HttpExchangeAdapter(exchange);
</span></span><span style="display:flex;"><span>    var response = <span style="color:#fff;font-weight:bold">new</span> HttpServletResponseImpl(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">config</span>, adapter);
</span></span><span style="display:flex;"><span>    var request = <span style="color:#fff;font-weight:bold">new</span> HttpServletRequestImpl(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">config</span>, <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>, adapter, response);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è®¾ç½®ä¸ºWebAppClassLoader:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">setContextClassLoader</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">classLoader</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>.<span style="color:#007f7f">process</span>(request, response);
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">error</span>(e.<span style="color:#007f7f">getMessage</span>(), e);
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ¢å¤é»˜è®¤çš„çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">setContextClassLoader</span>(<span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">cleanup</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®çº¿ç¨‹çš„ContextClassLoaderï¼Ÿæ‰§è¡Œ<code>handle()</code>æ–¹æ³•çš„çº¿ç¨‹æ˜¯ç”±çº¿ç¨‹æ± æä¾›çš„ï¼Œçº¿ç¨‹æ± æ˜¯<code>HttpConnector</code>åˆ›å»ºçš„ï¼Œå› æ­¤ï¼Œ<code>handle()</code>æ–¹æ³•å†…éƒ¨åŠ è½½çš„ä»»ä½•ç±»éƒ½æ˜¯ç”±<code>AppClassLoader</code>åŠ è½½çš„ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›åŠ è½½çš„ç±»æ˜¯ç”±<code>WebAppClassLoader</code>ä»è§£å‹çš„<code>war</code>åŒ…ä¸­åŠ è½½ï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦è®¾ç½®çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚</p>
<p>ä¸¾ä¾‹è¯´æ˜ï¼š</p>
<p>å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­è°ƒç”¨<code>Class.forName()</code>æ—¶ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Object createInstance(String className) {
</span></span><span style="display:flex;"><span>    Class&lt;?&gt; clazz = Class.<span style="color:#007f7f">forName</span>(className);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> clazz.<span style="color:#007f7f">newInstance</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå°†ç”±<code>AppClassLoader</code>è´Ÿè´£æŸ¥æ‰¾<code>Class</code>ï¼Œæ˜¾ç„¶æ˜¯æ‰¾ä¸åˆ°waråŒ…è§£å‹åå­˜æ”¾åœ¨<code>classes</code>å’Œ<code>lib</code>ç›®å½•é‡Œçš„ç±»ï¼Œåªæœ‰æˆ‘ä»¬è‡ªå·±å†™çš„<code>WebAppClassLoader</code>æ‰èƒ½æ‰¾åˆ°ï¼Œå› æ­¤ï¼Œå¿…é¡»è®¾ç½®æ­£ç¡®çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Object createInstance(String className) {
</span></span><span style="display:flex;"><span>    Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">setContextClassLoader</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">classLoader</span>);
</span></span><span style="display:flex;"><span>    Class&lt;?&gt; clazz = Class.<span style="color:#007f7f">forName</span>(className);
</span></span><span style="display:flex;"><span>    Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">setContextClassLoader</span>(<span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> clazz.<span style="color:#007f7f">newInstance</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œå®Œå–„æ‰€æœ‰æ¥å£çš„å®ç°ç±»ï¼Œæˆ‘ä»¬å°±æˆåŠŸå¼€å‘äº†ä¸€ä¸ªè¿·ä½ ç‰ˆçš„TomcatæœåŠ¡å™¨ï¼</p>
<h2 id="éƒ¨ç½²web-app">éƒ¨ç½²Web App<a hidden class="anchor" aria-hidden="true" href="#éƒ¨ç½²web-app">#</a></h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†<code>WebAppClassLoader</code>ï¼Œå°±å¯ä»¥å¯åŠ¨Web Serverã€åŠ è½½waråŒ…ã€‚</p>
<p>å…ˆç¼–å†™ä¸€ä¸ªç®€å•çš„<code>hello-webapp</code>ï¼Œå®ç°Servletã€Filterå’ŒListenerå¦‚ä¸‹ï¼š</p>
<ul>
<li>HelloServletï¼šè¾“å‡ºä¸€ä¸ªç®€å•çš„<code>Hello, {name}</code>ï¼›</li>
<li>LoginServletï¼šä½¿ç”¨Sessionå®ç°ç™»å½•åŠŸèƒ½ï¼›</li>
<li>LogoutServletï¼šä½¿ç”¨Sessionå®ç°ç™»å‡ºåŠŸèƒ½ï¼›</li>
<li>LogFilterï¼šæ‰“å°æ—¥å¿—çš„Filterï¼›</li>
<li>è‹¥å¹²Listenerï¼šç”¨äºç›‘å¬å„ç§äº‹ä»¶ã€‚</li>
</ul>
<p>ç”¨Mavenæ‰“åŒ…ä¸ºæ ‡å‡†çš„waråŒ…ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª<code>hello-webapp-1.0.war</code>æ–‡ä»¶ã€‚</p>
<p>å¯åŠ¨Web Serverå¹¶åŠ è½½waræ–‡ä»¶ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ java -jar /path/to/jerrymouse-1.0.0.jar -w /path/to/hello-webapp-1.0.war
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¡®ä¿è·¯å¾„æ­£ç¡®ï¼Œå°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>10:20:07.586 [main] INFO  com.itranswarp.jerrymouse.Start -- extract &#39;/Users/liaoxuefeng/Git/Github/jerrymouse/step-by-step/hello-webapp/target/hello-webapp-1.0.war&#39; to &#39;/var/folders/np/n5bzqjhs2l521tn0bkcqvzcc0000gn/T/_jm_10421889768839940273&#39;
</span></span><span style="display:flex;"><span>10:20:07.619 [main] INFO  com.itranswarp.jerrymouse.Start -- set web root: /var/folders/np/n5bzqjhs2l521tn0bkcqvzcc0000gn/T/_jm_10421889768839940273
</span></span><span style="display:flex;"><span>10:20:07.943 [main] INFO  c.i.j.classloader.WebAppClassLoader -- set classes path: /var/folders/np/n5bzqjhs2l521tn0bkcqvzcc0000gn/T/_jm_10421889768839940273/WEB-INF/classes
</span></span><span style="display:flex;"><span>10:20:07.944 [main] INFO  c.i.j.classloader.WebAppClassLoader -- set jar path: /var/folders/np/n5bzqjhs2l521tn0bkcqvzcc0000gn/T/_jm_10421889768839940273/WEB-INF/lib/logback-classic-1.4.6.jar
</span></span><span style="display:flex;"><span>10:20:07.944 [main] INFO  c.i.j.classloader.WebAppClassLoader -- set jar path: /var/folders/np/n5bzqjhs2l521tn0bkcqvzcc0000gn/T/_jm_10421889768839940273/WEB-INF/lib/logback-core-1.4.6.jar
</span></span><span style="display:flex;"><span>10:20:07.944 [main] INFO  c.i.j.classloader.WebAppClassLoader -- set jar path: /var/folders/np/n5bzqjhs2l521tn0bkcqvzcc0000gn/T/_jm_10421889768839940273/WEB-INF/lib/slf4j-api-2.0.4.jar
</span></span><span style="display:flex;"><span>10:20:07.954 [main] INFO  com.itranswarp.jerrymouse.Start -- Found @WebServlet: com.itranswarp.sample.web.HelloServlet
</span></span><span style="display:flex;"><span>10:20:07.955 [main] INFO  com.itranswarp.jerrymouse.Start -- Found @WebServlet: com.itranswarp.sample.web.LoginServlet
</span></span><span style="display:flex;"><span>10:20:07.956 [main] INFO  com.itranswarp.jerrymouse.Start -- Found @WebServlet: com.itranswarp.sample.web.LogoutServlet
</span></span><span style="display:flex;"><span>10:20:07.960 [main] INFO  com.itranswarp.jerrymouse.Start -- Found @WebFilter: com.itranswarp.sample.web.filter.LogFilter
</span></span><span style="display:flex;"><span>10:20:07.962 [main] INFO  com.itranswarp.jerrymouse.Start -- Found @WebListener: com.itranswarp.sample.web.listener.HelloHttpSessionAttributeListener
</span></span><span style="display:flex;"><span>10:20:07.963 [main] INFO  com.itranswarp.jerrymouse.Start -- Found @WebListener: com.itranswarp.sample.web.listener.HelloHttpSessionListener
</span></span><span style="display:flex;"><span>10:20:07.964 [main] INFO  com.itranswarp.jerrymouse.Start -- Found @WebListener: com.itranswarp.sample.web.listener.HelloServletContextAttributeListener
</span></span><span style="display:flex;"><span>10:20:07.965 [main] INFO  com.itranswarp.jerrymouse.Start -- Found @WebListener: com.itranswarp.sample.web.listener.HelloServletContextListener
</span></span><span style="display:flex;"><span>10:20:07.966 [main] INFO  com.itranswarp.jerrymouse.Start -- Found @WebListener: com.itranswarp.sample.web.listener.HelloServletRequestAttributeListener
</span></span><span style="display:flex;"><span>10:20:07.967 [main] INFO  com.itranswarp.jerrymouse.Start -- Found @WebListener: com.itranswarp.sample.web.listener.HelloServletRequestListener
</span></span><span style="display:flex;"><span>10:20:08.003 [main] ERROR com.itranswarp.jerrymouse.Start -- load class &#39;ch.qos.logback.core.net.LoginAuthenticator&#39; failed: NoClassDefFoundError: jakarta/mail/Authenticator
</span></span><span style="display:flex;"><span>10:20:08.038 [main] INFO  c.i.j.connector.HttpConnector -- starting jerrymouse http server at 0.0.0.0:8080...
</span></span><span style="display:flex;"><span>10:20:08.044 [main] INFO  c.i.j.engine.ServletContextImpl -- set web root: /var/folders/np/n5bzqjhs2l521tn0bkcqvzcc0000gn/T/_jm_10421889768839940273
</span></span><span style="display:flex;"><span>10:20:08.044 [main] INFO  c.i.j.engine.ServletContextImpl -- auto register @WebListener: com.itranswarp.sample.web.listener.HelloServletRequestAttributeListener
</span></span><span style="display:flex;"><span>10:20:08.045 [main] INFO  c.i.j.engine.ServletContextImpl -- auto register @WebListener: com.itranswarp.sample.web.listener.HelloHttpSessionAttributeListener
</span></span><span style="display:flex;"><span>10:20:08.045 [main] INFO  c.i.j.engine.ServletContextImpl -- auto register @WebListener: com.itranswarp.sample.web.listener.HelloServletContextListener
</span></span><span style="display:flex;"><span>10:20:08.045 [main] INFO  c.i.j.engine.ServletContextImpl -- auto register @WebListener: com.itranswarp.sample.web.listener.HelloHttpSessionListener
</span></span><span style="display:flex;"><span>10:20:08.045 [main] INFO  c.i.j.engine.ServletContextImpl -- auto register @WebListener: com.itranswarp.sample.web.listener.HelloServletContextAttributeListener
</span></span><span style="display:flex;"><span>10:20:08.045 [main] INFO  c.i.j.engine.ServletContextImpl -- auto register @WebListener: com.itranswarp.sample.web.listener.HelloServletRequestListener
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»æ—¥å¿—ä¿¡æ¯å¯çŸ¥ï¼Œ<code>war</code>åŒ…è¢«è‡ªåŠ¨è§£å‹åˆ°ä¸´æ—¶ç›®å½•ï¼Œç„¶åï¼Œåˆå§‹åŒ–<code>WebAppClassLoader</code>ï¼Œå®šä½<code>classes</code>ç›®å½•å’Œ<code>lib</code>ç›®å½•ä¸‹çš„æ‰€æœ‰jaråŒ…ï¼Œè‡ªåŠ¨æ‰«ææ‰€æœ‰classæ–‡ä»¶ï¼Œæ‰¾å‡ºServletã€Filterå’ŒListenerç»„ä»¶å¹¶è‡ªåŠ¨æ³¨å†Œï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æµè§ˆå™¨æµ‹è¯•é¡µé¢ï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1557467855061056/l" alt="index-page"  />
</p>
<p>å¹¶åœ¨åå°è§‚å¯ŸListenerè¾“å‡ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>10:20:49.380 [pool-1-thread-11] DEBUG c.i.j.engine.ServletContextImpl -- process /login by filter [com.itranswarp.sample.web.filter.LogFilter@7bf37a4a], servlet com.itranswarp.sample.web.LoginServlet@2a156b2d
</span></span><span style="display:flex;"><span>10:20:49.380 [pool-1-thread-11] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletRequestInitialized: request = HttpServletRequestImpl@24d2901f[GET:/login]
</span></span><span style="display:flex;"><span>10:20:49.380 [pool-1-thread-11] INFO  c.i.s.w.l.HelloServletRequestListener -- &gt;&gt;&gt; ServletRequest initialized: HttpServletRequestImpl@24d2901f[GET:/login]
</span></span><span style="display:flex;"><span>10:20:49.380 [pool-1-thread-11] INFO  c.i.sample.web.filter.LogFilter -- [GET] /login
</span></span><span style="display:flex;"><span>10:20:49.383 [pool-1-thread-11] DEBUG c.i.j.engine.ServletContextImpl -- invoke HttpSessionCreated: session = HttpSessionImpl@5c0656b[id=ef81240c-12ac-414b-96e6-fe843951fd1f]
</span></span><span style="display:flex;"><span>10:20:49.384 [pool-1-thread-11] INFO  c.i.s.w.l.HelloHttpSessionListener -- &gt;&gt;&gt; HttpSession created: HttpSessionImpl@5c0656b[id=ef81240c-12ac-414b-96e6-fe843951fd1f]
</span></span><span style="display:flex;"><span>10:20:49.385 [pool-1-thread-11] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletRequestDestroyed: request = HttpServletRequestImpl@24d2901f[GET:/login]
</span></span><span style="display:flex;"><span>10:20:49.385 [pool-1-thread-11] INFO  c.i.s.w.l.HelloServletRequestListener -- &gt;&gt;&gt; ServletRequest destroyed: HttpServletRequestImpl@24d2901f[GET:/login]
</span></span><span style="display:flex;"><span>10:21:04.777 [pool-1-thread-12] DEBUG c.i.j.engine.ServletContextImpl -- process /login by filter [com.itranswarp.sample.web.filter.LogFilter@7bf37a4a], servlet com.itranswarp.sample.web.LoginServlet@2a156b2d
</span></span><span style="display:flex;"><span>10:21:04.778 [pool-1-thread-12] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletRequestInitialized: request = HttpServletRequestImpl@73a3895e[POST:/login]
</span></span><span style="display:flex;"><span>10:21:04.778 [pool-1-thread-12] INFO  c.i.s.w.l.HelloServletRequestListener -- &gt;&gt;&gt; ServletRequest initialized: HttpServletRequestImpl@73a3895e[POST:/login]
</span></span><span style="display:flex;"><span>10:21:04.778 [pool-1-thread-12] INFO  c.i.sample.web.filter.LogFilter -- [POST] /login
</span></span><span style="display:flex;"><span>10:21:04.779 [pool-1-thread-12] DEBUG c.i.j.engine.ServletContextImpl -- invoke HttpSessionAttributeAdded: username = bob, session = HttpSessionImpl@5c0656b[id=ef81240c-12ac-414b-96e6-fe843951fd1f]
</span></span><span style="display:flex;"><span>10:21:04.780 [pool-1-thread-12] INFO  c.i.s.w.l.HelloHttpSessionAttributeListener -- &gt;&gt;&gt; HttpSession attribute added: username = bob
</span></span><span style="display:flex;"><span>10:21:04.781 [pool-1-thread-12] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletRequestDestroyed: request = HttpServletRequestImpl@73a3895e[POST:/login]
</span></span><span style="display:flex;"><span>10:21:04.781 [pool-1-thread-12] INFO  c.i.s.w.l.HelloServletRequestListener -- &gt;&gt;&gt; ServletRequest destroyed: HttpServletRequestImpl@73a3895e[POST:/login]
</span></span><span style="display:flex;"><span>10:21:04.790 [pool-1-thread-13] DEBUG c.i.j.engine.ServletContextImpl -- process /login by filter [com.itranswarp.sample.web.filter.LogFilter@7bf37a4a], servlet com.itranswarp.sample.web.LoginServlet@2a156b2d
</span></span><span style="display:flex;"><span>10:21:04.790 [pool-1-thread-13] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletRequestInitialized: request = HttpServletRequestImpl@455863b5[GET:/login]
</span></span><span style="display:flex;"><span>10:21:04.790 [pool-1-thread-13] INFO  c.i.s.w.l.HelloServletRequestListener -- &gt;&gt;&gt; ServletRequest initialized: HttpServletRequestImpl@455863b5[GET:/login]
</span></span><span style="display:flex;"><span>10:21:04.790 [pool-1-thread-13] INFO  c.i.sample.web.filter.LogFilter -- [GET] /login
</span></span><span style="display:flex;"><span>10:21:04.791 [pool-1-thread-13] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletRequestDestroyed: request = HttpServletRequestImpl@455863b5[GET:/login]
</span></span><span style="display:flex;"><span>10:21:04.791 [pool-1-thread-13] INFO  c.i.s.w.l.HelloServletRequestListener -- &gt;&gt;&gt; ServletRequest destroyed: HttpServletRequestImpl@455863b5[GET:/login]
</span></span><span style="display:flex;"><span>10:21:05.798 [pool-1-thread-14] DEBUG c.i.j.engine.ServletContextImpl -- process /logout by filter [com.itranswarp.sample.web.filter.LogFilter@7bf37a4a], servlet com.itranswarp.sample.web.LogoutServlet@20675c59
</span></span><span style="display:flex;"><span>10:21:05.798 [pool-1-thread-14] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletRequestInitialized: request = HttpServletRequestImpl@2ea0a625[GET:/logout]
</span></span><span style="display:flex;"><span>10:21:05.798 [pool-1-thread-14] INFO  c.i.s.w.l.HelloServletRequestListener -- &gt;&gt;&gt; ServletRequest initialized: HttpServletRequestImpl@2ea0a625[GET:/logout]
</span></span><span style="display:flex;"><span>10:21:05.798 [pool-1-thread-14] INFO  c.i.sample.web.filter.LogFilter -- [GET] /logout
</span></span><span style="display:flex;"><span>10:21:05.798 [pool-1-thread-14] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletContextAttributeRemoved: username = bob, session = HttpSessionImpl@5c0656b[id=ef81240c-12ac-414b-96e6-fe843951fd1f]
</span></span><span style="display:flex;"><span>10:21:05.798 [pool-1-thread-14] INFO  c.i.s.w.l.HelloHttpSessionAttributeListener -- &gt;&gt;&gt; HttpSession attribute removed: username = bob
</span></span><span style="display:flex;"><span>10:21:05.798 [pool-1-thread-14] DEBUG c.i.j.engine.ServletContextImpl -- invoke HttpSessionDestroyed: session = HttpSessionImpl@5c0656b[id=ef81240c-12ac-414b-96e6-fe843951fd1f]
</span></span><span style="display:flex;"><span>10:21:05.798 [pool-1-thread-14] INFO  c.i.s.w.l.HelloHttpSessionListener -- &gt;&gt;&gt; HttpSession destroyed: HttpSessionImpl@5c0656b[id=ef81240c-12ac-414b-96e6-fe843951fd1f]
</span></span><span style="display:flex;"><span>10:21:05.799 [pool-1-thread-14] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletRequestDestroyed: request = HttpServletRequestImpl@2ea0a625[GET:/logout]
</span></span><span style="display:flex;"><span>10:21:05.799 [pool-1-thread-14] INFO  c.i.s.w.l.HelloServletRequestListener -- &gt;&gt;&gt; ServletRequest destroyed: HttpServletRequestImpl@2ea0a625[GET:/logout]
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤–ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å®šä¹‰æ˜ å°„åˆ°<code>/</code>çš„Servletï¼Œå› æ­¤ï¼ŒWeb Serverè‡ªåŠ¨æ³¨å†Œä¸€ä¸ªå†…ç½®çš„<code>DefaultServlet</code>ï¼Œç”¨äºæ˜¾ç¤ºç›®å½•ï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1560099061497920/l" alt="index-page"  />
</p>
<p>æŒ‰Ctrl+Cå…³é—­æœåŠ¡å™¨ï¼Œç”±äºæˆ‘ä»¬åœ¨Web Serverå¯åŠ¨æ—¶è®¾ç½®äº†ShutdownHookï¼Œæ‰€ä»¥ä¸´æ—¶ç›®å½•ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</p>
<h2 id="éƒ¨ç½²spring-web-app">éƒ¨ç½²Spring Web App<a hidden class="anchor" aria-hidden="true" href="#éƒ¨ç½²spring-web-app">#</a></h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ç¼–å†™çš„Jerrymouse Serverè¿è¡Œä¸€ä¸ªç®€å•çš„<code>hello-webapp</code>æ²¡é—®é¢˜ï¼Œé‚£ä¹ˆå¤æ‚çš„Web Appå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªåŸºäºSpring MVCçš„Web Appã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦åŠ è½½Springå†…ç½®çš„<code>DispatcherServlet</code>ï¼Œå¦‚æœç”¨ä¼ ç»Ÿçš„<code>web.xml</code>é…ç½®ï¼Œåˆ™å¯ä»¥ç¼–å†™å¦‚ä¸‹é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;web-app&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;servlet&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;servlet-name&gt;</span>dispatcher<span style="font-weight:bold">&lt;/servlet-name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span style="font-weight:bold">&lt;/servlet-class&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;init-param&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&lt;param-name&gt;</span>contextClass<span style="font-weight:bold">&lt;/param-name&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&lt;param-value&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span style="font-weight:bold">&lt;/param-value&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;/init-param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;init-param&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&lt;param-name&gt;</span>contextConfigLocation<span style="font-weight:bold">&lt;/param-name&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&lt;param-value&gt;</span>com.itranswarp.sample.AppConfig<span style="font-weight:bold">&lt;/param-value&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;/init-param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/servlet&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;servlet-mapping&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;servlet-name&gt;</span>dispatcher<span style="font-weight:bold">&lt;/servlet-name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;url-pattern&gt;</span>/<span style="font-weight:bold">&lt;/url-pattern&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/servlet-mapping&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/web-app&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å·²ç»å¹²æ‰äº†é€šè¿‡<code>web.xml</code>é…ç½®çš„æ–¹å¼ï¼Œåªæ”¯æŒè‡ªåŠ¨æ‰«æ<code>@WebServlet</code>ï¼Œå› æ­¤ï¼Œéœ€è¦ç¼–å†™ä¸€ä¸ªç»§æ‰¿è‡ª<code>DispatcherServlet</code>çš„<code>AppDispatcherServlet</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@WebServlet(
</span></span><span style="display:flex;"><span>    urlPatterns = <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>,
</span></span><span style="display:flex;"><span>    initParams = {
</span></span><span style="display:flex;"><span>        @WebInitParam(name = <span style="color:#0ff;font-weight:bold">&#34;contextClass&#34;</span>, value = <span style="color:#0ff;font-weight:bold">&#34;org.springframework.web.context.support.AnnotationConfigWebApplicationContext&#34;</span>),
</span></span><span style="display:flex;"><span>        @WebInitParam(name = <span style="color:#0ff;font-weight:bold">&#34;contextConfigLocation&#34;</span>, value = <span style="color:#0ff;font-weight:bold">&#34;com.itranswarp.sample.AppConfig&#34;</span>) })
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppDispatcherServlet <span style="color:#fff;font-weight:bold">extends</span> DispatcherServlet {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼ŒJerrymouse Serverä¼šè‡ªåŠ¨æ‰«æåˆ°<code>AppDispatcherServlet</code>ï¼Œç„¶åï¼Œæ ¹æ®<code>@WebServlet</code>çš„é…ç½®ï¼Œå¯åŠ¨Springå®¹å™¨ï¼Œç±»å‹ä¸º<code>AnnotationConfigWebApplicationContext</code>ï¼Œé…ç½®ç±»<code>com.itranswarp.sample.AppConfig</code>ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç¼–å†™é…ç½®ç±»<code>AppConfig</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableWebMvc
</span></span><span style="display:flex;"><span>@EnableTransactionManagement
</span></span><span style="display:flex;"><span>@PropertySource(<span style="color:#0ff;font-weight:bold">&#34;classpath:/jdbc.properties&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    WebMvcConfigurer createWebMvcConfigurer() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> WebMvcConfigurer() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
</span></span><span style="display:flex;"><span>                registry.<span style="color:#007f7f">addResourceHandler</span>(<span style="color:#0ff;font-weight:bold">&#34;/static/**&#34;</span>).<span style="color:#007f7f">addResourceLocations</span>(<span style="color:#0ff;font-weight:bold">&#34;/static/&#34;</span>);
</span></span><span style="display:flex;"><span>                registry.<span style="color:#007f7f">addResourceHandler</span>(<span style="color:#0ff;font-weight:bold">&#34;/favicon.ico&#34;</span>).<span style="color:#007f7f">addResourceLocations</span>(<span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    ViewResolver createViewResolver(@Autowired ServletContext servletContext) {
</span></span><span style="display:flex;"><span>        var engine = <span style="color:#fff;font-weight:bold">new</span> PebbleEngine.<span style="color:#007f7f">Builder</span>().<span style="color:#007f7f">autoEscaping</span>(<span style="color:#fff;font-weight:bold">true</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// loader:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                .<span style="color:#007f7f">loader</span>(<span style="color:#fff;font-weight:bold">new</span> Servlet5Loader(servletContext))
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// build:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                .<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>        var viewResolver = <span style="color:#fff;font-weight:bold">new</span> PebbleViewResolver(engine);
</span></span><span style="display:flex;"><span>        viewResolver.<span style="color:#007f7f">setPrefix</span>(<span style="color:#0ff;font-weight:bold">&#34;/WEB-INF/templates/&#34;</span>);
</span></span><span style="display:flex;"><span>        viewResolver.<span style="color:#007f7f">setSuffix</span>(<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> viewResolver;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    DataSource createDataSource(@Value(<span style="color:#0ff;font-weight:bold">&#34;${jdbc.driver}&#34;</span>) String jdbcDriver, @Value(<span style="color:#0ff;font-weight:bold">&#34;${jdbc.url}&#34;</span>) String jdbcUrl,
</span></span><span style="display:flex;"><span>            @Value(<span style="color:#0ff;font-weight:bold">&#34;${jdbc.username}&#34;</span>) String jdbcUsername, @Value(<span style="color:#0ff;font-weight:bold">&#34;${jdbc.password}&#34;</span>) String jdbcPassword) {
</span></span><span style="display:flex;"><span>        HikariConfig config = <span style="color:#fff;font-weight:bold">new</span> HikariConfig();
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">setDriverClassName</span>(jdbcDriver);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">setJdbcUrl</span>(jdbcUrl);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">setUsername</span>(jdbcUsername);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">setPassword</span>(jdbcPassword);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">addDataSourceProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;autoCommit&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;false&#34;</span>);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">addDataSourceProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;connectionTimeout&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;5&#34;</span>);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">addDataSourceProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;idleTimeout&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;60&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> HikariDataSource(config);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    JdbcTemplate createJdbcTemplate(@Autowired DataSource dataSource) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> JdbcTemplate(dataSource);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    PlatformTransactionManager createTxManager(@Autowired DataSource dataSource) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> DataSourceTransactionManager(dataSource);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>AppConfig</code>æ˜¯æ ‡å‡†çš„Springé…ç½®ç±»ï¼Œæˆ‘ä»¬æ­£å¸¸é…ç½®MVCã€ViewResolverã€JDBCç›¸å…³çš„DataSourceã€JdbcTemplateå’ŒPlatformTransactionManagerï¼Œä»¥åŠSpringå®¹å™¨éœ€è¦çš„Serviceã€Controllerç­‰ï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªå®Œæ•´çš„Spring MVCçš„WebAppã€‚</p>
<p>ç”¨Mavenç¼–è¯‘<code>spring-webapp</code>ï¼Œå¾—åˆ°<code>spring-webapp-1.0.war</code>æ–‡ä»¶ã€‚ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ java -jar /path/to/jerrymouse-1.0.0.jar -w /path/to/spring-webapp-1.0.war
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§‚å¯Ÿ<code>AppDispatcherServlet</code>çš„è¾“å‡ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>10:48:08.200 [main] DEBUG o.s.w.c.s.AnnotationConfigWebApplicationContext -- Refreshing WebApplicationContext for namespace &#39;appDispatcherServlet-servlet&#39;
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>10:48:08.223 [main] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletContextAttributeAdded: org.springframework.web.context.support.ServletContextScope = org.springframework.web.context.support.ServletContextScope@2616b618
</span></span><span style="display:flex;"><span>10:48:08.225 [main] DEBUG o.s.b.f.s.DefaultListableBeanFactory -- Creating shared instance of singleton bean &#39;org.springframework.context.annotation.internalConfigurationAnnotationProcessor&#39;
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>10:48:08.705 [main] DEBUG c.i.sample.AppDispatcherServlet -- Detected AcceptHeaderLocaleResolver
</span></span><span style="display:flex;"><span>10:48:08.705 [main] DEBUG c.i.sample.AppDispatcherServlet -- Detected FixedThemeResolver
</span></span><span style="display:flex;"><span>10:48:08.706 [main] DEBUG c.i.sample.AppDispatcherServlet -- Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@559fd5ec
</span></span><span style="display:flex;"><span>10:48:08.706 [main] DEBUG c.i.sample.AppDispatcherServlet -- Detected org.springframework.web.servlet.support.SessionFlashMapManager@bb12f41
</span></span><span style="display:flex;"><span>10:48:08.707 [main] DEBUG c.i.j.engine.ServletContextImpl -- invoke ServletContextAttributeAdded: org.springframework.web.servlet.FrameworkServlet.CONTEXT.appDispatcherServlet = WebApplicationContext for namespace &#39;appDispatcherServlet-servlet&#39;, started on Sat Jul 29 10:48:08 CST 2023
</span></span><span style="display:flex;"><span>10:48:08.707 [HikariPool-1 connection adder] DEBUG com.zaxxer.hikari.pool.HikariPool -- HikariPool-1 - Added connection org.hsqldb.jdbc.JDBCConnection@4b7d3c3b
</span></span><span style="display:flex;"><span>10:48:08.707 [main] DEBUG c.i.sample.AppDispatcherServlet -- enableLoggingRequestDetails=&#39;false&#39;: request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
</span></span><span style="display:flex;"><span>10:48:08.707 [main] INFO  c.i.sample.AppDispatcherServlet -- Completed initialization in 511 ms
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°<code>AppDispatcherServlet</code>æ˜¯ç»‘å®šåˆ°<code>/</code>çš„ï¼Œå› æ­¤ï¼Œæ‰€æœ‰è¯·æ±‚å‡å…¨éƒ¨ç”±Springæä¾›çš„<code>DispatcherServlet</code>å¤„ç†ï¼ŒåŒ…æ‹¬é™æ€æ–‡ä»¶ã€‚</p>
<p>è®¿é—®<code>http://localhost:8080</code>ï¼Œè§‚å¯ŸMVCçš„è¾“å‡ºï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1558459629699137/l" alt="spring-web-app-1"  />
</p>
<p>è§‚å¯Ÿç™»å½•åçš„è¾“å‡ºï¼š</p>
<p><img loading="lazy" src="https://www.liaoxuefeng.com/files/attachments/1558459654864960/l" alt="spring-web-app-2"  />
</p>
<p>å¯è§ï¼ŒJerrymouse Serverå¯ä»¥æ­£å¸¸è¿è¡ŒåŸºäºSpring MVCçš„Web Appã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨Springæä¾›çš„<code>async</code>ç›¸å…³åŠŸèƒ½ï¼Œä¾‹å¦‚<code>DeferredResult</code>ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨WebSocketç›¸å…³åŠŸèƒ½ã€‚</p>
<h1 id="faq">FAQ<a hidden class="anchor" aria-hidden="true" href="#faq">#</a></h1>
<h3 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#å¸¸è§é—®é¢˜">#</a></h3>
<p>æœ¬èŠ‚åˆ—å‡ºå¸¸è§çš„ä¸€äº›é—®é¢˜ã€‚</p>
<h3 id="å¦‚ä½•æ­£ç¡®å®ç°getoutputstreamå’Œgetwriter">å¦‚ä½•æ­£ç¡®å®ç°getOutputStream()å’ŒgetWriter()ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•æ­£ç¡®å®ç°getoutputstreamå’Œgetwriter">#</a></h3>
<p>æ ¹æ®Servletè§„èŒƒï¼Œ<code>getOutputStream()</code>å’Œ<code>getWriter()</code>åœ¨ä¸€æ¬¡HTTPå¤„ç†ä¸­åªèƒ½äºŒé€‰ä¸€ï¼Œä¸èƒ½éƒ½è°ƒç”¨ï¼Œå› æ­¤ï¼ŒHttpServletResponseå†…éƒ¨ä¼šç”¨<code>callOutput</code>è®°å½•è°ƒç”¨çŠ¶æ€ï¼š</p>
<ul>
<li>nullï¼šæœªè°ƒç”¨<code>getOutputStream()</code>å’Œ<code>getWriter()</code>ï¼›</li>
<li>Boolean.TRUEï¼šå·²è°ƒç”¨<code>getOutputStream()</code>ï¼›</li>
<li>Boolean.FALSEï¼šå·²è°ƒç”¨<code>getWriter()</code>ã€‚</li>
</ul>
<p>è¿åè°ƒç”¨è§„åˆ™ä¼šæŠ›å‡º<code>IllegalStateException</code>ã€‚</p>
<h3 id="httpservletresponseä¸ºä»€ä¹ˆè¦å®ç°cleanup">HttpServletResponseä¸ºä»€ä¹ˆè¦å®ç°cleanup()ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#httpservletresponseä¸ºä»€ä¹ˆè¦å®ç°cleanup">#</a></h3>
<p>å› ä¸ºWeb Appå¯èƒ½ä¸ä¼šè°ƒç”¨<code>getOutputStream()</code>æˆ–<code>getWriter()</code>ï¼Œè€Œæ˜¯ç›´æ¥è®¾ç½®Headeråè¿”å›ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>resp.setStatus(403);
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶ï¼Œ<code>HttpConnector</code>è¦è°ƒç”¨<code>cleanup()</code>ï¼Œå¦‚æœå‘ç°æ²¡æœ‰å‘é€Headerï¼Œåˆ™éœ€è¦ç«‹åˆ»å‘é€Headerï¼Œå¦åˆ™æµè§ˆå™¨æ— æ³•æ”¶åˆ°å“åº”ã€‚</p>
<p>æ­¤å¤–ï¼Œæ ¹æ®HttpConnectorçš„å®ç°æ–¹å¼ï¼ŒåŸºäºJDKçš„<code>HttpExchange</code>çš„<code>OutputStream</code>ä¹Ÿéœ€è¦å…³é—­ï¼ˆä½†ä¸ä¸€å®šä¼šå…³é—­å¯¹åº”çš„TCPè¿æ¥ï¼‰ã€‚</p>
<h3 id="å¦‚ä½•å¯¹servletæ’åº">å¦‚ä½•å¯¹Servletæ’åºï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•å¯¹servletæ’åº">#</a></h3>
<p>Servletéœ€è¦æ ¹æ®æ˜ å°„è¿›è¡Œæ’åºï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p>
<ul>
<li>è·¯å¾„é•¿çš„ä¼˜å…ˆçº§é«˜ï¼Œä¾‹å¦‚ï¼Œ<code>/auth/login</code>æ’åœ¨<code>/auth</code>å‰ï¼›</li>
<li>å‰ç¼€åŒ¹é…æ¯”åç¼€åŒ¹é…ä¼˜å…ˆçº§é«˜ï¼Œä¾‹å¦‚ï¼Œ<code>/auth/*</code>æ’åœ¨<code>*.do</code>å‰ã€‚</li>
</ul>
<h3 id="å¦‚ä½•å¤„ç†æ˜ å°„">å¦‚ä½•å¤„ç†â€œ/â€æ˜ å°„ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•å¤„ç†æ˜ å°„">#</a></h3>
<p>æ ¹æ®Servletè§„èŒƒï¼Œ<code>/</code>ç›¸å½“äº<code>/*</code>ï¼Œä½†è¿˜æ˜¯æœ‰æ‰€ä¸åŒï¼Œå› ä¸º<code>/</code>è¡¨ç¤ºé»˜è®¤çš„Servletï¼Œå³æ‰€æœ‰è§„åˆ™å‡ä¸åŒ¹é…æ—¶ï¼Œæœ€ååŒ¹é…<code>/</code>ã€‚</p>
<p>å¦‚æœä¸€ä¸ªWeb Appæ²¡æœ‰æä¾›<code>/</code>æ˜ å°„ï¼Œåˆ™Web Serverå¯ä»¥è‡ªåŠ¨æä¾›ä¸€ä¸ªé»˜è®¤çš„æ˜ å°„åˆ°<code>/</code>çš„Servletã€‚Jerrymouseå’ŒTomcatç±»ä¼¼ï¼Œæä¾›ä¸€ä¸ªæµè§ˆæ–‡ä»¶çš„<code>DefaultServlet</code>ã€‚</p>
<h3 id="å¦‚ä½•å¤„ç†é™æ€æ–‡ä»¶">å¦‚ä½•å¤„ç†é™æ€æ–‡ä»¶ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•å¤„ç†é™æ€æ–‡ä»¶">#</a></h3>
<p>å¤„ç†é™æ€æ–‡ä»¶æ—¶ï¼Œå°†URLè·¯å¾„<code>/path/to/file.doc</code>è½¬æ¢ä¸ºæœ¬åœ°æ–‡ä»¶è·¯å¾„<code>${webroot}/path/to/file.doc</code>ï¼Œç„¶åæ ¹æ®æ‰©å±•åè®¾ç½®æ­£ç¡®çš„<code>Content-Type</code>ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ï¼Œå‘é€å³å¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒServletè§„èŒƒè§„å®šï¼Œä¸å…è®¸è®¿é—®<code>/WEB-INF/</code>å¼€å¤´çš„URLï¼Œå› æ­¤ï¼Œé‡åˆ°è®¿é—®<code>/WEB-INF/*</code>çš„è¯·æ±‚æ—¶ï¼Œç›´æ¥è¿”å›404é”™è¯¯ç ã€‚</p>
<h3 id="å¦‚ä½•å¯¹filteræ’åº">å¦‚ä½•å¯¹Filteræ’åºï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•å¯¹filteræ’åº">#</a></h3>
<p>Servletè§„èŒƒæ²¡æœ‰å¯¹Filteræ’åºçš„è¦æ±‚ï¼Œä½†æˆ‘ä»¬åœ¨å®ç°æ—¶è¿˜æ˜¯æŒ‰<code>@WebFilter</code>çš„<code>filterName()</code>è¿›è¡Œæ’åºï¼Œè¿™æ ·Web Appå¯ä»¥æ ¹æ®åç§°è°ƒæ•´Filterçš„é¡ºåºã€‚</p>
<h3 id="å¦‚ä½•å¯ç”¨è™šæ‹Ÿçº¿ç¨‹">å¦‚ä½•å¯ç”¨è™šæ‹Ÿçº¿ç¨‹ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•å¯ç”¨è™šæ‹Ÿçº¿ç¨‹">#</a></h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJerrymouse Serveré‡‡ç”¨çº¿ç¨‹æ± æ¨¡å¼ï¼Œè¦å¯ç”¨è™šæ‹Ÿçº¿ç¨‹ï¼Œå¯ä»¥åŠ ä¸Šé…ç½®é¡¹ï¼Œä»¥åˆ›å»ºä¸åŒç±»å‹çš„<code>ExecutorService</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ExecutorService executor = config.<span style="color:#007f7f">server</span>.<span style="color:#007f7f">enableVirtualThread</span> ?
</span></span><span style="display:flex;"><span>        Executors.<span style="color:#007f7f">newVirtualThreadPerTaskExecutor</span>() :
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(<span style="color:#ff0;font-weight:bold">0</span>, config.<span style="color:#007f7f">server</span>.<span style="color:#007f7f">threadPoolSize</span>, <span style="color:#ff0;font-weight:bold">0</span>L, TimeUnit.<span style="color:#007f7f">MILLISECONDS</span>, <span style="color:#fff;font-weight:bold">new</span> LinkedBlockingQueue&lt;&gt;());
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://funny-toffee-4aa7c3.netlify.app/tags/java/">java</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://funny-toffee-4aa7c3.netlify.app/">Wjy&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>