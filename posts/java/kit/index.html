<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>kit | Wjy&#39;s Blog</title>
<meta name="keywords" content="java">
<meta name="description" content="ffmpeg使用
ffmpeg了解
ffmpeg官网
在使用Java调用FFmpeg处理音视频之前，需要先安装FFmpeg，安装方法分为两种：">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://wjy6.netlify.app/posts/java/kit/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://wjy6.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://wjy6.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://wjy6.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://wjy6.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://wjy6.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://wjy6.netlify.app/posts/java/kit/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://wjy6.netlify.app/posts/java/kit/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="kit">
  <meta property="og:description" content="ffmpeg使用 ffmpeg了解 ffmpeg官网 在使用Java调用FFmpeg处理音视频之前，需要先安装FFmpeg，安装方法分为两种：">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-01-11T10:27:48+00:00">
    <meta property="article:modified_time" content="2020-01-11T10:27:48+00:00">
    <meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kit">
<meta name="twitter:description" content="ffmpeg使用
ffmpeg了解
ffmpeg官网
在使用Java调用FFmpeg处理音视频之前，需要先安装FFmpeg，安装方法分为两种：">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://wjy6.netlify.app/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "kit",
      "item": "https://wjy6.netlify.app/posts/java/kit/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "kit",
  "name": "kit",
  "description": "ffmpeg使用 ffmpeg了解 ffmpeg官网 在使用Java调用FFmpeg处理音视频之前，需要先安装FFmpeg，安装方法分为两种：\n",
  "keywords": [
    "java"
  ],
  "articleBody": "ffmpeg使用 ffmpeg了解 ffmpeg官网 在使用Java调用FFmpeg处理音视频之前，需要先安装FFmpeg，安装方法分为两种：\n引入封装了FFmpeg的开源框架（不推荐） JAVE.jar 是一个封装了FFmpeg的Java框架，在项目中能直接调用它的API来处理音视频文件； 官网 优点：使用方便，直接在项目中引入JAVE.jar即可处理媒体文件，且开发完成后可以随工程一起打包发布，不需要在目标运行环境内手动安装FFmpeg相关的类库 缺点：JAVE.jar最后一次更新是2009年，其封装的FFmpeg版本是09年或更早前的版本，比较老旧，无法使用一些新特性 1 2 3 4 5 org.ffmpeg sdk 1.0.2 在系统中手动安装FFmpeg(推荐) 在运行环境中手动安装FFmpeg稍微有一些麻烦，可以百度 windows/mac安装FFmpeg 这样的关键字，根据网上的安装教程将FFmpeg安装到系统中。 优点：可以直接调用FFmpeg的相关API处理音视频，FFmpeg版本可控 缺点：手动安装较为麻烦，开发环境与目标运行环境都需要先安装好FFmpeg 另外，如果项目是通过docker和k8s构建部署的，也可以使用ffmpeg，需要将ffmpeg打到对应的镜像中。 使用FFmpeg处理音视频 后续，我懒得写了\n为什么我要用到ffmpeg。 因为我项目中有一些音频数据是整段的，因为业务变动，需要根据时间点切分成很多小段。 之前是返回给app，app先把音频下载下来，然后根据时间点切分，巨慢。所以现在把数据库里的数据直接切割好，返回给前端。 最开始觉得用ffmpeg麻烦，想用一些io的方法，把文件切割，然后各种实验后，不是对文件类型有要求，就是切割之后文件失真等等问题。所以用ffmpeg。\n音频文件转wav格式 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 /** * 音频文件转wav格式 * @param ffmpegPath * @param sourcePath * @param targetPath * @return * @throws Exception */ public static File changeFileToWav(String ffmpegPath, String sourcePath, String targetPath) throws Exception { String webroot = ffmpegPath; Runtime run = null; try { run = Runtime.getRuntime(); long start = System.currentTimeMillis(); System.out.println(new File(webroot) .getAbsolutePath()); //执行ffmpeg.exe,前面是ffmpeg.exe的地址，中间是需要转换的文件地址，后面是转换后的文件地址。-i是转换方式，意思是可编码解码，mp3编码方式采用的是libmp3lame //wav转pcm //Process p=run.exec(new File(webroot).getAbsolutePath()+\"/ffmpeg -y -i \"+sourcePath+\" -acodec pcm_s16le -f s16le -ac 1 -ar 16000 \"+targetPath); //mp3转pcm // Process p = run.exec(new File(webroot).getAbsolutePath() + \"/ffmpeg -y -i \" + sourcePath + \" -acodec pcm_s16le -f s16le -ac 1 -ar 16000 \" + targetPath); //16bit 单声道 48khz Process p = run.exec(new File(webroot) .getAbsolutePath() + \"/ffmpeg -y -i \" + sourcePath + \" -ar 48000 -ac 1 -acodec pcm_s16le \" + targetPath); InputStream stderr = p.getErrorStream(); InputStreamReader isr = new InputStreamReader(stderr); BufferedReader br = new BufferedReader(isr); String line = null; while ((line = br.readLine()) != null) System.out.println(line); int exitVal = p.waitFor(); System.out.println(\"Process exitValue: \" + exitVal); //释放进程 p.getOutputStream() .close(); p.getInputStream() .close(); p.getErrorStream() .close(); p.waitFor(); long end = System.currentTimeMillis(); System.out.println(sourcePath + \" convert success, costs:\" + (end - start) + \"ms\"); File targetFile = new File(targetPath); return targetFile; } catch (Exception e) { e.printStackTrace(); } finally { //run调用lame解码器最后释放内存 run.freeMemory(); } return null; } 音频切割 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 /** * 音频切割 * @param ffmpegPath * @param sourcePath * @param targetPath * @param startTime * @param endTime * @return * @throws Exception */ public static File wavToCutting(String ffmpegPath, String sourcePath, String targetPath, String startTime, String endTime) throws Exception { String webroot = ffmpegPath; Runtime run = null; try { run = Runtime.getRuntime(); long start = System.currentTimeMillis(); System.out.println(new File(webroot) .getAbsolutePath()); //执行ffmpeg.exe,前面是ffmpeg.exe的地址，中间是需要转换的文件地址，后面是转换后的文件地址。-i是转换方式，意思是可编码解码，mp3编码方式采用的是libmp3lame //wav转pcm //Process p=run.exec(new File(webroot).getAbsolutePath()+\"/ffmpeg -y -i \"+sourcePath+\" -acodec pcm_s16le -f s16le -ac 1 -ar 16000 \"+targetPath); //mp3转pcm // Process p = run.exec(new File(webroot).getAbsolutePath() + \"/ffmpeg -y -i \" + sourcePath + \" -acodec pcm_s16le -f s16le -ac 1 -ar 16000 \" + targetPath); //16bit 单声道 48khz System.err.print(new File(webroot) .getAbsolutePath() + \"/ffmpeg -i \" + sourcePath + \" -ss \" + startTime + \" -to \" + endTime + \" -y \" + targetPath); Process p = run.exec(new File(webroot) .getAbsolutePath() + \"/ffmpeg -i \" + sourcePath + \" -ss \" + startTime + \" -to \" + endTime + \" -y \" + targetPath); InputStream stderr = p.getErrorStream(); InputStreamReader isr = new InputStreamReader(stderr); BufferedReader br = new BufferedReader(isr); String line = null; while ((line = br.readLine()) != null) System.out.println(line); int exitVal = p.waitFor(); System.out.println(\"Process exitValue: \" + exitVal); //释放进程 p.getOutputStream() .close(); p.getInputStream() .close(); p.getErrorStream() .close(); p.waitFor(); long end = System.currentTimeMillis(); System.out.println(sourcePath + \" convert success, costs:\" + (end - start) + \"ms\"); File targetFile = new File(targetPath); return targetFile; } catch (Exception e) { e.printStackTrace(); } finally { //run调用lame解码器最后释放内存 run.freeMemory(); } return null; } 在图片上写字 参考\n把字写到已存在的图片上 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 public static void generatePic(String str) { File file = new File(\"C:\\\\Users\\\\123\\\\Desktop\\\\123.png\"); //Image src = ImageIO.read(file); Image src = Toolkit.getDefaultToolkit().createImage(file.getAbsolutePath()); BufferedImage bi = toBufferedImage(src); if (bi == null) { return; } g = bi.createGraphics(); //#853C24 g.setColor(new Color(133, 60, 36)); g.setFont(new Font(\"微软雅黑\", Font.BOLD, 80)); g.drawString(str, 130, 250); g.dispose(); ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); try { ImageIO.write(bi, \"png\", outputStream); byte[] bytes = outputStream.toByteArray(); //该bytes数组就可以输出到文件，或者云服务器 File newFile = new File(\"C:\\\\Users\\\\123\\\\Desktop\\\\生成.png\"); FileOutputStream fos = new FileOutputStream(newFile); fos.write(bytes); fos.flush(); fos.close(); //也可以上传到云服务器 //TencentFileUploadUtils.uploafFileByBytes(bytes); } catch (IOException e) { e.printStackTrace(); } } public static BufferedImage toBufferedImage(Image image) { if (image instanceof BufferedImage) { return (BufferedImage) image; } // This code ensures that all the pixels in the image are loaded image = new ImageIcon(image).getImage(); BufferedImage bimage = null; GraphicsEnvironment ge = GraphicsEnvironment .getLocalGraphicsEnvironment(); try { int transparency = Transparency.OPAQUE; GraphicsDevice gs = ge.getDefaultScreenDevice(); GraphicsConfiguration gc = gs.getDefaultConfiguration(); bimage = gc.createCompatibleImage(image.getWidth(null), image.getHeight(null), transparency); } catch (HeadlessException e) { // The system does not have a screen } if (bimage == null) { // Create a buffered image using the default color model int type = BufferedImage.TYPE_INT_RGB; bimage = new BufferedImage(image.getWidth(null), image.getHeight(null), type); } // Copy image to buffered image Graphics g = bimage.createGraphics(); // Paint the image onto the buffered image g.drawImage(image, 0, 0, null); g.dispose(); return bimage; } public static void main(String[] args) throws Exception { generatePic(\"测试文字\"); } 如果设置的字体不生效，可以通过如下代码查看系统有哪些字体。\n1 2 3 4 Font[] fonts = GraphicsEnvironment.getLocalGraphicsEnvironment().getAllFonts(); for (Font f : fonts) { System.out.println(\"Name:\" + f.getFontName()); } 在控制台寻找自己想要的字体的英文名称，再替换到new Font()的指定位置就可以了。\n进阶，文字自动换行 如果有很多文字，想根据文字生成图片，涉及到自动换行问题。具体代码在码云。\n裁剪图片空白区域 参考 白底黑字的图片，裁减掉空白区域，生成新的图片。因为图片又太多的空白，不美观。\n思路：\n调用ImageIO.read获取图片以及原图的宽度、高度 通过双层for循环，遍历图片的每个像素点，获取图片上下左右四个极值 调用BufferedImage 的getSubimage方法裁剪图片 调用ImageIO.write方法生成裁剪后的图片 1 2 3 4 5 public BufferedImage getSubimage (int x, int y, int w, int h) {} x 左上角x坐标 y 左上角y坐标 w 新图片宽度 y 新图片高度 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 public static BufferedImage cutImage(BufferedImage bufferedImage) { int WHITE = new Color(255, 255, 255).getRGB(); int BLACK = new Color(0, 0, 0).getRGB(); // 原图片宽度 int width = bufferedImage.getWidth(); // 原图片高度 int height = bufferedImage.getHeight(); // rgb int colorNum = 200; int rgb = 0; int left = width; int top = height; int right = 0; int buttom = 0; // 遍历图片每个像素点 for (int i = 0; i \u003c width; i++) { for (int j = 0; j \u003c height; j++) { //获取每个像素点的RGB rgb = bufferedImage.getRGB(i, j); //转成可读的RGB值 Color color = new Color(rgb); // 跳过范围（偏白色-\u003e白色） if (color.getRed() \u003e colorNum \u0026\u0026 color.getBlue() \u003e colorNum \u0026\u0026 color.getGreen() \u003e colorNum) { continue; } // 计算最左侧 if (left \u003e= i) { left = i; } // 计算最右侧 if (right \u003c= i) { right = i; } // 计算最上方 if (top \u003e= j) { top = j; } // 计算最下方 if (buttom \u003c= j) { buttom = j; } } } // 如果计算出的最右，和图片宽度相差不到50，那么不裁剪右侧，使用原图宽度 if(width - right \u003c= 50){ right = width - left; } // 如果计算出的最下，和图片高度相差不到50，那么不裁剪底部，使用原图高度 if(height - buttom \u003c= 50){ buttom = height - top; } // -------------\u003e开始 // 为了美观，四边留20的边界（看情况，可不留边界） int blank = 20; //计算左值 left = 0 \u003c= left - blank ? left - blank : left; //计算顶部值 top = 0 \u003c= top - blank ? top - blank : top; //计算右值 right = right - left + blank \u003e= width ? right : right - left + blank; //计算底部值 buttom = buttom - top + blank \u003e= height ? buttom : buttom - top + blank; // ----------------\u003e结束，这部分代码看情况，是否需要留20的空白 // 可能会出现右或下为0的情况 if(right == 0 || buttom == 0){ return null; } // 裁剪原图，注意：right + left \u003c= width（必须），buttom + top \u003c= height（必须），否则会报错 return bufferedImage.getSubimage(left, top, right, buttom); } public static void main(String[] args) throws IOException { // 原图 BufferedImage bufferedImage = ImageIO.read(new File(\"C:\\\\Users\\\\123\\\\Desktop\\\\1.jpg\")); // 裁剪 BufferedImage newBufferedImage = cutImage(bufferedImage); // 图片可能有问题，即没有k if(newBufferedImage == null){ return; } // 生成新图 ImageIO.write(newBufferedImage, \"png\", new File(\"C:\\\\Users\\\\123\\\\Desktop\\\\new.png\")); } 工具类 时间 判断两个时间戳是否是同一天 1 2 3 4 5 6 7 8 9 10 public static boolean isSameDay(int beginTimestamp,int endTimestamp) { SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\"); String ds1 = sdf.format(beginTimestamp * 1000l); String ds2 = sdf.format(endTimestamp * 1000l); if (ds1.equals(ds2)) { return true; } else { return false; } } 计算两个时间戳差值(秒级时间戳) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 public static int getTimeDifference(int beginTimestamp, int endTimestamp, int type) { int result = 0; if (beginTimestamp == 0 || endTimestamp == 0) { return 0; } try { int millisecond = endTimestamp - beginTimestamp; /** * Math.abs((int)(millisecond/1000)); 绝对值 1秒 = 1000毫秒 * millisecond/1000 --\u003e 秒 * millisecond/1000*60 - \u003e 分钟 * millisecond/(1000*60*60) -- \u003e 小时 * millisecond/(1000*60*60*24) --\u003e 天 * */ switch (type) { case 0: // second return millisecond; case 1: // minute return (millisecond / 60); case 2: // hour return (millisecond / (60 * 60)); case 3: // day return (millisecond / (60 * 60 * 24)); } } catch (Exception e) { e.printStackTrace(); } return result; } 字符串 字符串排序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /** * @author: wjy * @description: 字符串根据ASCII码表进行升序排列 */ public static String ASCIISort(String str) { char[] test = new char[str.length()]; StringBuilder sb = new StringBuilder(); while (true) { String a = str;//直接读取这行当中的字符串。 for (int i = 0; i \u003c str.length(); i++) { test[i] = a.charAt(i);//字符串处理每次读取一位。 } Arrays.sort(test); for (int i = 0; i \u003c test.length; i++) { sb.append(test[i]); } String trim = sb.toString().trim(); return trim; } } 判断版本号 app上线后，需求的变动需要兼容旧版本的app，不能然旧版的app不能访问。 所以我们在每个接口中都传入appVersion，即app的版本号，届时可以通过app的版本号来判断接口数据的变动。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 /** * 版本号比较 * * @param v1 * @param v2 * @return 0代表相等，1代表左边大，-1代表右边大 * Utils.compareVersion(\"1.0.358_20180820090554\",\"1.0.358_20180820090553\")=1 */ public static int compareVersion(String v1, String v2) { if (v1.equals(v2)) { return 0; } String[] version1Array = v1.split(\"[._]\"); String[] version2Array = v2.split(\"[._]\"); int index = 0; int minLen = Math.min(version1Array.length, version2Array.length); long diff = 0; while (index \u003c minLen \u0026\u0026 (diff = Long.parseLong(version1Array[index]) - Long.parseLong(version2Array[index])) == 0) { index++; } if (diff == 0) { for (int i = index; i \u003c version1Array.length; i++) { if (Long.parseLong(version1Array[i]) \u003e 0) { return 1; } } for (int i = index; i \u003c version2Array.length; i++) { if (Long.parseLong(version2Array[i]) \u003e 0) { return -1; } } return 0; } else { return diff \u003e 0 ? 1 : -1; } } base64编码和解码 1 2 3 4 5 6 7 8 9 final Base64.Decoder decoder = Base64.getDecoder(); final Base64.Encoder encoder = Base64.getEncoder(); final String text = \"字串文字\"; final byte[] textByte = text.getBytes(\"UTF-8\"); //编码 final String encodedText = encoder.encodeToString(textByte); System.out.println(encodedText); //解码 System.out.println(new String(decoder.decode(encodedText), \"UTF-8\")); 读取pdf内容 文本内容提取: pom引入\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 org.apache.pdfbox pdfbox 2.0.15 org.apache.pdfbox fontbox 2.0.15 org.apache.pdfbox jempbox 1.8.16 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 /** * 读PDF文件 * @param fileName */ public static void readPDF(String fileName) { File file = new File(fileName); FileInputStream in = null; try { PDDocument document=PDDocument.load(file); // 获取页码 int pages = document.getNumberOfPages(); // 读文本内容 PDFTextStripper stripper=new PDFTextStripper(); // 设置按顺序输出 stripper.setSortByPosition(true); stripper.setStartPage(1); stripper.setEndPage(pages); String content = stripper.getText(document); System.out.println(content); //可选，将pdf内容写入到txt文本文件 // FileWriter fileWriter = new FileWriter(new File(\"pdf.txt\")); // fileWriter.write(content); // fileWriter.flush(); // fileWriter.close(); } catch (Exception e) { System.out.println(\"读取PDF文件\" + file.getAbsolutePath() + \"失败！\" + e); e.printStackTrace(); } finally { if (in != null) { try { in.close(); } catch (IOException e1) { } } } } Java实现Office系列文件转PDF文件 官网下载jar包 百度网盘下载破解包 官网下载的有水印，不过是最新版，破解的是比较旧的版本，不过都能用。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 package com.archive.util.AsposeUtil; import java.io.*; import com.aspose.cells.Workbook; import com.aspose.slides.Presentation; import com.aspose.words.Document; import com.aspose.words.SaveFormat; import com.aspose.words.License; /** * @author: wjy * @Date: Create in 14:28 2019/10/31 * @description : Office系列文件转PDF文件工具类 */ public class AsposeUtil { //直接把凭证内容写进来，省的读取本地文件 private static final String licenseStr = \"\" + \" \" + \" \" + \" Aspose.Total for Java\" + \" \" + \" Enterprise\" + \" 20991231\" + \" 20991231\" + \" 8bfe198c-7f0c-4ef8-8ff0-acc3237bf0d7\" + \" \" + \" sNLLKGMUdF0r8O1kKilWAGdgfs2BvJb/2Xp8p5iuDVfZXmhppo+d0Ran1P9TKdjV4ABwAgKXxJ3jcQTqE/2IRfqwnPf8itN8aFZlV3TJPYeD3yWE7IT55Gz6EijUpC7aKeoohTb4w2fpox58wWoF3SNp6sK6jDfiAUGEHYJ9pjU=\" + \"\"; /** * 获取word、excel、ppt的license */ private static boolean getLicense(int type) { boolean result = false; try { InputStream license = new ByteArrayInputStream(licenseStr.getBytes(\"UTF-8\")); //也可以读取本地文件license.xml //InputStream license = new FileInputStream(new File(\"E:\\\\IDEA2017\\\\something2pdf-demo\\\\src\\\\main\\\\resources\\\\license.xml\")); switch(type){ case 1://word License wordLicense = new License(); wordLicense.setLicense(license); break; case 2://excel com.aspose.cells.License excelLicense = new com.aspose.cells.License(); excelLicense.setLicense(license); break; case 3://ppt com.aspose.slides.License pptLicense = new com.aspose.slides.License(); pptLicense.setLicense(license); break; default: break; } result = true; } catch (Exception e) { e.printStackTrace(); } return result; } /** * word转pdf */ public static void doc2pdf(String outputPath,String inputPath) { //验证License 若不验证则转化出的pdf文档会有水印产生 if (!getLicense(1)) return; try { //pdf输出路径 FileOutputStream os = new FileOutputStream(new File(outputPath)); //word文件路径，即本地word文件路径 Document doc = new Document(inputPath); //这里也可以获取上传的文件 //Document doc = new Document(multipartFile.getInputStream()); //保存转换的pdf文件 doc.save(os, SaveFormat.PDF); os.close(); } catch (Exception e) { e.printStackTrace(); } } /** * excel转pdf */ public static void excel2pdf(String outputPath,String inputPath) { // 验证License 若不验证则转化出的pdf文档会有水印产生 if (!getLicense(2)) return; try { //pdf输出路径 File file = new File(outputPath); FileOutputStream os = new FileOutputStream(file); //excel输入路径，即本地excel文件路径 Workbook wb = new Workbook(inputPath); wb.save(os, com.aspose.cells.SaveFormat.PDF); os.close(); } catch (Exception e) { e.printStackTrace(); } } /** * ppt转pdf */ public static void ppt2pdf(String outputPath,String inputPath) { // 验证License if (!getLicense(3)) return; try { //pdf输出路径 File file = new File(outputPath); //ppt输入路径，即本地ppt文件路径 Presentation pres = new Presentation(inputPath); FileOutputStream fileOS = new FileOutputStream(file); pres.save(fileOS, com.aspose.slides.SaveFormat.Pdf); fileOS.close(); } catch (Exception e) { e.printStackTrace(); } } public static void main(String[] args) { AsposeUtil.doc2pdf(\"D:\\\\doc2pdf.pdf\",\"C:\\\\Users\\\\wjy\\\\Desktop\\\\测试word.docx\"); AsposeUtil.excel2pdf(\"D:\\\\excel2pdf.pdf\",\"C:\\\\Users\\\\wjy\\\\Desktop\\\\测试excel.xlsx\"); AsposeUtil.ppt2pdf(\"D:\\\\ppt2pdf.pdf\",\"C:\\\\Users\\\\wjy\\\\Desktop\\\\测试ppt.pptx\"); } } maven仓库里没有这三个包。需要自己下载，然后放到项目里，或放到自己的maven仓库里。 而且new License()和SaveFormat两个方法，三个包的名字是相同的，所以只能倒一个包，剩下两个写全路径。\n三个包名： aspose-cells-18.9.jarexcel转pdf aspose-slides-19.6.jarppt转pdf aspose-words-16.8.0-jdk16.jarword转pdf\nwords转pdf参考 参考地址 如何破解\nPDF转图片 Apache PDFBox®库是一个用于处理PDF文档的开源Java工具。 官网：https://pdfbox.apache.org/\n1 2 3 4 5 org.apache.pdfbox pdfbox 2.0.22 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // dpi，和图片的分辨率和清晰度成正比 private static final int WORD_DPI = 700; // 和图片清晰度成正比 private static final int PDF_DPI = 100; // 图片的格式 private static final String IMG_TYPE = \"png\"; // ppt转图片，放大的倍数，和越清晰成正比 private static final int MAGNIFICATION = 5; /** * pdf 转 OutputStream */ public static List pdfToOutputStream(MultipartFile multipartFile) throws IOException { List byteArrayOutputStreams = new ArrayList\u003c\u003e(); ByteArrayOutputStream byteArrayOutputStream = null; try (InputStream inputStream = multipartFile.getInputStream(); PDDocument document = PDDocument.load(inputStream)){ PDFRenderer pdfRenderer = new PDFRenderer(document); for (int i = 0; i \u003c document.getPages().getCount(); i++) { byteArrayOutputStream = new ByteArrayOutputStream(); ImageIO.write(pdfRenderer.renderImageWithDPI(i, PDF_DPI), IMG_TYPE, byteArrayOutputStream); byteArrayOutputStreams.add(byteArrayOutputStream); } } catch (IOException e) { e.printStackTrace(); } finally { byteArrayOutputStream.close(); } return byteArrayOutputStreams; } ppt转图片 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 // dpi，和图片的分辨率和清晰度成正比 private static final int WORD_DPI = 700; // 和图片清晰度成正比 private static final int PDF_DPI = 100; // 图片的格式 private static final String IMG_TYPE = \"png\"; // ppt转图片，放大的倍数，和清晰度成正比 private static final int MAGNIFICATION = 5; /** * ppt 转 OutputStream */ public static List pptToOutputStream(MultipartFile multipartFile) throws IOException { List byteArrayOutputStreams = new ArrayList\u003c\u003e(); XMLSlideShow xmlSlideShow = new XMLSlideShow(multipartFile.getInputStream()); // 获取页面大小 Dimension size = xmlSlideShow.getPageSize(); // 获取幻灯片 List slides = xmlSlideShow.getSlides(); ByteArrayOutputStream byteArrayOutputStream = null; try { for (XSLFSlide slide : slides) { List shapes = slide.getShapes(); handleMessyCode(shapes); BufferedImage bufferedImage = new BufferedImage(size.width * MAGNIFICATION, size.height * MAGNIFICATION, BufferedImage.TYPE_INT_RGB); Graphics2D graphics = bufferedImage.createGraphics(); graphics.setPaint(Color.white); // 将图片放大 graphics.scale(MAGNIFICATION, MAGNIFICATION); graphics.fill(new Rectangle2D.Float(0, 0, size.width, size.height)); // 画 slide.draw(graphics); byteArrayOutputStream = new ByteArrayOutputStream(); ImageIO.write(bufferedImage, IMG_TYPE, byteArrayOutputStream); byteArrayOutputStreams.add(byteArrayOutputStream); } } catch (IOException e) { e.printStackTrace(); } finally { byteArrayOutputStream.close(); } return byteArrayOutputStreams; } /** * 解决乱码问题 */ private static void handleMessyCode(List shapes) { for (XSLFShape shape : shapes) { if (shape instanceof XSLFTextShape) { XSLFTextShape sh = (XSLFTextShape) shape; List textParagraphs = sh.getTextParagraphs(); for (XSLFTextParagraph xslfTextParagraph : textParagraphs) { List textRuns = xslfTextParagraph.getTextRuns(); for (XSLFTextRun xslfTextRun : textRuns) { xslfTextRun.setFontFamily(\"宋体\"); } } } } } aspose 破解 官网：https://www.aspose.com/ 破解之前，先从官网把jar包下载到本地。上传到阿里云效maven仓库，或者把jar包直接导入到idea中。\n参考 ：https://juejin.cn/post/7034415238602555405\naspose 的所有工具破解的思路都是一样的，就是分析加载证书的代码。\n1 2 License license = new License(); license.setLicense(); Aspose.PDF for Java 21.11 破解 分析代码 直接调用授权方法，注意每种 aspose 工具的 License 类的包路径是不同的。\n1 2 License license = new License(); license.setLicense(); 分析License类的setLicense()方法，发现setLicense()的两个重载方法都执行了如下代码：\n1 2 l9f var10 = new l9f(); var10.lI(var9); 进入l9f类的lT方法，仔细观察发现这个方法就是验证的，主要是做验证失败抛异常和添加一些标识，好像只有最后一段代码是通过验证：\n1 2 3 this.l0if = l10if.lf; Helper.help1(); lI(this); 所以需要把这个方法其他代码都删除，只留最后这三行。\n1 2 3 4 5 void lI(InputStream var1) throws Exception { this.l0if = l10if.lf; Helper.help1(); lI(this); } 开始破解 使用Javassist工具修改class字节码文件。\n1 2 3 4 5 org.javassist javassist 3.28.0-GA 修改\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 /** * 破解方式一 */ public static void modifyPDFJar() { try { //这一步是完整的jar包路径,选择自己解压的jar目录 ClassPool.getDefault().insertClassPath(\"C:\\\\Users\\\\123\\\\Desktop\\\\aspose\\\\aspose-slides-22.5-java\\\\lib\\\\aspose-slides-22.5-jdk16.jar\"); CtClass zzZJJClass = ClassPool.getDefault().getCtClass(\"com.aspose.pdf.ADocument\"); //从class对象中解析获取所有方法 CtMethod[] methodA = zzZJJClass.getDeclaredMethods(); for (CtMethod ctMethod : methodA) { //获取方法获取参数类型 CtClass[] ps = ctMethod.getParameterTypes(); //筛选同名方法，入参是Document if (ps.length == 0 \u0026\u0026 (ctMethod.getName().equals(\"lj\") || ctMethod.getName().equals(\"lt\")) ) { ctMethod.setBody(\"{return true;}\"); } if (ps.length == 1 \u0026\u0026 (ctMethod.getName().equals(\"lI\")) \u0026\u0026 ps[0].getName().equals(\"com.aspose.pdf.internal.l10k.ly\")) { ctMethod.setBody(\"{return true;}\"); } } //这一步就是将破译完的代码放在桌面上 zzZJJClass.writeFile(\"C:\\\\Users\\\\123\\\\Desktop\\\\testAspose\"); } catch (Exception e) { System.out.println(\"错误==\" + e); } } /** * 破解方式二 */ public static void modifyPDFJar() { try { //这一步是完整的jar包路径,选择自己解压的jar目录 ClassPool.getDefault().insertClassPath(\"D:\\\\aspose.pdf-21.11-java\\\\lib\\aspose.pdf-21.11.jar\"); //获取指定的class文件对象 CtClass zzZJJClass = ClassPool.getDefault().getCtClass(\"com.aspose.pdf.l9f\"); //从class对象中解析获取所有方法 CtMethod[] methodA = zzZJJClass.getDeclaredMethods(); for (CtMethod ctMethod : methodA) { //获取方法获取参数类型 CtClass[] ps = ctMethod.getParameterTypes(); //筛选同名方法，入参是Document if (ps.length == 1 \u0026\u0026 ctMethod.getName().equals(\"lI\") \u0026\u0026 ps[0].getName().equals(\"java.io.InputStream\")) { System.out.println(\"ps[0].getName==\" + ps[0].getName()); //替换指定方法的方法体 ctMethod.setBody(\"{this.l0if = com.aspose.pdf.l10if.lf;com.aspose.pdf.internal.imaging.internal.p71.Helper.help1();lI(this);}\"); } } //这一步就是将破译完的代码放在桌面上 zzZJJClass.writeFile(\"C:\\\\Users\\\\wjy\\\\Desktop\\\\\"); } catch (Exception e) { System.out.println(\"错误==\" + e); } } 运行修改方法后会在桌面生成 com 修改后的文件夹。\n修改jar包里的class。 用解压工具预览jar包（不是解压，是预览），将我们刚才修改好的class文件，直接替换到jar包中。注意路径要正确，比如刚才修改的类l9f的路径是com.aspose.pdf.l9f。我们把class文件放到对应路径，会提示：是否替换。点是，直接替换。\n然后删除 jar包里面的.RSA和.SF文件。破解完毕。 重新导入jar包到项目里，测试一下是否成功。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 private static void pdfToSvg() { // 这一行是加载许可证，看情况加或不加。 // try { // getLicense(); // } catch (IOException e) { // e.printStackTrace(); // } // pdf String pdfFileName = \"C:\\\\Users\\\\123\\\\Desktop\\\\新员工入职培训9.26.pdf\"; String svgFileName = \"C:\\\\Users\\\\123\\\\Desktop\\\\pdf_output\\\\pdf_to_svg_out.svg\"; // Load PDF document Document doc = new Document(pdfFileName); // Instantiate an object of SvgSaveOptions SvgSaveOptions saveOptions = new SvgSaveOptions(); // Do not compress SVG image to Zip archive saveOptions.setCompressOutputToZipArchive(false); // Save the output in SVG files doc.save(svgFileName, saveOptions); } Aspose.Slides for Java 21.10 破解 还是分析加载证书的方法：\n1 2 com.aspose.slides.License license = new com.aspose.slides.License(); license.setLicense(byteArrayInputStream); 看下来发现setLicense的两个重载方法最终都调用了43行var7.do(var2); 也就是public类里的 do方法，由于public和do是修饰符，所以先找到上方导入的public类路径 import com.aspose.slides.internal.of.public;，然后进入到依赖引用的of目录去搜索找到public类，然后进入public类看到do方法。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public final void do(InputStream var1) { if (var1 != null) { this.if(var1); this.for(this.for); for(this.do); do(this.int); if(this.new); try = this; native.do(try); } else { try = null; native.do(try); } } 此时不要慌，慢慢分析发现native.do(try);应该是关键代码，继续找到这个方法。\n1 2 3 private static void do(Node var0, Node var1, String[] var2) { try { ...... 方法里面带有RSA这种加密的关键词，所以推测这里就是验证用的方法。也不知道这个方法咋执行的，老方法，直接把这个方法的内容清空。\n1 2 private static void do(Node var0, Node var1, String[] var2) { } 使用 Javassist修改class字节码文件。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 /** * 修改slides.jar包里面的校验 */ public static void modifyPptJar() { try { //这一步是完整的jar包路径,选择自己解压的jar目录 ClassPool.getDefault().insertClassPath(\"D:\\\\aspose-slides-21.10-java\\\\lib\\\\aspose-slides-21.10-jdk16.jar\"); CtClass zzZJJClass = ClassPool.getDefault().getCtClass(\"com.aspose.slides.internal.of.public\"); CtMethod[] methodA = zzZJJClass.getDeclaredMethods(); for (CtMethod ctMethod : methodA) { CtClass[] ps = ctMethod.getParameterTypes(); if (ps.length == 3 \u0026\u0026 ctMethod.getName().equals(\"do\")) { System.out.println(\"ps[0].getName==\" + ps[0].getName()); ctMethod.setBody(\"{}\"); } } //这一步就是将破译完的代码放在桌面上 zzZJJClass.writeFile(\"C:\\\\Users\\\\roc\\\\Desktop\\\\\"); } catch (Exception e) { System.out.println(\"错误==\" + e); } } 然后按照路径将我们生成的 class 文件替换到 jar包的对应路径，并且删除jar包里面的.RSA和.SF文件。然后重新导入jar包测试。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 private static void pptToSvg() { // instantiate a Presentation object that represents a PPTX file Presentation pres = new Presentation(\"C:\\\\Users\\\\123\\\\Desktop\\\\第四单元 综合性学习 走进小说天地(共14张PPT).ppt\"); try { ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(licenseStr.getBytes(\"UTF-8\")); com.aspose.slides.License license = new com.aspose.slides.License(); license.setLicense(byteArrayInputStream); SVGOptions svgOptions = new SVGOptions(); svgOptions.setPicturesCompression(0); int a = 0; for (ISlide i : pres.getSlides()) { // Access the first slide ISlide sld = i; // Create a memory stream object FileOutputStream svgStream = new FileOutputStream(\"C:\\\\Users\\\\123\\\\Desktop\\\\ppt_output\\\\output\"+ a +\" .svg\"); // Create SVG image of slide and save in memory stream sld.writeAsSvg(svgStream,svgOptions); svgStream.close(); a++; } } catch (IOException e) { } finally { pres.dispose(); } } 成功！\n使用Serverless将OSS文件打包下载 如果不使用serverless，想要打包下载阿里云OSS的文件，思路是：\n首先拿到想要下载的文件的oss url列表。 然后通过流读取oss文件到内存 将文件在内存中打包成ZIP 通过HttpServletResponse 响应给前端 这样的缺点是：\n通过url 从 oss 读取文件很耗时，oss 内网地址还好，如果是 oss 公网地址，还会消耗服务器的入口带宽。 通过HttpServletResponse 响应给前端，非常消耗服务器的出口带宽。 实现代码如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 public static void downZip(List urlList,List fileNameList,HttpServletRequest request, HttpServletResponse response) { try { String fileName = \"stzy.zip\"; // 创建临时文件 File zipFile = File.createTempFile(\"stzy\", \".zip\"); FileOutputStream f = new FileOutputStream(zipFile); //作用是为任何OutputStream产生校验 //第一个参数是制定产生校验和的输出流，第二个参数是指定Checksum的类型 （Adler32（较快）和CRC32两种） CheckedOutputStream csum = new CheckedOutputStream(f, new Adler32()); //用于将数据压缩成Zip文件格式 ZipOutputStream zos = new ZipOutputStream(csum); for (int i = 0; i \u003c urlList.size(); i++) { InputStream inputStream = loadFileFromUrl(urlList.get(i)); //zip设置文件名 zos.putNextEntry(new ZipEntry(fileNameList.get(i) + \".\" + FileTypeUtil.getFileExtName(urlList.get(i)))); int bytesRead = 0; // 向压缩文件中输出数据 while ((bytesRead = inputStream.read()) != -1) { zos.write(bytesRead); } inputStream.close(); // 当前文件写完，定位为写入下一条项目 zos.closeEntry(); } zos.close(); String header = request.getHeader(\"User-Agent\").toUpperCase(); if (header.contains(\"MSIE\") || header.contains(\"TRIDENT\") || header.contains(\"EDGE\")) { fileName = URLEncoder.encode(fileName, \"utf-8\"); //IE下载文件名空格变+号问题 fileName = fileName.replace(\"+\", \"%20\"); } else { fileName = new String(fileName.getBytes(), \"ISO8859-1\"); } response.reset(); response.setContentType(\"text/plain\"); response.setContentType(\"application/octet-stream; charset=utf-8\"); response.setHeader(\"Location\", fileName); response.setHeader(\"Cache-Control\", \"max-age=0\"); response.setHeader(\"Content-Disposition\", \"attachment; filename=\" + fileName); FileInputStream fis = new FileInputStream(zipFile); BufferedInputStream buff = new BufferedInputStream(fis); BufferedOutputStream out = new BufferedOutputStream(response.getOutputStream()); byte[] car = new byte[1024]; int l = 0; while (l \u003c zipFile.length()) { int j = buff.read(car, 0, 1024); l += j; out.write(car, 0, j); } // 关闭流 fis.close(); buff.close(); out.close(); // 删除临时文件 zipFile.delete(); } catch (IOException e) { e.printStackTrace(); } } 使用函数计算打包下载OSS文件 需要注意：阿里云函数计算是收费的，不过有每月免费次数和流量。\n官网的方法 https://www.alibabacloud.com/help/zh/object-storage-service/latest/use-function-compute-to-download-multiple-objects-as-a-package 然而官方给的方法只能打包下载指定路径下的文件。我期望的是，指定几个oss文件的url，就可以直接下载。\n参考：https://blog.csdn.net/whzhaochao/article/details/119823374\n创建Maven项目，添加阿里云函数计算依赖 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 com.aliyun.fc.runtime fc-java-core 1.4.0 com.aliyun.fc.runtime fc-java-common 2.2.2 commons-io commons-io 2.11.0 zip-oss org.apache.maven.plugins maven-dependency-plugin copy-dependencies prepare-package copy-dependencies ${project.build.directory}/classes/lib runtime 实现Http触发接口 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 package com.wjy.makezip; import com.aliyun.fc.runtime.Context; import com.aliyun.fc.runtime.Credentials; import com.aliyun.fc.runtime.HttpRequestHandler; import com.aliyun.oss.*; import com.aliyun.oss.internal.OSSHeaders; import com.aliyun.oss.model.*; import org.apache.commons.io.IOUtils; import org.apache.commons.lang.StringUtils; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.IOException; import java.io.OutputStream; import java.time.LocalDate; import java.util.UUID; import java.util.zip.ZipEntry; import java.util.zip.ZipOutputStream; /** * @author: wjy * @Date: Create in 14:48 2022/5/31 * @description : */ public class App implements HttpRequestHandler { public static final String endpoint = \"oss-cn-beijing-internal.aliyuncs.com\"; public static final String bucket = \"zw-zhizhi\"; // bucket 后的第一个文件夹名 public static final String filePath = \"zipFile\"; // 文件扩展名 public static final String extName = \"zip\"; public static final String filePrefix = \"https://zw-zhizhi.oss-cn-beijing.aliyuncs.com\"; /** * 返回 文件url * 必须重写 handleRequest 方法 */ @Override public void handleRequest(HttpServletRequest request, HttpServletResponse response, Context context) throws IOException { String objectKey = request.getParameter(\"q\"); if (StringUtils.isBlank(objectKey)) { return ; } OSS oss = getOssClient(context); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ZipOutputStream zipOutputStream = new ZipOutputStream(byteArrayOutputStream); String[] objectKeys = objectKey.split(\",\"); for (String key : objectKeys) { // stzy/163/2022-06-15/0bddb05d-bb0d-4821-a4e0-4ad36ca04d32/abc.pptx // 因为 key 是有层级的，但是这里我不想要层级，所以直接对oss的objectKey进行处理 // 如果ZIP包需要层级，则不处理objectKey OSSObject ossObject = oss.getObject(bucket, key); if (ossObject == null) { continue; } ZipEntry zipEntry = new ZipEntry(getFileName(key)); zipOutputStream.putNextEntry(zipEntry); IOUtils.copy(ossObject.getObjectContent(), zipOutputStream); ossObject.close(); } zipOutputStream.closeEntry(); zipOutputStream.finish(); byteArrayOutputStream.close(); String fileUrl = uploadToOss(oss, byteArrayOutputStream.toByteArray()); response.setCharacterEncoding(\"UTF-8\"); response.setHeader(\"Content-Type\", \"application/json\"); response.setHeader(\"Access-Control-Allow-Credentials\", \"true\"); response.setHeader(\"Access-Control-Allow-Methods\", \"GET, POST\"); response.setHeader(\"Access-Control-Allow-Origin\", \"*\"); response.setHeader(\"Access-Control-Max-Age\", \"3600\"); response.setStatus(HttpServletResponse.SC_OK); response.setContentType(\"application/json;charset=UTF-8\"); OutputStream out = response.getOutputStream(); out.write((fileUrl).getBytes()); out.flush(); out.close(); } private OSS getOssClient(Context context) { // 获取oss凭据 Credentials creds = context.getExecutionCredentials(); return new OSSClientBuilder().build(endpoint, \"你的accessKey\", \"你的secretAccess\"); } /** * 直接返回流，不推荐 * 会走公网带宽，很贵 */ public void getZipOutPutStream(HttpServletRequest request, HttpServletResponse response, Context context) throws IOException { String objectKey = request.getParameter(\"q\"); if (StringUtils.isBlank(objectKey)) { return; } // 获取oss凭据 Credentials creds = context.getExecutionCredentials(); OSS oss = new OSSClientBuilder().build(endpoint, creds.getAccessKeyId(), creds.getAccessKeySecret()); response.setContentType(\"application/x-zip-compressed\"); ZipOutputStream zipOutputStream = new ZipOutputStream(response.getOutputStream()); String[] objectKeys = objectKey.split(\",\"); for (String key : objectKeys) { // stzy/163/2022-06-15/0bddb05d-bb0d-4821-a4e0-4ad36ca04d32/abc.pptx // 因为 key 是有层级的，但是这里我不想要层级，所以直接对oss的objectKey进行处理 // 如果ZIP包需要层级，则不处理objectKey OSSObject ossObject = oss.getObject(bucket, key); if (ossObject == null) { continue; } ZipEntry zipEntry = new ZipEntry(getFileName(key)); zipOutputStream.putNextEntry(zipEntry); IOUtils.copy(ossObject.getObjectContent(), zipOutputStream); ossObject.close(); } zipOutputStream.closeEntry(); zipOutputStream.finish(); } /** * 根据文件路径，获取文件名 * stzy/163/2022-06-15/0bddb05d-bb0d-4821-a4e0-4ad36ca04d32/abc.pptx * abc.pptx */ public static String getFileName(String filePath) { String[] split = filePath.split(\"/\"); return split[split.length - 1]; } /** * byte数组上传到oss */ public String uploadToOss(OSS oss, byte[] bytes) { String objectName = getObjectName(extName, oss); try { ObjectMetadata metadata = new ObjectMetadata(); metadata.setHeader(OSSHeaders.OSS_STORAGE_CLASS, StorageClass.Standard.toString()); //设置可读 metadata.setObjectAcl(CannedAccessControlList.PublicRead); // 创建PutObjectRequest对象。 PutObjectRequest putObjectRequest = new PutObjectRequest(bucket, objectName , new ByteArrayInputStream(bytes), metadata); // 上传文件。 oss.putObject(putObjectRequest); // 返回可访问的url return filePrefix + \"/\" + objectName; } catch (OSSException oe) { oe.printStackTrace(); } catch (ClientException ce) { ce.printStackTrace(); } finally { if (oss != null) { oss.shutdown(); } } return \"\"; } /** * 获取oss 文件名 */ private String getObjectName(String fileExtName, OSS oss) { String uuid = UUID.randomUUID().toString().replace(\"-\", \"\"); // 生成新的随机文件名 String newFileName = uuid + \".\" + fileExtName; // 拼接文件夹路径 zhizhitest/2022-02-09 String dirPath = filePath + \"/\" + LocalDate.now(); // 文件完整路径 zhizhitest/2022-02-09/1.png String objectName = dirPath + \"/\" + newFileName; return objectName; } public static void main(String[] args) { System.out.println(getFileName(\"stzy/163/2022-06-15/0bddb05d-bb0d-4821-a4e0-4ad36ca04d32/abc.pptx\")); } } 打包 mvn clean package\n登录阿里云 搜索函数计算FC。开通过程此处省略。\n左侧服务及函数\n创建服务\n创建好之后点服务名\n创建函数，选从零开始创建函数，然后按照提示，一步一步选择 函数名：按需填写，见名知意 运行环境：JAVA8 代码上传方式：通过JAR包上传，然后上传刚才打好的JAR包 请求处理程序类型：处理 HTTP 请求 请求处理程序：com.wjy.makezip.App::handleRequest 配置触发器：名字、不认证、请求方法get、post。\n然后点刚才创建的函数，点触发器管理，可以看到刚才创建的HTTP触发器，还有公网地址： https://makezip-oss-service-apnellxecm.cn-beijing.fcapp.run\n配置自定义域名 (aliyun.com) 必须配置，不然无法通过http请求直接响应json。官方解释： 如果您在浏览器中直接打开请求地址，将会以附件的方式下载响应。这是因为 Http 触发器会自动在响应头中添加 Content-Disposition: attachment 字段。您可以使用自定义域名避免该问题。\n自定义域名复制到浏览器，然后在链接后加上我们程序需要的参数： https://fc.stzy.com/?q=xxx.docx,123.svg,999.png 直接返回了oss地址，成功！\n阿里云Serverless回调 使用函数计算进行oss文件打包时，遇到一个问题，如果需要将很多的文件进行打包，那么单次请求的相应时间是很长的，可能长达数分钟。这对于用户端来说是不能接受的，前端请求的接口会一直pending，甚至有可能超时。\n解决思路自然是，我不等待函数计算的同步结果，期望函数计算打包完成后，能够通过回调的方式，通知到我自己的服务器，将打包的地址告诉我，我再将地址更新到数据库中。\n阿里云的函数计算还真提供了这个功能：\nhttps://help.aliyun.com/zh/fc/user-guide/result-callback\n支持的异步调用目标服务：\n消息服务MNS 函数计算 事件总线EventBridge 消息队列RocketMQ版 我使用的是回调到函数计算。即函数计算A成功后，回调函数计算B。函数计算B是我自己在本地用spring boot 搭建的一个单体应用，需要具备访问数据库（更新数据状态）、nacos（获取配置）、oss（获取oss文件的大小）的功能。\n特别注意：触发函数A时，我使用的是http触发器，要想让函数A成功后回调函数B，在请求函数A时，就需要http触发器的异步调用方式。\n参考官方文档：https://help.aliyun.com/zh/fc/overview-36\n即增加请求头：\"X-Fc-Invocation-Type\":\"Async\"\n我不知道为什么写文档的人不把这个需求写在结果回调的文档页面。\n其他步骤如何实施，参考官方文档。\n字节工具类 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 public class ByteUtil { public static void main(String[] args) { System.out.println(bytesToMb(20916274L)); } public static final Integer KB_SIZE = 2 \u003c\u003c 9; public static final Integer MB_SIZE = 2 \u003c\u003c 19; public static final Integer GB_SIZE = 2 \u003c\u003c 29; /** * 字节数转kb */ public static BigDecimal bytesToKb(long bytes) { return bytesToUnit(bytes, KB_SIZE); } /** * 字节数转mb */ public static BigDecimal bytesToMb(long bytes) { return bytesToUnit(bytes, MB_SIZE); } /** * 字节数转gb */ public static BigDecimal bytesToGb(long bytes) { return bytesToUnit(bytes, GB_SIZE); } public static BigDecimal bytesToUnit(long bytes, Integer unit) { BigDecimal size = new BigDecimal(bytes); BigDecimal u = new BigDecimal(unit); return size.divide(u, 2, BigDecimal.ROUND_DOWN); } public static Long unitToByte(BigDecimal decimal, Integer unit) { return decimal.multiply(BigDecimal.valueOf(unit)).longValue(); } public static Long kbToByte(BigDecimal decimal) { return decimal.multiply(BigDecimal.valueOf(KB_SIZE)).longValue(); } public static Long mbToByte(BigDecimal decimal) { return decimal.multiply(BigDecimal.valueOf(MB_SIZE)).longValue(); } public static Long gbToByte(BigDecimal decimal) { return decimal.multiply(BigDecimal.valueOf(GB_SIZE)).longValue(); } } 工具类 Collections Collections中的方法大部分不建议使用。例如：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 Collections.sort(list);//升序 Collections.reverse(list);//降序 Integer max = Collections.max(list);//获取最大值 Integer min = Collections.min(list);//获取最小值 List integers = Collections.synchronizedList(list);//将ArrayList转换成线程安全集合 Collections.emptyList(); Collections.binarySearch(list, 3);//二分查找 // 转换成不可修改集合 List integers = Collections.unmodifiableList(list); CollectionUtils spring的org.springframework.util包下的CollectionUtils工具类和apache的org.apache.commons.collections包下的CollectionUtils工具类。更推荐使用apache的包下的CollectionUtils工具类，因为它的工具更多更全面。\n2.1 集合判空 通过CollectionUtils工具类的isEmpty方法可以轻松判断集合是否为空，isNotEmpty方法判断集合不为空。\n1 2 3 4 5 6 7 8 9 10 11 12 List list = new ArrayList\u003c\u003e(); list.add(2); list.add(1); list.add(3); if (CollectionUtils.isEmpty(list)) { System.out.println(\"集合为空\"); } if (CollectionUtils.isNotEmpty(list)) { System.out.println(\"集合不为空\"); } 2.2 对两个集合进行操作 有时候我们需要对已有的两个集合进行操作，比如取交集或者并集等。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 List list = new ArrayList\u003c\u003e(); list.add(2); list.add(1); list.add(3); List list2 = new ArrayList\u003c\u003e(); list2.add(2); list2.add(4); //获取并集 Collection unionList = CollectionUtils.union(list, list2); System.out.println(unionList); //获取交集 Collection intersectionList = CollectionUtils.intersection(list, list2); System.out.println(intersectionList); //获取交集的补集 Collection disjunctionList = CollectionUtils.disjunction(list, list2); System.out.println(disjunctionList); //获取差集 Collection subtractList = CollectionUtils.subtract(list, list2); System.out.println(subtractList); 执行结果：\n1 2 3 4 [1, 2, 3, 4] [2] [1, 3, 4] [1, 3] 说句实话，对两个集合的操作，在实际工作中用得挺多的，特别是很多批量的场景中。以前我们需要写一堆代码，但没想到有现成的轮子。\nLists 3.1 创建空集合 有时候，我们想创建一个空集合。这时可以用Lists的newArrayList方法，例如：\n1 List list = Lists.newArrayList(); 3.2 快速初始化集合 有时候，我们想给一个集合中初始化一些元素。这时可以用Lists的newArrayList方法，例如：\n1 List list = Lists.newArrayList(1, 2, 3); 执行结果：\n1 [1, 2, 3] 3.3 笛卡尔积 如果你想将两个集合做笛卡尔积，Lists的cartesianProduct方法可以帮你实现：\n1 2 3 4 List list1 = Lists.newArrayList(1, 2, 3); List list2 = Lists.newArrayList(4,5); List",
  "wordCount" : "17643",
  "inLanguage": "en",
  "datePublished": "2020-01-11T10:27:48Z",
  "dateModified": "2020-01-11T10:27:48Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://wjy6.netlify.app/posts/java/kit/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://wjy6.netlify.app/favicon.ico"
    }
  }
}
</script>

  <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.min.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath:  [['\\(', '\\)'], ['$', '$']],  
    }
  };
</script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://wjy6.netlify.app/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://wjy6.netlify.app/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://wjy6.netlify.app/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://wjy6.netlify.app/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://wjy6.netlify.app/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://wjy6.netlify.app/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://wjy6.netlify.app/">Home</a>&nbsp;»&nbsp;<a href="https://wjy6.netlify.app/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      kit
    </h1>
    <div class="post-meta"><span title='2020-01-11 10:27:48 +0000 UTC'>2020-01-11</span>&nbsp;·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#ffmpeg%e4%bd%bf%e7%94%a8" aria-label="ffmpeg使用">ffmpeg使用</a><ul>
                        
                <li>
                    <a href="#%e9%9f%b3%e9%a2%91%e6%96%87%e4%bb%b6%e8%bd%acwav%e6%a0%bc%e5%bc%8f" aria-label="音频文件转wav格式">音频文件转wav格式</a></li>
                <li>
                    <a href="#%e9%9f%b3%e9%a2%91%e5%88%87%e5%89%b2" aria-label="音频切割">音频切割</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%9c%a8%e5%9b%be%e7%89%87%e4%b8%8a%e5%86%99%e5%ad%97" aria-label="在图片上写字">在图片上写字</a><ul>
                        
                <li>
                    <a href="#%e6%8a%8a%e5%ad%97%e5%86%99%e5%88%b0%e5%b7%b2%e5%ad%98%e5%9c%a8%e7%9a%84%e5%9b%be%e7%89%87%e4%b8%8a" aria-label="把字写到已存在的图片上">把字写到已存在的图片上</a></li>
                <li>
                    <a href="#%e8%bf%9b%e9%98%b6%e6%96%87%e5%ad%97%e8%87%aa%e5%8a%a8%e6%8d%a2%e8%a1%8c" aria-label="进阶，文字自动换行">进阶，文字自动换行</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%a3%81%e5%89%aa%e5%9b%be%e7%89%87%e7%a9%ba%e7%99%bd%e5%8c%ba%e5%9f%9f" aria-label="裁剪图片空白区域">裁剪图片空白区域</a></li>
                <li>
                    <a href="#%e5%b7%a5%e5%85%b7%e7%b1%bb" aria-label="工具类">工具类</a><ul>
                        
                <li>
                    <a href="#%e6%97%b6%e9%97%b4" aria-label="时间">时间</a><ul>
                        
                <li>
                    <a href="#%e5%88%a4%e6%96%ad%e4%b8%a4%e4%b8%aa%e6%97%b6%e9%97%b4%e6%88%b3%e6%98%af%e5%90%a6%e6%98%af%e5%90%8c%e4%b8%80%e5%a4%a9" aria-label="判断两个时间戳是否是同一天">判断两个时间戳是否是同一天</a></li>
                <li>
                    <a href="#%e8%ae%a1%e7%ae%97%e4%b8%a4%e4%b8%aa%e6%97%b6%e9%97%b4%e6%88%b3%e5%b7%ae%e5%80%bc%e7%a7%92%e7%ba%a7%e6%97%b6%e9%97%b4%e6%88%b3" aria-label="计算两个时间戳差值(秒级时间戳)">计算两个时间戳差值(秒级时间戳)</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2" aria-label="字符串">字符串</a><ul>
                        
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%8e%92%e5%ba%8f" aria-label="字符串排序">字符串排序</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%88%a4%e6%96%ad%e7%89%88%e6%9c%ac%e5%8f%b7" aria-label="判断版本号">判断版本号</a></li>
                <li>
                    <a href="#base64%e7%bc%96%e7%a0%81%e5%92%8c%e8%a7%a3%e7%a0%81" aria-label="base64编码和解码">base64编码和解码</a></li>
                <li>
                    <a href="#%e8%af%bb%e5%8f%96pdf%e5%86%85%e5%ae%b9" aria-label="读取pdf内容">读取pdf内容</a></li></ul>
                </li>
                <li>
                    <a href="#java%e5%ae%9e%e7%8e%b0office%e7%b3%bb%e5%88%97%e6%96%87%e4%bb%b6%e8%bd%acpdf%e6%96%87%e4%bb%b6" aria-label="Java实现Office系列文件转PDF文件">Java实现Office系列文件转PDF文件</a></li>
                <li>
                    <a href="#pdf%e8%bd%ac%e5%9b%be%e7%89%87" aria-label="PDF转图片">PDF转图片</a></li>
                <li>
                    <a href="#ppt%e8%bd%ac%e5%9b%be%e7%89%87" aria-label="ppt转图片">ppt转图片</a></li>
                <li>
                    <a href="#aspose-%e7%a0%b4%e8%a7%a3" aria-label="aspose 破解">aspose 破解</a><ul>
                        
                <li>
                    <a href="#asposepdf-for-java-2111-%e7%a0%b4%e8%a7%a3" aria-label="Aspose.PDF for Java 21.11 破解">Aspose.PDF for Java 21.11 破解</a><ul>
                        
                <li>
                    <a href="#%e5%88%86%e6%9e%90%e4%bb%a3%e7%a0%81" aria-label="分析代码">分析代码</a></li>
                <li>
                    <a href="#%e5%bc%80%e5%a7%8b%e7%a0%b4%e8%a7%a3" aria-label="开始破解">开始破解</a></li>
                <li>
                    <a href="#asposeslides-for-java-2110-%e7%a0%b4%e8%a7%a3" aria-label="Aspose.Slides for Java 21.10 破解">Aspose.Slides for Java 21.10 破解</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8serverless%e5%b0%86oss%e6%96%87%e4%bb%b6%e6%89%93%e5%8c%85%e4%b8%8b%e8%bd%bd" aria-label="使用Serverless将OSS文件打包下载">使用Serverless将OSS文件打包下载</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e5%87%bd%e6%95%b0%e8%ae%a1%e7%ae%97%e6%89%93%e5%8c%85%e4%b8%8b%e8%bd%bdoss%e6%96%87%e4%bb%b6" aria-label="使用函数计算打包下载OSS文件">使用函数计算打包下载OSS文件</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%bamaven%e9%a1%b9%e7%9b%ae%e6%b7%bb%e5%8a%a0%e9%98%bf%e9%87%8c%e4%ba%91%e5%87%bd%e6%95%b0%e8%ae%a1%e7%ae%97%e4%be%9d%e8%b5%96" aria-label="创建Maven项目，添加阿里云函数计算依赖">创建Maven项目，添加阿里云函数计算依赖</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0http%e8%a7%a6%e5%8f%91%e6%8e%a5%e5%8f%a3" aria-label="实现Http触发接口">实现Http触发接口</a></li>
                <li>
                    <a href="#%e7%99%bb%e5%bd%95%e9%98%bf%e9%87%8c%e4%ba%91" aria-label="登录阿里云">登录阿里云</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e9%98%bf%e9%87%8c%e4%ba%91serverless%e5%9b%9e%e8%b0%83" aria-label="阿里云Serverless回调">阿里云Serverless回调</a></li>
                <li>
                    <a href="#%e5%ad%97%e8%8a%82%e5%b7%a5%e5%85%b7%e7%b1%bb" aria-label="字节工具类">字节工具类</a></li>
                <li>
                    <a href="#%e5%b7%a5%e5%85%b7%e7%b1%bb-1" aria-label="工具类">工具类</a><ul>
                        
                <li>
                    <a href="#collections" aria-label="Collections">Collections</a></li>
                <li>
                    <a href="#collectionutils" aria-label="CollectionUtils">CollectionUtils</a><ul>
                        
                <li>
                    <a href="#21-%e9%9b%86%e5%90%88%e5%88%a4%e7%a9%ba" aria-label="2.1 集合判空">2.1 集合判空</a></li>
                <li>
                    <a href="#22-%e5%af%b9%e4%b8%a4%e4%b8%aa%e9%9b%86%e5%90%88%e8%bf%9b%e8%a1%8c%e6%93%8d%e4%bd%9c" aria-label="2.2 对两个集合进行操作">2.2 对两个集合进行操作</a></li></ul>
                </li>
                <li>
                    <a href="#lists" aria-label="Lists">Lists</a><ul>
                        
                <li>
                    <a href="#31-%e5%88%9b%e5%bb%ba%e7%a9%ba%e9%9b%86%e5%90%88" aria-label="3.1 创建空集合">3.1 创建空集合</a></li>
                <li>
                    <a href="#32-%e5%bf%ab%e9%80%9f%e5%88%9d%e5%a7%8b%e5%8c%96%e9%9b%86%e5%90%88" aria-label="3.2 快速初始化集合">3.2 快速初始化集合</a></li>
                <li>
                    <a href="#33-%e7%ac%9b%e5%8d%a1%e5%b0%94%e7%a7%af" aria-label="3.3 笛卡尔积">3.3 笛卡尔积</a></li>
                <li>
                    <a href="#34-%e5%88%86%e9%a1%b5" aria-label="3.4 分页">3.4 分页</a></li>
                <li>
                    <a href="#35-%e6%b5%81%e5%a4%84%e7%90%86" aria-label="3.5 流处理">3.5 流处理</a></li>
                <li>
                    <a href="#36-%e9%a2%a0%e5%80%92%e9%a1%ba%e5%ba%8f" aria-label="3.6 颠倒顺序">3.6 颠倒顺序</a></li></ul>
                </li>
                <li>
                    <a href="#objects" aria-label="Objects">Objects</a><ul>
                        
                <li>
                    <a href="#41-%e5%af%b9%e8%b1%a1%e5%88%a4%e7%a9%ba" aria-label="4.1 对象判空">4.1 对象判空</a></li>
                <li>
                    <a href="#42-%e5%af%b9%e8%b1%a1%e4%b8%ba%e7%a9%ba%e6%8a%9b%e5%bc%82%e5%b8%b8" aria-label="4.2 对象为空抛异常">4.2 对象为空抛异常</a></li>
                <li>
                    <a href="#43-%e5%88%a4%e6%96%ad%e4%b8%a4%e4%b8%aa%e5%af%b9%e8%b1%a1%e6%98%af%e5%90%a6%e7%9b%b8%e7%ad%89" aria-label="4.3 判断两个对象是否相等">4.3 判断两个对象是否相等</a></li>
                <li>
                    <a href="#44-%e8%8e%b7%e5%8f%96%e5%af%b9%e8%b1%a1%e7%9a%84hashcode" aria-label="4.4 获取对象的hashCode">4.4 获取对象的hashCode</a></li></ul>
                </li>
                <li>
                    <a href="#stringutils" aria-label="StringUtils">StringUtils</a><ul>
                        
                <li>
                    <a href="#62-%e5%88%86%e9%9a%94%e5%ad%97%e7%ac%a6%e4%b8%b2" aria-label="6.2 分隔字符串">6.2 分隔字符串</a></li>
                <li>
                    <a href="#63-%e5%88%a4%e6%96%ad%e6%98%af%e5%90%a6%e7%ba%af%e6%95%b0%e5%ad%97" aria-label="6.3 判断是否纯数字">6.3 判断是否纯数字</a></li></ul>
                </li>
                <li>
                    <a href="#assert" aria-label="Assert">Assert</a><ul>
                        
                <li>
                    <a href="#71-%e6%96%ad%e8%a8%80%e5%8f%82%e6%95%b0%e6%98%af%e5%90%a6%e4%b8%ba%e7%a9%ba" aria-label="7.1 断言参数是否为空">7.1 断言参数是否为空</a></li>
                <li>
                    <a href="#72-%e6%96%ad%e8%a8%80%e9%9b%86%e5%90%88%e6%98%af%e5%90%a6%e4%b8%ba%e7%a9%ba" aria-label="7.2 断言集合是否为空">7.2 断言集合是否为空</a></li>
                <li>
                    <a href="#73-%e6%96%ad%e8%a8%80%e6%9d%a1%e4%bb%b6%e6%98%af%e5%90%a6%e4%b8%ba%e7%a9%ba" aria-label="7.3 断言条件是否为空">7.3 断言条件是否为空</a></li></ul>
                </li>
                <li>
                    <a href="#mdc" aria-label="MDC">MDC</a></li>
                <li>
                    <a href="#classutils" aria-label="ClassUtils">ClassUtils</a><ul>
                        
                <li>
                    <a href="#101-%e8%8e%b7%e5%8f%96%e5%af%b9%e8%b1%a1%e7%9a%84%e6%89%80%e6%9c%89%e6%8e%a5%e5%8f%a3" aria-label="10.1 获取对象的所有接口">10.1 获取对象的所有接口</a></li>
                <li>
                    <a href="#102-%e8%8e%b7%e5%8f%96%e6%9f%90%e4%b8%aa%e7%b1%bb%e7%9a%84%e5%8c%85%e5%90%8d" aria-label="10.2 获取某个类的包名">10.2 获取某个类的包名</a></li>
                <li>
                    <a href="#103-%e5%88%a4%e6%96%ad%e6%9f%90%e4%b8%aa%e7%b1%bb%e6%98%af%e5%90%a6%e5%86%85%e9%83%a8%e7%b1%bb" aria-label="10.3 判断某个类是否内部类">10.3 判断某个类是否内部类</a></li>
                <li>
                    <a href="#104-%e5%88%a4%e6%96%ad%e5%af%b9%e8%b1%a1%e6%98%af%e5%90%a6%e4%bb%a3%e7%90%86%e5%af%b9%e8%b1%a1" aria-label="10.4 判断对象是否代理对象">10.4 判断对象是否代理对象</a></li></ul>
                </li>
                <li>
                    <a href="#beanutils" aria-label="BeanUtils">BeanUtils</a><ul>
                        
                <li>
                    <a href="#111-%e6%8b%b7%e8%b4%9d%e5%af%b9%e8%b1%a1%e7%9a%84%e5%b1%9e%e6%80%a7" aria-label="11.1 拷贝对象的属性">11.1 拷贝对象的属性</a></li>
                <li>
                    <a href="#112-%e5%ae%9e%e4%be%8b%e5%8c%96%e6%9f%90%e4%b8%aa%e7%b1%bb" aria-label="11.2 实例化某个类">11.2 实例化某个类</a></li>
                <li>
                    <a href="#113-%e8%8e%b7%e5%8f%96%e6%8c%87%e5%ae%9a%e7%b1%bb%e7%9a%84%e6%8c%87%e5%ae%9a%e6%96%b9%e6%b3%95" aria-label="11.3 获取指定类的指定方法">11.3 获取指定类的指定方法</a></li>
                <li>
                    <a href="#114-%e8%8e%b7%e5%8f%96%e6%8c%87%e5%ae%9a%e6%96%b9%e6%b3%95%e7%9a%84%e5%8f%82%e6%95%b0" aria-label="11.4 获取指定方法的参数">11.4 获取指定方法的参数</a></li></ul>
                </li>
                <li>
                    <a href="#reflectionutils" aria-label="ReflectionUtils">ReflectionUtils</a><ul>
                        
                <li>
                    <a href="#121-%e8%8e%b7%e5%8f%96%e6%96%b9%e6%b3%95" aria-label="12.1 获取方法">12.1 获取方法</a></li>
                <li>
                    <a href="#122-%e8%8e%b7%e5%8f%96%e5%ad%97%e6%ae%b5" aria-label="12.2 获取字段">12.2 获取字段</a></li>
                <li>
                    <a href="#123-%e6%89%a7%e8%a1%8c%e6%96%b9%e6%b3%95" aria-label="12.3 执行方法">12.3 执行方法</a></li>
                <li>
                    <a href="#124-%e5%88%a4%e6%96%ad%e5%ad%97%e6%ae%b5%e6%98%af%e5%90%a6%e5%b8%b8%e9%87%8f" aria-label="12.4 判断字段是否常量">12.4 判断字段是否常量</a></li>
                <li>
                    <a href="#125-%e5%88%a4%e6%96%ad%e6%98%af%e5%90%a6equals%e6%96%b9%e6%b3%95" aria-label="12.5 判断是否equals方法">12.5 判断是否equals方法</a></li></ul>
                </li>
                <li>
                    <a href="#base64utils" aria-label="Base64Utils">Base64Utils</a></li>
                <li>
                    <a href="#14-standardcharsets" aria-label="14. StandardCharsets">14. StandardCharsets</a></li>
                <li>
                    <a href="#15-digestutils" aria-label="15. DigestUtils">15. DigestUtils</a><ul>
                        
                <li>
                    <a href="#151-md5%e5%8a%a0%e5%af%86" aria-label="15.1 md5加密">15.1 md5加密</a></li>
                <li>
                    <a href="#152-sha256%e5%8a%a0%e5%af%86" aria-label="15.2 sha256加密">15.2 sha256加密</a></li></ul>
                </li>
                <li>
                    <a href="#serializationutils" aria-label="SerializationUtils">SerializationUtils</a></li>
                <li>
                    <a href="#httpstatus" aria-label="HttpStatus">HttpStatus</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%98%bf%e9%87%8c%e4%ba%91%e8%a7%86%e9%a2%91%e7%82%b9%e6%92%ad" aria-label="阿里云视频点播">阿里云视频点播</a><ul>
                        
                <li>
                    <a href="#hls%e6%a0%87%e5%87%86%e5%8a%a0%e5%af%86" aria-label="HLS标准加密">HLS标准加密</a><ul>
                        
                <li>
                    <a href="#%e5%8a%a0%e5%af%86%e5%8f%8a%e8%a7%a3%e5%af%86%e6%b5%81%e7%a8%8b" aria-label="加密及解密流程">加密及解密流程</a></li>
                <li>
                    <a href="#%e5%89%8d%e6%8f%90%e6%9d%a1%e4%bb%b6%e6%af%8f%e4%b8%80%e6%ad%a5%e9%83%bd%e8%a6%81%e6%89%a7%e8%a1%8c%e4%b8%8d%e7%84%b6%e5%90%8e%e8%be%b9%e8%b0%83%e6%8e%a5%e5%8f%a3%e4%bc%9a%e6%9c%89%e9%97%ae%e9%a2%98" aria-label="前提条件（每一步都要执行，不然后边调接口会有问题）">前提条件（每一步都要执行，不然后边调接口会有问题）</a></li>
                <li>
                    <a href="#%e5%8a%a0%e5%af%86%e8%a7%86%e9%a2%91" aria-label="加密视频">加密视频</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e7%94%a8%e4%ba%8ehls%e6%a0%87%e5%87%86%e5%8a%a0%e5%af%86%e7%9a%84%e8%bd%ac%e7%a0%81%e6%a8%a1%e6%9d%bf%e7%bb%84" aria-label="创建用于HLS标准加密的转码模板组">创建用于HLS标准加密的转码模板组</a></li>
                <li>
                    <a href="#%e6%90%ad%e5%bb%ba%e5%8a%a0%e5%af%86%e6%9c%8d%e5%8a%a1" aria-label="搭建加密服务。">搭建加密服务。</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e4%b8%8d%e8%bd%ac%e7%a0%81%e6%a8%a1%e6%9d%bf%e7%bb%84%e4%b8%8a%e4%bc%a0%e8%a7%86%e9%a2%91" aria-label="使用不转码模板组上传视频。">使用不转码模板组上传视频。</a></li>
                <li>
                    <a href="#%e5%8f%91%e8%b5%b7hls%e6%a0%87%e5%87%86%e5%8a%a0%e5%af%86%e8%bd%ac%e7%a0%81" aria-label="发起HLS标准加密转码。">发起HLS标准加密转码。</a></li>
                <li>
                    <a href="#%e6%9f%a5%e7%9c%8bhls%e6%a0%87%e5%87%86%e5%8a%a0%e5%af%86%e7%bb%93%e6%9e%9c" aria-label="查看HLS标准加密结果。">查看HLS标准加密结果。</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%92%ad%e6%94%behls%e6%a0%87%e5%87%86%e5%8a%a0%e5%af%86%e8%a7%86%e9%a2%91" aria-label="播放HLS标准加密视频">播放HLS标准加密视频</a><ul>
                        
                <li>
                    <a href="#%e6%90%ad%e5%bb%ba%e8%a7%a3%e5%af%86%e6%9c%8d%e5%8a%a1" aria-label="搭建解密服务">搭建解密服务</a></li>
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e8%a7%86%e9%a2%91%e6%92%ad%e6%94%be%e5%9c%b0%e5%9d%80%e5%92%8c%e5%87%ad%e8%af%81" aria-label="获取视频播放地址和凭证">获取视频播放地址和凭证</a></li>
                <li>
                    <a href="#%e6%92%ad%e6%94%be%e5%8a%a0%e5%af%86%e8%a7%86%e9%a2%91" aria-label="播放加密视频">播放加密视频</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a4%9a%e5%9c%b0%e5%9d%80%e5%9b%9e%e8%b0%83" aria-label="多地址回调">多地址回调</a></li>
                <li>
                    <a href="#%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98" aria-label="遇到的问题">遇到的问题</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e9%81%87%e5%88%b0%e7%9a%84%e5%9d%91" aria-label="遇到的坑">遇到的坑</a></li>
                <li>
                    <a href="#webclient%e4%bd%bf%e7%94%a8" aria-label="webClient使用">webClient使用</a><ul>
                        
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88-resttemplate-%e8%a2%ab%e5%bc%83%e7%94%a8" aria-label="为什么 RestTemplate 被弃用">为什么 RestTemplate 被弃用</a></li>
                <li>
                    <a href="#webclient-%e7%9a%84%e5%85%b4%e8%b5%b7" aria-label="WebClient 的兴起">WebClient 的兴起</a></li>
                <li>
                    <a href="#%e4%bb%8e-resttemplate-%e8%bf%87%e6%b8%a1%e5%88%b0-webclient" aria-label="从 RestTemplate 过渡到 WebClient：">从 RestTemplate 过渡到 WebClient：</a></li>
                <li>
                    <a href="#%e6%89%a7%e8%a1%8c-get-%e8%af%b7%e6%b1%82" aria-label="执行 GET 请求：">执行 GET 请求：</a></li>
                <li>
                    <a href="#%e5%a4%84%e7%90%86%e9%94%99%e8%af%af" aria-label="处理错误：">处理错误：</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-json-%e7%9a%84-post-%e8%af%b7%e6%b1%82" aria-label="使用 JSON 的 POST 请求：">使用 JSON 的 POST 请求：</a></li>
                <li>
                    <a href="#%e5%bc%82%e6%ad%a5%e5%a4%84%e7%90%86" aria-label="异步处理：">异步处理：</a></li>
                <li>
                    <a href="#%e6%b5%81%e6%95%b0%e6%8d%ae" aria-label="流数据：">流数据：</a></li>
                <li>
                    <a href="#%e9%87%8d%e8%af%95%e6%9c%ba%e5%88%b6" aria-label="重试机制：">重试机制：</a></li>
                <li>
                    <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89-web-%e5%ae%a2%e6%88%b7%e7%ab%af%e9%85%8d%e7%bd%ae" aria-label="自定义 Web 客户端配置：">自定义 Web 客户端配置：</a></li>
                <li>
                    <a href="#%e7%bd%91%e7%bb%9c%e5%ae%a2%e6%88%b7%e7%ab%af%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="网络客户端过滤器：">网络客户端过滤器：</a></li>
                <li>
                    <a href="#%e7%9b%b8%e4%ba%92-tls-%e8%ba%ab%e4%bb%bd%e9%aa%8c%e8%af%81" aria-label="相互 TLS 身份验证：">相互 TLS 身份验证：</a></li>
                <li>
                    <a href="#webclient-%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" aria-label="WebClient 最佳实践">WebClient 最佳实践</a></li>
                <li>
                    <a href="#%e5%8d%95%e4%be%8b%e6%a8%a1%e5%bc%8f" aria-label="单例模式：">单例模式：</a></li>
                <li>
                    <a href="#%e9%94%99%e8%af%af%e5%a4%84%e7%90%86" aria-label="错误处理：">错误处理：</a></li>
                <li>
                    <a href="#%e8%b6%85%e6%97%b6%e9%85%8d%e7%bd%ae" aria-label="超时配置：">超时配置：</a></li>
                <li>
                    <a href="#%e8%83%8c%e5%8e%8b" aria-label="背压：">背压：</a></li>
                <li>
                    <a href="#%e6%97%a5%e5%bf%97%e8%ae%b0%e5%bd%95" aria-label="日志记录：">日志记录：</a></li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e4%b8%8a%e4%b8%8b%e6%96%87" aria-label="线程上下文：">线程上下文：</a></li>
                <li>
                    <a href="#%e9%81%bf%e5%85%8d%e9%98%bb%e5%a1%9e%e5%91%bc%e5%8f%ab" aria-label="避免阻塞呼叫：">避免阻塞呼叫：</a></li>
                <li>
                    <a href="#spring-boot-%e4%b8%ad%e4%bd%bf%e7%94%a8webclient" aria-label="spring boot 中使用webClient">spring boot 中使用webClient</a></li></ul>
                </li>
                <li>
                    <a href="#excel%e5%af%bc%e5%85%a5%e5%af%bc%e5%87%ba" aria-label="excel导入导出">excel导入导出</a><ul>
                        
                <li>
                    <a href="#%e5%b7%a5%e5%85%b7%e7%b1%bb-2" aria-label="工具类">工具类</a></li>
                <li>
                    <a href="#%e5%af%bc%e5%87%ba" aria-label="导出">导出</a></li>
                <li>
                    <a href="#%e5%af%bc%e5%85%a5" aria-label="导入">导入</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="ffmpeg使用">ffmpeg使用<a hidden class="anchor" aria-hidden="true" href="#ffmpeg使用">#</a></h1>
<p><a href="https://baike.baidu.com/item/ffmpeg">ffmpeg了解</a>
<a href="http://ffmpeg.org/">ffmpeg官网</a>
在使用Java调用FFmpeg处理音视频之前，需要先安装FFmpeg，安装方法分为两种：</p>
<ul>
<li>引入封装了FFmpeg的开源框架（不推荐）
JAVE.jar 是一个封装了FFmpeg的Java框架，在项目中能直接调用它的API来处理音视频文件；
<a href="http://www.sauronsoftware.it/projects/jave/index.php">官网</a>
优点：使用方便，直接在项目中引入JAVE.jar即可处理媒体文件，且开发完成后可以随工程一起打包发布，不需要在目标运行环境内手动安装FFmpeg相关的类库
缺点：JAVE.jar最后一次更新是2009年，其封装的FFmpeg版本是09年或更早前的版本，比较老旧，无法使用一些新特性</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.ffmpeg<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>sdk<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;version&gt;</span>1.0.2<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在系统中手动安装FFmpeg(推荐)
在运行环境中手动安装FFmpeg稍微有一些麻烦，可以百度 windows/mac安装FFmpeg 这样的关键字，根据网上的安装教程将FFmpeg安装到系统中。
优点：可以直接调用FFmpeg的相关API处理音视频，FFmpeg版本可控
缺点：手动安装较为麻烦，开发环境与目标运行环境都需要先安装好FFmpeg
另外，如果项目是通过docker和k8s构建部署的，也可以使用ffmpeg，需要将ffmpeg打到对应的镜像中。</li>
</ul>
<p>使用FFmpeg处理音视频
<a href="https://www.cnblogs.com/Dreamer-1/p/10394011.html">后续，我懒得写了</a></p>
<p>为什么我要用到ffmpeg。
因为我项目中有一些音频数据是整段的，因为业务变动，需要根据时间点切分成很多小段。
之前是返回给app，app先把音频下载下来，然后根据时间点切分，巨慢。所以现在把数据库里的数据直接切割好，返回给前端。
最开始觉得用ffmpeg麻烦，想用一些io的方法，把文件切割，然后各种实验后，不是对文件类型有要求，就是切割之后文件失真等等问题。所以用ffmpeg。</p>
<h2 id="音频文件转wav格式">音频文件转wav格式<a hidden class="anchor" aria-hidden="true" href="#音频文件转wav格式">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 音频文件转wav格式
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param ffmpegPath
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param sourcePath
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param targetPath
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @throws Exception
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> File changeFileToWav(String ffmpegPath, String sourcePath, String targetPath) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    String webroot = ffmpegPath;
</span></span><span style="display:flex;"><span>    Runtime run = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        run = Runtime.<span style="color:#007f7f">getRuntime</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span> start = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#fff;font-weight:bold">new</span> File(webroot)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">getAbsolutePath</span>()); <span style="color:#007f7f">//执行ffmpeg.exe,前面是ffmpeg.exe的地址，中间是需要转换的文件地址，后面是转换后的文件地址。-i是转换方式，意思是可编码解码，mp3编码方式采用的是libmp3lame</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//wav转pcm</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//Process p=run.exec(new File(webroot).getAbsolutePath()+&#34;/ffmpeg -y -i &#34;+sourcePath+&#34; -acodec pcm_s16le -f s16le -ac 1 -ar 16000 &#34;+targetPath);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//mp3转pcm</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Process p = run.exec(new File(webroot).getAbsolutePath() + &#34;/ffmpeg -y -i &#34; + sourcePath + &#34; -acodec pcm_s16le -f s16le -ac 1 -ar 16000 &#34; + targetPath);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//16bit 单声道 48khz</span>
</span></span><span style="display:flex;"><span>        Process p = run.<span style="color:#007f7f">exec</span>(<span style="color:#fff;font-weight:bold">new</span> File(webroot)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">getAbsolutePath</span>() + <span style="color:#0ff;font-weight:bold">&#34;/ffmpeg -y -i &#34;</span> + sourcePath + <span style="color:#0ff;font-weight:bold">&#34; -ar 48000 -ac 1 -acodec pcm_s16le &#34;</span> + targetPath);
</span></span><span style="display:flex;"><span>        InputStream stderr = p.<span style="color:#007f7f">getErrorStream</span>();
</span></span><span style="display:flex;"><span>        InputStreamReader isr = <span style="color:#fff;font-weight:bold">new</span> InputStreamReader(stderr);
</span></span><span style="display:flex;"><span>        BufferedReader br = <span style="color:#fff;font-weight:bold">new</span> BufferedReader(isr);
</span></span><span style="display:flex;"><span>        String line = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> ((line = br.<span style="color:#007f7f">readLine</span>()) != <span style="color:#fff;font-weight:bold">null</span>) System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(line);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> exitVal = p.<span style="color:#007f7f">waitFor</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Process exitValue: &#34;</span> + exitVal); <span style="color:#007f7f">//释放进程</span>
</span></span><span style="display:flex;"><span>        p.<span style="color:#007f7f">getOutputStream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        p.<span style="color:#007f7f">getInputStream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        p.<span style="color:#007f7f">getErrorStream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        p.<span style="color:#007f7f">waitFor</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span> end = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(sourcePath + <span style="color:#0ff;font-weight:bold">&#34; convert success, costs:&#34;</span> + (end - start) + <span style="color:#0ff;font-weight:bold">&#34;ms&#34;</span>);
</span></span><span style="display:flex;"><span>        File targetFile = <span style="color:#fff;font-weight:bold">new</span> File(targetPath);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> targetFile;
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//run调用lame解码器最后释放内存</span>
</span></span><span style="display:flex;"><span>        run.<span style="color:#007f7f">freeMemory</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="音频切割">音频切割<a hidden class="anchor" aria-hidden="true" href="#音频切割">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 音频切割
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param ffmpegPath
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param sourcePath
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param targetPath
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param startTime
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param endTime
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @throws Exception
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> File wavToCutting(String ffmpegPath, String sourcePath, String targetPath, String startTime, String endTime) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>	String webroot = ffmpegPath;
</span></span><span style="display:flex;"><span>	Runtime run = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>		run = Runtime.<span style="color:#007f7f">getRuntime</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">long</span> start = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#fff;font-weight:bold">new</span> File(webroot)
</span></span><span style="display:flex;"><span>				.<span style="color:#007f7f">getAbsolutePath</span>()); <span style="color:#007f7f">//执行ffmpeg.exe,前面是ffmpeg.exe的地址，中间是需要转换的文件地址，后面是转换后的文件地址。-i是转换方式，意思是可编码解码，mp3编码方式采用的是libmp3lame</span>
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//wav转pcm</span>
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//Process p=run.exec(new File(webroot).getAbsolutePath()+&#34;/ffmpeg -y -i &#34;+sourcePath+&#34; -acodec pcm_s16le -f s16le -ac 1 -ar 16000 &#34;+targetPath);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//mp3转pcm</span>
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">// Process p = run.exec(new File(webroot).getAbsolutePath() + &#34;/ffmpeg -y -i &#34; + sourcePath + &#34; -acodec pcm_s16le -f s16le -ac 1 -ar 16000 &#34; + targetPath);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//16bit 单声道 48khz</span>
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">err</span>.<span style="color:#007f7f">print</span>(<span style="color:#fff;font-weight:bold">new</span> File(webroot)
</span></span><span style="display:flex;"><span>				.<span style="color:#007f7f">getAbsolutePath</span>() + <span style="color:#0ff;font-weight:bold">&#34;/ffmpeg -i &#34;</span> + sourcePath + <span style="color:#0ff;font-weight:bold">&#34; -ss &#34;</span> + startTime + <span style="color:#0ff;font-weight:bold">&#34; -to &#34;</span> + endTime + <span style="color:#0ff;font-weight:bold">&#34; -y &#34;</span> + targetPath);
</span></span><span style="display:flex;"><span>		Process p = run.<span style="color:#007f7f">exec</span>(<span style="color:#fff;font-weight:bold">new</span> File(webroot)
</span></span><span style="display:flex;"><span>				.<span style="color:#007f7f">getAbsolutePath</span>() + <span style="color:#0ff;font-weight:bold">&#34;/ffmpeg -i &#34;</span> + sourcePath + <span style="color:#0ff;font-weight:bold">&#34; -ss &#34;</span> + startTime + <span style="color:#0ff;font-weight:bold">&#34; -to &#34;</span> + endTime + <span style="color:#0ff;font-weight:bold">&#34; -y &#34;</span> + targetPath);
</span></span><span style="display:flex;"><span>		InputStream stderr = p.<span style="color:#007f7f">getErrorStream</span>();
</span></span><span style="display:flex;"><span>		InputStreamReader isr = <span style="color:#fff;font-weight:bold">new</span> InputStreamReader(stderr);
</span></span><span style="display:flex;"><span>		BufferedReader br = <span style="color:#fff;font-weight:bold">new</span> BufferedReader(isr);
</span></span><span style="display:flex;"><span>		String line = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">while</span> ((line = br.<span style="color:#007f7f">readLine</span>()) != <span style="color:#fff;font-weight:bold">null</span>) System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(line);
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">int</span> exitVal = p.<span style="color:#007f7f">waitFor</span>();
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Process exitValue: &#34;</span> + exitVal); <span style="color:#007f7f">//释放进程</span>
</span></span><span style="display:flex;"><span>		p.<span style="color:#007f7f">getOutputStream</span>()
</span></span><span style="display:flex;"><span>				.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>		p.<span style="color:#007f7f">getInputStream</span>()
</span></span><span style="display:flex;"><span>				.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>		p.<span style="color:#007f7f">getErrorStream</span>()
</span></span><span style="display:flex;"><span>				.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>		p.<span style="color:#007f7f">waitFor</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">long</span> end = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(sourcePath + <span style="color:#0ff;font-weight:bold">&#34; convert success, costs:&#34;</span> + (end - start) + <span style="color:#0ff;font-weight:bold">&#34;ms&#34;</span>);
</span></span><span style="display:flex;"><span>		File targetFile = <span style="color:#fff;font-weight:bold">new</span> File(targetPath);
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> targetFile;
</span></span><span style="display:flex;"><span>	} <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>		e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>	} <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//run调用lame解码器最后释放内存</span>
</span></span><span style="display:flex;"><span>		run.<span style="color:#007f7f">freeMemory</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="在图片上写字">在图片上写字<a hidden class="anchor" aria-hidden="true" href="#在图片上写字">#</a></h1>
<p><a href="https://www.jianshu.com/p/26344c221eab">参考</a></p>
<h2 id="把字写到已存在的图片上">把字写到已存在的图片上<a hidden class="anchor" aria-hidden="true" href="#把字写到已存在的图片上">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> generatePic(String str) {
</span></span><span style="display:flex;"><span>        File file = <span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\123\\Desktop\\123.png&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//Image src = ImageIO.read(file);</span>
</span></span><span style="display:flex;"><span>        Image src = Toolkit.<span style="color:#007f7f">getDefaultToolkit</span>().<span style="color:#007f7f">createImage</span>(file.<span style="color:#007f7f">getAbsolutePath</span>());
</span></span><span style="display:flex;"><span>        BufferedImage bi = toBufferedImage(src);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (bi == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        g = bi.<span style="color:#007f7f">createGraphics</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//#853C24</span>
</span></span><span style="display:flex;"><span>        g.<span style="color:#007f7f">setColor</span>(<span style="color:#fff;font-weight:bold">new</span> Color(133, 60, 36));
</span></span><span style="display:flex;"><span>        g.<span style="color:#007f7f">setFont</span>(<span style="color:#fff;font-weight:bold">new</span> Font(<span style="color:#0ff;font-weight:bold">&#34;微软雅黑&#34;</span>, Font.<span style="color:#007f7f">BOLD</span>, 80));
</span></span><span style="display:flex;"><span>        g.<span style="color:#007f7f">drawString</span>(str, 130, 250);
</span></span><span style="display:flex;"><span>        g.<span style="color:#007f7f">dispose</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ByteArrayOutputStream outputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            ImageIO.<span style="color:#007f7f">write</span>(bi, <span style="color:#0ff;font-weight:bold">&#34;png&#34;</span>, outputStream);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">byte</span>[] bytes = outputStream.<span style="color:#007f7f">toByteArray</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//该bytes数组就可以输出到文件，或者云服务器</span>
</span></span><span style="display:flex;"><span>            File newFile = <span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\123\\Desktop\\生成.png&#34;</span>);
</span></span><span style="display:flex;"><span>            FileOutputStream fos = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(newFile);
</span></span><span style="display:flex;"><span>            fos.<span style="color:#007f7f">write</span>(bytes);
</span></span><span style="display:flex;"><span>            fos.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>            fos.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//也可以上传到云服务器</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//TencentFileUploadUtils.uploafFileByBytes(bytes);</span>
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> BufferedImage toBufferedImage(Image image) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (image <span style="color:#fff;font-weight:bold">instanceof</span> BufferedImage) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> (BufferedImage) image;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// This code ensures that all the pixels in the image are loaded</span>
</span></span><span style="display:flex;"><span>        image = <span style="color:#fff;font-weight:bold">new</span> ImageIcon(image).<span style="color:#007f7f">getImage</span>();
</span></span><span style="display:flex;"><span>        BufferedImage bimage = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        GraphicsEnvironment ge = GraphicsEnvironment
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">getLocalGraphicsEnvironment</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> transparency = Transparency.<span style="color:#007f7f">OPAQUE</span>;
</span></span><span style="display:flex;"><span>            GraphicsDevice gs = ge.<span style="color:#007f7f">getDefaultScreenDevice</span>();
</span></span><span style="display:flex;"><span>            GraphicsConfiguration gc = gs.<span style="color:#007f7f">getDefaultConfiguration</span>();
</span></span><span style="display:flex;"><span>            bimage = gc.<span style="color:#007f7f">createCompatibleImage</span>(image.<span style="color:#007f7f">getWidth</span>(<span style="color:#fff;font-weight:bold">null</span>),
</span></span><span style="display:flex;"><span>                    image.<span style="color:#007f7f">getHeight</span>(<span style="color:#fff;font-weight:bold">null</span>), transparency);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (HeadlessException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// The system does not have a screen</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (bimage == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Create a buffered image using the default color model</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> type = BufferedImage.<span style="color:#007f7f">TYPE_INT_RGB</span>;
</span></span><span style="display:flex;"><span>            bimage = <span style="color:#fff;font-weight:bold">new</span> BufferedImage(image.<span style="color:#007f7f">getWidth</span>(<span style="color:#fff;font-weight:bold">null</span>),
</span></span><span style="display:flex;"><span>                    image.<span style="color:#007f7f">getHeight</span>(<span style="color:#fff;font-weight:bold">null</span>), type);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Copy image to buffered image</span>
</span></span><span style="display:flex;"><span>        Graphics g = bimage.<span style="color:#007f7f">createGraphics</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Paint the image onto the buffered image</span>
</span></span><span style="display:flex;"><span>        g.<span style="color:#007f7f">drawImage</span>(image, 0, 0, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>        g.<span style="color:#007f7f">dispose</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> bimage;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>	generatePic(<span style="color:#0ff;font-weight:bold">&#34;测试文字&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果设置的字体不生效，可以通过如下代码查看系统有哪些字体。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Font[] fonts = GraphicsEnvironment.getLocalGraphicsEnvironment().getAllFonts();
</span></span><span style="display:flex;"><span>for (Font f : fonts) {
</span></span><span style="display:flex;"><span>	System.out.println(&#34;Name:&#34; + f.getFontName());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在控制台寻找自己想要的字体的英文名称，再替换到new Font()的指定位置就可以了。</p>
<h2 id="进阶文字自动换行">进阶，文字自动换行<a hidden class="anchor" aria-hidden="true" href="#进阶文字自动换行">#</a></h2>
<p>如果有很多文字，想根据文字生成图片，涉及到自动换行问题。具体代码在码云。</p>
<h1 id="裁剪图片空白区域">裁剪图片空白区域<a hidden class="anchor" aria-hidden="true" href="#裁剪图片空白区域">#</a></h1>
<p><a href="https://www.jianshu.com/p/8b3542e6a571">参考</a>
白底黑字的图片，裁减掉空白区域，生成新的图片。因为图片又太多的空白，不美观。</p>
<p>思路：</p>
<ol>
<li>调用ImageIO.read获取图片以及原图的宽度、高度</li>
<li>通过双层for循环，遍历图片的每个像素点，获取图片上下左右四个极值</li>
<li>调用BufferedImage 的getSubimage方法裁剪图片</li>
<li>调用ImageIO.write方法生成裁剪后的图片</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> BufferedImage getSubimage (<span style="color:#fff;font-weight:bold">int</span> x, <span style="color:#fff;font-weight:bold">int</span> y, <span style="color:#fff;font-weight:bold">int</span> w, <span style="color:#fff;font-weight:bold">int</span> h) {}
</span></span><span style="display:flex;"><span>x 左上角x坐标
</span></span><span style="display:flex;"><span>y 左上角y坐标
</span></span><span style="display:flex;"><span>w 新图片宽度
</span></span><span style="display:flex;"><span>y 新图片高度
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">89
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> BufferedImage cutImage(BufferedImage bufferedImage) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> WHITE = <span style="color:#fff;font-weight:bold">new</span> Color(255, 255, 255).<span style="color:#007f7f">getRGB</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> BLACK = <span style="color:#fff;font-weight:bold">new</span> Color(0, 0, 0).<span style="color:#007f7f">getRGB</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 原图片宽度</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> width = bufferedImage.<span style="color:#007f7f">getWidth</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 原图片高度</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> height = bufferedImage.<span style="color:#007f7f">getHeight</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	    <span style="color:#007f7f">// rgb</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> colorNum = 200;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> rgb = 0;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> left = width;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> top = height;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> right = 0;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> buttom = 0;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 遍历图片每个像素点</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; width; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> j = 0; j &lt; height; j++) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//获取每个像素点的RGB</span>
</span></span><span style="display:flex;"><span>                rgb = bufferedImage.<span style="color:#007f7f">getRGB</span>(i, j);
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//转成可读的RGB值</span>
</span></span><span style="display:flex;"><span>                Color color = <span style="color:#fff;font-weight:bold">new</span> Color(rgb);
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 跳过范围（偏白色-&gt;白色）</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (color.<span style="color:#007f7f">getRed</span>() &gt; colorNum &amp;&amp; color.<span style="color:#007f7f">getBlue</span>() &gt; colorNum &amp;&amp; color.<span style="color:#007f7f">getGreen</span>() &gt; colorNum) {
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">continue</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 计算最左侧</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (left &gt;= i) {
</span></span><span style="display:flex;"><span>                    left = i;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 计算最右侧</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (right &lt;= i) {
</span></span><span style="display:flex;"><span>                    right = i;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 计算最上方</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (top &gt;= j) {
</span></span><span style="display:flex;"><span>                    top = j;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 计算最下方</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (buttom &lt;= j) {
</span></span><span style="display:flex;"><span>                    buttom = j;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 如果计算出的最右，和图片宽度相差不到50，那么不裁剪右侧，使用原图宽度</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(width - right &lt;= 50){
</span></span><span style="display:flex;"><span>            right = width - left;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 如果计算出的最下，和图片高度相差不到50，那么不裁剪底部，使用原图高度</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(height - buttom &lt;= 50){
</span></span><span style="display:flex;"><span>            buttom = height - top;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    	<span style="color:#007f7f">// -------------&gt;开始</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 为了美观，四边留20的边界（看情况，可不留边界）</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> blank = 20;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//计算左值</span>
</span></span><span style="display:flex;"><span>        left = 0 &lt;= left - blank ? left - blank : left;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//计算顶部值</span>
</span></span><span style="display:flex;"><span>        top = 0 &lt;= top - blank ? top - blank : top;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//计算右值</span>
</span></span><span style="display:flex;"><span>        right = right - left + blank &gt;= width ? right : right - left + blank;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//计算底部值</span>
</span></span><span style="display:flex;"><span>        buttom = buttom - top + blank &gt;= height ? buttom : buttom - top + blank;
</span></span><span style="display:flex;"><span>    	<span style="color:#007f7f">// ----------------&gt;结束，这部分代码看情况，是否需要留20的空白</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>	    <span style="color:#007f7f">// 可能会出现右或下为0的情况</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(right == 0 || buttom == 0){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 裁剪原图，注意：right + left &lt;= width（必须），buttom + top &lt;= height（必须），否则会报错</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> bufferedImage.<span style="color:#007f7f">getSubimage</span>(left, top, right, buttom);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 原图</span>
</span></span><span style="display:flex;"><span>        BufferedImage bufferedImage = ImageIO.<span style="color:#007f7f">read</span>(<span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\123\\Desktop\\1.jpg&#34;</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 裁剪</span>
</span></span><span style="display:flex;"><span>	    BufferedImage newBufferedImage = cutImage(bufferedImage);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 图片可能有问题，即没有k</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(newBufferedImage == <span style="color:#fff;font-weight:bold">null</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 生成新图</span>
</span></span><span style="display:flex;"><span>        ImageIO.<span style="color:#007f7f">write</span>(newBufferedImage, <span style="color:#0ff;font-weight:bold">&#34;png&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\123\\Desktop\\new.png&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="工具类">工具类<a hidden class="anchor" aria-hidden="true" href="#工具类">#</a></h1>
<h2 id="时间">时间<a hidden class="anchor" aria-hidden="true" href="#时间">#</a></h2>
<h3 id="判断两个时间戳是否是同一天">判断两个时间戳是否是同一天<a hidden class="anchor" aria-hidden="true" href="#判断两个时间戳是否是同一天">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">boolean</span> isSameDay(<span style="color:#fff;font-weight:bold">int</span> beginTimestamp,<span style="color:#fff;font-weight:bold">int</span> endTimestamp) {
</span></span><span style="display:flex;"><span>	SimpleDateFormat sdf = <span style="color:#fff;font-weight:bold">new</span> SimpleDateFormat(<span style="color:#0ff;font-weight:bold">&#34;yyyy-MM-dd&#34;</span>);
</span></span><span style="display:flex;"><span>	String ds1 = sdf.<span style="color:#007f7f">format</span>(beginTimestamp * 1000l);
</span></span><span style="display:flex;"><span>	String ds2 = sdf.<span style="color:#007f7f">format</span>(endTimestamp * 1000l);
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">if</span> (ds1.<span style="color:#007f7f">equals</span>(ds2)) {
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>	} <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="计算两个时间戳差值秒级时间戳">计算两个时间戳差值(秒级时间戳)<a hidden class="anchor" aria-hidden="true" href="#计算两个时间戳差值秒级时间戳">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">int</span> getTimeDifference(<span style="color:#fff;font-weight:bold">int</span> beginTimestamp, <span style="color:#fff;font-weight:bold">int</span> endTimestamp, <span style="color:#fff;font-weight:bold">int</span> type) {
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">int</span> result = 0;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">if</span> (beginTimestamp == 0 || endTimestamp == 0) {
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> 0;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">int</span> millisecond = endTimestamp - beginTimestamp;
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">		 * Math.abs((int)(millisecond/1000)); 绝对值 1秒 = 1000毫秒
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">		 * millisecond/1000 --&gt; 秒
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">		 * millisecond/1000*60 - &gt; 分钟
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">		 * millisecond/(1000*60*60) -- &gt; 小时
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">		 * millisecond/(1000*60*60*24) --&gt; 天
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">		 * */</span>
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">switch</span> (type) {
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">case</span> 0: <span style="color:#007f7f">// second</span>
</span></span><span style="display:flex;"><span>				<span style="color:#fff;font-weight:bold">return</span>  millisecond;
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">case</span> 1: <span style="color:#007f7f">// minute</span>
</span></span><span style="display:flex;"><span>				<span style="color:#fff;font-weight:bold">return</span> (millisecond / 60);
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">case</span> 2: <span style="color:#007f7f">// hour</span>
</span></span><span style="display:flex;"><span>				<span style="color:#fff;font-weight:bold">return</span>  (millisecond / (60 * 60));
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">case</span> 3: <span style="color:#007f7f">// day</span>
</span></span><span style="display:flex;"><span>				<span style="color:#fff;font-weight:bold">return</span> (millisecond / (60 * 60 * 24));
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	} <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>		e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="字符串">字符串<a hidden class="anchor" aria-hidden="true" href="#字符串">#</a></h2>
<h3 id="字符串排序">字符串排序<a hidden class="anchor" aria-hidden="true" href="#字符串排序">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/**
</span></span><span style="display:flex;"><span> * @author: wjy
</span></span><span style="display:flex;"><span> * @description: 字符串根据ASCII码表进行升序排列
</span></span><span style="display:flex;"><span> */
</span></span><span style="display:flex;"><span>public static String ASCIISort(String str) {
</span></span><span style="display:flex;"><span>	char[] test = new char[str.length()];
</span></span><span style="display:flex;"><span>	StringBuilder sb = new StringBuilder();
</span></span><span style="display:flex;"><span>	while (true) {
</span></span><span style="display:flex;"><span>		String a = str;//直接读取这行当中的字符串。
</span></span><span style="display:flex;"><span>		for (int i = 0; i &lt; str.length(); i++) {
</span></span><span style="display:flex;"><span>			test[i] = a.charAt(i);//字符串处理每次读取一位。
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		Arrays.sort(test);
</span></span><span style="display:flex;"><span>		for (int i = 0; i &lt; test.length; i++) {
</span></span><span style="display:flex;"><span>			sb.append(test[i]);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		String trim = sb.toString().trim();
</span></span><span style="display:flex;"><span>		return trim;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="判断版本号">判断版本号<a hidden class="anchor" aria-hidden="true" href="#判断版本号">#</a></h2>
<p>app上线后，需求的变动需要兼容旧版本的app，不能然旧版的app不能访问。
所以我们在每个接口中都传入<code>appVersion</code>，即app的版本号，届时可以通过app的版本号来判断接口数据的变动。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> /**
</span></span><span style="display:flex;"><span>     * 版本号比较
</span></span><span style="display:flex;"><span>     *
</span></span><span style="display:flex;"><span>     * @param v1
</span></span><span style="display:flex;"><span>     * @param v2
</span></span><span style="display:flex;"><span>     * @return 0代表相等，1代表左边大，-1代表右边大
</span></span><span style="display:flex;"><span>     * Utils.compareVersion(&#34;1.0.358_20180820090554&#34;,&#34;1.0.358_20180820090553&#34;)=1
</span></span><span style="display:flex;"><span>     */
</span></span><span style="display:flex;"><span>    public static int compareVersion(String v1, String v2) {
</span></span><span style="display:flex;"><span>        if (v1.equals(v2)) {
</span></span><span style="display:flex;"><span>            return 0;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        String[] version1Array = v1.split(&#34;[._]&#34;);
</span></span><span style="display:flex;"><span>        String[] version2Array = v2.split(&#34;[._]&#34;);
</span></span><span style="display:flex;"><span>        int index = 0;
</span></span><span style="display:flex;"><span>        int minLen = Math.min(version1Array.length, version2Array.length);
</span></span><span style="display:flex;"><span>        long diff = 0;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        while (index &lt; minLen
</span></span><span style="display:flex;"><span>                &amp;&amp; (diff = Long.parseLong(version1Array[index])
</span></span><span style="display:flex;"><span>                - Long.parseLong(version2Array[index])) == 0) {
</span></span><span style="display:flex;"><span>            index++;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        if (diff == 0) {
</span></span><span style="display:flex;"><span>            for (int i = index; i &lt; version1Array.length; i++) {
</span></span><span style="display:flex;"><span>                if (Long.parseLong(version1Array[i]) &gt; 0) {
</span></span><span style="display:flex;"><span>                    return 1;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            for (int i = index; i &lt; version2Array.length; i++) {
</span></span><span style="display:flex;"><span>                if (Long.parseLong(version2Array[i]) &gt; 0) {
</span></span><span style="display:flex;"><span>                    return -1;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            return 0;
</span></span><span style="display:flex;"><span>        } else {
</span></span><span style="display:flex;"><span>            return diff &gt; 0 ? 1 : -1;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="base64编码和解码">base64编码和解码<a hidden class="anchor" aria-hidden="true" href="#base64编码和解码">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>final Base64.Decoder decoder = Base64.getDecoder();
</span></span><span style="display:flex;"><span>final Base64.Encoder encoder = Base64.getEncoder();
</span></span><span style="display:flex;"><span>final String text = &#34;字串文字&#34;;
</span></span><span style="display:flex;"><span>final byte[] textByte = text.getBytes(&#34;UTF-8&#34;);
</span></span><span style="display:flex;"><span>//编码
</span></span><span style="display:flex;"><span>final String encodedText = encoder.encodeToString(textByte);
</span></span><span style="display:flex;"><span>System.out.println(encodedText);
</span></span><span style="display:flex;"><span>//解码
</span></span><span style="display:flex;"><span>System.out.println(new String(decoder.decode(encodedText), &#34;UTF-8&#34;));
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="读取pdf内容">读取pdf内容<a hidden class="anchor" aria-hidden="true" href="#读取pdf内容">#</a></h2>
<p>文本内容提取:
pom引入</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;dependency&gt;
</span></span><span style="display:flex;"><span>	&lt;groupId&gt;org.apache.pdfbox&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>	&lt;artifactId&gt;pdfbox&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>	&lt;version&gt;2.0.15&lt;/version&gt;
</span></span><span style="display:flex;"><span>&lt;/dependency&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;dependency&gt;
</span></span><span style="display:flex;"><span>	&lt;groupId&gt;org.apache.pdfbox&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>	&lt;artifactId&gt;fontbox&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>	&lt;version&gt;2.0.15&lt;/version&gt;
</span></span><span style="display:flex;"><span>&lt;/dependency&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;dependency&gt;
</span></span><span style="display:flex;"><span>	&lt;groupId&gt;org.apache.pdfbox&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>	&lt;artifactId&gt;jempbox&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>	&lt;version&gt;1.8.16&lt;/version&gt;
</span></span><span style="display:flex;"><span>&lt;/dependency&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 读PDF文件
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param fileName
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> readPDF(String fileName) {
</span></span><span style="display:flex;"><span>	File file = <span style="color:#fff;font-weight:bold">new</span> File(fileName);
</span></span><span style="display:flex;"><span>	FileInputStream in = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>		PDDocument document=PDDocument.<span style="color:#007f7f">load</span>(file);
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">// 获取页码</span>
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">int</span> pages = document.<span style="color:#007f7f">getNumberOfPages</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">// 读文本内容</span>
</span></span><span style="display:flex;"><span>		PDFTextStripper stripper=<span style="color:#fff;font-weight:bold">new</span> PDFTextStripper();
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">// 设置按顺序输出</span>
</span></span><span style="display:flex;"><span>		stripper.<span style="color:#007f7f">setSortByPosition</span>(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>		stripper.<span style="color:#007f7f">setStartPage</span>(1);
</span></span><span style="display:flex;"><span>		stripper.<span style="color:#007f7f">setEndPage</span>(pages);
</span></span><span style="display:flex;"><span>		String content = stripper.<span style="color:#007f7f">getText</span>(document);
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(content);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//可选，将pdf内容写入到txt文本文件</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//            FileWriter fileWriter = new FileWriter(new File(&#34;pdf.txt&#34;));</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//            fileWriter.write(content);</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//            fileWriter.flush();</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//            fileWriter.close();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	} <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;读取PDF文件&#34;</span> + file.<span style="color:#007f7f">getAbsolutePath</span>() + <span style="color:#0ff;font-weight:bold">&#34;失败！&#34;</span> + e);
</span></span><span style="display:flex;"><span>		e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>	} <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">if</span> (in != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>				in.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>			} <span style="color:#fff;font-weight:bold">catch</span> (IOException e1) {
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="java实现office系列文件转pdf文件">Java实现Office系列文件转PDF文件<a hidden class="anchor" aria-hidden="true" href="#java实现office系列文件转pdf文件">#</a></h1>
<p><a href="https://downloads.aspose.com/">官网下载jar包</a>
<a href="https://pan.baidu.com/s/1vzYobuqDZYe6-VPRp06l3w">百度网盘下载破解包</a>
官网下载的有水印，不过是最新版，破解的是比较旧的版本，不过都能用。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.archive.util.AsposeUtil;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aspose.cells.Workbook;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aspose.slides.Presentation;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aspose.words.Document;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aspose.words.SaveFormat;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aspose.words.License;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @author: wjy
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Date: Create in 14:28 2019/10/31
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @description : Office系列文件转PDF文件工具类
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AsposeUtil {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//直接把凭证内容写进来，省的读取本地文件</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String licenseStr =
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;&lt;License&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;  &lt;Data&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;    &lt;Products&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;      &lt;Product&gt;Aspose.Total for Java&lt;/Product&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;    &lt;/Products&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;    &lt;EditionType&gt;Enterprise&lt;/EditionType&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;    &lt;SubscriptionExpiry&gt;20991231&lt;/SubscriptionExpiry&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;    &lt;LicenseExpiry&gt;20991231&lt;/LicenseExpiry&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;    &lt;SerialNumber&gt;8bfe198c-7f0c-4ef8-8ff0-acc3237bf0d7&lt;/SerialNumber&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;  &lt;/Data&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;  &lt;Signature&gt;sNLLKGMUdF0r8O1kKilWAGdgfs2BvJb/2Xp8p5iuDVfZXmhppo+d0Ran1P9TKdjV4ABwAgKXxJ3jcQTqE/2IRfqwnPf8itN8aFZlV3TJPYeD3yWE7IT55Gz6EijUpC7aKeoohTb4w2fpox58wWoF3SNp6sK6jDfiAUGEHYJ9pjU=&lt;/Signature&gt;&#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;&lt;/License&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获取word、excel、ppt的license
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">boolean</span> getLicense(<span style="color:#fff;font-weight:bold">int</span> type) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">boolean</span> result = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            InputStream license = <span style="color:#fff;font-weight:bold">new</span> ByteArrayInputStream(licenseStr.<span style="color:#007f7f">getBytes</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>));
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//也可以读取本地文件license.xml</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//InputStream license = new FileInputStream(new File(&#34;E:\\IDEA2017\\something2pdf-demo\\src\\main\\resources\\license.xml&#34;));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">switch</span>(type){
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">case</span> 1:<span style="color:#007f7f">//word</span>
</span></span><span style="display:flex;"><span>                    License wordLicense = <span style="color:#fff;font-weight:bold">new</span> License();
</span></span><span style="display:flex;"><span>                    wordLicense.<span style="color:#007f7f">setLicense</span>(license);
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">case</span> 2:<span style="color:#007f7f">//excel</span>
</span></span><span style="display:flex;"><span>                    com.<span style="color:#007f7f">aspose</span>.<span style="color:#007f7f">cells</span>.<span style="color:#007f7f">License</span> excelLicense = <span style="color:#fff;font-weight:bold">new</span> com.<span style="color:#007f7f">aspose</span>.<span style="color:#007f7f">cells</span>.<span style="color:#007f7f">License</span>();
</span></span><span style="display:flex;"><span>                    excelLicense.<span style="color:#007f7f">setLicense</span>(license);
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">case</span> 3:<span style="color:#007f7f">//ppt</span>
</span></span><span style="display:flex;"><span>                    com.<span style="color:#007f7f">aspose</span>.<span style="color:#007f7f">slides</span>.<span style="color:#007f7f">License</span> pptLicense = <span style="color:#fff;font-weight:bold">new</span> com.<span style="color:#007f7f">aspose</span>.<span style="color:#007f7f">slides</span>.<span style="color:#007f7f">License</span>();
</span></span><span style="display:flex;"><span>                    pptLicense.<span style="color:#007f7f">setLicense</span>(license);
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">default</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            result = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * word转pdf
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> doc2pdf(String outputPath,String inputPath) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//验证License 若不验证则转化出的pdf文档会有水印产生</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!getLicense(1)) <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//pdf输出路径</span>
</span></span><span style="display:flex;"><span>            FileOutputStream os = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#fff;font-weight:bold">new</span> File(outputPath));
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//word文件路径，即本地word文件路径</span>
</span></span><span style="display:flex;"><span>            Document doc = <span style="color:#fff;font-weight:bold">new</span> Document(inputPath);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//这里也可以获取上传的文件</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//Document doc = new Document(multipartFile.getInputStream());</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//保存转换的pdf文件</span>
</span></span><span style="display:flex;"><span>            doc.<span style="color:#007f7f">save</span>(os, SaveFormat.<span style="color:#007f7f">PDF</span>);
</span></span><span style="display:flex;"><span>            os.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * excel转pdf
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> excel2pdf(String outputPath,String inputPath) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 验证License 若不验证则转化出的pdf文档会有水印产生</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!getLicense(2)) <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//pdf输出路径</span>
</span></span><span style="display:flex;"><span>            File file = <span style="color:#fff;font-weight:bold">new</span> File(outputPath);
</span></span><span style="display:flex;"><span>            FileOutputStream os = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(file);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//excel输入路径，即本地excel文件路径</span>
</span></span><span style="display:flex;"><span>            Workbook wb = <span style="color:#fff;font-weight:bold">new</span> Workbook(inputPath);
</span></span><span style="display:flex;"><span>            wb.<span style="color:#007f7f">save</span>(os, com.<span style="color:#007f7f">aspose</span>.<span style="color:#007f7f">cells</span>.<span style="color:#007f7f">SaveFormat</span>.<span style="color:#007f7f">PDF</span>);
</span></span><span style="display:flex;"><span>            os.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ppt转pdf
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> ppt2pdf(String outputPath,String inputPath) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 验证License</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!getLicense(3)) <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//pdf输出路径</span>
</span></span><span style="display:flex;"><span>            File file = <span style="color:#fff;font-weight:bold">new</span> File(outputPath);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//ppt输入路径，即本地ppt文件路径</span>
</span></span><span style="display:flex;"><span>            Presentation pres = <span style="color:#fff;font-weight:bold">new</span> Presentation(inputPath);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            FileOutputStream fileOS = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(file);
</span></span><span style="display:flex;"><span>            pres.<span style="color:#007f7f">save</span>(fileOS, com.<span style="color:#007f7f">aspose</span>.<span style="color:#007f7f">slides</span>.<span style="color:#007f7f">SaveFormat</span>.<span style="color:#007f7f">Pdf</span>);
</span></span><span style="display:flex;"><span>            fileOS.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        AsposeUtil.<span style="color:#007f7f">doc2pdf</span>(<span style="color:#0ff;font-weight:bold">&#34;D:\\doc2pdf.pdf&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\wjy\\Desktop\\测试word.docx&#34;</span>);
</span></span><span style="display:flex;"><span>        AsposeUtil.<span style="color:#007f7f">excel2pdf</span>(<span style="color:#0ff;font-weight:bold">&#34;D:\\excel2pdf.pdf&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\wjy\\Desktop\\测试excel.xlsx&#34;</span>);
</span></span><span style="display:flex;"><span>        AsposeUtil.<span style="color:#007f7f">ppt2pdf</span>(<span style="color:#0ff;font-weight:bold">&#34;D:\\ppt2pdf.pdf&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\wjy\\Desktop\\测试ppt.pptx&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>maven仓库里没有这三个包。需要自己下载，然后放到项目里，或放到自己的maven仓库里。
而且<code>new License()</code>和<code>SaveFormat</code>两个方法，三个包的名字是相同的，所以只能倒一个包，剩下两个写全路径。</p>
<p>三个包名：
<code>aspose-cells-18.9.jar</code>excel转pdf
<code>aspose-slides-19.6.jar</code>ppt转pdf
<code>aspose-words-16.8.0-jdk16.jar</code>word转pdf</p>
<p><a href="https://www.jianshu.com/p/86716c7122ef">words转pdf参考</a>
<a href="https://blog.csdn.net/qq_34190023/article/details/82999054">参考地址</a>
<a href="https://blog.csdn.net/qq_42834405/article/details/98635337">如何破解</a></p>
<h1 id="pdf转图片">PDF转图片<a hidden class="anchor" aria-hidden="true" href="#pdf转图片">#</a></h1>
<p>Apache PDFBox®库是一个用于处理PDF文档的开源Java工具。
官网：https://pdfbox.apache.org/</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;groupId&gt;</span>org.apache.pdfbox<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;artifactId&gt;</span>pdfbox<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;version&gt;</span>2.0.22<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#007f7f">// dpi，和图片的分辨率和清晰度成正比</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> WORD_DPI = 700;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 和图片清晰度成正比</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> PDF_DPI = 100;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 图片的格式</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String IMG_TYPE = <span style="color:#0ff;font-weight:bold">&#34;png&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ppt转图片，放大的倍数，和越清晰成正比</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> MAGNIFICATION = 5;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * pdf 转 OutputStream
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> List&lt;ByteArrayOutputStream&gt; pdfToOutputStream(MultipartFile multipartFile) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        List&lt;ByteArrayOutputStream&gt; byteArrayOutputStreams = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ByteArrayOutputStream byteArrayOutputStream = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> (InputStream inputStream = multipartFile.<span style="color:#007f7f">getInputStream</span>();
</span></span><span style="display:flex;"><span>             PDDocument document = PDDocument.<span style="color:#007f7f">load</span>(inputStream)){
</span></span><span style="display:flex;"><span>            PDFRenderer pdfRenderer = <span style="color:#fff;font-weight:bold">new</span> PDFRenderer(document);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; document.<span style="color:#007f7f">getPages</span>().<span style="color:#007f7f">getCount</span>(); i++) {
</span></span><span style="display:flex;"><span>                byteArrayOutputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>                ImageIO.<span style="color:#007f7f">write</span>(pdfRenderer.<span style="color:#007f7f">renderImageWithDPI</span>(i, PDF_DPI), IMG_TYPE, byteArrayOutputStream);
</span></span><span style="display:flex;"><span>                byteArrayOutputStreams.<span style="color:#007f7f">add</span>(byteArrayOutputStream);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            byteArrayOutputStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> byteArrayOutputStreams;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="ppt转图片">ppt转图片<a hidden class="anchor" aria-hidden="true" href="#ppt转图片">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#007f7f">// dpi，和图片的分辨率和清晰度成正比</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> WORD_DPI = 700;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 和图片清晰度成正比</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> PDF_DPI = 100;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 图片的格式</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String IMG_TYPE = <span style="color:#0ff;font-weight:bold">&#34;png&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ppt转图片，放大的倍数，和清晰度成正比</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> MAGNIFICATION = 5;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ppt 转 OutputStream
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> List&lt;ByteArrayOutputStream&gt; pptToOutputStream(MultipartFile multipartFile) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        List&lt;ByteArrayOutputStream&gt; byteArrayOutputStreams = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        XMLSlideShow xmlSlideShow = <span style="color:#fff;font-weight:bold">new</span> XMLSlideShow(multipartFile.<span style="color:#007f7f">getInputStream</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 获取页面大小</span>
</span></span><span style="display:flex;"><span>        Dimension size = xmlSlideShow.<span style="color:#007f7f">getPageSize</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 获取幻灯片</span>
</span></span><span style="display:flex;"><span>        List&lt;XSLFSlide&gt; slides = xmlSlideShow.<span style="color:#007f7f">getSlides</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ByteArrayOutputStream byteArrayOutputStream = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (XSLFSlide slide : slides) {
</span></span><span style="display:flex;"><span>                List&lt;XSLFShape&gt; shapes = slide.<span style="color:#007f7f">getShapes</span>();
</span></span><span style="display:flex;"><span>                handleMessyCode(shapes);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                BufferedImage bufferedImage = <span style="color:#fff;font-weight:bold">new</span> BufferedImage(size.<span style="color:#007f7f">width</span> * MAGNIFICATION, size.<span style="color:#007f7f">height</span> * MAGNIFICATION, BufferedImage.<span style="color:#007f7f">TYPE_INT_RGB</span>);
</span></span><span style="display:flex;"><span>                Graphics2D graphics = bufferedImage.<span style="color:#007f7f">createGraphics</span>();
</span></span><span style="display:flex;"><span>                graphics.<span style="color:#007f7f">setPaint</span>(Color.<span style="color:#007f7f">white</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 将图片放大</span>
</span></span><span style="display:flex;"><span>                graphics.<span style="color:#007f7f">scale</span>(MAGNIFICATION, MAGNIFICATION);
</span></span><span style="display:flex;"><span>                graphics.<span style="color:#007f7f">fill</span>(<span style="color:#fff;font-weight:bold">new</span> Rectangle2D.<span style="color:#007f7f">Float</span>(0, 0, size.<span style="color:#007f7f">width</span>, size.<span style="color:#007f7f">height</span>));
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 画</span>
</span></span><span style="display:flex;"><span>                slide.<span style="color:#007f7f">draw</span>(graphics);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                byteArrayOutputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>                ImageIO.<span style="color:#007f7f">write</span>(bufferedImage, IMG_TYPE, byteArrayOutputStream);
</span></span><span style="display:flex;"><span>                byteArrayOutputStreams.<span style="color:#007f7f">add</span>(byteArrayOutputStream);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            byteArrayOutputStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> byteArrayOutputStreams;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 解决乱码问题
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> handleMessyCode(List&lt;XSLFShape&gt; shapes) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (XSLFShape shape : shapes) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (shape <span style="color:#fff;font-weight:bold">instanceof</span> XSLFTextShape) {
</span></span><span style="display:flex;"><span>                XSLFTextShape sh = (XSLFTextShape) shape;
</span></span><span style="display:flex;"><span>                List&lt;XSLFTextParagraph&gt; textParagraphs = sh.<span style="color:#007f7f">getTextParagraphs</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">for</span> (XSLFTextParagraph xslfTextParagraph : textParagraphs) {
</span></span><span style="display:flex;"><span>                    List&lt;XSLFTextRun&gt; textRuns = xslfTextParagraph.<span style="color:#007f7f">getTextRuns</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">for</span> (XSLFTextRun xslfTextRun : textRuns) {
</span></span><span style="display:flex;"><span>                        xslfTextRun.<span style="color:#007f7f">setFontFamily</span>(<span style="color:#0ff;font-weight:bold">&#34;宋体&#34;</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="aspose-破解">aspose 破解<a hidden class="anchor" aria-hidden="true" href="#aspose-破解">#</a></h1>
<p>官网：https://www.aspose.com/
破解之前，先从官网把jar包下载到本地。上传到阿里云效maven仓库，或者把jar包直接导入到idea中。</p>
<p>参考 ：https://juejin.cn/post/7034415238602555405</p>
<p>aspose 的所有工具破解的思路都是一样的，就是分析加载证书的代码。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>License license = <span style="color:#fff;font-weight:bold">new</span> License();
</span></span><span style="display:flex;"><span>license.<span style="color:#007f7f">setLicense</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="asposepdf-for-java-2111-破解">Aspose.PDF for Java 21.11 破解<a hidden class="anchor" aria-hidden="true" href="#asposepdf-for-java-2111-破解">#</a></h2>
<h3 id="分析代码">分析代码<a hidden class="anchor" aria-hidden="true" href="#分析代码">#</a></h3>
<p>直接调用授权方法，注意每种 aspose 工具的 License 类的包路径是不同的。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>License license = <span style="color:#fff;font-weight:bold">new</span> License();
</span></span><span style="display:flex;"><span>license.<span style="color:#007f7f">setLicense</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>分析<code>License</code>类的<code>setLicense()</code>方法，发现<code>setLicense()</code>的两个重载方法都执行了如下代码：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>l9f var10 = <span style="color:#fff;font-weight:bold">new</span> l9f();
</span></span><span style="display:flex;"><span>var10.<span style="color:#007f7f">lI</span>(var9);
</span></span></code></pre></td></tr></table>
</div>
</div><p>进入l9f类的lT方法，仔细观察发现这个方法就是验证的，主要是做验证失败抛异常和添加一些标识，好像只有最后一段代码是通过验证：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">l0if</span> = l10if.<span style="color:#007f7f">lf</span>;
</span></span><span style="display:flex;"><span>Helper.<span style="color:#007f7f">help1</span>();
</span></span><span style="display:flex;"><span>lI(<span style="color:#fff;font-weight:bold">this</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>所以需要把这个方法其他代码都删除，只留最后这三行。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> lI(InputStream var1) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">l0if</span> = l10if.<span style="color:#007f7f">lf</span>;
</span></span><span style="display:flex;"><span>    Helper.<span style="color:#007f7f">help1</span>();
</span></span><span style="display:flex;"><span>    lI(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="开始破解">开始破解<a hidden class="anchor" aria-hidden="true" href="#开始破解">#</a></h3>
<p>使用<code>Javassist</code>工具修改class字节码文件。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;dependency&gt;
</span></span><span style="display:flex;"><span>    &lt;groupId&gt;org.javassist&lt;/groupId&gt;
</span></span><span style="display:flex;"><span>    &lt;artifactId&gt;javassist&lt;/artifactId&gt;
</span></span><span style="display:flex;"><span>    &lt;version&gt;3.28.0-GA&lt;/version&gt;
</span></span><span style="display:flex;"><span>&lt;/dependency&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 破解方式一
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> modifyPDFJar() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//这一步是完整的jar包路径,选择自己解压的jar目录</span>
</span></span><span style="display:flex;"><span>            ClassPool.<span style="color:#007f7f">getDefault</span>().<span style="color:#007f7f">insertClassPath</span>(<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\123\\Desktop\\aspose\\aspose-slides-22.5-java\\lib\\aspose-slides-22.5-jdk16.jar&#34;</span>);
</span></span><span style="display:flex;"><span>            CtClass zzZJJClass = ClassPool.<span style="color:#007f7f">getDefault</span>().<span style="color:#007f7f">getCtClass</span>(<span style="color:#0ff;font-weight:bold">&#34;com.aspose.pdf.ADocument&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//从class对象中解析获取所有方法</span>
</span></span><span style="display:flex;"><span>            CtMethod[] methodA = zzZJJClass.<span style="color:#007f7f">getDeclaredMethods</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (CtMethod ctMethod : methodA) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//获取方法获取参数类型</span>
</span></span><span style="display:flex;"><span>                CtClass[] ps = ctMethod.<span style="color:#007f7f">getParameterTypes</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//筛选同名方法，入参是Document</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (ps.<span style="color:#007f7f">length</span> == 0 &amp;&amp; (ctMethod.<span style="color:#007f7f">getName</span>().<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;lj&#34;</span>) || ctMethod.<span style="color:#007f7f">getName</span>().<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;lt&#34;</span>)) ) {
</span></span><span style="display:flex;"><span>                    ctMethod.<span style="color:#007f7f">setBody</span>(<span style="color:#0ff;font-weight:bold">&#34;{return true;}&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (ps.<span style="color:#007f7f">length</span> == 1 &amp;&amp; (ctMethod.<span style="color:#007f7f">getName</span>().<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;lI&#34;</span>)) &amp;&amp; ps[0].<span style="color:#007f7f">getName</span>().<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;com.aspose.pdf.internal.l10k.ly&#34;</span>)) {
</span></span><span style="display:flex;"><span>                    ctMethod.<span style="color:#007f7f">setBody</span>(<span style="color:#0ff;font-weight:bold">&#34;{return true;}&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//这一步就是将破译完的代码放在桌面上</span>
</span></span><span style="display:flex;"><span>            zzZJJClass.<span style="color:#007f7f">writeFile</span>(<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\123\\Desktop\\testAspose&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;错误==&#34;</span> + e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 破解方式二
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> modifyPDFJar() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//这一步是完整的jar包路径,选择自己解压的jar目录</span>
</span></span><span style="display:flex;"><span>        ClassPool.<span style="color:#007f7f">getDefault</span>().<span style="color:#007f7f">insertClassPath</span>(<span style="color:#0ff;font-weight:bold">&#34;D:\\aspose.pdf-21.11-java\\lib\aspose.pdf-21.11.jar&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//获取指定的class文件对象</span>
</span></span><span style="display:flex;"><span>        CtClass zzZJJClass = ClassPool.<span style="color:#007f7f">getDefault</span>().<span style="color:#007f7f">getCtClass</span>(<span style="color:#0ff;font-weight:bold">&#34;com.aspose.pdf.l9f&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//从class对象中解析获取所有方法</span>
</span></span><span style="display:flex;"><span>        CtMethod[] methodA = zzZJJClass.<span style="color:#007f7f">getDeclaredMethods</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (CtMethod ctMethod : methodA) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//获取方法获取参数类型</span>
</span></span><span style="display:flex;"><span>            CtClass[] ps = ctMethod.<span style="color:#007f7f">getParameterTypes</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//筛选同名方法，入参是Document</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (ps.<span style="color:#007f7f">length</span> == 1 &amp;&amp; ctMethod.<span style="color:#007f7f">getName</span>().<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;lI&#34;</span>) &amp;&amp; ps[0].<span style="color:#007f7f">getName</span>().<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;java.io.InputStream&#34;</span>)) {
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ps[0].getName==&#34;</span> + ps[0].<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//替换指定方法的方法体</span>
</span></span><span style="display:flex;"><span>                ctMethod.<span style="color:#007f7f">setBody</span>(<span style="color:#0ff;font-weight:bold">&#34;{this.l0if = com.aspose.pdf.l10if.lf;com.aspose.pdf.internal.imaging.internal.p71.Helper.help1();lI(this);}&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//这一步就是将破译完的代码放在桌面上</span>
</span></span><span style="display:flex;"><span>        zzZJJClass.<span style="color:#007f7f">writeFile</span>(<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\wjy\\Desktop\\&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;错误==&#34;</span> + e);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行修改方法后会在桌面生成 com 修改后的文件夹。</p>
<p>修改jar包里的class。
用解压工具<code>预览</code>jar包（不是解压，是预览），将我们刚才修改好的class文件，直接替换到jar包中。注意路径要正确，比如刚才修改的类<code>l9f</code>的路径是<code>com.aspose.pdf.l9f</code>。我们把class文件放到对应路径，会提示：是否替换。点是，直接替换。</p>
<p>然后删除 jar包里面的<code>.RSA</code>和<code>.SF</code>文件。破解完毕。
重新导入jar包到项目里，测试一下是否成功。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> pdfToSvg() {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 这一行是加载许可证，看情况加或不加。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//        try {</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//            getLicense();</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//        } catch (IOException e) {</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//            e.printStackTrace();</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//        }</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">// pdf </span>
</span></span><span style="display:flex;"><span>        String pdfFileName = <span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\123\\Desktop\\新员工入职培训9.26.pdf&#34;</span>;
</span></span><span style="display:flex;"><span>        String svgFileName = <span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\123\\Desktop\\pdf_output\\pdf_to_svg_out.svg&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Load PDF document</span>
</span></span><span style="display:flex;"><span>        Document doc = <span style="color:#fff;font-weight:bold">new</span> Document(pdfFileName);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Instantiate an object of SvgSaveOptions</span>
</span></span><span style="display:flex;"><span>        SvgSaveOptions saveOptions = <span style="color:#fff;font-weight:bold">new</span> SvgSaveOptions();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Do not compress SVG image to Zip archive</span>
</span></span><span style="display:flex;"><span>        saveOptions.<span style="color:#007f7f">setCompressOutputToZipArchive</span>(<span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Save the output in SVG files</span>
</span></span><span style="display:flex;"><span>        doc.<span style="color:#007f7f">save</span>(svgFileName, saveOptions);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="asposeslides-for-java-2110-破解">Aspose.Slides for Java 21.10 破解<a hidden class="anchor" aria-hidden="true" href="#asposeslides-for-java-2110-破解">#</a></h3>
<p>还是分析加载证书的方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>com.<span style="color:#007f7f">aspose</span>.<span style="color:#007f7f">slides</span>.<span style="color:#007f7f">License</span> license = <span style="color:#fff;font-weight:bold">new</span> com.<span style="color:#007f7f">aspose</span>.<span style="color:#007f7f">slides</span>.<span style="color:#007f7f">License</span>();
</span></span><span style="display:flex;"><span>license.<span style="color:#007f7f">setLicense</span>(byteArrayInputStream);
</span></span></code></pre></td></tr></table>
</div>
</div><p>看下来发现<code>setLicense</code>的两个重载方法最终都调用了43行<code>var7.do(var2);</code> 也就是public类里的 <code>do</code>方法，由于<code>public</code>和<code>do</code>是修饰符，所以先找到上方导入的public类路径
<code>import com.aspose.slides.internal.of.public;，</code>然后进入到依赖引用的of目录去搜索找到<code>public</code>类，然后进入public类看到do方法。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">void</span> do(InputStream var1) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (var1 != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">if</span>(var1);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">for</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">for</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">do</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">do</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">int</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">new</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">native</span>.<span style="color:#007f7f">do</span>(<span style="color:#fff;font-weight:bold">try</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">native</span>.<span style="color:#007f7f">do</span>(<span style="color:#fff;font-weight:bold">try</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>此时不要慌，慢慢分析发现<code>native.do(try);</code>应该是关键代码，继续找到这个方法。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> do(Node var0, Node var1, String[] var2) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>    ......
</span></span></code></pre></td></tr></table>
</div>
</div><p>方法里面带有RSA这种加密的关键词，所以推测这里就是验证用的方法。也不知道这个方法咋执行的，老方法，直接把这个方法的内容清空。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>private <span style="color:#fff;font-weight:bold">static</span> void <span style="color:#fff;font-weight:bold">do</span>(Node var0, Node var1, String[] var2) {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 Javassist修改class字节码文件。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 修改slides.jar包里面的校验
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> modifyPptJar() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//这一步是完整的jar包路径,选择自己解压的jar目录</span>
</span></span><span style="display:flex;"><span>        ClassPool.<span style="color:#007f7f">getDefault</span>().<span style="color:#007f7f">insertClassPath</span>(<span style="color:#0ff;font-weight:bold">&#34;D:\\aspose-slides-21.10-java\\lib\\aspose-slides-21.10-jdk16.jar&#34;</span>);
</span></span><span style="display:flex;"><span>        CtClass zzZJJClass = ClassPool.<span style="color:#007f7f">getDefault</span>().<span style="color:#007f7f">getCtClass</span>(<span style="color:#0ff;font-weight:bold">&#34;com.aspose.slides.internal.of.public&#34;</span>);
</span></span><span style="display:flex;"><span>        CtMethod[] methodA = zzZJJClass.<span style="color:#007f7f">getDeclaredMethods</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (CtMethod ctMethod : methodA) {
</span></span><span style="display:flex;"><span>            CtClass[] ps = ctMethod.<span style="color:#007f7f">getParameterTypes</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (ps.<span style="color:#007f7f">length</span> == 3 &amp;&amp; ctMethod.<span style="color:#007f7f">getName</span>().<span style="color:#007f7f">equals</span>(<span style="color:#0ff;font-weight:bold">&#34;do&#34;</span>)) {
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ps[0].getName==&#34;</span> + ps[0].<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>                ctMethod.<span style="color:#007f7f">setBody</span>(<span style="color:#0ff;font-weight:bold">&#34;{}&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//这一步就是将破译完的代码放在桌面上</span>
</span></span><span style="display:flex;"><span>        zzZJJClass.<span style="color:#007f7f">writeFile</span>(<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\roc\\Desktop\\&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;错误==&#34;</span> + e);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后按照路径将我们生成的 class 文件替换到 jar包的对应路径，并且删除jar包里面的.RSA和.SF文件。然后重新导入jar包测试。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> pptToSvg() {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// instantiate a Presentation object that represents a PPTX file</span>
</span></span><span style="display:flex;"><span>        Presentation pres = <span style="color:#fff;font-weight:bold">new</span> Presentation(<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\123\\Desktop\\第四单元 综合性学习 走进小说天地(共14张PPT).ppt&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            ByteArrayInputStream byteArrayInputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayInputStream(licenseStr.<span style="color:#007f7f">getBytes</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>));
</span></span><span style="display:flex;"><span>            com.<span style="color:#007f7f">aspose</span>.<span style="color:#007f7f">slides</span>.<span style="color:#007f7f">License</span> license = <span style="color:#fff;font-weight:bold">new</span> com.<span style="color:#007f7f">aspose</span>.<span style="color:#007f7f">slides</span>.<span style="color:#007f7f">License</span>();
</span></span><span style="display:flex;"><span>            license.<span style="color:#007f7f">setLicense</span>(byteArrayInputStream);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            SVGOptions svgOptions = <span style="color:#fff;font-weight:bold">new</span> SVGOptions();
</span></span><span style="display:flex;"><span>            svgOptions.<span style="color:#007f7f">setPicturesCompression</span>(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> a = 0;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (ISlide i : pres.<span style="color:#007f7f">getSlides</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// Access the first slide</span>
</span></span><span style="display:flex;"><span>                ISlide sld = i;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// Create a memory stream object</span>
</span></span><span style="display:flex;"><span>                FileOutputStream svgStream = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;C:\\Users\\123\\Desktop\\ppt_output\\output&#34;</span>+ a +<span style="color:#0ff;font-weight:bold">&#34; .svg&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// Create SVG image of slide and save in memory stream</span>
</span></span><span style="display:flex;"><span>                sld.<span style="color:#007f7f">writeAsSvg</span>(svgStream,svgOptions);
</span></span><span style="display:flex;"><span>                svgStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                a++;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            pres.<span style="color:#007f7f">dispose</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>成功！</p>
<h1 id="使用serverless将oss文件打包下载">使用Serverless将OSS文件打包下载<a hidden class="anchor" aria-hidden="true" href="#使用serverless将oss文件打包下载">#</a></h1>
<p>如果不使用serverless，想要打包下载阿里云OSS的文件，思路是：</p>
<ul>
<li>首先拿到想要下载的文件的oss url列表。</li>
<li>然后通过流读取oss文件到内存</li>
<li>将文件在内存中打包成ZIP</li>
<li>通过<code>HttpServletResponse</code> 响应给前端</li>
</ul>
<p>这样的缺点是：</p>
<ul>
<li>通过url 从 oss 读取文件很耗时，oss 内网地址还好，如果是 oss 公网地址，还会消耗服务器的入口带宽。</li>
<li>通过<code>HttpServletResponse</code> 响应给前端，非常消耗服务器的出口带宽。</li>
</ul>
<p>实现代码如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> downZip(List&lt;String&gt; urlList,List&lt;String&gt; fileNameList,HttpServletRequest request, HttpServletResponse response) {        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>    String fileName = <span style="color:#0ff;font-weight:bold">&#34;stzy.zip&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 创建临时文件</span>
</span></span><span style="display:flex;"><span>    File zipFile = File.<span style="color:#007f7f">createTempFile</span>(<span style="color:#0ff;font-weight:bold">&#34;stzy&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;.zip&#34;</span>);
</span></span><span style="display:flex;"><span>    FileOutputStream f = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(zipFile);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//作用是为任何OutputStream产生校验</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//第一个参数是制定产生校验和的输出流，第二个参数是指定Checksum的类型 （Adler32（较快）和CRC32两种）</span>
</span></span><span style="display:flex;"><span>    CheckedOutputStream csum = <span style="color:#fff;font-weight:bold">new</span> CheckedOutputStream(f, <span style="color:#fff;font-weight:bold">new</span> Adler32());
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//用于将数据压缩成Zip文件格式</span>
</span></span><span style="display:flex;"><span>    ZipOutputStream zos = <span style="color:#fff;font-weight:bold">new</span> ZipOutputStream(csum);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; urlList.<span style="color:#007f7f">size</span>(); i++) {
</span></span><span style="display:flex;"><span>        InputStream inputStream = loadFileFromUrl(urlList.<span style="color:#007f7f">get</span>(i));
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//zip设置文件名</span>
</span></span><span style="display:flex;"><span>        zos.<span style="color:#007f7f">putNextEntry</span>(<span style="color:#fff;font-weight:bold">new</span> ZipEntry(fileNameList.<span style="color:#007f7f">get</span>(i) + <span style="color:#0ff;font-weight:bold">&#34;.&#34;</span> + FileTypeUtil.<span style="color:#007f7f">getFileExtName</span>(urlList.<span style="color:#007f7f">get</span>(i))));
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> bytesRead = 0;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 向压缩文件中输出数据</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> ((bytesRead = inputStream.<span style="color:#007f7f">read</span>()) != -1) {
</span></span><span style="display:flex;"><span>            zos.<span style="color:#007f7f">write</span>(bytesRead);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        inputStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 当前文件写完，定位为写入下一条项目</span>
</span></span><span style="display:flex;"><span>        zos.<span style="color:#007f7f">closeEntry</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    zos.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    String header = request.<span style="color:#007f7f">getHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;User-Agent&#34;</span>).<span style="color:#007f7f">toUpperCase</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (header.<span style="color:#007f7f">contains</span>(<span style="color:#0ff;font-weight:bold">&#34;MSIE&#34;</span>) || header.<span style="color:#007f7f">contains</span>(<span style="color:#0ff;font-weight:bold">&#34;TRIDENT&#34;</span>) || header.<span style="color:#007f7f">contains</span>(<span style="color:#0ff;font-weight:bold">&#34;EDGE&#34;</span>)) {
</span></span><span style="display:flex;"><span>        fileName = URLEncoder.<span style="color:#007f7f">encode</span>(fileName, <span style="color:#0ff;font-weight:bold">&#34;utf-8&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//IE下载文件名空格变+号问题</span>
</span></span><span style="display:flex;"><span>        fileName = fileName.<span style="color:#007f7f">replace</span>(<span style="color:#0ff;font-weight:bold">&#34;+&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;%20&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        fileName = <span style="color:#fff;font-weight:bold">new</span> String(fileName.<span style="color:#007f7f">getBytes</span>(), <span style="color:#0ff;font-weight:bold">&#34;ISO8859-1&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    response.<span style="color:#007f7f">reset</span>();
</span></span><span style="display:flex;"><span>    response.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;text/plain&#34;</span>);
</span></span><span style="display:flex;"><span>    response.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;application/octet-stream; charset=utf-8&#34;</span>);
</span></span><span style="display:flex;"><span>    response.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Location&#34;</span>, fileName);
</span></span><span style="display:flex;"><span>    response.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Cache-Control&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;max-age=0&#34;</span>);
</span></span><span style="display:flex;"><span>    response.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Content-Disposition&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;attachment; filename=&#34;</span> + fileName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    FileInputStream fis = <span style="color:#fff;font-weight:bold">new</span> FileInputStream(zipFile);
</span></span><span style="display:flex;"><span>    BufferedInputStream buff = <span style="color:#fff;font-weight:bold">new</span> BufferedInputStream(fis);
</span></span><span style="display:flex;"><span>    BufferedOutputStream out = <span style="color:#fff;font-weight:bold">new</span> BufferedOutputStream(response.<span style="color:#007f7f">getOutputStream</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">byte</span>[] car = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[1024];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> l = 0;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> (l &lt; zipFile.<span style="color:#007f7f">length</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> j = buff.<span style="color:#007f7f">read</span>(car, 0, 1024);
</span></span><span style="display:flex;"><span>        l += j;
</span></span><span style="display:flex;"><span>        out.<span style="color:#007f7f">write</span>(car, 0, j);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 关闭流</span>
</span></span><span style="display:flex;"><span>    fis.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    buff.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    out.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 删除临时文件</span>
</span></span><span style="display:flex;"><span>    zipFile.<span style="color:#007f7f">delete</span>();
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>                                                                                                                                    }
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="使用函数计算打包下载oss文件">使用函数计算打包下载OSS文件<a hidden class="anchor" aria-hidden="true" href="#使用函数计算打包下载oss文件">#</a></h2>
<p>需要注意：阿里云函数计算是收费的，不过有每月免费次数和流量。</p>
<p>官网的方法
<a href="https://www.alibabacloud.com/help/zh/object-storage-service/latest/use-function-compute-to-download-multiple-objects-as-a-package">https://www.alibabacloud.com/help/zh/object-storage-service/latest/use-function-compute-to-download-multiple-objects-as-a-package</a>
然而官方给的方法只能打包下载指定路径下的文件。我期望的是，指定几个oss文件的url，就可以直接下载。</p>
<p>参考：https://blog.csdn.net/whzhaochao/article/details/119823374</p>
<h3 id="创建maven项目添加阿里云函数计算依赖">创建Maven项目，添加阿里云函数计算依赖<a hidden class="anchor" aria-hidden="true" href="#创建maven项目添加阿里云函数计算依赖">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;groupId&gt;</span>com.aliyun.fc.runtime<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;artifactId&gt;</span>fc-java-core<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;version&gt;</span>1.4.0<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;groupId&gt;</span>com.aliyun.fc.runtime<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;artifactId&gt;</span>fc-java-common<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;version&gt;</span>2.2.2<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;groupId&gt;</span>commons-io<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;artifactId&gt;</span>commons-io<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;version&gt;</span>2.11.0<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;build&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;finalName&gt;</span>zip-oss<span style="font-weight:bold">&lt;/finalName&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;plugins&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&lt;artifactId&gt;</span>maven-dependency-plugin<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&lt;executions&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&lt;execution&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&lt;id&gt;</span>copy-dependencies<span style="font-weight:bold">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&lt;phase&gt;</span>prepare-package<span style="font-weight:bold">&lt;/phase&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&lt;goals&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&lt;goal&gt;</span>copy-dependencies<span style="font-weight:bold">&lt;/goal&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&lt;outputDirectory&gt;</span>${project.build.directory}/classes/lib<span style="font-weight:bold">&lt;/outputDirectory&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="font-weight:bold">&lt;includeScope&gt;</span>runtime<span style="font-weight:bold">&lt;/includeScope&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">&lt;/execution&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&lt;/executions&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/plugins&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/build&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="实现http触发接口">实现Http触发接口<a hidden class="anchor" aria-hidden="true" href="#实现http触发接口">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">184
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.makezip;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aliyun.fc.runtime.Context;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aliyun.fc.runtime.Credentials;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aliyun.fc.runtime.HttpRequestHandler;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aliyun.oss.*;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aliyun.oss.internal.OSSHeaders;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.aliyun.oss.model.*;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.commons.io.IOUtils;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.commons.lang.StringUtils;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.servlet.http.HttpServletRequest;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.servlet.http.HttpServletResponse;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.ByteArrayInputStream;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.ByteArrayOutputStream;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.OutputStream;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.time.LocalDate;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.UUID;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.zip.ZipEntry;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.zip.ZipOutputStream;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @author: wjy
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @Date: Create in 14:48 2022/5/31
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @description :
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> App <span style="color:#fff;font-weight:bold">implements</span> HttpRequestHandler {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String endpoint = <span style="color:#0ff;font-weight:bold">&#34;oss-cn-beijing-internal.aliyuncs.com&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String bucket = <span style="color:#0ff;font-weight:bold">&#34;zw-zhizhi&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// bucket 后的第一个文件夹名</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String filePath = <span style="color:#0ff;font-weight:bold">&#34;zipFile&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 文件扩展名</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String extName = <span style="color:#0ff;font-weight:bold">&#34;zip&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String filePrefix = <span style="color:#0ff;font-weight:bold">&#34;https://zw-zhizhi.oss-cn-beijing.aliyuncs.com&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 返回 文件url
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 必须重写 handleRequest 方法
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handleRequest(HttpServletRequest request, HttpServletResponse response, Context context) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        String objectKey = request.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;q&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (StringUtils.<span style="color:#007f7f">isBlank</span>(objectKey)) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> ;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        OSS oss = getOssClient(context);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ByteArrayOutputStream byteArrayOutputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>        ZipOutputStream zipOutputStream = <span style="color:#fff;font-weight:bold">new</span> ZipOutputStream(byteArrayOutputStream);
</span></span><span style="display:flex;"><span>        String[] objectKeys = objectKey.<span style="color:#007f7f">split</span>(<span style="color:#0ff;font-weight:bold">&#34;,&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (String key : objectKeys) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// stzy/163/2022-06-15/0bddb05d-bb0d-4821-a4e0-4ad36ca04d32/abc.pptx</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 因为 key 是有层级的，但是这里我不想要层级，所以直接对oss的objectKey进行处理</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 如果ZIP包需要层级，则不处理objectKey</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            OSSObject ossObject = oss.<span style="color:#007f7f">getObject</span>(bucket, key);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (ossObject == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            ZipEntry zipEntry = <span style="color:#fff;font-weight:bold">new</span> ZipEntry(getFileName(key));
</span></span><span style="display:flex;"><span>            zipOutputStream.<span style="color:#007f7f">putNextEntry</span>(zipEntry);
</span></span><span style="display:flex;"><span>            IOUtils.<span style="color:#007f7f">copy</span>(ossObject.<span style="color:#007f7f">getObjectContent</span>(), zipOutputStream);
</span></span><span style="display:flex;"><span>            ossObject.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        zipOutputStream.<span style="color:#007f7f">closeEntry</span>();
</span></span><span style="display:flex;"><span>        zipOutputStream.<span style="color:#007f7f">finish</span>();
</span></span><span style="display:flex;"><span>        byteArrayOutputStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String fileUrl = uploadToOss(oss, byteArrayOutputStream.<span style="color:#007f7f">toByteArray</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setCharacterEncoding</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Content-Type&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;application/json&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Access-Control-Allow-Credentials&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Access-Control-Allow-Methods&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;GET, POST&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Access-Control-Allow-Origin&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;*&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Access-Control-Max-Age&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;3600&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setStatus</span>(HttpServletResponse.<span style="color:#007f7f">SC_OK</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;application/json;charset=UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        OutputStream out = response.<span style="color:#007f7f">getOutputStream</span>();
</span></span><span style="display:flex;"><span>        out.<span style="color:#007f7f">write</span>((fileUrl).<span style="color:#007f7f">getBytes</span>());
</span></span><span style="display:flex;"><span>        out.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>        out.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> OSS getOssClient(Context context) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 获取oss凭据</span>
</span></span><span style="display:flex;"><span>        Credentials creds = context.<span style="color:#007f7f">getExecutionCredentials</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> OSSClientBuilder().<span style="color:#007f7f">build</span>(endpoint, <span style="color:#0ff;font-weight:bold">&#34;你的accessKey&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;你的secretAccess&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 直接返回流，不推荐
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 会走公网带宽，很贵
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> getZipOutPutStream(HttpServletRequest request, HttpServletResponse response, Context context) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        String objectKey = request.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;q&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (StringUtils.<span style="color:#007f7f">isBlank</span>(objectKey)) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 获取oss凭据</span>
</span></span><span style="display:flex;"><span>        Credentials creds = context.<span style="color:#007f7f">getExecutionCredentials</span>();
</span></span><span style="display:flex;"><span>        OSS oss = <span style="color:#fff;font-weight:bold">new</span> OSSClientBuilder().<span style="color:#007f7f">build</span>(endpoint, creds.<span style="color:#007f7f">getAccessKeyId</span>(), creds.<span style="color:#007f7f">getAccessKeySecret</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;application/x-zip-compressed&#34;</span>);
</span></span><span style="display:flex;"><span>        ZipOutputStream zipOutputStream = <span style="color:#fff;font-weight:bold">new</span> ZipOutputStream(response.<span style="color:#007f7f">getOutputStream</span>());
</span></span><span style="display:flex;"><span>        String[] objectKeys = objectKey.<span style="color:#007f7f">split</span>(<span style="color:#0ff;font-weight:bold">&#34;,&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (String key : objectKeys) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// stzy/163/2022-06-15/0bddb05d-bb0d-4821-a4e0-4ad36ca04d32/abc.pptx</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 因为 key 是有层级的，但是这里我不想要层级，所以直接对oss的objectKey进行处理</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 如果ZIP包需要层级，则不处理objectKey</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            OSSObject ossObject = oss.<span style="color:#007f7f">getObject</span>(bucket, key);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (ossObject == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            ZipEntry zipEntry = <span style="color:#fff;font-weight:bold">new</span> ZipEntry(getFileName(key));
</span></span><span style="display:flex;"><span>            zipOutputStream.<span style="color:#007f7f">putNextEntry</span>(zipEntry);
</span></span><span style="display:flex;"><span>            IOUtils.<span style="color:#007f7f">copy</span>(ossObject.<span style="color:#007f7f">getObjectContent</span>(), zipOutputStream);
</span></span><span style="display:flex;"><span>            ossObject.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        zipOutputStream.<span style="color:#007f7f">closeEntry</span>();
</span></span><span style="display:flex;"><span>        zipOutputStream.<span style="color:#007f7f">finish</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 根据文件路径，获取文件名
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * stzy/163/2022-06-15/0bddb05d-bb0d-4821-a4e0-4ad36ca04d32/abc.pptx
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * abc.pptx
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> String getFileName(String filePath) {
</span></span><span style="display:flex;"><span>        String[] split = filePath.<span style="color:#007f7f">split</span>(<span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> split[split.<span style="color:#007f7f">length</span> - 1];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * byte数组上传到oss
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String uploadToOss(OSS oss, <span style="color:#fff;font-weight:bold">byte</span>[] bytes) {
</span></span><span style="display:flex;"><span>        String objectName = getObjectName(extName, oss);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            ObjectMetadata metadata = <span style="color:#fff;font-weight:bold">new</span> ObjectMetadata();
</span></span><span style="display:flex;"><span>            metadata.<span style="color:#007f7f">setHeader</span>(OSSHeaders.<span style="color:#007f7f">OSS_STORAGE_CLASS</span>, StorageClass.<span style="color:#007f7f">Standard</span>.<span style="color:#007f7f">toString</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//设置可读</span>
</span></span><span style="display:flex;"><span>            metadata.<span style="color:#007f7f">setObjectAcl</span>(CannedAccessControlList.<span style="color:#007f7f">PublicRead</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 创建PutObjectRequest对象。</span>
</span></span><span style="display:flex;"><span>            PutObjectRequest putObjectRequest = <span style="color:#fff;font-weight:bold">new</span> PutObjectRequest(bucket, objectName , <span style="color:#fff;font-weight:bold">new</span> ByteArrayInputStream(bytes), metadata);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 上传文件。</span>
</span></span><span style="display:flex;"><span>            oss.<span style="color:#007f7f">putObject</span>(putObjectRequest);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 返回可访问的url</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> filePrefix + <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span> + objectName;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (OSSException oe) {
</span></span><span style="display:flex;"><span>            oe.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (ClientException ce) {
</span></span><span style="display:flex;"><span>            ce.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (oss != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                oss.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获取oss 文件名
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String getObjectName(String fileExtName, OSS oss) {
</span></span><span style="display:flex;"><span>        String uuid = UUID.<span style="color:#007f7f">randomUUID</span>().<span style="color:#007f7f">toString</span>().<span style="color:#007f7f">replace</span>(<span style="color:#0ff;font-weight:bold">&#34;-&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 生成新的随机文件名</span>
</span></span><span style="display:flex;"><span>        String newFileName = uuid + <span style="color:#0ff;font-weight:bold">&#34;.&#34;</span> + fileExtName;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 拼接文件夹路径 zhizhitest/2022-02-09</span>
</span></span><span style="display:flex;"><span>        String dirPath = filePath + <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span> + LocalDate.<span style="color:#007f7f">now</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 文件完整路径 zhizhitest/2022-02-09/1.png</span>
</span></span><span style="display:flex;"><span>        String objectName = dirPath + <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span> + newFileName;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> objectName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(getFileName(<span style="color:#0ff;font-weight:bold">&#34;stzy/163/2022-06-15/0bddb05d-bb0d-4821-a4e0-4ad36ca04d32/abc.pptx&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>打包
<code>mvn clean package</code></p>
<h3 id="登录阿里云">登录阿里云<a hidden class="anchor" aria-hidden="true" href="#登录阿里云">#</a></h3>
<p>搜索<code>函数计算FC</code>。开通过程此处省略。</p>
<ol>
<li>
<p>左侧<code>服务及函数</code></p>
</li>
<li>
<p>创建服务</p>
</li>
<li>
<p>创建好之后点服务名</p>
</li>
<li>
<p>创建函数，选<code>从零开始创建函数</code>，然后按照提示，一步一步选择
函数名：按需填写，见名知意
运行环境：JAVA8
代码上传方式：通过JAR包上传，然后上传刚才打好的JAR包
请求处理程序类型：处理 HTTP 请求
请求处理程序：<code>com.wjy.makezip.App::handleRequest</code>
配置触发器：名字、不认证、请求方法get、post。</p>
</li>
<li>
<p>然后点刚才创建的函数，点<code>触发器管理</code>，可以看到刚才创建的HTTP触发器，还有公网地址：
<code>https://makezip-oss-service-apnellxecm.cn-beijing.fcapp.run</code></p>
</li>
<li>
<p><a href="https://help.aliyun.com/document_detail/90763.html?spm=5176.fcnext.0.0.150478c8vZYaAm">配置自定义域名 (aliyun.com)</a>
必须配置，不然无法通过http请求直接响应json。官方解释：
如果您在浏览器中直接打开请求地址，将会以附件的方式下载响应。这是因为 Http 触发器会自动在响应头中添加 Content-Disposition: attachment 字段。您可以使用自定义域名避免该问题。</p>
</li>
<li>
<p>自定义域名复制到浏览器，然后在链接后加上我们程序需要的参数：
<code>https://fc.stzy.com/?q=xxx.docx,123.svg,999.png</code>
直接返回了oss地址，成功！</p>
</li>
</ol>
<h1 id="阿里云serverless回调">阿里云Serverless回调<a hidden class="anchor" aria-hidden="true" href="#阿里云serverless回调">#</a></h1>
<p>使用函数计算进行oss文件打包时，遇到一个问题，如果需要将很多的文件进行打包，那么单次请求的相应时间是很长的，可能长达数分钟。这对于用户端来说是不能接受的，前端请求的接口会一直pending，甚至有可能超时。</p>
<p>解决思路自然是，我不等待函数计算的同步结果，期望函数计算打包完成后，能够通过回调的方式，通知到我自己的服务器，将打包的地址告诉我，我再将地址更新到数据库中。</p>
<p>阿里云的函数计算还真提供了这个功能：</p>
<p><a href="https://help.aliyun.com/zh/fc/user-guide/result-callback">https://help.aliyun.com/zh/fc/user-guide/result-callback</a></p>
<p>支持的异步调用目标服务：</p>
<ul>
<li>消息服务MNS</li>
<li>函数计算</li>
<li>事件总线EventBridge</li>
<li>消息队列RocketMQ版</li>
</ul>
<p>我使用的是回调到函数计算。即函数计算A成功后，回调函数计算B。函数计算B是我自己在本地用spring boot 搭建的一个单体应用，需要具备访问数据库（更新数据状态）、nacos（获取配置）、oss（获取oss文件的大小）的功能。</p>
<p>特别注意：触发函数A时，我使用的是http触发器，要想让函数A成功后回调函数B，在请求函数A时，就需要http触发器的异步调用方式。</p>
<p>参考官方文档：https://help.aliyun.com/zh/fc/overview-36</p>
<p>即增加请求头：<code>&quot;X-Fc-Invocation-Type&quot;:&quot;Async&quot;</code></p>
<p>我不知道为什么写文档的人不把这个需求写在结果回调的文档页面。</p>
<p>其他步骤如何实施，参考官方文档。</p>
<h1 id="字节工具类">字节工具类<a hidden class="anchor" aria-hidden="true" href="#字节工具类">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ByteUtil {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(bytesToMb(20916274L));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> Integer KB_SIZE = 2 &lt;&lt; 9;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> Integer MB_SIZE = 2 &lt;&lt; 19;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> Integer GB_SIZE = 2 &lt;&lt; 29;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 字节数转kb
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> BigDecimal bytesToKb(<span style="color:#fff;font-weight:bold">long</span> bytes) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> bytesToUnit(bytes, KB_SIZE);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 字节数转mb
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> BigDecimal bytesToMb(<span style="color:#fff;font-weight:bold">long</span> bytes) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> bytesToUnit(bytes, MB_SIZE);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 字节数转gb
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> BigDecimal bytesToGb(<span style="color:#fff;font-weight:bold">long</span> bytes) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> bytesToUnit(bytes, GB_SIZE);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> BigDecimal bytesToUnit(<span style="color:#fff;font-weight:bold">long</span> bytes, Integer unit) {
</span></span><span style="display:flex;"><span>        BigDecimal size = <span style="color:#fff;font-weight:bold">new</span> BigDecimal(bytes);
</span></span><span style="display:flex;"><span>        BigDecimal u = <span style="color:#fff;font-weight:bold">new</span> BigDecimal(unit);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> size.<span style="color:#007f7f">divide</span>(u, 2, BigDecimal.<span style="color:#007f7f">ROUND_DOWN</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> Long unitToByte(BigDecimal decimal, Integer unit) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> decimal.<span style="color:#007f7f">multiply</span>(BigDecimal.<span style="color:#007f7f">valueOf</span>(unit)).<span style="color:#007f7f">longValue</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> Long kbToByte(BigDecimal decimal) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> decimal.<span style="color:#007f7f">multiply</span>(BigDecimal.<span style="color:#007f7f">valueOf</span>(KB_SIZE)).<span style="color:#007f7f">longValue</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> Long mbToByte(BigDecimal decimal) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> decimal.<span style="color:#007f7f">multiply</span>(BigDecimal.<span style="color:#007f7f">valueOf</span>(MB_SIZE)).<span style="color:#007f7f">longValue</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> Long gbToByte(BigDecimal decimal) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> decimal.<span style="color:#007f7f">multiply</span>(BigDecimal.<span style="color:#007f7f">valueOf</span>(GB_SIZE)).<span style="color:#007f7f">longValue</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="工具类-1">工具类<a hidden class="anchor" aria-hidden="true" href="#工具类-1">#</a></h1>
<h2 id="collections">Collections<a hidden class="anchor" aria-hidden="true" href="#collections">#</a></h2>
<p>Collections中的方法大部分不建议使用。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Collections.<span style="color:#007f7f">sort</span>(list);<span style="color:#007f7f">//升序</span>
</span></span><span style="display:flex;"><span>Collections.<span style="color:#007f7f">reverse</span>(list);<span style="color:#007f7f">//降序</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Integer max = Collections.<span style="color:#007f7f">max</span>(list);<span style="color:#007f7f">//获取最大值</span>
</span></span><span style="display:flex;"><span>Integer min = Collections.<span style="color:#007f7f">min</span>(list);<span style="color:#007f7f">//获取最小值</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>List&lt;Integer&gt; integers = Collections.<span style="color:#007f7f">synchronizedList</span>(list);<span style="color:#007f7f">//将ArrayList转换成线程安全集合</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Collections.<span style="color:#007f7f">emptyList</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Collections.<span style="color:#007f7f">binarySearch</span>(list, 3);<span style="color:#007f7f">//二分查找</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 转换成不可修改集合</span>
</span></span><span style="display:flex;"><span>List&lt;Integer&gt; integers = Collections.<span style="color:#007f7f">unmodifiableList</span>(list);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="collectionutils">CollectionUtils<a hidden class="anchor" aria-hidden="true" href="#collectionutils">#</a></h2>
<p>spring的org.springframework.util包下的CollectionUtils工具类和apache的org.apache.commons.collections包下的CollectionUtils工具类。更推荐使用apache的包下的CollectionUtils工具类，因为它的工具更多更全面。</p>
<h3 id="21-集合判空">2.1 集合判空<a hidden class="anchor" aria-hidden="true" href="#21-集合判空">#</a></h3>
<p>通过CollectionUtils工具类的<code>isEmpty</code>方法可以轻松判断集合是否为空，<code>isNotEmpty</code>方法判断集合不为空。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Integer&gt; list = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>list.<span style="color:#007f7f">add</span>(2);
</span></span><span style="display:flex;"><span>list.<span style="color:#007f7f">add</span>(1);
</span></span><span style="display:flex;"><span>list.<span style="color:#007f7f">add</span>(3);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (CollectionUtils.<span style="color:#007f7f">isEmpty</span>(list)) {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;集合为空&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (CollectionUtils.<span style="color:#007f7f">isNotEmpty</span>(list)) {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;集合不为空&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-对两个集合进行操作">2.2 对两个集合进行操作<a hidden class="anchor" aria-hidden="true" href="#22-对两个集合进行操作">#</a></h3>
<p>有时候我们需要对已有的两个集合进行操作，比如取交集或者并集等。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Integer&gt; list = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>list.<span style="color:#007f7f">add</span>(2);
</span></span><span style="display:flex;"><span>list.<span style="color:#007f7f">add</span>(1);
</span></span><span style="display:flex;"><span>list.<span style="color:#007f7f">add</span>(3);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>List&lt;Integer&gt; list2 = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>list2.<span style="color:#007f7f">add</span>(2);
</span></span><span style="display:flex;"><span>list2.<span style="color:#007f7f">add</span>(4);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//获取并集</span>
</span></span><span style="display:flex;"><span>Collection&lt;Integer&gt; unionList = CollectionUtils.<span style="color:#007f7f">union</span>(list, list2);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(unionList);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//获取交集</span>
</span></span><span style="display:flex;"><span>Collection&lt;Integer&gt; intersectionList = CollectionUtils.<span style="color:#007f7f">intersection</span>(list, list2);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(intersectionList);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//获取交集的补集</span>
</span></span><span style="display:flex;"><span>Collection&lt;Integer&gt; disjunctionList = CollectionUtils.<span style="color:#007f7f">disjunction</span>(list, list2);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(disjunctionList);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//获取差集</span>
</span></span><span style="display:flex;"><span>Collection&lt;Integer&gt; subtractList = CollectionUtils.<span style="color:#007f7f">subtract</span>(list, list2);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(subtractList);
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>[1, 2, 3, 4]
</span></span><span style="display:flex;"><span>[2]
</span></span><span style="display:flex;"><span>[1, 3, 4]
</span></span><span style="display:flex;"><span>[1, 3]
</span></span></code></pre></td></tr></table>
</div>
</div><p>说句实话，对两个集合的操作，在实际工作中用得挺多的，特别是很多批量的场景中。以前我们需要写一堆代码，但没想到有现成的轮子。</p>
<h2 id="lists">Lists<a hidden class="anchor" aria-hidden="true" href="#lists">#</a></h2>
<h3 id="31-创建空集合">3.1 创建空集合<a hidden class="anchor" aria-hidden="true" href="#31-创建空集合">#</a></h3>
<p>有时候，我们想创建一个空集合。这时可以用Lists的<code>newArrayList</code>方法，例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Integer&gt; list = Lists.<span style="color:#007f7f">newArrayList</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="32-快速初始化集合">3.2 快速初始化集合<a hidden class="anchor" aria-hidden="true" href="#32-快速初始化集合">#</a></h3>
<p>有时候，我们想给一个集合中初始化一些元素。这时可以用Lists的newArrayList方法，例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Integer&gt; list = Lists.<span style="color:#007f7f">newArrayList</span>(1, 2, 3);
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>[1, 2, 3]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="33-笛卡尔积">3.3 笛卡尔积<a hidden class="anchor" aria-hidden="true" href="#33-笛卡尔积">#</a></h3>
<p>如果你想将两个集合做<code>笛卡尔积</code>，Lists的<code>cartesianProduct</code>方法可以帮你实现：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Integer&gt; list1 = Lists.<span style="color:#007f7f">newArrayList</span>(1, 2, 3);
</span></span><span style="display:flex;"><span>List&lt;Integer&gt; list2 = Lists.<span style="color:#007f7f">newArrayList</span>(4,5);
</span></span><span style="display:flex;"><span>List&lt;List&lt;Integer&gt;&gt; productList = Lists.<span style="color:#007f7f">cartesianProduct</span>(list1,list2);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(productList);
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>[[1, 4], [1, 5], [2, 4], [2, 5], [3, 4], [3, 5]]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="34-分页">3.4 分页<a hidden class="anchor" aria-hidden="true" href="#34-分页">#</a></h3>
<p>如果你想将一个<code>大集合</code>分成若干个<code>小集合</code>，可以使用Lists的<code>partition</code>方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Integer&gt; list = Lists.<span style="color:#007f7f">newArrayList</span>(1, 2, 3, 4, 5);
</span></span><span style="display:flex;"><span>List&lt;List&lt;Integer&gt;&gt; partitionList = Lists.<span style="color:#007f7f">partition</span>(list, 2);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(partitionList);
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>[[1, 2], [3, 4], [5]]
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个例子中，list有5条数据，我将list集合按大小为2，分成了3页，即变成3个小集合。</p>
<p>这个是我最喜欢的方法之一，经常在项目中使用。</p>
<p>比如有个需求：现在有5000个id，需要调用批量用户查询接口，查出用户数据。但如果你直接查5000个用户，单次接口响应时间可能会非常慢。如果改成分页处理，每次只查500个用户，异步调用10次接口，就不会有单次接口响应慢的问题。</p>
<h3 id="35-流处理">3.5 流处理<a hidden class="anchor" aria-hidden="true" href="#35-流处理">#</a></h3>
<p>如果我们想把某个集合转换成另外一个接口，可以使用Lists的
<code>transform</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;String&gt; list = Lists.<span style="color:#007f7f">newArrayList</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;b&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>);
</span></span><span style="display:flex;"><span>List&lt;String&gt; transformList = Lists.<span style="color:#007f7f">transform</span>(list, x -&gt; x.<span style="color:#007f7f">toUpperCase</span>());
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(transformList);
</span></span></code></pre></td></tr></table>
</div>
</div><p>将小写字母转换成了大写字母。</p>
<h3 id="36-颠倒顺序">3.6 颠倒顺序<a hidden class="anchor" aria-hidden="true" href="#36-颠倒顺序">#</a></h3>
<p>Lists的有颠倒顺序的方法<code>reverse</code>。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;Integer&gt; list = Lists.<span style="color:#007f7f">newArrayList</span>(3, 1, 2);
</span></span><span style="display:flex;"><span>List&lt;Integer&gt; reverseList = Lists.<span style="color:#007f7f">reverse</span>(list);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(reverseList);
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>[2, 1, 3]
</span></span></code></pre></td></tr></table>
</div>
</div><p>list的原始顺序是312，使用<code>reverse</code>方法颠倒顺序之后，变成了213。</p>
<h2 id="objects">Objects<a hidden class="anchor" aria-hidden="true" href="#objects">#</a></h2>
<p>在<code>jdk7</code>之后，提供了<code>Objects</code>工具类，我们可以通过它操作对象。</p>
<h3 id="41-对象判空">4.1 对象判空<a hidden class="anchor" aria-hidden="true" href="#41-对象判空">#</a></h3>
<p>在java中万事万物皆对象，对象的判空可以说无处不在。Objects的<code>isNull</code>方法判断对象是否为空，而<code>nonNull</code>方法判断对象是否不为空。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Integer integer = <span style="color:#fff;font-weight:bold">new</span> Integer(1);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (Objects.<span style="color:#007f7f">isNull</span>(integer)) {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;对象为空&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> (Objects.<span style="color:#007f7f">nonNull</span>(integer)) {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;对象不为空&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="42-对象为空抛异常">4.2 对象为空抛异常<a hidden class="anchor" aria-hidden="true" href="#42-对象为空抛异常">#</a></h3>
<p>如果我们想在对象为空时，抛出空指针异常，可以使用Objects的<code>requireNonNull</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Integer integer1 = <span style="color:#fff;font-weight:bold">new</span> Integer(128);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Objects.<span style="color:#007f7f">requireNonNull</span>(integer1);
</span></span><span style="display:flex;"><span>Objects.<span style="color:#007f7f">requireNonNull</span>(integer1, <span style="color:#0ff;font-weight:bold">&#34;参数不能为空&#34;</span>);
</span></span><span style="display:flex;"><span>Objects.<span style="color:#007f7f">requireNonNull</span>(integer1, () -&gt; <span style="color:#0ff;font-weight:bold">&#34;参数不能为空&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="43-判断两个对象是否相等">4.3 判断两个对象是否相等<a hidden class="anchor" aria-hidden="true" href="#43-判断两个对象是否相等">#</a></h3>
<p>我们经常需要判断两个对象是否相等，Objects给我们提供了<code>equals</code>方法，能非常方便的实现：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Integer integer1 = <span style="color:#fff;font-weight:bold">new</span> Integer(1);
</span></span><span style="display:flex;"><span>Integer integer2 = <span style="color:#fff;font-weight:bold">new</span> Integer(1);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Objects.<span style="color:#007f7f">equals</span>(integer1, integer2));
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但使用这个方法有坑，比如例子改成：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Integer integer1 = <span style="color:#fff;font-weight:bold">new</span> Integer(1);
</span></span><span style="display:flex;"><span>Long integer2 = <span style="color:#fff;font-weight:bold">new</span> Long(1);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Objects.<span style="color:#007f7f">equals</span>(integer1, integer2));
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">false</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="44-获取对象的hashcode">4.4 获取对象的hashCode<a hidden class="anchor" aria-hidden="true" href="#44-获取对象的hashcode">#</a></h3>
<p>如果你想获取某个对象的hashCode，可以使用Objects的<code>hashCode</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String str = <span style="color:#fff;font-weight:bold">new</span> String(<span style="color:#0ff;font-weight:bold">&#34;abc&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Objects.<span style="color:#007f7f">hashCode</span>(str));
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>96354
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="stringutils">StringUtils<a hidden class="anchor" aria-hidden="true" href="#stringutils">#</a></h2>
<p><code>org.apache.commons.lang3</code>包下的<code>StringUtils</code>工具类，给我们提供了非常丰富的选择。</p>
<p>其实空字符串，不只是null一种，还有&quot;&quot;，&quot; &ldquo;，&ldquo;null&quot;等等，多种情况。</p>
<p>StringUtils给我们提供了多个判空的静态方法，例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String str1 = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>String str2 = <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>String str3 = <span style="color:#0ff;font-weight:bold">&#34; &#34;</span>;
</span></span><span style="display:flex;"><span>String str4 = <span style="color:#0ff;font-weight:bold">&#34;abc&#34;</span>;
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isEmpty</span>(str1));<span style="color:#007f7f">//true</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isEmpty</span>(str2));<span style="color:#007f7f">//true</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isEmpty</span>(str3));<span style="color:#007f7f">//false</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isEmpty</span>(str4));<span style="color:#007f7f">//false</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=====&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNotEmpty</span>(str1));<span style="color:#007f7f">//false</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNotEmpty</span>(str2));<span style="color:#007f7f">//false</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNotEmpty</span>(str3));<span style="color:#007f7f">//true</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNotEmpty</span>(str4));<span style="color:#007f7f">//true</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=====&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isBlank</span>(str1));<span style="color:#007f7f">//true</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isBlank</span>(str2));<span style="color:#007f7f">//true</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isBlank</span>(str3));<span style="color:#007f7f">//true</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isBlank</span>(str4));<span style="color:#007f7f">//false</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=====&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNotBlank</span>(str1));<span style="color:#007f7f">//false</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNotBlank</span>(str2));<span style="color:#007f7f">//false</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNotBlank</span>(str3));<span style="color:#007f7f">//false</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNotBlank</span>(str4));<span style="color:#007f7f">//true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>示例中的：<code>isEmpty</code>、<code>isNotEmpty</code>、<code>isBlank</code>和<code>isNotBlank</code>，这4个判空方法你们可以根据实际情况使用。</p>
<blockquote>
<p>优先推荐使用<code>isBlank</code>和<code>isNotBlank</code>方法，因为它会把<code>&quot; &quot;</code>也考虑进去。</p>
</blockquote>
<h3 id="62-分隔字符串">6.2 分隔字符串<a hidden class="anchor" aria-hidden="true" href="#62-分隔字符串">#</a></h3>
<p>分隔字符串是常见需求，如果直接使用String类的split方法，就可能会出现空指针异常。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String str1 = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">split</span>(str1,<span style="color:#0ff;font-weight:bold">&#34;,&#34;</span>));
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(str1.<span style="color:#007f7f">split</span>(<span style="color:#0ff;font-weight:bold">&#34;,&#34;</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>Exception in thread <span style="color:#0ff;font-weight:bold">&#34;main&#34;</span> java.<span style="color:#007f7f">lang</span>.<span style="color:#007f7f">NullPointerException</span>
</span></span><span style="display:flex;"><span>	at com.<span style="color:#007f7f">sue</span>.<span style="color:#007f7f">jump</span>.<span style="color:#007f7f">service</span>.<span style="color:#007f7f">test1</span>.<span style="color:#007f7f">UtilTest</span>.<span style="color:#007f7f">main</span>(UtilTest.<span style="color:#007f7f">java</span>:21)
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用StringUtils的split方法会返回null，而使用String的split方法会报指针异常。</p>
<h3 id="63-判断是否纯数字">6.3 判断是否纯数字<a hidden class="anchor" aria-hidden="true" href="#63-判断是否纯数字">#</a></h3>
<p>给定一个字符串，判断它是否为纯数字，可以使用<code>isNumeric</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String str1 = <span style="color:#0ff;font-weight:bold">&#34;123&#34;</span>;
</span></span><span style="display:flex;"><span>String str2 = <span style="color:#0ff;font-weight:bold">&#34;123q&#34;</span>;
</span></span><span style="display:flex;"><span>String str3 = <span style="color:#0ff;font-weight:bold">&#34;0.33&#34;</span>;
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNumeric</span>(str1));<span style="color:#007f7f">//true</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNumeric</span>(str2));<span style="color:#007f7f">//false</span>
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(StringUtils.<span style="color:#007f7f">isNumeric</span>(str3));<span style="color:#007f7f">//false</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="assert">Assert<a hidden class="anchor" aria-hidden="true" href="#assert">#</a></h2>
<p>很多时候，我们需要在代码中做判断：如果不满足条件，则抛异常。有没有统一的封装呢?</p>
<p>其实<code>spring</code>给我们提供了<code>Assert</code>类，它表示<code>断言</code>。</p>
<h3 id="71-断言参数是否为空">7.1 断言参数是否为空<a hidden class="anchor" aria-hidden="true" href="#71-断言参数是否为空">#</a></h3>
<p>断言<code>参数</code>是否空，如果不满足条件，则直接抛异常。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String str = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>Assert.<span style="color:#007f7f">isNull</span>(str, <span style="color:#0ff;font-weight:bold">&#34;str必须为空&#34;</span>);
</span></span><span style="display:flex;"><span>Assert.<span style="color:#007f7f">isNull</span>(str, () -&gt; <span style="color:#0ff;font-weight:bold">&#34;str必须为空&#34;</span>);
</span></span><span style="display:flex;"><span>Assert.<span style="color:#007f7f">notNull</span>(str, <span style="color:#0ff;font-weight:bold">&#34;str不能为空&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果不满足条件就会抛出<code>IllegalArgumentException</code>异常。</p>
<h3 id="72-断言集合是否为空">7.2 断言集合是否为空<a hidden class="anchor" aria-hidden="true" href="#72-断言集合是否为空">#</a></h3>
<p>断言<code>集合</code>是否空，如果不满足条件，则直接抛异常。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;String&gt; list = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>Map&lt;String, String&gt; map = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>Assert.<span style="color:#007f7f">notEmpty</span>(list, <span style="color:#0ff;font-weight:bold">&#34;list不能为空&#34;</span>);
</span></span><span style="display:flex;"><span>Assert.<span style="color:#007f7f">notEmpty</span>(list, () -&gt; <span style="color:#0ff;font-weight:bold">&#34;list不能为空&#34;</span>);
</span></span><span style="display:flex;"><span>Assert.<span style="color:#007f7f">notEmpty</span>(map, <span style="color:#0ff;font-weight:bold">&#34;map不能为空&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果不满足条件就会抛出<code>IllegalArgumentException</code>异常。</p>
<h3 id="73-断言条件是否为空">7.3 断言条件是否为空<a hidden class="anchor" aria-hidden="true" href="#73-断言条件是否为空">#</a></h3>
<p>断言是否满足某个<code>条件</code>，如果不满足条件，则直接抛异常。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;String&gt; list = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>Assert.<span style="color:#007f7f">isTrue</span>(CollectionUtils.<span style="color:#007f7f">isNotEmpty</span>(list), <span style="color:#0ff;font-weight:bold">&#34;list不能为空&#34;</span>);
</span></span><span style="display:flex;"><span>Assert.<span style="color:#007f7f">isTrue</span>(CollectionUtils.<span style="color:#007f7f">isNotEmpty</span>(list), () -&gt; <span style="color:#0ff;font-weight:bold">&#34;list不能为空&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="mdc">MDC<a hidden class="anchor" aria-hidden="true" href="#mdc">#</a></h2>
<p><code>MDC</code>是<code>org.slf4j</code>包下的一个类，它的全称是Mapped Diagnostic Context，我们可以认为它是一个线程安全的存放诊断日志的容器。</p>
<p>MDC的底层是用了<code>ThreadLocal</code>来保存数据的。</p>
<p>我们可以用它传递参数。</p>
<p>例如现在有这样一种场景：我们使用<code>RestTemplate</code>调用远程接口时，有时需要在<code>header</code>中传递信息，比如：traceId，source等，便于在查询日志时能够串联一次完整的请求链路，快速定位问题。</p>
<p>这种业务场景就能通过<code>ClientHttpRequestInterceptor</code>接口实现，具体做法如下：</p>
<p>第一步，定义一个LogFilter拦截所有接口请求，在MDC中设置traceId：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LogFilter <span style="color:#fff;font-weight:bold">implements</span> Filter {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> init(FilterConfig filterConfig) <span style="color:#fff;font-weight:bold">throws</span> ServletException {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(ServletRequest request, ServletResponse response, FilterChain chain) <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        MdcUtil.<span style="color:#007f7f">add</span>(UUID.<span style="color:#007f7f">randomUUID</span>().<span style="color:#007f7f">toString</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;记录请求日志&#34;</span>);
</span></span><span style="display:flex;"><span>        chain.<span style="color:#007f7f">doFilter</span>(request, response);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;记录响应日志&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> destroy() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>第二步，实现<code>ClientHttpRequestInterceptor</code>接口，MDC中获取当前请求的traceId，然后设置到header中：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RestTemplateInterceptor <span style="color:#fff;font-weight:bold">implements</span> ClientHttpRequestInterceptor {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ClientHttpResponse intercept(HttpRequest request, <span style="color:#fff;font-weight:bold">byte</span>[] body, ClientHttpRequestExecution execution) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        request.<span style="color:#007f7f">getHeaders</span>().<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;traceId&#34;</span>, MdcUtil.<span style="color:#007f7f">get</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> execution.<span style="color:#007f7f">execute</span>(request, body);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>第三步，定义配置类，配置上面定义的<code>RestTemplateInterceptor</code>类：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RestTemplateConfiguration {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> RestTemplate restTemplate() {
</span></span><span style="display:flex;"><span>        RestTemplate restTemplate = <span style="color:#fff;font-weight:bold">new</span> RestTemplate();
</span></span><span style="display:flex;"><span>        restTemplate.<span style="color:#007f7f">setInterceptors</span>(Collections.<span style="color:#007f7f">singletonList</span>(restTemplateInterceptor()));
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> restTemplate;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> RestTemplateInterceptor restTemplateInterceptor() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> RestTemplateInterceptor();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中MdcUtil其实是利用MDC工具在ThreadLocal中存储和获取traceId</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MdcUtil {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String TRACE_ID = <span style="color:#0ff;font-weight:bold">&#34;TRACE_ID&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> String get() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> MDC.<span style="color:#007f7f">get</span>(TRACE_ID);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> add(String value) {
</span></span><span style="display:flex;"><span>        MDC.<span style="color:#007f7f">put</span>(TRACE_ID, value);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然，这个例子中没有演示MdcUtil类的add方法具体调的地方，我们可以在filter中执行接口方法之前，生成traceId，调用MdcUtil类的add方法添加到MDC中，然后在同一个请求的其他地方就能通过MdcUtil类的get方法获取到该traceId。</p>
<p>能使用MDC保存traceId等参数的根本原因是，用户请求到应用服务器，Tomcat会从线程池中分配一个线程去处理该请求。</p>
<p>那么该请求的整个过程中，保存到MDC的ThreadLocal中的参数，也是该线程独享的，所以不会有线程安全问题。</p>
<h2 id="classutils">ClassUtils<a hidden class="anchor" aria-hidden="true" href="#classutils">#</a></h2>
<p>spring的<code>org.springframework.util</code>包下的<code>ClassUtils</code>类，它里面有很多让我们惊喜的功能。</p>
<p>它里面包含了类和对象相关的很多非常实用的方法。</p>
<h3 id="101-获取对象的所有接口">10.1 获取对象的所有接口<a hidden class="anchor" aria-hidden="true" href="#101-获取对象的所有接口">#</a></h3>
<p>如果你想获取某个对象的所有接口，可以使用ClassUtils的<code>getAllInterfaces</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Class&lt;?&gt;[] allInterfaces = ClassUtils.<span style="color:#007f7f">getAllInterfaces</span>(<span style="color:#fff;font-weight:bold">new</span> User());
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="102-获取某个类的包名">10.2 获取某个类的包名<a hidden class="anchor" aria-hidden="true" href="#102-获取某个类的包名">#</a></h3>
<p>如果你想获取某个类的包名，可以使用ClassUtils的<code>getPackageName</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String packageName = ClassUtils.<span style="color:#007f7f">getPackageName</span>(User.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(packageName);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="103-判断某个类是否内部类">10.3 判断某个类是否内部类<a hidden class="anchor" aria-hidden="true" href="#103-判断某个类是否内部类">#</a></h3>
<p>如果你想判断某个类是否内部类，可以使用ClassUtils的<code>isInnerClass</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(ClassUtils.<span style="color:#007f7f">isInnerClass</span>(User.<span style="color:#007f7f">class</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="104-判断对象是否代理对象">10.4 判断对象是否代理对象<a hidden class="anchor" aria-hidden="true" href="#104-判断对象是否代理对象">#</a></h3>
<p>如果你想判断对象是否代理对象，可以使用ClassUtils的<code>isCglibProxy</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(ClassUtils.<span style="color:#007f7f">isCglibProxy</span>(<span style="color:#fff;font-weight:bold">new</span> User()));
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="beanutils">BeanUtils<a hidden class="anchor" aria-hidden="true" href="#beanutils">#</a></h2>
<p>spring给我们提供了一个<code>JavaBean</code>的工具类，它在<code>org.springframework.beans</code>包下面，它的名字叫做：<code>BeanUtils</code>。</p>
<p>让我们一起看看这个工具可以带给我们哪些惊喜。</p>
<h3 id="111-拷贝对象的属性">11.1 拷贝对象的属性<a hidden class="anchor" aria-hidden="true" href="#111-拷贝对象的属性">#</a></h3>
<p>曾几何时，你有没有这样的需求：把某个对象中的所有属性，都拷贝到另外一个对象中。这时就能使用BeanUtils的<code>copyProperties</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>User user1 = <span style="color:#fff;font-weight:bold">new</span> User();
</span></span><span style="display:flex;"><span>user1.<span style="color:#007f7f">setId</span>(1L);
</span></span><span style="display:flex;"><span>user1.<span style="color:#007f7f">setName</span>(<span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>);
</span></span><span style="display:flex;"><span>user1.<span style="color:#007f7f">setAddress</span>(<span style="color:#0ff;font-weight:bold">&#34;北京&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>User user2 = <span style="color:#fff;font-weight:bold">new</span> User();
</span></span><span style="display:flex;"><span>BeanUtils.<span style="color:#007f7f">copyProperties</span>(user1, user2);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(user2);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="112-实例化某个类">11.2 实例化某个类<a hidden class="anchor" aria-hidden="true" href="#112-实例化某个类">#</a></h3>
<p>如果你想通过反射实例化一个类的对象，可以使用BeanUtils的<code>instantiateClass</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>User user = BeanUtils.<span style="color:#007f7f">instantiateClass</span>(User.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(user);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="113-获取指定类的指定方法">11.3 获取指定类的指定方法<a hidden class="anchor" aria-hidden="true" href="#113-获取指定类的指定方法">#</a></h3>
<p>如果你想获取某个类的指定方法，可以使用BeanUtils的<code>findDeclaredMethod</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Method declaredMethod = BeanUtils.<span style="color:#007f7f">findDeclaredMethod</span>(User.<span style="color:#007f7f">class</span>, <span style="color:#0ff;font-weight:bold">&#34;getId&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(declaredMethod.<span style="color:#007f7f">getName</span>());
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="114-获取指定方法的参数">11.4 获取指定方法的参数<a hidden class="anchor" aria-hidden="true" href="#114-获取指定方法的参数">#</a></h3>
<p>如果你想获取某个方法的参数，可以使用BeanUtils的<code>findPropertyForMethod</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Method declaredMethod = BeanUtils.<span style="color:#007f7f">findDeclaredMethod</span>(User.<span style="color:#007f7f">class</span>, <span style="color:#0ff;font-weight:bold">&#34;getId&#34;</span>);
</span></span><span style="display:flex;"><span>PropertyDescriptor propertyForMethod = BeanUtils.<span style="color:#007f7f">findPropertyForMethod</span>(declaredMethod);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(propertyForMethod.<span style="color:#007f7f">getName</span>());
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="reflectionutils">ReflectionUtils<a hidden class="anchor" aria-hidden="true" href="#reflectionutils">#</a></h2>
<p>有时候，我们需要在项目中使用<code>反射</code>功能，如果使用最原始的方法来开发，代码量会非常多，而且很麻烦，它需要处理一大堆异常以及访问权限等问题。</p>
<p>好消息是spring给我们提供了一个<code>ReflectionUtils</code>工具，它在<code>org.springframework.util</code>包下面。</p>
<h3 id="121-获取方法">12.1 获取方法<a hidden class="anchor" aria-hidden="true" href="#121-获取方法">#</a></h3>
<p>如果你想获取某个类的某个方法，可以使用ReflectionUtils类的<code>findMethod</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Method method = ReflectionUtils.<span style="color:#007f7f">findMethod</span>(User.<span style="color:#007f7f">class</span>, <span style="color:#0ff;font-weight:bold">&#34;getId&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="122-获取字段">12.2 获取字段<a hidden class="anchor" aria-hidden="true" href="#122-获取字段">#</a></h3>
<p>如果你想获取某个类的某个字段，可以使用ReflectionUtils类的<code>findField</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Field field = ReflectionUtils.<span style="color:#007f7f">findField</span>(User.<span style="color:#007f7f">class</span>, <span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="123-执行方法">12.3 执行方法<a hidden class="anchor" aria-hidden="true" href="#123-执行方法">#</a></h3>
<p>如果你想通过反射调用某个方法，传递参数，可以使用ReflectionUtils类的<code>invokeMethod</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> ReflectionUtils.<span style="color:#007f7f">invokeMethod</span>(method, springContextsUtil.<span style="color:#007f7f">getBean</span>(beanName), param);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="124-判断字段是否常量">12.4 判断字段是否常量<a hidden class="anchor" aria-hidden="true" href="#124-判断字段是否常量">#</a></h3>
<p>如果你想判断某个字段是否常量，可以使用ReflectionUtils类的<code>isPublicStaticFinal</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Field field = ReflectionUtils.<span style="color:#007f7f">findField</span>(User.<span style="color:#007f7f">class</span>, <span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(ReflectionUtils.<span style="color:#007f7f">isPublicStaticFinal</span>(field));
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="125-判断是否equals方法">12.5 判断是否equals方法<a hidden class="anchor" aria-hidden="true" href="#125-判断是否equals方法">#</a></h3>
<p>如果你想判断某个方法是否equals方法，可以使用ReflectionUtils类的<code>isEqualsMethod</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Method method = ReflectionUtils.<span style="color:#007f7f">findMethod</span>(User.<span style="color:#007f7f">class</span>, <span style="color:#0ff;font-weight:bold">&#34;getId&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(ReflectionUtils.<span style="color:#007f7f">isEqualsMethod</span>(method));
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="base64utils">Base64Utils<a hidden class="anchor" aria-hidden="true" href="#base64utils">#</a></h2>
<p>有时候，为了安全考虑，需要将参数只用<code>base64</code>编码。</p>
<p>这时就能直接使用<code>org.springframework.util</code>包下的<code>Base64Utils</code>工具类。</p>
<p>它里面包含：<code>encode</code>和<code>decode</code>方法，用于对数据进行加密和解密。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String str = <span style="color:#0ff;font-weight:bold">&#34;abc&#34;</span>;
</span></span><span style="display:flex;"><span>String encode = <span style="color:#fff;font-weight:bold">new</span> String(Base64Utils.<span style="color:#007f7f">encode</span>(str.<span style="color:#007f7f">getBytes</span>()));
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;加密后：&#34;</span> + encode);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>    String decode = <span style="color:#fff;font-weight:bold">new</span> String(Base64Utils.<span style="color:#007f7f">decode</span>(encode.<span style="color:#007f7f">getBytes</span>()), <span style="color:#0ff;font-weight:bold">&#34;utf8&#34;</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;解密后：&#34;</span> + decode);
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (UnsupportedEncodingException e) {
</span></span><span style="display:flex;"><span>    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>加密后<span style="color:#f00">：</span>YWJj
</span></span><span style="display:flex;"><span>解密后<span style="color:#f00">：</span>abc
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="14-standardcharsets">14. StandardCharsets<a hidden class="anchor" aria-hidden="true" href="#14-standardcharsets">#</a></h2>
<p>我们在做字符转换的时候，经常需要指定字符编码，比如：UTF-8、ISO-8859-1等等。</p>
<p>这时就可以直接使用<code>java.nio.charset</code>包下的<code>StandardCharsets</code>类中静态变量。</p>
<p>例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String str = <span style="color:#0ff;font-weight:bold">&#34;abc&#34;</span>;
</span></span><span style="display:flex;"><span>String encode = <span style="color:#fff;font-weight:bold">new</span> String(Base64Utils.<span style="color:#007f7f">encode</span>(str.<span style="color:#007f7f">getBytes</span>()));
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;加密后：&#34;</span> + encode);
</span></span><span style="display:flex;"><span>String decode = <span style="color:#fff;font-weight:bold">new</span> String(Base64Utils.<span style="color:#007f7f">decode</span>(encode.<span style="color:#007f7f">getBytes</span>())
</span></span><span style="display:flex;"><span>, StandardCharsets.<span style="color:#007f7f">UTF_8</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;解密后：&#34;</span> + decode);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="15-digestutils">15. DigestUtils<a hidden class="anchor" aria-hidden="true" href="#15-digestutils">#</a></h2>
<p>有时候，我们需要对数据进行加密处理，比如：md5或sha256。</p>
<p>可以使用apache的<code>org.apache.commons.codec.digest</code>包下的<code>DigestUtils</code>类。</p>
<h3 id="151-md5加密">15.1 md5加密<a hidden class="anchor" aria-hidden="true" href="#151-md5加密">#</a></h3>
<p>如果你想对数据进行md5加密，可以使用DigestUtils的<code>md5Hex</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String md5Hex = DigestUtils.<span style="color:#007f7f">md5Hex</span>(<span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(md5Hex);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="152-sha256加密">15.2 sha256加密<a hidden class="anchor" aria-hidden="true" href="#152-sha256加密">#</a></h3>
<p>如果你想对数据进行sha256加密，可以使用DigestUtils的<code>sha256Hex</code>方法。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String md5Hex = DigestUtils.<span style="color:#007f7f">sha256Hex</span>(<span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(md5Hex);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="serializationutils">SerializationUtils<a hidden class="anchor" aria-hidden="true" href="#serializationutils">#</a></h2>
<p>有时候，我们需要把数据进行<code>序列化</code>和<code>反序列化</code>处理。</p>
<p>传统的做法是某个类实现<code>Serializable</code>接口，然后重新它的<code>writeObject</code>和<code>readObject</code>方法。</p>
<p>但如果使用<code>org.springframework.util</code>包下的<code>SerializationUtils</code>工具类，能更轻松实现序列化和反序列化功能。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Map&lt;String, String&gt; map = Maps.<span style="color:#007f7f">newHashMap</span>();
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;b&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>);
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;c&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;3&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">byte</span>[] serialize = SerializationUtils.<span style="color:#007f7f">serialize</span>(map);
</span></span><span style="display:flex;"><span>Object deserialize = SerializationUtils.<span style="color:#007f7f">deserialize</span>(serialize);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(deserialize);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="httpstatus">HttpStatus<a hidden class="anchor" aria-hidden="true" href="#httpstatus">#</a></h2>
<p>很多时候，我们会在代码中定义http的返回码，比如：接口正常返回200，异常返回500，接口找不到返回404，接口不可用返回502等。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> SUCCESS_CODE = 200;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> ERROR_CODE = 500;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> NOT_FOUND_CODE = 404;
</span></span></code></pre></td></tr></table>
</div>
</div><p>其实<code>org.springframework.http</code>包下的HttpStatus枚举，或者<code>org.apache.http</code>包下的<code>HttpStatus</code>接口，已经把常用的http返回码给我们定义好了，直接拿来用就可以了，真的不用再重复定义了。</p>
<h1 id="阿里云视频点播">阿里云视频点播<a hidden class="anchor" aria-hidden="true" href="#阿里云视频点播">#</a></h1>
<p>官方文档：主要参考官方文档，这里只是复制官网文档的部分内容</p>
<p><a href="https://help.aliyun.com/product/29932.html">https://help.aliyun.com/product/29932.html</a></p>
<p>其他参考：https://blog.csdn.net/rigou11/article/details/120492478</p>
<h2 id="hls标准加密">HLS标准加密<a hidden class="anchor" aria-hidden="true" href="#hls标准加密">#</a></h2>
<p>以下内容参考官方文档：</p>
<p><a href="https://help.aliyun.com/document_detail/611819.html">https://help.aliyun.com/document_detail/611819.html</a></p>
<h3 id="加密及解密流程">加密及解密流程<a hidden class="anchor" aria-hidden="true" href="#加密及解密流程">#</a></h3>
<p><img loading="lazy" src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6612199761/p608220.png"></p>
<p><img loading="lazy" src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2661659761/p608221.png"></p>
<h3 id="前提条件每一步都要执行不然后边调接口会有问题">前提条件（每一步都要执行，不然后边调接口会有问题）<a hidden class="anchor" aria-hidden="true" href="#前提条件每一步都要执行不然后边调接口会有问题">#</a></h3>
<ul>
<li>已经开通了视频点播服务。开通步骤请参见<a href="https://help.aliyun.com/document_detail/51512.htm">开通视频点播</a>。</li>
<li>已经开通了密钥管理服务（仅需开通服务，无需购买密钥）。开通后，需要通过<a href="https://yida.alibaba-inc.com/o/ticketapply?spm=a2c4g.11186623.0.0.6b156297X6dFDt#/">填写表单</a>方式申请创建Service Key。</li>
<li>已经授权视频点播访问您密钥管理服务的权限，可以通过<a href="https://ram.console.aliyun.com/role/authorization?request={\"Services\"%3A[{\"Service\"%3A\"VOD\"%2C\"Roles\"%3A[{\"RoleName\"%3A\"AliyunVODDefaultRole\"%2C\"TemplateId\"%3A\"DefaultRole\"}]}]%2C\"ReturnUrl\"%3A\"https%3A%2F%2Fvod.console.aliyun.com%2F\"}">云资源访问授权页面</a>进行授权。</li>
<li>已在视频点播中配置加速域名，具体步骤请参见<a href="https://help.aliyun.com/document_detail/86074.htm">添加加速域名</a>。</li>
<li>已安装视频点播服务端SDK，具体步骤请参见<a href="https://help.aliyun.com/document_detail/101789.htm">服务端SDK</a>。本文以Java语言为例进行说明。</li>
</ul>
<h3 id="加密视频">加密视频<a hidden class="anchor" aria-hidden="true" href="#加密视频">#</a></h3>
<h4 id="创建用于hls标准加密的转码模板组">创建用于HLS标准加密的转码模板组<a hidden class="anchor" aria-hidden="true" href="#创建用于hls标准加密的转码模板组">#</a></h4>
<p>HLS标准加密过程中需要用到两个转码模板组：<strong>不转码</strong>模板组和用于HLS标准加密的模板组。其中，<strong>不转码</strong>模板组为系统内置的模板组，您无需创建可以直接使用；用于HLS标准加密的模板组需要您自行创建。创建方法如下：</p>
<ol>
<li>
<p>登录<a href="https://vod.console.aliyun.com/">视频点播控制台</a>，选择<strong>配置管理 &gt; 媒体处理配置 &gt; 转码模板组</strong>。</p>
</li>
<li>
<p>在转码模板组页面创建用于HLS标准加密的模板组。其中，<strong>封装格式</strong>需设置为<strong>hls</strong>；在<strong>高级参数</strong>区域，必须开启<strong>视频加密</strong>，且加密方式勾选<strong>私有加密</strong>选项；其余参数您可以根据实际需要进行配置，详细的参数解释，请参见<a href="https://help.aliyun.com/document_detail/86068.htm">普通转码模板设置</a>。注意这里不要将该模板设置为默认。
<img loading="lazy" src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1737559761/p608949.png"></p>
</li>
<li>
<p>模板创建完成后，您可以在转码模板组列表页查看转码模板组的ID，请保存该ID用于后续发起HLS标准加密转码时使用。</p>
</li>
</ol>
<h4 id="搭建加密服务">搭建加密服务。<a hidden class="anchor" aria-hidden="true" href="#搭建加密服务">#</a></h4>
<p>就是请求阿里云一个接口，返回一些数据。</p>
<p>调用<a href="https://help.aliyun.com/document_detail/455051.htm?spm=a2c4g.611819.0.0.4ee27e11r0SpBy">GenerateKMSDataKey - 创建KMS数据密钥</a>接口生成数据密钥（DK）和信封数据密钥（EDK）。</p>
<p>调用该接口无需传任何参数，接口调用成功后，返回参数<code>CiphertextBlob</code>即为信封数据密钥（EDK），返回参数<code>Plaintext</code>即为数据密钥（DK）；其中，<code>CiphertextBlob</code>是一个AES_128的密钥，请保存该参数值用于后续发起标准加密转码时传入。</p>
<p>文档：https://help.aliyun.com/document_detail/455051.htm</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>com.aliyun<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>vod20170321<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;version&gt;</span>2.16.14<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">vod20170321</span>.<span style="color:#007f7f">Client</span> createClient(String accessKeyId, String accessKeySecret) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">teaopenapi</span>.<span style="color:#007f7f">models</span>.<span style="color:#007f7f">Config</span> config = <span style="color:#fff;font-weight:bold">new</span> com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">teaopenapi</span>.<span style="color:#007f7f">models</span>.<span style="color:#007f7f">Config</span>()
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 必填，您的 AccessKey ID</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">setAccessKeyId</span>(accessKeyId)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 必填，您的 AccessKey Secret</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">setAccessKeySecret</span>(accessKeySecret);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 访问的域名</span>
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">endpoint</span> = <span style="color:#0ff;font-weight:bold">&#34;vod.cn-shenzhen.aliyuncs.com&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">vod20170321</span>.<span style="color:#007f7f">Client</span>(config);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 搭建加密服务
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> GenerateKMSDataKey(){
</span></span><span style="display:flex;"><span>        com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">vod20170321</span>.<span style="color:#007f7f">Client</span> client = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">vod20170321</span>.<span style="color:#007f7f">models</span>.<span style="color:#007f7f">GenerateKMSDataKeyRequest</span> generateKMSDataKeyRequest = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">teautil</span>.<span style="color:#007f7f">models</span>.<span style="color:#007f7f">RuntimeOptions</span> runtime = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 工程代码泄露可能会导致AccessKey泄露，并威胁账号下所有资源的安全性。以下代码示例仅供参考，建议使用更安全的 STS 方式，更多鉴权访问方式请参见：https://help.aliyun.com/document_detail/378657.html</span>
</span></span><span style="display:flex;"><span>            client = createClient(<span style="color:#0ff;font-weight:bold">&#34;你的key&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;你的secret&#34;</span>);
</span></span><span style="display:flex;"><span>            generateKMSDataKeyRequest = <span style="color:#fff;font-weight:bold">new</span> com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">vod20170321</span>.<span style="color:#007f7f">models</span>.<span style="color:#007f7f">GenerateKMSDataKeyRequest</span>();
</span></span><span style="display:flex;"><span>            runtime = <span style="color:#fff;font-weight:bold">new</span> com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">teautil</span>.<span style="color:#007f7f">models</span>.<span style="color:#007f7f">RuntimeOptions</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 复制代码运行请自行打印 API 的返回值</span>
</span></span><span style="display:flex;"><span>            com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">vod20170321</span>.<span style="color:#007f7f">models</span>.<span style="color:#007f7f">GenerateKMSDataKeyResponse</span> generateKMSDataKeyResponse = client.<span style="color:#007f7f">generateKMSDataKeyWithOptions</span>(generateKMSDataKeyRequest, runtime);
</span></span><span style="display:flex;"><span>            GenerateKMSDataKeyResponseBody responseBody = generateKMSDataKeyResponse.<span style="color:#007f7f">getBody</span>();
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 打印返回值</span>
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(responseBody.<span style="color:#007f7f">getCiphertextBlob</span>());
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(responseBody.<span style="color:#007f7f">getKeyId</span>());
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(responseBody.<span style="color:#007f7f">getPlaintext</span>());
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(responseBody.<span style="color:#007f7f">getRequestId</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (TeaException error) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 如有需要，请打印 error</span>
</span></span><span style="display:flex;"><span>            com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">teautil</span>.<span style="color:#007f7f">Common</span>.<span style="color:#007f7f">assertAsString</span>(error.<span style="color:#007f7f">message</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception _error) {
</span></span><span style="display:flex;"><span>            TeaException error = <span style="color:#fff;font-weight:bold">new</span> TeaException(_error.<span style="color:#007f7f">getMessage</span>(), _error);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 如有需要，请打印 error</span>
</span></span><span style="display:flex;"><span>            com.<span style="color:#007f7f">aliyun</span>.<span style="color:#007f7f">teautil</span>.<span style="color:#007f7f">Common</span>.<span style="color:#007f7f">assertAsString</span>(error.<span style="color:#007f7f">message</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="使用不转码模板组上传视频">使用<strong>不转码</strong>模板组上传视频。<a hidden class="anchor" aria-hidden="true" href="#使用不转码模板组上传视频">#</a></h4>
<p>因在视频点播中上传视频时会触发自动转码，而自动触发的转码暂不支持HLS标准加密，因此需要HLS标准加密的视频，在上传时需要使用系统内置的<strong>不转码</strong>模板组进行上传，以防止上传时自动触发转码。</p>
<ol>
<li>通过视频点播控制台上传，请参见<a href="https://help.aliyun.com/document_detail/86058.htm">控制台上传</a>；通过服务端接口上传，请参见<a href="https://help.aliyun.com/document_detail/61063.htm">媒体上传</a>。</li>
<li>配置视频点播的事件通知，当接收到<a href="https://help.aliyun.com/document_detail/55630.htm">视频上传完成</a>的回调消息时，则表明视频已经上传到视频点播中。事件通知的配置方法，请参见<a href="https://help.aliyun.com/document_detail/55627.htm">事件通知</a>。</li>
</ol>
<p>音视频都是前端上传，一般不会用到后台上传，但是有一个接口可能会用到，就是<code>URL批量拉取上传</code>，调用<a href="https://help.aliyun.com/document_detail/86311.htm#doc-api-vod-UploadMediaByURL">URL批量拉取上传</a>接口实现离线拉取上传。这种方式可以免去先将文件下载到本地服务器或终端再使用上传SDK上传到点播的过程。</p>
<h4 id="发起hls标准加密转码">发起HLS标准加密转码。<a hidden class="anchor" aria-hidden="true" href="#发起hls标准加密转码">#</a></h4>
<p>意思就是根据不加密的视频生成一个加密的视频。</p>
<p>文档：https://help.aliyun.com/document_detail/454920.htm</p>
<h4 id="查看hls标准加密结果">查看HLS标准加密结果。<a hidden class="anchor" aria-hidden="true" href="#查看hls标准加密结果">#</a></h4>
<p>登录<a href="https://vod.console.aliyun.com/">视频点播控制台</a>，选择<strong>媒资库 &gt; 音/视频 &gt; 管理 &gt; 视频地址</strong>，在视频地址页面，如果视频有多种格式的输出（例如还存在格式为mp4的原始文件），只需要查看m3u8格式的视频流是否带有<strong>标准加密</strong>字样，如果存在，则表明标准加密成功。</p>
<h3 id="播放hls标准加密视频">播放HLS标准加密视频<a hidden class="anchor" aria-hidden="true" href="#播放hls标准加密视频">#</a></h3>
<h4 id="搭建解密服务">搭建解密服务<a hidden class="anchor" aria-hidden="true" href="#搭建解密服务">#</a></h4>
<p>就是调阿里云一个接口，调用<a href="https://help.aliyun.com/document_detail/455053.htm">DecryptKMSDataKey - 解密KMS数据密钥密文</a>接口进行解密，该接口返回的数据密钥（DK）即<code>PlainText</code>是<a href="https://help.aliyun.com/document_detail/455051.htm">GenerateKMSDataKey - 创建KMS数据密钥</a>接口返回的<code>PlainText</code>经过base64_decode之后的数据。</p>
<h4 id="获取视频播放地址和凭证">获取视频播放地址和凭证<a hidden class="anchor" aria-hidden="true" href="#获取视频播放地址和凭证">#</a></h4>
<p>继续调阿里云接口，推荐调用<a href="https://help.aliyun.com/document_detail/436556.htm?spm=a2c4g.611819.0.0.53475646QmyoDQ">GetVideoPlayAuth - 获取音视频播放凭证</a>接口获取播放凭证。</p>
<p>或调用<a href="https://help.aliyun.com/document_detail/436555.htm">GetPlayInfo - 获取音视频播放地址</a>接口获取播放地址。</p>
<h4 id="播放加密视频">播放加密视频<a hidden class="anchor" aria-hidden="true" href="#播放加密视频">#</a></h4>
<p>HLS标准加密支持所有的HLS播放器，您可以选择使用自研的播放器或阿里云播放器进行播放加密视频。</p>
<p><a href="https://help.aliyun.com/document_detail/600949.htm?spm=a2c4g.611819.0.0.53475646QmyoDQ#565d5d30a6was">播放HLS标准加密视频</a></p>
<p>这一步都是前端的工作了，因为使用playAuth播放加密视频，所以后端只需要提供两个参数：videoId和playAuth。</p>
<p><a href="https://player.alicdn.com/aliplayer/setting/setting.html">阿里云Aliplayer播放器 (alicdn.com)</a></p>
<p>可以通过这里验证<code>videoId和playAuth</code>的正确性，如果这里能播，那么就是前端的问题，让前端自己解决。</p>
<h3 id="多地址回调">多地址回调<a hidden class="anchor" aria-hidden="true" href="#多地址回调">#</a></h3>
<p>参考官方文档：<a href="https://help.aliyun.com/document_detail/473081.htm">设置多地址回调 (aliyun.com)</a></p>
<h3 id="遇到的问题">遇到的问题<a hidden class="anchor" aria-hidden="true" href="#遇到的问题">#</a></h3>
<p>播放器提示 https 证书过期。解决办法：</p>
<p>登录视频点播控制台-&gt;左侧配置管理-&gt;在右侧选中你的域名点配置-&gt;https配置-&gt;更新或修改证书即可。</p>
<h1 id="遇到的坑">遇到的坑<a hidden class="anchor" aria-hidden="true" href="#遇到的坑">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>LocalDateTime now = LocalDateTime.<span style="color:#007f7f">now</span>();
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(now);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 打印结果</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 2024-01-17T17:53:37.384</span>
</span></span><span style="display:flex;"><span>注意<span style="color:#f00">，</span>秒后是带小数点的<span style="color:#f00">。</span>纳秒
</span></span></code></pre></td></tr></table>
</div>
</div><p>这时如果把这个时间存入mysql的create_time字段（datetime类型），mysql会根据小数点后的数字，四舍五入。
例如：</p>
<p><code>2024-01-17T17:53:37.384</code></p>
<p>mysql会存为：<code>2024-01-17T17:53:37</code>，小数点后的384被舍弃了。</p>
<p><code>2024-01-17T17:53:37.584</code></p>
<p>mysql会存为：`2024-01-17T17:53:378，小数点后的584进了一位，秒数多了1。</p>
<p>此时如果你这么操作：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 加入时间是2024-01-17T17:53:37.584</span>
</span></span><span style="display:flex;"><span>LocalDateTime now = LocalDateTime.<span style="color:#007f7f">now</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model.<span style="color:#007f7f">setStartTime</span>(now);
</span></span><span style="display:flex;"><span>save(model);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>searchData(now);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 如果now的结果的小数点是5xx，因为，小数会进一位。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 而此时程序中还是带小数点的时间，那么你用now去数据库里查询，就会差1秒。会导致你查不到想要的数据。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>解决办法<span style="color:#f00">：</span>不要纳秒<span style="color:#f00">。</span>
</span></span><span style="display:flex;"><span>LocalDateTime.<span style="color:#007f7f">now</span>().<span style="color:#007f7f">withNano</span>(0);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 输出：2024-01-25T14:50:39</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="webclient使用">webClient使用<a hidden class="anchor" aria-hidden="true" href="#webclient使用">#</a></h1>
<p>官网介绍：https://docs.spring.io/spring-framework/reference/web/webflux-webclient.html</p>
<p>本部分原文地址：https://medium.com/hprog99/transitioning-from-resttemplate-to-webclient-in-spring-boot-a-detailed-guide-4febd21063ba</p>
<p>多年来，Spring 框架的 RestTemplate 一直是客户端 HTTP 访问的首选解决方案，它提供同步、阻塞 API 来以简单的方式处理 HTTP 请求。</p>
<p>然而，随着对非阻塞、反应式编程以更少的资源处理并发的需求不断增加，特别是在微服务架构中，RestTemplate 已经显示出其局限性。从 Spring Framework 5 开始，RestTemplate 已被标记为已弃用，Spring 团队推荐 WebClient 作为其继任者。</p>
<h2 id="为什么-resttemplate-被弃用">为什么 RestTemplate 被弃用<a hidden class="anchor" aria-hidden="true" href="#为什么-resttemplate-被弃用">#</a></h2>
<ol>
<li>
<p>阻塞性质：</p>
<p>RestTemplate 是一个阻塞、同步客户端。这意味着执行请求的线程会阻塞，直到操作完成，这可能会导致线程池耗尽，并在重负载下导致更高的延迟。此模型不能很好地扩展，特别是在应用程序必须有效处理数千个并发请求的微服务环境中。</p>
</li>
<li>
<p>可扩展性有限：</p>
<p>RestTemplate 的同步特性限制了可扩展性。 需要高吞吐量、低延迟能力的现代系统发现这种方法不够。事件驱动、反应式编程范式的兴起是对这些需求的回应，导致了 WebClient 等非阻塞 API 的采用。</p>
</li>
<li>
<p>缺乏反应式编程支持：</p>
<p>RestTemplate 不支持反应式编程，而反应式编程在基于云的生态系统中日益增长。响应式编程使系统更具响应性、弹性和弹性，但这是 RestTemplate 的阻塞性质无法实现的。</p>
</li>
</ol>
<h2 id="webclient-的兴起">WebClient 的兴起<a hidden class="anchor" aria-hidden="true" href="#webclient-的兴起">#</a></h2>
<p>WebClient 是 Spring WebFlux 库的一部分，随 Spring 5 引入。与 RestTemplate 相比，它具有许多优势：</p>
<ol>
<li>
<p>非阻塞操作：</p>
<p>WebClient 使用 Project Reactor 在非阻塞、反应式范例上运行，使其能够以更少的线程和更少的开销处理并发，从而显着提高可扩展性和资源利用率。</p>
</li>
<li>
<p>反应式堆栈：</p>
<p>WebClient 支持反应式堆栈，使其适合基于事件循环的运行时环境。它可以在微服务架构中典型的高并发场景下高效工作。</p>
</li>
<li>
<p>JSON 处理及更多：</p>
<p>WebClient 通过 Jackson 库提供与 JSON 的无缝集成，类似于 RestTemplate，但具有增强的处理能力。它还支持服务器发送事件 (SSE)、流场景和其他高级用例。</p>
</li>
</ol>
<h2 id="从-resttemplate-过渡到-webclient">从 RestTemplate 过渡到 WebClient：<a hidden class="anchor" aria-hidden="true" href="#从-resttemplate-过渡到-webclient">#</a></h2>
<p>我们通过例子来探讨一下如何用 WebClient 替换 RestTemplate。我们将从一个简单的 GET 请求开始。</p>
<h2 id="执行-get-请求">执行 GET 请求：<a hidden class="anchor" aria-hidden="true" href="#执行-get-请求">#</a></h2>
<p><strong>RestTemplate:</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>RestTemplate restTemplate = <span style="color:#fff;font-weight:bold">new</span> RestTemplate();
</span></span><span style="display:flex;"><span>ResponseEntity&lt;String&gt; response = restTemplate.<span style="color:#007f7f">getForEntity</span>(<span style="color:#0ff;font-weight:bold">&#34;http://example.com&#34;</span>, String.<span style="color:#007f7f">class</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>WebClient:</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>WebClient webClient = WebClient.<span style="color:#007f7f">create</span>();
</span></span><span style="display:flex;"><span>Mono&lt;String&gt; response = webClient.<span style="color:#007f7f">get</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">uri</span>(<span style="color:#0ff;font-weight:bold">&#34;http://example.com&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">retrieve</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">bodyToMono</span>(String.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>response.<span style="color:#007f7f">subscribe</span>(result -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result));
</span></span></code></pre></td></tr></table>
</div>
</div><p>在 WebClient 中，一切都是非阻塞的。该retrieve()方法发起请求，并将bodyToMono响应主体转换为 Reactor Mono。该subscribe()方法用于订阅结果，一旦可用就会对其进行处理。</p>
<h2 id="处理错误">处理错误：<a hidden class="anchor" aria-hidden="true" href="#处理错误">#</a></h2>
<p>RestTemplate 的错误处理通过 ErrorHandler 接口进行，这需要单独的代码块。WebClient 通过更流畅的处理简化了这一过程。</p>
<p><strong>WebClient:</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>WebClient webClient = WebClient.<span style="color:#007f7f">create</span>();
</span></span><span style="display:flex;"><span>webClient.<span style="color:#007f7f">get</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">uri</span>(<span style="color:#0ff;font-weight:bold">&#34;http://example.com/some-error-endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">retrieve</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">onStatus</span>(HttpStatus::isError, response -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Handle error status codes</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Mono.<span style="color:#007f7f">error</span>(<span style="color:#fff;font-weight:bold">new</span> CustomException(<span style="color:#0ff;font-weight:bold">&#34;Custom error occurred.&#34;</span>));
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">bodyToMono</span>(String.<span style="color:#007f7f">class</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>该 onStatus() 方法允许直接在操作链中处理特定的 HTTP 状态，从而提供更具可读性和可维护性的方法。</p>
<h2 id="使用-json-的-post-请求">使用 JSON 的 POST 请求：<a hidden class="anchor" aria-hidden="true" href="#使用-json-的-post-请求">#</a></h2>
<p>当发出 POST 请求并提交 JSON 时，WebClient 以其流畅的 API 提供了更直接的方法。</p>
<p><strong>RestTemplate:</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>RestTemplate restTemplate = <span style="color:#fff;font-weight:bold">new</span> RestTemplate();
</span></span><span style="display:flex;"><span>HttpHeaders headers = <span style="color:#fff;font-weight:bold">new</span> HttpHeaders();
</span></span><span style="display:flex;"><span>headers.<span style="color:#007f7f">setContentType</span>(MediaType.<span style="color:#007f7f">APPLICATION_JSON</span>);
</span></span><span style="display:flex;"><span>HttpEntity&lt;String&gt; request = <span style="color:#fff;font-weight:bold">new</span> HttpEntity&lt;&gt;(<span style="color:#0ff;font-weight:bold">&#34;{\&#34;key\&#34;:\&#34;value\&#34;}&#34;</span>, headers);
</span></span><span style="display:flex;"><span>ResponseEntity&lt;String&gt; response = restTemplate.<span style="color:#007f7f">postForEntity</span>(<span style="color:#0ff;font-weight:bold">&#34;http://example.com&#34;</span>, request, String.<span style="color:#007f7f">class</span>);j
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>WebClient:</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>WebClient webClient = WebClient.<span style="color:#007f7f">create</span>();
</span></span><span style="display:flex;"><span>Mono&lt;String&gt; response = webClient.<span style="color:#007f7f">post</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">uri</span>(<span style="color:#0ff;font-weight:bold">&#34;http://example.com&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">contentType</span>(MediaType.<span style="color:#007f7f">APPLICATION_JSON</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">bodyValue</span>(<span style="color:#0ff;font-weight:bold">&#34;{\&#34;key\&#34;:\&#34;value\&#34;}&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">retrieve</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">bodyToMono</span>(String.<span style="color:#007f7f">class</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 WebClient，设置标头和正文内容更加直观，并且需要更少的样板代码。和 contentType() 方法 bodyValue() 允许直接设置内容类型和正文。</p>
<h2 id="异步处理">异步处理：<a hidden class="anchor" aria-hidden="true" href="#异步处理">#</a></h2>
<p>使用 WebClient 最显着的优点之一是它支持异步处理。当您的应用程序需要进行多个独立的 API 调用时，这尤其有用；这些可以同时执行，从而大大减少这些操作所需的总时间。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>WebClient webClient = WebClient.<span style="color:#007f7f">create</span>();
</span></span><span style="display:flex;"><span>Mono&lt;String&gt; responseOne = webClient.<span style="color:#007f7f">get</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">uri</span>(<span style="color:#0ff;font-weight:bold">&#34;http://example.com/endpointOne&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">retrieve</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">bodyToMono</span>(String.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Mono&lt;String&gt; responseTwo = webClient.<span style="color:#007f7f">get</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">uri</span>(<span style="color:#0ff;font-weight:bold">&#34;http://example.com/endpointTwo&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">retrieve</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">bodyToMono</span>(String.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 使用 Mono.zip 并发执行请求</span>
</span></span><span style="display:flex;"><span>Mono.<span style="color:#007f7f">zip</span>(responseOne, responseTwo).<span style="color:#007f7f">subscribe</span>(results -&gt; {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Result 1: &#34;</span> + results.<span style="color:#007f7f">getT1</span>());
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Result 2: &#34;</span> + results.<span style="color:#007f7f">getT2</span>());
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></td></tr></table>
</div>
</div><p>在此示例中，Mono.zip用于组合多个请求的结果。这些请求是并发执行的，一旦所有请求完成，就会处理结果。这种方法比 RestTemplate 同步操作中固有的顺序执行效率要高得多。</p>
<h2 id="流数据">流数据：<a hidden class="anchor" aria-hidden="true" href="#流数据">#</a></h2>
<p>WebClient 还支持以数据流的形式检索响应主体，这在处理您不想一次将其全部保存在内存中的大量数据时特别有用。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>WebClient  webClient  = WebClient.<span style="color:#007f7f">create</span>(); 
</span></span><span style="display:flex;"><span>webClient.<span style="color:#007f7f">get</span>() 
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">uri</span>( <span style="color:#0ff;font-weight:bold">&#34;http://example.com/stream&#34;</span> ) 
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">accept</span>(MediaType.<span style="color:#007f7f">TEXT_EVENT_STREAM</span>) <span style="color:#007f7f">// 用于服务器发送事件 (SSE)</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">retrieve</span>() 
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">bodyToFlux</span>(String.<span style="color:#007f7f">class</span>) <span style="color:#007f7f">//将响应正文转换为 Flux</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">subscribe</span>(data -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>( <span style="color:#0ff;font-weight:bold">&#34;Received: &#34;</span> + data));
</span></span></code></pre></td></tr></table>
</div>
</div><p>在此场景中，bodyToFlux用于将响应正文转换为Flux，表示数据流。然后，该subscribe方法用于在每条数据到达时对其进行处理。这与 RestTemplate 形成鲜明对比，后者要求在处理之前将整个响应主体加载到内存中，无论大小如何。</p>
<h2 id="重试机制">重试机制：<a hidden class="anchor" aria-hidden="true" href="#重试机制">#</a></h2>
<p>WebClient 利用反应式编程模型提供了一种更复杂的方法来重试失败的请求。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>WebClient webClient = WebClient.<span style="color:#007f7f">builder</span>().<span style="color:#007f7f">baseUrl</span>(<span style="color:#0ff;font-weight:bold">&#34;http://example.com&#34;</span>).<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>Mono&lt;String&gt; response = webClient.<span style="color:#007f7f">get</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">uri</span>(<span style="color:#0ff;font-weight:bold">&#34;/retry-endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">retrieve</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">bodyToMono</span>(String.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">retryWhen</span>(Retry.<span style="color:#007f7f">backoff</span>(3, Duration.<span style="color:#007f7f">ofSeconds</span>(1)) <span style="color:#007f7f">// number of retries and backoff configuration</span>
</span></span><span style="display:flex;"><span>               .<span style="color:#007f7f">maxBackoff</span>(Duration.<span style="color:#007f7f">ofSeconds</span>(10))) <span style="color:#007f7f">// maximum backoff time</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">onErrorResume</span>(e -&gt; Mono.<span style="color:#007f7f">just</span>(<span style="color:#0ff;font-weight:bold">&#34;Fallback response&#34;</span>)); <span style="color:#007f7f">// fallback if retries all fail</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>response.<span style="color:#007f7f">subscribe</span>(result -&gt; System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result));
</span></span></code></pre></td></tr></table>
</div>
</div><p>在此示例中，该retryWhen方法用于定义重试策略，指定重试次数和退避配置。如果所有重试都失败，onErrorResume 则提供后备机制。</p>
<h2 id="自定义-web-客户端配置">自定义 Web 客户端配置：<a hidden class="anchor" aria-hidden="true" href="#自定义-web-客户端配置">#</a></h2>
<p>WebClient 具有高度可配置性，您可能会发现默认设置无法满足您的需求。例如，您可能想要调整连接超时，或者可能需要添加应随每个请求发送的默认标头。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 构建一个具有指定超时和默认标头的自定义 WebClient </span>
</span></span><span style="display:flex;"><span>WebClient customWebClient = WebClient.<span style="color:#007f7f">builder</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">baseUrl</span>(<span style="color:#0ff;font-weight:bold">&#34;http://example.com&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">clientConnector</span>(<span style="color:#fff;font-weight:bold">new</span> ReactorClientHttpConnector(
</span></span><span style="display:flex;"><span>        HttpClient.<span style="color:#007f7f">create</span>()
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">option</span>(ChannelOption.<span style="color:#007f7f">CONNECT_TIMEOUT_MILLIS</span>, 2000) <span style="color:#007f7f">// 2 seconds timeout</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">responseTimeout</span>(Duration.<span style="color:#007f7f">ofSeconds</span>(2)) <span style="color:#007f7f">// Set response timeout</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">doOnConnected</span>(conn -&gt; 
</span></span><span style="display:flex;"><span>                       conn.<span style="color:#007f7f">addHandlerLast</span>(<span style="color:#fff;font-weight:bold">new</span> ReadTimeoutHandler(2)) <span style="color:#007f7f">// 2 seconds read timeout</span>
</span></span><span style="display:flex;"><span>                       .<span style="color:#007f7f">addHandlerLast</span>(<span style="color:#fff;font-weight:bold">new</span> WriteTimeoutHandler(2))))) <span style="color:#007f7f">// 2 seconds write timeout</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">defaultHeader</span>(HttpHeaders.<span style="color:#007f7f">CONTENT_TYPE</span>, MediaType.<span style="color:#007f7f">APPLICATION_JSON_VALUE</span>) <span style="color:#007f7f">// Default header</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">defaultHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Another-Header&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Another-Value&#34;</span>) <span style="color:#007f7f">// Another default header</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">build</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>在此示例中，我们自定义 WebClient 以具有特定的超时配置和默认标头。WebClient 的此实例会将这些设置应用于它执行的所有请求，确保整个应用程序的行为一致。</p>
<h2 id="网络客户端过滤器">网络客户端过滤器：<a hidden class="anchor" aria-hidden="true" href="#网络客户端过滤器">#</a></h2>
<p>WebClient 支持使用过滤器来处理横切关注点。这些过滤器可用于操纵请求或响应，甚至可以处理日志记录、指标或授权等问题。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 带过滤器的自定义 WebClient </span>
</span></span><span style="display:flex;"><span>WebClient filteredWebClient = WebClient.<span style="color:#007f7f">builder</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">baseUrl</span>(<span style="color:#0ff;font-weight:bold">&#34;http://example.com&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">filter</span>((request, next) -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 打印请求数据</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Request: &#34;</span> + request.<span style="color:#007f7f">method</span>() + <span style="color:#0ff;font-weight:bold">&#34; &#34;</span> + request.<span style="color:#007f7f">url</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> next.<span style="color:#007f7f">exchange</span>(request).<span style="color:#007f7f">doOnSuccessOrError</span>((response, error) -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (response != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 打印响应数据</span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Response Status: &#34;</span> + response.<span style="color:#007f7f">statusCode</span>());
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (error != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 打印错误</span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Error: &#34;</span> + error.<span style="color:#007f7f">getMessage</span>());
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">build</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>此过滤器记录通过此 WebClient 实例发出的每个请求的 HTTP 方法和 URL，以及收到的每个响应的状态代码。它还记录交换期间可能发生的任何错误。</p>
<h2 id="相互-tls-身份验证">相互 TLS 身份验证：<a hidden class="anchor" aria-hidden="true" href="#相互-tls-身份验证">#</a></h2>
<p>在需要增强安全性的场景中（例如内部微服务通信），您可能需要相互 TLS (mTLS) 身份验证。可以针对此类场景配置 WebClient。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 使用信任存储和密钥存储准备 SSL 上下文</span>
</span></span><span style="display:flex;"><span>SslContext sslContext = SslContextBuilder
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">forClient</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">trustManager</span>(InsecureTrustManagerFactory.<span style="color:#007f7f">INSTANCE</span>) <span style="color:#007f7f">// for demo purposes only!</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">keyManager</span>(<span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;path/to/client.crt&#34;</span>), <span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;path/to/client.key&#34;</span>)) <span style="color:#007f7f">// client certificate and private key</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 使用 SSL 上下文配置 WebClient WebClient </span>
</span></span><span style="display:flex;"><span>WebClient secureWebClient = WebClient.<span style="color:#007f7f">builder</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">clientConnector</span>(<span style="color:#fff;font-weight:bold">new</span> ReactorClientHttpConnector(HttpClient.<span style="color:#007f7f">create</span>().<span style="color:#007f7f">secure</span>(sslContextSpec -&gt; sslContextSpec.<span style="color:#007f7f">sslContext</span>(sslContext))))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">build</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>在此示例中，我们通过使用包含客户端证书和私钥的 SSL 上下文配置 WebClient 来设置 mTLS。此设置可确保客户端和服务器在 SSL 握手期间相互验证。</p>
<h2 id="webclient-最佳实践">WebClient 最佳实践<a hidden class="anchor" aria-hidden="true" href="#webclient-最佳实践">#</a></h2>
<p>以下是一些确保您高效且有效地使用 WebClient 的指南：</p>
<h2 id="单例模式">单例模式：<a hidden class="anchor" aria-hidden="true" href="#单例模式">#</a></h2>
<p>与通常根据请求或服务实例化的 RestTemplate 不同，WebClient 被设计为用作单例。这意味着您应该创建 WebClient 的单个实例并在您的应用程序中重用它。这种方式保证了资源的高效利用，避免了重复创建和销毁WebClient实例的开销。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> WebClient webClient(){
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> WebClient.<span style="color:#007f7f">builder</span>().<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过在配置中定义 WebClient.Builder bean，您可以在任何需要的地方自动装配它，并针对特定用例对其进行自定义，而无需每次都创建新的 WebClient 实例。</p>
<h2 id="错误处理">错误处理：<a hidden class="anchor" aria-hidden="true" href="#错误处理">#</a></h2>
<p>反应性流向下游传播错误，直到错误被处理或到达流的末尾。始终处理反应链中的错误，以避免意外行为。onErrorResume、onErrorReturn 和 doOnError 运算符特别有用。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>webClient.<span style="color:#007f7f">get</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">uri</span>(<span style="color:#0ff;font-weight:bold">&#34;/endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">retrieve</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">bodyToMono</span>(String.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">doOnError</span>(e -&gt; log.<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;Error occurred&#34;</span>, e))
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">onErrorResume</span>(e -&gt; Mono.<span style="color:#007f7f">just</span>(<span style="color:#0ff;font-weight:bold">&#34;Fallback value&#34;</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="超时配置">超时配置：<a hidden class="anchor" aria-hidden="true" href="#超时配置">#</a></h2>
<p>始终配置超时。如果没有超时，如果服务器没有响应，WebClient 请求可能会无限期挂起。使用timeout运算符设置特定的持续时间，在此之后请求将被终止。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>webClient.<span style="color:#007f7f">get</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">uri</span>(<span style="color:#0ff;font-weight:bold">&#34;/endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">retrieve</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">bodyToMono</span>(String.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">timeout</span>(Duration.<span style="color:#007f7f">ofSeconds</span>(10));
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="背压">背压：<a hidden class="anchor" aria-hidden="true" href="#背压">#</a></h2>
<p>反应式编程的核心原则之一是背压，它允许消费者向生产者发出他们可以处理多少数据的信号。处理Flux（0 到 N 个项目的流）时，请注意背压并确保不会让消费者感到不知所措。使用运算符来limitRate控制数据流的速率。</p>
<h2 id="日志记录">日志记录：<a hidden class="anchor" aria-hidden="true" href="#日志记录">#</a></h2>
<p>日志记录对于调试和监控至关重要。WebClient 提供内置日志记录功能。通过将记录器设置reactor.netty.http.client.HttpClient 为 DEBUG，您可以查看请求和响应的详细日志。</p>
<h2 id="线程上下文">线程上下文：<a hidden class="anchor" aria-hidden="true" href="#线程上下文">#</a></h2>
<p>在反应式编程中，操作可能会多次切换线程。如果您依赖线程局部变量（如日志记录或安全上下文中使用的变量），请注意这些变量可能不会自动跨线程传播。像这样的库reactor-context可以帮助在反应流中跨线程传播上下文。</p>
<h2 id="避免阻塞呼叫">避免阻塞呼叫：<a hidden class="anchor" aria-hidden="true" href="#避免阻塞呼叫">#</a></h2>
<p>WebClient 和反应式编程的主要好处之一是操作的非阻塞性质。但是，如果您在反应式链中引入阻塞调用，那么这种好处就会被抵消。始终避免在反应流中阻塞操作。如果必须使用阻塞调用，请考虑使用将其卸载到单独的线程池subscribeOn。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Mono.<span style="color:#007f7f">fromCallable</span>(() -&gt;blockingMethod()) 
</span></span><span style="display:flex;"><span>    .<span style="color:#007f7f">subscribeOn</span>(Schedulers.<span style="color:#007f7f">boundedElastic</span>());
</span></span></code></pre></td></tr></table>
</div>
</div><p>WebClient 提供了一种现代的、非阻塞的、反应式的方法来发出 HTTP 请求，使其成为大多数用例中优于已弃用的 RestTemplate 的选择。然而，随着它的力量而来的是正确使用它的责任。通过遵循最佳实践、了解响应式范例并意识到潜在的陷阱，您可以充分利用 WebClient 的潜力并构建高效、可扩展且响应迅速的应用程序。</p>
<h2 id="spring-boot-中使用webclient">spring boot 中使用webClient<a hidden class="anchor" aria-hidden="true" href="#spring-boot-中使用webclient">#</a></h2>
<p>编辑 pom.xml 文件，添加 Spring WebFlux 依赖，从而可以使用 WebClient。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-webflux<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WebClientUtils {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 单例</span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> WebClient webClient(){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> WebClient.<span style="color:#007f7f">builder</span>().<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 注入</span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> WebClient webClient;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 测试</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        String result = WebClient.<span style="color:#007f7f">create</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">get</span>().<span style="color:#007f7f">uri</span>(<span style="color:#0ff;font-weight:bold">&#34;http://localhost:6688/api/v1/heart/check&#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">retrieve</span>().<span style="color:#007f7f">bodyToMono</span>(String.<span style="color:#007f7f">class</span>).<span style="color:#007f7f">block</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// post请求</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; T post(String apiName,Object object,Class&lt;T&gt; toClass){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span> timestamp = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        String signature = DigestUtils.<span style="color:#007f7f">md5DigestAsHex</span>((apiKey + secretKey + timestamp).<span style="color:#007f7f">getBytes</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Mono&lt;T&gt; response = webClient.<span style="color:#007f7f">post</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">uri</span>(i-&gt; i.<span style="color:#007f7f">scheme</span>(protocols)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">host</span>(baseUrl)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">path</span>(prefix)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">queryParam</span>(<span style="color:#0ff;font-weight:bold">&#34;apiKey&#34;</span>, apiKey)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">queryParam</span>(<span style="color:#0ff;font-weight:bold">&#34;time&#34;</span>, String.<span style="color:#007f7f">valueOf</span>(timestamp))
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">queryParam</span>(<span style="color:#0ff;font-weight:bold">&#34;sign&#34;</span>, signature)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">queryParam</span>(<span style="color:#0ff;font-weight:bold">&#34;method&#34;</span>, apiName)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">build</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">contentType</span>(MediaType.<span style="color:#007f7f">APPLICATION_JSON</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">body</span>(Mono.<span style="color:#007f7f">just</span>(object),Object.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">retrieve</span>().<span style="color:#007f7f">bodyToMono</span>(toClass)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">timeout</span>(Duration.<span style="color:#007f7f">ofMillis</span>(WebClientHelper.<span style="color:#007f7f">DEFAULT_REQUEST_TIMEOUT</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> response.<span style="color:#007f7f">block</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在service中注入：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Autowired
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> WebClientUtils webClientUtils;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在方法中使用：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 查询信息</span>
</span></span><span style="display:flex;"><span>Map&lt;String, String&gt; map = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>map.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;ids&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;你的参数&#34;</span>);
</span></span><span style="display:flex;"><span>String result = webClientUtils.<span style="color:#007f7f">post</span>(<span style="color:#0ff;font-weight:bold">&#34;http://api.test.com&#34;</span>, map, String.<span style="color:#007f7f">class</span>);<span style="color:#007f7f">// 传入map参数，也支持传入实体类</span>
</span></span><span style="display:flex;"><span>log.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;返回结果：{}&#34;</span>, result);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 序列化</span>
</span></span><span style="display:flex;"><span>ErpResponse erpResponse = JacksonUtils.<span style="color:#007f7f">jsonToPojo</span>(result, ErpResponse.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 支持序列化泛型类（Jackson的特性，和webClient无关）</span>
</span></span><span style="display:flex;"><span>ErpResponse&lt;BookTracedInfo&gt; erpResponse = JacksonUtils.<span style="color:#007f7f">jsonToPojoGeneric</span>(result, <span style="color:#fff;font-weight:bold">new</span> TypeReference&lt;&gt;() {});
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="excel导入导出">excel导入导出<a hidden class="anchor" aria-hidden="true" href="#excel导入导出">#</a></h1>
<p>easyExcel官方文档：https://easyexcel.opensource.alibaba.com/</p>
<p>github：https://github.com/alibaba/easyexcel</p>
<h2 id="工具类-2">工具类<a hidden class="anchor" aria-hidden="true" href="#工具类-2">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.zw.matrix.common.utils;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.excel.EasyExcel;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.excel.ExcelWriter;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.excel.converters.integer.IntegerStringConverter;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.excel.converters.longconverter.LongStringConverter;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.excel.support.ExcelTypeEnum;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.excel.write.metadata.WriteSheet;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.zw.matrix.common.domain.SheetInfo;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.zw.matrix.common.service.impl.EasyExcelCellStyleStrategy;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.commons.collections4.CollectionUtils;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.servlet.http.HttpServletResponse;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.UnsupportedEncodingException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.net.URLEncoder;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.List;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> EasyExcelUtil {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> EasyExcelUtil() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 导出excel单个sheet
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param fileName
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param dataList
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param response
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return void
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> exportExcel(String fileName, String sheetName, List&lt;?&gt; dataList, Class&lt;?&gt; clazz, HttpServletResponse response) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            setExcelResponseProp(response, fileName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            EasyExcel.<span style="color:#007f7f">write</span>(response.<span style="color:#007f7f">getOutputStream</span>(), clazz)
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">registerConverter</span>(<span style="color:#fff;font-weight:bold">new</span> LongStringConverter())
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">registerConverter</span>(<span style="color:#fff;font-weight:bold">new</span> IntegerStringConverter())
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">registerWriteHandler</span>(EasyExcelCellStyleStrategy.<span style="color:#007f7f">getHorizontalCellStyleStrategy</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">excelType</span>(ExcelTypeEnum.<span style="color:#007f7f">XLSX</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">sheet</span>(sheetName)
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">doWrite</span>(dataList);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (!CollectionUtils.<span style="color:#007f7f">isEmpty</span>(dataList)) {
</span></span><span style="display:flex;"><span>                dataList.<span style="color:#007f7f">clear</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 导出excel多个sheet
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param fileName
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param sheetList
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param response
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return void
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> exportExcelMultiSheet(String fileName, List&lt;SheetInfo&gt; sheetList, HttpServletResponse response) {
</span></span><span style="display:flex;"><span>        ExcelWriter excelWriter = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        WriteSheet writeSheet = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            setExcelResponseProp(response, fileName);
</span></span><span style="display:flex;"><span>            excelWriter = EasyExcel
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">write</span>(response.<span style="color:#007f7f">getOutputStream</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">registerConverter</span>(<span style="color:#fff;font-weight:bold">new</span> LongStringConverter())
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">registerConverter</span>(<span style="color:#fff;font-weight:bold">new</span> IntegerStringConverter())
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">registerWriteHandler</span>(EasyExcelCellStyleStrategy.<span style="color:#007f7f">getHorizontalCellStyleStrategy</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (SheetInfo sheet : sheetList) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 构建sheet对象</span>
</span></span><span style="display:flex;"><span>                writeSheet = EasyExcel.<span style="color:#007f7f">writerSheet</span>(sheet.<span style="color:#007f7f">getSheetName</span>()).<span style="color:#007f7f">head</span>(sheet.<span style="color:#007f7f">getHeadClass</span>()).<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 写sheet数据</span>
</span></span><span style="display:flex;"><span>                excelWriter.<span style="color:#007f7f">write</span>(sheet.<span style="color:#007f7f">getDataList</span>(), writeSheet);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            excelWriter.<span style="color:#007f7f">finish</span>();
</span></span><span style="display:flex;"><span>            sheetList.<span style="color:#007f7f">clear</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 导出excel多个sheet
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param fileName
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param response
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return ExcelWriter
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ExcelWriter builderExcelWriter(String fileName, Class&lt;?&gt; clazz, HttpServletResponse response) {
</span></span><span style="display:flex;"><span>        ExcelWriter excelWriter = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            setExcelResponseProp(response, fileName);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> EasyExcel.<span style="color:#007f7f">write</span>(response.<span style="color:#007f7f">getOutputStream</span>(), clazz)
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">registerConverter</span>(<span style="color:#fff;font-weight:bold">new</span> LongStringConverter())
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">registerConverter</span>(<span style="color:#fff;font-weight:bold">new</span> IntegerStringConverter())
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">registerWriteHandler</span>(EasyExcelCellStyleStrategy.<span style="color:#007f7f">getHorizontalCellStyleStrategy</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 设置响应结果
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param response    响应结果对象
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param fileName 文件名
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @throws UnsupportedEncodingException 不支持编码异常
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> setExcelResponseProp(HttpServletResponse response, String fileName) <span style="color:#fff;font-weight:bold">throws</span> UnsupportedEncodingException {
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setCharacterEncoding</span>(<span style="color:#0ff;font-weight:bold">&#34;utf-8&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//response.setContentType(&#34;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#34;);</span>
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;content-Type&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;application/vnd.ms-excel&#34;</span>);
</span></span><span style="display:flex;"><span>        fileName = URLEncoder.<span style="color:#007f7f">encode</span>(fileName, <span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>).<span style="color:#007f7f">replaceAll</span>(<span style="color:#0ff;font-weight:bold">&#34;\\+&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;%20&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Content-disposition&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;attachment;filename*=utf-8&#39;&#39;&#34;</span> + fileName + <span style="color:#0ff;font-weight:bold">&#34;.xlsx&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="导出">导出<a hidden class="anchor" aria-hidden="true" href="#导出">#</a></h2>
<p>controller</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@ApiOperation(<span style="color:#0ff;font-weight:bold">&#34;导出-xxx&#34;</span>)
</span></span><span style="display:flex;"><span>@PostMapping(value = <span style="color:#0ff;font-weight:bold">&#34;exportXXXList&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> exportXXXList(@RequestBody XXdto dto, HttpServletResponse response){
</span></span><span style="display:flex;"><span>    xxService.<span style="color:#007f7f">exportXXXList</span>(dto,response);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>service</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 导出-xxx
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param pageParam
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> exportXXXList(XXdto dto, HttpServletResponse response);
</span></span></code></pre></td></tr></table>
</div>
</div><p>serviceimpl</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> exportXXXList(XXdto dto, HttpServletResponse response) {
</span></span><span style="display:flex;"><span>    List&lt;XXVO&gt; list = xxMapper.<span style="color:#007f7f">xxList</span>(dto.<span style="color:#007f7f">getxxId</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (XXVO item : list) {
</span></span><span style="display:flex;"><span>        item.<span style="color:#007f7f">setName</span>(XXEnum.<span style="color:#007f7f">getNameByCode</span>(item.<span style="color:#007f7f">getXXCode</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 导出</span>
</span></span><span style="display:flex;"><span>    EasyExcelUtil.<span style="color:#007f7f">exportExcel</span>(<span style="color:#0ff;font-weight:bold">&#34;这是文件名&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;这是sheet名字&#34;</span>, list,XXVO.<span style="color:#007f7f">class</span>, response);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="导入">导入<a hidden class="anchor" aria-hidden="true" href="#导入">#</a></h2>
<p>controller</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@ApiOperation(<span style="color:#0ff;font-weight:bold">&#34;导入xx文件&#34;</span>)
</span></span><span style="display:flex;"><span>@PostMapping(<span style="color:#0ff;font-weight:bold">&#34;importXX&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CommonResult importXX(MultipartFile file){
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> CommonResult.<span style="color:#007f7f">success</span>(xxService.<span style="color:#007f7f">importFile</span>(file));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>serviceImpl</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;ImportStudentData&gt; importDataList;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>    importDataList = EasyExcel.<span style="color:#007f7f">read</span>(dto.<span style="color:#007f7f">getFile</span>().<span style="color:#007f7f">getInputStream</span>()).<span style="color:#007f7f">head</span>(ImportStudentData.<span style="color:#007f7f">class</span>).<span style="color:#007f7f">sheet</span>().<span style="color:#007f7f">doReadSync</span>();
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 后续操作</span>
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://wjy6.netlify.app/tags/java/">Java</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://wjy6.netlify.app/">Wjy&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>