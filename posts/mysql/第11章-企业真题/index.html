<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>第11章 企业真题 | Wjy&#39;s Blog</title>
<meta name="keywords" content="mysql">
<meta name="description" content="第一题 1 2 3 4 5 # 第一步：找小于等于80分的学员姓名 select distinct name from t_student where fenshu &lt;= 80 # 第二步：not in select distinct name from t_student where name not in(select distinct name from t_student where fenshu &lt;= 80) 第二题 其中，两个表">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://009965.xyz/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://009965.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://009965.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://009965.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://009965.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://009965.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://009965.xyz/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://009965.xyz/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="第11章 企业真题">
  <meta property="og:description" content="第一题 1 2 3 4 5 # 第一步：找小于等于80分的学员姓名 select distinct name from t_student where fenshu &lt;= 80 # 第二步：not in select distinct name from t_student where name not in(select distinct name from t_student where fenshu &lt;= 80) 第二题 其中，两个表">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-05-25T18:13:07+00:00">
    <meta property="article:modified_time" content="2025-05-25T18:13:07+00:00">
    <meta property="article:tag" content="Mysql">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第11章 企业真题">
<meta name="twitter:description" content="第一题 1 2 3 4 5 # 第一步：找小于等于80分的学员姓名 select distinct name from t_student where fenshu &lt;= 80 # 第二步：not in select distinct name from t_student where name not in(select distinct name from t_student where fenshu &lt;= 80) 第二题 其中，两个表">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://009965.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "第11章 企业真题",
      "item": "https://009965.xyz/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "第11章 企业真题",
  "name": "第11章 企业真题",
  "description": "第一题 1 2 3 4 5 # 第一步：找小于等于80分的学员姓名 select distinct name from t_student where fenshu \u0026lt;= 80 # 第二步：not in select distinct name from t_student where name not in(select distinct name from t_student where fenshu \u0026lt;= 80) 第二题 其中，两个表",
  "keywords": [
    "mysql"
  ],
  "articleBody": "第一题 1 2 3 4 5 # 第一步：找小于等于80分的学员姓名 select distinct name from t_student where fenshu \u003c= 80 # 第二步：not in select distinct name from t_student where name not in(select distinct name from t_student where fenshu \u003c= 80) 第二题 其中，两个表的关联字段为申请单号。\n1）查询身份证号为440401430103082的申请日期。\n2）查询同一个身份证号码有两条以上记录的身份证号码及记录个数。\n3）将身份证号码为440401430103082的记录在两个表中的申请状态均改为07。\n4）删除g_cardapplydetail表中所有姓李的记录。\n模拟数据：考试做这种题目最重要的是要冷静下来，只有静下来SQL才能写好。要模拟数据。看到数据SQL就好写了。\n1）查询身份证号为440401430103082的申请日期。\nbigint转date，可以使用from_unixtime函数。\n1 select a.g_applydate from g_cardapply a join g_cardapplydetail b on a.g_applyno = b.g_applyno where b.g_idcard = '440401430103082' 2）查询同一个身份证号码有两条以上记录的身份证号码及记录个数。\n1 select count(g_idcard),g_idcard from g_cardapplydetail group by g_idcard having count(g_idcard) \u003e= 2 3）将身份证号码为440401430103082的记录在两个表中的申请状态均改为07。\n1 2 3 4 5 6 7 8 9 10 UPDATE g_cardapply JOIN g_cardapplydetail ON g_cardapply.g_applyno = g_cardapplydetail.g_applyno AND g_cardapplydetail.g_idcard = '440401430103082' SET g_cardapply.g_state = '07', g_cardapplydetail.g_state = '07' 4）删除g_cardapplydetail表中所有姓李的记录。\n1 delete t1,t2 from g_cardapply t1 join g_cardapplydetail t2 on t1.g_applyno=t2.g_applyno where t2.g_name like '李%'; 第三题 表名：stuscore\n1）统计如下：课程不及格[0~59]的多少个，良[60~80]多少个，优[81-100]多少个。\n2）计算科科及格的人的平均成绩。\n第四题 1）请用一条SQL语句查询出不同部门中担任“钳工”的职工平均工资。\n2）请用一条SQL语句查询出不同部门中担任“钳工”的职工平均工资高于2000的部门。\n第五题 Employee是雇员信息表：\n雇员姓名（主键）：person-name\n街道：street\n城市：city\nCompany是公司信息表：\n公司名称（主键）：company-name\n城市：city\nWorks是雇员工作信息表：\n雇员姓名（主键）：person-name\n公司名称：company-name\n年薪：salary\nManages是雇员工作关系表：\n雇员姓名（主键）：person-name\n经理姓名：manager-name\n模拟数据：\n员工表：employee\n公司表：company\n雇员工作信息表：Works\n雇员工作关系表：Manages\n请给出下面每一个查询的SQL语句：\n找出所有居住地与工作的公司在同一城市的员工的姓名。 找出比Small Bank Corporation的所有员工收入都高的所有员工的姓名。 找出平均年薪在10000美元以上的公司及其平均年薪。 第六题 客户表Client\n订单表Order\n客户订单表ClientOrder\n图书表Book\n请写出一条SQL语句，查询出每个客户的所有订单并按照地址排序，要求输出格式为：address client_name phone order_id 请写出一条SQL语句，查询出每个客户订购的图书总价。要求输出格式为：client_name total_price 如果要求每个订单可以包含多种图书，应该如何修改Order表的主键？为了保证每个订单只被一个客户拥有，应该在ClientOrder表上增加怎样的约束？ 第七题 模拟数据：\n学生表：student\n课程表：course\n成绩表：sc\n教师表：teacher\n查询1号课比2号课成绩高的所有学生学号。 查询平均成绩大于60分的学号和平均成绩。 查询所有学生学号、姓名、选课数、总成绩。 查询姓“李”的老师的个数。 查询没学过“叶平”老师课的学号、姓名。 第八题 学生表：student\n课程表：class\n选课表：chosen_class\n没有选修课程编号为C1的学生姓名 列出每门课程名称和平均成绩，并按照成绩排序 选了2门课以上的学生姓名。 第九题 要转换成：\nMySQL行转列 MySQL行转列又叫做数据透视。什么叫做行转列？将原本横向排列的数据透视成纵向排列的数据，进而进行计算、分析、展示等操作。\n假设有一个学生选课成绩表，包含学生姓名（stu_name）、课程名称（course_name）和分数（score）三个字段。在原始数据中，每个学生在不同的课程中都有自己的得分情况，数据样例如下：\nstu_name course_name score 张三 数学 80 张三 英语 85 张三 历史 90 李四 数学 75 李四 英语 92 李四 历史 85 王五 数学 88 王五 英语 90 王五 历史 95 可以使用行转列操作，将每个学生在不同课程中的分数拆分成多条记录，每条记录包含一个课程以及对应的分数。转换后的数据样例如下：\nstu_name 数学 英语 历史 张三 80 85 90 李四 75 92 85 王五 88 90 95 从上表中可以看出，在行转列之后，每一行记录都表示了一个学生在不同课程中的分数。这样更便于对不同科目的分数进行比较、计算平均值等分析操作。\n使用case when+group by完成 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 drop table if exists t_student; create table t_student( stu_name varchar(10), course_name varchar(10), score int ); insert into t_student(stu_name, course_name, score) values('张三', '数学', 80); insert into t_student(stu_name, course_name, score) values('张三', '英语', 85); insert into t_student(stu_name, course_name, score) values('张三', '历史', 90); insert into t_student(stu_name, course_name, score) values('李四', '数学', 75); insert into t_student(stu_name, course_name, score) values('李四', '英语', 92); insert into t_student(stu_name, course_name, score) values('李四', '历史', 85); insert into t_student(stu_name, course_name, score) values('王五', '数学', 88); insert into t_student(stu_name, course_name, score) values('王五', '英语', 90); insert into t_student(stu_name, course_name, score) values('王五', '历史', 95); commit; select * from t_student; 行转列后的效果是：\nsql如下：\n1 2 3 4 5 6 7 8 9 select stu_name, max(case course_name when '数学' then score else 0 end) as '数学', max(case course_name when '英语' then score else 0 end) as '英语', max(case course_name when '历史' then score else 0 end) as '历史' from t_student group by stu_name; 通过以上内容的学习，我们这个面试题就迎刃而解了：\n1 2 3 4 5 6 7 8 9 10 select year, max(case season when '一季度' then count else 0 end) as '一季度', max(case season when '二季度' then count else 0 end) as '二季度', max(case season when '三季度' then count else 0 end) as '三季度', max(case season when '四季度' then count else 0 end) as '四季度' from t_temp group by year; 第十题 1 2 3 4 5 6 7 8 select x.a 开始数字, y.a 结束数字 from (select m.a,row_number() over(order by m.a) as rownum from (select a, lag(a) over(order by a asc) as pre_a from t) m where m.a - m.pre_a != 1 or m.pre_a is null) x join (select n.a,row_number() over(order by n.a) as rownum from (select a, lead(a) over(order by a asc) as next_a from t) n where n.next_a - n.a != 1 or n.next_a is null) y on x.rownum = y.rownum; 解答上面这个题目需要具备以下知识点：\nlag函数 lead函数 row_number函数 lag函数：获取当前行的上一行数据\n1 select empno,ename,sal,(lag(sal) over(order by sal asc)) as pre_sal from emp; 注意：over函数用来指定“在…..范围内”，通常和lag函数联用。\nlead函数：获取当前行的下一行数据\n1 select empno,ename,sal,(lead(sal) over(order by sal asc)) as next_sal from emp; 注意：over函数用来指定“在…..范围内”，通常和lead函数联用。\nrow_number函数：可以为查询结果集生成行号：\n1 select empno,ename,sal,row_number() over(order by sal) as rownum from emp; 利用row_number函数，将两个不相关的列拼接在一起显示：\n1 2 3 4 5 6 7 8 select x.a, y.b from (select a,row_number() over(order by a) as rownum from t1) x join (select b,row_number() over(order by b) as rownum from t2) y on x.rownum = y.rownum; CTE语法（公用表表达式）：Common Table Expression。创建临时表的一种语法：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 -- 查询每个部门平均工资的工资等级 -- 第一种写法 select t.deptno,t.avgsal,s.grade from (select deptno,avg(sal) as avgsal from emp group by deptno) t join salgrade s on t.avgsal between s.losal and s.hisal; -- 第二种写法：使用CTE语法 with cte_exp as(select deptno,avg(sal) as avgsal from emp group by deptno) select cte_exp.deptno,cte_exp.avgsal,s.grade from cte_exp join salgrade s on cte_exp.avgsal between s.losal and s.hisal; partition by：将数据分区，和group by区别是：group by是分组，然后和分组函数一起用。partition by分区不需要和分组函数一起使用\n1 select deptno, empno,ename,sal,(lag(sal) over(partition by deptno order by sal asc)) as pre_sal from emp; MySQL 8.0及以上版本中支持如下常用的窗口函数：\nROW_NUMBER()：排名函数，返回当前结果集中每个行的行号； RANK()：排名函数，计算分组结果中的排名，相同的行排名相同且没有空缺，下一个行排名跳过空缺； DENSE_RANK()：排名函数，计算分组结果中的排名，相同的行排名相同，排名连续，没有空缺； NTILE()：将分组结果等分为指定的组数，计算每组的大小； LAG()：返回分组内前一行的值； LEAD()：返回分组内后一行的值； FIRST_VALUE()：返回分组内第一个值； LAST_VALUE()：返回分组内最后一个值； AVG()、SUM()、COUNT()、MIN()、MAX()：聚合函数，可以配合OVER()进行窗口操作。 需要注意的是，MySQL的窗口函数和其他DBMS中的窗口函数相比较，可能略有不同，需要根据MySQL的文档进行使用。\n",
  "wordCount" : "3558",
  "inLanguage": "en",
  "datePublished": "2025-05-25T18:13:07Z",
  "dateModified": "2025-05-25T18:13:07Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://009965.xyz/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://009965.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      第11章 企业真题
    </h1>
    <div class="post-meta"><span title='2025-05-25 18:13:07 +0000 UTC'>2025-05-25</span>&nbsp;·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%ac%ac%e4%b8%80%e9%a2%98" aria-label="第一题">第一题</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%8c%e9%a2%98" aria-label="第二题">第二题</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%b8%89%e9%a2%98" aria-label="第三题">第三题</a></li>
                <li>
                    <a href="#%e7%ac%ac%e5%9b%9b%e9%a2%98" aria-label="第四题">第四题</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%94%e9%a2%98" aria-label="第五题">第五题</a></li>
                <li>
                    <a href="#%e7%ac%ac%e5%85%ad%e9%a2%98" aria-label="第六题">第六题</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%b8%83%e9%a2%98" aria-label="第七题">第七题</a></li>
                <li>
                    <a href="#%e7%ac%ac%e5%85%ab%e9%a2%98" aria-label="第八题">第八题</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%b9%9d%e9%a2%98" aria-label="第九题">第九题</a><ul>
                        
                <li>
                    <a href="#mysql%e8%a1%8c%e8%bd%ac%e5%88%97" aria-label="MySQL行转列">MySQL行转列</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8case-whengroup-by%e5%ae%8c%e6%88%90" aria-label="使用case when&#43;group by完成">使用case when+group by完成</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e7%ac%ac%e5%8d%81%e9%a2%98" aria-label="第十题">第十题</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="第一题">第一题<a hidden class="anchor" aria-hidden="true" href="#第一题">#</a></h1>
<p><img alt="1.jpg" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/a35b2929326164a0253425a3937fc53f_MD5.jpg"></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span># <span style="color:#f00">第一步：找小于等于</span><span style="color:#ff0;font-weight:bold">80</span><span style="color:#f00">分的学员姓名</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">distinct</span> name <span style="color:#fff;font-weight:bold">from</span> t_student <span style="color:#fff;font-weight:bold">where</span> fenshu &lt;= <span style="color:#ff0;font-weight:bold">80</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#f00">第二步：</span><span style="color:#fff;font-weight:bold">not</span> <span style="color:#fff;font-weight:bold">in</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">distinct</span> name <span style="color:#fff;font-weight:bold">from</span> t_student <span style="color:#fff;font-weight:bold">where</span> name <span style="color:#fff;font-weight:bold">not</span> <span style="color:#fff;font-weight:bold">in</span>(<span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">distinct</span> name <span style="color:#fff;font-weight:bold">from</span> t_student <span style="color:#fff;font-weight:bold">where</span> fenshu &lt;= <span style="color:#ff0;font-weight:bold">80</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="第二题">第二题<a hidden class="anchor" aria-hidden="true" href="#第二题">#</a></h1>
<p><img alt="2.jpg" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/f39d08a7da0b47c0422830ece23d2905_MD5.jpg"><br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/4306072839d94dd70a69ae6007abda67_MD5.png"><br>
其中，两个表的关联字段为申请单号。<br>
1）查询身份证号为440401430103082的申请日期。<br>
2）查询同一个身份证号码有两条以上记录的身份证号码及记录个数。<br>
3）将身份证号码为440401430103082的记录在两个表中的申请状态均改为07。<br>
4）删除g_cardapplydetail表中所有姓李的记录。<br>
模拟数据：考试做这种题目最重要的是要冷静下来，只有静下来SQL才能写好。要模拟数据。看到数据SQL就好写了。<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/caafe4cb8895f731e0b4eec07baeaf70_MD5.png"><br>
1）查询身份证号为440401430103082的申请日期。<br>
bigint转date，可以使用from_unixtime函数。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> a.g_applydate <span style="color:#fff;font-weight:bold">from</span> g_cardapply a <span style="color:#fff;font-weight:bold">join</span> g_cardapplydetail b <span style="color:#fff;font-weight:bold">on</span> a.g_applyno = b.g_applyno <span style="color:#fff;font-weight:bold">where</span> b.g_idcard = <span style="color:#0ff;font-weight:bold">&#39;440401430103082&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>2）查询同一个身份证号码有两条以上记录的身份证号码及记录个数。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">count</span>(g_idcard),g_idcard <span style="color:#fff;font-weight:bold">from</span> g_cardapplydetail <span style="color:#fff;font-weight:bold">group</span> <span style="color:#fff;font-weight:bold">by</span> g_idcard <span style="color:#fff;font-weight:bold">having</span> <span style="color:#fff;font-weight:bold">count</span>(g_idcard) &gt;= <span style="color:#ff0;font-weight:bold">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>3）将身份证号码为440401430103082的记录在两个表中的申请状态均改为07。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">UPDATE</span> 
</span></span><span style="display:flex;"><span>	g_cardapply
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">JOIN</span> 
</span></span><span style="display:flex;"><span>	g_cardapplydetail 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ON</span> 
</span></span><span style="display:flex;"><span>	g_cardapply.g_applyno = g_cardapplydetail.g_applyno 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">AND</span>
</span></span><span style="display:flex;"><span>	g_cardapplydetail.g_idcard = <span style="color:#0ff;font-weight:bold">&#39;440401430103082&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SET</span> g_cardapply.g_state = <span style="color:#0ff;font-weight:bold">&#39;07&#39;</span>,
</span></span><span style="display:flex;"><span>g_cardapplydetail.g_state = <span style="color:#0ff;font-weight:bold">&#39;07&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>4）删除g_cardapplydetail表中所有姓李的记录。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">delete</span> t1,t2 <span style="color:#fff;font-weight:bold">from</span> g_cardapply t1 <span style="color:#fff;font-weight:bold">join</span> g_cardapplydetail t2 <span style="color:#fff;font-weight:bold">on</span> t1.g_applyno=t2.g_applyno <span style="color:#fff;font-weight:bold">where</span> t2.g_name <span style="color:#fff;font-weight:bold">like</span> <span style="color:#0ff;font-weight:bold">&#39;李%&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="第三题">第三题<a hidden class="anchor" aria-hidden="true" href="#第三题">#</a></h1>
<p><img alt="面试题3.jpg" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/69f95d69d46496d2b3eaea31d03a4f5d_MD5.jpg"><br>
<img alt="面试题5.jpg" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/6a329d8277865f769a60c1b2783e8053_MD5.jpg"><br>
表名：stuscore<br>
1）统计如下：课程不及格[0~59]的多少个，良[60~80]多少个，优[81-100]多少个。<br>
2）计算科科及格的人的平均成绩。</p>
<h1 id="第四题">第四题<a hidden class="anchor" aria-hidden="true" href="#第四题">#</a></h1>
<p><img alt="QQ图片20151126234632.jpg" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/964134d52188b46b4adecc13e7a09a12_MD5.jpg"><br>
1）请用一条SQL语句查询出不同部门中担任“钳工”的职工平均工资。<br>
2）请用一条SQL语句查询出不同部门中担任“钳工”的职工平均工资高于2000的部门。</p>
<h1 id="第五题">第五题<a hidden class="anchor" aria-hidden="true" href="#第五题">#</a></h1>
<p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/d2f161ea1e65511fda9d057a67dff7ab_MD5.png"><br>
Employee是雇员信息表：<br>
雇员姓名（主键）：person-name<br>
街道：street<br>
城市：city<br>
Company是公司信息表：<br>
公司名称（主键）：company-name<br>
城市：city<br>
Works是雇员工作信息表：<br>
雇员姓名（主键）：person-name<br>
公司名称：company-name<br>
年薪：salary<br>
Manages是雇员工作关系表：<br>
雇员姓名（主键）：person-name<br>
经理姓名：manager-name<br>
模拟数据：<br>
员工表：employee<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/52095b7e1887131d00f72c03ec85f951_MD5.png"><br>
公司表：company<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/eb72da689ffff625cd00b07b8a2a4321_MD5.png"><br>
雇员工作信息表：Works<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/dd52d22ec0b1ad090faa88b8b0615c26_MD5.png"><br>
雇员工作关系表：Manages<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/c09519a8c2219bea696dbb234390b2d2_MD5.png"></p>
<p>请给出下面每一个查询的SQL语句：</p>
<ol>
<li>找出所有居住地与工作的公司在同一城市的员工的姓名。</li>
<li>找出比Small Bank Corporation的所有员工收入都高的所有员工的姓名。</li>
<li>找出平均年薪在10000美元以上的公司及其平均年薪。</li>
</ol>
<h1 id="第六题">第六题<a hidden class="anchor" aria-hidden="true" href="#第六题">#</a></h1>
<p><img alt="IMG_1621.JPG" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/1dfd6300143c0a44c678ec8d38a7cda4_MD5.jpg"><br>
客户表Client<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/4ea71d2ed8b61cdbe0205a379f2e7d3c_MD5.png"><br>
订单表Order<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/ecc94e914b1b600ef8fa27c9a6c130a2_MD5.png"><br>
客户订单表ClientOrder<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/0009283c13e18198e7c375fc048f8025_MD5.png"><br>
图书表Book<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/9d8bff6880b2086181311de89bd71af6_MD5.png"></p>
<ol>
<li>请写出一条SQL语句，查询出每个客户的所有订单并按照地址排序，要求输出格式为：address client_name phone order_id</li>
<li>请写出一条SQL语句，查询出每个客户订购的图书总价。要求输出格式为：client_name total_price</li>
<li>如果要求每个订单可以包含多种图书，应该如何修改Order表的主键？为了保证每个订单只被一个客户拥有，应该在ClientOrder表上增加怎样的约束？</li>
</ol>
<h1 id="第七题">第七题<a hidden class="anchor" aria-hidden="true" href="#第七题">#</a></h1>
<p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/a199971462f4fea47de4157f4289bc13_MD5.png"><br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/9878a47f3b22b8fc58afebbede24ef85_MD5.png"><br>
模拟数据：<br>
学生表：student<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/77fa6edeb7d465751215e0353b4c0e1d_MD5.png"><br>
课程表：course<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/8060bbb0bbc9173756461109f014ed52_MD5.png"><br>
成绩表：sc<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/1a64db81244ff7b189eace6f1d3b61b7_MD5.png"><br>
教师表：teacher<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/47784826117fc950b94b1e6bcc105f74_MD5.png"></p>
<ol>
<li>查询1号课比2号课成绩高的所有学生学号。</li>
<li>查询平均成绩大于60分的学号和平均成绩。</li>
<li>查询所有学生学号、姓名、选课数、总成绩。</li>
<li>查询姓“李”的老师的个数。</li>
<li>查询没学过“叶平”老师课的学号、姓名。</li>
</ol>
<h1 id="第八题">第八题<a hidden class="anchor" aria-hidden="true" href="#第八题">#</a></h1>
<p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/e3307622dabf060e041d5ba249ea4a27_MD5.png"><br>
学生表：student<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/ba12b5f37c07975d45eb29bd1f38f28d_MD5.png"><br>
课程表：class<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/f1f96c0ff26ea45f1d2e9b7a793d9733_MD5.png"><br>
选课表：chosen_class<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/f2946f877a6d0cda0d0a51d4ac192513_MD5.png"></p>
<ol>
<li>没有选修课程编号为C1的学生姓名</li>
<li>列出每门课程名称和平均成绩，并按照成绩排序</li>
<li>选了2门课以上的学生姓名。</li>
</ol>
<h1 id="第九题">第九题<a hidden class="anchor" aria-hidden="true" href="#第九题">#</a></h1>
<p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/edfa4a2924edc2698226b90995798987_MD5.png"><br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/363daa94a66a8f2e829fa97bb8545d15_MD5.png"><br>
要转换成：<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/3cf3dd6871391d4fe29a9e5739ed7f8c_MD5.png"></p>
<h2 id="mysql行转列">MySQL行转列<a hidden class="anchor" aria-hidden="true" href="#mysql行转列">#</a></h2>
<p>MySQL行转列又叫做<strong>数据透视</strong>。什么叫做行转列？将原本横向排列的数据透视成纵向排列的数据，进而进行计算、分析、展示等操作。</p>
<p>假设有一个学生选课成绩表，包含学生姓名（stu_name）、课程名称（course_name）和分数（score）三个字段。在原始数据中，每个学生在不同的课程中都有自己的得分情况，数据样例如下：</p>
<table>
<thead>
<tr>
<th>stu_name</th>
<th>course_name</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>张三</td>
<td>数学</td>
<td>80</td>
</tr>
<tr>
<td>张三</td>
<td>英语</td>
<td>85</td>
</tr>
<tr>
<td>张三</td>
<td>历史</td>
<td>90</td>
</tr>
<tr>
<td>李四</td>
<td>数学</td>
<td>75</td>
</tr>
<tr>
<td>李四</td>
<td>英语</td>
<td>92</td>
</tr>
<tr>
<td>李四</td>
<td>历史</td>
<td>85</td>
</tr>
<tr>
<td>王五</td>
<td>数学</td>
<td>88</td>
</tr>
<tr>
<td>王五</td>
<td>英语</td>
<td>90</td>
</tr>
<tr>
<td>王五</td>
<td>历史</td>
<td>95</td>
</tr>
</tbody>
</table>
<p>可以使用行转列操作，将每个学生在不同课程中的分数拆分成多条记录，每条记录包含一个课程以及对应的分数。转换后的数据样例如下：</p>
<table>
<thead>
<tr>
<th>stu_name</th>
<th>数学</th>
<th>英语</th>
<th>历史</th>
</tr>
</thead>
<tbody>
<tr>
<td>张三</td>
<td>80</td>
<td>85</td>
<td>90</td>
</tr>
<tr>
<td>李四</td>
<td>75</td>
<td>92</td>
<td>85</td>
</tr>
<tr>
<td>王五</td>
<td>88</td>
<td>90</td>
<td>95</td>
</tr>
</tbody>
</table>
<p>从上表中可以看出，在行转列之后，每一行记录都表示了一个学生在不同课程中的分数。这样更便于对不同科目的分数进行比较、计算平均值等分析操作。</p>
<h3 id="使用case-whengroup-by完成">使用case when+group by完成<a hidden class="anchor" aria-hidden="true" href="#使用case-whengroup-by完成">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">drop</span> <span style="color:#fff;font-weight:bold">table</span> <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">exists</span> t_student;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">table</span> t_student(
</span></span><span style="display:flex;"><span>  stu_name <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">10</span>),
</span></span><span style="display:flex;"><span>  course_name <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">10</span>),
</span></span><span style="display:flex;"><span>  score <span style="color:#fff;font-weight:bold">int</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_student(stu_name, course_name, score) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#0ff;font-weight:bold">&#39;张三&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;数学&#39;</span>, <span style="color:#ff0;font-weight:bold">80</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_student(stu_name, course_name, score) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#0ff;font-weight:bold">&#39;张三&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;英语&#39;</span>, <span style="color:#ff0;font-weight:bold">85</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_student(stu_name, course_name, score) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#0ff;font-weight:bold">&#39;张三&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;历史&#39;</span>, <span style="color:#ff0;font-weight:bold">90</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_student(stu_name, course_name, score) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#0ff;font-weight:bold">&#39;李四&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;数学&#39;</span>, <span style="color:#ff0;font-weight:bold">75</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_student(stu_name, course_name, score) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#0ff;font-weight:bold">&#39;李四&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;英语&#39;</span>, <span style="color:#ff0;font-weight:bold">92</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_student(stu_name, course_name, score) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#0ff;font-weight:bold">&#39;李四&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;历史&#39;</span>, <span style="color:#ff0;font-weight:bold">85</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_student(stu_name, course_name, score) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#0ff;font-weight:bold">&#39;王五&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;数学&#39;</span>, <span style="color:#ff0;font-weight:bold">88</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_student(stu_name, course_name, score) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#0ff;font-weight:bold">&#39;王五&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;英语&#39;</span>, <span style="color:#ff0;font-weight:bold">90</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_student(stu_name, course_name, score) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#0ff;font-weight:bold">&#39;王五&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;历史&#39;</span>, <span style="color:#ff0;font-weight:bold">95</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">commit</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> t_student;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/4ee71114a632694c5b18a4b515f61e1c_MD5.png"><br>
行转列后的效果是：<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/d2fef5fe39e62b03c3ab09214ff9ff8b_MD5.png"><br>
sql如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>	stu_name,
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">max</span>(<span style="color:#fff;font-weight:bold">case</span> course_name <span style="color:#fff;font-weight:bold">when</span> <span style="color:#0ff;font-weight:bold">&#39;数学&#39;</span> <span style="color:#fff;font-weight:bold">then</span> score <span style="color:#fff;font-weight:bold">else</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">end</span>) <span style="color:#fff;font-weight:bold">as</span> <span style="color:#0ff;font-weight:bold">&#39;数学&#39;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">max</span>(<span style="color:#fff;font-weight:bold">case</span> course_name <span style="color:#fff;font-weight:bold">when</span> <span style="color:#0ff;font-weight:bold">&#39;英语&#39;</span> <span style="color:#fff;font-weight:bold">then</span> score <span style="color:#fff;font-weight:bold">else</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">end</span>) <span style="color:#fff;font-weight:bold">as</span> <span style="color:#0ff;font-weight:bold">&#39;英语&#39;</span>, 
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">max</span>(<span style="color:#fff;font-weight:bold">case</span> course_name <span style="color:#fff;font-weight:bold">when</span> <span style="color:#0ff;font-weight:bold">&#39;历史&#39;</span> <span style="color:#fff;font-weight:bold">then</span> score <span style="color:#fff;font-weight:bold">else</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">end</span>) <span style="color:#fff;font-weight:bold">as</span> <span style="color:#0ff;font-weight:bold">&#39;历史&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> 
</span></span><span style="display:flex;"><span>	t_student
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">group</span> <span style="color:#fff;font-weight:bold">by</span> 
</span></span><span style="display:flex;"><span>	stu_name;
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过以上内容的学习，我们这个面试题就迎刃而解了：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">year</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">max</span>(<span style="color:#fff;font-weight:bold">case</span> season <span style="color:#fff;font-weight:bold">when</span> <span style="color:#0ff;font-weight:bold">&#39;一季度&#39;</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">count</span> <span style="color:#fff;font-weight:bold">else</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">end</span>) <span style="color:#fff;font-weight:bold">as</span> <span style="color:#0ff;font-weight:bold">&#39;一季度&#39;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">max</span>(<span style="color:#fff;font-weight:bold">case</span> season <span style="color:#fff;font-weight:bold">when</span> <span style="color:#0ff;font-weight:bold">&#39;二季度&#39;</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">count</span> <span style="color:#fff;font-weight:bold">else</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">end</span>) <span style="color:#fff;font-weight:bold">as</span> <span style="color:#0ff;font-weight:bold">&#39;二季度&#39;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">max</span>(<span style="color:#fff;font-weight:bold">case</span> season <span style="color:#fff;font-weight:bold">when</span> <span style="color:#0ff;font-weight:bold">&#39;三季度&#39;</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">count</span> <span style="color:#fff;font-weight:bold">else</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">end</span>) <span style="color:#fff;font-weight:bold">as</span> <span style="color:#0ff;font-weight:bold">&#39;三季度&#39;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">max</span>(<span style="color:#fff;font-weight:bold">case</span> season <span style="color:#fff;font-weight:bold">when</span> <span style="color:#0ff;font-weight:bold">&#39;四季度&#39;</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">count</span> <span style="color:#fff;font-weight:bold">else</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">end</span>) <span style="color:#fff;font-weight:bold">as</span> <span style="color:#0ff;font-weight:bold">&#39;四季度&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> 
</span></span><span style="display:flex;"><span>	t_temp 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">group</span> <span style="color:#fff;font-weight:bold">by</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">year</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="第十题">第十题<a hidden class="anchor" aria-hidden="true" href="#第十题">#</a></h1>
<p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/8a7911d571487c3bbfed8664398b04f0_MD5.png"></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> 
</span></span><span style="display:flex;"><span>	x.a <span style="color:#f00">开始数字</span>, y.a <span style="color:#f00">结束数字</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> 
</span></span><span style="display:flex;"><span>	(<span style="color:#fff;font-weight:bold">select</span> m.a,row_number() over(<span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> m.a) <span style="color:#fff;font-weight:bold">as</span> rownum <span style="color:#fff;font-weight:bold">from</span> (<span style="color:#fff;font-weight:bold">select</span> a, lag(a) over(<span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> a <span style="color:#fff;font-weight:bold">asc</span>) <span style="color:#fff;font-weight:bold">as</span> pre_a <span style="color:#fff;font-weight:bold">from</span> t) m <span style="color:#fff;font-weight:bold">where</span> m.a - m.pre_a != <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">or</span> m.pre_a <span style="color:#fff;font-weight:bold">is</span> <span style="color:#fff;font-weight:bold">null</span>) x 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">join</span> 
</span></span><span style="display:flex;"><span>	(<span style="color:#fff;font-weight:bold">select</span> n.a,row_number() over(<span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> n.a) <span style="color:#fff;font-weight:bold">as</span> rownum <span style="color:#fff;font-weight:bold">from</span> (<span style="color:#fff;font-weight:bold">select</span> a, lead(a) over(<span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> a <span style="color:#fff;font-weight:bold">asc</span>) <span style="color:#fff;font-weight:bold">as</span> next_a <span style="color:#fff;font-weight:bold">from</span> t) n <span style="color:#fff;font-weight:bold">where</span> n.next_a - n.a != <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">or</span> n.next_a <span style="color:#fff;font-weight:bold">is</span> <span style="color:#fff;font-weight:bold">null</span>) y 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">on</span> 
</span></span><span style="display:flex;"><span>	x.rownum = y.rownum;
</span></span></code></pre></td></tr></table>
</div>
</div><p>解答上面这个题目需要具备以下知识点：</p>
<ul>
<li>lag函数</li>
<li>lead函数</li>
<li>row_number函数</li>
</ul>
<p><strong>lag函数</strong>：获取当前行的上一行数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> empno,ename,sal,(lag(sal) over(<span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> sal <span style="color:#fff;font-weight:bold">asc</span>)) <span style="color:#fff;font-weight:bold">as</span> pre_sal <span style="color:#fff;font-weight:bold">from</span> emp;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/176a227726556db92cef569a0624e543_MD5.png"><br>
注意：over函数用来指定“在&hellip;..范围内”，通常和lag函数联用。</p>
<p><strong>lead函数</strong>：获取当前行的下一行数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> empno,ename,sal,(lead(sal) over(<span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> sal <span style="color:#fff;font-weight:bold">asc</span>)) <span style="color:#fff;font-weight:bold">as</span> next_sal <span style="color:#fff;font-weight:bold">from</span> emp;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/4a3c6f42e745c0a8efdd5aeea6fa872d_MD5.png"><br>
注意：over函数用来指定“在&hellip;..范围内”，通常和lead函数联用。</p>
<p><strong>row_number函数</strong>：可以为查询结果集生成行号：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> empno,ename,sal,row_number() over(<span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> sal) <span style="color:#fff;font-weight:bold">as</span> rownum <span style="color:#fff;font-weight:bold">from</span> emp;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/9462ee87e9045f104c6fa0d5b31e1a3c_MD5.png"></p>
<p>利用row_number函数，将两个不相关的列拼接在一起显示：<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/95b7136b6b04acce1a5a7d37e0ffb859_MD5.png"><br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/945a9fffb5e43fec5af8803f4979f189_MD5.png"></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> 
</span></span><span style="display:flex;"><span>	x.a, y.b 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> 
</span></span><span style="display:flex;"><span>	(<span style="color:#fff;font-weight:bold">select</span> a,row_number() over(<span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> a) <span style="color:#fff;font-weight:bold">as</span> rownum <span style="color:#fff;font-weight:bold">from</span> t1) x 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">join</span> 
</span></span><span style="display:flex;"><span>	(<span style="color:#fff;font-weight:bold">select</span> b,row_number() over(<span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> b) <span style="color:#fff;font-weight:bold">as</span> rownum <span style="color:#fff;font-weight:bold">from</span> t2) y 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">on</span> 
</span></span><span style="display:flex;"><span>	x.rownum = y.rownum;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/de542e219b47bc0f0c4ada6333df7748_MD5.png"></p>
<p>CTE语法（公用表表达式）：Common Table Expression。创建临时表的一种语法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#007f7f">-- 查询每个部门平均工资的工资等级
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 第一种写法
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">select</span> 
</span></span><span style="display:flex;"><span>	t.deptno,t.avgsal,s.grade 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> 
</span></span><span style="display:flex;"><span>	(<span style="color:#fff;font-weight:bold">select</span> deptno,<span style="color:#fff;font-weight:bold">avg</span>(sal) <span style="color:#fff;font-weight:bold">as</span> avgsal <span style="color:#fff;font-weight:bold">from</span> emp <span style="color:#fff;font-weight:bold">group</span> <span style="color:#fff;font-weight:bold">by</span> deptno) t 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">join</span> 
</span></span><span style="display:flex;"><span>	salgrade s 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">on</span> 
</span></span><span style="display:flex;"><span>	t.avgsal <span style="color:#fff;font-weight:bold">between</span> s.losal <span style="color:#fff;font-weight:bold">and</span> s.hisal;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 第二种写法：使用CTE语法
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">with</span> cte_exp <span style="color:#fff;font-weight:bold">as</span>(<span style="color:#fff;font-weight:bold">select</span> deptno,<span style="color:#fff;font-weight:bold">avg</span>(sal) <span style="color:#fff;font-weight:bold">as</span> avgsal <span style="color:#fff;font-weight:bold">from</span> emp <span style="color:#fff;font-weight:bold">group</span> <span style="color:#fff;font-weight:bold">by</span> deptno)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> 
</span></span><span style="display:flex;"><span>	cte_exp.deptno,cte_exp.avgsal,s.grade
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span>
</span></span><span style="display:flex;"><span>	cte_exp
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">join</span>
</span></span><span style="display:flex;"><span>	salgrade s
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">on</span>
</span></span><span style="display:flex;"><span>	cte_exp.avgsal <span style="color:#fff;font-weight:bold">between</span> s.losal <span style="color:#fff;font-weight:bold">and</span> s.hisal;
</span></span></code></pre></td></tr></table>
</div>
</div><p>partition by：将数据分区，和group by区别是：group by是分组，然后和分组函数一起用。partition by分区不需要和分组函数一起使用</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> deptno, empno,ename,sal,(lag(sal) over(partition <span style="color:#fff;font-weight:bold">by</span> deptno <span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> sal <span style="color:#fff;font-weight:bold">asc</span>)) <span style="color:#fff;font-weight:bold">as</span> pre_sal <span style="color:#fff;font-weight:bold">from</span> emp;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC11%E7%AB%A0-%E4%BC%81%E4%B8%9A%E7%9C%9F%E9%A2%98/f60e8cc3569c6fabc64969c716d08469_MD5.png"></p>
<p>MySQL 8.0及以上版本中支持如下常用的窗口函数：</p>
<ol>
<li>ROW_NUMBER()：排名函数，返回当前结果集中每个行的行号；</li>
<li>RANK()：排名函数，计算分组结果中的排名，相同的行排名相同且没有空缺，下一个行排名跳过空缺；</li>
<li>DENSE_RANK()：排名函数，计算分组结果中的排名，相同的行排名相同，排名连续，没有空缺；</li>
<li>NTILE()：将分组结果等分为指定的组数，计算每组的大小；</li>
<li>LAG()：返回分组内前一行的值；</li>
<li>LEAD()：返回分组内后一行的值；</li>
<li>FIRST_VALUE()：返回分组内第一个值；</li>
<li>LAST_VALUE()：返回分组内最后一个值；</li>
<li>AVG()、SUM()、COUNT()、MIN()、MAX()：聚合函数，可以配合OVER()进行窗口操作。</li>
</ol>
<p>需要注意的是，MySQL的窗口函数和其他DBMS中的窗口函数相比较，可能略有不同，需要根据MySQL的文档进行使用。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/mysql/">Mysql</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
