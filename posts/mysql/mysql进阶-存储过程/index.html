<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>mysql进阶-存储过程 | Wjy&#39;s Blog</title>
<meta name="keywords" content="mysql">
<meta name="description" content="概述
SQL语句需要先编译然后执行，而存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。
存储过程是可编程的函数，在数据库中(数据字典表)创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://009965.xyz/posts/mysql/mysql%E8%BF%9B%E9%98%B6-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://009965.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://009965.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://009965.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://009965.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://009965.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://009965.xyz/posts/mysql/mysql%E8%BF%9B%E9%98%B6-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://009965.xyz/posts/mysql/mysql%E8%BF%9B%E9%98%B6-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="mysql进阶-存储过程">
  <meta property="og:description" content="概述 SQL语句需要先编译然后执行，而存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。 存储过程是可编程的函数，在数据库中(数据字典表)创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-12-05T20:08:17+00:00">
    <meta property="article:modified_time" content="2019-12-05T20:08:17+00:00">
    <meta property="article:tag" content="Mysql">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mysql进阶-存储过程">
<meta name="twitter:description" content="概述
SQL语句需要先编译然后执行，而存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。
存储过程是可编程的函数，在数据库中(数据字典表)创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://009965.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "mysql进阶-存储过程",
      "item": "https://009965.xyz/posts/mysql/mysql%E8%BF%9B%E9%98%B6-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "mysql进阶-存储过程",
  "name": "mysql进阶-存储过程",
  "description": "概述 SQL语句需要先编译然后执行，而存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。 存储过程是可编程的函数，在数据库中(数据字典表)创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。\n",
  "keywords": [
    "mysql"
  ],
  "articleBody": "概述 SQL语句需要先编译然后执行，而存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。 存储过程是可编程的函数，在数据库中(数据字典表)创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。\n优点 增强SQL语言的功能和灵活性：将重复性很高的一些操作，封装到一个存储过程中，简化了对这些SQL的调用 组件式编程：存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响。 较快的执行速度：存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。 减少网络流量：针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织进存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大减少网络流量并降低了网络负载。 保证数据安全：通过对执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。 创建存储过程 完整语法：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 CREATE [DEFINER = { user | CURRENT_USER }] PROCEDURE sp_name ([proc_parameter[,...]]) [characteristic ...] routine_body proc_parameter: [ IN | OUT | INOUT ] param_name type characteristic: COMMENT 'string' | LANGUAGE SQL | [NOT] DETERMINISTIC | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } | SQL SECURITY { DEFINER | INVOKER } routine_body: Valid SQL routine statement [begin_label:] BEGIN [statement_list] …… END [end_label] 简单语法：\n1 2 3 4 5 6 7 CREATE PROCEDURE 过程名 ([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]]) [特性 ...] BEGIN 过程体 END 存储过程传入表名，mysql是不支持表名，列名做参数的。只能采用动态拼接的方法来生成sql语句。 参考：\n1 2 3 4 5 6 7 8 9 10 DROP PROCEDURE IF EXISTS `pagePro`; CREATE DEFINER = `root`@`localhost` PROCEDURE `pagePro`(in pageNo int,in pageSize int,in tableName varchar(50)) BEGIN DECLARE startIndex INT; set startIndex = pageSize * (pageNo-1); set @s = concat(\"select * from \",tableName,\" LIMIT \",startIndex,\",\",pageSize); prepare stmt from @s; execute stmt; DEALLOCATE prepare stmt; END; 存储过程体 存储过程体包含了在过程调用时必须执行的语句，例如：dml、ddl语句，if-then-else和while-do语句、声明变量的declare语句等 过程体格式：以begin开始，以end结束(可嵌套)\n1 2 3 4 5 6 7 BEGIN BEGIN BEGIN statements; END END END 注意：每个嵌套块及其中的每条语句，必须以分号结束，表示过程体结束的begin-end块(又叫做复合语句compound statement)，则不需要分号。\n为语句块贴标签 1 2 3 [begin_label:] BEGIN [statement_list] END [end_label] 示例：\n1 2 3 4 5 6 7 label1: BEGIN label2: BEGIN label3: BEGIN statements; END label3 ; END label2; END label1 标签的作用： ①增强代码的可读性 ②在某些语句(例如:leave和iterate语句)，需要用到标签\n简单示例：\n1 2 3 4 5 6 7 DELIMITER // CREATE PROCEDURE myproc(OUT s int) BEGIN SELECT COUNT(*) INTO s FROM students; END // DELIMITER; 分隔符 MySQL默认以\";“为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个”//“之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。\n参数 存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用”,“分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:\nIN参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值 OUT：该值可在存储过程内部被改变，并可返回 INOUT：调用时指定，并且可被改变和返回\n过程体 过程体的开始与结束使用BEGIN与END进行标识。\nin参数例子 1 2 3 4 5 6 7 8 9 10 11 12 13 DELIMITER // CREATE PROCEDURE in_param(IN p_in int) BEGIN SELECT p_in; SET p_in=2; SELECT p_in; END; // DELIMITER ; #调用 SET @p_in=1; CALL in_param(@p_in); SELECT @p_in; 结果：\n1 2 3 4 5 6 7 8 p_in 1 p_in 2 @p_in 1 以上可以看出，p_in虽然在存储过程中被修改，但并不影响@p_id的值，因为前者为局部变量、后者为全局变量。\nOUT参数例子 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #存储过程OUT参数 DELIMITER // CREATE PROCEDURE out_param(OUT p_out int) BEGIN SELECT p_out; SET p_out=2; SELECT p_out; END; // DELIMITER ; #调用 SET @p_out=1; CALL out_param(@p_out); SELECT @p_out; 结果：\n1 2 3 4 5 6 7 8 9 10 p_out (null) #因为out是向调用者输出参数，不接收输入的参数，所以存储过程里的p_out为null p_out 2 @p_out 2 #调用了out_param存储过程，输出参数，改变了p_out变量的值 INOUT参数例子 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #存储过程INOUT参数 DELIMITER // CREATE PROCEDURE inout_param(INOUT p_inout int) BEGIN SELECT p_inout; SET p_inout=2; SELECT p_inout; END; // DELIMITER ; #调用 SET @p_inout=1; CALL inout_param(@p_inout) ; SELECT @p_inout; 结果：\n1 2 3 4 5 6 7 8 p_inout 1 p_inout 2 @p_inout 2 注意1： ①如果过程没有参数，也必须在过程名后面写上小括号 例：CREATE PROCEDURE sp_name ([proc_parameter[,…]]) …… ②确保参数的名字不等于列的名字，否则在过程体中，参数名被当做列名来处理\n注意2： 输入值使用in参数； 返回值使用out参数； inout参数就尽量的少用。\n变量 语法： DECLARE 变量名1[,变量名2...] 数据类型 [默认值]; 数据类型为MySQL的数据类型。\n变量赋值 语法： SET 变量名 = 变量值 [,变量名= 变量值 ...]\n用户变量 用户变量一般以@开头，请规范命名用户变量\n示例 1 2 SELECT 'Hello World' into @x; SELECT @x; 示例2：\n1 2 SET @y='Goodbye Cruel World'; SELECT @y; 示例3：\n1 2 SET @z=1+2+3; SELECT @z; 在存储过程中使用用户变量 1 2 3 CREATE PROCEDURE GreetWorld() SELECT CONCAT(@greeting,' World'); SET @greeting='Hello'; CALL GreetWorld(); 结果： Hello World\n在存储过程间传递全局范围的用户变量 1 2 3 4 CREATE PROCEDURE p1() SET @last_proc='p1'; CREATE PROCEDURE p2() SELECT CONCAT('Last procedure was ',@last_proc); CALL p1(); CALL p2(); 结果： Last procedure was p1\n注释 MySQL存储过程可使用两种风格的注释：\n双杠：–，该风格一般用于单行注释 C风格： 一般用于多行注释\n调用 用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。\n存储过程的查询 查询存储过程:\n1 2 3 SELECT name FROM mysql.proc WHERE db='数据库名'; SELECT routine_name FROM information_schema.routines WHERE routine_schema='数据库名'; SHOW PROCEDURE STATUS WHERE db='数据库名'; 查看存储过程详细信息: SHOW CREATE PROCEDURE 数据库.存储过程名;\n存储过程的修改 1 2 3 4 5 ALTER {PROCEDURE | FUNCTION} sp_name [characteristic ...] characteristic: { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } | SQL SECURITY { DEFINER | INVOKER } | COMMENT 'string' .sp_name参数表示存储过程或函数的名称； .characteristic参数指定存储函数的特性。 .CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句； .NO SQL表示子程序中不包含SQL语句； .READS SQL DATA表示子程序中包含读数据的语句； .MODIFIES SQL DATA表示子程序中包含写数据的语句。 .SQL SECURITY { DEFINER | INVOKER }指明谁有权限来执行，DEFINER表示只有定义者自己才能够执行；INVOKER表示调用者可以执行。 .COMMENT ‘string’是注释信息。\n示例：\n1 2 3 4 5 6 7 8 #将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。 ALTER PROCEDURE num_from_employee MODIFIES SQL DATA SQL SECURITY INVOKER ; #将读写权限改为READS SQL DATA，并加上注释信息'FIND NAME'。 ALTER PROCEDURE name_from_employee READS SQL DATA COMMENT 'FIND NAME'; 删除存储过程 DROP PROCEDURE [过程1[,过程2…]] 从MySQL的表格中删除一个或多个存储过程。\n存储过程的控制语句 变量作用域 内部变量在其作用域范围内享有更高的优先权，当执行到end时，内部变量消失，不再可见了，在存储过程外再也找不到这个内部变量，但是可以通过out参数或者将其值指派给会话变量来保存其值。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 DELIMITER // CREATE PROCEDURE proc() BEGIN DECLARE x1 VARCHAR(5) DEFAULT 'outer'; BEGIN DECLARE x1 VARCHAR(5) DEFAULT 'inner'; SELECT x1; END; SELECT x1; END; // DELIMITER ; #调用 CALL proc(); 结果： inner\n条件语句 IF-THEN-ELSE语句\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #条件语句IF-THEN-ELSE DROP PROCEDURE IF EXISTS proc3; DELIMITER // CREATE PROCEDURE proc3(IN parameter int) BEGIN DECLARE var int; SET var=parameter+1; IF var=0 THEN INSERT INTO t VALUES (17); END IF ; IF parameter=0 THEN UPDATE t SET s1=s1+1; ELSE UPDATE t SET s1=s1+2; END IF ; END ; // DELIMITER ; CASE-WHEN-THEN-ELSE语句\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #CASE-WHEN-THEN-ELSE语句 DELIMITER // CREATE PROCEDURE proc4 (IN parameter INT) BEGIN DECLARE var INT; SET var=parameter+1; CASE var WHEN 0 THEN INSERT INTO t VALUES (17); WHEN 1 THEN INSERT INTO t VALUES (18); ELSE INSERT INTO t VALUES (19); END CASE ; END ; // DELIMITER ; 循环语句 WHILE-DO…END-WHILE\n1 2 3 4 5 6 7 8 9 10 11 12 DELIMITER // CREATE PROCEDURE proc5() BEGIN DECLARE var INT; SET var=0; WHILE var\u003c6 DO INSERT INTO t VALUES (var); SET var=var+1; END WHILE ; END; // DELIMITER ; REPEAT…END REPEAT 此语句的特点是执行操作后检查结果\n1 2 3 4 5 6 7 8 9 10 11 12 13 DELIMITER // CREATE PROCEDURE proc6 () BEGIN DECLARE v INT; SET v=0; REPEAT INSERT INTO t VALUES(v); SET v=v+1; UNTIL v\u003e=5 END REPEAT; END; // DELIMITER ; LOOP…END LOOP\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 DELIMITER // CREATE PROCEDURE proc7 () BEGIN DECLARE v INT; SET v=0; LOOP_LABLE:LOOP INSERT INTO t VALUES(v); SET v=v+1; IF v \u003e=5 THEN LEAVE LOOP_LABLE; END IF; END LOOP; END; // DELIMITER; LABLES标号 标号可以用在begin repeat while 或者loop 语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。\nITERATE迭代 通过引用复合语句的标号,来从新开始复合语句\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #ITERATE DELIMITER // CREATE PROCEDURE proc8() BEGIN DECLARE v INT; SET v=0; LOOP_LABLE:LOOP IF v=3 THEN SET v=v+1; ITERATE LOOP_LABLE; END IF; INSERT INTO t VALUES(v); SET v=v+1; IF v\u003e=5 THEN LEAVE LOOP_LABLE; END IF; END LOOP; END; // DELIMITER; 函数 存储过程可使用的函数与mysql本身的函数一致。\n游标 概述1: 在操作mysql的时候我们知道MySQL检索操作返回一组称为结果集的行。这组返回的行都是与 SQL语句相匹配的行（零行或多行）。 简单的SELECT语句,没有办法得到第一行、下一行或前 10行，也不存在每次一行地处理所有行的简单方法。 有时，需要在检索出来的行中前进或后退一行或多行。这就是使用游标的原因。 游标（ cursor）是一个存储在MySQL服务器上的数据库查询，它不是一条 SELECT语句，而是被该语句检索出来的结果集。 在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。游标主要用于交互式应用，其中用户需要滚动屏幕上的数据，并对数据进行浏览或做出更改。\n概述2： 游标的设计是一种数据缓冲区的思想，用来存放SQL语句执行的结果。游标是一种能从包括多条数据记录的结果集中每次提取一条记录的机制。 尽管游标能遍历结果中的所有行，但一次只指向一行。 游标的作用就是用于对查询数据库所返回的记录进行遍历，以便进行相应的操作。\n简单来说就是查询出来的数据索引，通过对游标的操作（第一个位置、最后一个位置、上一个位置、下一个位置）可以遍历出数据。\n游标的特性 属性： 1.不敏感（Asensitive）：数据库可以选择不复制结果集 2.只读（Read only） 3.不滚动（Nonscrollable）：游标只能向一个方向前进，并且不可以跳过任何一行数据。\n优点： 针对行操作，对从数据库中SELECT查询得到的结果集的每一行，可以进行独立的、相同或不同的操作，是一种分离的思想。\n缺点： 1.性能较低，只能一行一行的操作，在数据量大的情况下，速度过慢。 2.会产生死锁，影响其他业务操作。当数据量大时，使用游标会造成内存不足的现象。\n游标的应用场景 1.存储过程 2.函数 3.触发器 4.事件\n游标的应用 1.定义 DECLARE cursor_name CURSOR FOR select_statement\n2.打开游标 OPEN cursor_name;\n3.读取游标数据 FETCH cursor_name INTO var_name [, var_name]...\n4.关闭游标 CLOSE cursor_name;\n5.释放游标 DEALLOCATE cursor_name;\n使用游标涉及几个明确的步骤。 1、在能够使用游标前，必须声明（定义）它。这个过程实际上没有检索数据，它只是定义要使用的 SELECT语句。 2、一旦声明后，必须打开游标以供使用。这个过程用前面定义的SELECT语句把数据实际检索出来。 3、对于填有数据的游标，根据需要取出（检索）各行。 4、在结束游标使用时，必须关闭游标。 在声明游标后，可根据需要频繁地打开和关闭游标。在游标打开后，可根据需要频繁地执行取操作。\n游标使用示例 1.创建游标测试表\n1 2 3 4 5 6 7 8 9 10 CREATE TABLE cursor_table ( id INT , name VARCHAR(10), age INT )ENGINE=innoDB DEFAULT CHARSET=utf8; insert into cursor_table values(1, '孙悟空', 500); insert into cursor_table values(2, '猪八戒', 200); insert into cursor_table values(3, '沙悟净', 100); insert into cursor_table values(4, '唐僧', 20); 三种方式使用游标创建一个存储过程，统计年龄大于30的记录的数量。 2.Loop循环\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 CREATE PROCEDURE getTotal() BEGIN DECLARE total INT; ##创建接收游标数据的变量 DECLARE sid INT; DECLARE sname VARCHAR(10); #创建总数变量 DECLARE sage INT; #创建结束标志变量 DECLARE done INT DEFAULT false; #创建游标 DECLARE cur CURSOR FOR SELECT id,name,age from cursor_table where age\u003e30; #指定游标循环结束时的返回值 DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true; #设置初始值 SET sage = 0; SET total=0; #打开游标 OPEN cur; #开始循环游标里的数据 read_loop:loop #根据游标当前指向的一条数据 FETCH cur INTO sid,sname,sage; #判断游标的循环是否结束 IF done THEN LEAVE read_loop; #跳出游标循环 END IF; #获取一条数据时，将count值进行累加操作，这里可以做任意你想做的操作， SET total = total + 1; #结束游标循环 END LOOP; #关闭游标 CLOSE cur; #输出结果 SELECT total; END 1 2 #调用存储过程 call getTotal(); 3.While循环\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 CREATE PROCEDURE getTotal() BEGIN DECLARE total INT; ##创建接收游标数据的变量 DECLARE sid INT; DECLARE sname VARCHAR(10); #创建总数变量 DECLARE sage INT; #创建结束标志变量 DECLARE done INT DEFAULT false; #创建游标 DECLARE cur CURSOR FOR SELECT id,name,age from cursor_table where age\u003e30; #指定游标循环结束时的返回值 DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true; SET total = 0; OPEN cur; FETCH cur INTO sid, sname, sage; WHILE(NOT done) DO SET total = total + 1; FETCH cur INTO sid, sname, sage; END WHILE; CLOSE cur; SELECT total; END 4.Repeat循环\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 CREATE getTotal() BEGIN DECLARE total INT; ##创建接收游标数据的变量 DECLARE sid INT; DECLARE sname VARCHAR(10); #创建总数变量 DECLARE sage INT; #创建结束标志变量 DECLARE done INT DEFAULT false; #创建游标 DECLARE cur CURSOR FOR SELECT id,name,age from cursor_table where age \u003e 30; #指定游标循环结束时的返回值 DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true; SET total = 0; OPEN cur; REPEAT FETCH cur INTO sid, sname, sage; IF NOT done THEN SET total = total + 1; END IF; UNTIL done END REPEAT; CLOSE cur; SELECT total; END 5.使用游标批量更新数据\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 BEGIN DECLARE no_more_record INT DEFAULT 0; DECLARE pID BIGINT(20); DECLARE pValue DECIMAL(15,5); DECLARE cur_record CURSOR FOR SELECT colA, colB from tableABC; /*首先这里对游标进行定义*/ DECLARE CONTINUE HANDLER FOR NOT FOUND SET no_more_record = 1; /*这个是个条件处理,针对NOT FOUND的条件,当没有记录时赋值为1*/ OPEN cur_record; /*接着使用OPEN打开游标*/ FETCH cur_record INTO pID, pValue; /*把第一行数据写入变量中,游标也随之指向了记录的第一行*/ WHILE no_more_record != 1 DO INSERT INTO testTable(ID, Value) VALUES (pID, pValue); FETCH cur_record INTO pID, pValue; END WHILE; CLOSE cur_record; /*用完后记得用CLOSE把资源释放掉*/ END ",
  "wordCount" : "5617",
  "inLanguage": "en",
  "datePublished": "2019-12-05T20:08:17Z",
  "dateModified": "2019-12-05T20:08:17Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://009965.xyz/posts/mysql/mysql%E8%BF%9B%E9%98%B6-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://009965.xyz/favicon.ico"
    }
  }
}
</script>

  <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.min.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath:  [['\\(', '\\)'], ['$', '$']],  
    }
  };
</script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      mysql进阶-存储过程
    </h1>
    <div class="post-meta"><span title='2019-12-05 20:08:17 +0000 UTC'>2019-12-05</span>&nbsp;·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%a6%82%e8%bf%b0" aria-label="概述">概述</a></li>
                <li>
                    <a href="#%e4%bc%98%e7%82%b9" aria-label="优点">优点</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b" aria-label="创建存储过程">创建存储过程</a><ul>
                        
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e4%bd%93" aria-label="存储过程体">存储过程体</a></li>
                <li>
                    <a href="#%e4%b8%ba%e8%af%ad%e5%8f%a5%e5%9d%97%e8%b4%b4%e6%a0%87%e7%ad%be" aria-label="为语句块贴标签">为语句块贴标签</a></li>
                <li>
                    <a href="#%e5%88%86%e9%9a%94%e7%ac%a6" aria-label="分隔符">分隔符</a></li>
                <li>
                    <a href="#%e5%8f%82%e6%95%b0" aria-label="参数">参数</a></li>
                <li>
                    <a href="#%e8%bf%87%e7%a8%8b%e4%bd%93" aria-label="过程体">过程体</a></li>
                <li>
                    <a href="#in%e5%8f%82%e6%95%b0%e4%be%8b%e5%ad%90" aria-label="in参数例子">in参数例子</a></li>
                <li>
                    <a href="#out%e5%8f%82%e6%95%b0%e4%be%8b%e5%ad%90" aria-label="OUT参数例子">OUT参数例子</a></li>
                <li>
                    <a href="#inout%e5%8f%82%e6%95%b0%e4%be%8b%e5%ad%90" aria-label="INOUT参数例子">INOUT参数例子</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8f%98%e9%87%8f" aria-label="变量">变量</a><ul>
                        
                <li>
                    <a href="#%e5%8f%98%e9%87%8f%e8%b5%8b%e5%80%bc" aria-label="变量赋值">变量赋值</a></li>
                <li>
                    <a href="#%e7%94%a8%e6%88%b7%e5%8f%98%e9%87%8f" aria-label="用户变量">用户变量</a><ul>
                        
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b" aria-label="示例">示例</a></li>
                <li>
                    <a href="#%e5%9c%a8%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e4%b8%ad%e4%bd%bf%e7%94%a8%e7%94%a8%e6%88%b7%e5%8f%98%e9%87%8f" aria-label="在存储过程中使用用户变量">在存储过程中使用用户变量</a></li>
                <li>
                    <a href="#%e5%9c%a8%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e9%97%b4%e4%bc%a0%e9%80%92%e5%85%a8%e5%b1%80%e8%8c%83%e5%9b%b4%e7%9a%84%e7%94%a8%e6%88%b7%e5%8f%98%e9%87%8f" aria-label="在存储过程间传递全局范围的用户变量">在存储过程间传递全局范围的用户变量</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%b3%a8%e9%87%8a" aria-label="注释">注释</a></li>
                <li>
                    <a href="#%e8%b0%83%e7%94%a8" aria-label="调用">调用</a></li>
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e7%9a%84%e6%9f%a5%e8%af%a2" aria-label="存储过程的查询">存储过程的查询</a></li>
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e7%9a%84%e4%bf%ae%e6%94%b9" aria-label="存储过程的修改">存储过程的修改</a></li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b" aria-label="删除存储过程">删除存储过程</a></li>
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e7%9a%84%e6%8e%a7%e5%88%b6%e8%af%ad%e5%8f%a5" aria-label="存储过程的控制语句">存储过程的控制语句</a><ul>
                        
                <li>
                    <a href="#%e5%8f%98%e9%87%8f%e4%bd%9c%e7%94%a8%e5%9f%9f" aria-label="变量作用域">变量作用域</a></li>
                <li>
                    <a href="#%e6%9d%a1%e4%bb%b6%e8%af%ad%e5%8f%a5" aria-label="条件语句">条件语句</a></li>
                <li>
                    <a href="#%e5%be%aa%e7%8e%af%e8%af%ad%e5%8f%a5" aria-label="循环语句">循环语句</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0" aria-label="函数">函数</a></li>
                <li>
                    <a href="#%e6%b8%b8%e6%a0%87" aria-label="游标">游标</a><ul>
                        
                <li>
                    <a href="#%e6%b8%b8%e6%a0%87%e7%9a%84%e7%89%b9%e6%80%a7" aria-label="游标的特性">游标的特性</a></li>
                <li>
                    <a href="#%e6%b8%b8%e6%a0%87%e7%9a%84%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="游标的应用场景">游标的应用场景</a></li>
                <li>
                    <a href="#%e6%b8%b8%e6%a0%87%e7%9a%84%e5%ba%94%e7%94%a8" aria-label="游标的应用">游标的应用</a></li>
                <li>
                    <a href="#%e6%b8%b8%e6%a0%87%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b" aria-label="游标使用示例">游标使用示例</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="概述">概述<a hidden class="anchor" aria-hidden="true" href="#概述">#</a></h1>
<p>SQL语句需要先编译然后执行，而存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。
存储过程是可编程的函数，在数据库中(数据字典表)创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。</p>
<h1 id="优点">优点<a hidden class="anchor" aria-hidden="true" href="#优点">#</a></h1>
<ul>
<li>增强SQL语言的功能和灵活性：将重复性很高的一些操作，封装到一个存储过程中，简化了对这些SQL的调用</li>
<li>组件式编程：存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响。</li>
<li>较快的执行速度：存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。</li>
<li>减少网络流量：针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织进存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大减少网络流量并降低了网络负载。</li>
<li>保证数据安全：通过对执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。</li>
</ul>
<h1 id="创建存储过程">创建存储过程<a hidden class="anchor" aria-hidden="true" href="#创建存储过程">#</a></h1>
<p>完整语法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE
</span></span><span style="display:flex;"><span>    [DEFINER = { user | CURRENT_USER }]
</span></span><span style="display:flex;"><span>　PROCEDURE sp_name ([proc_parameter[,...]])
</span></span><span style="display:flex;"><span>    [characteristic ...] routine_body
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>proc_parameter:
</span></span><span style="display:flex;"><span>    [ IN | OUT | INOUT ] param_name type
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>characteristic:
</span></span><span style="display:flex;"><span>    COMMENT &#39;string&#39;
</span></span><span style="display:flex;"><span>  | LANGUAGE SQL
</span></span><span style="display:flex;"><span>  | [NOT] DETERMINISTIC
</span></span><span style="display:flex;"><span>  | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }
</span></span><span style="display:flex;"><span>  | SQL SECURITY { DEFINER | INVOKER }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>routine_body:
</span></span><span style="display:flex;"><span>　　Valid SQL routine statement
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[begin_label:] BEGIN
</span></span><span style="display:flex;"><span>　　[statement_list]
</span></span><span style="display:flex;"><span>　　　　……
</span></span><span style="display:flex;"><span>END [end_label]
</span></span></code></pre></td></tr></table>
</div>
</div><p>简单语法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE 
</span></span><span style="display:flex;"><span>	PROCEDURE  过程名
</span></span><span style="display:flex;"><span>	([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]])
</span></span><span style="display:flex;"><span>	[特性 ...]
</span></span><span style="display:flex;"><span>	BEGIN
</span></span><span style="display:flex;"><span>		过程体
</span></span><span style="display:flex;"><span>	END
</span></span></code></pre></td></tr></table>
</div>
</div><p>存储过程传入表名，mysql是不支持表名，列名做参数的。只能采用动态拼接的方法来生成sql语句。
参考：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">DROP</span> <span style="color:#fff;font-weight:bold">PROCEDURE</span> <span style="color:#fff;font-weight:bold">IF</span> <span style="color:#fff;font-weight:bold">EXISTS</span> `pagePro`;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> DEFINER = `root`@`localhost` <span style="color:#fff;font-weight:bold">PROCEDURE</span> `pagePro`(<span style="color:#fff;font-weight:bold">in</span> pageNo <span style="color:#fff;font-weight:bold">int</span>,<span style="color:#fff;font-weight:bold">in</span> pageSize <span style="color:#fff;font-weight:bold">int</span>,<span style="color:#fff;font-weight:bold">in</span> tableName <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">50</span>))
</span></span><span style="display:flex;"><span>BEGIN
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">DECLARE</span> startIndex <span style="color:#fff;font-weight:bold">INT</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">set</span> startIndex = pageSize * (pageNo-<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">set</span> @s = concat(<span style="color:#0ff;font-weight:bold">&#34;select * from &#34;</span>,tableName,<span style="color:#0ff;font-weight:bold">&#34; LIMIT &#34;</span>,startIndex,<span style="color:#0ff;font-weight:bold">&#34;,&#34;</span>,pageSize);
</span></span><span style="display:flex;"><span>	prepare stmt <span style="color:#fff;font-weight:bold">from</span> @s;
</span></span><span style="display:flex;"><span>	execute stmt;
</span></span><span style="display:flex;"><span>	DEALLOCATE prepare stmt;
</span></span><span style="display:flex;"><span>END;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="存储过程体">存储过程体<a hidden class="anchor" aria-hidden="true" href="#存储过程体">#</a></h2>
<p>存储过程体包含了在过程调用时必须执行的语句，例如：dml、ddl语句，if-then-else和while-do语句、声明变量的declare语句等
过程体格式：以begin开始，以end结束(可嵌套)</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>BEGIN
</span></span><span style="display:flex;"><span>　　BEGIN
</span></span><span style="display:flex;"><span>　　　　BEGIN
</span></span><span style="display:flex;"><span>　　　　　　statements; 
</span></span><span style="display:flex;"><span>　　　　END
</span></span><span style="display:flex;"><span>　　END
</span></span><span style="display:flex;"><span>END
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：每个嵌套块及其中的每条语句，必须以分号结束，表示过程体结束的begin-end块(又叫做复合语句compound statement)，则不需要分号。</p>
<h2 id="为语句块贴标签">为语句块贴标签<a hidden class="anchor" aria-hidden="true" href="#为语句块贴标签">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>[begin_label:] BEGIN
</span></span><span style="display:flex;"><span>　　[statement_list]
</span></span><span style="display:flex;"><span>END [end_label]
</span></span></code></pre></td></tr></table>
</div>
</div><p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>label1: BEGIN
</span></span><span style="display:flex;"><span>　　label2: BEGIN
</span></span><span style="display:flex;"><span>　　　　label3: BEGIN
</span></span><span style="display:flex;"><span>　　　　　　statements; 
</span></span><span style="display:flex;"><span>　　　　END label3 ;
</span></span><span style="display:flex;"><span>　　END label2;
</span></span><span style="display:flex;"><span>END label1
</span></span></code></pre></td></tr></table>
</div>
</div><p>标签的作用：
①增强代码的可读性
②在某些语句(例如:leave和iterate语句)，需要用到标签</p>
<p>简单示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>  CREATE PROCEDURE myproc(OUT s int)
</span></span><span style="display:flex;"><span>    BEGIN
</span></span><span style="display:flex;"><span>      SELECT COUNT(*) INTO s FROM students;
</span></span><span style="display:flex;"><span>    END
</span></span><span style="display:flex;"><span>    //
</span></span><span style="display:flex;"><span>DELIMITER;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="分隔符">分隔符<a hidden class="anchor" aria-hidden="true" href="#分隔符">#</a></h2>
<p>MySQL默认以&quot;;&ldquo;为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个&rdquo;//&ldquo;之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。</p>
<h2 id="参数">参数<a hidden class="anchor" aria-hidden="true" href="#参数">#</a></h2>
<p>存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用&rdquo;,&ldquo;分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:</p>
<p>IN参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值
OUT：该值可在存储过程内部被改变，并可返回
INOUT：调用时指定，并且可被改变和返回</p>
<h2 id="过程体">过程体<a hidden class="anchor" aria-hidden="true" href="#过程体">#</a></h2>
<p>过程体的开始与结束使用BEGIN与END进行标识。</p>
<h2 id="in参数例子">in参数例子<a hidden class="anchor" aria-hidden="true" href="#in参数例子">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>  CREATE PROCEDURE in_param(IN p_in int)
</span></span><span style="display:flex;"><span>    BEGIN
</span></span><span style="display:flex;"><span>    SELECT p_in;
</span></span><span style="display:flex;"><span>    SET p_in=2;
</span></span><span style="display:flex;"><span>    SELECT p_in;
</span></span><span style="display:flex;"><span>    END;
</span></span><span style="display:flex;"><span>    //
</span></span><span style="display:flex;"><span>DELIMITER ;
</span></span><span style="display:flex;"><span>#调用
</span></span><span style="display:flex;"><span>SET @p_in=1;
</span></span><span style="display:flex;"><span>CALL in_param(@p_in);
</span></span><span style="display:flex;"><span>SELECT @p_in;
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>p_in
</span></span><span style="display:flex;"><span>1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p_in
</span></span><span style="display:flex;"><span>2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@p_in
</span></span><span style="display:flex;"><span>1
</span></span></code></pre></td></tr></table>
</div>
</div><p>以上可以看出，p_in虽然在存储过程中被修改，但并不影响@p_id的值，因为前者为局部变量、后者为全局变量。</p>
<h2 id="out参数例子">OUT参数例子<a hidden class="anchor" aria-hidden="true" href="#out参数例子">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>#存储过程OUT参数
</span></span><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>  CREATE PROCEDURE out_param(OUT p_out int)
</span></span><span style="display:flex;"><span>    BEGIN
</span></span><span style="display:flex;"><span>      SELECT p_out;
</span></span><span style="display:flex;"><span>      SET p_out=2;
</span></span><span style="display:flex;"><span>      SELECT p_out;
</span></span><span style="display:flex;"><span>    END;
</span></span><span style="display:flex;"><span>    //
</span></span><span style="display:flex;"><span>DELIMITER ;
</span></span><span style="display:flex;"><span>#调用
</span></span><span style="display:flex;"><span>SET @p_out=1;
</span></span><span style="display:flex;"><span>CALL out_param(@p_out);
</span></span><span style="display:flex;"><span>SELECT @p_out;
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>p_out
</span></span><span style="display:flex;"><span>(null)
</span></span><span style="display:flex;"><span>#因为out是向调用者输出参数，不接收输入的参数，所以存储过程里的p_out为null
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p_out
</span></span><span style="display:flex;"><span>2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@p_out
</span></span><span style="display:flex;"><span>2
</span></span><span style="display:flex;"><span>#调用了out_param存储过程，输出参数，改变了p_out变量的值
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="inout参数例子">INOUT参数例子<a hidden class="anchor" aria-hidden="true" href="#inout参数例子">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>#存储过程INOUT参数
</span></span><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>  CREATE PROCEDURE inout_param(INOUT p_inout int)
</span></span><span style="display:flex;"><span>    BEGIN
</span></span><span style="display:flex;"><span>      SELECT p_inout;
</span></span><span style="display:flex;"><span>      SET p_inout=2;
</span></span><span style="display:flex;"><span>      SELECT p_inout;
</span></span><span style="display:flex;"><span>    END;
</span></span><span style="display:flex;"><span>    //
</span></span><span style="display:flex;"><span>DELIMITER ;
</span></span><span style="display:flex;"><span>#调用
</span></span><span style="display:flex;"><span>SET @p_inout=1;
</span></span><span style="display:flex;"><span>CALL inout_param(@p_inout) ;
</span></span><span style="display:flex;"><span>SELECT @p_inout;
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>p_inout
</span></span><span style="display:flex;"><span>1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p_inout
</span></span><span style="display:flex;"><span>2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@p_inout
</span></span><span style="display:flex;"><span>2
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意1：
①如果过程没有参数，也必须在过程名后面写上小括号
例：CREATE PROCEDURE sp_name ([proc_parameter[,&hellip;]]) ……
②确保参数的名字不等于列的名字，否则在过程体中，参数名被当做列名来处理</p>
<p>注意2：
输入值使用in参数；
返回值使用out参数；
inout参数就尽量的少用。</p>
<h1 id="变量">变量<a hidden class="anchor" aria-hidden="true" href="#变量">#</a></h1>
<p>语法：
<code>DECLARE 变量名1[,变量名2...] 数据类型 [默认值];</code>
数据类型为MySQL的数据类型。</p>
<h2 id="变量赋值">变量赋值<a hidden class="anchor" aria-hidden="true" href="#变量赋值">#</a></h2>
<p>语法：
<code>SET 变量名 = 变量值 [,变量名= 变量值 ...]</code></p>
<h2 id="用户变量">用户变量<a hidden class="anchor" aria-hidden="true" href="#用户变量">#</a></h2>
<p>用户变量一般以@开头，请规范命名用户变量</p>
<h3 id="示例">示例<a hidden class="anchor" aria-hidden="true" href="#示例">#</a></h3>
<ol>
<li></li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>SELECT &#39;Hello World&#39; into @x;
</span></span><span style="display:flex;"><span>SELECT @x;
</span></span></code></pre></td></tr></table>
</div>
</div><p>示例2：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>SET @y=&#39;Goodbye Cruel World&#39;;
</span></span><span style="display:flex;"><span>SELECT @y;
</span></span></code></pre></td></tr></table>
</div>
</div><p>示例3：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>SET @z=1+2+3;
</span></span><span style="display:flex;"><span>SELECT @z;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="在存储过程中使用用户变量">在存储过程中使用用户变量<a hidden class="anchor" aria-hidden="true" href="#在存储过程中使用用户变量">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE PROCEDURE GreetWorld() SELECT CONCAT(@greeting,&#39; World&#39;);
</span></span><span style="display:flex;"><span>SET @greeting=&#39;Hello&#39;;
</span></span><span style="display:flex;"><span>CALL GreetWorld();
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：
<code>Hello World</code></p>
<h3 id="在存储过程间传递全局范围的用户变量">在存储过程间传递全局范围的用户变量<a hidden class="anchor" aria-hidden="true" href="#在存储过程间传递全局范围的用户变量">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE PROCEDURE p1() SET @last_proc=&#39;p1&#39;;
</span></span><span style="display:flex;"><span>CREATE PROCEDURE p2() SELECT CONCAT(&#39;Last procedure was &#39;,@last_proc);
</span></span><span style="display:flex;"><span>CALL p1();
</span></span><span style="display:flex;"><span>CALL p2();
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：
<code>Last procedure was p1</code></p>
<h1 id="注释">注释<a hidden class="anchor" aria-hidden="true" href="#注释">#</a></h1>
<p>MySQL存储过程可使用两种风格的注释：</p>
<p>双杠：&ndash;，该风格一般用于单行注释
C风格： 一般用于多行注释</p>
<h1 id="调用">调用<a hidden class="anchor" aria-hidden="true" href="#调用">#</a></h1>
<p>用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。</p>
<h1 id="存储过程的查询">存储过程的查询<a hidden class="anchor" aria-hidden="true" href="#存储过程的查询">#</a></h1>
<p>查询存储过程:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>SELECT name FROM mysql.proc WHERE db=&#39;数据库名&#39;;
</span></span><span style="display:flex;"><span>SELECT routine_name FROM information_schema.routines WHERE routine_schema=&#39;数据库名&#39;;
</span></span><span style="display:flex;"><span>SHOW PROCEDURE STATUS WHERE db=&#39;数据库名&#39;;
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看存储过程详细信息:
<code>SHOW CREATE PROCEDURE 数据库.存储过程名;</code></p>
<h1 id="存储过程的修改">存储过程的修改<a hidden class="anchor" aria-hidden="true" href="#存储过程的修改">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ALTER {PROCEDURE | FUNCTION} sp_name [characteristic ...]
</span></span><span style="display:flex;"><span>characteristic:
</span></span><span style="display:flex;"><span>{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }
</span></span><span style="display:flex;"><span>| SQL SECURITY { DEFINER | INVOKER }
</span></span><span style="display:flex;"><span>| COMMENT &#39;string&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>.sp_name参数表示存储过程或函数的名称；
.characteristic参数指定存储函数的特性。
.CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句；
.NO SQL表示子程序中不包含SQL语句；
.READS SQL DATA表示子程序中包含读数据的语句；
.MODIFIES SQL DATA表示子程序中包含写数据的语句。
.SQL SECURITY { DEFINER | INVOKER }指明谁有权限来执行，DEFINER表示只有定义者自己才能够执行；INVOKER表示调用者可以执行。
.COMMENT &lsquo;string&rsquo;是注释信息。</p>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>#将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。
</span></span><span style="display:flex;"><span>ALTER  PROCEDURE  num_from_employee
</span></span><span style="display:flex;"><span>  MODIFIES SQL DATA
</span></span><span style="display:flex;"><span>  SQL SECURITY INVOKER ;
</span></span><span style="display:flex;"><span>#将读写权限改为READS SQL DATA，并加上注释信息&#39;FIND NAME&#39;。
</span></span><span style="display:flex;"><span>ALTER  PROCEDURE  name_from_employee
</span></span><span style="display:flex;"><span>  READS SQL DATA
</span></span><span style="display:flex;"><span>  COMMENT &#39;FIND NAME&#39;;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="删除存储过程">删除存储过程<a hidden class="anchor" aria-hidden="true" href="#删除存储过程">#</a></h1>
<p><code>DROP PROCEDURE [过程1[,过程2…]]</code>
从MySQL的表格中删除一个或多个存储过程。</p>
<h1 id="存储过程的控制语句">存储过程的控制语句<a hidden class="anchor" aria-hidden="true" href="#存储过程的控制语句">#</a></h1>
<h2 id="变量作用域">变量作用域<a hidden class="anchor" aria-hidden="true" href="#变量作用域">#</a></h2>
<p>内部变量在其作用域范围内享有更高的优先权，当执行到end时，内部变量消失，不再可见了，在存储过程外再也找不到这个内部变量，但是可以通过out参数或者将其值指派给会话变量来保存其值。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>  CREATE PROCEDURE proc()
</span></span><span style="display:flex;"><span>    BEGIN
</span></span><span style="display:flex;"><span>      DECLARE x1 VARCHAR(5) DEFAULT &#39;outer&#39;;
</span></span><span style="display:flex;"><span>        BEGIN
</span></span><span style="display:flex;"><span>          DECLARE x1 VARCHAR(5) DEFAULT &#39;inner&#39;;
</span></span><span style="display:flex;"><span>          SELECT x1;
</span></span><span style="display:flex;"><span>        END;
</span></span><span style="display:flex;"><span>      SELECT x1;
</span></span><span style="display:flex;"><span>    END;
</span></span><span style="display:flex;"><span>    //
</span></span><span style="display:flex;"><span>DELIMITER ;
</span></span><span style="display:flex;"><span>#调用
</span></span><span style="display:flex;"><span>CALL proc();
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：
<code>inner</code></p>
<h2 id="条件语句">条件语句<a hidden class="anchor" aria-hidden="true" href="#条件语句">#</a></h2>
<p>IF-THEN-ELSE语句</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#007f7f">#条件语句IF-THEN-ELSE</span>
</span></span><span style="display:flex;"><span>DROP PROCEDURE IF EXISTS proc3;
</span></span><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>CREATE PROCEDURE proc3(IN parameter int)
</span></span><span style="display:flex;"><span>  BEGIN
</span></span><span style="display:flex;"><span>    DECLARE <span style="color:#fff;font-weight:bold">var</span> int;
</span></span><span style="display:flex;"><span>    SET <span style="color:#fff;font-weight:bold">var</span>=parameter+<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    IF <span style="color:#fff;font-weight:bold">var</span>=<span style="color:#ff0;font-weight:bold">0</span> THEN
</span></span><span style="display:flex;"><span>      INSERT INTO t VALUES (<span style="color:#ff0;font-weight:bold">17</span>);
</span></span><span style="display:flex;"><span>    END IF ;
</span></span><span style="display:flex;"><span>    IF parameter=<span style="color:#ff0;font-weight:bold">0</span> THEN
</span></span><span style="display:flex;"><span>      UPDATE t SET s1=s1+<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    ELSE
</span></span><span style="display:flex;"><span>      UPDATE t SET s1=s1+<span style="color:#ff0;font-weight:bold">2</span>;
</span></span><span style="display:flex;"><span>    END IF ;
</span></span><span style="display:flex;"><span>  END ;
</span></span><span style="display:flex;"><span>  //
</span></span><span style="display:flex;"><span>DELIMITER ;
</span></span></code></pre></td></tr></table>
</div>
</div><p>CASE-WHEN-THEN-ELSE语句</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#007f7f">#CASE-WHEN-THEN-ELSE语句</span>
</span></span><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>  CREATE PROCEDURE proc4 (IN parameter INT)
</span></span><span style="display:flex;"><span>    BEGIN
</span></span><span style="display:flex;"><span>      DECLARE <span style="color:#fff;font-weight:bold">var</span> INT;
</span></span><span style="display:flex;"><span>      SET <span style="color:#fff;font-weight:bold">var</span>=parameter+<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>      CASE <span style="color:#fff;font-weight:bold">var</span>
</span></span><span style="display:flex;"><span>        WHEN <span style="color:#ff0;font-weight:bold">0</span> THEN
</span></span><span style="display:flex;"><span>          INSERT INTO t VALUES (<span style="color:#ff0;font-weight:bold">17</span>);
</span></span><span style="display:flex;"><span>        WHEN <span style="color:#ff0;font-weight:bold">1</span> THEN
</span></span><span style="display:flex;"><span>          INSERT INTO t VALUES (<span style="color:#ff0;font-weight:bold">18</span>);
</span></span><span style="display:flex;"><span>        ELSE
</span></span><span style="display:flex;"><span>          INSERT INTO t VALUES (<span style="color:#ff0;font-weight:bold">19</span>);
</span></span><span style="display:flex;"><span>      END CASE ;
</span></span><span style="display:flex;"><span>    END ;
</span></span><span style="display:flex;"><span>  //
</span></span><span style="display:flex;"><span>DELIMITER ;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="循环语句">循环语句<a hidden class="anchor" aria-hidden="true" href="#循环语句">#</a></h2>
<p>WHILE-DO…END-WHILE</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>  CREATE PROCEDURE proc5()
</span></span><span style="display:flex;"><span>    BEGIN
</span></span><span style="display:flex;"><span>      DECLARE <span style="color:#fff;font-weight:bold">var</span> INT;
</span></span><span style="display:flex;"><span>      SET <span style="color:#fff;font-weight:bold">var</span>=<span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>      WHILE <span style="color:#fff;font-weight:bold">var</span>&lt;<span style="color:#ff0;font-weight:bold">6</span> DO
</span></span><span style="display:flex;"><span>        INSERT INTO t VALUES (<span style="color:#fff;font-weight:bold">var</span>);
</span></span><span style="display:flex;"><span>        SET <span style="color:#fff;font-weight:bold">var</span>=<span style="color:#fff;font-weight:bold">var</span>+<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>      END WHILE ;
</span></span><span style="display:flex;"><span>    END;
</span></span><span style="display:flex;"><span>  //
</span></span><span style="display:flex;"><span>DELIMITER ;
</span></span></code></pre></td></tr></table>
</div>
</div><p>REPEAT&hellip;END REPEAT
此语句的特点是执行操作后检查结果</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>  CREATE PROCEDURE proc6 ()
</span></span><span style="display:flex;"><span>    BEGIN
</span></span><span style="display:flex;"><span>      DECLARE v INT;
</span></span><span style="display:flex;"><span>      SET v=0;
</span></span><span style="display:flex;"><span>      REPEAT
</span></span><span style="display:flex;"><span>        INSERT INTO t VALUES(v);
</span></span><span style="display:flex;"><span>        SET v=v+1;
</span></span><span style="display:flex;"><span>        UNTIL v&gt;=5
</span></span><span style="display:flex;"><span>      END REPEAT;
</span></span><span style="display:flex;"><span>    END;
</span></span><span style="display:flex;"><span>  //
</span></span><span style="display:flex;"><span>DELIMITER ;
</span></span></code></pre></td></tr></table>
</div>
</div><p>LOOP&hellip;END LOOP</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>  CREATE PROCEDURE proc7 ()
</span></span><span style="display:flex;"><span>    BEGIN
</span></span><span style="display:flex;"><span>      DECLARE v INT;
</span></span><span style="display:flex;"><span>      SET v=0;
</span></span><span style="display:flex;"><span>      LOOP_LABLE:LOOP
</span></span><span style="display:flex;"><span>        INSERT INTO t VALUES(v);
</span></span><span style="display:flex;"><span>        SET v=v+1;
</span></span><span style="display:flex;"><span>        IF v &gt;=5 THEN
</span></span><span style="display:flex;"><span>          LEAVE LOOP_LABLE;
</span></span><span style="display:flex;"><span>        END IF;
</span></span><span style="display:flex;"><span>      END LOOP;
</span></span><span style="display:flex;"><span>    END;
</span></span><span style="display:flex;"><span>  //
</span></span><span style="display:flex;"><span>DELIMITER;
</span></span></code></pre></td></tr></table>
</div>
</div><p>LABLES标号
标号可以用在begin repeat while 或者loop 语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。</p>
<p>ITERATE迭代
通过引用复合语句的标号,来从新开始复合语句</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>#ITERATE
</span></span><span style="display:flex;"><span>DELIMITER //
</span></span><span style="display:flex;"><span>  CREATE PROCEDURE proc8()
</span></span><span style="display:flex;"><span>  BEGIN
</span></span><span style="display:flex;"><span>    DECLARE v INT;
</span></span><span style="display:flex;"><span>    SET v=0;
</span></span><span style="display:flex;"><span>    LOOP_LABLE:LOOP
</span></span><span style="display:flex;"><span>      IF v=3 THEN
</span></span><span style="display:flex;"><span>        SET v=v+1;
</span></span><span style="display:flex;"><span>        ITERATE LOOP_LABLE;
</span></span><span style="display:flex;"><span>      END IF;
</span></span><span style="display:flex;"><span>      INSERT INTO t VALUES(v);
</span></span><span style="display:flex;"><span>      SET v=v+1;
</span></span><span style="display:flex;"><span>      IF v&gt;=5 THEN
</span></span><span style="display:flex;"><span>        LEAVE LOOP_LABLE;
</span></span><span style="display:flex;"><span>      END IF;
</span></span><span style="display:flex;"><span>    END LOOP;
</span></span><span style="display:flex;"><span>  END;
</span></span><span style="display:flex;"><span>  //
</span></span><span style="display:flex;"><span>DELIMITER;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="函数">函数<a hidden class="anchor" aria-hidden="true" href="#函数">#</a></h1>
<p>存储过程可使用的函数与mysql本身的函数一致。</p>
<h1 id="游标">游标<a hidden class="anchor" aria-hidden="true" href="#游标">#</a></h1>
<p>概述1:
在操作mysql的时候我们知道MySQL检索操作返回一组称为结果集的行。这组返回的行都是与 SQL语句相匹配的行（零行或多行）。
简单的SELECT语句,没有办法得到第一行、下一行或前 10行，也不存在每次一行地处理所有行的简单方法。
有时，需要在检索出来的行中前进或后退一行或多行。这就是使用游标的原因。
游标（ cursor）是一个存储在MySQL服务器上的数据库查询，它不是一条 SELECT语句，而是被该语句检索出来的结果集。
在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。游标主要用于交互式应用，其中用户需要滚动屏幕上的数据，并对数据进行浏览或做出更改。</p>
<p>概述2：
游标的设计是一种数据缓冲区的思想，用来存放SQL语句执行的结果。游标是一种能从包括多条数据记录的结果集中每次提取一条记录的机制。
尽管游标能遍历结果中的所有行，但一次只指向一行。
游标的作用就是用于对查询数据库所返回的记录进行遍历，以便进行相应的操作。</p>
<p>简单来说就是查询出来的数据索引，通过对游标的操作（第一个位置、最后一个位置、上一个位置、下一个位置）可以遍历出数据。</p>
<h2 id="游标的特性">游标的特性<a hidden class="anchor" aria-hidden="true" href="#游标的特性">#</a></h2>
<p>属性：
1.不敏感（Asensitive）：数据库可以选择不复制结果集
2.只读（Read only）
3.不滚动（Nonscrollable）：游标只能向一个方向前进，并且不可以跳过任何一行数据。</p>
<p>优点：
针对行操作，对从数据库中SELECT查询得到的结果集的每一行，可以进行独立的、相同或不同的操作，是一种分离的思想。</p>
<p>缺点：
1.性能较低，只能一行一行的操作，在数据量大的情况下，速度过慢。
2.会产生死锁，影响其他业务操作。当数据量大时，使用游标会造成内存不足的现象。</p>
<h2 id="游标的应用场景">游标的应用场景<a hidden class="anchor" aria-hidden="true" href="#游标的应用场景">#</a></h2>
<p>1.存储过程
2.函数
3.触发器
4.事件</p>
<h2 id="游标的应用">游标的应用<a hidden class="anchor" aria-hidden="true" href="#游标的应用">#</a></h2>
<p>1.定义
<code>DECLARE cursor_name CURSOR FOR select_statement</code></p>
<p>2.打开游标
<code>OPEN cursor_name;</code></p>
<p>3.读取游标数据
<code>FETCH cursor_name INTO var_name [, var_name]...</code></p>
<p>4.关闭游标
<code>CLOSE cursor_name;</code></p>
<p>5.释放游标
<code>DEALLOCATE cursor_name;</code></p>
<p>使用游标涉及几个明确的步骤。
1、在能够使用游标前，必须声明（定义）它。这个过程实际上没有检索数据，它只是定义要使用的 SELECT语句。
2、一旦声明后，必须打开游标以供使用。这个过程用前面定义的SELECT语句把数据实际检索出来。
3、对于填有数据的游标，根据需要取出（检索）各行。
4、在结束游标使用时，必须关闭游标。
在声明游标后，可根据需要频繁地打开和关闭游标。在游标打开后，可根据需要频繁地执行取操作。</p>
<h2 id="游标使用示例">游标使用示例<a hidden class="anchor" aria-hidden="true" href="#游标使用示例">#</a></h2>
<p>1.创建游标测试表</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE TABLE cursor_table
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>id INT ,
</span></span><span style="display:flex;"><span>name VARCHAR(10),
</span></span><span style="display:flex;"><span>age INT
</span></span><span style="display:flex;"><span>)ENGINE=innoDB DEFAULT CHARSET=utf8;
</span></span><span style="display:flex;"><span>insert into cursor_table values(1, &#39;孙悟空&#39;, 500);
</span></span><span style="display:flex;"><span>insert into cursor_table values(2, &#39;猪八戒&#39;, 200);
</span></span><span style="display:flex;"><span>insert into cursor_table values(3, &#39;沙悟净&#39;, 100);
</span></span><span style="display:flex;"><span>insert into cursor_table values(4, &#39;唐僧&#39;, 20);
</span></span></code></pre></td></tr></table>
</div>
</div><p>三种方式使用游标创建一个存储过程，统计年龄大于30的记录的数量。
2.Loop循环</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE  PROCEDURE getTotal()
</span></span><span style="display:flex;"><span>BEGIN
</span></span><span style="display:flex;"><span>    DECLARE total INT; 
</span></span><span style="display:flex;"><span>    ##创建接收游标数据的变量
</span></span><span style="display:flex;"><span>    DECLARE sid INT;
</span></span><span style="display:flex;"><span>    DECLARE sname VARCHAR(10);
</span></span><span style="display:flex;"><span>    #创建总数变量
</span></span><span style="display:flex;"><span>    DECLARE sage INT;
</span></span><span style="display:flex;"><span>    #创建结束标志变量
</span></span><span style="display:flex;"><span>    DECLARE done INT DEFAULT false;
</span></span><span style="display:flex;"><span>    #创建游标
</span></span><span style="display:flex;"><span>    DECLARE cur CURSOR FOR SELECT id,name,age from cursor_table where age&gt;30;
</span></span><span style="display:flex;"><span>    #指定游标循环结束时的返回值
</span></span><span style="display:flex;"><span>    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true;
</span></span><span style="display:flex;"><span>    #设置初始值 
</span></span><span style="display:flex;"><span>    SET sage = 0;
</span></span><span style="display:flex;"><span>    SET total=0;
</span></span><span style="display:flex;"><span>    #打开游标
</span></span><span style="display:flex;"><span>    OPEN cur;
</span></span><span style="display:flex;"><span>    #开始循环游标里的数据
</span></span><span style="display:flex;"><span>    read_loop:loop
</span></span><span style="display:flex;"><span>    #根据游标当前指向的一条数据
</span></span><span style="display:flex;"><span>    FETCH cur INTO sid,sname,sage;
</span></span><span style="display:flex;"><span>    #判断游标的循环是否结束
</span></span><span style="display:flex;"><span>    IF done THEN
</span></span><span style="display:flex;"><span>        LEAVE read_loop;    #跳出游标循环  
</span></span><span style="display:flex;"><span>    END IF;
</span></span><span style="display:flex;"><span>    #获取一条数据时，将count值进行累加操作，这里可以做任意你想做的操作，
</span></span><span style="display:flex;"><span>    SET total = total + 1;
</span></span><span style="display:flex;"><span>    #结束游标循环
</span></span><span style="display:flex;"><span>    END LOOP;
</span></span><span style="display:flex;"><span>    #关闭游标
</span></span><span style="display:flex;"><span>    CLOSE cur;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    #输出结果
</span></span><span style="display:flex;"><span>    SELECT total;
</span></span><span style="display:flex;"><span>END
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>#调用存储过程  
</span></span><span style="display:flex;"><span>call getTotal();
</span></span></code></pre></td></tr></table>
</div>
</div><p>3.While循环</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE  PROCEDURE getTotal()
</span></span><span style="display:flex;"><span>BEGIN
</span></span><span style="display:flex;"><span>    DECLARE total INT; 
</span></span><span style="display:flex;"><span>    ##创建接收游标数据的变量
</span></span><span style="display:flex;"><span>    DECLARE sid INT;
</span></span><span style="display:flex;"><span>    DECLARE sname VARCHAR(10);
</span></span><span style="display:flex;"><span>    #创建总数变量
</span></span><span style="display:flex;"><span>    DECLARE sage INT;
</span></span><span style="display:flex;"><span>    #创建结束标志变量
</span></span><span style="display:flex;"><span>    DECLARE done INT DEFAULT false;
</span></span><span style="display:flex;"><span>    #创建游标
</span></span><span style="display:flex;"><span>    DECLARE cur CURSOR FOR SELECT id,name,age from cursor_table where age&gt;30;
</span></span><span style="display:flex;"><span>    #指定游标循环结束时的返回值
</span></span><span style="display:flex;"><span>    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true; 
</span></span><span style="display:flex;"><span>    SET total = 0;
</span></span><span style="display:flex;"><span>    OPEN cur;
</span></span><span style="display:flex;"><span>    FETCH cur INTO sid, sname, sage;
</span></span><span style="display:flex;"><span>    WHILE(NOT done) 
</span></span><span style="display:flex;"><span>    DO
</span></span><span style="display:flex;"><span>        SET total = total + 1;  
</span></span><span style="display:flex;"><span>        FETCH cur INTO sid, sname, sage;  
</span></span><span style="display:flex;"><span>    END WHILE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    CLOSE cur;
</span></span><span style="display:flex;"><span>    SELECT total;
</span></span><span style="display:flex;"><span>END
</span></span></code></pre></td></tr></table>
</div>
</div><p>4.Repeat循环</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE getTotal()
</span></span><span style="display:flex;"><span>BEGIN
</span></span><span style="display:flex;"><span>    DECLARE total INT; 
</span></span><span style="display:flex;"><span>    ##创建接收游标数据的变量
</span></span><span style="display:flex;"><span>    DECLARE sid INT;
</span></span><span style="display:flex;"><span>    DECLARE sname VARCHAR(10);
</span></span><span style="display:flex;"><span>    #创建总数变量
</span></span><span style="display:flex;"><span>    DECLARE sage INT;
</span></span><span style="display:flex;"><span>    #创建结束标志变量
</span></span><span style="display:flex;"><span>    DECLARE done INT DEFAULT false;
</span></span><span style="display:flex;"><span>    #创建游标
</span></span><span style="display:flex;"><span>    DECLARE cur CURSOR FOR SELECT id,name,age from cursor_table where age &gt; 30;
</span></span><span style="display:flex;"><span>    #指定游标循环结束时的返回值
</span></span><span style="display:flex;"><span>    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true; 
</span></span><span style="display:flex;"><span>    SET total = 0;
</span></span><span style="display:flex;"><span>    OPEN cur;
</span></span><span style="display:flex;"><span>    REPEAT
</span></span><span style="display:flex;"><span>    FETCH cur INTO sid, sname, sage;
</span></span><span style="display:flex;"><span>    IF NOT done THEN
</span></span><span style="display:flex;"><span>        SET total = total + 1;  
</span></span><span style="display:flex;"><span>    END IF;
</span></span><span style="display:flex;"><span>    UNTIL done END REPEAT;
</span></span><span style="display:flex;"><span>    CLOSE cur;
</span></span><span style="display:flex;"><span>    SELECT total;
</span></span><span style="display:flex;"><span>END
</span></span></code></pre></td></tr></table>
</div>
</div><p>5.使用游标批量更新数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>BEGIN
</span></span><span style="display:flex;"><span> DECLARE  no_more_record INT DEFAULT 0;
</span></span><span style="display:flex;"><span> DECLARE  pID BIGINT(20);
</span></span><span style="display:flex;"><span> DECLARE  pValue DECIMAL(15,5);
</span></span><span style="display:flex;"><span> DECLARE  cur_record CURSOR FOR   SELECT colA, colB from tableABC;  /*首先这里对游标进行定义*/
</span></span><span style="display:flex;"><span> DECLARE  CONTINUE HANDLER FOR NOT FOUND  SET  no_more_record = 1; /*这个是个条件处理,针对NOT FOUND的条件,当没有记录时赋值为1*/
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> OPEN  cur_record; /*接着使用OPEN打开游标*/
</span></span><span style="display:flex;"><span> FETCH  cur_record INTO pID, pValue; /*把第一行数据写入变量中,游标也随之指向了记录的第一行*/
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> WHILE no_more_record != 1 DO
</span></span><span style="display:flex;"><span> INSERT  INTO testTable(ID, Value)
</span></span><span style="display:flex;"><span> VALUES  (pID, pValue);
</span></span><span style="display:flex;"><span> FETCH  cur_record INTO pID, pValue;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> END WHILE;
</span></span><span style="display:flex;"><span> CLOSE  cur_record;  /*用完后记得用CLOSE把资源释放掉*/
</span></span><span style="display:flex;"><span>END
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/mysql/">Mysql</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>