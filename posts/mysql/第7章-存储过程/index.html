<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>第7章 存储过程 | Wjy&#39;s Blog</title>
<meta name="keywords" content="mysql">
<meta name="description" content="什么是存储过程？ 存储过程可称为过程化SQL语言，是在普通SQL语句的基础上增加了编程语言的特点，把数据操作语句(DML)和查询语句(DQL)">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://009965.xyz/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://009965.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://009965.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://009965.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://009965.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://009965.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://009965.xyz/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://009965.xyz/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="第7章 存储过程">
  <meta property="og:description" content="什么是存储过程？ 存储过程可称为过程化SQL语言，是在普通SQL语句的基础上增加了编程语言的特点，把数据操作语句(DML)和查询语句(DQL)">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-05-25T18:13:04+00:00">
    <meta property="article:modified_time" content="2025-05-25T18:13:04+00:00">
    <meta property="article:tag" content="Mysql">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第7章 存储过程">
<meta name="twitter:description" content="什么是存储过程？ 存储过程可称为过程化SQL语言，是在普通SQL语句的基础上增加了编程语言的特点，把数据操作语句(DML)和查询语句(DQL)">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://009965.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "第7章 存储过程",
      "item": "https://009965.xyz/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "第7章 存储过程",
  "name": "第7章 存储过程",
  "description": "什么是存储过程？ 存储过程可称为过程化SQL语言，是在普通SQL语句的基础上增加了编程语言的特点，把数据操作语句(DML)和查询语句(DQL)",
  "keywords": [
    "mysql"
  ],
  "articleBody": "什么是存储过程？ 存储过程可称为过程化SQL语言，是在普通SQL语句的基础上增加了编程语言的特点，把数据操作语句(DML)和查询语句(DQL)组织在过程化代码中，通过逻辑判断、循环等操作实现复杂计算的程序语言。\n换句话说，存储过程其实就是数据库内置的一种编程语言，这种编程语言也有自己的变量、if语句、循环语句等。在一个存储过程中可以将多条SQL语句以逻辑代码的方式将其串联起来，执行这个存储过程就是将这些SQL语句按照一定的逻辑去执行，所以一个存储过程也可以看做是一组为了完成特定功能的SQL 语句集。\n每一个存储过程都是一个数据库对象，就像table和view一样，存储在数据库当中，一次编译永久有效。并且每一个存储过程都有自己的名字。客户端程序通过存储过程的名字来调用存储过程。\n在数据量特别庞大的情况下利用存储过程能达到倍速的效率提升。\n存储过程的优点和缺点？ 优点：速度快。\n- 降低了**应用服务器**和**数据库服务器**之间网络通讯的开销。尤其在数据量庞大的情况下效果显著。 缺点：移植性差。编写难度大。维护性差。\n- 每一个数据库都有自己的存储过程的语法规则，这种语法规则不是通用的。一旦使用了存储过程，则数据库产品很难更换，例如：编写了mysql的存储过程，这段代码只能在mysql中运行，无法在oracle数据库中运行。 - 对于数据库存储过程这种语法来说，没有专业的IDE工具（集成开发环境），所以编码速度较低。自然维护的成本也会较高。 在实际开发中，存储过程还是很少使用的。只有在系统遇到了性能瓶颈，在进行优化的时候，对于大数量的应用来说，可以考虑使用一些。\n第一个存储过程 存储过程的创建 1 2 3 4 create procedure p1() begin select empno,ename from emp; end; 存储过程的调用 1 call p1(); 存储过程的查看 查看创建存储过程的语句：\n1 show create procedure p1; 通过系统表information_schema.ROUTINES查看存储过程的详细信息：\ninformation_schema.ROUTINES 是 MySQL 数据库中一个系统表，存储了所有存储过程、函数、触发器的详细信息，包括名称、返回值类型、参数、创建时间、修改时间等。\n1 select * from information_schema.routines where routine_name = 'p1'; information_schema.ROUTINES 表中的一些重要的列包括：\nSPECIFIC_NAME：存储过程的具体名称，包括该存储过程的名字，参数列表。 ROUTINE_SCHEMA：存储过程所在的数据库名称。 ROUTINE_NAME：存储过程的名称。 ROUTINE_TYPE：PROCEDURE表示是一个存储过程，FUNCTION表示是一个函数。 ROUTINE_DEFINITION：存储过程的定义语句。 CREATED：存储过程的创建时间。 LAST_ALTERED：存储过程的最后修改时间。 DATA_TYPE：存储过程的返回值类型、参数类型等。 存储过程的删除 1 drop procedure if exists p1; delimiter命令 在 MySQL 中，delimiter 命令用于改变 MySQL 解释语句的定界符。MySQL 默认使用分号 ; 作为语句的定界符。而使用 delimiter 命令可以将分号 ; 更改为其他字符，从而可以在 SQL 语句中使用分号 ;。\n例如，假设需要创建一个存储过程。在存储过程中通常会包括多条 SQL 语句，而这些语句都需要以分号 ; 结尾。但默认情况下，执行到第一条语句的分号 ; 后，MySQL 就会停止解释，导致后续的语句无法执行。解决方式就是使用 delimiter 命令将分号改为其他字符，使分号 ; 不再是语句定界符。例如：\n1 2 3 4 5 6 7 8 9 delimiter // CREATE PROCEDURE my_proc () BEGIN SELECT * FROM my_table; INSERT INTO my_table (col1, col2) VALUES ('value1', 'value2'); END // delimiter ; 在这个例子中，我们使用 delimiter // 命令将定界符改为两个斜线 //。在存储过程中，以分号 ; 结尾的语句不再被解释为语句的结束。而使用 delimiter ; 可以将分号恢复为语句定界符。\n总之，delimiter 命令可以改变 MySQL 数据库系统中 SQL 查询语句的分隔符，从而可使一条 SQL 查询语句包含多个 SQL 语句。这样的话，就方便了我们在一个语句里面加入多个语句，而且不会被错\nMySQL的变量 mysql中的变量包括：系统变量、用户变量、局部变量。\n系统变量 MySQL 系统变量是指在 MySQL 服务器运行时控制其行为的参数。这些变量可以被设置为特定的值来改变服务器的默认设置，以满足不同的需求。\nMySQL 系统变量可以具有全局（global）或会话（session）作用域。\n全局作用域是指对所有连接和所有数据库都适用； 会话作用域是指只对当前连接和当前数据库适用。 查看系统变量\n1 2 3 4 5 show [global|session] variables; show [global|session] variables like ''; select @@[global|session.]系统变量名; 注意：没有指定session或global时，默认是session。\n设置系统变量\n1 2 3 set [global | session] 系统变量名 = 值; set @@[global | session.]系统变量名 = 值; 注意：无论是全局设置还是会话设置，当mysql服务重启之后，之前配置都会失效。可以通过修改MySQL根目录下的my.ini配置文件达到永久修改的效果。（my.ini是MySQL数据库默认的系统级配置文件，默认是不存在的，需要新建，并参考一些资料进行配置。）\nwindows系统是my.ini\nlinux系统是my.cnf\nmy.ini文件通常放在mysql安装的根目录下，如下图：\n这个文件通常是不存在的，可以新建，新建后例如提供以下配置：\n1 2 [mysqld] autocommit=0 这种配置就表示永久性关闭自动提交机制。（不建议这样做。）\n用户变量 用户自定义的变量。只在当前会话有效。所有的用户变量’@‘开始。\n给用户变量赋值\n1 2 3 4 5 set @name = 'jackson'; set @age := 30; set @gender := '男', @addr := '北京大兴区'; select @email := 'jackson@123.com'; select sal into @sal from emp where ename ='SMITH'; 读取用户变量的值\n1 select @name, @age, @gender, @addr, @email, @sal; 注意：mysql中变量不需要声明。直接赋值就行。如果没有声明变量，直接读取该变量，返回null\n局部变量 在存储过程中可以使用局部变量。使用declare声明。在begin和end之间有效。\n变量的声明\n1 declare 变量名 数据类型 [default ...]; 变量的数据类型就是表字段的数据类型，例如：int、bigint、char、varchar、date、time、datetime等。\n注意：declare通常出现在begin end之间的开始部分。\n变量的赋值\n1 2 3 set 变量名 = 值; set 变量名 := 值; select 字段名 into 变量名 from 表名 ...; 例如：以下程序演示局部变量的声明、赋值、读取：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create PROCEDURE p2() begin /*声明变量*/ declare emp_count int default 0; /*声明变量*/ declare sal double(10,2) default 0.0; /*给变量赋值*/ select count(*) into emp_count from emp; /*给变量赋值*/ set sal := 5000.0; /*读取变量的值*/ select emp_count; /*读取变量的值*/ select sal; end; 1 call p2(); if语句 语法格式：\n1 2 3 4 5 6 7 8 9 if 条件 then ...... elseif 条件 then ...... elseif 条件 then ...... else ...... end if; 案例：员工月薪sal，超过10000的属于“高收入”，6000到10000的属于“中收入”，少于6000的属于“低收入”。\n1 2 3 4 5 6 7 8 9 10 11 12 13 create procedure p3( ) begin declare sal int default 5000; declare grade varchar(20); if sal \u003e 10000 then set grade := '高收入'; elseif sal \u003e= 6000 then set grade := '中收入'; else set grade := '低收入'; end if; select grade; end; 1 call p3(); 参数 存储过程的参数包括三种形式：\nin：入参（未指定时，默认是in） out：出参 inout：既是入参，又是出参 案例：员工月薪sal，超过10000的属于“高收入”，6000到10000的属于“中收入”，少于6000的属于“低收入”。\n1 2 3 4 5 6 7 8 9 10 create procedure p4(in sal int, out grade varchar(20)) begin if sal \u003e 10000 then set grade := '高收入'; elseif sal \u003e= 6000 then set grade := '中收入'; else set grade := '低收入'; end if; end; 1 2 call p4(5000, @grade); select @grade; 案例：将传入的工资sal上调10%\n1 2 3 4 create procedure p5(inout sal int) begin set sal := sal * 1.1; end; 1 2 3 set @sal := 10000; call p5(@sal); select @sal; case语句 语法格式：\n1 2 3 4 5 6 7 8 9 10 case 值 when 值1 then ...... when 值2 then ...... when 值3 then ...... else ...... end case; 1 2 3 4 5 6 7 8 9 10 case when 条件1 then ...... when 条件2 then ...... when 条件3 then ...... else ...... end case; 案例：根据不同月份，输出不同的季节。3 4 5月份春季。6 7 8月份夏季。9 10 11月份秋季。12 1 2 冬季。其他非法。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 create procedure mypro(in month int, out result varchar(100)) begin case month when 3 then set result := '春季'; when 4 then set result := '春季'; when 5 then set result := '春季'; when 6 then set result := '夏季'; when 7 then set result := '夏季'; when 8 then set result := '夏季'; when 9 then set result := '秋季'; when 10 then set result := '秋季'; when 11 then set result := '秋季'; when 12 then set result := '冬季'; when 1 then set result := '冬季'; when 2 then set result := '冬季'; else set result := '非法月份'; end case; end; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 create procedure mypro(in month int, out result varchar(100)) begin case when month = 3 or month = 4 or month = 5 then set result := '春季'; when month = 6 or month = 7 or month = 8 then set result := '夏季'; when month = 9 or month = 10 or month = 11 then set result := '秋季'; when month = 12 or month = 1 or month = 2 then set result := '冬季'; else set result := '非法月份'; end case; end; 1 2 call mypro(9, @season); select @season; while循环 语法格式：\n1 2 3 while 条件 do 循环体; end while; 案例：传入一个数字n，计算1~n中所有偶数的和。\n1 2 3 4 5 6 7 8 9 10 11 create procedure mypro(in n int) begin declare sum int default 0; while n \u003e 0 do if n % 2 = 0 then set sum := sum + n; end if; set n := n - 1; end while; select sum; end; 1 call mypro(10); repeat循环 语法格式：\n1 2 3 4 repeat 循环体; until 条件 end repeat; 注意：条件成立时结束循环。\n案例：传入一个数字n，计算1~n中所有偶数的和。\n1 2 3 4 5 6 7 8 9 10 11 create procedure mypro(in n int, out sum int) begin set sum := 0; repeat if n % 2 = 0 then set sum := sum + n; end if; set n := n - 1; until n \u003c= 0 end repeat; end; 1 2 call mypro(10, @sum); select @sum; loop循环 语法格式：\n1 2 3 4 5 6 7 8 9 10 11 create procedure mypro() begin declare i int default 0; mylp:loop set i := i + 1; if i = 5 then leave mylp; end if; select i; end loop; end; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 create procedure mypro() begin declare i int default 0; mylp:loop set i := i + 1; if i = 5 then iterate mylp; end if; if i = 10 then leave mylp; end if; select i; end loop; end; 游标cursor 游标（cursor）可以理解为一个指向结果集中某条记录的指针，允许程序逐一访问结果集中的每条记录，并对其进行逐行操作和处理。\n使用游标时，需要在存储过程或函数中定义一个游标变量，并通过 DECLARE 语句进行声明和初始化。然后，使用 OPEN 语句打开游标，使用 FETCH 语句逐行获取游标指向的记录，并进行处理。最后，使用 CLOSE 语句关闭游标，释放相关资源。游标可以大大地提高数据库查询的灵活性和效率。\n声明游标的语法：\n1 declare 游标名称 cursor for 查询语句; 打开游标的语法：\n1 open 游标名称; 通过游标取数据的语法：\n1 fetch 游标名称 into 变量[,变量,变量......] 关闭游标的语法：\n1 close 游标名称; 案例：从dept表查询部门编号和部门名，创建一张新表dept2，将查询结果插入到新表中。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 drop procedure if exists mypro; create procedure mypro() begin declare no int; declare name varchar(100); declare dept_cursor cursor for select deptno,dname from dept; drop table if exists dept2; create table dept2( no int primary key, name varchar(100) ); open dept_cursor; while true do fetch dept_cursor into no, name; insert into dept2(no,name) values(no,name); end while; close dept_cursor; end; call mypro(); 执行结果：\n出现了异常：异常信息中显示没有数据了。这是因为while true循环导致的。\n不过虽然出现了异常，但是表创建成功了，数据也插入成功了：\n注意：声明局部变量和声明游标有顺序要求，局部变量的声明需要在游标声明之前完成。\n捕捉异常并处理 语法格式：\n1 DECLARE handler_name HANDLER FOR condition_value action_statement handler_name 表示异常处理程序的名称，重要取值包括： CONTINUE：发生异常后，程序不会终止，会正常执行后续的过程。(捕捉) EXIT：发生异常后，终止存储过程的执行。（上抛） condition_value 是指捕获的异常，重要取值包括： SQLSTATE sqlstate_value，例如：SQLSTATE ‘02000’ SQLWARNING，代表所有01开头的SQLSTATE NOT FOUND，代表所有02开头的SQLSTATE SQLEXCEPTION，代表除了01和02开头的所有SQLSTATE action_statement 是指异常发生时执行的语句，例如：CLOSE cursor_name 给之前的游标添加异常处理机制：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 drop procedure if exists mypro; create procedure mypro() begin declare no int; declare name varchar(100); declare dept_cursor cursor for select deptno,dname from dept; declare exit handler for not found close dept_cursor; drop table if exists dept2; create table dept2( no int primary key, name varchar(100) ); open dept_cursor; while true do fetch dept_cursor into no, name; insert into dept2(no,name) values(no,name); end while; close dept_cursor; end; call mypro(); 存储函数 存储函数：带返回值的存储过程。参数只允许是in（但不能写显示的写in）。没有out，也没有inout。\n语法格式：\n1 2 3 4 5 CREATE FUNCTION 存储函数名称(参数列表) RETURNS 数据类型 [特征] BEGIN --函数体 RETURN ...; END; “特征”的可取重要值如下：\ndeterministic：用该特征标记该函数为确定性函数（什么是确定性函数？每次调用函数时传同一个参数的时候，返回值都是固定的）。这是一种优化策略，这种情况下整个函数体的执行就会省略了，直接返回之前缓存的结果，来提高函数的执行效率。 no sql：用该特征标记该函数执行过程中不会查询数据库，如果确实没有查询语句建议使用。告诉 MySQL 优化器不需要考虑使用查询缓存和优化器缓存来优化这个函数，这样就可以避免不必要的查询消耗产生，从而提高性能。 reads sql data：用该特征标记该函数会进行查询操作，告诉 MySQL 优化器这个函数需要查询数据库的数据，可以使用查询缓存来缓存结果，从而提高查询性能；同时 MySQL 还会针对该函数的查询进行优化器缓存处理。 案例：计算1~n的所有偶数之和\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 -- 删除函数 drop function if exists sum_fun; -- 创建函数 create function sum_fun(n int) returns int deterministic begin declare result int default 0; while n \u003e 0 do if n % 2 = 0 then set result := result + n; end if; set n := n - 1; end while; return result; end; -- 调用函数 set @result = sum_fun(100); select @result; 触发器 MySQL 触发器是一种数据库对象，它是与表相关联的特殊程序。它可以在特定的数据操作（例如插入（INSERT）、更新（UPDATE）或删除（DELETE））触发时自动执行。MySQL 触发器使数据库开发人员能够在数据的不同状态之间维护一致性和完整性，并且可以为特定的数据库表自动执行操作。\n触发器的作用主要有以下几个方面：\n强制实施业务规则：触发器可以帮助确保数据表中的业务规则得到强制执行，例如检查插入或更新的数据是否符合某些规则。 数据审计：触发器可以声明在执行数据修改时自动记日志或审计数据变化的操作，使数据对数据库管理员和 SQL 审计人员更易于追踪和审计。 执行特定业务操作：触发器可以自动执行特定的业务操作，例如计算数据行的总数、计算平均值或总和等。 MySQL 触发器分为两种类型: BEFORE 和 AFTER。BEFORE 触发器在执行 INSERT、UPDATE、DELETE 语句之前执行，而 AFTER 触发器在执行 INSERT、UPDATE、DELETE 语句之后执行。\n创建触发器的语法如下：\n1 2 3 4 5 CREATE TRIGGER trigger_name BEFORE/AFTER INSERT/UPDATE/DELETE ON table_name FOR EACH ROW BEGIN -- 触发器执行的 SQL 语句 END; 其中：\ntrigger_name：触发器的名称 BEFORE/AFTER：触发器的类型，可以是 BEFORE 或者 AFTER INSERT/UPDATE/DELETE：触发器所监控的 DML 调用类型 table_name：触发器所绑定的表名 FOR EACH ROW：表示触发器在每行受到 DML 的影响之后都会执行 触发器执行的 SQL 语句：该语句会在触发器被触发时执行 需要注意的是，触发器是一种高级的数据库功能，只有在必要的情况下才应该使用，例如在需要实施强制性业务规则时。过多的触发器和复杂的触发器逻辑可能会影响查询性能和扩展性。\n关于触发器的NEW和OLD关键字：\n在 MySQL 触发器中，NEW 和 OLD 是两个特殊的关键字，用于引用在触发器中受到修改的行的新值和旧值。具体而言：\nNEW：在触发 INSERT 或 UPDATE 操作期间，NEW 用于引用将要插入或更新到表中的新行的值。 OLD：在触发 UPDATE 或 DELETE 操作期间，OLD 用于引用更新或删除之前在表中的旧行的值。 通俗的讲，NEW 是指触发器执行的操作所要插入或更新到当前行中的新数据；而 OLD 则是指当前行在触发器执行前原本的数据。\n在MySQL 触发器中，NEW 和 OLD 使用方法是相似的。在触发器中，可以像引用表的其他列一样引用 NEW 和 OLD。例如，可以使用 OLD.column_name 从旧行中引用列值，也可以使用 NEW.column_name 从新行中引用列值。\n示例：\n假设有一个名为 my_table 的表，其中包含一个名为 quantity 的列。当在该表上执行 UPDATE 操作时，以下触发器会将旧值 OLD.quantity 累加到新值 NEW.quantity 中：\n1 2 3 4 5 6 CREATE TRIGGER my_trigger BEFORE UPDATE ON my_table FOR EACH ROW BEGIN SET NEW.quantity = NEW.quantity + OLD.quantity; END; 在此触发器中，OLD.quantity 引用原始行的 quantity 值（旧值），而 NEW.quantity 引用更新行的 quantity 值（新值）。在触发器执行期间，数据行的 quantity 值将设置为旧值加上新值。\n需要注意的是，在使用 NEW 和 OLD 时，需要根据 DML 操作的类型进行判断，以确定哪个关键字表示新值，哪个关键字则表示旧值。\n案例：当我们对dept表中的数据进行insert delete update的时候，请将这些操作记录到日志表当中，日志表如下：\n1 2 3 4 5 6 7 8 9 10 drop table if exists oper_log; create table oper_log( id bigint primary key auto_increment, table_name varchar(100) not null comment '操作的哪张表', oper_type varchar(100) not null comment '操作类型包括insert delete update', oper_time datetime not null comment '操作时间', oper_id bigint not null comment '操作的那行记录的id', oper_desc text comment '操作描述' ); 触发器1：向dept表中插入数据时，记录日志\n1 2 3 4 5 6 7 create trigger dept_trigger_insert after insert on dept for each row begin insert into oper_log(id,table_name,oper_type,oper_time,oper_id,oper_desc) values (null,'dept','insert',now(),new.deptno,concat('插入数据：deptno=', new.deptno, ',dname=', new.dname,',loc=', new.loc)); end; 查看触发器：\n1 show triggers; 删除触发器：\n1 drop trigger if exists dept_trigger_insert; 向dept表中插入一条记录：\n日志表中多了一条记录：\n触发器2：修改dept表中数据时，记录日志\n1 2 3 4 5 6 7 8 create trigger dept_trigger_update after update on dept for each row begin insert into oper_log(id,table_name,oper_type,oper_time,oper_id,oper_desc) values (null,'dept','update',now(),new.deptno,concat('更新前：deptno=', old.deptno, ',dname=', old.dname,',loc=', old.loc, ',更新后：deptno=', new.deptno, ',dname=', new.dname,',loc=', new.loc)); end; 更新一条记录：\n1 update dept set loc = '北京' where deptno = 60; 日志表中多了一条记录：\n注意：更新一条记录则对应一条日志。如果一次更新3条记录，那么日志表中插入3条记录。\n触发器3：删除dept表中数据时，记录日志\n1 2 3 4 5 6 7 create trigger dept_trigger_delete after delete on dept for each row begin insert into oper_log(id,table_name,oper_type,oper_time,oper_id,oper_desc) values (null,'dept','delete',now(),old.deptno,concat('删除了数据：deptno=', old.deptno, ',dname=', old.dname,',loc=', old.loc)); end; 删除一条记录：\n1 delete from dept where deptno = 60; 日志表中多了一条记录：\n视图 只能将select语句创建为视图。 创建视图 1 create or replace view v_emp as select e.ename,d.dname from emp e join dept d on e.deptno = d.deptno; 视图作用\n4. 如果开发中有一条非常复杂的SQL，而这个SQL在多处使用，会给开发和维护带来成本。使用视图可以降低开发和维护的成本。\n5. 视图可以隐藏表的字段名。 修改视图 1 alter view v_emp as select e.ename,d.dname,d.deptno from emp e join dept d on e.deptno = d.deptno; 删除视图\n6. drop view if exists v_emp; 对视图增删改（DML：insert delete update）可以影响到原表数据。 ",
  "wordCount" : "7452",
  "inLanguage": "en",
  "datePublished": "2025-05-25T18:13:04Z",
  "dateModified": "2025-05-25T18:13:04Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://009965.xyz/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://009965.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      第7章 存储过程
    </h1>
    <div class="post-meta"><span title='2025-05-25 18:13:04 +0000 UTC'>2025-05-25</span>&nbsp;·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b" aria-label="什么是存储过程？">什么是存储过程？</a></li>
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e7%9a%84%e4%bc%98%e7%82%b9%e5%92%8c%e7%bc%ba%e7%82%b9" aria-label="存储过程的优点和缺点？">存储过程的优点和缺点？</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%b8%80%e4%b8%aa%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b" aria-label="第一个存储过程">第一个存储过程</a><ul>
                        
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e7%9a%84%e5%88%9b%e5%bb%ba" aria-label="存储过程的创建">存储过程的创建</a></li>
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e7%9a%84%e8%b0%83%e7%94%a8" aria-label="存储过程的调用">存储过程的调用</a></li>
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e7%9a%84%e6%9f%a5%e7%9c%8b" aria-label="存储过程的查看">存储过程的查看</a></li>
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e7%9a%84%e5%88%a0%e9%99%a4" aria-label="存储过程的删除">存储过程的删除</a></li>
                <li>
                    <a href="#delimiter%e5%91%bd%e4%bb%a4" aria-label="delimiter命令">delimiter命令</a></li></ul>
                </li>
                <li>
                    <a href="#mysql%e7%9a%84%e5%8f%98%e9%87%8f" aria-label="MySQL的变量">MySQL的变量</a><ul>
                        
                <li>
                    <a href="#%e7%b3%bb%e7%bb%9f%e5%8f%98%e9%87%8f" aria-label="系统变量">系统变量</a></li>
                <li>
                    <a href="#%e7%94%a8%e6%88%b7%e5%8f%98%e9%87%8f" aria-label="用户变量">用户变量</a></li>
                <li>
                    <a href="#%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f" aria-label="局部变量">局部变量</a></li></ul>
                </li>
                <li>
                    <a href="#if%e8%af%ad%e5%8f%a5" aria-label="if语句">if语句</a></li>
                <li>
                    <a href="#%e5%8f%82%e6%95%b0" aria-label="参数">参数</a></li>
                <li>
                    <a href="#case%e8%af%ad%e5%8f%a5" aria-label="case语句">case语句</a></li>
                <li>
                    <a href="#while%e5%be%aa%e7%8e%af" aria-label="while循环">while循环</a></li>
                <li>
                    <a href="#repeat%e5%be%aa%e7%8e%af" aria-label="repeat循环">repeat循环</a></li>
                <li>
                    <a href="#loop%e5%be%aa%e7%8e%af" aria-label="loop循环">loop循环</a></li>
                <li>
                    <a href="#%e6%b8%b8%e6%a0%87cursor" aria-label="游标cursor">游标cursor</a></li>
                <li>
                    <a href="#%e6%8d%95%e6%8d%89%e5%bc%82%e5%b8%b8%e5%b9%b6%e5%a4%84%e7%90%86" aria-label="捕捉异常并处理">捕捉异常并处理</a></li>
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e5%87%bd%e6%95%b0" aria-label="存储函数">存储函数</a></li>
                <li>
                    <a href="#%e8%a7%a6%e5%8f%91%e5%99%a8" aria-label="触发器">触发器</a></li>
                <li>
                    <a href="#%e8%a7%86%e5%9b%be" aria-label="视图">视图</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="什么是存储过程">什么是存储过程？<a hidden class="anchor" aria-hidden="true" href="#什么是存储过程">#</a></h1>
<p>存储过程可称为过程化SQL语言，是在普通SQL语句的基础上增加了编程语言的特点，把数据操作语句(DML)和查询语句(DQL)组织在过程化代码中，通过逻辑判断、循环等操作实现复杂计算的程序语言。<br>
换句话说，存储过程其实就是数据库内置的一种编程语言，这种编程语言也有自己的变量、if语句、循环语句等。在一个存储过程中可以将多条SQL语句以逻辑代码的方式将其串联起来，执行这个存储过程就是将这些SQL语句按照一定的逻辑去执行，所以一个存储过程也可以看做是一组为了完成特定功能的SQL 语句集。<br>
每一个存储过程都是一个数据库对象，就像table和view一样，存储在数据库当中，一次编译永久有效。并且每一个存储过程都有自己的名字。客户端程序通过存储过程的名字来调用存储过程。<br>
在数据量特别庞大的情况下利用存储过程能达到倍速的效率提升。</p>
<h1 id="存储过程的优点和缺点">存储过程的优点和缺点？<a hidden class="anchor" aria-hidden="true" href="#存储过程的优点和缺点">#</a></h1>
<p>优点：速度快。</p>
<pre><code>  - 降低了**应用服务器**和**数据库服务器**之间网络通讯的开销。尤其在数据量庞大的情况下效果显著。
</code></pre>
<p>缺点：移植性差。编写难度大。维护性差。</p>
<pre><code>  - 每一个数据库都有自己的存储过程的语法规则，这种语法规则不是通用的。一旦使用了存储过程，则数据库产品很难更换，例如：编写了mysql的存储过程，这段代码只能在mysql中运行，无法在oracle数据库中运行。
  - 对于数据库存储过程这种语法来说，没有专业的IDE工具（集成开发环境），所以编码速度较低。自然维护的成本也会较高。
</code></pre>
<p>在实际开发中，存储过程还是很少使用的。只有在系统遇到了性能瓶颈，在进行优化的时候，对于大数量的应用来说，可以考虑使用一些。</p>
<h1 id="第一个存储过程">第一个存储过程<a hidden class="anchor" aria-hidden="true" href="#第一个存储过程">#</a></h1>
<h2 id="存储过程的创建">存储过程的创建<a hidden class="anchor" aria-hidden="true" href="#存储过程的创建">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>create procedure p1()
</span></span><span style="display:flex;"><span>begin
</span></span><span style="display:flex;"><span>	select empno,ename from emp;
</span></span><span style="display:flex;"><span>end;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="存储过程的调用">存储过程的调用<a hidden class="anchor" aria-hidden="true" href="#存储过程的调用">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>call p1();
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="存储过程的查看">存储过程的查看<a hidden class="anchor" aria-hidden="true" href="#存储过程的查看">#</a></h2>
<p>查看创建存储过程的语句：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>show create procedure p1;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/0547218b0768b72caae4c6f6081a98cd_MD5.png"></p>
<p>通过系统表information_schema.ROUTINES查看存储过程的详细信息：<br>
information_schema.ROUTINES 是 MySQL 数据库中一个系统表，存储了所有存储过程、函数、触发器的详细信息，包括名称、返回值类型、参数、创建时间、修改时间等。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> information_schema.routines <span style="color:#fff;font-weight:bold">where</span> <span style="color:#fff;font-weight:bold">routine_name</span> = <span style="color:#0ff;font-weight:bold">&#39;p1&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/d73638dcd281c7accfe90f39a3806ceb_MD5.png"></p>
<p>information_schema.ROUTINES 表中的一些重要的列包括：</p>
<ul>
<li>SPECIFIC_NAME：存储过程的具体名称，包括该存储过程的名字，参数列表。</li>
<li>ROUTINE_SCHEMA：存储过程所在的数据库名称。</li>
<li>ROUTINE_NAME：存储过程的名称。</li>
<li>ROUTINE_TYPE：PROCEDURE表示是一个存储过程，FUNCTION表示是一个函数。</li>
<li>ROUTINE_DEFINITION：存储过程的定义语句。</li>
<li>CREATED：存储过程的创建时间。</li>
<li>LAST_ALTERED：存储过程的最后修改时间。</li>
<li>DATA_TYPE：存储过程的返回值类型、参数类型等。</li>
</ul>
<h2 id="存储过程的删除">存储过程的删除<a hidden class="anchor" aria-hidden="true" href="#存储过程的删除">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>drop procedure if exists p1;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="delimiter命令">delimiter命令<a hidden class="anchor" aria-hidden="true" href="#delimiter命令">#</a></h2>
<p>在 MySQL 中，<code>delimiter</code> 命令用于改变 MySQL 解释语句的定界符。MySQL 默认使用分号 <code>;</code> 作为语句的定界符。而使用 <code>delimiter</code> 命令可以将分号 <code>;</code> 更改为其他字符，从而可以在 SQL 语句中使用分号 <code>;</code>。</p>
<p>例如，假设需要创建一个存储过程。在存储过程中通常会包括多条 SQL 语句，而这些语句都需要以分号 <code>;</code> 结尾。但默认情况下，执行到第一条语句的分号 <code>;</code> 后，MySQL 就会停止解释，导致后续的语句无法执行。解决方式就是使用 <code>delimiter</code> 命令将分号改为其他字符，使分号 <code>;</code> 不再是语句定界符。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">delimiter</span> //
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">PROCEDURE</span> my_proc ()
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">BEGIN</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> my_table;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> my_table (col1, col2) <span style="color:#fff;font-weight:bold">VALUES</span> (<span style="color:#0ff;font-weight:bold">&#39;value1&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;value2&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">END</span> //
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">delimiter</span> ;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这个例子中，我们使用 <code>delimiter //</code> 命令将定界符改为两个斜线 <code>//</code>。在存储过程中，以分号 <code>;</code> 结尾的语句不再被解释为语句的结束。而使用 <code>delimiter ;</code> 可以将分号恢复为语句定界符。</p>
<p>总之，<code>delimiter</code> 命令可以改变 MySQL 数据库系统中 SQL 查询语句的分隔符，从而可使一条 SQL 查询语句包含多个 SQL 语句。这样的话，就方便了我们在一个语句里面加入多个语句，而且不会被错</p>
<h1 id="mysql的变量">MySQL的变量<a hidden class="anchor" aria-hidden="true" href="#mysql的变量">#</a></h1>
<p>mysql中的变量包括：系统变量、用户变量、局部变量。</p>
<h2 id="系统变量">系统变量<a hidden class="anchor" aria-hidden="true" href="#系统变量">#</a></h2>
<p>MySQL 系统变量是指在 MySQL 服务器运行时控制其行为的参数。这些变量可以被设置为特定的值来改变服务器的默认设置，以满足不同的需求。<br>
MySQL 系统变量可以具有全局（global）或会话（session）作用域。</p>
<ul>
<li>全局作用域是指对所有连接和所有数据库都适用；</li>
<li>会话作用域是指只对当前连接和当前数据库适用。</li>
</ul>
<p>查看系统变量</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">show</span> [<span style="color:#fff;font-weight:bold">global</span>|<span style="color:#fff;font-weight:bold">session</span>] variables;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">show</span> [<span style="color:#fff;font-weight:bold">global</span>|<span style="color:#fff;font-weight:bold">session</span>] variables <span style="color:#fff;font-weight:bold">like</span> <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> @@[<span style="color:#fff;font-weight:bold">global</span>|<span style="color:#fff;font-weight:bold">session</span>.]<span style="color:#f00">系统变量名</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：没有指定session或global时，默认是session。</p>
<p>设置系统变量</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> [<span style="color:#fff;font-weight:bold">global</span> | <span style="color:#fff;font-weight:bold">session</span>] <span style="color:#f00">系统变量名</span> = <span style="color:#f00">值</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> @@[<span style="color:#fff;font-weight:bold">global</span> | <span style="color:#fff;font-weight:bold">session</span>.]<span style="color:#f00">系统变量名</span> = <span style="color:#f00">值</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：无论是全局设置还是会话设置，当mysql服务重启之后，之前配置都会失效。可以通过修改MySQL根目录下的my.ini配置文件达到永久修改的效果。（my.ini是MySQL数据库默认的系统级配置文件，默认是不存在的，需要新建，并参考一些资料进行配置。）<br>
windows系统是my.ini<br>
linux系统是my.cnf<br>
my.ini文件通常放在mysql安装的根目录下，如下图：<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/4920ab8de5aeffe6607a99dc0e03aad1_MD5.png"><br>
这个文件通常是不存在的，可以新建，新建后例如提供以下配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>[mysqld]
</span></span><span style="display:flex;"><span>autocommit=0
</span></span></code></pre></td></tr></table>
</div>
</div><p>这种配置就表示永久性关闭自动提交机制。（不建议这样做。）</p>
<h2 id="用户变量">用户变量<a hidden class="anchor" aria-hidden="true" href="#用户变量">#</a></h2>
<p>用户自定义的变量。只在当前会话有效。所有的用户变量&rsquo;@&lsquo;开始。</p>
<p>给用户变量赋值</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> @name = <span style="color:#0ff;font-weight:bold">&#39;jackson&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> @age := <span style="color:#ff0;font-weight:bold">30</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> @gender := <span style="color:#0ff;font-weight:bold">&#39;男&#39;</span>, @addr := <span style="color:#0ff;font-weight:bold">&#39;北京大兴区&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> @email := <span style="color:#0ff;font-weight:bold">&#39;jackson@123.com&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> sal <span style="color:#fff;font-weight:bold">into</span> @sal <span style="color:#fff;font-weight:bold">from</span> emp <span style="color:#fff;font-weight:bold">where</span> ename =<span style="color:#0ff;font-weight:bold">&#39;SMITH&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>读取用户变量的值</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> @name, @age, @gender, @addr, @email, @sal;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：mysql中变量不需要声明。直接赋值就行。如果没有声明变量，直接读取该变量，返回null</p>
<h2 id="局部变量">局部变量<a hidden class="anchor" aria-hidden="true" href="#局部变量">#</a></h2>
<p>在存储过程中可以使用局部变量。使用declare声明。在begin和end之间有效。</p>
<p>变量的声明</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">declare</span> <span style="color:#f00">变量名</span> <span style="color:#f00">数据类型</span> [<span style="color:#fff;font-weight:bold">default</span> ...];
</span></span></code></pre></td></tr></table>
</div>
</div><p>变量的数据类型就是表字段的数据类型，例如：int、bigint、char、varchar、date、time、datetime等。<br>
<strong>注意：declare通常出现在begin end之间的开始部分。</strong></p>
<p>变量的赋值</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> <span style="color:#f00">变量名</span> = <span style="color:#f00">值</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> <span style="color:#f00">变量名</span> := <span style="color:#f00">值</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> <span style="color:#f00">字段名</span> <span style="color:#fff;font-weight:bold">into</span> <span style="color:#f00">变量名</span> <span style="color:#fff;font-weight:bold">from</span> <span style="color:#f00">表名</span> ...;
</span></span></code></pre></td></tr></table>
</div>
</div><p>例如：以下程序演示局部变量的声明、赋值、读取：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">PROCEDURE</span> p2()
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">begin</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/*声明变量*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">declare</span> emp_count <span style="color:#fff;font-weight:bold">int</span> <span style="color:#fff;font-weight:bold">default</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/*声明变量*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">declare</span> sal double(<span style="color:#ff0;font-weight:bold">10</span>,<span style="color:#ff0;font-weight:bold">2</span>) <span style="color:#fff;font-weight:bold">default</span> <span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/*给变量赋值*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">count</span>(*) <span style="color:#fff;font-weight:bold">into</span> emp_count <span style="color:#fff;font-weight:bold">from</span> emp;
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/*给变量赋值*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">set</span> sal := <span style="color:#ff0;font-weight:bold">5000</span>.<span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/*读取变量的值*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">select</span> emp_count;
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/*读取变量的值*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">select</span> sal;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">call</span> p2();
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="if语句">if语句<a hidden class="anchor" aria-hidden="true" href="#if语句">#</a></h1>
<p>语法格式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> <span style="color:#f00">条件</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>elseif <span style="color:#f00">条件</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>elseif <span style="color:#f00">条件</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">if</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>案例：员工月薪sal，超过10000的属于“高收入”，6000到10000的属于“中收入”，少于6000的属于“低收入”。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">procedure</span> p3(               )
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">declare</span> sal <span style="color:#fff;font-weight:bold">int</span> <span style="color:#fff;font-weight:bold">default</span> <span style="color:#ff0;font-weight:bold">5000</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">declare</span> grade <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">20</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">if</span> sal &gt; <span style="color:#ff0;font-weight:bold">10000</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">set</span> grade := <span style="color:#0ff;font-weight:bold">&#39;高收入&#39;</span>;
</span></span><span style="display:flex;"><span>	elseif sal &gt;= <span style="color:#ff0;font-weight:bold">6000</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">set</span> grade := <span style="color:#0ff;font-weight:bold">&#39;中收入&#39;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">set</span> grade := <span style="color:#0ff;font-weight:bold">&#39;低收入&#39;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">if</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">select</span> grade;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">call</span> p3();
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="参数">参数<a hidden class="anchor" aria-hidden="true" href="#参数">#</a></h1>
<p>存储过程的参数包括三种形式：</p>
<ul>
<li>in：入参（未指定时，默认是in）</li>
<li>out：出参</li>
<li>inout：既是入参，又是出参</li>
</ul>
<p>案例：员工月薪sal，超过10000的属于“高收入”，6000到10000的属于“中收入”，少于6000的属于“低收入”。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">procedure</span> p4(<span style="color:#fff;font-weight:bold">in</span> sal <span style="color:#fff;font-weight:bold">int</span>, <span style="color:#fff;font-weight:bold">out</span> grade <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">20</span>))
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">if</span> sal &gt; <span style="color:#ff0;font-weight:bold">10000</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">set</span> grade := <span style="color:#0ff;font-weight:bold">&#39;高收入&#39;</span>;
</span></span><span style="display:flex;"><span>	elseif sal &gt;= <span style="color:#ff0;font-weight:bold">6000</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">set</span> grade := <span style="color:#0ff;font-weight:bold">&#39;中收入&#39;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#fff;font-weight:bold">set</span> grade := <span style="color:#0ff;font-weight:bold">&#39;低收入&#39;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">if</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">call</span> p4(<span style="color:#ff0;font-weight:bold">5000</span>, @grade);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> @grade;
</span></span></code></pre></td></tr></table>
</div>
</div><p>案例：将传入的工资sal上调10%</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">procedure</span> p5(<span style="color:#fff;font-weight:bold">inout</span> sal <span style="color:#fff;font-weight:bold">int</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">set</span> sal := sal * <span style="color:#ff0;font-weight:bold">1</span>.<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> @sal := <span style="color:#ff0;font-weight:bold">10000</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">call</span> p5(@sal);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> @sal;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="case语句">case语句<a hidden class="anchor" aria-hidden="true" href="#case语句">#</a></h1>
<p>语法格式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">case</span> <span style="color:#f00">值</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">when</span> <span style="color:#f00">值</span><span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>	......
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">when</span> <span style="color:#f00">值</span><span style="color:#ff0;font-weight:bold">2</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>	......
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">when</span> <span style="color:#f00">值</span><span style="color:#ff0;font-weight:bold">3</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>	......
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>	......
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">case</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">case</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">when</span> <span style="color:#f00">条件</span><span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>	......
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">when</span> <span style="color:#f00">条件</span><span style="color:#ff0;font-weight:bold">2</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>	......
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">when</span> <span style="color:#f00">条件</span><span style="color:#ff0;font-weight:bold">3</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>	......
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>	......
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">case</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>案例：根据不同月份，输出不同的季节。3 4 5月份春季。6 7 8月份夏季。9 10 11月份秋季。12 1 2 冬季。其他非法。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">procedure</span> mypro(<span style="color:#fff;font-weight:bold">in</span> <span style="color:#fff;font-weight:bold">month</span> <span style="color:#fff;font-weight:bold">int</span>, <span style="color:#fff;font-weight:bold">out</span> <span style="color:#fff;font-weight:bold">result</span> <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">100</span>))
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">begin</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">case</span> <span style="color:#fff;font-weight:bold">month</span>
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;春季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">4</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;春季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">5</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;春季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">6</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;夏季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">7</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;夏季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">8</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;夏季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">9</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;秋季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">10</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;秋季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">11</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;秋季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">12</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;冬季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;冬季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#ff0;font-weight:bold">2</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;冬季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;非法月份&#39;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">case</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">procedure</span> mypro(<span style="color:#fff;font-weight:bold">in</span> <span style="color:#fff;font-weight:bold">month</span> <span style="color:#fff;font-weight:bold">int</span>, <span style="color:#fff;font-weight:bold">out</span> <span style="color:#fff;font-weight:bold">result</span> <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">100</span>))
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">begin</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">case</span> 
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span> <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#fff;font-weight:bold">or</span> <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">4</span> <span style="color:#fff;font-weight:bold">or</span> <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">5</span> <span style="color:#fff;font-weight:bold">then</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;春季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span>  <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">6</span> <span style="color:#fff;font-weight:bold">or</span> <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">7</span> <span style="color:#fff;font-weight:bold">or</span> <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">8</span>  <span style="color:#fff;font-weight:bold">then</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;夏季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span>  <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">9</span> <span style="color:#fff;font-weight:bold">or</span> <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">10</span> <span style="color:#fff;font-weight:bold">or</span> <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">11</span>  <span style="color:#fff;font-weight:bold">then</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;秋季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">when</span>  <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">12</span> <span style="color:#fff;font-weight:bold">or</span> <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">or</span> <span style="color:#fff;font-weight:bold">month</span> = <span style="color:#ff0;font-weight:bold">2</span>  <span style="color:#fff;font-weight:bold">then</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;冬季&#39;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">else</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">result</span> := <span style="color:#0ff;font-weight:bold">&#39;非法月份&#39;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">case</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">call</span> mypro(<span style="color:#ff0;font-weight:bold">9</span>, @season);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> @season;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="while循环">while循环<a hidden class="anchor" aria-hidden="true" href="#while循环">#</a></h1>
<p>语法格式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>while <span style="color:#f00">条件</span> <span style="color:#fff;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f00">循环体</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span> while;
</span></span></code></pre></td></tr></table>
</div>
</div><p>案例：传入一个数字n，计算1~n中所有偶数的和。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">procedure</span> mypro(<span style="color:#fff;font-weight:bold">in</span> n <span style="color:#fff;font-weight:bold">int</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">begin</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">declare</span> <span style="color:#fff;font-weight:bold">sum</span> <span style="color:#fff;font-weight:bold">int</span> <span style="color:#fff;font-weight:bold">default</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>	while n &gt; <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>  		<span style="color:#fff;font-weight:bold">if</span> n % <span style="color:#ff0;font-weight:bold">2</span> = <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    		<span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">sum</span> := <span style="color:#fff;font-weight:bold">sum</span> + n;
</span></span><span style="display:flex;"><span>  		<span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">if</span>;
</span></span><span style="display:flex;"><span>  		<span style="color:#fff;font-weight:bold">set</span> n := n - <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">end</span> while;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">sum</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">call</span> mypro(<span style="color:#ff0;font-weight:bold">10</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="repeat循环">repeat循环<a hidden class="anchor" aria-hidden="true" href="#repeat循环">#</a></h1>
<p>语法格式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>repeat
</span></span><span style="display:flex;"><span>	<span style="color:#f00">循环体</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">until</span> <span style="color:#f00">条件</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span> repeat;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：条件成立时结束循环。</p>
<p>案例：传入一个数字n，计算1~n中所有偶数的和。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">procedure</span> mypro(<span style="color:#fff;font-weight:bold">in</span> n <span style="color:#fff;font-weight:bold">int</span>, <span style="color:#fff;font-weight:bold">out</span> <span style="color:#fff;font-weight:bold">sum</span> <span style="color:#fff;font-weight:bold">int</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">begin</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">sum</span> := <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>	repeat 
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">if</span> n % <span style="color:#ff0;font-weight:bold">2</span> = <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">then</span> 
</span></span><span style="display:flex;"><span>		  <span style="color:#fff;font-weight:bold">set</span> <span style="color:#fff;font-weight:bold">sum</span> := <span style="color:#fff;font-weight:bold">sum</span> + n;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">if</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">set</span> n := n - <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">until</span> n &lt;= <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">end</span> repeat;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">call</span> mypro(<span style="color:#ff0;font-weight:bold">10</span>, @<span style="color:#fff;font-weight:bold">sum</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> @<span style="color:#fff;font-weight:bold">sum</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="loop循环">loop循环<a hidden class="anchor" aria-hidden="true" href="#loop循环">#</a></h1>
<p>语法格式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">procedure</span> mypro()
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">begin</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">declare</span> i <span style="color:#fff;font-weight:bold">int</span> <span style="color:#fff;font-weight:bold">default</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>  mylp:loop 
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">set</span> i := i + <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">if</span> i = <span style="color:#ff0;font-weight:bold">5</span> <span style="color:#fff;font-weight:bold">then</span> 
</span></span><span style="display:flex;"><span>			leave mylp;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">if</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">select</span> i;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">end</span> loop;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">procedure</span> mypro()
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">begin</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">declare</span> i <span style="color:#fff;font-weight:bold">int</span> <span style="color:#fff;font-weight:bold">default</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>  mylp:loop 
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">set</span> i := i + <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">if</span> i = <span style="color:#ff0;font-weight:bold">5</span> <span style="color:#fff;font-weight:bold">then</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">iterate</span> mylp;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">if</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">if</span> i = <span style="color:#ff0;font-weight:bold">10</span> <span style="color:#fff;font-weight:bold">then</span> 
</span></span><span style="display:flex;"><span>		  leave mylp;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">end</span> <span style="color:#fff;font-weight:bold">if</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">select</span> i;
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">end</span> loop;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">end</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="游标cursor">游标cursor<a hidden class="anchor" aria-hidden="true" href="#游标cursor">#</a></h1>
<p>游标（cursor）可以理解为一个指向结果集中某条记录的指针，允许程序逐一访问结果集中的每条记录，并对其进行逐行操作和处理。</p>
<p>使用游标时，需要在存储过程或函数中定义一个游标变量，并通过 <code>DECLARE</code> 语句进行声明和初始化。然后，使用 <code>OPEN</code> 语句打开游标，使用 <code>FETCH</code> 语句逐行获取游标指向的记录，并进行处理。最后，使用 <code>CLOSE</code> 语句关闭游标，释放相关资源。游标可以大大地提高数据库查询的灵活性和效率。</p>
<p>声明游标的语法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">declare</span> <span style="color:#f00">游标名称</span> <span style="color:#fff;font-weight:bold">cursor</span> <span style="color:#fff;font-weight:bold">for</span> <span style="color:#f00">查询语句</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>打开游标的语法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">open</span> <span style="color:#f00">游标名称</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过游标取数据的语法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">fetch</span> <span style="color:#f00">游标名称</span> <span style="color:#fff;font-weight:bold">into</span> <span style="color:#f00">变量</span>[,<span style="color:#f00">变量</span>,<span style="color:#f00">变量</span>......]
</span></span></code></pre></td></tr></table>
</div>
</div><p>关闭游标的语法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">close</span> <span style="color:#f00">游标名称</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>案例：从dept表查询部门编号和部门名，创建一张新表dept2，将查询结果插入到新表中。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>drop procedure <span style="color:#fff;font-weight:bold">if</span> exists mypro;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>create procedure mypro()
</span></span><span style="display:flex;"><span>begin 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	declare no int;
</span></span><span style="display:flex;"><span>	declare name varchar(<span style="color:#ff0;font-weight:bold">100</span>);
</span></span><span style="display:flex;"><span>	declare dept_cursor cursor <span style="color:#fff;font-weight:bold">for</span> select deptno,dname from dept;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	drop table <span style="color:#fff;font-weight:bold">if</span> exists dept2;
</span></span><span style="display:flex;"><span>	create table dept2(
</span></span><span style="display:flex;"><span>		no int primary key,
</span></span><span style="display:flex;"><span>		name varchar(<span style="color:#ff0;font-weight:bold">100</span>)
</span></span><span style="display:flex;"><span>	);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	open dept_cursor;
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">while</span> true <span style="color:#fff;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>		fetch dept_cursor into no, name;
</span></span><span style="display:flex;"><span>		insert into dept2(no,name) values(no,name);
</span></span><span style="display:flex;"><span>	end <span style="color:#fff;font-weight:bold">while</span>;
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	close dept_cursor;
</span></span><span style="display:flex;"><span>end;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>call mypro();
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果：<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/fe50b83a171fc7d87f98d2fb5cb9ee7c_MD5.png"><br>
出现了异常：异常信息中显示没有数据了。这是因为while true循环导致的。</p>
<p>不过虽然出现了异常，但是表创建成功了，数据也插入成功了：<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/242a6bed9c9bf590d8ea5a92572630d7_MD5.png"><br>
<strong>注意：声明局部变量和声明游标有顺序要求，局部变量的声明需要在游标声明之前完成。</strong></p>
<h1 id="捕捉异常并处理">捕捉异常并处理<a hidden class="anchor" aria-hidden="true" href="#捕捉异常并处理">#</a></h1>
<p>语法格式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DECLARE handler_name HANDLER FOR condition_value action_statement
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>handler_name 表示异常处理程序的名称，重要取值包括：
<ol>
<li>CONTINUE：发生异常后，程序不会终止，会正常执行后续的过程。(捕捉)</li>
<li>EXIT：发生异常后，终止存储过程的执行。（上抛）</li>
</ol>
</li>
<li>condition_value 是指捕获的异常，重要取值包括：
<ol>
<li>SQLSTATE sqlstate_value，例如：SQLSTATE &lsquo;02000&rsquo;</li>
<li>SQLWARNING，代表所有01开头的SQLSTATE</li>
<li>NOT FOUND，代表所有02开头的SQLSTATE</li>
<li>SQLEXCEPTION，代表除了01和02开头的所有SQLSTATE</li>
</ol>
</li>
<li>action_statement 是指异常发生时执行的语句，例如：CLOSE cursor_name</li>
</ol>
<p>给之前的游标添加异常处理机制：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>drop procedure <span style="color:#fff;font-weight:bold">if</span> exists mypro;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>create procedure mypro()
</span></span><span style="display:flex;"><span>begin 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	declare no int;
</span></span><span style="display:flex;"><span>	declare name varchar(<span style="color:#ff0;font-weight:bold">100</span>);
</span></span><span style="display:flex;"><span>	declare dept_cursor cursor <span style="color:#fff;font-weight:bold">for</span> select deptno,dname from dept;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	declare exit handler <span style="color:#fff;font-weight:bold">for</span> not found close dept_cursor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	drop table <span style="color:#fff;font-weight:bold">if</span> exists dept2;
</span></span><span style="display:flex;"><span>	create table dept2(
</span></span><span style="display:flex;"><span>		no int primary key,
</span></span><span style="display:flex;"><span>		name varchar(<span style="color:#ff0;font-weight:bold">100</span>)
</span></span><span style="display:flex;"><span>	);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	open dept_cursor;
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">while</span> true <span style="color:#fff;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>		fetch dept_cursor into no, name;
</span></span><span style="display:flex;"><span>		insert into dept2(no,name) values(no,name);
</span></span><span style="display:flex;"><span>	end <span style="color:#fff;font-weight:bold">while</span>;
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	close dept_cursor;
</span></span><span style="display:flex;"><span>end;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>call mypro();
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="存储函数">存储函数<a hidden class="anchor" aria-hidden="true" href="#存储函数">#</a></h1>
<p>存储函数：带返回值的存储过程。参数只允许是in（但不能写显示的写in）。没有out，也没有inout。<br>
语法格式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE FUNCTION 存储函数名称(参数列表) RETURNS 数据类型 [特征]
</span></span><span style="display:flex;"><span>BEGIN
</span></span><span style="display:flex;"><span>	--函数体
</span></span><span style="display:flex;"><span>	RETURN ...;
</span></span><span style="display:flex;"><span>END;
</span></span></code></pre></td></tr></table>
</div>
</div><p>“特征”的可取重要值如下：</p>
<ul>
<li>deterministic：用该特征标记该函数为确定性函数（什么是确定性函数？每次调用函数时传同一个参数的时候，返回值都是固定的）。这是一种优化策略，这种情况下整个函数体的执行就会省略了，直接返回之前缓存的结果，来提高函数的执行效率。</li>
<li>no sql：用该特征标记该函数执行过程中不会查询数据库，如果确实没有查询语句建议使用。告诉 MySQL 优化器不需要考虑使用查询缓存和优化器缓存来优化这个函数，这样就可以避免不必要的查询消耗产生，从而提高性能。</li>
<li>reads sql data：用该特征标记该函数会进行查询操作，告诉 MySQL 优化器这个函数需要查询数据库的数据，可以使用查询缓存来缓存结果，从而提高查询性能；同时 MySQL 还会针对该函数的查询进行优化器缓存处理。</li>
</ul>
<p>案例：计算1~n的所有偶数之和</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>-- 删除函数
</span></span><span style="display:flex;"><span>drop function if exists sum_fun;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-- 创建函数
</span></span><span style="display:flex;"><span>create function sum_fun(n int)
</span></span><span style="display:flex;"><span>returns int deterministic 
</span></span><span style="display:flex;"><span>begin 
</span></span><span style="display:flex;"><span>	declare result int default 0;
</span></span><span style="display:flex;"><span>	while n &gt; 0 do 
</span></span><span style="display:flex;"><span>		if n % 2 = 0 then 
</span></span><span style="display:flex;"><span>			set result := result + n;
</span></span><span style="display:flex;"><span>		end if;
</span></span><span style="display:flex;"><span>		set n := n - 1;
</span></span><span style="display:flex;"><span>	end while;
</span></span><span style="display:flex;"><span>	return result;
</span></span><span style="display:flex;"><span>end;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-- 调用函数
</span></span><span style="display:flex;"><span>set @result = sum_fun(100);
</span></span><span style="display:flex;"><span>select @result;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="触发器">触发器<a hidden class="anchor" aria-hidden="true" href="#触发器">#</a></h1>
<p>MySQL 触发器是一种数据库对象，它是与表相关联的特殊程序。它可以在特定的数据操作（例如插入（INSERT）、更新（UPDATE）或删除（DELETE））触发时自动执行。MySQL 触发器使数据库开发人员能够在数据的不同状态之间维护一致性和完整性，并且可以为特定的数据库表自动执行操作。</p>
<p>触发器的作用主要有以下几个方面：</p>
<ol>
<li>强制实施业务规则：触发器可以帮助确保数据表中的业务规则得到强制执行，例如检查插入或更新的数据是否符合某些规则。</li>
<li>数据审计：触发器可以声明在执行数据修改时自动记日志或审计数据变化的操作，使数据对数据库管理员和 SQL 审计人员更易于追踪和审计。</li>
<li>执行特定业务操作：触发器可以自动执行特定的业务操作，例如计算数据行的总数、计算平均值或总和等。</li>
</ol>
<p>MySQL 触发器分为两种类型: BEFORE 和 AFTER。BEFORE 触发器在执行 INSERT、UPDATE、DELETE 语句之前执行，而 AFTER 触发器在执行 INSERT、UPDATE、DELETE 语句之后执行。</p>
<p>创建触发器的语法如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE TRIGGER trigger_name
</span></span><span style="display:flex;"><span>BEFORE/AFTER INSERT/UPDATE/DELETE ON table_name FOR EACH ROW
</span></span><span style="display:flex;"><span>BEGIN
</span></span><span style="display:flex;"><span>-- 触发器执行的 SQL 语句
</span></span><span style="display:flex;"><span>END;
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中：</p>
<ul>
<li>trigger_name：触发器的名称</li>
<li>BEFORE/AFTER：触发器的类型，可以是 BEFORE 或者 AFTER</li>
<li>INSERT/UPDATE/DELETE：触发器所监控的 DML 调用类型</li>
<li>table_name：触发器所绑定的表名</li>
<li>FOR EACH ROW：表示触发器在每行受到 DML 的影响之后都会执行</li>
<li>触发器执行的 SQL 语句：该语句会在触发器被触发时执行</li>
</ul>
<p>需要注意的是，触发器是一种高级的数据库功能，只有在必要的情况下才应该使用，例如在需要实施强制性业务规则时。过多的触发器和复杂的触发器逻辑可能会影响查询性能和扩展性。</p>
<p><strong>关于触发器的NEW和OLD关键字：</strong><br>
在 MySQL 触发器中，NEW 和 OLD 是两个特殊的关键字，用于引用在触发器中受到修改的行的新值和旧值。具体而言：</p>
<ul>
<li>NEW：在触发 INSERT 或 UPDATE 操作期间，NEW 用于引用将要插入或更新到表中的新行的值。</li>
<li>OLD：在触发 UPDATE 或 DELETE 操作期间，OLD 用于引用更新或删除之前在表中的旧行的值。</li>
</ul>
<p>通俗的讲，NEW 是指触发器执行的操作所要插入或更新到当前行中的新数据；而 OLD 则是指当前行在触发器执行前原本的数据。</p>
<p>在MySQL 触发器中，NEW 和 OLD 使用方法是相似的。在触发器中，可以像引用表的其他列一样引用 NEW 和 OLD。例如，可以使用 OLD.column_name 从旧行中引用列值，也可以使用 NEW.column_name 从新行中引用列值。</p>
<p>示例：</p>
<p>假设有一个名为 my_table 的表，其中包含一个名为 quantity 的列。当在该表上执行 UPDATE 操作时，以下触发器会将旧值 OLD.quantity 累加到新值 NEW.quantity 中：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE TRIGGER my_trigger
</span></span><span style="display:flex;"><span>BEFORE UPDATE ON my_table
</span></span><span style="display:flex;"><span>FOR EACH ROW
</span></span><span style="display:flex;"><span>BEGIN
</span></span><span style="display:flex;"><span>SET NEW.quantity = NEW.quantity + OLD.quantity;
</span></span><span style="display:flex;"><span>END;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在此触发器中，OLD.quantity 引用原始行的 quantity 值（旧值），而 NEW.quantity 引用更新行的 quantity 值（新值）。在触发器执行期间，数据行的 quantity 值将设置为旧值加上新值。</p>
<p>需要注意的是，在使用 NEW 和 OLD 时，需要根据 DML 操作的类型进行判断，以确定哪个关键字表示新值，哪个关键字则表示旧值。</p>
<p>案例：当我们对dept表中的数据进行insert delete update的时候，请将这些操作记录到日志表当中，日志表如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">drop</span> <span style="color:#fff;font-weight:bold">table</span> <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">exists</span> oper_log;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">table</span> oper_log(
</span></span><span style="display:flex;"><span>  id <span style="color:#fff;font-weight:bold">bigint</span> <span style="color:#fff;font-weight:bold">primary</span> <span style="color:#fff;font-weight:bold">key</span> auto_increment,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">table_name</span> <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">not</span> <span style="color:#fff;font-weight:bold">null</span> <span style="color:#fff;font-weight:bold">comment</span> <span style="color:#0ff;font-weight:bold">&#39;操作的哪张表&#39;</span>,
</span></span><span style="display:flex;"><span>  oper_type <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">not</span> <span style="color:#fff;font-weight:bold">null</span> <span style="color:#fff;font-weight:bold">comment</span> <span style="color:#0ff;font-weight:bold">&#39;操作类型包括insert delete update&#39;</span>,
</span></span><span style="display:flex;"><span>  oper_time datetime <span style="color:#fff;font-weight:bold">not</span> <span style="color:#fff;font-weight:bold">null</span> <span style="color:#fff;font-weight:bold">comment</span> <span style="color:#0ff;font-weight:bold">&#39;操作时间&#39;</span>,
</span></span><span style="display:flex;"><span>  oper_id <span style="color:#fff;font-weight:bold">bigint</span> <span style="color:#fff;font-weight:bold">not</span> <span style="color:#fff;font-weight:bold">null</span> <span style="color:#fff;font-weight:bold">comment</span> <span style="color:#0ff;font-weight:bold">&#39;操作的那行记录的id&#39;</span>,
</span></span><span style="display:flex;"><span>  oper_desc <span style="color:#fff;font-weight:bold">text</span> <span style="color:#fff;font-weight:bold">comment</span> <span style="color:#0ff;font-weight:bold">&#39;操作描述&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>触发器1：向dept表中插入数据时，记录日志</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>create trigger dept_trigger_insert 
</span></span><span style="display:flex;"><span>after insert on dept
</span></span><span style="display:flex;"><span>for each row
</span></span><span style="display:flex;"><span>begin
</span></span><span style="display:flex;"><span>	insert into oper_log(id,table_name,oper_type,oper_time,oper_id,oper_desc) values
</span></span><span style="display:flex;"><span>(null,&#39;dept&#39;,&#39;insert&#39;,now(),new.deptno,concat(&#39;插入数据：deptno=&#39;, new.deptno, &#39;,dname=&#39;, new.dname,&#39;,loc=&#39;, new.loc));
</span></span><span style="display:flex;"><span>end;
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看触发器：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>show triggers;
</span></span></code></pre></td></tr></table>
</div>
</div><p>删除触发器：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">drop</span> <span style="color:#fff;font-weight:bold">trigger</span> <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">exists</span> dept_trigger_insert;
</span></span></code></pre></td></tr></table>
</div>
</div><p>向dept表中插入一条记录：<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/17406fe0160671c659861030c07e640b_MD5.png"><br>
日志表中多了一条记录：<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/16b6c123c0518be75ac920eb61dd3bb9_MD5.png"></p>
<p>触发器2：修改dept表中数据时，记录日志</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>create trigger dept_trigger_update
</span></span><span style="display:flex;"><span>after update on dept
</span></span><span style="display:flex;"><span>for each row
</span></span><span style="display:flex;"><span>begin
</span></span><span style="display:flex;"><span>	insert into oper_log(id,table_name,oper_type,oper_time,oper_id,oper_desc) values
</span></span><span style="display:flex;"><span>(null,&#39;dept&#39;,&#39;update&#39;,now(),new.deptno,concat(&#39;更新前：deptno=&#39;, old.deptno, &#39;,dname=&#39;, old.dname,&#39;,loc=&#39;, old.loc, 
</span></span><span style="display:flex;"><span>                                              &#39;,更新后：deptno=&#39;, new.deptno, &#39;,dname=&#39;, new.dname,&#39;,loc=&#39;, new.loc));
</span></span><span style="display:flex;"><span>end;
</span></span></code></pre></td></tr></table>
</div>
</div><p>更新一条记录：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">update</span> dept <span style="color:#fff;font-weight:bold">set</span> loc = <span style="color:#0ff;font-weight:bold">&#39;北京&#39;</span> <span style="color:#fff;font-weight:bold">where</span> deptno = <span style="color:#ff0;font-weight:bold">60</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>日志表中多了一条记录：<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/667e68d9931fa9bb5bd54c26637d0169_MD5.png"><br>
<strong>注意：更新一条记录则对应一条日志。如果一次更新3条记录，那么日志表中插入3条记录。</strong></p>
<p>触发器3：删除dept表中数据时，记录日志</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>create trigger dept_trigger_delete
</span></span><span style="display:flex;"><span>after delete on dept
</span></span><span style="display:flex;"><span>for each row
</span></span><span style="display:flex;"><span>begin
</span></span><span style="display:flex;"><span>	insert into oper_log(id,table_name,oper_type,oper_time,oper_id,oper_desc) values
</span></span><span style="display:flex;"><span>(null,&#39;dept&#39;,&#39;delete&#39;,now(),old.deptno,concat(&#39;删除了数据：deptno=&#39;, old.deptno, &#39;,dname=&#39;, old.dname,&#39;,loc=&#39;, old.loc));
</span></span><span style="display:flex;"><span>end;
</span></span></code></pre></td></tr></table>
</div>
</div><p>删除一条记录：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">delete</span> <span style="color:#fff;font-weight:bold">from</span> dept <span style="color:#fff;font-weight:bold">where</span> deptno = <span style="color:#ff0;font-weight:bold">60</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>日志表中多了一条记录：<br>
<img alt="image.png" loading="lazy" src="/posts/mysql/%E7%AC%AC7%E7%AB%A0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/2217cae8acc716fc934e8ff4c6327324_MD5.png"></p>
<h1 id="视图">视图<a hidden class="anchor" aria-hidden="true" href="#视图">#</a></h1>
<ol>
<li>只能将select语句创建为视图。</li>
<li>创建视图</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">or</span> <span style="color:#fff;font-weight:bold">replace</span> <span style="color:#fff;font-weight:bold">view</span> v_emp <span style="color:#fff;font-weight:bold">as</span> <span style="color:#fff;font-weight:bold">select</span> e.ename,d.dname <span style="color:#fff;font-weight:bold">from</span> emp e <span style="color:#fff;font-weight:bold">join</span> dept d <span style="color:#fff;font-weight:bold">on</span> e.deptno = d.deptno;
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>视图作用<br>
4. 如果开发中有一条非常复杂的SQL，而这个SQL在多处使用，会给开发和维护带来成本。使用视图可以降低开发和维护的成本。<br>
5. 视图可以隐藏表的字段名。</li>
<li>修改视图</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">alter</span> <span style="color:#fff;font-weight:bold">view</span> v_emp <span style="color:#fff;font-weight:bold">as</span> <span style="color:#fff;font-weight:bold">select</span> e.ename,d.dname,d.deptno <span style="color:#fff;font-weight:bold">from</span> emp e <span style="color:#fff;font-weight:bold">join</span> dept d <span style="color:#fff;font-weight:bold">on</span> e.deptno = d.deptno;
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>删除视图<br>
6. drop view if exists v_emp;</li>
<li>对视图增删改（DML：insert delete update）可以影响到原表数据。</li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/mysql/">Mysql</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
