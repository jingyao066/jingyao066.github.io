<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>mysql基础 | Wjy&#39;s Blog</title>
<meta name="keywords" content="mysql">
<meta name="description" content="关系数据库概述
为什么需要数据库？
因为应用程序需要保存用户的数据，比如Word需要把用户文档保存起来，以便下次继续编辑或者拷贝到另一台电脑。">
<meta name="author" content="Me, You">
<link rel="canonical" href="https://funny-toffee-4aa7c3.netlify.app/posts/mysql/mysql%E5%9F%BA%E7%A1%80/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://funny-toffee-4aa7c3.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://funny-toffee-4aa7c3.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://funny-toffee-4aa7c3.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://funny-toffee-4aa7c3.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://funny-toffee-4aa7c3.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="mysql基础" />
<meta property="og:description" content="关系数据库概述
为什么需要数据库？
因为应用程序需要保存用户的数据，比如Word需要把用户文档保存起来，以便下次继续编辑或者拷贝到另一台电脑。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://funny-toffee-4aa7c3.netlify.app/posts/mysql/mysql%E5%9F%BA%E7%A1%80/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-12-01T18:12:58+00:00" />
<meta property="article:modified_time" content="2019-12-01T18:12:58+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="mysql基础"/>
<meta name="twitter:description" content="关系数据库概述
为什么需要数据库？
因为应用程序需要保存用户的数据，比如Word需要把用户文档保存起来，以便下次继续编辑或者拷贝到另一台电脑。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "mysql基础",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/mysql/mysql%E5%9F%BA%E7%A1%80/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "mysql基础",
  "name": "mysql基础",
  "description": "关系数据库概述 为什么需要数据库？\n因为应用程序需要保存用户的数据，比如Word需要把用户文档保存起来，以便下次继续编辑或者拷贝到另一台电脑。\n",
  "keywords": [
    "mysql"
  ],
  "articleBody": "关系数据库概述 为什么需要数据库？\n因为应用程序需要保存用户的数据，比如Word需要把用户文档保存起来，以便下次继续编辑或者拷贝到另一台电脑。\n要保存用户的数据，一个最简单的方法是把用户数据写入文件。例如，要保存一个班级所有学生的信息，可以向文件中写入一个CSV文件：\n1 2 3 4 5 id,name,gender,score 1,小明,M,90 2,小红,F,95 3,小军,M,88 4,小丽,F,88 如果要保存学校所有班级的信息，可以写入另一个CSV文件。\n但是，随着应用程序的功能越来越复杂，数据量越来越大，如何管理这些数据就成了大问题：\n读写文件并解析出数据需要大量重复代码； 从成千上万的数据中快速查询出指定数据需要复杂的逻辑。 如果每个应用程序都各自写自己的读写数据的代码，一方面效率低，容易出错，另一方面，每个应用程序访问数据的接口都不相同，数据难以复用。\n所以，数据库作为一种专门管理数据的软件就出现了。应用程序不需要自己管理数据，而是通过数据库软件提供的接口来读写数据。至于数据本身如何存储到文件，那是数据库软件的事情，应用程序自己并不关心：\n1 2 3 4 5 6 7 8 9 10 11 ┌──────────────┐ │ application │ └──────────────┘ ▲│ ││ read││write ││ │▼ ┌──────────────┐ │ database │ └──────────────┘ 这样一来，编写应用程序的时候，数据读写的功能就被大大地简化了。\n数据模型 数据库按照数据结构来组织、存储和管理数据，实际上，数据库一共有三种模型：\n层次模型 网状模型 关系模型 层次模型就是以“上下级”的层次关系来组织数据的一种方式，层次模型的数据结构看起来就像一颗树：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ┌─────┐ │ │ └─────┘ │ ┌───────┴───────┐ │ │ ┌─────┐ ┌─────┐ │ │ │ │ └─────┘ └─────┘ │ │ ┌───┴───┐ ┌───┴───┐ │ │ │ │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │ │ │ │ │ │ │ │ └─────┘ └─────┘ └─────┘ └─────┘ 网状模型把每个数据节点和其他很多节点都连接起来，它的数据结构看起来就像很多城市之间的路网：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ┌─────┐ ┌─────┐ ┌─│ │──────│ │──┐ │ └─────┘ └─────┘ │ │ │ │ │ │ └──────┬─────┘ │ │ │ │ ┌─────┐ ┌─────┐ ┌─────┐ │ │─────│ │─────│ │ └─────┘ └─────┘ └─────┘ │ │ │ │ ┌─────┴─────┐ │ │ │ │ │ │ ┌─────┐ ┌─────┐ │ └──│ │─────│ │──┘ └─────┘ └─────┘ 关系模型把数据看作是一个二维表格，任何数据都可以通过行号+列号来唯一确定，它的数据模型看起来就是一个Excel表：\n1 2 3 4 5 6 7 8 9 ┌─────┬─────┬─────┬─────┬─────┐ │ │ │ │ │ │ ├─────┼─────┼─────┼─────┼─────┤ │ │ │ │ │ │ ├─────┼─────┼─────┼─────┼─────┤ │ │ │ │ │ │ ├─────┼─────┼─────┼─────┼─────┤ │ │ │ │ │ │ └─────┴─────┴─────┴─────┴─────┘ 随着时间的推移和市场竞争，最终，基于关系模型的关系数据库获得了绝对市场份额。\n为什么关系数据库获得了最广泛的应用？\n因为相比层次模型和网状模型，关系模型理解和使用起来最简单。\n关系数据库的关系模型是基于数学理论建立的。我们把域（Domain）定义为一组具有相同数据类型的值的集合，给定一组域D1,D2,…,Dn，它们的笛卡尔集定义为D1×D2×……×Dn={(d1,d2,…,dn)|di∈Di,i=1,2,…,n}， 而D1×D2×……×Dn的子集叫作在域D1,D2,…,Dn上的关系，表示为R(D1,D2,…,Dn)，这里的R表示$#%\u0026^@!\u0026$#;!~％¥%:(……算了，根本讲不明白，大家也不用理解。\n基于数学理论的关系模型虽然讲起来挺复杂，但是，基于日常生活的关系模型却十分容易理解。我们以学校班级为例，一个班级的学生就可以用一个表格存起来，并且定义如下：\nID 姓名 班级ID 性别 年龄 1 小明 201 M 9 2 小红 202 F 8 3 小军 202 M 8 4 小白 201 F 9 其中，班级ID对应着另一个班级表：\nID 名称 班主任 201 二年级一班 王老师 202 二年级二班 李老师 通过给定一个班级名称，可以查到一条班级记录，根据班级ID，又可以查到多条学生记录，这样，二维表之间就通过ID映射建立了“一对多”关系。\n数据类型 对于一个关系表，除了定义每一列的名称外，还需要定义每一列的数据类型。关系数据库支持的标准数据类型包括数值、字符串、时间等：\n名称 类型 说明 INT 整型 4字节整数类型，范围约+/-21亿 BIGINT 长整型 8字节整数类型，范围约+/-922亿亿 REAL 浮点型 4字节浮点数，范围约+/-1038 DOUBLE 浮点型 8字节浮点数，范围约+/-10308 DECIMAL(M,N) 高精度小数 由用户指定精度的小数，例如，DECIMAL(20,10)表示一共20位，其中小数10位，通常用于财务计算 CHAR(N) 定长字符串 存储指定长度的字符串，例如，CHAR(100)总是存储100个字符的字符串 VARCHAR(N) 变长字符串 存储可变长度的字符串，例如，VARCHAR(100)可以存储0~100个字符的字符串 BOOLEAN 布尔类型 存储True或者False DATE 日期类型 存储日期，例如，2018-06-22 TIME 时间类型 存储时间，例如，12:20:59 DATETIME 日期和时间类型 存储日期+时间，例如，2018-06-22 12:20:59 上面的表中列举了最常用的数据类型。很多数据类型还有别名，例如，REAL又可以写成FLOAT(24)。还有一些不常用的数据类型，例如，TINYINT（范围在0~255）。各数据库厂商还会支持特定的数据类型，例如JSON。\n选择数据类型的时候，要根据业务规则选择合适的类型。通常来说，BIGINT能满足整数存储的需求，VARCHAR(N)能满足字符串存储的需求，这两种类型是使用最广泛的。\n主流关系数据库 目前，主流的关系数据库主要分为以下几类：\n商用数据库，例如：Oracle，SQL Server，DB2等； 开源数据库，例如：MySQL，PostgreSQL等； 桌面数据库，以微软Access为代表，适合桌面应用程序使用； 嵌入式数据库，以Sqlite为代表，适合手机应用和桌面程序。 SQL 什么是SQL？SQL是结构化查询语言的缩写，用来访问和操作数据库系统。SQL语句既可以查询数据库中的数据，也可以添加、更新和删除数据库中的数据，还可以对数据库进行管理和维护操作。不同的数据库，都支持SQL，这样，我们通过学习SQL这一种语言，就可以操作各种不同的数据库。\n虽然SQL已经被ANSI组织定义为标准，不幸地是，各个不同的数据库对标准的SQL支持不太一致。并且，大部分数据库都在标准的SQL上做了扩展。也就是说，如果只使用标准SQL，理论上所有数据库都可以支持，但如果使用某个特定数据库的扩展SQL，换一个数据库就不能执行了。例如，Oracle把自己扩展的SQL称为PL/SQL，Microsoft把自己扩展的SQL称为T-SQL。\n现实情况是，如果我们只使用标准SQL的核心功能，那么所有数据库通常都可以执行。不常用的SQL功能，不同的数据库支持的程度都不一样。而各个数据库支持的各自扩展的功能，通常我们把它们称之为“方言”。\n总的来说，SQL语言定义了这么几种操作数据库的能力：\nDDL：Data Definition Language\nDDL允许用户定义数据，也就是创建表、删除表、修改表结构这些操作。通常，DDL由数据库管理员执行。\nDML：Data Manipulation Language\nDML为用户提供添加、删除、更新数据的能力，这些是应用程序对数据库的日常操作。\nDQL：Data Query Language\nDQL允许用户查询数据，这也是通常最频繁的数据库日常操作。\n语法特点 SQL语言关键字不区分大小写！！！但是，针对不同的数据库，对于表名和列名，有的数据库区分大小写，有的数据库不区分大小写。同一个数据库，有的在Linux上区分大小写，有的在Windows上不区分大小写。\n所以，这里约定：SQL关键字总是大写，以示突出，表名和列名均使用小写。\n关系模型 我们已经知道，关系数据库是建立在关系模型上的。而关系模型本质上就是若干个存储数据的二维表，可以把它们看作很多Excel表。\n表的每一行称为记录（Record），记录是一个逻辑意义上的数据。\n表的每一列称为字段（Column），同一个表的每一行记录都拥有相同的若干字段。\n字段定义了数据类型（整型、浮点型、字符串、日期等），以及是否允许为NULL。注意NULL表示字段数据不存在。一个整型字段如果为NULL不表示它的值为0，同样的，一个字符串型字段为NULL也不表示它的值为空串''。\n通常情况下，字段应该避免允许为NULL。不允许为NULL可以简化查询条件，加快查询速度，也利于应用程序读取数据后无需判断是否为NULL。\n和Excel表有所不同的是，关系数据库的表和表之间需要建立“一对多”，“多对一”和“一对一”的关系，这样才能够按照应用程序的逻辑来组织和存储数据。\n例如，一个班级表：\nID 名称 班主任 201 二年级一班 王老师 202 二年级二班 李老师 每一行对应着一个班级，而一个班级对应着多个学生，所以班级表和学生表的关系就是“一对多”：\nID 姓名 班级ID 性别 年龄 1 小明 201 M 9 2 小红 202 F 8 3 小军 202 M 8 4 小白 201 F 9 反过来，如果我们先在学生表中定位了一行记录，例如ID=1的小明，要确定他的班级，只需要根据他的“班级ID”对应的值201找到班级表中ID=201的记录，即二年级一班。所以，学生表和班级表是“多对一”的关系。\n如果我们把班级表分拆得细一点，例如，单独创建一个教师表：\nID 名称 年龄 A1 王老师 26 A2 张老师 39 A3 李老师 32 A4 赵老师 27 班级表只存储教师ID：\nID 名称 班主任ID 201 二年级一班 A1 202 二年级二班 A3 这样，一个班级总是对应一个教师，班级表和教师表就是“一对一”关系。\n在关系数据库中，关系是通过主键和外键来维护的。我们在后面会分别深入讲解。\n主键 在关系数据库中，一张表中的每一行数据被称为一条记录。一条记录就是由多个字段组成的。例如，students表的两行记录：\nid class_id name gender score 1 1 小明 M 90 2 1 小红 F 95 每一条记录都包含若干定义好的字段。同一个表的所有记录都有相同的字段定义。\n对于关系表，有个很重要的约束，就是任意两条记录不能重复。不能重复不是指两条记录不完全相同，而是指能够通过某个字段唯一区分出不同的记录，这个字段被称为主键。\n例如，假设我们把name字段作为主键，那么通过名字小明或小红就能唯一确定一条记录。但是，这么设定，就没法存储同名的同学了，因为插入相同主键的两条记录是不被允许的。\n对主键的要求，最关键的一点是：记录一旦插入到表中，主键最好不要再修改，因为主键是用来唯一定位记录的，修改了主键，会造成一系列的影响。\n由于主键的作用十分重要，如何选取主键会对业务开发产生重要影响。如果我们以学生的身份证号作为主键，似乎能唯一定位记录。然而，身份证号也是一种业务场景，如果身份证号升位了，或者需要变更，作为主键，不得不修改的时候，就会对业务产生严重影响。\n所以，选取主键的一个基本原则是：不使用任何业务相关的字段作为主键。\n因此，身份证号、手机号、邮箱地址这些看上去可以唯一的字段，均不可用作主键。\n作为主键最好是完全业务无关的字段，我们一般把这个字段命名为id。常见的可作为id字段的类型有：\n自增整数类型：数据库会在插入数据时自动为每一条记录分配一个自增整数，这样我们就完全不用担心主键重复，也不用自己预先生成主键； 全局唯一GUID类型：使用一种全局唯一的字符串作为主键，类似8f55d96b-8acc-4636-8cb8-76bf8abc2f57。GUID算法通过网卡MAC地址、时间戳和随机数保证任意计算机在任意时间生成的字符串都是不同的，大部分编程语言都内置了GUID算法，可以自己预算出主键。 对于大部分应用来说，通常自增类型的主键就能满足需求。我们在students表中定义的主键也是BIGINT NOT NULL AUTO_INCREMENT类型。\n如果使用INT自增类型，那么当一张表的记录数超过2147483647（约21亿）时，会达到上限而出错。使用BIGINT自增类型则可以最多约922亿亿条记录。\n联合主键 关系数据库实际上还允许通过多个字段唯一标识记录，即两个或更多的字段都设置为主键，这种主键被称为联合主键。\n对于联合主键，允许一列有重复，只要不是所有主键列都重复即可：\nid_num id_type other columns… 1 A … 2 A … 2 B … 如果我们把上述表的id_num和id_type这两列作为联合主键，那么上面的3条记录都是允许的，因为没有两列主键组合起来是相同的。\n没有必要的情况下，我们尽量不使用联合主键，因为它给关系表带来了复杂度的上升。\n小结 主键是关系表中记录的唯一标识。主键的选取非常重要：主键不要带有业务含义，而应该使用BIGINT自增或者GUID类型。主键也不应该允许NULL。\n可以使用多个列作为联合主键，但联合主键并不常用。\n外键 当我们用主键唯一标识记录时，我们就可以在students表中确定任意一个学生的记录：\nid name other columns… 1 小明 … 2 小红 … 我们还可以在classes表中确定任意一个班级记录：\nid name other columns… 1 一班 … 2 二班 … 但是我们如何确定students表的一条记录，例如，id=1的小明，属于哪个班级呢？\n由于一个班级可以有多个学生，在关系模型中，这两个表的关系可以称为“一对多”，即一个classes的记录可以对应多个students表的记录。\n为了表达这种一对多的关系，我们需要在students表中加入一列class_id，让它的值与classes表的某条记录相对应：\nid class_id name other columns… 1 1 小明 … 2 1 小红 … 5 2 小白 … 这样，我们就可以根据class_id这个列直接定位出一个students表的记录应该对应到classes的哪条记录。\n例如：\n小明的class_id是1，因此，对应的classes表的记录是id=1的一班； 小红的class_id是1，因此，对应的classes表的记录是id=1的一班； 小白的class_id是2，因此，对应的classes表的记录是id=2的二班。 在students表中，通过class_id的字段，可以把数据与另一张表关联起来，这种列称为外键。\n外键并不是通过列名实现的，而是通过定义外键约束实现的：\n1 2 3 4 ALTER TABLE students ADD CONSTRAINT fk_class_id FOREIGN KEY (class_id) REFERENCES classes (id); 其中，外键约束的名称fk_class_id可以任意，FOREIGN KEY (class_id)指定了class_id作为外键，REFERENCES classes (id)指定了这个外键将关联到classes表的id列（即classes表的主键）。\n通过定义外键约束，关系数据库可以保证无法插入无效的数据。即如果classes表不存在id=99的记录，students表就无法插入class_id=99的记录。\n注意：由于外键约束会降低数据库的性能，大部分互联网应用程序为了追求速度，并不设置外键约束，而是仅靠应用程序自身来保证逻辑的正确性。这种情况下，class_id仅仅是一个普通的列，只是它起到了外键的作用而已。\n要删除一个外键约束，也是通过ALTER TABLE实现的：\n1 2 ALTER TABLE students DROP FOREIGN KEY fk_class_id; 注意：删除外键约束并没有删除外键这一列。删除列是通过DROP COLUMN ...实现的。\n多对多 通过一个表的外键关联到另一个表，我们可以定义出一对多关系。有些时候，还需要定义“多对多”关系。例如，一个老师可以对应多个班级，一个班级也可以对应多个老师，因此，班级表和老师表存在多对多关系。\n多对多关系实际上是通过两个一对多关系实现的，即通过一个中间表，关联两个一对多关系，就形成了多对多关系：\nteachers表：\nid name 1 张老师 2 王老师 3 李老师 4 赵老师 classes表：\nid name 1 一班 2 二班 中间表teacher_class关联两个一对多关系：\nid teacher_id class_id 1 1 1 2 1 2 3 2 1 4 2 2 5 3 1 6 4 2 通过中间表teacher_class可知teachers到classes的关系：\nid=1的张老师对应id=1,2的一班和二班； id=2的王老师对应id=1,2的一班和二班； id=3的李老师对应id=1的一班； id=4的赵老师对应id=2的二班。 同理可知classes到teachers的关系：\nid=1的一班对应id=1,2,3的张老师、王老师和李老师； id=2的二班对应id=1,2,4的张老师、王老师和赵老师； 因此，通过中间表，我们就定义了一个“多对多”关系。\n一对一 一对一关系是指，一个表的记录对应到另一个表的唯一一条记录。\n例如，students表的每个学生可以有自己的联系方式，如果把联系方式存入另一个表contacts，我们就可以得到一个“一对一”关系：\nid student_id mobile 1 1 135xxxx6300 2 2 138xxxx2209 3 5 139xxxx8086 有细心的童鞋会问，既然是一对一关系，那为啥不给students表增加一个mobile列，这样就能合二为一了？\n如果业务允许，完全可以把两个表合为一个表。但是，有些时候，如果某个学生没有手机号，那么，contacts表就不存在对应的记录。实际上，一对一关系准确地说，是contacts表一对一对应students表。\n还有一些应用会把一个大表拆成两个一对一的表，目的是把经常读取和不经常读取的字段分开，以获得更高的性能。例如，把一个大的用户表分拆为用户基本信息表user_info和用户详细信息表user_profiles，大部分时候，只需要查询user_info表，并不需要查询user_profiles表，这样就提高了查询速度。\n小结 关系数据库通过外键可以实现一对多、多对多和一对一的关系。外键既可以通过数据库来约束，也可以不设置约束，仅依靠应用程序的逻辑来保证。\n索引 在关系数据库中，如果有上万甚至上亿条记录，在查找记录的时候，想要获得非常快的速度，就需要使用索引。\n索引是关系数据库中对某一列或多个列的值进行预排序的数据结构。通过使用索引，可以让数据库系统不必扫描整个表，而是直接定位到符合条件的记录，这样就大大加快了查询速度。\n例如，对于students表：\nid class_id name gender score 1 1 小明 M 90 2 1 小红 F 95 3 1 小军 M 88 如果要经常根据score列进行查询，就可以对score列创建索引：\n1 2 ALTER TABLE students ADD INDEX idx_score (score); 使用ADD INDEX idx_score (score)就创建了一个名称为idx_score，使用列score的索引。索引名称是任意的，索引如果有多列，可以在括号里依次写上，例如：\n1 2 ALTER TABLE students ADD INDEX idx_name_score (name, score); 索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如gender列，大约一半的记录值是M，另一半是F，因此，对该列创建索引就没有意义。\n可以对一张表创建多个索引。索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引，因此，索引越多，插入、更新和删除记录的速度就越慢。\n对于主键，关系数据库会自动对其创建主键索引。使用主键索引的效率是最高的，因为主键会保证绝对唯一。\n唯一索引 在设计关系数据表的时候，看上去唯一的列，例如身份证号、邮箱地址等，因为他们具有业务含义，因此不宜作为主键。\n但是，这些列根据业务要求，又具有唯一性约束：即不能出现两条记录存储了同一个身份证号。这个时候，就可以给该列添加一个唯一索引。例如，我们假设students表的name不能重复：\n1 2 ALTER TABLE students ADD UNIQUE INDEX uni_name (name); 通过UNIQUE关键字我们就添加了一个唯一索引。\n也可以只对某一列添加一个唯一约束而不创建唯一索引：\n1 2 ALTER TABLE students ADD CONSTRAINT uni_name UNIQUE (name); 这种情况下，name列没有索引，但仍然具有唯一性保证。\n无论是否创建索引，对于用户和应用程序来说，使用关系数据库不会有任何区别。这里的意思是说，当我们在数据库中查询时，如果有相应的索引可用，数据库系统就会自动使用索引来提高查询效率，如果没有索引，查询也能正常执行，只是速度会变慢。因此，索引可以在使用数据库的过程中逐步优化。\n小结 通过对数据库表创建索引，可以提高查询速度。\n通过创建唯一索引，可以保证某一列的值具有唯一性。\n数据库索引对于用户和应用程序来说都是透明的。\n查询数据 在关系数据库中，最常用的操作就是查询。\n为了便于讲解和练习，我们先准备好了一个students表和一个classes表，它们的结构和数据如下：\nstudents表存储了学生信息：\nid class_id name gender score 1 1 小明 M 90 2 1 小红 F 95 3 1 小军 M 88 4 1 小米 F 73 5 2 小白 F 81 6 2 小兵 M 55 7 2 小林 M 85 8 3 小新 F 91 9 3 小王 M 89 10 3 小丽 F 85 classes表存储了班级信息：\nid name 1 一班 2 二班 3 三班 4 四班 基本查询 要查询数据库表的数据，我们使用如下的SQL语句：\n1 SELECT * FROM \u003c表名\u003e 假设表名是students，要查询students表的所有行，我们用如下SQL语句：\n1 SELECT * FROM students; 使用SELECT * FROM students时，SELECT是关键字，表示将要执行一个查询，*表示“所有列”，FROM表示将要从哪个表查询，本例中是students表。\n该SQL将查询出students表的所有数据。注意：查询结果也是一个二维表，它包含列名和每一行的数据。\n要查询classes表的所有行，我们用如下SQL语句：\n1 SELECT * FROM classes; SELECT语句其实并不要求一定要有FROM子句。我们来试试下面的SELECT语句：\n1 SELECT 100+200; 上述查询会直接计算出表达式的结果。虽然SELECT可以用作计算，但它并不是SQL的强项。但是，不带FROM子句的SELECT语句有一个有用的用途，就是用来判断当前到数据库的连接是否有效。许多检测工具会执行一条SELECT 1;来测试数据库连接。\n条件查询 使用SELECT * FROM \u003c表名\u003e可以查询到一张表的所有记录。但是，很多时候，我们并不希望获得所有记录，而是根据条件选择性地获取指定条件的记录，例如，查询分数在80分以上的学生记录。在一张表有数百万记录的情况下，获取所有记录不仅费时，还费内存和网络带宽。\nSELECT语句可以通过WHERE条件来设定查询条件，查询结果是满足查询条件的记录。例如，要指定条件“分数在80分或以上的学生”，写成WHERE条件就是SELECT * FROM students WHERE score \u003e= 80。\n其中，WHERE关键字后面的score \u003e= 80就是条件。score是列名，该列存储了学生的成绩，因此，score \u003e= 80就筛选出了指定条件的记录：\n1 SELECT * FROM students WHERE score \u003e= 80; 因此，条件查询的语法就是：\n1 SELECT * FROM \u003c表名\u003e WHERE \u003c条件表达式\u003e 条件表达式可以用\u003c条件1\u003e AND \u003c条件2\u003e表达满足条件1并且满足条件2。例如，符合条件“分数在80分或以上”，并且还符合条件“男生”，把这两个条件写出来：\n条件1：根据score列的数据判断：score \u003e= 80； 条件2：根据gender列的数据判断：gender = 'M'，注意gender列存储的是字符串，需要用单引号括起来。 就可以写出WHERE条件：score \u003e= 80 AND gender = 'M'：\n1 SELECT * FROM students WHERE score \u003e= 80 AND gender = 'M'; 第二种条件是\u003c条件1\u003e OR \u003c条件2\u003e，表示满足条件1或者满足条件2。例如，把上述AND查询的两个条件改为OR，查询结果就是“分数在80分或以上”或者“男生”，满足任意之一的条件即选出该记录：\n1 SELECT * FROM students WHERE score \u003e= 80 OR gender = 'M'; 很显然OR条件要比AND条件宽松，返回的符合条件的记录也更多。\n第三种条件是NOT \u003c条件\u003e，表示“不符合该条件”的记录。例如，写一个“不是2班的学生”这个条件，可以先写出“是2班的学生”：class_id = 2，再加上NOT：NOT class_id = 2：\n1 SELECT * FROM students WHERE NOT class_id = 2; 上述NOT条件NOT class_id = 2其实等价于class_id \u003c\u003e 2，因此，NOT查询不是很常用。\n要组合三个或者更多的条件，就需要用小括号()表示如何进行条件运算。例如，编写一个复杂的条件：分数在80以下或者90以上，并且是男生：\n1 SELECT * FROM students WHERE (score \u003c 80 OR score \u003e 90) AND gender = 'M'; 如果不加括号，条件运算按照NOT、AND、OR的优先级进行，即NOT优先级最高，其次是AND，最后是OR。加上括号可以改变优先级。\n常用的条件表达式 条件 表达式举例1 表达式举例2 说明 使用=判断相等 score = 80 name = ‘abc’ 字符串需要用单引号括起来 使用\u003e判断大于 score \u003e 80 name \u003e ‘abc’ 字符串比较根据ASCII码，中文字符比较根据数据库设置 使用\u003e=判断大于或相等 score \u003e= 80 name \u003e= ‘abc’ 使用\u003c判断小于 score \u003c 80 name \u003c= ‘abc’ 使用\u003c=判断小于或相等 score \u003c= 80 name \u003c= ‘abc’ 使用\u003c\u003e判断不相等 score \u003c\u003e 80 name \u003c\u003e ‘abc’ 使用LIKE判断相似 name LIKE ‘ab%’ name LIKE ‘%bc%’ %表示任意字符，例如’ab%‘将匹配’ab’，‘abc’，‘abcd’ 投影查询 使用SELECT * FROM \u003c表名\u003e WHERE \u003c条件\u003e可以选出表中的若干条记录。我们注意到返回的二维表结构和原表是相同的，即结果集的所有列与原表的所有列都一一对应。\n如果我们只希望返回某些列的数据，而不是所有列的数据，我们可以用SELECT 列1, 列2, 列3 FROM ...，让结果集仅包含指定列。这种操作称为投影查询。\n例如，从students表中返回id、score和name这三列：\n1 SELECT id, score, name FROM students; 这样返回的结果集就只包含了我们指定的列，并且，结果集的列的顺序和原表可以不一样。\n使用SELECT 列1, 列2, 列3 FROM ...时，还可以给每一列起个别名，这样，结果集的列名就可以与原表的列名不同。它的语法是SELECT 列1 别名1, 列2 别名2, 列3 别名3 FROM ...。\n例如，以下SELECT语句将列名score重命名为points，而id和name列名保持不变：\n1 SELECT id, score points, name FROM students; 投影查询同样可以接WHERE条件，实现复杂的查询：\n1 SELECT id, score points, name FROM students WHERE gender = 'M'; 小结 使用SELECT *表示查询表的所有列，使用SELECT 列1, 列2, 列3则可以仅返回指定列，这种操作称为投影。\nSELECT语句可以对结果集的列进行重命名。\n排序 我们使用SELECT查询时，细心的读者可能注意到，查询结果集通常是按照id排序的，也就是根据主键排序。这也是大部分数据库的做法。如果我们要根据其他条件排序怎么办？可以加上ORDER BY子句。例如按照成绩从低到高进行排序：\n1 SELECT id, name, gender, score FROM students ORDER BY score; 如果要反过来，按照成绩从高到底排序，我们可以加上DESC表示“倒序”：\n1 SELECT id, name, gender, score FROM students ORDER BY score DESC; 如果score列有相同的数据，要进一步排序，可以继续添加列名。例如，使用ORDER BY score DESC, gender表示先按score列倒序，如果有相同分数的，再按gender列排序：\n1 SELECT id, name, gender, score FROM students ORDER BY score DESC, gender; 默认的排序规则是ASC：“升序”，即从小到大。ASC可以省略，即ORDER BY score ASC和ORDER BY score效果一样。\n如果有WHERE子句，那么ORDER BY子句要放到WHERE子句后面。例如，查询一班的学生成绩，并按照倒序排序：\n1 2 3 4 SELECT id, name, gender, score FROM students WHERE class_id = 1 ORDER BY score DESC; 这样，结果集仅包含符合WHERE条件的记录，并按照ORDER BY的设定排序。\n分页查询 使用SELECT查询时，如果结果集数据量很大，比如几万行数据，放在一个页面显示的话数据量太大，不如分页显示，每次显示100条。\n要实现分页功能，实际上就是从结果集中显示第1~100条记录作为第1页，显示第101~200条记录作为第2页，以此类推。\n因此，分页实际上就是从结果集中“截取”出第M~N条记录。这个查询可以通过LIMIT OFFSET 子句实现。我们先把所有学生按照成绩从高到低进行排序：\n1 SELECT id, name, gender, score FROM students ORDER BY score DESC; 现在，我们把结果集分页，每页3条记录。要获取第1页的记录，可以使用LIMIT 3 OFFSET 0：\n1 2 3 4 SELECT id, name, gender, score FROM students ORDER BY score DESC LIMIT 3 OFFSET 0; 上述查询LIMIT 3 OFFSET 0表示，对结果集从0号记录开始，最多取3条。注意SQL记录集的索引从0开始。\n如果要查询第2页，那么我们只需要“跳过”头3条记录，也就是对结果集从3号记录开始查询，把OFFSET设定为3：\n1 2 3 4 SELECT id, name, gender, score FROM students ORDER BY score DESC LIMIT 3 OFFSET 3; 类似的，查询第3页的时候，OFFSET应该设定为6：\n1 2 3 4 SELECT id, name, gender, score FROM students ORDER BY score DESC LIMIT 3 OFFSET 6; 查询第4页的时候，OFFSET应该设定为9:\n1 2 3 4 SELECT id, name, gender, score FROM students ORDER BY score DESC LIMIT 3 OFFSET 9; 由于第4页只有1条记录，因此最终结果集按实际数量1显示。LIMIT 3表示的意思是“最多3条记录”。\n可见，分页查询的关键在于，首先要确定每页需要显示的结果数量pageSize（这里是3），然后根据当前页的索引pageIndex（从1开始），确定LIMIT和OFFSET应该设定的值：\nLIMIT总是设定为pageSize； OFFSET计算公式为pageSize * (pageIndex - 1)。 这样就能正确查询出第N页的记录集。\n如果原本记录集一共就10条记录，但我们把OFFSET设置为20，会得到什么结果呢？\n1 2 3 4 SELECT id, name, gender, score FROM students ORDER BY score DESC LIMIT 3 OFFSET 20; OFFSET超过了查询的最大数量并不会报错，而是得到一个空的结果集。\n注意 OFFSET是可选的，如果只写LIMIT 15，那么相当于LIMIT 15 OFFSET 0。\n在MySQL中，LIMIT 15 OFFSET 30还可以简写成LIMIT 30, 15。\n使用LIMIT OFFSET 分页时，随着N越来越大，查询效率也会越来越低。\n小结 使用LIMIT OFFSET 可以对结果集进行分页，每次查询返回结果集的一部分；\n分页查询需要先确定每页的数量和当前页数，然后确定LIMIT和OFFSET的值。\n思考 在分页查询之前，如何计算一共有几页？\n聚合查询 如果我们要统计一张表的数据量，例如，想查询students表一共有多少条记录，难道必须用SELECT * FROM students查出来然后再数一数有多少行吗？\n这个方法当然可以，但是比较弱智。对于统计总数、平均数这类计算，SQL提供了专门的聚合函数，使用聚合函数进行查询，就是聚合查询，它可以快速获得结果。\n仍然以查询students表一共有多少条记录为例，我们可以使用SQL内置的COUNT()函数查询：\n1 SELECT COUNT(*) FROM students; COUNT(*)表示查询所有列的行数，要注意聚合的计算结果虽然是一个数字，但查询的结果仍然是一个二维表，只是这个二维表只有一行一列，并且列名是COUNT(*)。\n通常，使用聚合查询时，我们应该给列名设置一个别名，便于处理结果：\n1 SELECT COUNT(*) num FROM students; COUNT(*)和COUNT(id)实际上是一样的效果。另外注意，聚合查询同样可以使用WHERE条件，因此我们可以方便地统计出有多少男生、多少女生、多少80分以上的学生等：\n1 SELECT COUNT(*) boys FROM students WHERE gender = 'M'; 除了COUNT()函数外，SQL还提供了如下聚合函数：\n函数 说明 SUM 计算某一列的合计值，该列必须为数值类型 AVG 计算某一列的平均值，该列必须为数值类型 MAX 计算某一列的最大值 MIN 计算某一列的最小值 注意，MAX()和MIN()函数并不限于数值类型。如果是字符类型，MAX()和MIN()会返回排序最后和排序最前的字符。\n要统计男生的平均成绩，我们用下面的聚合查询：\n1 SELECT AVG(score) average FROM students WHERE gender = 'M'; 要特别注意：如果聚合查询的WHERE条件没有匹配到任何行，COUNT()会返回0，而SUM()、AVG()、MAX()和MIN()会返回NULL：\n1 SELECT AVG(score) average FROM students WHERE gender = 'X'; 分组 如果我们要统计一班的学生数量，我们知道，可以用SELECT COUNT(*) num FROM students WHERE class_id = 1;。如果要继续统计二班、三班的学生数量，难道必须不断修改WHERE条件来执行SELECT语句吗？\n对于聚合查询，SQL还提供了“分组聚合”的功能。我们观察下面的聚合查询：\n1 SELECT COUNT(*) num FROM students GROUP BY class_id; 执行这个查询，COUNT()的结果不再是一个，而是3个，这是因为，GROUP BY子句指定了按class_id分组，因此，执行该SELECT语句时，会把class_id相同的列先分组，再分别计算，因此，得到了3行结果。\n但是这3行结果分别是哪三个班级的，不好看出来，所以我们可以把class_id列也放入结果集中：\n1 SELECT class_id, COUNT(*) num FROM students GROUP BY class_id; 这下结果集就可以一目了然地看出各个班级的学生人数。我们再试试把name放入结果集：\n1 2 3 SELECT name, class_id, COUNT(*) num FROM students GROUP BY class_id; 不出意外，执行这条查询我们会得到一个语法错误，因为在任意一个分组中，只有class_id都相同，name是不同的，SQL引擎不能把多个name的值放入一行记录中。因此，聚合查询的列中，只能放入分组的列。\n也可以使用多个列进行分组。例如，我们想统计各班的男生和女生人数：\n1 2 3 SELECT class_id, gender, COUNT(*) num FROM students GROUP BY class_id, gender; 上述查询结果集一共有6条记录，分别对应各班级的男生和女生人数。\n多表查询 SELECT查询不但可以从一张表查询数据，还可以从多张表同时查询数据。查询多张表的语法是：SELECT * FROM \u003c表1\u003e \u003c表2\u003e。\n例如，同时从students表和classes表的“乘积”，即查询数据，可以这么写：\n1 SELECT * FROM students, classes; 这种一次查询两个表的数据，查询的结果也是一个二维表，它是students表和classes表的“乘积”，即students表的每一行与classes表的每一行都两两拼在一起返回。结果集的列数是students表和classes表的列数之和，行数是students表和classes表的行数之积。\n这种多表查询又称笛卡尔查询，使用笛卡尔查询时要非常小心，由于结果集是目标表的行数乘积，对两个各自有100行记录的表进行笛卡尔查询将返回1万条记录，对两个各自有1万行记录的表进行笛卡尔查询将返回1亿条记录。\n你可能还注意到了，上述查询的结果集有两列id和两列name，两列id是因为其中一列是students表的id，而另一列是classes表的id，但是在结果集中，不好区分。两列name同理\n要解决这个问题，我们仍然可以利用投影查询的“设置列的别名”来给两个表各自的id和name列起别名：\n1 2 3 4 5 6 7 8 SELECT students.id sid, students.name, students.gender, students.score, classes.id cid, classes.name cname FROM students, classes; 注意，多表查询时，要使用表名.列名这样的方式来引用列和设置别名，这样就避免了结果集的列名重复问题。但是，用表名.列名这种方式列举两个表的所有列实在是很麻烦，所以SQL还允许给表设置一个别名，让我们在投影查询中引用起来稍微简洁一点：\n1 2 3 4 5 6 7 8 SELECT s.id sid, s.name, s.gender, s.score, c.id cid, c.name cname FROM students s, classes c; 注意到FROM子句给表设置别名的语法是FROM \u003c表名1\u003e \u003c别名1\u003e, \u003c表名2\u003e \u003c别名2\u003e。这样我们用别名s和c分别表示students表和classes表。\n多表查询也是可以添加WHERE条件的，我们来试试：\n1 2 3 4 5 6 7 8 9 SELECT s.id sid, s.name, s.gender, s.score, c.id cid, c.name cname FROM students s, classes c WHERE s.gender = 'M' AND c.id = 1; 这个查询的结果集每行记录都满足条件s.gender = 'M'和c.id = 1。添加WHERE条件后结果集的数量大大减少了。\n连接查询 连接查询是另一种类型的多表查询。连接查询对多个表进行JOIN运算，简单地说，就是先确定一个主表作为结果集，然后，把其他表的行有选择性地“连接”在主表结果集上。\n例如，我们想要选出students表的所有学生信息，可以用一条简单的SELECT语句完成：\n1 2 3 4 5 6 7 SELECT s.id, s.name, s.class_id, s.gender, s.score FROM students s; 但是，假设我们希望结果集同时包含所在班级的名称，上面的结果集只有class_id列，缺少对应班级的name列。\n现在问题来了，存放班级名称的name列存储在classes表中，只有根据students表的class_id，找到classes表对应的行，再取出name列，就可以获得班级名称。\n这时，连接查询就派上了用场。我们先使用最常用的一种内连接：INNER JOIN来实现：\n1 2 3 4 SELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.score FROM students s INNER JOIN classes c ON s.class_id = c.id; 注意INNER JOIN查询的写法是：\n先确定主表，仍然使用FROM \u003c表1\u003e的语法； 再确定需要连接的表，使用INNER JOIN \u003c表2\u003e的语法； 然后确定连接条件，使用ON \u003c条件...\u003e，这里的条件是s.class_id = c.id，表示students表的class_id列与classes表的id列相同的行需要连接； 可选：加上WHERE子句、ORDER BY等子句。 使用别名不是必须的，但可以更好地简化查询语句。\n那什么是内连接（INNER JOIN）呢？先别着急，有内连接（INNER JOIN）就有外连接（OUTER JOIN）。我们把内连接查询改成外连接查询，看看效果：\n1 2 3 4 SELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.score FROM students s RIGHT OUTER JOIN classes c ON s.class_id = c.id; 执行上述RIGHT OUTER JOIN可以看到，和INNER JOIN相比，RIGHT OUTER JOIN多了一行，多出来的一行是“四班”，但是，学生相关的列如name、gender、score都为NULL。\n这也容易理解，因为根据ON条件s.class_id = c.id，classes表的id=4的行正是“四班”，但是，students表中并不存在class_id=4的行。\n有RIGHT OUTER JOIN，就有LEFT OUTER JOIN，以及FULL OUTER JOIN。它们的区别是：\nINNER JOIN只返回同时存在于两张表的行数据，由于students表的class_id包含1，2，3，classes表的id包含1，2，3，4，所以，INNER JOIN根据条件s.class_id = c.id返回的结果集仅包含1，2，3。\nRIGHT OUTER JOIN返回右表都存在的行。如果某一行仅在右表存在，那么结果集就会以NULL填充剩下的字段。\nLEFT OUTER JOIN则返回左表都存在的行。如果我们给students表增加一行，并添加class_id=5，由于classes表并不存在id=5的行，所以，LEFT OUTER JOIN的结果会增加一行，对应的class_name是NULL：\n1 2 3 4 SELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.score FROM students s LEFT OUTER JOIN classes c ON s.class_id = c.id; 最后，我们使用FULL OUTER JOIN，它会把两张表的所有记录全部选择出来，并且，自动把对方不存在的列填充为NULL：\n1 2 3 4 SELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.score FROM students s FULL OUTER JOIN classes c ON s.class_id = c.id; 对于这么多种JOIN查询，到底什么使用应该用哪种呢？其实我们用图来表示结果集就一目了然了。\n假设查询语句是：\n1 2 SELECT ... FROM tableA ??? JOIN tableB ON tableA.column1 = tableB.column2; 我们把tableA看作左表，把tableB看成右表，那么INNER JOIN是选出两张表都存在的记录：\nLEFT OUTER JOIN是选出左表存在的记录：\nRIGHT OUTER JOIN是选出右表存在的记录：\nFULL OUTER JOIN则是选出左右表都存在的记录：\n小结 JOIN查询需要先确定主表，然后把另一个表的数据“附加”到结果集上；\nINNER JOIN是最常用的一种JOIN查询，它的语法是SELECT ... FROM \u003c表1\u003e INNER JOIN \u003c表2\u003e ON \u003c条件...\u003e；\nJOIN查询仍然可以使用WHERE条件和ORDER BY排序。\n修改数据 insert 关系数据库的基本操作就是增删改查，即CRUD：Create、Retrieve、Update、Delete。其中，对于查询，我们已经详细讲述了SELECT语句的详细用法。\n而对于增、删、改，对应的SQL语句分别是：\nINSERT：插入新记录； UPDATE：更新已有记录； DELETE：删除已有记录。 当我们需要向数据库表中插入一条新记录时，就必须使用INSERT语句。\nINSERT语句的基本语法是：\n1 INSERT INTO \u003c表名\u003e (字段1, 字段2, ...) VALUES (值1, 值2, ...); 例如，我们向students表插入一条新记录，先列举出需要插入的字段名称，然后在VALUES子句中依次写出对应字段的值：\n1 2 3 INSERT INTO students (class_id, name, gender, score) VALUES (2, '大牛', 'M', 80); -- 查询并观察结果: SELECT * FROM students; 注意到我们并没有列出id字段，也没有列出id字段对应的值，这是因为id字段是一个自增主键，它的值可以由数据库自己推算出来。此外，如果一个字段有默认值，那么在INSERT语句中也可以不出现。\n要注意，字段顺序不必和数据库表的字段顺序一致，但值的顺序必须和字段顺序一致。也就是说，可以写INSERT INTO students (score, gender, name, class_id) ...，但是对应的VALUES就得变成(80, 'M', '大牛', 2)。\n还可以一次性添加多条记录，只需要在VALUES子句中指定多个记录值，每个记录是由(...)包含的一组值：\n1 2 3 4 5 INSERT INTO students (class_id, name, gender, score) VALUES (1, '大宝', 'M', 87), (2, '二宝', 'M', 81); SELECT * FROM students; 小结 使用INSERT，我们就可以一次向一个表中插入一条或多条记录。\nupdate 如果要更新数据库表中的记录，我们就必须使用UPDATE语句。\nUPDATE语句的基本语法是：\n1 UPDATE \u003c表名\u003e SET 字段1=值1, 字段2=值2, ... WHERE ...; 例如，我们想更新students表id=1的记录的name和score这两个字段，先写出UPDATE students SET name='大牛', score=66，然后在WHERE子句中写出需要更新的行的筛选条件id=1：\n1 2 3 UPDATE students SET name='大牛', score=66 WHERE id=1; -- 查询并观察结果: SELECT * FROM students WHERE id=1; 注意到UPDATE语句的WHERE条件和SELECT语句的WHERE条件其实是一样的，因此完全可以一次更新多条记录：\n1 2 3 UPDATE students SET name='小牛', score=77 WHERE id\u003e=5 AND id\u003c=7; -- 查询并观察结果: SELECT * FROM students; 在UPDATE语句中，更新字段时可以使用表达式。例如，把所有80分以下的同学的成绩加10分：\n1 2 3 UPDATE students SET score=score+10 WHERE score\u003c80; -- 查询并观察结果: SELECT * FROM students; 其中，SET score=score+10就是给当前行的score字段的值加上了10。\n如果WHERE条件没有匹配到任何记录，UPDATE语句不会报错，也不会有任何记录被更新。例如：\n1 2 3 UPDATE students SET score=100 WHERE id=999; -- 查询并观察结果: SELECT * FROM students; 最后，要特别小心的是，UPDATE语句可以没有WHERE条件，例如：\n1 UPDATE students SET score=60; 这时，整个表的所有记录都会被更新。所以，在执行UPDATE语句时要非常小心，最好先用SELECT语句来测试WHERE条件是否筛选出了期望的记录集，然后再用UPDATE更新。\nMySQL 在使用MySQL这类真正的关系数据库时，UPDATE语句会返回更新的行数以及WHERE条件匹配的行数。\n例如，更新id=1的记录时：\n1 2 3 mysql\u003e UPDATE students SET name='大宝' WHERE id=1; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 MySQL会返回1，可以从打印的结果Rows matched: 1 Changed: 1看到。\n当更新id=999的记录时：\n1 2 3 mysql\u003e UPDATE students SET name='大宝' WHERE id=999; Query OK, 0 rows affected (0.00 sec) Rows matched: 0 Changed: 0 Warnings: 0 MySQL会返回0，可以从打印的结果Rows matched: 0 Changed: 0看到。\n小结 使用UPDATE，我们就可以一次更新表中的一条或多条记录。\ndelete 如果要删除数据库表中的记录，我们可以使用DELETE语句。\nDELETE语句的基本语法是：\n1 DELETE FROM \u003c表名\u003e WHERE ...; 例如，我们想删除students表中id=1的记录，就需要这么写：\n1 2 3 DELETE FROM students WHERE id=1; -- 查询并观察结果: SELECT * FROM students; 注意到DELETE语句的WHERE条件也是用来筛选需要删除的行，因此和UPDATE类似，DELETE语句也可以一次删除多条记录：\n1 2 3 DELETE FROM students WHERE id\u003e=5 AND id\u003c=7; -- 查询并观察结果: SELECT * FROM students; 如果WHERE条件没有匹配到任何记录，DELETE语句不会报错，也不会有任何记录被删除。例如：\n1 2 3 DELETE FROM students WHERE id=999; -- 查询并观察结果: SELECT * FROM students; 最后，要特别小心的是，和UPDATE类似，不带WHERE条件的DELETE语句会删除整个表的数据：\n1 DELETE FROM students; 这时，整个表的所有记录都会被删除。所以，在执行DELETE语句时也要非常小心，最好先用SELECT语句来测试WHERE条件是否筛选出了期望的记录集，然后再用DELETE删除。\nMySQL 在使用MySQL这类真正的关系数据库时，DELETE语句也会返回删除的行数以及WHERE条件匹配的行数。\n例如，分别执行删除id=1和id=999的记录：\n1 2 3 4 5 mysql\u003e DELETE FROM students WHERE id=1; Query OK, 1 row affected (0.01 sec) mysql\u003e DELETE FROM students WHERE id=999; Query OK, 0 rows affected (0.01 sec) 小结 使用DELETE，我们就可以一次删除表中的一条或多条记录。\n管理mysql 因此，MySQL提供了大量的SQL语句用于管理。虽然可以使用MySQL Workbench图形界面来直接管理MySQL，但是，很多时候，通过SSH远程连接时，只能使用SQL命令，所以，了解并掌握常用的SQL管理操作是必须的。\n数据库 在一个运行MySQL的服务器上，实际上可以创建多个数据库（Database）。要列出所有数据库，使用命令：\n1 2 3 4 5 6 7 8 9 10 11 12 mysql\u003e SHOW DATABASES; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | shici | | sys | | test | | school | +--------------------+ 其中，information_schema、mysql、performance_schema和sys是系统库，不要去改动它们。其他的是用户创建的数据库。\n注意：在MySQL命令行客户端输入SQL后，记得加一个;表示SQL语句结束，再回车就可以执行该SQL语句。虽然有些SQL命令不需要;也能执行，但类似SELECT等语句不加;会让MySQL客户端换行后继续等待输入。如果在图形界面或程序开发中集成SQL则不需要加;。\n要创建一个新数据库，使用命令：\n1 2 mysql\u003e CREATE DATABASE test; Query OK, 1 row affected (0.01 sec) 要删除一个数据库，使用命令：\n1 2 mysql\u003e DROP DATABASE test; Query OK, 0 rows affected (0.01 sec) 注意：删除一个数据库将导致该数据库的所有表全部被删除。\n对一个数据库进行操作时，要首先将其切换为当前数据库：\n1 2 mysql\u003e USE test; Database changed 表 列出当前数据库的所有表，使用命令：\n1 2 3 4 5 6 7 8 9 mysql\u003e SHOW TABLES; +---------------------+ | Tables_in_test | +---------------------+ | classes | | statistics | | students | | students_of_class1 | +---------------------+ 要查看一个表的结构，使用命令：\n1 2 3 4 5 6 7 8 9 10 11 mysql\u003e DESC students; +----------+--------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +----------+--------------+------+-----+---------+----------------+ | id | bigint(20) | NO | PRI | NULL | auto_increment | | class_id | bigint(20) | NO | | NULL | | | name | varchar(100) | NO | | NULL | | | gender | varchar(1) | NO | | NULL | | | score | int(11) | NO | | NULL | | +----------+--------------+------+-----+---------+----------------+ 5 rows in set (0.00 sec) 还可以使用以下命令查看创建表的SQL语句：\n1 2 3 4 5 6 7 8 9 10 11 12 mysql\u003e SHOW CREATE TABLE students; +----------+-------------------------------------------------------+ | students | CREATE TABLE `students` ( | | | `id` bigint(20) NOT NULL AUTO_INCREMENT, | | | `class_id` bigint(20) NOT NULL, | | | `name` varchar(100) NOT NULL, | | | `gender` varchar(1) NOT NULL, | | | `score` int(11) NOT NULL, | | | PRIMARY KEY (`id`) | | | ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 | +----------+-------------------------------------------------------+ 1 row in set (0.00 sec) 创建表使用CREATE TABLE语句，而删除表使用DROP TABLE语句：\n1 2 mysql\u003e DROP TABLE students; Query OK, 0 rows affected (0.01 sec) 修改表就比较复杂。如果要给students表新增一列birth，使用：\n1 ALTER TABLE students ADD COLUMN birth VARCHAR(10) NOT NULL; 要修改birth列，例如把列名改为birthday，类型改为VARCHAR(20)：\n1 ALTER TABLE students CHANGE COLUMN birth birthday VARCHAR(20) NOT NULL; 要删除列，使用：\n1 ALTER TABLE students DROP COLUMN birthday; 退出MySQL 使用EXIT命令退出MySQL：\n1 2 mysql\u003e EXIT Bye 注意EXIT仅仅断开了客户端和服务器的连接，MySQL服务器仍然继续运行。\n实用SQL语句 在编写SQL时，灵活运用一些技巧，可以大大简化程序逻辑。\n插入或替换 如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就先删除原记录，再插入新记录。此时，可以使用REPLACE语句，这样就不必先查询，再决定是否先删除再插入：\n1 REPLACE INTO students (id, class_id, name, gender, score) VALUES (1, 1, '小明', 'F', 99); 若id=1的记录不存在，REPLACE语句将插入新记录，否则，当前id=1的记录将被删除，然后再插入新记录。\n插入或更新 如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就更新该记录，此时，可以使用INSERT INTO ... ON DUPLICATE KEY UPDATE ...语句：\n1 INSERT INTO students (id, class_id, name, gender, score) VALUES (1, 1, '小明', 'F', 99) ON DUPLICATE KEY UPDATE name='小明', gender='F', score=99; 若id=1的记录不存在，INSERT语句将插入新记录，否则，当前id=1的记录将被更新，更新的字段由UPDATE指定。\n插入或忽略 如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就啥事也不干直接忽略，此时，可以使用INSERT IGNORE INTO ...语句：\n1 INSERT IGNORE INTO students (id, class_id, name, gender, score) VALUES (1, 1, '小明', 'F', 99); 若id=1的记录不存在，INSERT语句将插入新记录，否则，不执行任何操作。\n快照 如果想要对一个表进行快照，即复制一份当前表的数据到一个新表，可以结合CREATE TABLE和SELECT：\n1 2 -- 对class_id=1的记录进行快照，并存储为新表students_of_class1: CREATE TABLE students_of_class1 SELECT * FROM students WHERE class_id=1; 新创建的表结构和SELECT使用的表结构完全一致。\n写入查询结果集 如果查询结果集需要写入到表中，可以结合INSERT和SELECT，将SELECT语句的结果集直接插入到指定表中。\n例如，创建一个统计成绩的表statistics，记录各班的平均成绩：\n1 2 3 4 5 6 CREATE TABLE statistics ( id BIGINT NOT NULL AUTO_INCREMENT, class_id BIGINT NOT NULL, average DOUBLE NOT NULL, PRIMARY KEY (id) ); 然后，我们就可以用一条语句写入各班的平均成绩：\n1 INSERT INTO statistics (class_id, average) SELECT class_id, AVG(score) FROM students GROUP BY class_id; 确保INSERT语句的列和SELECT语句的列能一一对应，就可以在statistics表中直接保存查询的结果：\n1 2 3 4 5 6 7 8 9 \u003e SELECT * FROM statistics; +----+----------+--------------+ | id | class_id | average | +----+----------+--------------+ | 1 | 1 | 86.5 | | 2 | 2 | 73.666666666 | | 3 | 3 | 88.333333333 | +----+----------+--------------+ 3 rows in set (0.00 sec) 强制使用指定索引 在查询的时候，数据库系统会自动分析查询语句，并选择一个最合适的索引。但是很多时候，数据库系统的查询优化器并不一定总是能使用最优索引。如果我们知道如何选择索引，可以使用FORCE INDEX强制查询使用指定的索引。例如：\n1 \u003e SELECT * FROM students FORCE INDEX (idx_class_id) WHERE class_id = 1 ORDER BY id DESC; 指定索引的前提是索引idx_class_id必须存在。\n事务 在执行SQL语句的时候，某些业务要求，一系列操作必须全部执行，而不能仅执行一部分。例如，一个转账操作：\n1 2 3 4 5 -- 从id=1的账户给id=2的账户转账100元 -- 第一步：将id=1的A账户余额减去100 UPDATE accounts SET balance = balance - 100 WHERE id = 1; -- 第二步：将id=2的B账户余额加上100 UPDATE accounts SET balance = balance + 100 WHERE id = 2; 这两条SQL语句必须全部执行，或者，由于某些原因，如果第一条语句成功，第二条语句失败，就必须全部撤销。\n这种把多条语句作为一个整体进行操作的功能，被称为数据库事务。数据库事务可以确保该事务范围内的所有操作都可以全部成功或者全部失败。如果事务失败，那么效果就和没有执行这些SQL一样，不会对数据库数据有任何改动。\n可见，数据库事务具有ACID这4个特性：\nA：Atomic：表示组成一个事务的多个数据库操作是一个不可分割的原子单元，只有所有的操作执行成功，整个事务才提交。事务中的任何一个数据库操作失败，已经执行的任何操作都必须被撤销，让数据库返回初始状态。\nC：Consistent：一致性，事务完成后，所有数据的状态都是一致的，即A账户只要减去了100，B账户则必定加上了100；\nI：Isolation：在并发数据操作时，不同的事务拥有各自的数据空间，他们的操作不会对对方产生干扰。准确地说，并非要求做到完全无干扰。数据库规定了多种事务隔离界别，不同的隔离级别对应不用的干扰程度，隔离级别越高，数据一致性越好，但并发性越弱。\nD：Duration：一旦事务提交成功后，事务中操作的所有数据都必须被持久化到数据库中。即使在事务提交后，数据库马上崩溃，在数据库重启时，也必须保证能够通过某种机制恢复数据。\n在这些事务特性中，数据一致性是最终目标，其他特性都是为达到这个目标而采取的措施、要求或手段。\n对于单条SQL语句，数据库系统自动将其作为一个事务执行，这种事务被称为隐式事务。\n要手动把多条SQL语句作为一个事务执行，使用BEGIN开启一个事务，使用COMMIT提交一个事务，这种事务被称为显式事务，例如，把上述的转账操作作为一个显式事务：\n1 2 3 4 BEGIN; UPDATE accounts SET balance = balance - 100 WHERE id = 1; UPDATE accounts SET balance = balance + 100 WHERE id = 2; COMMIT; 很显然多条SQL语句要想作为一个事务执行，就必须使用显式事务。\nCOMMIT是指提交事务，即试图把事务内的所有SQL所做的修改永久保存。如果COMMIT语句执行失败了，整个事务也会失败。\n有些时候，我们希望主动让事务失败，这时，可以用ROLLBACK回滚事务，整个事务会失败：\n1 2 3 4 BEGIN; UPDATE accounts SET balance = balance - 100 WHERE id = 1; UPDATE accounts SET balance = balance + 100 WHERE id = 2; ROLLBACK; 数据库事务是由数据库系统保证的，我们只需要根据业务逻辑使用它就可以。\n隔离级别 对于两个并发执行的事务，如果涉及到操作同一条记录的时候，可能会发生问题。因为并发操作会带来数据的不一致性，包括脏读、不可重复读、幻读等。数据库系统提供了隔离级别来让我们有针对性地选择事务的隔离级别，避免数据不一致的问题。\nSQL标准定义了4种隔离级别，分别对应可能出现的数据不一致的情况：\nIsolation Level 脏读（Dirty Read） 不可重复读（Non Repeatable Read） 幻读（Phantom Read） Read Uncommitted Yes Yes Yes Read Committed - Yes Yes Repeatable Read - - Yes Serializable - - - 我们会依次介绍4种隔离级别的数据一致性问题。\nRead Uncommitted Read Uncommitted是隔离级别最低的一种事务级别。在这种隔离级别下，一个事务会读到另一个事务更新后但未提交的数据，如果另一个事务回滚，那么当前事务读到的数据就是脏数据，这就是脏读（Dirty Read）。\n我们来看一个例子。\n首先，我们准备好students表的数据，该表仅一行记录：\n1 2 3 4 5 6 7 mysql\u003e select * from students; +----+-------+ | id | name | +----+-------+ | 1 | Alice | +----+-------+ 1 row in set (0.00 sec) 然后，分别开启两个MySQL客户端连接，按顺序依次执行事务A和事务B：\n时刻 事务A 事务B 1 SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; 2 BEGIN; BEGIN; 3 UPDATE students SET name = ‘Bob’ WHERE id = 1; 4 SELECT * FROM students WHERE id = 1; 5 ROLLBACK; 6 SELECT * FROM students WHERE id = 1; 7 COMMIT; 当事务A执行完第3步时，它更新了id=1的记录，但并未提交，而事务B在第4步读取到的数据就是未提交的数据。\n随后，事务A在第5步进行了回滚，事务B再次读取id=1的记录，发现和上一次读取到的数据不一致，这就是脏读。\n可见，在Read Uncommitted隔离级别下，一个事务可能读取到另一个事务更新但未提交的数据，这个数据有可能是脏数据。\nRead Committed 在Read Committed隔离级别下，一个事务可能会遇到不可重复读（Non Repeatable Read）的问题。\n不可重复读是指，在一个事务内，多次读同一数据，在这个事务还没有结束时，如果另一个事务恰好修改了这个数据，那么，在第一个事务中，两次读取的数据就可能不一致。\n我们仍然先准备好students表的数据：\n1 2 3 4 5 6 7 mysql\u003e select * from students; +----+-------+ | id | name | +----+-------+ | 1 | Alice | +----+-------+ 1 row in set (0.00 sec) 然后，分别开启两个MySQL客户端连接，按顺序依次执行事务A和事务B：\n时刻 事务A 事务B 1 SET TRANSACTION ISOLATION LEVEL READ COMMITTED; SET TRANSACTION ISOLATION LEVEL READ COMMITTED; 2 BEGIN; BEGIN; 3 SELECT * FROM students WHERE id = 1; – Alice 4 UPDATE students SET name = ‘Bob’ WHERE id = 1; 5 COMMIT; 6 SELECT * FROM students WHERE id = 1; – Bob 7 COMMIT; 当事务B第一次执行第3步的查询时，得到的结果是Alice，随后，由于事务A在第4步更新了这条记录并提交，所以，事务B在第6步再次执行同样的查询时，得到的结果就变成了Bob，因此，在Read Committed隔离级别下，事务不可重复读同一条记录，因为很可能读到的结果不一致。\nRepeatable Read 在Repeatable Read隔离级别下，一个事务可能会遇到幻读（Phantom Read）的问题。\n幻读是指，在一个事务中，第一次查询某条记录，发现没有，但是，当试图更新这条不存在的记录时，竟然能成功，并且，再次读取同一条记录，它就神奇地出现了。\n我们仍然先准备好students表的数据：\n1 2 3 4 5 6 7 mysql\u003e select * from students; +----+-------+ | id | name | +----+-------+ | 1 | Alice | +----+-------+ 1 row in set (0.00 sec) 然后，分别开启两个MySQL客户端连接，按顺序依次执行事务A和事务B：\n时刻 事务A 事务B 1 SET TRANSACTION ISOLATION LEVEL REPEATABLE READ; SET TRANSACTION ISOLATION LEVEL REPEATABLE READ; 2 BEGIN; BEGIN; 3 SELECT * FROM students WHERE id = 99; – empty 4 INSERT INTO students (id, name) VALUES (99, ‘Bob’); 5 COMMIT; 6 SELECT * FROM students WHERE id = 99; – empty 7 UPDATE students SET name = ‘Alice’ WHERE id = 99; – 1 row affected 8 SELECT * FROM students WHERE id = 99; – Alice 9 COMMIT; 事务B在第3步第一次读取id=99的记录时，读到的记录为空，说明不存在id=99的记录。随后，事务A在第4步插入了一条id=99的记录并提交。事务B在第6步再次读取id=99的记录时，读到的记录仍然为空，但是，事务B在第7步试图更新这条不存在的记录时，竟然成功了，并且，事务B在第8步再次读取id=99的记录时，记录出现了。\n可见，幻读就是没有读到的记录，以为不存在，但其实是可以更新成功的，并且，更新成功后，再次读取，就出现了。\nSerializable Serializable是最严格的隔离级别。在Serializable隔离级别下，所有事务按照次序依次执行，因此，脏读、不可重复读、幻读都不会出现。\n虽然Serializable隔离级别下的事务具有最高的安全性，但是，由于事务是串行执行，所以效率会大大下降，应用程序的性能会急剧降低。如果没有特别重要的情景，一般都不会使用Serializable隔离级别。\n默认隔离级别 如果没有指定隔离级别，数据库就会使用默认的隔离级别。在MySQL中，如果使用InnoDB，默认的隔离级别是Repeatable Read。\n=======分割线======= 增删改查 1 2 3 4 5 增： insert into 表名字(列名1，列名2...) values(值1，值2...) 或： insert into 表名字 values(值1，值2...) 若不指定列名，则需要插入全部字段。 1 2 3 删： delete from 表名字 where id = 1 若不加where条件，则删除数据表中所有数据 1 2 3 改： update 表名字 set 列1=值1，列2=值2... where id = 1 若不加where条件，则更新数据表中所有数据 1 2 3 4 5 查： select * from 表名字 星号代表查询数据表中所有字段 select id,stu_name,age, from 表名字 查询多个字段，用逗号进行分割 数据类型 MySQL 支持多种类型，大致可以分为三类：数值、日期/时间和字符串(字符)类型。\n数值类型 MySQL 支持所有标准 SQL 数值数据类型。\n这些类型包括严格数值数据类型(INTEGER、SMALLINT、DECIMAL 和 NUMERIC)，以及近似数值数据类型(FLOAT、REAL 和 DOUBLE PRECISION)。\n关键字INT是INTEGER的同义词，关键字DEC是DECIMAL的同义词。\nBIT数据类型保存位字段值，并且支持 MyISAM、MEMORY、InnoDB 和 BDB表。\n作为 SQL 标准的扩展，MySQL 也支持整数类型 TINYINT、MEDIUMINT 和 BIGINT。下面的表显示了需要的每个整数类型的存储和范围。\n类型 大小 范围（有符号） 范围（无符号） 用途 TINYINT 1 Bytes (-128，127) (0，255) 小整数值 SMALLINT 2 Bytes (-32 768，32 767) (0，65 535) 大整数值 MEDIUMINT 3 Bytes (-8 388 608，8 388 607) (0，16 777 215) 大整数值 INT或INTEGER 4 Bytes (-2 147 483 648，2 147 483 647) (0，4 294 967 295) 大整数值 BIGINT 8 Bytes (-9,223,372,036,854,775,808，9 223 372 036 854 775 807) (0，18 446 744 073 709 551 615) 极大整数值 FLOAT 4 Bytes (-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38) 0，(1.175 494 351 E-38，3.402 823 466 E+38) 单精度浮点数值 DOUBLE 8 Bytes (-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) 0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) 双精度浮点数值 DECIMAL 对DECIMAL(M,D) ，如果M\u003eD，为M+2否则为D+2 依赖于M和D的值 依赖于M和D的值 小数值 日期和时间类型 表示时间值的日期和时间类型为DATETIME、DATE、TIMESTAMP、TIME和YEAR。\n每个时间类型有一个有效值范围和一个\"零\"值，当指定不合法的MySQL不能表示的值时使用\"零\"值。\nTIMESTAMP类型有专有的自动更新特性，将在后面描述。\n类型 大小( bytes) 范围 格式 用途 DATE 3 1000-01-01/9999-12-31 YYYY-MM-DD 日期值 TIME 3 ‘-838:59:59’/‘838:59:59’ HH:MM:SS 时间值或持续时间 YEAR 1 1901/2155 YYYY 年份值 DATETIME 8 ‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’ YYYY-MM-DD hh:mm:ss 混合日期和时间值 TIMESTAMP 4 ‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-19 03:14:07’ UTC 结束时间是第 2147483647 秒，北京时间 2038-1-19 11:14:07，格林尼治时间 2038年1月19日 凌晨 03:14:07 YYYY-MM-DD hh:mm:ss 混合日期和时间值，时间戳 字符串类型 字符串类型指CHAR、VARCHAR、BINARY、VARBINARY、BLOB、TEXT、ENUM和SET。该节描述了这些类型如何工作以及如何在查询中使用这些类型。\n类型 大小 用途 CHAR 0-255 bytes 定长字符串 VARCHAR 0-65535 bytes 变长字符串 TINYBLOB 0-255 bytes 不超过 255 个字符的二进制字符串 TINYTEXT 0-255 bytes 短文本字符串 BLOB 0-65 535 bytes 二进制形式的长文本数据 TEXT 0-65 535 bytes 长文本数据 MEDIUMBLOB 0-16 777 215 bytes 二进制形式的中等长度文本数据 MEDIUMTEXT 0-16 777 215 bytes 中等长度文本数据 LONGBLOB 0-4 294 967 295 bytes 二进制形式的极大文本数据 LONGTEXT 0-4 294 967 295 bytes 极大文本数据 注意：char(n) 和 varchar(n) 中括号中 n 代表字符的个数，并不代表字节个数，比如 CHAR(30) 就可以存储 30 个字符。\nCHAR 和 VARCHAR 类型类似，但它们保存和检索的方式不同。它们的最大长度和是否尾部空格被保留等方面也不同。在存储或检索过程中不进行大小写转换。\nBINARY 和 VARBINARY 类似于 CHAR 和 VARCHAR，不同的是它们包含二进制字符串而不要非二进制字符串。也就是说，它们包含字节字符串而不是字符字符串。这说明它们没有字符集，并且排序和比较基于列值字节的数值值。\nBLOB 是一个二进制大对象，可以容纳可变数量的数据。有 4 种 BLOB 类型：TINYBLOB、BLOB、MEDIUMBLOB 和 LONGBLOB。它们区别在于可容纳存储范围不同。\n有 4 种 TEXT 类型：TINYTEXT、TEXT、MEDIUMTEXT 和 LONGTEXT。对应的这 4 种 BLOB 类型，可存储的最大长度不同，可根据实际情况选择。\n表相关 创建数据表: 1 2 3 4 create table[if not exists] table_name( 列名 类型 是否为空 列名 类型 是否为空 ) 示例：\n1 2 3 4 5 6 7 8 CREATE TABLE `grade` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `grade_name` varchar(10) DEFAULT NULL COMMENT '年级名字', `create_time` int(11) DEFAULT NULL COMMENT '创建时间', `version` int(11) DEFAULT '1' COMMENT '版本号', `sort` int(11) DEFAULT NULL COMMENT '排序', PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='年级表'; 字段参数说明： id int(11) NOT NULL AUTO_INCREMENT id：字段名称 int(11)：字段类型及长度 DEFAULT NULL：默认为空，不可空是not null AUTO_INCREMENT：自动递增，一般此属性只应用在主键上 COMMENT：字段说明\n修改数据表 1 2 3 4 5 6 ALTER TABLE \u003c表名\u003e [ALTER COLUMN \u003c列名\u003e \u003c新数据类型\u003e] |[ADD \u003c列名\u003e \u003c数据类型\u003e [属性] |[DROP COLUMN \u003c列名\u003e] |[ADD [constraint] [约束名] 约束定义 |[DROP [constraint] 约束名] 删除表 DROP TABLE [if exists] table_name\n显示表的数据结构 desc table_name\n查看数据库中所有的表 show tables\n新增字段 alter table table_name add column_name varchar(200) not null default 0 COMMENT \"描述\";\n修改字段属性 alter table table_name modify column_name VARCHAR(200) NULL DEFAULT null COMMENT '这是字段描述';\n修改字段名 alter table \u003c表名\u003e change \u003c字段名\u003e \u003c字段新名称\u003e \u003c字段的类型\u003e\n删除字段 ALTER TABLE 表名 DROP 列名\n复制表 结构、数据都复制： CREATE TABLE 新表名 SELECT * FROM 旧表名 仅结构 CREATE TABLE 新表名 LIKE 旧表名\nA表数据导入B表： INSERT INTO 表名 SELECT * FROM 有数据的表\n仅复制表结构 create table my_table_copy2 like my_table;\n复制表结构和数据 create table my_table_copy1 select * from my_table; 注意：该语句只是按select语句执行的结果新建表，并不会复制表的主键、索引等信息。\n完全复制表 create table my_table_copy2 like my_table; insert into my_table_copy2 select * from my_table;\n复制表，同时重新定义字段名 create table my_table_copy3 select id,username yhm,realname xm,email dzyj,address dz from my_table;\n复制表，同时定义字段信息 create table my_table_copy4 (id INTEGER not null auto_increment PRIMARY KEY) select * from my_table;\n检查数据表是否存在 SELECT table_name FROM information_schema.tables WHERE table_name=#{tableName, jdbcType=VARCHAR}\n检查表字段是否存在 SELECT column_name FROM information_schema.columns WHERE table_name=#{tableName, jdbcType=VARCHAR} AND column_name=#{columnName, jdbcType=VARCHAR}\n创建索引 添加PRIMARY KEY(主键索引) alter table table_name add primary key(column); 添加UNIQUE(唯一索引) alter table table_name add unique(column); 添加普通索引 alter table table_name add index index_name(column); 添加全文索引 alter table table_name add fulltext(column); 添加多列索引 alter table table_name add index index_name(column1,column2,column3);\n主外键 主键：primary_key\n保证数据唯一性 一个数据表只能有一个主键 主键不可以为空，并且不可以重复 外键：foreign key\n保证数据的完整性，一致性 外键列和参照列的数据类型必须一致 参照列的表为父表，外键列的表为子表 实现一对多，多对一的关系 外键列和参照列必须创建索引，如不创建，mySQL会自动创建 1 2 3 4 5 create table test( id int primary_key auto_increment, foreign key(test1_id) references test2(id) //外键列为test1_id(当前表的列),参照了test2表的id列 ) 尽量不要使用外键，我们一般人为的人为表与表之间是相关联的。如： 班级表class为主表，在学生表student中加入class_id字段，表示班级id，这样就人为的认为student为class的字表，两张表就关联起来了。使用外键在删除表或修改表结构时，会造成很大麻烦。\nwhere条件 可以跟在select、update、delete后 多个where条件，并且的关系，用and链接，或者的关系，用or链接 group by：把查询结构进行分组，分组结果可以升序(asc)或降序(desc)，默认升序，用于去重 having：如果要将group by的结果进行删选，需要用到having关键字，不可以用where order by：把查询结果进行排序，可升(asc)可降(desc)，默认升序，可以进行多次排序，用逗号分割排序字段，越靠前，优先级越高 limit：限制查询返回的结果(用于分页功能)是select语句的最后一个关键字 参数1：从第几条结果开始获取 参数2：获取几条结果 只写一个参数：获取几条结果 select语句结构：\n1 2 3 4 5 6 7 select * from table_name join table_name_b on ... where gruop by having order by limit 关键字顺序不可以颠倒\nwhere条件参数介绍 以下参数必须跟在where关键字后面，作为where的修饰 =：相等 \u003e=：大于等于 \u003c=：小于等于 is [not] null：为null(不为null) [not] like：模糊查询 [not] between ... and ..：(不包含)包含在范围内 [not] in：包含在指定范围值内\nnull 使用NULL条件检索时不能使用=号，必须使用is：is null，不能是= null\nlike(模糊查询) select * from student where stu_name like '%小%'; %表示可随意替换 小%表示必须以小开头，后边随意 %小表示必须以小结尾，前边随意 %小%表示前后都随意，中间包含小\n[not]between … and … 范围获取值： select * from user where id between 1 and 15 ; 属于where关键字，可用大于号和小于号来实现相同的功能\n[not]in 判断一个字段的值是否与括号内的值相同，括号内是or的关系，即满足任何一个条件，都会显示出来 select * from user where id in(1,2,3) ;\n字符函数 concat(str1,str2,...)：拼接字符串 length(str)：字符串长度 lower(str)：字符串转小写 upper(str)：字符串转大写 trim(str)：去除字符串前后的空格 right(str,1)：右侧开始截取，参数2位截取几位 left(str,1)：左侧开始截取字符串，参数2为截取几位 replace(参数1，参数2，参数3):：1.要处理的字符串2.要替换的字符3.替换成什么 substring(参数1，参数2，参数3)：1.要截取的字符串2.从第几位开始截取3.截取的长度 locate(字符,字段名) 使用locate(字符,字段名)函数，如果包含，返回\u003e0的数，否则返回0 select * from 表名 where position(字符 in 字段);\n例子：判断site表中的url是否包含’http://‘子串,如果不包含则拼接在url字符串开头 update site set url =concat('http://',url) where locate('http://',url)=0\nreplace具备替换拥有唯一索引或者主键索引重复数据的能力，也就是如果使用replace into插入的数据的唯一索引或者主键索引与之前的数据有重复的情况，将会删除原先的数据，然后再进行添加。 replace into函数： REPLACE INTO users (id,name,age) VALUES(123, ‘chao’, 50);\n问题： 已知一个数字字段，内容不规律，最长有10位，最短有4位， 想把不够10位的全部在前边用0补齐，怎么办?\nSQL： update 表名字 set num = right(concat('000000',num),10); 解：因为最短有4位，在每个字符串左侧都拼接6个0，然后从右侧开始截取10个字符\n聚合函数 聚合函数就是：对一组值执行计算并返回单一的值。 一列的和：select sum(列名) from 表名 where ...条件 一列的最大值：select max(列名) from 表名 where ...条件 一列的最小值：select min(列名) from 表名 where ...条件 一列的数量：select count(列名/一般都用id) from 表名 where ...条件 一列的平均值：select avg(列名) from 表名 where ...条件 使用AVG聚合函数时，保留两位小数： CAST(AVG(time) AS DECIMAL(10,2)) as time\n数值函数 ceil()：向上取整 floor()：向下取整 round()：四舍五入 power()：幂运算\n日期时间函数 now()：当前时间(年月日-时分秒) curdate()：当前日期(年月日) curtime()：当前时间(时分秒) unix_timestamp()：当前时间戳，如：1557729824，一共十位数，精确到秒，精确到毫秒需要十三位 unix_timestamp(now())：带参数，可以是一个DATE字符串，一个DATETIME字符串，一个TIMESTAMP或者一个当地时间的YYMMDD或YYYYMMDD格式的数字，表示自'1970-01-01 00:00:00’与指定时间的秒数差\ndate_add()：日期加减算法 参数1：要进行运算的日期 参数2：加或减的量 参数3：加或减的日期单位(小时，天，周，月，年)\ndatediff()：日期差值计算 参数1：日期类型 参数2：日期类型\ndate_format()：日期格式化 将指定日期，安装指定规则进行格式化(具体请百度该函数) date_format('2017-1-1','%y/%m/%d/')---\u003e2017/1/1 注：该函数会导致索引失效\n加密函数 1 2 3 4 5 6 7 8 9 10 11 12 13 14 AES_ENCRYPT(value,key) 加密方法：value为需要加密的明文，当然也可以是表中某一列的名称，key为加密使用的密钥。 AES_DECRYPT(value,key) 解密方法：value为需要解密的密文，可以为解密的密钥。 使用示例： SELECT AES_ENCRYPT('张三','qwe123'),to_base64(aes_encrypt('张三','qwe123')); SELECT AES_DECRYPT(from_base64('EJeQE9hPLWe3tX5jlzZX8A=='),'qwe123'); 注意：mysql和java的Aes加密结果不一致的问题。 mysql默认使用的128位，加密方法为\"ECB\"，填充方法为\"PKCS7\"； java默认使用的是128位，加密方式为\"ECB\"，填充方法为\"PKCS5\"； 因此导致结果不一致。 case when 1 2 3 4 5 6 select case( when sex='0' then '女' when sex='1' then '男' end ) from 表名 case when用于查询时替换表中数据，如性别字段，里面有0和1，查询时可分别把0和1替换成女和男\n表连接 需要注意：\n查询结果在哪个表 链接哪个表 链接条件 where条件 表连接类型 cross join：交叉连接 inner join：内连接 外链接分为两种： left join：左外连接 right join：右外链接 union 和 union all：联合查询 full join：全连接 示例表1：\n1 2 3 4 5 CREATE TABLE t1 ( t1_id int(11) NOT NULL AUTO_INCREMENT, t1_str varchar(100) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8; 填充数据\n1 2 3 INSERT INTO test.t1(t1_id, t1_str) VALUES (1, '1'); INSERT INTO test.t1(t1_id, t1_str) VALUES (2, '2'); INSERT INTO test.t1(t1_id, t1_str) VALUES (3, '3'); 示例表2：\n1 2 3 4 5 CREATE TABLE t2 ( t2_id int(11) NOT NULL AUTO_INCREMENT, t2_str varchar(100) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8; 填充数据：\n1 2 INSERT INTO test.t2(id,t2_str) VALUES (2, 'a'); INSERT INTO test.t2(id,t2_str) VALUES (3, 'b'); 交叉连接 语法： select * from t1 cross join t2; 在mysql中，上述查询语句查询出的结果与如下语句相同： select * from t1,t2; 上述查询的结果：\n1 2 3 4 5 6 7 t1_id\tt1_str\tt2_id\tt2_str 1\t1\t2\ta 1\t1\t3\tb 2\t2\t2\ta 2\t2\t3\tb 3\t3\t2\ta 3\t3\t3\tb 观察数据发现： t1表的每一行记录，都与t2表中的任意一条数据关联，反之，t2表的每一行记录，都与t1表中的任意一条数据关联。 换句话说：两张表中的数据被交叉连接在了一起。 我们把上述没有任何条件的连接称为交叉连接，该连接得到的结果与线性代数中笛卡尔积一样。\n不难发现，使用交叉连接时，任意一张表中的记录多出一行，交叉连接的数量都会增长很多，而且得到的数据没有意义，所以通过交叉连接进行多表查询这种方法，应尽量避免使用。\n内连接 概念：两张表中同时符合某种条件的数据的组合。 语法： SELECT * FROM t1,t2 where t1.t1_id = t2.t2_id 另一种写法： SELECT * FROM t1 inner join t2 on t1.t1_id = t2.t2_id inner字段可以省略。\n查询结果：\n1 2 3 t1_id\tt1_str\tt2_id\tt2_str 2\t2\t2\ta 3\t3\t3\tb 上面的sql语句查询出了t1表与t2表中id号相同的记录，并把两表中id号相同的记录连接在了一起。 其中，where或on后边的语句就是\"某种条件\"，查询结果就是\"数据的组合\"，这就是内连接，官方建议使用第二种写法。\nmysql中，内连接与交叉连接的不同之处就是，内连接比交叉连接有更多的限制条件。经过试验证明(试验代码略)，无论是给内连接(inner join)去掉限制条件(where、on)，还是给交叉连接加上限制条件(where、on)，得到的结果都是一样的。 即，双方加条件结果一致，不加条件结果也一致。那么两者可以互相代替么？(待补充)\n注意：内连接只是根据条件查询出了两张表中符合条件的数据的组合，如：t1表中t1_id号为1的数据就没有被查出来。 刚才我们使用的是等值连接，限制条件通过等号相连， 那么相应的还有不等连接，即条件不是通过等号相连。如： SELECT * FROM t1 inner join t2 on t1.t1_id \u003e t2.t2_id 查询结果：\n1 2 t1_id\tt1_str\tt2_id\tt2_str 3\t3\t2\ta 应该灵活使用等值或不等值连接。\n注意：不能用交集的概念去解释内连接。 交集：同时属于集合A、B的元素所组成的集合称为交集。 但上面结果中，id号为1的数据只属于t1表，t2表中不存在。所以内连接定义为： 同时满足条件的数据的组合\n外链接：left join , right join 外链接分为两种，左外连接和右外链接。\n语法： SELECT * FROM t1 left outer join t2 on t1.t1_id = t2.t2_id\n结果如下：\n1 2 3 4 t1_id\tt1_str\tt2_id\tt2_str 2\t2\t2\ta 3\t3\t3\tb 1\t1 通过与内连接的查询结果对比，发现左外连接查出的数据更多一些，多出的一行记录由t1表中的id号为1的记录和一条\"空记录\"组成。 可是t2表中并不存在id号为1的记录啊，为什么不符合连接条件的记录也会出现在查询结果中呢？这就是左外连接的特性。\n左外连接不仅会查询出两表中同时符合条件的记录的组合，同时还会将\"left outer join\"左侧的表中的不符合条件的记录同时展示出来，由于左侧表中的这一部分记录并不符合连接条件，所以这一部分记录使用\"空记录\"进行连接。 换句话说，左外连接\"左侧的表\"中的所有记录都会被展示出来，左侧表中符合条件的记录将会与右侧表中符合条件的记录相互连接组合，左侧表中不符合条件的记录将会与右侧表中的\"空记录\"进行连接。 上述示例中的t1表就是\"left outer join\"左侧的表，t2表就是\"left outer join\"右侧的表，连接条件就是t1id=t2id，虽然t1表中id号为1的记录不满足连接条件，但是仍然会被展示出来，t2表中会使用\"空记录\"与其进行连接，表示t1表中对应的记录是不满足连接条件的记录。\n了解了左外连接，那么右外链接与之相反，右表中所有记录会被展示，右表中符合条件的记录会与左表中符合条件的记录相互连接组合，右表中不符合条件的记录会与左表中的空记录进行连接。那么在此就不对右外链接做过多说明了。 其实，左外连接一般简称为左连接，left outer join 简写为 left join，右外链接简称为右连接。简写为 right join。\n联合查询：union 和 union all 语法： select column_name(s) from table_name1 union select column_name(s) from table_name2\n结果：\n1 2 3 4 5 6 t1_id\tt1_str 1\t1 2\t2 3\t3 2\ta 3\tb 两张表的结果被集中显示到了一起。union前表的数据在前边显示，union后的后边显示。 注：使用union连接两个语句时，两个语句查询出的字段数量必须相同，否则无法使用union进行联合查询。\n使用union将两个结果集集中显示时，重复的数据会被合并为一条，如果想显示全部数据，请使用union all，这也是union和union all的唯一区别。\n全连接：full join 在sql标准中，有一种被称为\"全连接\"的多表查询方式，但是mysql并不支持全连接。 不过，我们可以变相的实现\"全连接\"，在mysql中，我们可以使用\"left join\"、“union”、“right join\"的组合实现所谓的\"全连接”。\n实现方式：\n1 2 3 SELECT * FROM t1 left join t2 on t1.t1_id = t2.t2_id union SELECT * FROM t1 right outer join t2 on t1.t1_id = t2.t2_id 结果：\n1 2 3 4 t1_id\tt1_str\tt2_id\tt2_str 2\t2\t2\ta 3\t3\t3\tb 1\t1 子查询 语法：\n1 2 select column_name from table_name where id in (select ...) 所谓子查询，就是嵌套在其他查询语句中的查询，子查询的形式有非常多，可以写在：\nselect后，作为一个列(column) where后，作为条件 等等… 一些问题 only_full_group_by mysql5.7以上的，默认的sql_mode包含ONLY_FULL_GROUP_BY。 这个属性的意思是：sql中select后面的字段必须出现在group by后面，或者被聚合函数包裹，不然会抛出上面的错误。 select name, age from user group by age 这么写就会报上面的错误。以上面的操作为例，当仅仅返回name字段的时候，MySQL是不确定到底返回哪个name，所以应该对其进行额外的操作，比如连接起来一起显示。 select group_concat(name),age from user group by age;\n官方的解释\n大致意思就是对于GROUP_BY聚合操作，如果在SELECT中的列既没有在GROUP_BY中出现，本身也不是聚合列（使用SUM，ANG等修饰的列），那么这句SQL是不合法的，因为那一列是不确定的。\n这个模式是很有意义的，对于语义限制都比较严谨的多家数据库，如SQLServer、Oracled等数据库都不支持select target list中出现语义不明确的列，这样的语句在这些数据库中是会被报错的，所以从MySQL 5.7版本开始修正了这个语义，就是所说的ONLY_FULL_GROUP_BY语义。\n关闭 only_full_group_by（不推荐） 查看sql_mode的语句如下： select @@GLOBAL.sql_mode;\n可以使用sql语句临时修改sql_mode： set @@GLOBAL.sql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'\n还需要刷新一下： flush privileges;\n但是重启mysql数据库之后，ONLY_FULL_GROUP_BY又出现了，所以需要修改mysql配置文件。通过手动添加sql_mode的方式强制指定不需要ONLY_FULL_GROUP_BY属性，my.cnf位于etc文件夹下，vim下光标移到最后，添加如下： sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION 重启后问题解决。\n删除数据 1 2 3 delete from table where id in ( select a.id from table where name like 'xxx' ) 错误：You can’t specify target table ‘xxx’ for update in FROM clause 意思是：不能先select同一个表的某些值，然后再update这个表。 解决办法：临时表\n1 2 3 4 5 delete from table where id in ( select * from( select a.id from table where name like 'xxx' )a ) tinyint mysql字段类型为tinyint，tinyint(1)会在查询的时候转换成true false，tinyint(2)以及以上是不会的。这个和mybatis没关系\nexplain关键字 explain 可以获取 select 语句的执行计划，通过 explain 我们可以知道以下信息：表的读取顺序，数据读取操作的类型，哪些索引可以使用，哪些索引实际使用了，表之间的引用，每张表有多少行被优化器查询等信息。\n在 select 语句之前增加 explain 关键字，MySQL 会在查询上设置一个标记，执行查询时，会返回执行计划的信息，而不是执行这条SQL（如果 from 中包含子查询，仍会执行该子查询，将结果放入临时表中）。\n接下来介绍 explain 中每个列的信息。\nid id相同，执行顺序从上之下； id不同，执行顺序从大到小； id相同和不同，同时存在，遵守1、2规则。\nid select_type table 1 PRIMARY A 1 PRIMARY B 2 SUBQUERY B 可以这样理解，执行顺序从大到小，先执行id为2的，然后执行id为1的（先A再B，规则1）；执行顺序为：第三行，第一行，第二行。\nid列的编号是 select 的序列号，有几个 select 就有几个id，并且id的顺序是按 select 出现的顺序增长的。MySQL将 select 查询分为简单查询和复杂查询。复杂查询分为三类：简单子查询、派生表（from语句中的子查询）、union 查询。\n简单子查询 1 2 3 4 5 6 7 mysql\u003e explain select (select 1 from actor limit 1) from film; +----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+ | 1 | PRIMARY | film | index | NULL | idx_name | 32 | NULL | 1 | Using index | | 2 | SUBQUERY | actor | index | NULL | PRIMARY | 4 | NULL | 2 | Using index | +----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+ from子句中的子查询 这个查询执行时有个临时表别名为der，外部 select 查询引用了这个临时表。\n1 2 3 4 5 6 7 mysql\u003e explain select id from (select id from film) as der; +----+-------------+------------+-------+---------------+----------+---------+------+------+-------------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +----+-------------+------------+-------+---------------+----------+---------+------+------+-------------+ | 1 | PRIMARY | | ALL | NULL | NULL | NULL | NULL | 2 | NULL | | 2 | DERIVED | film | index | NULL | idx_name | 32 | NULL | 1 | Using index | +----+-------------+------------+-------+---------------+----------+---------+------+------+-------------+ union查询 union结果总是放在一个匿名临时表中，临时表不在SQL总出现，因此它的id是NULL。\n1 2 3 4 5 6 7 8 mysql\u003e explain select 1 union all select 1; +----+--------------+------------+------+---------------+------+---------+------+------+-----------------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +----+--------------+------------+------+---------------+------+---------+------+------+-----------------+ | 1 | PRIMARY | NULL | NULL | NULL | NULL | NULL | NULL | NULL | No tables used | | 2 | UNION | NULL | NULL | NULL | NULL | NULL | NULL | NULL | No tables used | | NULL | UNION RESULT | ",
  "wordCount" : "42802",
  "inLanguage": "en",
  "datePublished": "2019-12-01T18:12:58Z",
  "dateModified": "2019-12-01T18:12:58Z",
  "author":[{
    "@type": "Person",
    "name": "Me"
  }, {
    "@type": "Person",
    "name": "You"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://funny-toffee-4aa7c3.netlify.app/posts/mysql/mysql%E5%9F%BA%E7%A1%80/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://funny-toffee-4aa7c3.netlify.app/favicon.ico"
    }
  }
}
</script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://funny-toffee-4aa7c3.netlify.app/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://funny-toffee-4aa7c3.netlify.app/">Home</a>&nbsp;»&nbsp;<a href="https://funny-toffee-4aa7c3.netlify.app/posts/">Posts</a></div>
    <h1 class="post-title">
      mysql基础
    </h1>
    <div class="post-meta"><span title='2019-12-01 18:12:58 +0000 UTC'>2019-12-01</span>&nbsp;·&nbsp;Me, You

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%85%b3%e7%b3%bb%e6%95%b0%e6%8d%ae%e5%ba%93%e6%a6%82%e8%bf%b0" aria-label="关系数据库概述">关系数据库概述</a><ul>
                        
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b" aria-label="数据模型">数据模型</a></li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b" aria-label="数据类型">数据类型</a></li>
                <li>
                    <a href="#%e4%b8%bb%e6%b5%81%e5%85%b3%e7%b3%bb%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="主流关系数据库">主流关系数据库</a></li>
                <li>
                    <a href="#sql" aria-label="SQL">SQL</a></li>
                <li>
                    <a href="#%e8%af%ad%e6%b3%95%e7%89%b9%e7%82%b9" aria-label="语法特点">语法特点</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%85%b3%e7%b3%bb%e6%a8%a1%e5%9e%8b" aria-label="关系模型">关系模型</a><ul>
                        
                <li>
                    <a href="#%e4%b8%bb%e9%94%ae" aria-label="主键">主键</a><ul>
                        
                <li>
                    <a href="#%e8%81%94%e5%90%88%e4%b8%bb%e9%94%ae" aria-label="联合主键">联合主键</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a4%96%e9%94%ae" aria-label="外键">外键</a><ul>
                        
                <li>
                    <a href="#%e5%a4%9a%e5%af%b9%e5%a4%9a" aria-label="多对多">多对多</a></li>
                <li>
                    <a href="#%e4%b8%80%e5%af%b9%e4%b8%80" aria-label="一对一">一对一</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-1" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95" aria-label="索引">索引</a><ul>
                        
                <li>
                    <a href="#%e5%94%af%e4%b8%80%e7%b4%a2%e5%bc%95" aria-label="唯一索引">唯一索引</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-2" aria-label="小结">小结</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%9f%a5%e8%af%a2%e6%95%b0%e6%8d%ae" aria-label="查询数据">查询数据</a><ul>
                        
                <li>
                    <a href="#%e5%9f%ba%e6%9c%ac%e6%9f%a5%e8%af%a2" aria-label="基本查询">基本查询</a></li>
                <li>
                    <a href="#%e6%9d%a1%e4%bb%b6%e6%9f%a5%e8%af%a2" aria-label="条件查询">条件查询</a><ul>
                        
                <li>
                    <a href="#%e5%b8%b8%e7%94%a8%e7%9a%84%e6%9d%a1%e4%bb%b6%e8%a1%a8%e8%be%be%e5%bc%8f" aria-label="常用的条件表达式">常用的条件表达式</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%8a%95%e5%bd%b1%e6%9f%a5%e8%af%a2" aria-label="投影查询">投影查询</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-3" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%8e%92%e5%ba%8f" aria-label="排序">排序</a></li>
                <li>
                    <a href="#%e5%88%86%e9%a1%b5%e6%9f%a5%e8%af%a2" aria-label="分页查询">分页查询</a><ul>
                        
                <li>
                    <a href="#%e6%b3%a8%e6%84%8f" aria-label="注意">注意</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-4" aria-label="小结">小结</a></li>
                <li>
                    <a href="#%e6%80%9d%e8%80%83" aria-label="思考">思考</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%81%9a%e5%90%88%e6%9f%a5%e8%af%a2" aria-label="聚合查询">聚合查询</a><ul>
                        
                <li>
                    <a href="#%e5%88%86%e7%bb%84" aria-label="分组">分组</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a4%9a%e8%a1%a8%e6%9f%a5%e8%af%a2" aria-label="多表查询">多表查询</a></li>
                <li>
                    <a href="#%e8%bf%9e%e6%8e%a5%e6%9f%a5%e8%af%a2" aria-label="连接查询">连接查询</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-5" aria-label="小结">小结</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9%e6%95%b0%e6%8d%ae" aria-label="修改数据">修改数据</a><ul>
                        
                <li>
                    <a href="#insert" aria-label="insert">insert</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-6" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#update" aria-label="update">update</a><ul>
                        
                <li>
                    <a href="#mysql" aria-label="MySQL">MySQL</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-7" aria-label="小结">小结</a></li></ul>
                </li>
                <li>
                    <a href="#delete" aria-label="delete">delete</a><ul>
                        
                <li>
                    <a href="#mysql-1" aria-label="MySQL">MySQL</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-8" aria-label="小结">小结</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e7%ae%a1%e7%90%86mysql" aria-label="管理mysql">管理mysql</a><ul>
                        
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="数据库">数据库</a></li>
                <li>
                    <a href="#%e8%a1%a8" aria-label="表">表</a></li>
                <li>
                    <a href="#%e9%80%80%e5%87%bamysql" aria-label="退出MySQL">退出MySQL</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%9e%e7%94%a8sql%e8%af%ad%e5%8f%a5" aria-label="实用SQL语句">实用SQL语句</a><ul>
                        
                <li>
                    <a href="#%e6%8f%92%e5%85%a5%e6%88%96%e6%9b%bf%e6%8d%a2" aria-label="插入或替换">插入或替换</a></li>
                <li>
                    <a href="#%e6%8f%92%e5%85%a5%e6%88%96%e6%9b%b4%e6%96%b0" aria-label="插入或更新">插入或更新</a></li>
                <li>
                    <a href="#%e6%8f%92%e5%85%a5%e6%88%96%e5%bf%bd%e7%95%a5" aria-label="插入或忽略">插入或忽略</a></li>
                <li>
                    <a href="#%e5%bf%ab%e7%85%a7" aria-label="快照">快照</a></li>
                <li>
                    <a href="#%e5%86%99%e5%85%a5%e6%9f%a5%e8%af%a2%e7%bb%93%e6%9e%9c%e9%9b%86" aria-label="写入查询结果集">写入查询结果集</a></li>
                <li>
                    <a href="#%e5%bc%ba%e5%88%b6%e4%bd%bf%e7%94%a8%e6%8c%87%e5%ae%9a%e7%b4%a2%e5%bc%95" aria-label="强制使用指定索引">强制使用指定索引</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%8b%e5%8a%a1" aria-label="事务">事务</a><ul>
                        
                <li>
                    <a href="#%e9%9a%94%e7%a6%bb%e7%ba%a7%e5%88%ab" aria-label="隔离级别">隔离级别</a><ul>
                        
                <li>
                    <a href="#read-uncommitted" aria-label="Read Uncommitted">Read Uncommitted</a></li>
                <li>
                    <a href="#read-committed" aria-label="Read Committed">Read Committed</a></li>
                <li>
                    <a href="#repeatable-read" aria-label="Repeatable Read">Repeatable Read</a></li>
                <li>
                    <a href="#serializable" aria-label="Serializable">Serializable</a></li>
                <li>
                    <a href="#%e9%bb%98%e8%ae%a4%e9%9a%94%e7%a6%bb%e7%ba%a7%e5%88%ab" aria-label="默认隔离级别">默认隔离级别</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%88%86%e5%89%b2%e7%ba%bf" aria-label="=======分割线=======">=======分割线=======</a></li>
                <li>
                    <a href="#%e5%a2%9e%e5%88%a0%e6%94%b9%e6%9f%a5" aria-label="增删改查">增删改查</a></li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b-1" aria-label="数据类型">数据类型</a><ul>
                        
                <li>
                    <a href="#%e6%95%b0%e5%80%bc%e7%b1%bb%e5%9e%8b" aria-label="数值类型">数值类型</a></li>
                <li>
                    <a href="#%e6%97%a5%e6%9c%9f%e5%92%8c%e6%97%b6%e9%97%b4%e7%b1%bb%e5%9e%8b" aria-label="日期和时间类型">日期和时间类型</a></li>
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2%e7%b1%bb%e5%9e%8b" aria-label="字符串类型">字符串类型</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%a1%a8%e7%9b%b8%e5%85%b3" aria-label="表相关">表相关</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e7%b4%a2%e5%bc%95" aria-label="创建索引">创建索引</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%bb%e5%a4%96%e9%94%ae" aria-label="主外键">主外键</a></li>
                <li>
                    <a href="#where%e6%9d%a1%e4%bb%b6" aria-label="where条件">where条件</a><ul>
                        
                <li>
                    <a href="#where%e6%9d%a1%e4%bb%b6%e5%8f%82%e6%95%b0%e4%bb%8b%e7%bb%8d" aria-label="where条件参数介绍">where条件参数介绍</a></li>
                <li>
                    <a href="#null" aria-label="null">null</a></li>
                <li>
                    <a href="#like%e6%a8%a1%e7%b3%8a%e6%9f%a5%e8%af%a2" aria-label="like(模糊查询)">like(模糊查询)</a></li>
                <li>
                    <a href="#notbetween--and-" aria-label="[not]between &amp;hellip; and &amp;hellip;">[not]between &hellip; and &hellip;</a></li>
                <li>
                    <a href="#notin" aria-label="[not]in">[not]in</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e5%87%bd%e6%95%b0" aria-label="字符函数">字符函数</a></li>
                <li>
                    <a href="#%e8%81%9a%e5%90%88%e5%87%bd%e6%95%b0" aria-label="聚合函数">聚合函数</a></li>
                <li>
                    <a href="#%e6%95%b0%e5%80%bc%e5%87%bd%e6%95%b0" aria-label="数值函数">数值函数</a></li>
                <li>
                    <a href="#%e6%97%a5%e6%9c%9f%e6%97%b6%e9%97%b4%e5%87%bd%e6%95%b0" aria-label="日期时间函数">日期时间函数</a></li>
                <li>
                    <a href="#%e5%8a%a0%e5%af%86%e5%87%bd%e6%95%b0" aria-label="加密函数">加密函数</a></li>
                <li>
                    <a href="#case-when" aria-label="case when">case when</a></li>
                <li>
                    <a href="#%e8%a1%a8%e8%bf%9e%e6%8e%a5" aria-label="表连接">表连接</a><ul>
                        
                <li>
                    <a href="#%e8%a1%a8%e8%bf%9e%e6%8e%a5%e7%b1%bb%e5%9e%8b" aria-label="表连接类型">表连接类型</a></li>
                <li>
                    <a href="#%e4%ba%a4%e5%8f%89%e8%bf%9e%e6%8e%a5" aria-label="交叉连接">交叉连接</a></li>
                <li>
                    <a href="#%e5%86%85%e8%bf%9e%e6%8e%a5" aria-label="内连接">内连接</a></li>
                <li>
                    <a href="#%e5%a4%96%e9%93%be%e6%8e%a5left-join--right-join" aria-label="外链接：left join , right join">外链接：left join , right join</a></li>
                <li>
                    <a href="#%e8%81%94%e5%90%88%e6%9f%a5%e8%af%a2union-%e5%92%8c-union-all" aria-label="联合查询：union 和 union all">联合查询：union 和 union all</a></li>
                <li>
                    <a href="#%e5%85%a8%e8%bf%9e%e6%8e%a5full-join" aria-label="全连接：full join">全连接：full join</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ad%90%e6%9f%a5%e8%af%a2" aria-label="子查询">子查询</a></li>
                <li>
                    <a href="#%e4%b8%80%e4%ba%9b%e9%97%ae%e9%a2%98" aria-label="一些问题">一些问题</a><ul>
                        
                <li>
                    <a href="#only_full_group_by" aria-label="only_full_group_by">only_full_group_by</a></li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae" aria-label="删除数据">删除数据</a></li>
                <li>
                    <a href="#tinyint" aria-label="tinyint">tinyint</a></li></ul>
                </li>
                <li>
                    <a href="#explain%e5%85%b3%e9%94%ae%e5%ad%97" aria-label="explain关键字">explain关键字</a><ul>
                        
                <li>
                    <a href="#id" aria-label="id">id</a><ul>
                        
                <li>
                    <a href="#%e7%ae%80%e5%8d%95%e5%ad%90%e6%9f%a5%e8%af%a2" aria-label="简单子查询">简单子查询</a></li>
                <li>
                    <a href="#from%e5%ad%90%e5%8f%a5%e4%b8%ad%e7%9a%84%e5%ad%90%e6%9f%a5%e8%af%a2" aria-label="from子句中的子查询">from子句中的子查询</a></li>
                <li>
                    <a href="#union%e6%9f%a5%e8%af%a2" aria-label="union查询">union查询</a></li></ul>
                </li>
                <li>
                    <a href="#select_type" aria-label="select_type">select_type</a><ul>
                        
                <li>
                    <a href="#simple" aria-label="SIMPLE">SIMPLE</a></li>
                <li>
                    <a href="#primary" aria-label="primary">primary</a></li>
                <li>
                    <a href="#subquery" aria-label="subquery">subquery</a></li>
                <li>
                    <a href="#derived" aria-label="derived">derived</a></li>
                <li>
                    <a href="#union" aria-label="union">union</a></li>
                <li>
                    <a href="#union-result" aria-label="union result">union result</a></li></ul>
                </li>
                <li>
                    <a href="#table" aria-label="table">table</a></li>
                <li>
                    <a href="#type" aria-label="type">type</a><ul>
                        
                <li>
                    <a href="#null-1" aria-label="null">null</a></li>
                <li>
                    <a href="#constsystem" aria-label="const、system">const、system</a></li>
                <li>
                    <a href="#eq_ref" aria-label="eq_ref">eq_ref</a></li>
                <li>
                    <a href="#ref" aria-label="ref">ref</a></li>
                <li>
                    <a href="#ref_or_null" aria-label="ref_or_null">ref_or_null</a></li>
                <li>
                    <a href="#index_merge" aria-label="index_merge">index_merge</a></li>
                <li>
                    <a href="#range" aria-label="range">range</a></li>
                <li>
                    <a href="#index" aria-label="index">index</a></li>
                <li>
                    <a href="#all" aria-label="ALL">ALL</a></li></ul>
                </li>
                <li>
                    <a href="#possible_keys" aria-label="possible_keys">possible_keys</a></li>
                <li>
                    <a href="#key" aria-label="key">key</a></li>
                <li>
                    <a href="#key_len" aria-label="key_len">key_len</a></li>
                <li>
                    <a href="#ref-1" aria-label="ref">ref</a></li>
                <li>
                    <a href="#rows" aria-label="rows">rows</a></li>
                <li>
                    <a href="#filter" aria-label="filter">filter</a></li>
                <li>
                    <a href="#extra" aria-label="extra">extra</a><ul>
                        
                <li>
                    <a href="#distinct" aria-label="distinct">distinct</a></li>
                <li>
                    <a href="#using-index" aria-label="Using index">Using index</a></li>
                <li>
                    <a href="#using-where" aria-label="Using where">Using where</a></li>
                <li>
                    <a href="#using-temporary" aria-label="Using temporary">Using temporary</a></li>
                <li>
                    <a href="#using-filesort" aria-label="Using filesort">Using filesort</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bb%a5%e4%b8%8a%e6%89%80%e6%9c%89sql%e4%bd%bf%e7%94%a8%e7%9a%84%e8%a1%a8%e5%92%8c%e6%95%b0%e6%8d%ae" aria-label="以上所有sql使用的表和数据">以上所有sql使用的表和数据</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e4%b8%89%e5%a4%a7%e8%8c%83%e5%bc%8f" aria-label="数据库三大范式">数据库三大范式</a></li>
                <li>
                    <a href="#group-by-%e7%9a%84%e7%ae%80%e5%8d%95%e4%bd%bf%e7%94%a8" aria-label="group by 的简单使用">group by 的简单使用</a><ul>
                        
                <li>
                    <a href="#%e4%b8%8eorder-by%e7%bb%93%e5%90%88" aria-label="与order by结合">与order by结合</a></li>
                <li>
                    <a href="#%e4%b8%8ehaving%e7%bb%93%e5%90%88" aria-label="与having结合">与having结合</a></li>
                <li>
                    <a href="#group-by%e4%b8%8elimit" aria-label="Group By与Limit">Group By与Limit</a></li>
                <li>
                    <a href="#group-by-%e7%bb%83%e4%b9%a0" aria-label="group by 练习">group by 练习</a></li></ul>
                </li>
                <li>
                    <a href="#show-processlist%e6%98%be%e7%a4%ba%e6%ad%a3%e5%9c%a8%e8%bf%90%e8%a1%8c%e7%9a%84%e7%ba%bf%e7%a8%8b" aria-label="show processlist：显示正在运行的线程">show processlist：显示正在运行的线程</a></li>
                <li>
                    <a href="#mysql%e8%b4%a6%e6%88%b7" aria-label="mysql账户">mysql账户</a><ul>
                        
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9%e5%af%86%e7%a0%81" aria-label="修改密码">修改密码</a></li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4%e7%94%a8%e6%88%b7" aria-label="删除用户">删除用户</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%97%b4%e9%9a%99%e9%94%81%e6%ad%bb%e9%94%81" aria-label="间隙锁死锁">间隙锁死锁</a><ul>
                        
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%98%af%e9%97%b4%e9%9a%99%e9%94%81%e6%ad%bb%e9%94%81" aria-label="为什么是间隙锁死锁？">为什么是间隙锁死锁？</a><ul>
                        
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%ad%bb%e9%94%81" aria-label="什么是死锁？">什么是死锁？</a></li>
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e9%97%b4%e9%9a%99%e9%94%81" aria-label="什么是间隙锁？">什么是间隙锁？</a></li>
                <li>
                    <a href="#mysql%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e5%bc%95%e5%85%a5%e9%97%b4%e9%9a%99%e9%94%81" aria-label="MySQL为什么要引入间隙锁？">MySQL为什么要引入间隙锁？</a></li>
                <li>
                    <a href="#%e9%97%b4%e9%9a%99%e9%94%81%e6%ad%bb%e9%94%81%e5%88%86%e6%9e%90" aria-label="间隙锁死锁分析">间隙锁死锁分析</a></li>
                <li>
                    <a href="#%e9%aa%8c%e8%af%81%e9%97%b4%e9%9a%99%e9%94%81%e6%ad%bb%e9%94%81" aria-label="验证间隙锁死锁">验证间隙锁死锁</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3" aria-label="如何解决？">如何解决？</a><ul>
                        
                <li>
                    <a href="#%e5%85%b3%e9%97%ad%e9%97%b4%e9%9a%99%e9%94%81%e4%b8%8d%e6%8e%a8%e8%8d%90" aria-label="关闭间隙锁（不推荐）">关闭间隙锁（不推荐）</a></li>
                <li>
                    <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89saveorupdate%e6%96%b9%e6%b3%95%e6%8e%a8%e8%8d%90" aria-label="自定义saveOrUpdate方法（推荐）">自定义saveOrUpdate方法（推荐）</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%8b%93%e5%b1%95" aria-label="拓展">拓展</a><ul>
                        
                <li>
                    <a href="#%e5%a6%82%e6%9e%9c%e4%b8%a4%e4%b8%aa%e4%ba%8b%e5%8a%a1%e5%90%8c%e6%97%b6%e4%bf%ae%e6%94%b9%e5%ad%98%e5%9c%a8%e7%9a%84%e8%a1%8c%e4%bc%9a%e5%8f%91%e7%94%9f%e4%bb%80%e4%b9%88" aria-label="如果两个事务同时修改存在的行会发生什么？">如果两个事务同时修改存在的行会发生什么？</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="关系数据库概述">关系数据库概述<a hidden class="anchor" aria-hidden="true" href="#关系数据库概述">#</a></h1>
<p>为什么需要数据库？</p>
<p>因为应用程序需要保存用户的数据，比如Word需要把用户文档保存起来，以便下次继续编辑或者拷贝到另一台电脑。</p>
<p>要保存用户的数据，一个最简单的方法是把用户数据写入文件。例如，要保存一个班级所有学生的信息，可以向文件中写入一个CSV文件：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>id,name,gender,score
</span></span><span style="display:flex;"><span>1,小明,M,90
</span></span><span style="display:flex;"><span>2,小红,F,95
</span></span><span style="display:flex;"><span>3,小军,M,88
</span></span><span style="display:flex;"><span>4,小丽,F,88
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果要保存学校所有班级的信息，可以写入另一个CSV文件。</p>
<p>但是，随着应用程序的功能越来越复杂，数据量越来越大，如何管理这些数据就成了大问题：</p>
<ul>
<li>读写文件并解析出数据需要大量重复代码；</li>
<li>从成千上万的数据中快速查询出指定数据需要复杂的逻辑。</li>
</ul>
<p>如果每个应用程序都各自写自己的读写数据的代码，一方面效率低，容易出错，另一方面，每个应用程序访问数据的接口都不相同，数据难以复用。</p>
<p>所以，数据库作为一种专门管理数据的软件就出现了。应用程序不需要自己管理数据，而是通过数据库软件提供的接口来读写数据。至于数据本身如何存储到文件，那是数据库软件的事情，应用程序自己并不关心：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>┌──────────────┐
</span></span><span style="display:flex;"><span>│ application  │
</span></span><span style="display:flex;"><span>└──────────────┘
</span></span><span style="display:flex;"><span>       ▲│
</span></span><span style="display:flex;"><span>       ││
</span></span><span style="display:flex;"><span>   read││write
</span></span><span style="display:flex;"><span>       ││
</span></span><span style="display:flex;"><span>       │▼
</span></span><span style="display:flex;"><span>┌──────────────┐
</span></span><span style="display:flex;"><span>│   database   │
</span></span><span style="display:flex;"><span>└──────────────┘
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样一来，编写应用程序的时候，数据读写的功能就被大大地简化了。</p>
<h2 id="数据模型">数据模型<a hidden class="anchor" aria-hidden="true" href="#数据模型">#</a></h2>
<p>数据库按照数据结构来组织、存储和管理数据，实际上，数据库一共有三种模型：</p>
<ul>
<li>层次模型</li>
<li>网状模型</li>
<li>关系模型</li>
</ul>
<p>层次模型就是以“上下级”的层次关系来组织数据的一种方式，层次模型的数据结构看起来就像一颗树：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>            ┌─────┐
</span></span><span style="display:flex;"><span>            │     │
</span></span><span style="display:flex;"><span>            └─────┘
</span></span><span style="display:flex;"><span>               │
</span></span><span style="display:flex;"><span>       ┌───────┴───────┐
</span></span><span style="display:flex;"><span>       │               │
</span></span><span style="display:flex;"><span>    ┌─────┐         ┌─────┐
</span></span><span style="display:flex;"><span>    │     │         │     │
</span></span><span style="display:flex;"><span>    └─────┘         └─────┘
</span></span><span style="display:flex;"><span>       │               │
</span></span><span style="display:flex;"><span>   ┌───┴───┐       ┌───┴───┐
</span></span><span style="display:flex;"><span>   │       │       │       │
</span></span><span style="display:flex;"><span>┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐
</span></span><span style="display:flex;"><span>│     │ │     │ │     │ │     │
</span></span><span style="display:flex;"><span>└─────┘ └─────┘ └─────┘ └─────┘
</span></span></code></pre></td></tr></table>
</div>
</div><p>网状模型把每个数据节点和其他很多节点都连接起来，它的数据结构看起来就像很多城市之间的路网：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>     ┌─────┐      ┌─────┐
</span></span><span style="display:flex;"><span>   ┌─│     │──────│     │──┐
</span></span><span style="display:flex;"><span>   │ └─────┘      └─────┘  │
</span></span><span style="display:flex;"><span>   │    │            │     │
</span></span><span style="display:flex;"><span>   │    └──────┬─────┘     │
</span></span><span style="display:flex;"><span>   │           │           │
</span></span><span style="display:flex;"><span>┌─────┐     ┌─────┐     ┌─────┐
</span></span><span style="display:flex;"><span>│     │─────│     │─────│     │
</span></span><span style="display:flex;"><span>└─────┘     └─────┘     └─────┘
</span></span><span style="display:flex;"><span>   │           │           │
</span></span><span style="display:flex;"><span>   │     ┌─────┴─────┐     │
</span></span><span style="display:flex;"><span>   │     │           │     │
</span></span><span style="display:flex;"><span>   │  ┌─────┐     ┌─────┐  │
</span></span><span style="display:flex;"><span>   └──│     │─────│     │──┘
</span></span><span style="display:flex;"><span>      └─────┘     └─────┘
</span></span></code></pre></td></tr></table>
</div>
</div><p>关系模型把数据看作是一个二维表格，任何数据都可以通过行号+列号来唯一确定，它的数据模型看起来就是一个Excel表：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>┌─────┬─────┬─────┬─────┬─────┐
</span></span><span style="display:flex;"><span>│     │     │     │     │     │
</span></span><span style="display:flex;"><span>├─────┼─────┼─────┼─────┼─────┤
</span></span><span style="display:flex;"><span>│     │     │     │     │     │
</span></span><span style="display:flex;"><span>├─────┼─────┼─────┼─────┼─────┤
</span></span><span style="display:flex;"><span>│     │     │     │     │     │
</span></span><span style="display:flex;"><span>├─────┼─────┼─────┼─────┼─────┤
</span></span><span style="display:flex;"><span>│     │     │     │     │     │
</span></span><span style="display:flex;"><span>└─────┴─────┴─────┴─────┴─────┘
</span></span></code></pre></td></tr></table>
</div>
</div><p>随着时间的推移和市场竞争，最终，基于关系模型的关系数据库获得了绝对市场份额。</p>
<p>为什么关系数据库获得了最广泛的应用？</p>
<p>因为相比层次模型和网状模型，关系模型理解和使用起来最简单。</p>
<p>关系数据库的关系模型是基于数学理论建立的。我们把域（Domain）定义为一组具有相同数据类型的值的集合，给定一组域D1,D2,&hellip;,Dn，它们的笛卡尔集定义为D1×D2×……×Dn={(d1,d2,&hellip;,dn)|di∈Di,i=1,2,&hellip;,n}， 而D1×D2×……×Dn的子集叫作在域D1,D2,&hellip;,Dn上的关系，表示为R(D1,D2,&hellip;,Dn)，这里的R表示$#%&amp;^@!&amp;$#;!~％¥%:(……算了，根本讲不明白，大家也不用理解。</p>
<p>基于数学理论的关系模型虽然讲起来挺复杂，但是，基于日常生活的关系模型却十分容易理解。我们以学校班级为例，一个班级的学生就可以用一个表格存起来，并且定义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">ID</th>
<th style="text-align:left">姓名</th>
<th style="text-align:right">班级ID</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">小明</td>
<td style="text-align:right">201</td>
<td style="text-align:right">M</td>
<td style="text-align:right">9</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">小红</td>
<td style="text-align:right">202</td>
<td style="text-align:right">F</td>
<td style="text-align:right">8</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">小军</td>
<td style="text-align:right">202</td>
<td style="text-align:right">M</td>
<td style="text-align:right">8</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">小白</td>
<td style="text-align:right">201</td>
<td style="text-align:right">F</td>
<td style="text-align:right">9</td>
</tr>
</tbody>
</table>
<p>其中，班级ID对应着另一个班级表：</p>
<table>
<thead>
<tr>
<th style="text-align:left">ID</th>
<th style="text-align:left">名称</th>
<th style="text-align:left">班主任</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">201</td>
<td style="text-align:left">二年级一班</td>
<td style="text-align:left">王老师</td>
</tr>
<tr>
<td style="text-align:left">202</td>
<td style="text-align:left">二年级二班</td>
<td style="text-align:left">李老师</td>
</tr>
</tbody>
</table>
<p>通过给定一个班级名称，可以查到一条班级记录，根据班级ID，又可以查到多条学生记录，这样，二维表之间就通过ID映射建立了“一对多”关系。</p>
<h2 id="数据类型">数据类型<a hidden class="anchor" aria-hidden="true" href="#数据类型">#</a></h2>
<p>对于一个关系表，除了定义每一列的名称外，还需要定义每一列的数据类型。关系数据库支持的标准数据类型包括数值、字符串、时间等：</p>
<table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">INT</td>
<td style="text-align:left">整型</td>
<td style="text-align:left">4字节整数类型，范围约+/-21亿</td>
</tr>
<tr>
<td style="text-align:left">BIGINT</td>
<td style="text-align:left">长整型</td>
<td style="text-align:left">8字节整数类型，范围约+/-922亿亿</td>
</tr>
<tr>
<td style="text-align:left">REAL</td>
<td style="text-align:left">浮点型</td>
<td style="text-align:left">4字节浮点数，范围约+/-1038</td>
</tr>
<tr>
<td style="text-align:left">DOUBLE</td>
<td style="text-align:left">浮点型</td>
<td style="text-align:left">8字节浮点数，范围约+/-10308</td>
</tr>
<tr>
<td style="text-align:left">DECIMAL(M,N)</td>
<td style="text-align:left">高精度小数</td>
<td style="text-align:left">由用户指定精度的小数，例如，DECIMAL(20,10)表示一共20位，其中小数10位，通常用于财务计算</td>
</tr>
<tr>
<td style="text-align:left">CHAR(N)</td>
<td style="text-align:left">定长字符串</td>
<td style="text-align:left">存储指定长度的字符串，例如，CHAR(100)总是存储100个字符的字符串</td>
</tr>
<tr>
<td style="text-align:left">VARCHAR(N)</td>
<td style="text-align:left">变长字符串</td>
<td style="text-align:left">存储可变长度的字符串，例如，VARCHAR(100)可以存储0~100个字符的字符串</td>
</tr>
<tr>
<td style="text-align:left">BOOLEAN</td>
<td style="text-align:left">布尔类型</td>
<td style="text-align:left">存储True或者False</td>
</tr>
<tr>
<td style="text-align:left">DATE</td>
<td style="text-align:left">日期类型</td>
<td style="text-align:left">存储日期，例如，2018-06-22</td>
</tr>
<tr>
<td style="text-align:left">TIME</td>
<td style="text-align:left">时间类型</td>
<td style="text-align:left">存储时间，例如，12:20:59</td>
</tr>
<tr>
<td style="text-align:left">DATETIME</td>
<td style="text-align:left">日期和时间类型</td>
<td style="text-align:left">存储日期+时间，例如，2018-06-22 12:20:59</td>
</tr>
</tbody>
</table>
<p>上面的表中列举了最常用的数据类型。很多数据类型还有别名，例如，<code>REAL</code>又可以写成<code>FLOAT(24)</code>。还有一些不常用的数据类型，例如，<code>TINYINT</code>（范围在0~255）。各数据库厂商还会支持特定的数据类型，例如<code>JSON</code>。</p>
<p>选择数据类型的时候，要根据业务规则选择合适的类型。通常来说，<code>BIGINT</code>能满足整数存储的需求，<code>VARCHAR(N)</code>能满足字符串存储的需求，这两种类型是使用最广泛的。</p>
<h2 id="主流关系数据库">主流关系数据库<a hidden class="anchor" aria-hidden="true" href="#主流关系数据库">#</a></h2>
<p>目前，主流的关系数据库主要分为以下几类：</p>
<ol>
<li>商用数据库，例如：<a href="https://www.oracle.com/">Oracle</a>，<a href="https://www.microsoft.com/sql-server/">SQL Server</a>，<a href="https://www.ibm.com/db2/">DB2</a>等；</li>
<li>开源数据库，例如：<a href="https://www.mysql.com/">MySQL</a>，<a href="https://www.postgresql.org/">PostgreSQL</a>等；</li>
<li>桌面数据库，以微软<a href="https://products.office.com/access">Access</a>为代表，适合桌面应用程序使用；</li>
<li>嵌入式数据库，以<a href="https://sqlite.org/">Sqlite</a>为代表，适合手机应用和桌面程序。</li>
</ol>
<h2 id="sql">SQL<a hidden class="anchor" aria-hidden="true" href="#sql">#</a></h2>
<p>什么是SQL？SQL是结构化查询语言的缩写，用来访问和操作数据库系统。SQL语句既可以查询数据库中的数据，也可以添加、更新和删除数据库中的数据，还可以对数据库进行管理和维护操作。不同的数据库，都支持SQL，这样，我们通过学习SQL这一种语言，就可以操作各种不同的数据库。</p>
<p>虽然SQL已经被ANSI组织定义为标准，不幸地是，各个不同的数据库对标准的SQL支持不太一致。并且，大部分数据库都在标准的SQL上做了扩展。也就是说，如果只使用标准SQL，理论上所有数据库都可以支持，但如果使用某个特定数据库的扩展SQL，换一个数据库就不能执行了。例如，Oracle把自己扩展的SQL称为<code>PL/SQL</code>，Microsoft把自己扩展的SQL称为<code>T-SQL</code>。</p>
<p>现实情况是，如果我们只使用标准SQL的核心功能，那么所有数据库通常都可以执行。不常用的SQL功能，不同的数据库支持的程度都不一样。而各个数据库支持的各自扩展的功能，通常我们把它们称之为“方言”。</p>
<p>总的来说，SQL语言定义了这么几种操作数据库的能力：</p>
<p><strong>DDL：Data Definition Language</strong></p>
<p>DDL允许用户定义数据，也就是创建表、删除表、修改表结构这些操作。通常，DDL由数据库管理员执行。</p>
<p><strong>DML：Data Manipulation Language</strong></p>
<p>DML为用户提供添加、删除、更新数据的能力，这些是应用程序对数据库的日常操作。</p>
<p><strong>DQL：Data Query Language</strong></p>
<p>DQL允许用户查询数据，这也是通常最频繁的数据库日常操作。</p>
<h2 id="语法特点">语法特点<a hidden class="anchor" aria-hidden="true" href="#语法特点">#</a></h2>
<p>SQL语言关键字不区分大小写！！！但是，针对不同的数据库，对于表名和列名，有的数据库区分大小写，有的数据库不区分大小写。同一个数据库，有的在Linux上区分大小写，有的在Windows上不区分大小写。</p>
<p>所以，这里约定：SQL关键字总是大写，以示突出，表名和列名均使用小写。</p>
<h1 id="关系模型">关系模型<a hidden class="anchor" aria-hidden="true" href="#关系模型">#</a></h1>
<p>我们已经知道，关系数据库是建立在关系模型上的。而关系模型本质上就是若干个存储数据的二维表，可以把它们看作很多Excel表。</p>
<p>表的每一行称为记录（Record），记录是一个逻辑意义上的数据。</p>
<p>表的每一列称为字段（Column），同一个表的每一行记录都拥有相同的若干字段。</p>
<p>字段定义了数据类型（整型、浮点型、字符串、日期等），以及是否允许为<code>NULL</code>。注意<code>NULL</code>表示字段数据不存在。一个整型字段如果为<code>NULL</code>不表示它的值为<code>0</code>，同样的，一个字符串型字段为<code>NULL</code>也不表示它的值为空串<code>''</code>。</p>
<p>通常情况下，字段应该避免允许为NULL。不允许为NULL可以简化查询条件，加快查询速度，也利于应用程序读取数据后无需判断是否为NULL。</p>
<p>和Excel表有所不同的是，关系数据库的表和表之间需要建立“一对多”，“多对一”和“一对一”的关系，这样才能够按照应用程序的逻辑来组织和存储数据。</p>
<p>例如，一个班级表：</p>
<table>
<thead>
<tr>
<th style="text-align:left">ID</th>
<th style="text-align:left">名称</th>
<th style="text-align:left">班主任</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">201</td>
<td style="text-align:left">二年级一班</td>
<td style="text-align:left">王老师</td>
</tr>
<tr>
<td style="text-align:left">202</td>
<td style="text-align:left">二年级二班</td>
<td style="text-align:left">李老师</td>
</tr>
</tbody>
</table>
<p>每一行对应着一个班级，而一个班级对应着多个学生，所以班级表和学生表的关系就是“一对多”：</p>
<table>
<thead>
<tr>
<th style="text-align:left">ID</th>
<th style="text-align:left">姓名</th>
<th style="text-align:right">班级ID</th>
<th style="text-align:right">性别</th>
<th style="text-align:right">年龄</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">小明</td>
<td style="text-align:right">201</td>
<td style="text-align:right">M</td>
<td style="text-align:right">9</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">小红</td>
<td style="text-align:right">202</td>
<td style="text-align:right">F</td>
<td style="text-align:right">8</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">小军</td>
<td style="text-align:right">202</td>
<td style="text-align:right">M</td>
<td style="text-align:right">8</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">小白</td>
<td style="text-align:right">201</td>
<td style="text-align:right">F</td>
<td style="text-align:right">9</td>
</tr>
</tbody>
</table>
<p>反过来，如果我们先在学生表中定位了一行记录，例如<code>ID=1</code>的小明，要确定他的班级，只需要根据他的“班级ID”对应的值<code>201</code>找到班级表中<code>ID=201</code>的记录，即二年级一班。所以，学生表和班级表是“多对一”的关系。</p>
<p>如果我们把班级表分拆得细一点，例如，单独创建一个教师表：</p>
<table>
<thead>
<tr>
<th style="text-align:left">ID</th>
<th style="text-align:left">名称</th>
<th style="text-align:left">年龄</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">A1</td>
<td style="text-align:left">王老师</td>
<td style="text-align:left">26</td>
</tr>
<tr>
<td style="text-align:left">A2</td>
<td style="text-align:left">张老师</td>
<td style="text-align:left">39</td>
</tr>
<tr>
<td style="text-align:left">A3</td>
<td style="text-align:left">李老师</td>
<td style="text-align:left">32</td>
</tr>
<tr>
<td style="text-align:left">A4</td>
<td style="text-align:left">赵老师</td>
<td style="text-align:left">27</td>
</tr>
</tbody>
</table>
<p>班级表只存储教师ID：</p>
<table>
<thead>
<tr>
<th style="text-align:left">ID</th>
<th style="text-align:left">名称</th>
<th style="text-align:left">班主任ID</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">201</td>
<td style="text-align:left">二年级一班</td>
<td style="text-align:left">A1</td>
</tr>
<tr>
<td style="text-align:left">202</td>
<td style="text-align:left">二年级二班</td>
<td style="text-align:left">A3</td>
</tr>
</tbody>
</table>
<p>这样，一个班级总是对应一个教师，班级表和教师表就是“一对一”关系。</p>
<p>在关系数据库中，关系是通过<em>主键</em>和<em>外键</em>来维护的。我们在后面会分别深入讲解。</p>
<h2 id="主键">主键<a hidden class="anchor" aria-hidden="true" href="#主键">#</a></h2>
<p>在关系数据库中，一张表中的每一行数据被称为一条记录。一条记录就是由多个字段组成的。例如，<code>students</code>表的两行记录：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">class_id</th>
<th style="text-align:left">name</th>
<th style="text-align:left">gender</th>
<th style="text-align:left">score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小明</td>
<td style="text-align:left">M</td>
<td style="text-align:left">90</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小红</td>
<td style="text-align:left">F</td>
<td style="text-align:left">95</td>
</tr>
</tbody>
</table>
<p>每一条记录都包含若干定义好的字段。同一个表的所有记录都有相同的字段定义。</p>
<p>对于关系表，有个很重要的约束，就是任意两条记录不能重复。不能重复不是指两条记录不完全相同，而是指能够通过某个字段唯一区分出不同的记录，这个字段被称为<em>主键</em>。</p>
<p>例如，假设我们把<code>name</code>字段作为主键，那么通过名字<code>小明</code>或<code>小红</code>就能唯一确定一条记录。但是，这么设定，就没法存储同名的同学了，因为插入相同主键的两条记录是不被允许的。</p>
<p>对主键的要求，最关键的一点是：记录一旦插入到表中，主键最好不要再修改，因为主键是用来唯一定位记录的，修改了主键，会造成一系列的影响。</p>
<p>由于主键的作用十分重要，如何选取主键会对业务开发产生重要影响。如果我们以学生的身份证号作为主键，似乎能唯一定位记录。然而，身份证号也是一种业务场景，如果身份证号升位了，或者需要变更，作为主键，不得不修改的时候，就会对业务产生严重影响。</p>
<p>所以，选取主键的一个基本原则是：不使用任何业务相关的字段作为主键。</p>
<p>因此，身份证号、手机号、邮箱地址这些看上去可以唯一的字段，均<em>不可</em>用作主键。</p>
<p>作为主键最好是完全业务无关的字段，我们一般把这个字段命名为<code>id</code>。常见的可作为<code>id</code>字段的类型有：</p>
<ol>
<li>自增整数类型：数据库会在插入数据时自动为每一条记录分配一个自增整数，这样我们就完全不用担心主键重复，也不用自己预先生成主键；</li>
<li>全局唯一GUID类型：使用一种全局唯一的字符串作为主键，类似<code>8f55d96b-8acc-4636-8cb8-76bf8abc2f57</code>。GUID算法通过网卡MAC地址、时间戳和随机数保证任意计算机在任意时间生成的字符串都是不同的，大部分编程语言都内置了GUID算法，可以自己预算出主键。</li>
</ol>
<p>对于大部分应用来说，通常自增类型的主键就能满足需求。我们在<code>students</code>表中定义的主键也是<code>BIGINT NOT NULL AUTO_INCREMENT</code>类型。</p>
<p>如果使用INT自增类型，那么当一张表的记录数超过2147483647（约21亿）时，会达到上限而出错。使用BIGINT自增类型则可以最多约922亿亿条记录。</p>
<h3 id="联合主键">联合主键<a hidden class="anchor" aria-hidden="true" href="#联合主键">#</a></h3>
<p>关系数据库实际上还允许通过多个字段唯一标识记录，即两个或更多的字段都设置为主键，这种主键被称为联合主键。</p>
<p>对于联合主键，允许一列有重复，只要不是所有主键列都重复即可：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id_num</th>
<th style="text-align:left">id_type</th>
<th style="text-align:left">other columns&hellip;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">A</td>
<td style="text-align:left">&hellip;</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">A</td>
<td style="text-align:left">&hellip;</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">B</td>
<td style="text-align:left">&hellip;</td>
</tr>
</tbody>
</table>
<p>如果我们把上述表的<code>id_num</code>和<code>id_type</code>这两列作为联合主键，那么上面的3条记录都是允许的，因为没有两列主键组合起来是相同的。</p>
<p>没有必要的情况下，我们尽量不使用联合主键，因为它给关系表带来了复杂度的上升。</p>
<h3 id="小结">小结<a hidden class="anchor" aria-hidden="true" href="#小结">#</a></h3>
<p>主键是关系表中记录的唯一标识。主键的选取非常重要：主键不要带有业务含义，而应该使用BIGINT自增或者GUID类型。主键也不应该允许<code>NULL</code>。</p>
<p>可以使用多个列作为联合主键，但联合主键并不常用。</p>
<h2 id="外键">外键<a hidden class="anchor" aria-hidden="true" href="#外键">#</a></h2>
<p>当我们用主键唯一标识记录时，我们就可以在<code>students</code>表中确定任意一个学生的记录：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">name</th>
<th style="text-align:left">other columns&hellip;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">小明</td>
<td style="text-align:left">&hellip;</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">小红</td>
<td style="text-align:left">&hellip;</td>
</tr>
</tbody>
</table>
<p>我们还可以在<code>classes</code>表中确定任意一个班级记录：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">name</th>
<th style="text-align:left">other columns&hellip;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">一班</td>
<td style="text-align:left">&hellip;</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">二班</td>
<td style="text-align:left">&hellip;</td>
</tr>
</tbody>
</table>
<p>但是我们如何确定<code>students</code>表的一条记录，例如，<code>id=1</code>的小明，属于哪个班级呢？</p>
<p>由于一个班级可以有多个学生，在关系模型中，这两个表的关系可以称为“一对多”，即一个<code>classes</code>的记录可以对应多个<code>students</code>表的记录。</p>
<p>为了表达这种一对多的关系，我们需要在<code>students</code>表中加入一列<code>class_id</code>，让它的值与<code>classes</code>表的某条记录相对应：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">class_id</th>
<th style="text-align:left">name</th>
<th style="text-align:left">other columns&hellip;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小明</td>
<td style="text-align:left">&hellip;</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小红</td>
<td style="text-align:left">&hellip;</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">2</td>
<td style="text-align:left">小白</td>
<td style="text-align:left">&hellip;</td>
</tr>
</tbody>
</table>
<p>这样，我们就可以根据<code>class_id</code>这个列直接定位出一个<code>students</code>表的记录应该对应到<code>classes</code>的哪条记录。</p>
<p>例如：</p>
<ul>
<li>小明的<code>class_id</code>是<code>1</code>，因此，对应的<code>classes</code>表的记录是<code>id=1</code>的一班；</li>
<li>小红的<code>class_id</code>是<code>1</code>，因此，对应的<code>classes</code>表的记录是<code>id=1</code>的一班；</li>
<li>小白的<code>class_id</code>是<code>2</code>，因此，对应的<code>classes</code>表的记录是<code>id=2</code>的二班。</li>
</ul>
<p>在<code>students</code>表中，通过<code>class_id</code>的字段，可以把数据与另一张表关联起来，这种列称为<code>外键</code>。</p>
<p>外键并不是通过列名实现的，而是通过定义外键约束实现的：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ALTER</span> <span style="color:#fff;font-weight:bold">TABLE</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ADD</span> <span style="color:#fff;font-weight:bold">CONSTRAINT</span> fk_class_id
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FOREIGN</span> <span style="color:#fff;font-weight:bold">KEY</span> (class_id)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">REFERENCES</span> classes (id);
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中，外键约束的名称<code>fk_class_id</code>可以任意，<code>FOREIGN KEY (class_id)</code>指定了<code>class_id</code>作为外键，<code>REFERENCES classes (id)</code>指定了这个外键将关联到<code>classes</code>表的<code>id</code>列（即<code>classes</code>表的主键）。</p>
<p>通过定义外键约束，关系数据库可以保证无法插入无效的数据。即如果<code>classes</code>表不存在<code>id=99</code>的记录，<code>students</code>表就无法插入<code>class_id=99</code>的记录。</p>
<p>注意：由于外键约束会降低数据库的性能，大部分互联网应用程序为了追求速度，并不设置外键约束，而是仅靠应用程序自身来保证逻辑的正确性。这种情况下，<code>class_id</code>仅仅是一个普通的列，只是它起到了外键的作用而已。</p>
<p>要删除一个外键约束，也是通过<code>ALTER TABLE</code>实现的：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ALTER</span> <span style="color:#fff;font-weight:bold">TABLE</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">DROP</span> <span style="color:#fff;font-weight:bold">FOREIGN</span> <span style="color:#fff;font-weight:bold">KEY</span> fk_class_id;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：删除外键约束并没有删除外键这一列。删除列是通过<code>DROP COLUMN ...</code>实现的。</p>
<h3 id="多对多">多对多<a hidden class="anchor" aria-hidden="true" href="#多对多">#</a></h3>
<p>通过一个表的外键关联到另一个表，我们可以定义出一对多关系。有些时候，还需要定义“多对多”关系。例如，一个老师可以对应多个班级，一个班级也可以对应多个老师，因此，班级表和老师表存在多对多关系。</p>
<p>多对多关系实际上是通过两个一对多关系实现的，即通过一个中间表，关联两个一对多关系，就形成了多对多关系：</p>
<p><code>teachers</code>表：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">name</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">张老师</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">王老师</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">李老师</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">赵老师</td>
</tr>
</tbody>
</table>
<p><code>classes</code>表：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">name</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">一班</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">二班</td>
</tr>
</tbody>
</table>
<p>中间表<code>teacher_class</code>关联两个一对多关系：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">teacher_id</th>
<th style="text-align:left">class_id</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">2</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">3</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left">4</td>
<td style="text-align:left">2</td>
</tr>
</tbody>
</table>
<p>通过中间表<code>teacher_class</code>可知<code>teachers</code>到<code>classes</code>的关系：</p>
<ul>
<li><code>id=1</code>的张老师对应<code>id=1,2</code>的一班和二班；</li>
<li><code>id=2</code>的王老师对应<code>id=1,2</code>的一班和二班；</li>
<li><code>id=3</code>的李老师对应<code>id=1</code>的一班；</li>
<li><code>id=4</code>的赵老师对应<code>id=2</code>的二班。</li>
</ul>
<p>同理可知<code>classes</code>到<code>teachers</code>的关系：</p>
<ul>
<li><code>id=1</code>的一班对应<code>id=1,2,3</code>的张老师、王老师和李老师；</li>
<li><code>id=2</code>的二班对应<code>id=1,2,4</code>的张老师、王老师和赵老师；</li>
</ul>
<p>因此，通过中间表，我们就定义了一个“多对多”关系。</p>
<h3 id="一对一">一对一<a hidden class="anchor" aria-hidden="true" href="#一对一">#</a></h3>
<p>一对一关系是指，一个表的记录对应到另一个表的唯一一条记录。</p>
<p>例如，<code>students</code>表的每个学生可以有自己的联系方式，如果把联系方式存入另一个表<code>contacts</code>，我们就可以得到一个“一对一”关系：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">student_id</th>
<th style="text-align:left">mobile</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
<td style="text-align:left">135xxxx6300</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">2</td>
<td style="text-align:left">138xxxx2209</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">139xxxx8086</td>
</tr>
</tbody>
</table>
<p>有细心的童鞋会问，既然是一对一关系，那为啥不给<code>students</code>表增加一个<code>mobile</code>列，这样就能合二为一了？</p>
<p>如果业务允许，完全可以把两个表合为一个表。但是，有些时候，如果某个学生没有手机号，那么，<code>contacts</code>表就不存在对应的记录。实际上，一对一关系准确地说，是<code>contacts</code>表一对一对应<code>students</code>表。</p>
<p>还有一些应用会把一个大表拆成两个一对一的表，目的是把经常读取和不经常读取的字段分开，以获得更高的性能。例如，把一个大的用户表分拆为用户基本信息表<code>user_info</code>和用户详细信息表<code>user_profiles</code>，大部分时候，只需要查询<code>user_info</code>表，并不需要查询<code>user_profiles</code>表，这样就提高了查询速度。</p>
<h3 id="小结-1">小结<a hidden class="anchor" aria-hidden="true" href="#小结-1">#</a></h3>
<p>关系数据库通过外键可以实现一对多、多对多和一对一的关系。外键既可以通过数据库来约束，也可以不设置约束，仅依靠应用程序的逻辑来保证。</p>
<h2 id="索引">索引<a hidden class="anchor" aria-hidden="true" href="#索引">#</a></h2>
<p>在关系数据库中，如果有上万甚至上亿条记录，在查找记录的时候，想要获得非常快的速度，就需要使用索引。</p>
<p>索引是关系数据库中对某一列或多个列的值进行预排序的数据结构。通过使用索引，可以让数据库系统不必扫描整个表，而是直接定位到符合条件的记录，这样就大大加快了查询速度。</p>
<p>例如，对于<code>students</code>表：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">class_id</th>
<th style="text-align:left">name</th>
<th style="text-align:left">gender</th>
<th style="text-align:left">score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小明</td>
<td style="text-align:left">M</td>
<td style="text-align:left">90</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小红</td>
<td style="text-align:left">F</td>
<td style="text-align:left">95</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小军</td>
<td style="text-align:left">M</td>
<td style="text-align:left">88</td>
</tr>
</tbody>
</table>
<p>如果要经常根据<code>score</code>列进行查询，就可以对<code>score</code>列创建索引：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ALTER</span> <span style="color:#fff;font-weight:bold">TABLE</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ADD</span> <span style="color:#fff;font-weight:bold">INDEX</span> idx_score (score);
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用<code>ADD INDEX idx_score (score)</code>就创建了一个名称为<code>idx_score</code>，使用列<code>score</code>的索引。索引名称是任意的，索引如果有多列，可以在括号里依次写上，例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ALTER TABLE students
</span></span><span style="display:flex;"><span>ADD INDEX idx_name_score (name, score);
</span></span></code></pre></td></tr></table>
</div>
</div><p>索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如<code>gender</code>列，大约一半的记录值是<code>M</code>，另一半是<code>F</code>，因此，对该列创建索引就没有意义。</p>
<p>可以对一张表创建多个索引。索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引，因此，索引越多，插入、更新和删除记录的速度就越慢。</p>
<p>对于主键，关系数据库会自动对其创建主键索引。使用主键索引的效率是最高的，因为主键会保证绝对唯一。</p>
<h3 id="唯一索引">唯一索引<a hidden class="anchor" aria-hidden="true" href="#唯一索引">#</a></h3>
<p>在设计关系数据表的时候，看上去唯一的列，例如身份证号、邮箱地址等，因为他们具有业务含义，因此不宜作为主键。</p>
<p>但是，这些列根据业务要求，又具有唯一性约束：即不能出现两条记录存储了同一个身份证号。这个时候，就可以给该列添加一个唯一索引。例如，我们假设<code>students</code>表的<code>name</code>不能重复：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ALTER</span> <span style="color:#fff;font-weight:bold">TABLE</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ADD</span> <span style="color:#fff;font-weight:bold">UNIQUE</span> <span style="color:#fff;font-weight:bold">INDEX</span> uni_name (name);
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过<code>UNIQUE</code>关键字我们就添加了一个唯一索引。</p>
<p>也可以只对某一列添加一个唯一约束而不创建唯一索引：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ALTER</span> <span style="color:#fff;font-weight:bold">TABLE</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ADD</span> <span style="color:#fff;font-weight:bold">CONSTRAINT</span> uni_name <span style="color:#fff;font-weight:bold">UNIQUE</span> (name);
</span></span></code></pre></td></tr></table>
</div>
</div><p>这种情况下，<code>name</code>列没有索引，但仍然具有唯一性保证。</p>
<p>无论是否创建索引，对于用户和应用程序来说，使用关系数据库不会有任何区别。这里的意思是说，当我们在数据库中查询时，如果有相应的索引可用，数据库系统就会自动使用索引来提高查询效率，如果没有索引，查询也能正常执行，只是速度会变慢。因此，索引可以在使用数据库的过程中逐步优化。</p>
<h3 id="小结-2">小结<a hidden class="anchor" aria-hidden="true" href="#小结-2">#</a></h3>
<p>通过对数据库表创建索引，可以提高查询速度。</p>
<p>通过创建唯一索引，可以保证某一列的值具有唯一性。</p>
<p>数据库索引对于用户和应用程序来说都是透明的。</p>
<h1 id="查询数据">查询数据<a hidden class="anchor" aria-hidden="true" href="#查询数据">#</a></h1>
<p>在关系数据库中，最常用的操作就是查询。</p>
<p>为了便于讲解和练习，我们先准备好了一个<code>students</code>表和一个<code>classes</code>表，它们的结构和数据如下：</p>
<p><code>students</code>表存储了学生信息：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">class_id</th>
<th style="text-align:left">name</th>
<th style="text-align:left">gender</th>
<th style="text-align:left">score</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小明</td>
<td style="text-align:left">M</td>
<td style="text-align:left">90</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小红</td>
<td style="text-align:left">F</td>
<td style="text-align:left">95</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小军</td>
<td style="text-align:left">M</td>
<td style="text-align:left">88</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">1</td>
<td style="text-align:left">小米</td>
<td style="text-align:left">F</td>
<td style="text-align:left">73</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">2</td>
<td style="text-align:left">小白</td>
<td style="text-align:left">F</td>
<td style="text-align:left">81</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left">2</td>
<td style="text-align:left">小兵</td>
<td style="text-align:left">M</td>
<td style="text-align:left">55</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left">2</td>
<td style="text-align:left">小林</td>
<td style="text-align:left">M</td>
<td style="text-align:left">85</td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td style="text-align:left">3</td>
<td style="text-align:left">小新</td>
<td style="text-align:left">F</td>
<td style="text-align:left">91</td>
</tr>
<tr>
<td style="text-align:left">9</td>
<td style="text-align:left">3</td>
<td style="text-align:left">小王</td>
<td style="text-align:left">M</td>
<td style="text-align:left">89</td>
</tr>
<tr>
<td style="text-align:left">10</td>
<td style="text-align:left">3</td>
<td style="text-align:left">小丽</td>
<td style="text-align:left">F</td>
<td style="text-align:left">85</td>
</tr>
</tbody>
</table>
<p><code>classes</code>表存储了班级信息：</p>
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">name</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">一班</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">二班</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">三班</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">四班</td>
</tr>
</tbody>
</table>
<h2 id="基本查询">基本查询<a hidden class="anchor" aria-hidden="true" href="#基本查询">#</a></h2>
<p>要查询数据库表的数据，我们使用如下的SQL语句：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> &lt;<span style="color:#f00">表名</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>假设表名是<code>students</code>，要查询<code>students</code>表的所有行，我们用如下SQL语句：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用<code>SELECT * FROM students</code>时，<code>SELECT</code>是关键字，表示将要执行一个查询，<code>*</code>表示“所有列”，<code>FROM</code>表示将要从哪个表查询，本例中是<code>students</code>表。</p>
<p>该SQL将查询出<code>students</code>表的所有数据。注意：查询结果也是一个二维表，它包含列名和每一行的数据。</p>
<p>要查询<code>classes</code>表的所有行，我们用如下SQL语句：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> classes;
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>SELECT</code>语句其实并不要求一定要有<code>FROM</code>子句。我们来试试下面的<code>SELECT</code>语句：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> <span style="color:#ff0;font-weight:bold">100</span>+<span style="color:#ff0;font-weight:bold">200</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述查询会直接计算出表达式的结果。虽然<code>SELECT</code>可以用作计算，但它并不是SQL的强项。但是，不带<code>FROM</code>子句的<code>SELECT</code>语句有一个有用的用途，就是用来判断当前到数据库的连接是否有效。许多检测工具会执行一条<code>SELECT 1;</code>来测试数据库连接。</p>
<h2 id="条件查询">条件查询<a hidden class="anchor" aria-hidden="true" href="#条件查询">#</a></h2>
<p>使用<code>SELECT * FROM &lt;表名&gt;</code>可以查询到一张表的所有记录。但是，很多时候，我们并不希望获得所有记录，而是根据条件选择性地获取指定条件的记录，例如，查询分数在80分以上的学生记录。在一张表有数百万记录的情况下，获取所有记录不仅费时，还费内存和网络带宽。</p>
<p>SELECT语句可以通过<code>WHERE</code>条件来设定查询条件，查询结果是满足查询条件的记录。例如，要指定条件“分数在80分或以上的学生”，写成<code>WHERE</code>条件就是<code>SELECT * FROM students WHERE score &gt;= 80</code>。</p>
<p>其中，<code>WHERE</code>关键字后面的<code>score &gt;= 80</code>就是条件。<code>score</code>是列名，该列存储了学生的成绩，因此，<code>score &gt;= 80</code>就筛选出了指定条件的记录：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> score &gt;= <span style="color:#ff0;font-weight:bold">80</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>因此，条件查询的语法就是：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> &lt;<span style="color:#f00">表名</span>&gt; <span style="color:#fff;font-weight:bold">WHERE</span> &lt;<span style="color:#f00">条件表达式</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>条件表达式可以用<code>&lt;条件1&gt; AND &lt;条件2&gt;</code>表达满足条件1并且满足条件2。例如，符合条件“分数在80分或以上”，并且还符合条件“男生”，把这两个条件写出来：</p>
<ul>
<li>条件1：根据score列的数据判断：<code>score &gt;= 80</code>；</li>
<li>条件2：根据gender列的数据判断：<code>gender = 'M'</code>，注意<code>gender</code>列存储的是字符串，需要用单引号括起来。</li>
</ul>
<p>就可以写出<code>WHERE</code>条件：<code>score &gt;= 80 AND gender = 'M'</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> score &gt;= <span style="color:#ff0;font-weight:bold">80</span> <span style="color:#fff;font-weight:bold">AND</span> gender = <span style="color:#0ff;font-weight:bold">&#39;M&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>第二种条件是<code>&lt;条件1&gt; OR &lt;条件2&gt;</code>，表示满足条件1或者满足条件2。例如，把上述<code>AND</code>查询的两个条件改为<code>OR</code>，查询结果就是“分数在80分或以上”或者“男生”，满足任意之一的条件即选出该记录：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> score &gt;= <span style="color:#ff0;font-weight:bold">80</span> <span style="color:#fff;font-weight:bold">OR</span> gender = <span style="color:#0ff;font-weight:bold">&#39;M&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>很显然<code>OR</code>条件要比<code>AND</code>条件宽松，返回的符合条件的记录也更多。</p>
<p>第三种条件是<code>NOT &lt;条件&gt;</code>，表示“不符合该条件”的记录。例如，写一个“不是2班的学生”这个条件，可以先写出“是2班的学生”：<code>class_id = 2</code>，再加上<code>NOT</code>：<code>NOT class_id = 2</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> <span style="color:#fff;font-weight:bold">NOT</span> class_id = <span style="color:#ff0;font-weight:bold">2</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述<code>NOT</code>条件<code>NOT class_id = 2</code>其实等价于<code>class_id &lt;&gt; 2</code>，因此，<code>NOT</code>查询不是很常用。</p>
<p>要组合三个或者更多的条件，就需要用小括号<code>()</code>表示如何进行条件运算。例如，编写一个复杂的条件：分数在80以下或者90以上，并且是男生：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> (score &lt; <span style="color:#ff0;font-weight:bold">80</span> <span style="color:#fff;font-weight:bold">OR</span> score &gt; <span style="color:#ff0;font-weight:bold">90</span>) <span style="color:#fff;font-weight:bold">AND</span> gender = <span style="color:#0ff;font-weight:bold">&#39;M&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果不加括号，条件运算按照<code>NOT</code>、<code>AND</code>、<code>OR</code>的优先级进行，即<code>NOT</code>优先级最高，其次是<code>AND</code>，最后是<code>OR</code>。加上括号可以改变优先级。</p>
<h3 id="常用的条件表达式">常用的条件表达式<a hidden class="anchor" aria-hidden="true" href="#常用的条件表达式">#</a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">条件</th>
<th style="text-align:left">表达式举例1</th>
<th style="text-align:left">表达式举例2</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">使用=判断相等</td>
<td style="text-align:left">score = 80</td>
<td style="text-align:left">name = &lsquo;abc&rsquo;</td>
<td style="text-align:left">字符串需要用单引号括起来</td>
</tr>
<tr>
<td style="text-align:left">使用&gt;判断大于</td>
<td style="text-align:left">score &gt; 80</td>
<td style="text-align:left">name &gt; &lsquo;abc&rsquo;</td>
<td style="text-align:left">字符串比较根据ASCII码，中文字符比较根据数据库设置</td>
</tr>
<tr>
<td style="text-align:left">使用&gt;=判断大于或相等</td>
<td style="text-align:left">score &gt;= 80</td>
<td style="text-align:left">name &gt;= &lsquo;abc&rsquo;</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">使用&lt;判断小于</td>
<td style="text-align:left">score &lt; 80</td>
<td style="text-align:left">name &lt;= &lsquo;abc&rsquo;</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">使用&lt;=判断小于或相等</td>
<td style="text-align:left">score &lt;= 80</td>
<td style="text-align:left">name &lt;= &lsquo;abc&rsquo;</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">使用&lt;&gt;判断不相等</td>
<td style="text-align:left">score &lt;&gt; 80</td>
<td style="text-align:left">name &lt;&gt; &lsquo;abc&rsquo;</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">使用LIKE判断相似</td>
<td style="text-align:left">name LIKE &lsquo;ab%&rsquo;</td>
<td style="text-align:left">name LIKE &lsquo;%bc%&rsquo;</td>
<td style="text-align:left">%表示任意字符，例如&rsquo;ab%&lsquo;将匹配&rsquo;ab&rsquo;，&lsquo;abc&rsquo;，&lsquo;abcd&rsquo;</td>
</tr>
</tbody>
</table>
<h2 id="投影查询">投影查询<a hidden class="anchor" aria-hidden="true" href="#投影查询">#</a></h2>
<p>使用<code>SELECT * FROM &lt;表名&gt; WHERE &lt;条件&gt;</code>可以选出表中的若干条记录。我们注意到返回的二维表结构和原表是相同的，即结果集的所有列与原表的所有列都一一对应。</p>
<p>如果我们只希望返回某些列的数据，而不是所有列的数据，我们可以用<code>SELECT 列1, 列2, 列3 FROM ...</code>，让结果集仅包含指定列。这种操作称为投影查询。</p>
<p>例如，从<code>students</code>表中返回<code>id</code>、<code>score</code>和<code>name</code>这三列：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, score, name <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样返回的结果集就只包含了我们指定的列，并且，结果集的列的顺序和原表可以不一样。</p>
<p>使用<code>SELECT 列1, 列2, 列3 FROM ...</code>时，还可以给每一列起个别名，这样，结果集的列名就可以与原表的列名不同。它的语法是<code>SELECT 列1 别名1, 列2 别名2, 列3 别名3 FROM ...</code>。</p>
<p>例如，以下<code>SELECT</code>语句将列名<code>score</code>重命名为<code>points</code>，而<code>id</code>和<code>name</code>列名保持不变：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, score points, name <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>投影查询同样可以接<code>WHERE</code>条件，实现复杂的查询：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, score points, name <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> gender = <span style="color:#0ff;font-weight:bold">&#39;M&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="小结-3">小结<a hidden class="anchor" aria-hidden="true" href="#小结-3">#</a></h3>
<p>使用<code>SELECT *</code>表示查询表的所有列，使用<code>SELECT 列1, 列2, 列3</code>则可以仅返回指定列，这种操作称为投影。</p>
<p><code>SELECT</code>语句可以对结果集的列进行重命名。</p>
<h2 id="排序">排序<a hidden class="anchor" aria-hidden="true" href="#排序">#</a></h2>
<p>我们使用SELECT查询时，细心的读者可能注意到，查询结果集通常是按照<code>id</code>排序的，也就是根据主键排序。这也是大部分数据库的做法。如果我们要根据其他条件排序怎么办？可以加上<code>ORDER BY</code>子句。例如按照成绩从低到高进行排序：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, gender, score <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> score;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果要反过来，按照成绩从高到底排序，我们可以加上<code>DESC</code>表示“倒序”：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, gender, score <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> score <span style="color:#fff;font-weight:bold">DESC</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果<code>score</code>列有相同的数据，要进一步排序，可以继续添加列名。例如，使用<code>ORDER BY score DESC, gender</code>表示先按<code>score</code>列倒序，如果有相同分数的，再按<code>gender</code>列排序：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, gender, score <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> score <span style="color:#fff;font-weight:bold">DESC</span>, gender;
</span></span></code></pre></td></tr></table>
</div>
</div><p>默认的排序规则是<code>ASC</code>：“升序”，即从小到大。<code>ASC</code>可以省略，即<code>ORDER BY score ASC</code>和<code>ORDER BY score</code>效果一样。</p>
<p>如果有<code>WHERE</code>子句，那么<code>ORDER BY</code>子句要放到<code>WHERE</code>子句后面。例如，查询一班的学生成绩，并按照倒序排序：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, gender, score
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">WHERE</span> class_id = <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> score <span style="color:#fff;font-weight:bold">DESC</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样，结果集仅包含符合<code>WHERE</code>条件的记录，并按照<code>ORDER BY</code>的设定排序。</p>
<h2 id="分页查询">分页查询<a hidden class="anchor" aria-hidden="true" href="#分页查询">#</a></h2>
<p>使用SELECT查询时，如果结果集数据量很大，比如几万行数据，放在一个页面显示的话数据量太大，不如分页显示，每次显示100条。</p>
<p>要实现分页功能，实际上就是从结果集中显示第1~100条记录作为第1页，显示第101~200条记录作为第2页，以此类推。</p>
<p>因此，分页实际上就是从结果集中“截取”出第M~N条记录。这个查询可以通过<code>LIMIT &lt;N-M&gt; OFFSET &lt;M&gt;</code>子句实现。我们先把所有学生按照成绩从高到低进行排序：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, gender, score <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> score <span style="color:#fff;font-weight:bold">DESC</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在，我们把结果集分页，每页3条记录。要获取第1页的记录，可以使用<code>LIMIT 3 OFFSET 0</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, gender, score
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> score <span style="color:#fff;font-weight:bold">DESC</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">LIMIT</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#fff;font-weight:bold">OFFSET</span> <span style="color:#ff0;font-weight:bold">0</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述查询<code>LIMIT 3 OFFSET 0</code>表示，对结果集从0号记录开始，最多取3条。注意SQL记录集的索引从0开始。</p>
<p>如果要查询第2页，那么我们只需要“跳过”头3条记录，也就是对结果集从3号记录开始查询，把<code>OFFSET</code>设定为3：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, gender, score
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> score <span style="color:#fff;font-weight:bold">DESC</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">LIMIT</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#fff;font-weight:bold">OFFSET</span> <span style="color:#ff0;font-weight:bold">3</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>类似的，查询第3页的时候，<code>OFFSET</code>应该设定为6：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, gender, score
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> score <span style="color:#fff;font-weight:bold">DESC</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">LIMIT</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#fff;font-weight:bold">OFFSET</span> <span style="color:#ff0;font-weight:bold">6</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>查询第4页的时候，<code>OFFSET</code>应该设定为9:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, gender, score
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> score <span style="color:#fff;font-weight:bold">DESC</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">LIMIT</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#fff;font-weight:bold">OFFSET</span> <span style="color:#ff0;font-weight:bold">9</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于第4页只有1条记录，因此最终结果集按实际数量1显示。<code>LIMIT 3</code>表示的意思是“最多3条记录”。</p>
<p>可见，分页查询的关键在于，首先要确定每页需要显示的结果数量<code>pageSize</code>（这里是3），然后根据当前页的索引<code>pageIndex</code>（从1开始），确定<code>LIMIT</code>和<code>OFFSET</code>应该设定的值：</p>
<ul>
<li><code>LIMIT</code>总是设定为<code>pageSize</code>；</li>
<li><code>OFFSET</code>计算公式为<code>pageSize * (pageIndex - 1)</code>。</li>
</ul>
<p>这样就能正确查询出第N页的记录集。</p>
<p>如果原本记录集一共就10条记录，但我们把<code>OFFSET</code>设置为20，会得到什么结果呢？</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, gender, score
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> score <span style="color:#fff;font-weight:bold">DESC</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">LIMIT</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#fff;font-weight:bold">OFFSET</span> <span style="color:#ff0;font-weight:bold">20</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>OFFSET</code>超过了查询的最大数量并不会报错，而是得到一个空的结果集。</p>
<h3 id="注意">注意<a hidden class="anchor" aria-hidden="true" href="#注意">#</a></h3>
<p><code>OFFSET</code>是可选的，如果只写<code>LIMIT 15</code>，那么相当于<code>LIMIT 15 OFFSET 0</code>。</p>
<p>在MySQL中，<code>LIMIT 15 OFFSET 30</code>还可以简写成<code>LIMIT 30, 15</code>。</p>
<p>使用<code>LIMIT &lt;M&gt; OFFSET &lt;N&gt;</code>分页时，随着<code>N</code>越来越大，查询效率也会越来越低。</p>
<h3 id="小结-4">小结<a hidden class="anchor" aria-hidden="true" href="#小结-4">#</a></h3>
<p>使用<code>LIMIT &lt;M&gt; OFFSET &lt;N&gt;</code>可以对结果集进行分页，每次查询返回结果集的一部分；</p>
<p>分页查询需要先确定每页的数量和当前页数，然后确定<code>LIMIT</code>和<code>OFFSET</code>的值。</p>
<h3 id="思考">思考<a hidden class="anchor" aria-hidden="true" href="#思考">#</a></h3>
<p>在分页查询之前，如何计算一共有几页？</p>
<h2 id="聚合查询">聚合查询<a hidden class="anchor" aria-hidden="true" href="#聚合查询">#</a></h2>
<p>如果我们要统计一张表的数据量，例如，想查询<code>students</code>表一共有多少条记录，难道必须用<code>SELECT * FROM students</code>查出来然后再数一数有多少行吗？</p>
<p>这个方法当然可以，但是比较弱智。对于统计总数、平均数这类计算，SQL提供了专门的聚合函数，使用聚合函数进行查询，就是聚合查询，它可以快速获得结果。</p>
<p>仍然以查询<code>students</code>表一共有多少条记录为例，我们可以使用SQL内置的<code>COUNT()</code>函数查询：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> <span style="color:#fff;font-weight:bold">COUNT</span>(*) <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>COUNT(*)</code>表示查询所有列的行数，要注意聚合的计算结果虽然是一个数字，但查询的结果仍然是一个二维表，只是这个二维表只有一行一列，并且列名是<code>COUNT(*)</code>。</p>
<p>通常，使用聚合查询时，我们应该给列名设置一个别名，便于处理结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> <span style="color:#fff;font-weight:bold">COUNT</span>(*) num <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>COUNT(*)</code>和<code>COUNT(id)</code>实际上是一样的效果。另外注意，聚合查询同样可以使用<code>WHERE</code>条件，因此我们可以方便地统计出有多少男生、多少女生、多少80分以上的学生等：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> <span style="color:#fff;font-weight:bold">COUNT</span>(*) boys <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> gender = <span style="color:#0ff;font-weight:bold">&#39;M&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>除了<code>COUNT()</code>函数外，SQL还提供了如下聚合函数：</p>
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SUM</td>
<td style="text-align:left">计算某一列的合计值，该列必须为数值类型</td>
</tr>
<tr>
<td style="text-align:left">AVG</td>
<td style="text-align:left">计算某一列的平均值，该列必须为数值类型</td>
</tr>
<tr>
<td style="text-align:left">MAX</td>
<td style="text-align:left">计算某一列的最大值</td>
</tr>
<tr>
<td style="text-align:left">MIN</td>
<td style="text-align:left">计算某一列的最小值</td>
</tr>
</tbody>
</table>
<p>注意，<code>MAX()</code>和<code>MIN()</code>函数并不限于数值类型。如果是字符类型，<code>MAX()</code>和<code>MIN()</code>会返回排序最后和排序最前的字符。</p>
<p>要统计男生的平均成绩，我们用下面的聚合查询：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> <span style="color:#fff;font-weight:bold">AVG</span>(score) average <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> gender = <span style="color:#0ff;font-weight:bold">&#39;M&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>要特别注意：如果聚合查询的<code>WHERE</code>条件没有匹配到任何行，<code>COUNT()</code>会返回0，而<code>SUM()</code>、<code>AVG()</code>、<code>MAX()</code>和<code>MIN()</code>会返回<code>NULL</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> <span style="color:#fff;font-weight:bold">AVG</span>(score) average <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> gender = <span style="color:#0ff;font-weight:bold">&#39;X&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="分组">分组<a hidden class="anchor" aria-hidden="true" href="#分组">#</a></h3>
<p>如果我们要统计一班的学生数量，我们知道，可以用<code>SELECT COUNT(*) num FROM students WHERE class_id = 1;</code>。如果要继续统计二班、三班的学生数量，难道必须不断修改<code>WHERE</code>条件来执行<code>SELECT</code>语句吗？</p>
<p>对于聚合查询，SQL还提供了“分组聚合”的功能。我们观察下面的聚合查询：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> <span style="color:#fff;font-weight:bold">COUNT</span>(*) num <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> class_id;
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行这个查询，<code>COUNT()</code>的结果不再是一个，而是3个，这是因为，<code>GROUP BY</code>子句指定了按<code>class_id</code>分组，因此，执行该<code>SELECT</code>语句时，会把<code>class_id</code>相同的列先分组，再分别计算，因此，得到了3行结果。</p>
<p>但是这3行结果分别是哪三个班级的，不好看出来，所以我们可以把<code>class_id</code>列也放入结果集中：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> class_id, <span style="color:#fff;font-weight:bold">COUNT</span>(*) num <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> class_id;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这下结果集就可以一目了然地看出各个班级的学生人数。我们再试试把<code>name</code>放入结果集：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> name, class_id, <span style="color:#fff;font-weight:bold">COUNT</span>(*) num
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> class_id;
</span></span></code></pre></td></tr></table>
</div>
</div><p>不出意外，执行这条查询我们会得到一个语法错误，因为在任意一个分组中，只有<code>class_id</code>都相同，<code>name</code>是不同的，SQL引擎不能把多个<code>name</code>的值放入一行记录中。因此，聚合查询的列中，只能放入分组的列。</p>
<p>也可以使用多个列进行分组。例如，我们想统计各班的男生和女生人数：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> class_id, gender, <span style="color:#fff;font-weight:bold">COUNT</span>(*) num
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> class_id, gender;
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述查询结果集一共有6条记录，分别对应各班级的男生和女生人数。</p>
<h2 id="多表查询">多表查询<a hidden class="anchor" aria-hidden="true" href="#多表查询">#</a></h2>
<p>SELECT查询不但可以从一张表查询数据，还可以从多张表同时查询数据。查询多张表的语法是：<code>SELECT * FROM &lt;表1&gt; &lt;表2&gt;</code>。</p>
<p>例如，同时从<code>students</code>表和<code>classes</code>表的“乘积”，即查询数据，可以这么写：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students, classes;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这种一次查询两个表的数据，查询的结果也是一个二维表，它是<code>students</code>表和<code>classes</code>表的“乘积”，即<code>students</code>表的每一行与<code>classes</code>表的每一行都两两拼在一起返回。结果集的列数是<code>students</code>表和<code>classes</code>表的列数之和，行数是<code>students</code>表和<code>classes</code>表的行数之积。</p>
<p>这种多表查询又称<code>笛卡尔查询</code>，使用笛卡尔查询时要非常小心，由于结果集是目标表的行数乘积，对两个各自有100行记录的表进行笛卡尔查询将返回1万条记录，对两个各自有1万行记录的表进行笛卡尔查询将返回1亿条记录。</p>
<p>你可能还注意到了，上述查询的结果集有两列<code>id</code>和两列<code>name</code>，两列<code>id</code>是因为其中一列是<code>students</code>表的<code>id</code>，而另一列是<code>classes</code>表的<code>id</code>，但是在结果集中，不好区分。两列<code>name</code>同理</p>
<p>要解决这个问题，我们仍然可以利用投影查询的“设置列的别名”来给两个表各自的<code>id</code>和<code>name</code>列起别名：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span>
</span></span><span style="display:flex;"><span>    students.id sid,
</span></span><span style="display:flex;"><span>    students.name,
</span></span><span style="display:flex;"><span>    students.gender,
</span></span><span style="display:flex;"><span>    students.score,
</span></span><span style="display:flex;"><span>    classes.id cid,
</span></span><span style="display:flex;"><span>    classes.name cname
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students, classes;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意，多表查询时，要使用<code>表名.列名</code>这样的方式来引用列和设置别名，这样就避免了结果集的列名重复问题。但是，用<code>表名.列名</code>这种方式列举两个表的所有列实在是很麻烦，所以SQL还允许给表设置一个别名，让我们在投影查询中引用起来稍微简洁一点：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span>
</span></span><span style="display:flex;"><span>    s.id sid,
</span></span><span style="display:flex;"><span>    s.name,
</span></span><span style="display:flex;"><span>    s.gender,
</span></span><span style="display:flex;"><span>    s.score,
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">c</span>.id cid,
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">c</span>.name cname
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students s, classes <span style="color:#fff;font-weight:bold">c</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意到<code>FROM</code>子句给表设置别名的语法是<code>FROM &lt;表名1&gt; &lt;别名1&gt;, &lt;表名2&gt; &lt;别名2&gt;</code>。这样我们用别名<code>s</code>和<code>c</code>分别表示<code>students</code>表和<code>classes</code>表。</p>
<p>多表查询也是可以添加<code>WHERE</code>条件的，我们来试试：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span>
</span></span><span style="display:flex;"><span>    s.id sid,
</span></span><span style="display:flex;"><span>    s.name,
</span></span><span style="display:flex;"><span>    s.gender,
</span></span><span style="display:flex;"><span>    s.score,
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">c</span>.id cid,
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">c</span>.name cname
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students s, classes <span style="color:#fff;font-weight:bold">c</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">WHERE</span> s.gender = <span style="color:#0ff;font-weight:bold">&#39;M&#39;</span> <span style="color:#fff;font-weight:bold">AND</span> <span style="color:#fff;font-weight:bold">c</span>.id = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个查询的结果集每行记录都满足条件<code>s.gender = 'M'</code>和<code>c.id = 1</code>。添加<code>WHERE</code>条件后结果集的数量大大减少了。</p>
<h2 id="连接查询">连接查询<a hidden class="anchor" aria-hidden="true" href="#连接查询">#</a></h2>
<p>连接查询是另一种类型的多表查询。连接查询对多个表进行JOIN运算，简单地说，就是先确定一个主表作为结果集，然后，把其他表的行有选择性地“连接”在主表结果集上。</p>
<p>例如，我们想要选出<code>students</code>表的所有学生信息，可以用一条简单的SELECT语句完成：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> 
</span></span><span style="display:flex;"><span>	s.id, 
</span></span><span style="display:flex;"><span>	s.name, 
</span></span><span style="display:flex;"><span>	s.class_id, 
</span></span><span style="display:flex;"><span>	s.gender, 
</span></span><span style="display:flex;"><span>	s.score 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students s;
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是，假设我们希望结果集同时包含所在班级的名称，上面的结果集只有<code>class_id</code>列，缺少对应班级的<code>name</code>列。</p>
<p>现在问题来了，存放班级名称的<code>name</code>列存储在<code>classes</code>表中，只有根据<code>students</code>表的<code>class_id</code>，找到<code>classes</code>表对应的行，再取出<code>name</code>列，就可以获得班级名称。</p>
<p>这时，连接查询就派上了用场。我们先使用最常用的一种内连接：INNER JOIN来实现：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> s.id, s.name, s.class_id, <span style="color:#fff;font-weight:bold">c</span>.name class_name, s.gender, s.score
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students s
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INNER</span> <span style="color:#fff;font-weight:bold">JOIN</span> classes <span style="color:#fff;font-weight:bold">c</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ON</span> s.class_id = <span style="color:#fff;font-weight:bold">c</span>.id;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意INNER JOIN查询的写法是：</p>
<ol>
<li>先确定主表，仍然使用<code>FROM &lt;表1&gt;</code>的语法；</li>
<li>再确定需要连接的表，使用<code>INNER JOIN &lt;表2&gt;</code>的语法；</li>
<li>然后确定连接条件，使用<code>ON &lt;条件...&gt;</code>，这里的条件是<code>s.class_id = c.id</code>，表示<code>students</code>表的<code>class_id</code>列与<code>classes</code>表的<code>id</code>列相同的行需要连接；</li>
<li>可选：加上<code>WHERE</code>子句、<code>ORDER BY</code>等子句。</li>
</ol>
<p>使用别名不是必须的，但可以更好地简化查询语句。</p>
<p>那什么是内连接（INNER JOIN）呢？先别着急，有内连接（INNER JOIN）就有外连接（OUTER JOIN）。我们把内连接查询改成外连接查询，看看效果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> s.id, s.name, s.class_id, <span style="color:#fff;font-weight:bold">c</span>.name class_name, s.gender, s.score
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students s
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">RIGHT</span> <span style="color:#fff;font-weight:bold">OUTER</span> <span style="color:#fff;font-weight:bold">JOIN</span> classes <span style="color:#fff;font-weight:bold">c</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ON</span> s.class_id = <span style="color:#fff;font-weight:bold">c</span>.id;
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行上述RIGHT OUTER JOIN可以看到，和INNER JOIN相比，RIGHT OUTER JOIN多了一行，多出来的一行是“四班”，但是，学生相关的列如<code>name</code>、<code>gender</code>、<code>score</code>都为<code>NULL</code>。</p>
<p>这也容易理解，因为根据<code>ON</code>条件<code>s.class_id = c.id</code>，<code>classes</code>表的id=4的行正是“四班”，但是，<code>students</code>表中并不存在class_id=4的行。</p>
<p>有RIGHT OUTER JOIN，就有LEFT OUTER JOIN，以及FULL OUTER JOIN。它们的区别是：</p>
<p>INNER JOIN只返回同时存在于两张表的行数据，由于<code>students</code>表的<code>class_id</code>包含1，2，3，<code>classes</code>表的<code>id</code>包含1，2，3，4，所以，INNER JOIN根据条件<code>s.class_id = c.id</code>返回的结果集仅包含1，2，3。</p>
<p>RIGHT OUTER JOIN返回右表都存在的行。如果某一行仅在右表存在，那么结果集就会以<code>NULL</code>填充剩下的字段。</p>
<p>LEFT OUTER JOIN则返回左表都存在的行。如果我们给students表增加一行，并添加class_id=5，由于classes表并不存在id=5的行，所以，LEFT OUTER JOIN的结果会增加一行，对应的<code>class_name</code>是<code>NULL</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> s.id, s.name, s.class_id, <span style="color:#fff;font-weight:bold">c</span>.name class_name, s.gender, s.score
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students s
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">LEFT</span> <span style="color:#fff;font-weight:bold">OUTER</span> <span style="color:#fff;font-weight:bold">JOIN</span> classes <span style="color:#fff;font-weight:bold">c</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ON</span> s.class_id = <span style="color:#fff;font-weight:bold">c</span>.id;
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后，我们使用FULL OUTER JOIN，它会把两张表的所有记录全部选择出来，并且，自动把对方不存在的列填充为NULL：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> s.id, s.name, s.class_id, <span style="color:#fff;font-weight:bold">c</span>.name class_name, s.gender, s.score
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> students s
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FULL</span> <span style="color:#fff;font-weight:bold">OUTER</span> <span style="color:#fff;font-weight:bold">JOIN</span> classes <span style="color:#fff;font-weight:bold">c</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ON</span> s.class_id = <span style="color:#fff;font-weight:bold">c</span>.id;
</span></span></code></pre></td></tr></table>
</div>
</div><p>对于这么多种JOIN查询，到底什么使用应该用哪种呢？其实我们用图来表示结果集就一目了然了。</p>
<p>假设查询语句是：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> ... <span style="color:#fff;font-weight:bold">FROM</span> tableA
</span></span><span style="display:flex;"><span>??? <span style="color:#fff;font-weight:bold">JOIN</span> tableB <span style="color:#fff;font-weight:bold">ON</span> tableA.column1 = tableB.column2;
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们把tableA看作左表，把tableB看成右表，那么INNER JOIN是选出两张表都存在的记录：</p>
<p><img loading="lazy" src="2.png" alt=""  />
</p>
<p>LEFT OUTER JOIN是选出左表存在的记录：</p>
<p><img loading="lazy" src="3.png" alt=""  />
</p>
<p>RIGHT OUTER JOIN是选出右表存在的记录：</p>
<p><img loading="lazy" src="4.png" alt=""  />
</p>
<p>FULL OUTER JOIN则是选出左右表都存在的记录：</p>
<p><img loading="lazy" src="5.png" alt=""  />
</p>
<h3 id="小结-5">小结<a hidden class="anchor" aria-hidden="true" href="#小结-5">#</a></h3>
<p>JOIN查询需要先确定主表，然后把另一个表的数据“附加”到结果集上；</p>
<p>INNER JOIN是最常用的一种JOIN查询，它的语法是<code>SELECT ... FROM &lt;表1&gt; INNER JOIN &lt;表2&gt; ON &lt;条件...&gt;</code>；</p>
<p>JOIN查询仍然可以使用<code>WHERE</code>条件和<code>ORDER BY</code>排序。</p>
<h1 id="修改数据">修改数据<a hidden class="anchor" aria-hidden="true" href="#修改数据">#</a></h1>
<h2 id="insert">insert<a hidden class="anchor" aria-hidden="true" href="#insert">#</a></h2>
<p>关系数据库的基本操作就是增删改查，即CRUD：Create、Retrieve、Update、Delete。其中，对于查询，我们已经详细讲述了<code>SELECT</code>语句的详细用法。</p>
<p>而对于增、删、改，对应的SQL语句分别是：</p>
<ul>
<li>INSERT：插入新记录；</li>
<li>UPDATE：更新已有记录；</li>
<li>DELETE：删除已有记录。</li>
</ul>
<p>当我们需要向数据库表中插入一条新记录时，就必须使用<code>INSERT</code>语句。</p>
<p><code>INSERT</code>语句的基本语法是：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>INSERT INTO &lt;表名&gt; (字段1, 字段2, ...) VALUES (值1, 值2, ...);
</span></span></code></pre></td></tr></table>
</div>
</div><p>例如，我们向<code>students</code>表插入一条新记录，先列举出需要插入的字段名称，然后在<code>VALUES</code>子句中依次写出对应字段的值：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> students (class_id, name, gender, score) <span style="color:#fff;font-weight:bold">VALUES</span> (<span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#0ff;font-weight:bold">&#39;大牛&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;M&#39;</span>, <span style="color:#ff0;font-weight:bold">80</span>);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 查询并观察结果:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意到我们并没有列出<code>id</code>字段，也没有列出<code>id</code>字段对应的值，这是因为<code>id</code>字段是一个自增主键，它的值可以由数据库自己推算出来。此外，如果一个字段有默认值，那么在<code>INSERT</code>语句中也可以不出现。</p>
<p>要注意，字段顺序不必和数据库表的字段顺序一致，但值的顺序必须和字段顺序一致。也就是说，可以写<code>INSERT INTO students (score, gender, name, class_id) ...</code>，但是对应的<code>VALUES</code>就得变成<code>(80, 'M', '大牛', 2)</code>。</p>
<p>还可以一次性添加多条记录，只需要在<code>VALUES</code>子句中指定多个记录值，每个记录是由<code>(...)</code>包含的一组值：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> students (class_id, name, gender, score) <span style="color:#fff;font-weight:bold">VALUES</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#0ff;font-weight:bold">&#39;大宝&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;M&#39;</span>, <span style="color:#ff0;font-weight:bold">87</span>),
</span></span><span style="display:flex;"><span>  (<span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#0ff;font-weight:bold">&#39;二宝&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;M&#39;</span>, <span style="color:#ff0;font-weight:bold">81</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="小结-6">小结<a hidden class="anchor" aria-hidden="true" href="#小结-6">#</a></h3>
<p>使用<code>INSERT</code>，我们就可以一次向一个表中插入一条或多条记录。</p>
<h2 id="update">update<a hidden class="anchor" aria-hidden="true" href="#update">#</a></h2>
<p>如果要更新数据库表中的记录，我们就必须使用<code>UPDATE</code>语句。</p>
<p><code>UPDATE</code>语句的基本语法是：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>UPDATE &lt;表名&gt; SET 字段1=值1, 字段2=值2, ... WHERE ...;
</span></span></code></pre></td></tr></table>
</div>
</div><p>例如，我们想更新<code>students</code>表<code>id=1</code>的记录的<code>name</code>和<code>score</code>这两个字段，先写出<code>UPDATE students SET name='大牛', score=66</code>，然后在<code>WHERE</code>子句中写出需要更新的行的筛选条件<code>id=1</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">UPDATE</span> students <span style="color:#fff;font-weight:bold">SET</span> name=<span style="color:#0ff;font-weight:bold">&#39;大牛&#39;</span>, score=<span style="color:#ff0;font-weight:bold">66</span> <span style="color:#fff;font-weight:bold">WHERE</span> id=<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 查询并观察结果:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> id=<span style="color:#ff0;font-weight:bold">1</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意到<code>UPDATE</code>语句的<code>WHERE</code>条件和<code>SELECT</code>语句的<code>WHERE</code>条件其实是一样的，因此完全可以一次更新多条记录：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">UPDATE</span> students <span style="color:#fff;font-weight:bold">SET</span> name=<span style="color:#0ff;font-weight:bold">&#39;小牛&#39;</span>, score=<span style="color:#ff0;font-weight:bold">77</span> <span style="color:#fff;font-weight:bold">WHERE</span> id&gt;=<span style="color:#ff0;font-weight:bold">5</span> <span style="color:#fff;font-weight:bold">AND</span> id&lt;=<span style="color:#ff0;font-weight:bold">7</span>;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 查询并观察结果:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在<code>UPDATE</code>语句中，更新字段时可以使用表达式。例如，把所有80分以下的同学的成绩加10分：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">UPDATE</span> students <span style="color:#fff;font-weight:bold">SET</span> score=score+<span style="color:#ff0;font-weight:bold">10</span> <span style="color:#fff;font-weight:bold">WHERE</span> score&lt;<span style="color:#ff0;font-weight:bold">80</span>;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 查询并观察结果:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中，<code>SET score=score+10</code>就是给当前行的<code>score</code>字段的值加上了10。</p>
<p>如果<code>WHERE</code>条件没有匹配到任何记录，<code>UPDATE</code>语句不会报错，也不会有任何记录被更新。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">UPDATE</span> students <span style="color:#fff;font-weight:bold">SET</span> score=<span style="color:#ff0;font-weight:bold">100</span> <span style="color:#fff;font-weight:bold">WHERE</span> id=<span style="color:#ff0;font-weight:bold">999</span>;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 查询并观察结果:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后，要特别小心的是，<code>UPDATE</code>语句可以没有<code>WHERE</code>条件，例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">UPDATE</span> students <span style="color:#fff;font-weight:bold">SET</span> score=<span style="color:#ff0;font-weight:bold">60</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这时，整个表的所有记录都会被更新。所以，在执行<code>UPDATE</code>语句时要非常小心，最好先用<code>SELECT</code>语句来测试<code>WHERE</code>条件是否筛选出了期望的记录集，然后再用<code>UPDATE</code>更新。</p>
<h3 id="mysql">MySQL<a hidden class="anchor" aria-hidden="true" href="#mysql">#</a></h3>
<p>在使用MySQL这类真正的关系数据库时，<code>UPDATE</code>语句会返回更新的行数以及<code>WHERE</code>条件匹配的行数。</p>
<p>例如，更新<code>id=1</code>的记录时：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">UPDATE</span> students <span style="color:#fff;font-weight:bold">SET</span> name=<span style="color:#0ff;font-weight:bold">&#39;大宝&#39;</span> <span style="color:#fff;font-weight:bold">WHERE</span> id=<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">row</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">Rows</span> matched: <span style="color:#ff0;font-weight:bold">1</span>  Changed: <span style="color:#ff0;font-weight:bold">1</span>  Warnings: <span style="color:#ff0;font-weight:bold">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>MySQL会返回<code>1</code>，可以从打印的结果<code>Rows matched: 1 Changed: 1</code>看到。</p>
<p>当更新<code>id=999</code>的记录时：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">UPDATE</span> students <span style="color:#fff;font-weight:bold">SET</span> name=<span style="color:#0ff;font-weight:bold">&#39;大宝&#39;</span> <span style="color:#fff;font-weight:bold">WHERE</span> id=<span style="color:#ff0;font-weight:bold">999</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">Rows</span> matched: <span style="color:#ff0;font-weight:bold">0</span>  Changed: <span style="color:#ff0;font-weight:bold">0</span>  Warnings: <span style="color:#ff0;font-weight:bold">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>MySQL会返回<code>0</code>，可以从打印的结果<code>Rows matched: 0 Changed: 0</code>看到。</p>
<h3 id="小结-7">小结<a hidden class="anchor" aria-hidden="true" href="#小结-7">#</a></h3>
<p>使用<code>UPDATE</code>，我们就可以一次更新表中的一条或多条记录。</p>
<h2 id="delete">delete<a hidden class="anchor" aria-hidden="true" href="#delete">#</a></h2>
<p>如果要删除数据库表中的记录，我们可以使用<code>DELETE</code>语句。</p>
<p><code>DELETE</code>语句的基本语法是：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">DELETE</span> <span style="color:#fff;font-weight:bold">FROM</span> &lt;<span style="color:#f00">表名</span>&gt; <span style="color:#fff;font-weight:bold">WHERE</span> ...;
</span></span></code></pre></td></tr></table>
</div>
</div><p>例如，我们想删除<code>students</code>表中<code>id=1</code>的记录，就需要这么写：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">DELETE</span> <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> id=<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 查询并观察结果:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意到<code>DELETE</code>语句的<code>WHERE</code>条件也是用来筛选需要删除的行，因此和<code>UPDATE</code>类似，<code>DELETE</code>语句也可以一次删除多条记录：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">DELETE</span> <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> id&gt;=<span style="color:#ff0;font-weight:bold">5</span> <span style="color:#fff;font-weight:bold">AND</span> id&lt;=<span style="color:#ff0;font-weight:bold">7</span>;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 查询并观察结果:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果<code>WHERE</code>条件没有匹配到任何记录，<code>DELETE</code>语句不会报错，也不会有任何记录被删除。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">DELETE</span> <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> id=<span style="color:#ff0;font-weight:bold">999</span>;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 查询并观察结果:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后，要特别小心的是，和<code>UPDATE</code>类似，不带<code>WHERE</code>条件的<code>DELETE</code>语句会删除整个表的数据：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">DELETE</span> <span style="color:#fff;font-weight:bold">FROM</span> students;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这时，整个表的所有记录都会被删除。所以，在执行<code>DELETE</code>语句时也要非常小心，最好先用<code>SELECT</code>语句来测试<code>WHERE</code>条件是否筛选出了期望的记录集，然后再用<code>DELETE</code>删除。</p>
<h3 id="mysql-1">MySQL<a hidden class="anchor" aria-hidden="true" href="#mysql-1">#</a></h3>
<p>在使用MySQL这类真正的关系数据库时，<code>DELETE</code>语句也会返回删除的行数以及<code>WHERE</code>条件匹配的行数。</p>
<p>例如，分别执行删除<code>id=1</code>和<code>id=999</code>的记录：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">DELETE</span> <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> id=<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">row</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">01</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">DELETE</span> <span style="color:#fff;font-weight:bold">FROM</span> students <span style="color:#fff;font-weight:bold">WHERE</span> id=<span style="color:#ff0;font-weight:bold">999</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">01</span> sec)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="小结-8">小结<a hidden class="anchor" aria-hidden="true" href="#小结-8">#</a></h3>
<p>使用<code>DELETE</code>，我们就可以一次删除表中的一条或多条记录。</p>
<h1 id="管理mysql">管理mysql<a hidden class="anchor" aria-hidden="true" href="#管理mysql">#</a></h1>
<p>因此，MySQL提供了大量的SQL语句用于管理。虽然可以使用MySQL Workbench图形界面来直接管理MySQL，但是，很多时候，通过SSH远程连接时，只能使用SQL命令，所以，了解并掌握常用的SQL管理操作是必须的。</p>
<h2 id="数据库">数据库<a hidden class="anchor" aria-hidden="true" href="#数据库">#</a></h2>
<p>在一个运行MySQL的服务器上，实际上可以创建多个数据库（Database）。要列出所有数据库，使用命令：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">SHOW</span> DATABASES;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">--------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| <span style="color:#fff;font-weight:bold">Database</span>           |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">--------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| information_schema |
</span></span><span style="display:flex;"><span>| mysql              |
</span></span><span style="display:flex;"><span>| performance_schema |
</span></span><span style="display:flex;"><span>| shici              |
</span></span><span style="display:flex;"><span>| sys                |
</span></span><span style="display:flex;"><span>| test               |
</span></span><span style="display:flex;"><span>| school             |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">--------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>其中，<code>information_schema</code>、<code>mysql</code>、<code>performance_schema</code>和<code>sys</code>是系统库，不要去改动它们。其他的是用户创建的数据库。</p>
<p>注意：在MySQL命令行客户端输入SQL后，记得加一个<code>;</code>表示SQL语句结束，再回车就可以执行该SQL语句。虽然有些SQL命令不需要<code>;</code>也能执行，但类似<code>SELECT</code>等语句不加<code>;</code>会让MySQL客户端换行后继续等待输入。如果在图形界面或程序开发中集成SQL则不需要加<code>;</code>。</p>
<p>要创建一个新数据库，使用命令：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mysql&gt; CREATE DATABASE test;
</span></span><span style="display:flex;"><span>Query OK, 1 row affected (0.01 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>要删除一个数据库，使用命令：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mysql&gt; DROP DATABASE test;
</span></span><span style="display:flex;"><span>Query OK, 0 rows affected (0.01 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：删除一个数据库将导致该数据库的所有表全部被删除。</p>
<p>对一个数据库进行操作时，要首先将其切换为当前数据库：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mysql&gt; USE test;
</span></span><span style="display:flex;"><span>Database changed
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="表">表<a hidden class="anchor" aria-hidden="true" href="#表">#</a></h2>
<p>列出当前数据库的所有表，使用命令：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mysql&gt; SHOW TABLES;
</span></span><span style="display:flex;"><span>+---------------------+
</span></span><span style="display:flex;"><span>| Tables_in_test      |
</span></span><span style="display:flex;"><span>+---------------------+
</span></span><span style="display:flex;"><span>| classes             |
</span></span><span style="display:flex;"><span>| statistics          |
</span></span><span style="display:flex;"><span>| students            |
</span></span><span style="display:flex;"><span>| students_of_class1  |
</span></span><span style="display:flex;"><span>+---------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>要查看一个表的结构，使用命令：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mysql&gt; DESC students;
</span></span><span style="display:flex;"><span>+----------+--------------+------+-----+---------+----------------+
</span></span><span style="display:flex;"><span>| Field    | Type         | Null | Key | Default | Extra          |
</span></span><span style="display:flex;"><span>+----------+--------------+------+-----+---------+----------------+
</span></span><span style="display:flex;"><span>| id       | bigint(20)   | NO   | PRI | NULL    | auto_increment |
</span></span><span style="display:flex;"><span>| class_id | bigint(20)   | NO   |     | NULL    |                |
</span></span><span style="display:flex;"><span>| name     | varchar(100) | NO   |     | NULL    |                |
</span></span><span style="display:flex;"><span>| gender   | varchar(1)   | NO   |     | NULL    |                |
</span></span><span style="display:flex;"><span>| score    | int(11)      | NO   |     | NULL    |                |
</span></span><span style="display:flex;"><span>+----------+--------------+------+-----+---------+----------------+
</span></span><span style="display:flex;"><span>5 rows in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>还可以使用以下命令查看创建表的SQL语句：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">SHOW</span> <span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> students;
</span></span><span style="display:flex;"><span>+----------+-------------------------------------------------------+
</span></span><span style="display:flex;"><span>| students | <span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `students` (                             |
</span></span><span style="display:flex;"><span>|          |   `id` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">20</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL <span style="color:#fff;font-weight:bold">AUTO_INCREMENT</span>,            |
</span></span><span style="display:flex;"><span>|          |   `class_id` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">20</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL,                     |
</span></span><span style="display:flex;"><span>|          |   `name` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL,                       |
</span></span><span style="display:flex;"><span>|          |   `gender` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">1</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL,                       |
</span></span><span style="display:flex;"><span>|          |   `score` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL,                           |
</span></span><span style="display:flex;"><span>|          |   <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`)                                  |
</span></span><span style="display:flex;"><span>|          | ) <span style="color:#fff;font-weight:bold">ENGINE</span>=InnoDB <span style="color:#fff;font-weight:bold">AUTO_INCREMENT</span>=<span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">CHARSET</span>=utf8 |
</span></span><span style="display:flex;"><span>+----------+-------------------------------------------------------+
</span></span><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">1</span> row <span style="color:#fff;font-weight:bold">in</span> <span style="color:#fff;font-weight:bold">set</span> (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建表使用<code>CREATE TABLE</code>语句，而删除表使用<code>DROP TABLE</code>语句：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mysql&gt; DROP TABLE students;
</span></span><span style="display:flex;"><span>Query OK, 0 rows affected (0.01 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改表就比较复杂。如果要给<code>students</code>表新增一列<code>birth</code>，使用：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ALTER TABLE students ADD COLUMN birth VARCHAR(10) NOT NULL;
</span></span></code></pre></td></tr></table>
</div>
</div><p>要修改<code>birth</code>列，例如把列名改为<code>birthday</code>，类型改为<code>VARCHAR(20)</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ALTER TABLE students CHANGE COLUMN birth birthday VARCHAR(20) NOT NULL;
</span></span></code></pre></td></tr></table>
</div>
</div><p>要删除列，使用：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ALTER TABLE students DROP COLUMN birthday;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="退出mysql">退出MySQL<a hidden class="anchor" aria-hidden="true" href="#退出mysql">#</a></h2>
<p>使用<code>EXIT</code>命令退出MySQL：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mysql&gt; EXIT
</span></span><span style="display:flex;"><span>Bye
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意<code>EXIT</code>仅仅断开了客户端和服务器的连接，MySQL服务器仍然继续运行。</p>
<h1 id="实用sql语句">实用SQL语句<a hidden class="anchor" aria-hidden="true" href="#实用sql语句">#</a></h1>
<p>在编写SQL时，灵活运用一些技巧，可以大大简化程序逻辑。</p>
<h2 id="插入或替换">插入或替换<a hidden class="anchor" aria-hidden="true" href="#插入或替换">#</a></h2>
<p>如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就先删除原记录，再插入新记录。此时，可以使用<code>REPLACE</code>语句，这样就不必先查询，再决定是否先删除再插入：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>REPLACE INTO students (id, class_id, name, gender, score) VALUES (1, 1, &#39;小明&#39;, &#39;F&#39;, 99);
</span></span></code></pre></td></tr></table>
</div>
</div><p>若<code>id=1</code>的记录不存在，<code>REPLACE</code>语句将插入新记录，否则，当前<code>id=1</code>的记录将被删除，然后再插入新记录。</p>
<h2 id="插入或更新">插入或更新<a hidden class="anchor" aria-hidden="true" href="#插入或更新">#</a></h2>
<p>如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就更新该记录，此时，可以使用<code>INSERT INTO ... ON DUPLICATE KEY UPDATE ...</code>语句：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>INSERT INTO students (id, class_id, name, gender, score) VALUES (1, 1, &#39;小明&#39;, &#39;F&#39;, 99) ON DUPLICATE KEY UPDATE name=&#39;小明&#39;, gender=&#39;F&#39;, score=99;
</span></span></code></pre></td></tr></table>
</div>
</div><p>若<code>id=1</code>的记录不存在，<code>INSERT</code>语句将插入新记录，否则，当前<code>id=1</code>的记录将被更新，更新的字段由<code>UPDATE</code>指定。</p>
<h2 id="插入或忽略">插入或忽略<a hidden class="anchor" aria-hidden="true" href="#插入或忽略">#</a></h2>
<p>如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就啥事也不干直接忽略，此时，可以使用<code>INSERT IGNORE INTO ...</code>语句：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>INSERT IGNORE INTO students (id, class_id, name, gender, score) VALUES (1, 1, &#39;小明&#39;, &#39;F&#39;, 99);
</span></span></code></pre></td></tr></table>
</div>
</div><p>若<code>id=1</code>的记录不存在，<code>INSERT</code>语句将插入新记录，否则，不执行任何操作。</p>
<h2 id="快照">快照<a hidden class="anchor" aria-hidden="true" href="#快照">#</a></h2>
<p>如果想要对一个表进行快照，即复制一份当前表的数据到一个新表，可以结合<code>CREATE TABLE</code>和<code>SELECT</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>-- 对class_id=1的记录进行快照，并存储为新表students_of_class1:
</span></span><span style="display:flex;"><span>CREATE TABLE students_of_class1 SELECT * FROM students WHERE class_id=1;
</span></span></code></pre></td></tr></table>
</div>
</div><p>新创建的表结构和<code>SELECT</code>使用的表结构完全一致。</p>
<h2 id="写入查询结果集">写入查询结果集<a hidden class="anchor" aria-hidden="true" href="#写入查询结果集">#</a></h2>
<p>如果查询结果集需要写入到表中，可以结合<code>INSERT</code>和<code>SELECT</code>，将<code>SELECT</code>语句的结果集直接插入到指定表中。</p>
<p>例如，创建一个统计成绩的表<code>statistics</code>，记录各班的平均成绩：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>CREATE TABLE statistics (
</span></span><span style="display:flex;"><span>    id BIGINT NOT NULL AUTO_INCREMENT,
</span></span><span style="display:flex;"><span>    class_id BIGINT NOT NULL,
</span></span><span style="display:flex;"><span>    average DOUBLE NOT NULL,
</span></span><span style="display:flex;"><span>    PRIMARY KEY (id)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后，我们就可以用一条语句写入各班的平均成绩：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>INSERT INTO statistics (class_id, average) SELECT class_id, AVG(score) FROM students GROUP BY class_id;
</span></span></code></pre></td></tr></table>
</div>
</div><p>确保<code>INSERT</code>语句的列和<code>SELECT</code>语句的列能一一对应，就可以在<code>statistics</code>表中直接保存查询的结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&gt; SELECT * FROM statistics;
</span></span><span style="display:flex;"><span>+----+----------+--------------+
</span></span><span style="display:flex;"><span>| id | class_id | average      |
</span></span><span style="display:flex;"><span>+----+----------+--------------+
</span></span><span style="display:flex;"><span>|  1 |        1 |         86.5 |
</span></span><span style="display:flex;"><span>|  2 |        2 | 73.666666666 |
</span></span><span style="display:flex;"><span>|  3 |        3 | 88.333333333 |
</span></span><span style="display:flex;"><span>+----+----------+--------------+
</span></span><span style="display:flex;"><span>3 rows in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="强制使用指定索引">强制使用指定索引<a hidden class="anchor" aria-hidden="true" href="#强制使用指定索引">#</a></h2>
<p>在查询的时候，数据库系统会自动分析查询语句，并选择一个最合适的索引。但是很多时候，数据库系统的查询优化器并不一定总是能使用最优索引。如果我们知道如何选择索引，可以使用<code>FORCE INDEX</code>强制查询使用指定的索引。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&gt; SELECT * FROM students FORCE INDEX (idx_class_id) WHERE class_id = 1 ORDER BY id DESC;
</span></span></code></pre></td></tr></table>
</div>
</div><p>指定索引的前提是索引<code>idx_class_id</code>必须存在。</p>
<h1 id="事务">事务<a hidden class="anchor" aria-hidden="true" href="#事务">#</a></h1>
<p>在执行SQL语句的时候，某些业务要求，一系列操作必须全部执行，而不能仅执行一部分。例如，一个转账操作：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#007f7f">-- 从id=1的账户给id=2的账户转账100元
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 第一步：将id=1的A账户余额减去100
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">UPDATE</span> accounts <span style="color:#fff;font-weight:bold">SET</span> balance = balance - <span style="color:#ff0;font-weight:bold">100</span> <span style="color:#fff;font-weight:bold">WHERE</span> id = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">-- 第二步：将id=2的B账户余额加上100
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">UPDATE</span> accounts <span style="color:#fff;font-weight:bold">SET</span> balance = balance + <span style="color:#ff0;font-weight:bold">100</span> <span style="color:#fff;font-weight:bold">WHERE</span> id = <span style="color:#ff0;font-weight:bold">2</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这两条SQL语句必须全部执行，或者，由于某些原因，如果第一条语句成功，第二条语句失败，就必须全部撤销。</p>
<p>这种把多条语句作为一个整体进行操作的功能，被称为数据库<em>事务</em>。数据库事务可以确保该事务范围内的所有操作都可以全部成功或者全部失败。如果事务失败，那么效果就和没有执行这些SQL一样，不会对数据库数据有任何改动。</p>
<p>可见，数据库事务具有ACID这4个特性：</p>
<p><code>A：Atomic</code>：表示组成一个事务的多个数据库操作是一个不可分割的原子单元，只有所有的操作执行成功，整个事务才提交。事务中的任何一个数据库操作失败，已经执行的任何操作都必须被撤销，让数据库返回初始状态。</p>
<p><code>C：Consistent</code>：一致性，事务完成后，所有数据的状态都是一致的，即A账户只要减去了100，B账户则必定加上了100；</p>
<p><code>I：Isolation</code>：在并发数据操作时，不同的事务拥有各自的数据空间，他们的操作不会对对方产生干扰。准确地说，并非要求做到完全无干扰。数据库规定了多种事务隔离界别，不同的隔离级别对应不用的干扰程度，隔离级别越高，数据一致性越好，但并发性越弱。</p>
<p><code>D：Duration</code>：一旦事务提交成功后，事务中操作的所有数据都必须被持久化到数据库中。即使在事务提交后，数据库马上崩溃，在数据库重启时，也必须保证能够通过某种机制恢复数据。</p>
<p>在这些事务特性中，数据<code>一致性</code>是最终目标，其他特性都是为达到这个目标而采取的措施、要求或手段。</p>
<p>对于单条SQL语句，数据库系统自动将其作为一个事务执行，这种事务被称为<em>隐式事务</em>。</p>
<p>要手动把多条SQL语句作为一个事务执行，使用<code>BEGIN</code>开启一个事务，使用<code>COMMIT</code>提交一个事务，这种事务被称为<em>显式事务</em>，例如，把上述的转账操作作为一个显式事务：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">BEGIN</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">UPDATE</span> accounts <span style="color:#fff;font-weight:bold">SET</span> balance = balance - <span style="color:#ff0;font-weight:bold">100</span> <span style="color:#fff;font-weight:bold">WHERE</span> id = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">UPDATE</span> accounts <span style="color:#fff;font-weight:bold">SET</span> balance = balance + <span style="color:#ff0;font-weight:bold">100</span> <span style="color:#fff;font-weight:bold">WHERE</span> id = <span style="color:#ff0;font-weight:bold">2</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">COMMIT</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>很显然多条SQL语句要想作为一个事务执行，就必须使用显式事务。</p>
<p><code>COMMIT</code>是指提交事务，即试图把事务内的所有SQL所做的修改永久保存。如果<code>COMMIT</code>语句执行失败了，整个事务也会失败。</p>
<p>有些时候，我们希望主动让事务失败，这时，可以用<code>ROLLBACK</code>回滚事务，整个事务会失败：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>BEGIN;
</span></span><span style="display:flex;"><span>UPDATE accounts SET balance = balance - 100 WHERE id = 1;
</span></span><span style="display:flex;"><span>UPDATE accounts SET balance = balance + 100 WHERE id = 2;
</span></span><span style="display:flex;"><span>ROLLBACK;
</span></span></code></pre></td></tr></table>
</div>
</div><p>数据库事务是由数据库系统保证的，我们只需要根据业务逻辑使用它就可以。</p>
<h2 id="隔离级别">隔离级别<a hidden class="anchor" aria-hidden="true" href="#隔离级别">#</a></h2>
<p>对于两个并发执行的事务，如果涉及到操作同一条记录的时候，可能会发生问题。因为并发操作会带来数据的不一致性，包括脏读、不可重复读、幻读等。数据库系统提供了隔离级别来让我们有针对性地选择事务的隔离级别，避免数据不一致的问题。</p>
<p>SQL标准定义了4种隔离级别，分别对应可能出现的数据不一致的情况：</p>
<table>
<thead>
<tr>
<th style="text-align:left">Isolation Level</th>
<th style="text-align:left">脏读（Dirty Read）</th>
<th style="text-align:left">不可重复读（Non Repeatable Read）</th>
<th style="text-align:left">幻读（Phantom Read）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Read Uncommitted</td>
<td style="text-align:left">Yes</td>
<td style="text-align:left">Yes</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:left">Read Committed</td>
<td style="text-align:left">-</td>
<td style="text-align:left">Yes</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:left">Repeatable Read</td>
<td style="text-align:left">-</td>
<td style="text-align:left">-</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:left">Serializable</td>
<td style="text-align:left">-</td>
<td style="text-align:left">-</td>
<td style="text-align:left">-</td>
</tr>
</tbody>
</table>
<p>我们会依次介绍4种隔离级别的数据一致性问题。</p>
<h3 id="read-uncommitted">Read Uncommitted<a hidden class="anchor" aria-hidden="true" href="#read-uncommitted">#</a></h3>
<p>Read Uncommitted是隔离级别最低的一种事务级别。在这种隔离级别下，一个事务会读到另一个事务更新后但未提交的数据，如果另一个事务回滚，那么当前事务读到的数据就是脏数据，这就是脏读（Dirty Read）。</p>
<p>我们来看一个例子。</p>
<p>首先，我们准备好<code>students</code>表的数据，该表仅一行记录：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mysql&gt; select * from students;
</span></span><span style="display:flex;"><span>+----+-------+
</span></span><span style="display:flex;"><span>| id | name  |
</span></span><span style="display:flex;"><span>+----+-------+
</span></span><span style="display:flex;"><span>|  1 | Alice |
</span></span><span style="display:flex;"><span>+----+-------+
</span></span><span style="display:flex;"><span>1 row in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后，分别开启两个MySQL客户端连接，按顺序依次执行事务A和事务B：</p>
<table>
<thead>
<tr>
<th style="text-align:left">时刻</th>
<th style="text-align:left">事务A</th>
<th style="text-align:left">事务B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</td>
<td style="text-align:left">SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">BEGIN;</td>
<td style="text-align:left">BEGIN;</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">UPDATE students SET name = &lsquo;Bob&rsquo; WHERE id = 1;</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left"></td>
<td style="text-align:left">SELECT * FROM students WHERE id = 1;</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">ROLLBACK;</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left"></td>
<td style="text-align:left">SELECT * FROM students WHERE id = 1;</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left"></td>
<td style="text-align:left">COMMIT;</td>
</tr>
</tbody>
</table>
<p>当事务A执行完第3步时，它更新了<code>id=1</code>的记录，但并未提交，而事务B在第4步读取到的数据就是未提交的数据。</p>
<p>随后，事务A在第5步进行了回滚，事务B再次读取<code>id=1</code>的记录，发现和上一次读取到的数据不一致，这就是脏读。</p>
<p>可见，在Read Uncommitted隔离级别下，一个事务可能读取到另一个事务更新但未提交的数据，这个数据有可能是脏数据。</p>
<h3 id="read-committed">Read Committed<a hidden class="anchor" aria-hidden="true" href="#read-committed">#</a></h3>
<p>在Read Committed隔离级别下，一个事务可能会遇到不可重复读（Non Repeatable Read）的问题。</p>
<p>不可重复读是指，在一个事务内，多次读同一数据，在这个事务还没有结束时，如果另一个事务恰好修改了这个数据，那么，在第一个事务中，两次读取的数据就可能不一致。</p>
<p>我们仍然先准备好<code>students</code>表的数据：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mysql&gt; select * from students;
</span></span><span style="display:flex;"><span>+----+-------+
</span></span><span style="display:flex;"><span>| id | name  |
</span></span><span style="display:flex;"><span>+----+-------+
</span></span><span style="display:flex;"><span>|  1 | Alice |
</span></span><span style="display:flex;"><span>+----+-------+
</span></span><span style="display:flex;"><span>1 row in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后，分别开启两个MySQL客户端连接，按顺序依次执行事务A和事务B：</p>
<table>
<thead>
<tr>
<th style="text-align:left">时刻</th>
<th style="text-align:left">事务A</th>
<th style="text-align:left">事务B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">SET TRANSACTION ISOLATION LEVEL READ COMMITTED;</td>
<td style="text-align:left">SET TRANSACTION ISOLATION LEVEL READ COMMITTED;</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">BEGIN;</td>
<td style="text-align:left">BEGIN;</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left"></td>
<td style="text-align:left">SELECT * FROM students WHERE id = 1; &ndash; Alice</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">UPDATE students SET name = &lsquo;Bob&rsquo; WHERE id = 1;</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">COMMIT;</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left"></td>
<td style="text-align:left">SELECT * FROM students WHERE id = 1; &ndash; Bob</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left"></td>
<td style="text-align:left">COMMIT;</td>
</tr>
</tbody>
</table>
<p>当事务B第一次执行第3步的查询时，得到的结果是<code>Alice</code>，随后，由于事务A在第4步更新了这条记录并提交，所以，事务B在第6步再次执行同样的查询时，得到的结果就变成了<code>Bob</code>，因此，在Read Committed隔离级别下，事务不可重复读同一条记录，因为很可能读到的结果不一致。</p>
<h3 id="repeatable-read">Repeatable Read<a hidden class="anchor" aria-hidden="true" href="#repeatable-read">#</a></h3>
<p>在Repeatable Read隔离级别下，一个事务可能会遇到幻读（Phantom Read）的问题。</p>
<p>幻读是指，在一个事务中，第一次查询某条记录，发现没有，但是，当试图更新这条不存在的记录时，竟然能成功，并且，再次读取同一条记录，它就神奇地出现了。</p>
<p>我们仍然先准备好<code>students</code>表的数据：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mysql&gt; select * from students;
</span></span><span style="display:flex;"><span>+----+-------+
</span></span><span style="display:flex;"><span>| id | name  |
</span></span><span style="display:flex;"><span>+----+-------+
</span></span><span style="display:flex;"><span>|  1 | Alice |
</span></span><span style="display:flex;"><span>+----+-------+
</span></span><span style="display:flex;"><span>1 row in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后，分别开启两个MySQL客户端连接，按顺序依次执行事务A和事务B：</p>
<table>
<thead>
<tr>
<th style="text-align:left">时刻</th>
<th style="text-align:left">事务A</th>
<th style="text-align:left">事务B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;</td>
<td style="text-align:left">SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">BEGIN;</td>
<td style="text-align:left">BEGIN;</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left"></td>
<td style="text-align:left">SELECT * FROM students WHERE id = 99; &ndash; empty</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">INSERT INTO students (id, name) VALUES (99, &lsquo;Bob&rsquo;);</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">COMMIT;</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left"></td>
<td style="text-align:left">SELECT * FROM students WHERE id = 99; &ndash; empty</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left"></td>
<td style="text-align:left">UPDATE students SET name = &lsquo;Alice&rsquo; WHERE id = 99; &ndash; 1 row affected</td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td style="text-align:left"></td>
<td style="text-align:left">SELECT * FROM students WHERE id = 99; &ndash; Alice</td>
</tr>
<tr>
<td style="text-align:left">9</td>
<td style="text-align:left"></td>
<td style="text-align:left">COMMIT;</td>
</tr>
</tbody>
</table>
<p>事务B在第3步第一次读取<code>id=99</code>的记录时，读到的记录为空，说明不存在<code>id=99</code>的记录。随后，事务A在第4步插入了一条<code>id=99</code>的记录并提交。事务B在第6步再次读取<code>id=99</code>的记录时，读到的记录仍然为空，但是，事务B在第7步试图更新这条不存在的记录时，竟然成功了，并且，事务B在第8步再次读取<code>id=99</code>的记录时，记录出现了。</p>
<p>可见，幻读就是没有读到的记录，以为不存在，但其实是可以更新成功的，并且，更新成功后，再次读取，就出现了。</p>
<h3 id="serializable">Serializable<a hidden class="anchor" aria-hidden="true" href="#serializable">#</a></h3>
<p>Serializable是最严格的隔离级别。在Serializable隔离级别下，所有事务按照次序依次执行，因此，脏读、不可重复读、幻读都不会出现。</p>
<p>虽然Serializable隔离级别下的事务具有最高的安全性，但是，由于事务是串行执行，所以效率会大大下降，应用程序的性能会急剧降低。如果没有特别重要的情景，一般都不会使用Serializable隔离级别。</p>
<h3 id="默认隔离级别">默认隔离级别<a hidden class="anchor" aria-hidden="true" href="#默认隔离级别">#</a></h3>
<p>如果没有指定隔离级别，数据库就会使用默认的隔离级别。在MySQL中，如果使用InnoDB，默认的隔离级别是Repeatable Read。</p>
<h1 id="分割线">=======分割线=======<a hidden class="anchor" aria-hidden="true" href="#分割线">#</a></h1>
<h1 id="增删改查">增删改查<a hidden class="anchor" aria-hidden="true" href="#增删改查">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>增：
</span></span><span style="display:flex;"><span>insert into 表名字(列名1，列名2...) values(值1，值2...)
</span></span><span style="display:flex;"><span>或：
</span></span><span style="display:flex;"><span>insert into 表名字 values(值1，值2...)
</span></span><span style="display:flex;"><span>若不指定列名，则需要插入全部字段。
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>删：
</span></span><span style="display:flex;"><span>delete from 表名字 where id = 1
</span></span><span style="display:flex;"><span>若不加where条件，则删除数据表中所有数据
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>改：
</span></span><span style="display:flex;"><span>update 表名字 set 列1=值1，列2=值2... where id = 1
</span></span><span style="display:flex;"><span>若不加where条件，则更新数据表中所有数据
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>查：
</span></span><span style="display:flex;"><span>select * from 表名字
</span></span><span style="display:flex;"><span>星号代表查询数据表中所有字段
</span></span><span style="display:flex;"><span>select id,stu_name,age, from 表名字
</span></span><span style="display:flex;"><span>查询多个字段，用逗号进行分割
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="数据类型-1">数据类型<a hidden class="anchor" aria-hidden="true" href="#数据类型-1">#</a></h1>
<p>MySQL 支持多种类型，大致可以分为三类：数值、日期/时间和字符串(字符)类型。</p>
<h2 id="数值类型">数值类型<a hidden class="anchor" aria-hidden="true" href="#数值类型">#</a></h2>
<p>MySQL 支持所有标准 SQL 数值数据类型。</p>
<p>这些类型包括严格数值数据类型(INTEGER、SMALLINT、DECIMAL 和 NUMERIC)，以及近似数值数据类型(FLOAT、REAL 和 DOUBLE PRECISION)。</p>
<p>关键字INT是INTEGER的同义词，关键字DEC是DECIMAL的同义词。</p>
<p>BIT数据类型保存位字段值，并且支持 MyISAM、MEMORY、InnoDB 和 BDB表。</p>
<p>作为 SQL 标准的扩展，MySQL 也支持整数类型 TINYINT、MEDIUMINT 和 BIGINT。下面的表显示了需要的每个整数类型的存储和范围。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>大小</th>
<th>范围（有符号）</th>
<th>范围（无符号）</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>TINYINT</td>
<td>1 Bytes</td>
<td>(-128，127)</td>
<td>(0，255)</td>
<td>小整数值</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2 Bytes</td>
<td>(-32 768，32 767)</td>
<td>(0，65 535)</td>
<td>大整数值</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3  Bytes</td>
<td>(-8 388 608，8 388 607)</td>
<td>(0，16 777 215)</td>
<td>大整数值</td>
</tr>
<tr>
<td>INT或INTEGER</td>
<td>4  Bytes</td>
<td>(-2 147 483 648，2 147 483 647)</td>
<td>(0，4 294 967 295)</td>
<td>大整数值</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8  Bytes</td>
<td>(-9,223,372,036,854,775,808，9 223 372 036 854 775 807)</td>
<td>(0，18 446 744 073 709 551 615)</td>
<td>极大整数值</td>
</tr>
<tr>
<td>FLOAT</td>
<td>4  Bytes</td>
<td>(-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)</td>
<td>0，(1.175 494 351 E-38，3.402 823 466 E+38)</td>
<td>单精度浮点数值</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8  Bytes</td>
<td>(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td>0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td>双精度浮点数值</td>
</tr>
<tr>
<td>DECIMAL</td>
<td>对DECIMAL(M,D) ，如果M&gt;D，为M+2否则为D+2</td>
<td>依赖于M和D的值</td>
<td>依赖于M和D的值</td>
<td>小数值</td>
</tr>
</tbody>
</table>
<h2 id="日期和时间类型">日期和时间类型<a hidden class="anchor" aria-hidden="true" href="#日期和时间类型">#</a></h2>
<p>表示时间值的日期和时间类型为DATETIME、DATE、TIMESTAMP、TIME和YEAR。</p>
<p>每个时间类型有一个有效值范围和一个&quot;零&quot;值，当指定不合法的MySQL不能表示的值时使用&quot;零&quot;值。</p>
<p>TIMESTAMP类型有专有的自动更新特性，将在后面描述。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>大小( bytes)</th>
<th>范围</th>
<th>格式</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>DATE</td>
<td>3</td>
<td>1000-01-01/9999-12-31</td>
<td>YYYY-MM-DD</td>
<td>日期值</td>
</tr>
<tr>
<td>TIME</td>
<td>3</td>
<td>&lsquo;-838:59:59&rsquo;/&lsquo;838:59:59&rsquo;</td>
<td>HH:MM:SS</td>
<td>时间值或持续时间</td>
</tr>
<tr>
<td>YEAR</td>
<td>1</td>
<td>1901/2155</td>
<td>YYYY</td>
<td>年份值</td>
</tr>
<tr>
<td>DATETIME</td>
<td>8</td>
<td>&lsquo;1000-01-01 00:00:00&rsquo; 到 &lsquo;9999-12-31 23:59:59&rsquo;</td>
<td>YYYY-MM-DD hh:mm:ss</td>
<td>混合日期和时间值</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>4</td>
<td>&lsquo;1970-01-01 00:00:01&rsquo; UTC 到 &lsquo;2038-01-19 03:14:07&rsquo; UTC 结束时间是第 2147483647 秒，北京时间 2038-1-19 11:14:07，格林尼治时间 2038年1月19日 凌晨 03:14:07</td>
<td>YYYY-MM-DD hh:mm:ss</td>
<td>混合日期和时间值，时间戳</td>
</tr>
</tbody>
</table>
<h2 id="字符串类型">字符串类型<a hidden class="anchor" aria-hidden="true" href="#字符串类型">#</a></h2>
<p>字符串类型指CHAR、VARCHAR、BINARY、VARBINARY、BLOB、TEXT、ENUM和SET。该节描述了这些类型如何工作以及如何在查询中使用这些类型。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>大小</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>CHAR</td>
<td>0-255 bytes</td>
<td>定长字符串</td>
</tr>
<tr>
<td>VARCHAR</td>
<td>0-65535 bytes</td>
<td>变长字符串</td>
</tr>
<tr>
<td>TINYBLOB</td>
<td>0-255 bytes</td>
<td>不超过 255 个字符的二进制字符串</td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>0-255 bytes</td>
<td>短文本字符串</td>
</tr>
<tr>
<td>BLOB</td>
<td>0-65 535 bytes</td>
<td>二进制形式的长文本数据</td>
</tr>
<tr>
<td>TEXT</td>
<td>0-65 535 bytes</td>
<td>长文本数据</td>
</tr>
<tr>
<td>MEDIUMBLOB</td>
<td>0-16 777 215 bytes</td>
<td>二进制形式的中等长度文本数据</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>0-16 777 215 bytes</td>
<td>中等长度文本数据</td>
</tr>
<tr>
<td>LONGBLOB</td>
<td>0-4 294 967 295 bytes</td>
<td>二进制形式的极大文本数据</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>0-4 294 967 295 bytes</td>
<td>极大文本数据</td>
</tr>
</tbody>
</table>
<p><strong>注意</strong>：char(n) 和 varchar(n) 中括号中 n 代表字符的个数，并不代表字节个数，比如 CHAR(30) 就可以存储 30 个字符。</p>
<p>CHAR 和 VARCHAR 类型类似，但它们保存和检索的方式不同。它们的最大长度和是否尾部空格被保留等方面也不同。在存储或检索过程中不进行大小写转换。</p>
<p>BINARY 和 VARBINARY 类似于 CHAR 和 VARCHAR，不同的是它们包含二进制字符串而不要非二进制字符串。也就是说，它们包含字节字符串而不是字符字符串。这说明它们没有字符集，并且排序和比较基于列值字节的数值值。</p>
<p>BLOB 是一个二进制大对象，可以容纳可变数量的数据。有 4 种 BLOB 类型：TINYBLOB、BLOB、MEDIUMBLOB 和 LONGBLOB。它们区别在于可容纳存储范围不同。</p>
<p>有 4 种 TEXT 类型：TINYTEXT、TEXT、MEDIUMTEXT 和 LONGTEXT。对应的这 4 种 BLOB 类型，可存储的最大长度不同，可根据实际情况选择。</p>
<h1 id="表相关">表相关<a hidden class="anchor" aria-hidden="true" href="#表相关">#</a></h1>
<ul>
<li>创建数据表:</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">table</span>[<span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">not</span> <span style="color:#fff;font-weight:bold">exists</span>] <span style="color:#fff;font-weight:bold">table_name</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#f00">列名</span> <span style="color:#f00">类型</span> <span style="color:#f00">是否为空</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f00">列名</span> <span style="color:#f00">类型</span> <span style="color:#f00">是否为空</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `grade` (
</span></span><span style="display:flex;"><span>  `id` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) unsigned <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT,
</span></span><span style="display:flex;"><span>  `grade_name` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">10</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;年级名字&#39;</span>,
</span></span><span style="display:flex;"><span>  `create_time` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;创建时间&#39;</span>,
</span></span><span style="display:flex;"><span>  `<span style="color:#fff;font-weight:bold">version</span>` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;1&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;版本号&#39;</span>,
</span></span><span style="display:flex;"><span>  `sort` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;排序&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8 <span style="color:#fff;font-weight:bold">COMMENT</span>=<span style="color:#0ff;font-weight:bold">&#39;年级表&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>字段参数说明：
<code> id int(11) NOT NULL AUTO_INCREMENT</code>
id：字段名称
int(11)：字段类型及长度
DEFAULT NULL：默认为空，不可空是not null
AUTO_INCREMENT：自动递增，一般此属性只应用在主键上
COMMENT：字段说明</p>
<ul>
<li>修改数据表</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ALTER TABLE &lt;表名&gt;
</span></span><span style="display:flex;"><span>[ALTER COLUMN &lt;列名&gt; &lt;新数据类型&gt;]
</span></span><span style="display:flex;"><span>|[ADD &lt;列名&gt; &lt;数据类型&gt; [属性]
</span></span><span style="display:flex;"><span>|[DROP COLUMN &lt;列名&gt;]
</span></span><span style="display:flex;"><span>|[ADD [constraint] [约束名] 约束定义
</span></span><span style="display:flex;"><span>|[DROP [constraint] 约束名]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>删除表
<code>DROP TABLE [if exists] table_name</code></p>
</li>
<li>
<p>显示表的数据结构
<code>desc table_name</code></p>
</li>
<li>
<p>查看数据库中所有的表
<code>show tables</code></p>
</li>
<li>
<p>新增字段
<code>alter table table_name add column_name varchar(200) not null default 0 COMMENT &quot;描述&quot;;</code></p>
</li>
<li>
<p>修改字段属性
<code>alter table table_name modify column_name VARCHAR(200) NULL DEFAULT null COMMENT '这是字段描述';</code></p>
</li>
<li>
<p>修改字段名
<code>alter table &lt;表名&gt; change &lt;字段名&gt; &lt;字段新名称&gt; &lt;字段的类型&gt;</code></p>
</li>
<li>
<p>删除字段
<code>ALTER TABLE 表名 DROP 列名</code></p>
</li>
<li>
<p>复制表
结构、数据都复制：
<code>CREATE TABLE 新表名 SELECT * FROM 旧表名</code>
仅结构
<code>CREATE TABLE 新表名 LIKE 旧表名</code></p>
</li>
<li>
<p>A表数据导入B表：
<code>INSERT INTO 表名 SELECT * FROM 有数据的表</code></p>
</li>
<li>
<p>仅复制表结构
<code>create table my_table_copy2 like my_table;</code></p>
</li>
<li>
<p>复制表结构和数据
<code>create table my_table_copy1 select * from my_table;</code>
注意：该语句只是按select语句执行的结果新建表，并不会复制表的主键、索引等信息。</p>
</li>
<li>
<p>完全复制表
<code>create table my_table_copy2 like my_table;</code>
<code>insert into my_table_copy2 select * from my_table;</code></p>
</li>
<li>
<p>复制表，同时重新定义字段名
<code>create table my_table_copy3</code>
<code>select id,username yhm,realname xm,email dzyj,address dz from my_table;</code></p>
</li>
<li>
<p>复制表，同时定义字段信息
<code>create table my_table_copy4 (id INTEGER not null auto_increment PRIMARY KEY) select * from my_table;</code></p>
</li>
<li>
<p>检查数据表是否存在
<code>SELECT table_name FROM information_schema.tables WHERE table_name=#{tableName, jdbcType=VARCHAR}</code></p>
</li>
<li>
<p>检查表字段是否存在
<code>SELECT column_name FROM information_schema.columns WHERE table_name=#{tableName, jdbcType=VARCHAR} AND column_name=#{columnName, jdbcType=VARCHAR}</code></p>
</li>
</ul>
<h2 id="创建索引">创建索引<a hidden class="anchor" aria-hidden="true" href="#创建索引">#</a></h2>
<p>添加PRIMARY KEY(主键索引)
<code>alter table </code>table_name<code> add primary key(</code>column<code>);</code>
添加UNIQUE(唯一索引)
<code>alter table </code>table_name<code> add unique(</code>column<code>);</code>
添加普通索引
<code>alter table </code>table_name<code> add index index_name(</code>column<code>);</code>
添加全文索引
<code>alter table </code>table_name<code> add fulltext(</code>column<code>);</code>
添加多列索引
<code>alter table </code>table_name<code> add index index_name(</code>column1<code>,</code>column2<code>,</code>column3<code>);</code></p>
<h1 id="主外键">主外键<a hidden class="anchor" aria-hidden="true" href="#主外键">#</a></h1>
<p>主键：<code>primary_key</code></p>
<ul>
<li>保证数据唯一性</li>
<li>一个数据表只能有一个主键</li>
<li>主键不可以为空，并且不可以重复</li>
</ul>
<p>外键：<code>foreign key</code></p>
<ul>
<li>保证数据的完整性，一致性</li>
<li>外键列和参照列的数据类型必须一致</li>
<li>参照列的表为父表，外键列的表为子表</li>
<li>实现一对多，多对一的关系</li>
<li>外键列和参照列必须创建索引，如不创建，mySQL会自动创建</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">table</span> test(
</span></span><span style="display:flex;"><span>	id <span style="color:#fff;font-weight:bold">int</span> primary_key auto_increment,
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">foreign</span> <span style="color:#fff;font-weight:bold">key</span>(test1_id) <span style="color:#fff;font-weight:bold">references</span>  test2(id)
</span></span><span style="display:flex;"><span>	//<span style="color:#f00">外键列为</span>test1_id(<span style="color:#f00">当前表的列</span>),<span style="color:#f00">参照了</span>test2<span style="color:#f00">表的</span>id<span style="color:#f00">列</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>尽量不要使用外键，我们一般人为的人为表与表之间是相关联的。如：
班级表class为主表，在学生表student中加入class_id字段，表示班级id，这样就人为的认为student为class的字表，两张表就关联起来了。使用外键在删除表或修改表结构时，会造成很大麻烦。</p>
<h1 id="where条件">where条件<a hidden class="anchor" aria-hidden="true" href="#where条件">#</a></h1>
<ul>
<li>可以跟在<code>select、update、delete</code>后</li>
<li>多个where条件，并且的关系，用and链接，或者的关系，用or链接</li>
<li><code>group by</code>：把查询结构进行分组，分组结果可以升序(asc)或降序(desc)，默认升序，用于去重</li>
<li><code>having</code>：如果要将group by的结果进行删选，需要用到having关键字，不可以用where</li>
<li><code>order by</code>：把查询结果进行排序，可升(asc)可降(desc)，默认升序，可以进行多次排序，用逗号分割排序字段，越靠前，优先级越高</li>
<li><code>limit</code>：限制查询返回的结果(用于分页功能)是select语句的最后一个关键字
参数1：从第几条结果开始获取
参数2：获取几条结果
只写一个参数：获取几条结果</li>
</ul>
<p>select语句结构：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> <span style="color:#fff;font-weight:bold">table_name</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">join</span> table_name_b <span style="color:#fff;font-weight:bold">on</span> ...
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">where</span>
</span></span><span style="display:flex;"><span>	 gruop <span style="color:#fff;font-weight:bold">by</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#fff;font-weight:bold">having</span>
</span></span><span style="display:flex;"><span>	   <span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#fff;font-weight:bold">limit</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>关键字顺序不可以颠倒</p>
<h2 id="where条件参数介绍">where条件参数介绍<a hidden class="anchor" aria-hidden="true" href="#where条件参数介绍">#</a></h2>
<p>以下参数必须跟在where关键字后面，作为where的修饰
<code>=</code>：相等
<code>&gt;=</code>：大于等于
<code>&lt;=</code>：小于等于
<code>is [not] null</code>：为null(不为null)
<code>[not] like</code>：模糊查询
<code>[not] between ... and ..</code>：(不包含)包含在范围内
<code>[not] in</code>：包含在指定范围值内</p>
<h2 id="null">null<a hidden class="anchor" aria-hidden="true" href="#null">#</a></h2>
<p>使用NULL条件检索时不能使用=号，必须使用is：<code>is null</code>，不能是<code>= null</code></p>
<h2 id="like模糊查询">like(模糊查询)<a hidden class="anchor" aria-hidden="true" href="#like模糊查询">#</a></h2>
<p><code>select * from student where stu_name like '%小%';</code>
<code>%</code>表示可随意替换
<code>小%</code>表示必须以小开头，后边随意
<code>%小</code>表示必须以小结尾，前边随意
<code>%小%</code>表示前后都随意，中间包含小</p>
<h2 id="notbetween--and-">[not]between &hellip; and &hellip;<a hidden class="anchor" aria-hidden="true" href="#notbetween--and-">#</a></h2>
<p>范围获取值：
<code>select * from user where id between 1 and 15 ;</code>
属于where关键字，可用大于号和小于号来实现相同的功能</p>
<h2 id="notin">[not]in<a hidden class="anchor" aria-hidden="true" href="#notin">#</a></h2>
<p>判断一个字段的值是否与括号内的值相同，括号内是or的关系，即满足任何一个条件，都会显示出来
<code>select * from user where id in(1,2,3) ;</code></p>
<h1 id="字符函数">字符函数<a hidden class="anchor" aria-hidden="true" href="#字符函数">#</a></h1>
<p><code>concat(str1,str2,...)</code>：拼接字符串
<code>length(str)</code>：字符串长度
<code>lower(str)</code>：字符串转小写
<code>upper(str)</code>：字符串转大写
<code>trim(str)</code>：去除字符串前后的空格
<code>right(str,1)</code>：右侧开始截取，参数2位截取几位
<code>left(str,1)</code>：左侧开始截取字符串，参数2为截取几位
<code>replace(参数1，参数2，参数3):</code>：1.要处理的字符串2.要替换的字符3.替换成什么
<code>substring(参数1，参数2，参数3)</code>：1.要截取的字符串2.从第几位开始截取3.截取的长度
<code>locate(字符,字段名)</code>
使用locate(字符,字段名)函数，如果包含，返回&gt;0的数，否则返回0
<code>select * from 表名 where position(字符 in 字段);</code></p>
<p>例子：判断site表中的url是否包含&rsquo;http://&lsquo;子串,如果不包含则拼接在url字符串开头
<code>update site set url =concat('http://',url) where locate('http://',url)=0</code></p>
<p>replace具备替换拥有唯一索引或者主键索引重复数据的能力，也就是如果使用replace into插入的数据的唯一索引或者主键索引与之前的数据有重复的情况，将会删除原先的数据，然后再进行添加。
replace into函数：
<code>REPLACE INTO users (id,name,age) VALUES(123, ‘chao’, 50);</code></p>
<p>问题：
已知一个数字字段，内容不规律，最长有10位，最短有4位，
想把不够10位的全部在前边用0补齐，怎么办?</p>
<p>SQL：
<code>update 表名字 set num = right(concat('000000',num),10);</code>
解：因为最短有4位，在每个字符串左侧都拼接6个0，然后从右侧开始截取10个字符</p>
<h1 id="聚合函数">聚合函数<a hidden class="anchor" aria-hidden="true" href="#聚合函数">#</a></h1>
<p>聚合函数就是：对一组值执行计算并返回单一的值。
一列的和：<code>select sum(列名) from 表名 where ...条件</code>
一列的最大值：<code>select max(列名) from 表名 where ...条件</code>
一列的最小值：<code>select min(列名) from 表名 where ...条件</code>
一列的数量：<code>select count(列名/一般都用id) from 表名 where ...条件</code>
一列的平均值：<code>select avg(列名) from 表名 where ...条件</code>
使用AVG聚合函数时，保留两位小数：
<code>CAST(AVG(time) AS DECIMAL(10,2)) as time</code></p>
<h1 id="数值函数">数值函数<a hidden class="anchor" aria-hidden="true" href="#数值函数">#</a></h1>
<p><code>ceil()</code>：向上取整
<code>floor()</code>：向下取整
<code>round()</code>：四舍五入
<code>power()</code>：幂运算</p>
<h1 id="日期时间函数">日期时间函数<a hidden class="anchor" aria-hidden="true" href="#日期时间函数">#</a></h1>
<p><code>now()</code>：当前时间(年月日-时分秒)
<code>curdate()</code>：当前日期(年月日)
<code>curtime()</code>：当前时间(时分秒)
<code>unix_timestamp()</code>：当前时间戳，如：1557729824，一共十位数，精确到秒，精确到毫秒需要十三位
<code>unix_timestamp(now())</code>：带参数，可以是一个DATE字符串，一个DATETIME字符串，一个TIMESTAMP或者一个当地时间的YYMMDD或YYYYMMDD格式的数字，表示自'1970-01-01 00:00:00&rsquo;与指定时间的秒数差</p>
<p><code>date_add()</code>：日期加减算法
参数1：要进行运算的日期
参数2：加或减的量
参数3：加或减的日期单位(小时，天，周，月，年)</p>
<p><code>datediff()</code>：日期差值计算
参数1：日期类型
参数2：日期类型</p>
<p><code>date_format()</code>：日期格式化
将指定日期，安装指定规则进行格式化(具体请百度该函数)
<code>date_format('2017-1-1','%y/%m/%d/')---&gt;2017/1/1</code>
注：该函数会导致索引失效</p>
<h1 id="加密函数">加密函数<a hidden class="anchor" aria-hidden="true" href="#加密函数">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>AES_ENCRYPT(value,<span style="color:#fff;font-weight:bold">key</span>)
</span></span><span style="display:flex;"><span><span style="color:#f00">加密方法：</span>value<span style="color:#f00">为需要加密的明文，当然也可以是表中某一列的名称，</span>key<span style="color:#f00">为加密使用的密钥。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>AES_DECRYPT(value,<span style="color:#fff;font-weight:bold">key</span>)
</span></span><span style="display:flex;"><span><span style="color:#f00">解密方法：</span>value<span style="color:#f00">为需要解密的密文，可以为解密的密钥。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">使用示例：</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> AES_ENCRYPT(<span style="color:#0ff;font-weight:bold">&#39;张三&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;qwe123&#39;</span>),to_base64(aes_encrypt(<span style="color:#0ff;font-weight:bold">&#39;张三&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;qwe123&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> AES_DECRYPT(from_base64(<span style="color:#0ff;font-weight:bold">&#39;EJeQE9hPLWe3tX5jlzZX8A==&#39;</span>),<span style="color:#0ff;font-weight:bold">&#39;qwe123&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">注意：</span>mysql<span style="color:#f00">和</span>java<span style="color:#f00">的</span>Aes<span style="color:#f00">加密结果不一致的问题。</span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f00">默认使用的</span><span style="color:#ff0;font-weight:bold">128</span><span style="color:#f00">位，加密方法为</span><span style="color:#0ff;font-weight:bold">&#34;ECB&#34;</span><span style="color:#f00">，填充方法为</span><span style="color:#0ff;font-weight:bold">&#34;PKCS7&#34;</span><span style="color:#f00">；</span>
</span></span><span style="display:flex;"><span>java<span style="color:#f00">默认使用的是</span><span style="color:#ff0;font-weight:bold">128</span><span style="color:#f00">位，加密方式为</span><span style="color:#0ff;font-weight:bold">&#34;ECB&#34;</span><span style="color:#f00">，填充方法为</span><span style="color:#0ff;font-weight:bold">&#34;PKCS5&#34;</span><span style="color:#f00">；</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">因此导致结果不一致。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="case-when">case when<a hidden class="anchor" aria-hidden="true" href="#case-when">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>select case(
</span></span><span style="display:flex;"><span>	when sex=&#39;0&#39; then &#39;女&#39;
</span></span><span style="display:flex;"><span>	when sex=&#39;1&#39; then &#39;男&#39;
</span></span><span style="display:flex;"><span>	end
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>from 表名
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>case when</code>用于查询时替换表中数据，如性别字段，里面有0和1，查询时可分别把0和1替换成女和男</p>
<h1 id="表连接">表连接<a hidden class="anchor" aria-hidden="true" href="#表连接">#</a></h1>
<p>需要注意：</p>
<ul>
<li>查询结果在哪个表</li>
<li>链接哪个表</li>
<li>链接条件</li>
<li>where条件</li>
</ul>
<h2 id="表连接类型">表连接类型<a hidden class="anchor" aria-hidden="true" href="#表连接类型">#</a></h2>
<ul>
<li><code>cross join</code>：交叉连接</li>
<li><code>inner join</code>：内连接</li>
<li>外链接分为两种：
<code>left join</code>：左外连接
<code>right join</code>：右外链接</li>
<li><code>union 和 union all</code>：联合查询</li>
<li><code>full join</code>：全连接</li>
</ul>
<p>示例表1：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> t1 (
</span></span><span style="display:flex;"><span>  t1_id <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT,
</span></span><span style="display:flex;"><span>  t1_str <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB AUTO_INCREMENT=<span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8;
</span></span></code></pre></td></tr></table>
</div>
</div><p>填充数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> test.t1(t1_id, t1_str) <span style="color:#fff;font-weight:bold">VALUES</span> (<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#0ff;font-weight:bold">&#39;1&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> test.t1(t1_id, t1_str) <span style="color:#fff;font-weight:bold">VALUES</span> (<span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#0ff;font-weight:bold">&#39;2&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> test.t1(t1_id, t1_str) <span style="color:#fff;font-weight:bold">VALUES</span> (<span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#0ff;font-weight:bold">&#39;3&#39;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>示例表2：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> t2 (
</span></span><span style="display:flex;"><span>  t2_id <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT,
</span></span><span style="display:flex;"><span>  t2_str <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB AUTO_INCREMENT=<span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8;
</span></span></code></pre></td></tr></table>
</div>
</div><p>填充数据：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>INSERT INTO test.t2(id,t2_str) VALUES (2, &#39;a&#39;);
</span></span><span style="display:flex;"><span>INSERT INTO test.t2(id,t2_str) VALUES (3, &#39;b&#39;);
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="交叉连接">交叉连接<a hidden class="anchor" aria-hidden="true" href="#交叉连接">#</a></h2>
<p>语法：
<code>select * from t1 cross join t2;</code>
在mysql中，上述查询语句查询出的结果与如下语句相同：
<code>select * from t1,t2;</code>
上述查询的结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>t1_id	t1_str	t2_id	t2_str
</span></span><span style="display:flex;"><span>1	1	2	a
</span></span><span style="display:flex;"><span>1	1	3	b
</span></span><span style="display:flex;"><span>2	2	2	a
</span></span><span style="display:flex;"><span>2	2	3	b
</span></span><span style="display:flex;"><span>3	3	2	a
</span></span><span style="display:flex;"><span>3	3	3	b
</span></span></code></pre></td></tr></table>
</div>
</div><p>观察数据发现：
t1表的每一行记录，都与t2表中的任意一条数据关联，反之，t2表的每一行记录，都与t1表中的任意一条数据关联。
换句话说：两张表中的数据被交叉连接在了一起。
我们把上述<strong>没有任何条件的连接</strong>称为交叉连接，该连接得到的结果与线性代数中<strong>笛卡尔积</strong>一样。</p>
<p>不难发现，使用交叉连接时，任意一张表中的记录多出一行，<code>交叉连接</code>的数量都会增长很多，而且得到的数据没有意义，所以通过交叉连接进行多表查询这种方法，应尽量避免使用。</p>
<h2 id="内连接">内连接<a hidden class="anchor" aria-hidden="true" href="#内连接">#</a></h2>
<p>概念：两张表中同时符合某种条件的数据的组合。
语法：
<code>SELECT * FROM t1,t2 where t1.t1_id = t2.t2_id</code>
另一种写法：
<code>SELECT * FROM t1 inner join t2 on t1.t1_id = t2.t2_id</code>
inner字段可以省略。</p>
<p>查询结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>t1_id	t1_str	t2_id	t2_str
</span></span><span style="display:flex;"><span>2	2	2	a
</span></span><span style="display:flex;"><span>3	3	3	b
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面的sql语句查询出了t1表与t2表中id号相同的记录，并把两表中id号相同的记录连接在了一起。
其中，where或on后边的语句就是&quot;某种条件&quot;，查询结果就是&quot;数据的组合&quot;，这就是内连接，官方建议使用第二种写法。</p>
<p>mysql中，内连接与交叉连接的不同之处就是，内连接比交叉连接有更多的限制条件。经过试验证明(试验代码略)，无论是给内连接(inner join)去掉限制条件(where、on)，还是给交叉连接加上限制条件(where、on)，得到的结果都是一样的。
即，双方加条件结果一致，不加条件结果也一致。那么两者可以互相代替么？(待补充)</p>
<p>注意：内连接只是根据条件查询出了两张表中符合条件的数据的组合，如：t1表中t1_id号为1的数据就没有被查出来。
刚才我们使用的是<strong>等值连接</strong>，限制条件通过等号相连，
那么相应的还有<strong>不等连接</strong>，即条件不是通过等号相连。如：
<code>SELECT * FROM t1 inner join t2 on t1.t1_id &gt; t2.t2_id</code>
查询结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>t1_id	t1_str	t2_id	t2_str
</span></span><span style="display:flex;"><span>3	3	2	a
</span></span></code></pre></td></tr></table>
</div>
</div><p>应该灵活使用等值或不等值连接。</p>
<p>注意：不能用<strong>交集</strong>的概念去解释内连接。
交集：同时属于集合A、B的元素所组成的集合称为交集。
但上面结果中，id号为1的数据只属于t1表，t2表中不存在。所以内连接定义为：
<strong>同时满足条件的数据的组合</strong></p>
<h2 id="外链接left-join--right-join">外链接：left join , right join<a hidden class="anchor" aria-hidden="true" href="#外链接left-join--right-join">#</a></h2>
<p>外链接分为两种，左外连接和右外链接。</p>
<p>语法：
<code>SELECT * FROM t1 left outer join t2 on t1.t1_id = t2.t2_id</code></p>
<p>结果如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>t1_id	t1_str	t2_id	t2_str
</span></span><span style="display:flex;"><span>2	2	2	a
</span></span><span style="display:flex;"><span>3	3	3	b
</span></span><span style="display:flex;"><span>1	1
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过与内连接的查询结果对比，发现左外连接查出的数据更多一些，多出的一行记录由t1表中的id号为1的记录和一条&quot;空记录&quot;组成。
可是t2表中并不存在id号为1的记录啊，为什么不符合连接条件的记录也会出现在查询结果中呢？这就是左外连接的特性。</p>
<p>左外连接不仅会查询出两表中同时符合条件的记录的组合，同时还会将&quot;left outer join&quot;左侧的表中的不符合条件的记录同时展示出来，由于左侧表中的这一部分记录并不符合连接条件，所以这一部分记录使用&quot;空记录&quot;进行连接。
换句话说，左外连接&quot;左侧的表&quot;中的所有记录都会被展示出来，左侧表中符合条件的记录将会与右侧表中符合条件的记录相互连接组合，左侧表中不符合条件的记录将会与右侧表中的&quot;空记录&quot;进行连接。
上述示例中的t1表就是&quot;left outer join&quot;左侧的表，t2表就是&quot;left outer join&quot;右侧的表，连接条件就是t1id=t2id，虽然t1表中id号为1的记录不满足连接条件，但是仍然会被展示出来，t2表中会使用&quot;空记录&quot;与其进行连接，表示t1表中对应的记录是不满足连接条件的记录。</p>
<p>了解了左外连接，那么右外链接与之相反，右表中所有记录会被展示，右表中符合条件的记录会与左表中符合条件的记录相互连接组合，右表中不符合条件的记录会与左表中的空记录进行连接。那么在此就不对右外链接做过多说明了。
其实，左外连接一般简称为左连接，left outer join 简写为 left join，右外链接简称为右连接。简写为 right join。</p>
<h2 id="联合查询union-和-union-all">联合查询：union 和 union all<a hidden class="anchor" aria-hidden="true" href="#联合查询union-和-union-all">#</a></h2>
<p>语法：
<code>select column_name(s) from table_name1 union select column_name(s) from table_name2</code></p>
<p>结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>t1_id	t1_str
</span></span><span style="display:flex;"><span>1	1
</span></span><span style="display:flex;"><span>2	2
</span></span><span style="display:flex;"><span>3	3
</span></span><span style="display:flex;"><span>2	a
</span></span><span style="display:flex;"><span>3	b
</span></span></code></pre></td></tr></table>
</div>
</div><p>两张表的结果被集中显示到了一起。union前表的数据在前边显示，union后的后边显示。
注：使用union连接两个语句时，两个语句查询出的字段数量必须相同，否则无法使用union进行联合查询。</p>
<p>使用union将两个结果集集中显示时，重复的数据会被合并为一条，如果想显示全部数据，请使用union all，这也是union和union all的唯一区别。</p>
<h2 id="全连接full-join">全连接：full join<a hidden class="anchor" aria-hidden="true" href="#全连接full-join">#</a></h2>
<p>在sql标准中，有一种被称为&quot;全连接&quot;的多表查询方式，但是mysql并不支持全连接。
不过，我们可以变相的实现&quot;全连接&quot;，在mysql中，我们可以使用&quot;left join&quot;、&ldquo;union&rdquo;、&ldquo;right join&quot;的组合实现所谓的&quot;全连接&rdquo;。</p>
<p>实现方式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>SELECT * FROM t1 left join t2 on t1.t1_id = t2.t2_id
</span></span><span style="display:flex;"><span>union
</span></span><span style="display:flex;"><span>SELECT * FROM t1 right outer join t2 on t1.t1_id = t2.t2_id
</span></span></code></pre></td></tr></table>
</div>
</div><p>结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>t1_id	t1_str	t2_id	t2_str
</span></span><span style="display:flex;"><span>2	2	2	a
</span></span><span style="display:flex;"><span>3	3	3	b
</span></span><span style="display:flex;"><span>1	1
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="子查询">子查询<a hidden class="anchor" aria-hidden="true" href="#子查询">#</a></h1>
<p>语法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>select column_name from table_name
</span></span><span style="display:flex;"><span>where id in (select ...)
</span></span></code></pre></td></tr></table>
</div>
</div><p>所谓子查询，就是嵌套在其他查询语句中的查询，子查询的形式有非常多，可以写在：</p>
<ul>
<li><code>select</code>后，作为一个列(column)</li>
<li><code>where</code>后，作为条件
等等&hellip;</li>
</ul>
<h1 id="一些问题">一些问题<a hidden class="anchor" aria-hidden="true" href="#一些问题">#</a></h1>
<h2 id="only_full_group_by">only_full_group_by<a hidden class="anchor" aria-hidden="true" href="#only_full_group_by">#</a></h2>
<p>mysql5.7以上的，默认的sql_mode包含ONLY_FULL_GROUP_BY。
这个属性的意思是：sql中select后面的字段必须出现在group by后面，或者被聚合函数包裹，不然会抛出上面的错误。
<code>select name, age from user group by age</code>
这么写就会报上面的错误。以上面的操作为例，当仅仅返回name字段的时候，MySQL是不确定到底返回哪个name，所以应该对其进行额外的操作，比如连接起来一起显示。
<code>select group_concat(name),age from user group by age;</code></p>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html#sqlmode_only_full_group_by">官方的解释</a></p>
<p>大致意思就是对于GROUP_BY聚合操作，如果在SELECT中的列既没有在GROUP_BY中出现，本身也不是聚合列（使用SUM，ANG等修饰的列），那么这句SQL是不合法的，因为那一列是不确定的。</p>
<p>这个模式是很有意义的，对于语义限制都比较严谨的多家数据库，如SQLServer、Oracled等数据库都不支持select target list中出现语义不明确的列，这样的语句在这些数据库中是会被报错的，所以从MySQL 5.7版本开始修正了这个语义，就是所说的ONLY_FULL_GROUP_BY语义。</p>
<p>关闭 only_full_group_by（不推荐）
查看sql_mode的语句如下：
<code>select @@GLOBAL.sql_mode;</code></p>
<p>可以使用sql语句临时修改sql_mode：
<code>set @@GLOBAL.sql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</code></p>
<p>还需要刷新一下：
<code>flush privileges;</code></p>
<p>但是重启mysql数据库之后，ONLY_FULL_GROUP_BY又出现了，所以需要修改mysql配置文件。通过手动添加sql_mode的方式强制指定不需要ONLY_FULL_GROUP_BY属性，my.cnf位于etc文件夹下，vim下光标移到最后，添加如下：
<code>sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</code>
重启后问题解决。</p>
<h2 id="删除数据">删除数据<a hidden class="anchor" aria-hidden="true" href="#删除数据">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">delete</span> <span style="color:#fff;font-weight:bold">from</span> <span style="color:#fff;font-weight:bold">table</span> <span style="color:#fff;font-weight:bold">where</span> id <span style="color:#fff;font-weight:bold">in</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">select</span> a.id <span style="color:#fff;font-weight:bold">from</span> <span style="color:#fff;font-weight:bold">table</span> <span style="color:#fff;font-weight:bold">where</span> name <span style="color:#fff;font-weight:bold">like</span> <span style="color:#0ff;font-weight:bold">&#39;xxx&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>错误：You can&rsquo;t specify target table &lsquo;xxx&rsquo; for update in FROM clause
意思是：不能先select同一个表的某些值，然后再update这个表。
解决办法：临时表</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">delete</span> <span style="color:#fff;font-weight:bold">from</span> <span style="color:#fff;font-weight:bold">table</span> <span style="color:#fff;font-weight:bold">where</span> id <span style="color:#fff;font-weight:bold">in</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span>(
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">select</span> a.id <span style="color:#fff;font-weight:bold">from</span> <span style="color:#fff;font-weight:bold">table</span> <span style="color:#fff;font-weight:bold">where</span> name <span style="color:#fff;font-weight:bold">like</span> <span style="color:#0ff;font-weight:bold">&#39;xxx&#39;</span>
</span></span><span style="display:flex;"><span>	)a
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="tinyint">tinyint<a hidden class="anchor" aria-hidden="true" href="#tinyint">#</a></h2>
<p>mysql字段类型为tinyint，tinyint(1)会在查询的时候转换成true false，tinyint(2)以及以上是不会的。这个和mybatis没关系</p>
<h1 id="explain关键字">explain关键字<a hidden class="anchor" aria-hidden="true" href="#explain关键字">#</a></h1>
<p>explain 可以获取 select 语句的执行计划，通过 explain 我们可以知道以下信息：表的读取顺序，数据读取操作的类型，哪些索引可以使用，哪些索引实际使用了，表之间的引用，每张表有多少行被优化器查询等信息。</p>
<p>在 select 语句之前增加 explain 关键字，MySQL 会在查询上设置一个标记，执行查询时，会返回执行计划的信息，而不是执行这条SQL（如果 from 中包含子查询，仍会执行该子查询，将结果放入临时表中）。</p>
<p>接下来介绍 explain 中每个列的信息。</p>
<h2 id="id">id<a hidden class="anchor" aria-hidden="true" href="#id">#</a></h2>
<p>id相同，执行顺序从上之下；
id不同，执行顺序从大到小；
id相同和不同，同时存在，遵守1、2规则。</p>
<table>
<thead>
<tr>
<th>id</th>
<th>select_type</th>
<th>table</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>PRIMARY</td>
<td>A</td>
</tr>
<tr>
<td>1</td>
<td>PRIMARY</td>
<td>B</td>
</tr>
<tr>
<td>2</td>
<td>SUBQUERY</td>
<td>B</td>
</tr>
</tbody>
</table>
<p>可以这样理解，执行顺序从大到小，先执行id为2的，然后执行id为1的（先A再B，规则1）；执行顺序为：第三行，第一行，第二行。</p>
<p>id列的编号是 select 的序列号，有几个 select 就有几个id，并且id的顺序是按 select 出现的顺序增长的。MySQL将 select 查询分为简单查询和复杂查询。复杂查询分为三类：简单子查询、派生表（from语句中的子查询）、union 查询。</p>
<h3 id="简单子查询">简单子查询<a hidden class="anchor" aria-hidden="true" href="#简单子查询">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> (<span style="color:#fff;font-weight:bold">select</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">from</span> actor <span style="color:#fff;font-weight:bold">limit</span> <span style="color:#ff0;font-weight:bold">1</span>) <span style="color:#fff;font-weight:bold">from</span> film;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span>  | possible_keys | <span style="color:#fff;font-weight:bold">key</span>      | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">PRIMARY</span>     | film  | <span style="color:#fff;font-weight:bold">index</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | idx_name | <span style="color:#ff0;font-weight:bold">32</span>      | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">2</span> | SUBQUERY    | actor | <span style="color:#fff;font-weight:bold">index</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">PRIMARY</span>  | <span style="color:#ff0;font-weight:bold">4</span>       | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">2</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="from子句中的子查询">from子句中的子查询<a hidden class="anchor" aria-hidden="true" href="#from子句中的子查询">#</a></h3>
<p>这个查询执行时有个临时表别名为der，外部 select 查询引用了这个临时表。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> id <span style="color:#fff;font-weight:bold">from</span> (<span style="color:#fff;font-weight:bold">select</span> id <span style="color:#fff;font-weight:bold">from</span> film) <span style="color:#fff;font-weight:bold">as</span> der;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span>      | <span style="color:#fff;font-weight:bold">type</span>  | possible_keys | <span style="color:#fff;font-weight:bold">key</span>      | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">PRIMARY</span>     | &lt;derived2&gt; | <span style="color:#fff;font-weight:bold">ALL</span>   | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span>     | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">2</span> | <span style="color:#fff;font-weight:bold">NULL</span>        |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">2</span> | DERIVED     | film       | <span style="color:#fff;font-weight:bold">index</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | idx_name | <span style="color:#ff0;font-weight:bold">32</span>      | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="union查询">union查询<a hidden class="anchor" aria-hidden="true" href="#union查询">#</a></h3>
<p>union结果总是放在一个匿名临时表中，临时表不在SQL总出现，因此它的id是NULL。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">union</span> <span style="color:#fff;font-weight:bold">all</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+--------------+------------+------+---------------+------+---------+------+------+-----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type  | <span style="color:#fff;font-weight:bold">table</span>      | <span style="color:#fff;font-weight:bold">type</span> | possible_keys | <span style="color:#fff;font-weight:bold">key</span>  | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra           |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+--------------+------------+------+---------------+------+---------+------+------+-----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">PRIMARY</span>      | <span style="color:#fff;font-weight:bold">NULL</span>       | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">No</span> tables used  |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">2</span> | <span style="color:#fff;font-weight:bold">UNION</span>        | <span style="color:#fff;font-weight:bold">NULL</span>       | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">No</span> tables used  |
</span></span><span style="display:flex;"><span>| <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">UNION</span> <span style="color:#fff;font-weight:bold">RESULT</span> | &lt;union1,<span style="color:#ff0;font-weight:bold">2</span>&gt; | <span style="color:#fff;font-weight:bold">ALL</span>  | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">temporary</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+--------------+------------+------+---------------+------+---------+------+------+-----------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="select_type">select_type<a hidden class="anchor" aria-hidden="true" href="#select_type">#</a></h2>
<p>select_type 表示对应行是是简单还是复杂的查询，如果是复杂的查询，又是上述三种复杂查询中的哪一种。</p>
<h3 id="simple">SIMPLE<a hidden class="anchor" aria-hidden="true" href="#simple">#</a></h3>
<p>简单select，不使用union和子查询</p>
<p><code>explain select * from A</code></p>
<h3 id="primary">primary<a hidden class="anchor" aria-hidden="true" href="#primary">#</a></h3>
<p>复杂查询中最外层的 select。</p>
<h3 id="subquery">subquery<a hidden class="anchor" aria-hidden="true" href="#subquery">#</a></h3>
<p>包含在 select 中的子查询（不在 from 子句中）</p>
<h3 id="derived">derived<a hidden class="anchor" aria-hidden="true" href="#derived">#</a></h3>
<p>包含在 from 子句中的子查询。MySQL会将结果存放在一个临时表中，也称为派生表（derived的英文含义）。</p>
<p>用这个例子来了解 primary、subquery 和 derived 类型。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> (<span style="color:#fff;font-weight:bold">select</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">from</span> actor <span style="color:#fff;font-weight:bold">where</span> id = <span style="color:#ff0;font-weight:bold">1</span>) <span style="color:#fff;font-weight:bold">from</span> (<span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> film <span style="color:#fff;font-weight:bold">where</span> id = <span style="color:#ff0;font-weight:bold">1</span>) der;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+--------+---------------+---------+---------+-------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span>      | <span style="color:#fff;font-weight:bold">type</span>   | possible_keys | <span style="color:#fff;font-weight:bold">key</span>     | key_len | <span style="color:#fff;font-weight:bold">ref</span>   | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+--------+---------------+---------+---------+-------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">PRIMARY</span>     | &lt;derived3&gt; | <span style="color:#fff;font-weight:bold">system</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span>  |    <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">NULL</span>        |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">3</span> | DERIVED     | film       | const  | <span style="color:#fff;font-weight:bold">PRIMARY</span>       | <span style="color:#fff;font-weight:bold">PRIMARY</span> | <span style="color:#ff0;font-weight:bold">4</span>       | const |    <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">NULL</span>        |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">2</span> | SUBQUERY    | actor      | const  | <span style="color:#fff;font-weight:bold">PRIMARY</span>       | <span style="color:#fff;font-weight:bold">PRIMARY</span> | <span style="color:#ff0;font-weight:bold">4</span>       | const |    <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+--------+---------------+---------+---------+-------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="union">union<a hidden class="anchor" aria-hidden="true" href="#union">#</a></h3>
<p>在 union 中的第二个和随后的 select</p>
<h3 id="union-result">union result<a hidden class="anchor" aria-hidden="true" href="#union-result">#</a></h3>
<p>从 union 临时表检索结果的 select。用这个例子来了解 union 和 union result 类型：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">union</span> <span style="color:#fff;font-weight:bold">all</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+--------------+------------+------+---------------+------+---------+------+------+-----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type  | <span style="color:#fff;font-weight:bold">table</span>      | <span style="color:#fff;font-weight:bold">type</span> | possible_keys | <span style="color:#fff;font-weight:bold">key</span>  | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra           |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+--------------+------------+------+---------------+------+---------+------+------+-----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">PRIMARY</span>      | <span style="color:#fff;font-weight:bold">NULL</span>       | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">No</span> tables used  |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">2</span> | <span style="color:#fff;font-weight:bold">UNION</span>        | <span style="color:#fff;font-weight:bold">NULL</span>       | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">No</span> tables used  |
</span></span><span style="display:flex;"><span>| <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">UNION</span> <span style="color:#fff;font-weight:bold">RESULT</span> | &lt;union1,<span style="color:#ff0;font-weight:bold">2</span>&gt; | <span style="color:#fff;font-weight:bold">ALL</span>  | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">temporary</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+--------------+------------+------+---------------+------+---------+------+------+-----------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="table">table<a hidden class="anchor" aria-hidden="true" href="#table">#</a></h2>
<p>显示数据来自于哪个表，有时不是真实的表的名字（虚拟表），虚拟表最后一位是数字，代表id为多少的查询。</p>
<h2 id="type">type<a hidden class="anchor" aria-hidden="true" href="#type">#</a></h2>
<p>这个字段直接反映SQL的执行效率，需要重点关注。
依次从最优到最差分别为：system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</p>
<h3 id="null-1">null<a hidden class="anchor" aria-hidden="true" href="#null-1">#</a></h3>
<p>mysql能够在优化阶段分解查询语句，在执行阶段用不着再访问表或索引。例如：在索引列中选取最小值，可以单独查找索引来完成，不需要在执行时访问表。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">min</span>(id) <span style="color:#fff;font-weight:bold">from</span> film;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span> | possible_keys | <span style="color:#fff;font-weight:bold">key</span>  | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra                        |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | <span style="color:#fff;font-weight:bold">NULL</span>  | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">Select</span> tables optimized away |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="constsystem">const、system<a hidden class="anchor" aria-hidden="true" href="#constsystem">#</a></h3>
<p>mysql能对查询的某部分进行优化并将其转化成一个常量（可以看show warnings 的结果）。用于 primary key 或 unique key 的所有列与常数比较时，所以表最多有一个匹配行，读取1次，速度比较快。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> extended <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> (<span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> film <span style="color:#fff;font-weight:bold">where</span> id = <span style="color:#ff0;font-weight:bold">1</span>) tmp;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+--------+---------------+---------+---------+-------+------+----------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span>      | <span style="color:#fff;font-weight:bold">type</span>   | possible_keys | <span style="color:#fff;font-weight:bold">key</span>     | key_len | <span style="color:#fff;font-weight:bold">ref</span>   | <span style="color:#fff;font-weight:bold">rows</span> | filtered | Extra |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+--------+---------------+---------+---------+-------+------+----------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">PRIMARY</span>     | &lt;derived2&gt; | <span style="color:#fff;font-weight:bold">system</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span>  |    <span style="color:#ff0;font-weight:bold">1</span> |   <span style="color:#ff0;font-weight:bold">100</span>.<span style="color:#ff0;font-weight:bold">00</span> | <span style="color:#fff;font-weight:bold">NULL</span>  |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">2</span> | DERIVED     | film       | const  | <span style="color:#fff;font-weight:bold">PRIMARY</span>       | <span style="color:#fff;font-weight:bold">PRIMARY</span> | <span style="color:#ff0;font-weight:bold">4</span>       | const |    <span style="color:#ff0;font-weight:bold">1</span> |   <span style="color:#ff0;font-weight:bold">100</span>.<span style="color:#ff0;font-weight:bold">00</span> | <span style="color:#fff;font-weight:bold">NULL</span>  |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+--------+---------------+---------+---------+-------+------+----------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">show</span> warnings;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">-------+------+---------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| <span style="color:#fff;font-weight:bold">Level</span> | Code | Message                                                       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">-------+------+---------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| Note  | <span style="color:#ff0;font-weight:bold">1003</span> | <span style="color:#007f7f">/* select#1 */</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#0ff;font-weight:bold">&#39;1&#39;</span> <span style="color:#fff;font-weight:bold">AS</span> `id`,<span style="color:#0ff;font-weight:bold">&#39;film1&#39;</span> <span style="color:#fff;font-weight:bold">AS</span> `name` <span style="color:#fff;font-weight:bold">from</span> dual |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">-------+------+---------------------------------------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="eq_ref">eq_ref<a hidden class="anchor" aria-hidden="true" href="#eq_ref">#</a></h3>
<p>primary key 或 unique key 索引的所有部分被连接使用（唯一性索引扫描） ，最多只会返回一条符合条件的记录，一般是两表关联，关联条件中的字段是主键或唯一索引。这可能是在 const 之外最好的联接类型了，简单的 select 查询不会出现这种 type。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> film_actor <span style="color:#fff;font-weight:bold">left</span> <span style="color:#fff;font-weight:bold">join</span> film <span style="color:#fff;font-weight:bold">on</span> film_actor.film_id = film.id;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+--------+---------------+-------------------+---------+-------------------------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span>      | <span style="color:#fff;font-weight:bold">type</span>   | possible_keys | <span style="color:#fff;font-weight:bold">key</span>               | key_len | <span style="color:#fff;font-weight:bold">ref</span>                     | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+--------+---------------+-------------------+---------+-------------------------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film_actor | <span style="color:#fff;font-weight:bold">index</span>  | <span style="color:#fff;font-weight:bold">NULL</span>          | idx_film_actor_id | <span style="color:#ff0;font-weight:bold">8</span>       | <span style="color:#fff;font-weight:bold">NULL</span>                    |    <span style="color:#ff0;font-weight:bold">3</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film       | eq_ref | <span style="color:#fff;font-weight:bold">PRIMARY</span>       | <span style="color:#fff;font-weight:bold">PRIMARY</span>           | <span style="color:#ff0;font-weight:bold">4</span>       | test.film_actor.film_id |    <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">NULL</span>        |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+--------+---------------+-------------------+---------+-------------------------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ref">ref<a hidden class="anchor" aria-hidden="true" href="#ref">#</a></h3>
<p>相比 <code>eq_ref</code>，不使用唯一索引，而是使用普通索引或者唯一性索引的部分前缀，索引要和某个值相比较，可能会找到多个符合条件的行。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">1</span>. <span style="color:#f00">简单</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#f00">查询，</span>name<span style="color:#f00">是普通索引（非唯一索引）</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> film <span style="color:#fff;font-weight:bold">where</span> name = <span style="color:#0ff;font-weight:bold">&#34;film1&#34;</span>;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+----------+---------+-------+------+--------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span> | possible_keys | <span style="color:#fff;font-weight:bold">key</span>      | key_len | <span style="color:#fff;font-weight:bold">ref</span>   | <span style="color:#fff;font-weight:bold">rows</span> | Extra                    |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+----------+---------+-------+------+--------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film  | <span style="color:#fff;font-weight:bold">ref</span>  | idx_name      | idx_name | <span style="color:#ff0;font-weight:bold">33</span>      | const |    <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">where</span>; <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+----------+---------+-------+------+--------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">2</span>.<span style="color:#f00">关联表查询，</span>idx_film_actor_id<span style="color:#f00">是</span>film_id<span style="color:#f00">和</span>actor_id<span style="color:#f00">的联合索引，这里使用到了</span>film_actor<span style="color:#f00">的左边前缀</span>film_id<span style="color:#f00">部分。</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> film <span style="color:#fff;font-weight:bold">left</span> <span style="color:#fff;font-weight:bold">join</span> film_actor <span style="color:#fff;font-weight:bold">on</span> film.id = film_actor.film_id;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span>      | <span style="color:#fff;font-weight:bold">type</span>  | possible_keys     | <span style="color:#fff;font-weight:bold">key</span>               | key_len | <span style="color:#fff;font-weight:bold">ref</span>          | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film       | <span style="color:#fff;font-weight:bold">index</span> | <span style="color:#fff;font-weight:bold">NULL</span>              | idx_name          | <span style="color:#ff0;font-weight:bold">33</span>      | <span style="color:#fff;font-weight:bold">NULL</span>         |    <span style="color:#ff0;font-weight:bold">3</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film_actor | <span style="color:#fff;font-weight:bold">ref</span>   | idx_film_actor_id | idx_film_actor_id | <span style="color:#ff0;font-weight:bold">4</span>       | test.film.id |    <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ref_or_null">ref_or_null<a hidden class="anchor" aria-hidden="true" href="#ref_or_null">#</a></h3>
<p>类似<code>ref</code>，但是可以搜索值为NULL的行。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> film <span style="color:#fff;font-weight:bold">where</span> name = <span style="color:#0ff;font-weight:bold">&#34;film1&#34;</span> <span style="color:#fff;font-weight:bold">or</span> name <span style="color:#fff;font-weight:bold">is</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------------+---------------+----------+---------+-------+------+--------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span>        | possible_keys | <span style="color:#fff;font-weight:bold">key</span>      | key_len | <span style="color:#fff;font-weight:bold">ref</span>   | <span style="color:#fff;font-weight:bold">rows</span> | Extra                    |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------------+---------------+----------+---------+-------+------+--------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film  | ref_or_null | idx_name      | idx_name | <span style="color:#ff0;font-weight:bold">33</span>      | const |    <span style="color:#ff0;font-weight:bold">2</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">where</span>; <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------------+---------------+----------+---------+-------+------+--------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="index_merge">index_merge<a hidden class="anchor" aria-hidden="true" href="#index_merge">#</a></h3>
<p>表示使用了索引合并的优化方法。 例如下表：id是主键，tenant_id是普通索引。or 的时候没有用 primary key，而是使用了 primary key(id) 和 tenant_id 索引。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> <span style="color:#fff;font-weight:bold">role</span> <span style="color:#fff;font-weight:bold">where</span> id = <span style="color:#ff0;font-weight:bold">11011</span> <span style="color:#fff;font-weight:bold">or</span> tenant_id = <span style="color:#ff0;font-weight:bold">8888</span>;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------------+-----------------------+-----------------------+---------+------+------+-------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span>        | possible_keys         | <span style="color:#fff;font-weight:bold">key</span>                   | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra                                           |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------------+-----------------------+-----------------------+---------+------+------+-------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | <span style="color:#fff;font-weight:bold">role</span>  | index_merge | <span style="color:#fff;font-weight:bold">PRIMARY</span>,idx_tenant_id | <span style="color:#fff;font-weight:bold">PRIMARY</span>,idx_tenant_id | <span style="color:#ff0;font-weight:bold">4</span>,<span style="color:#ff0;font-weight:bold">4</span>     | <span style="color:#fff;font-weight:bold">NULL</span> |  <span style="color:#ff0;font-weight:bold">134</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">union</span>(<span style="color:#fff;font-weight:bold">PRIMARY</span>,idx_tenant_id); <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">where</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------------+-----------------------+-----------------------+---------+------+------+-------------------------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="range">range<a hidden class="anchor" aria-hidden="true" href="#range">#</a></h3>
<p>范围扫描通常出现在 in(), between ,&gt; ,&lt;, &gt;= 等操作中。使用一个索引来检索给定范围的行。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> actor <span style="color:#fff;font-weight:bold">where</span> id &gt; <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span>  | possible_keys | <span style="color:#fff;font-weight:bold">key</span>     | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | actor | range | <span style="color:#fff;font-weight:bold">PRIMARY</span>       | <span style="color:#fff;font-weight:bold">PRIMARY</span> | <span style="color:#ff0;font-weight:bold">4</span>       | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">2</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">where</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="index">index<a hidden class="anchor" aria-hidden="true" href="#index">#</a></h3>
<p>遍历索引树。通常比ALL快，因为索引文件通常比数据文件小。all和index都是读全表，但index是从索引中检索的，而all是从硬盘中检索的。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">count</span>(*) <span style="color:#fff;font-weight:bold">from</span> film;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span>  | possible_keys | <span style="color:#fff;font-weight:bold">key</span>      | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film  | <span style="color:#fff;font-weight:bold">index</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | idx_name | <span style="color:#ff0;font-weight:bold">33</span>      | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">3</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="all">ALL<a hidden class="anchor" aria-hidden="true" href="#all">#</a></h3>
<p>即全表扫描，意味着mysql需要从头到尾去查找所需要的行。通常情况下这需要增加索引来进行优化了。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> actor;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span> | possible_keys | <span style="color:#fff;font-weight:bold">key</span>  | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+-------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | actor | <span style="color:#fff;font-weight:bold">ALL</span>  | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">2</span> | <span style="color:#fff;font-weight:bold">NULL</span>  |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+-------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="possible_keys">possible_keys<a hidden class="anchor" aria-hidden="true" href="#possible_keys">#</a></h2>
<p>这一列显示查询可能使用哪些索引来查找。 <strong>但不一定被查询实际使用</strong>。</p>
<p>explain 时可能出现 possible_keys 有列，而 key 显示 NULL 的情况，这种情况是因为表中数据不多，mysql认为索引对此查询帮助不大，选择了全表查询。</p>
<p>如果该列是NULL，则没有相关的索引。在这种情况下，可以通过检查 where 子句看是否可以创造一个适当的索引来提高查询性能，然后用 explain 查看效果。</p>
<h2 id="key">key<a hidden class="anchor" aria-hidden="true" href="#key">#</a></h2>
<p>这一列显示mysql实际采用哪个索引来优化对该表的访问。如果没有使用索引，则该列是 NULL。如果想强制mysql使用或忽视possible_keys列中的索引，在查询中使用 force index、ignore index。</p>
<h2 id="key_len">key_len<a hidden class="anchor" aria-hidden="true" href="#key_len">#</a></h2>
<p>表示索引中使用的字节数，通过这个值可以算出具体使用了索引中的哪些列。</p>
<p>举例来说，film_actor的联合索引 idx_film_actor_id 由 film_id 和 actor_id 两个int列组成，并且每个int是4字节。通过结果中的key_len=4可推断出查询使用了第一个列：film_id列来执行索引查找。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> film_actor <span style="color:#fff;font-weight:bold">where</span> film_id = <span style="color:#ff0;font-weight:bold">2</span>;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+------+-------------------+-------------------+---------+-------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span>      | <span style="color:#fff;font-weight:bold">type</span> | possible_keys     | <span style="color:#fff;font-weight:bold">key</span>               | key_len | <span style="color:#fff;font-weight:bold">ref</span>   | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+------+-------------------+-------------------+---------+-------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film_actor | <span style="color:#fff;font-weight:bold">ref</span>  | idx_film_actor_id | idx_film_actor_id | <span style="color:#ff0;font-weight:bold">4</span>       | const |    <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+------+-------------------+-------------------+---------+-------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ref-1">ref<a hidden class="anchor" aria-hidden="true" href="#ref-1">#</a></h2>
<p>这一列显示了在key列记录的索引中，表查找值所用到的列或常量，常见的有：const（常量），func，NULL，字段名（例：film.id）</p>
<h2 id="rows">rows<a hidden class="anchor" aria-hidden="true" href="#rows">#</a></h2>
<p>这一列是mysql估计要读取并检测的行数，注意这个不是结果集里的行数。</p>
<h2 id="filter">filter<a hidden class="anchor" aria-hidden="true" href="#filter">#</a></h2>
<p>表示选取的行和读取的行的百分比，100表示选取了100%，80表示读取了80%。</p>
<h2 id="extra">extra<a hidden class="anchor" aria-hidden="true" href="#extra">#</a></h2>
<p>这一列展示的是额外信息。常见的重要值如下：</p>
<h3 id="distinct">distinct<a hidden class="anchor" aria-hidden="true" href="#distinct">#</a></h3>
<p>一旦mysql找到了与行相联合匹配的行，就不再搜索了。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">distinct</span> name <span style="color:#fff;font-weight:bold">from</span> film <span style="color:#fff;font-weight:bold">left</span> <span style="color:#fff;font-weight:bold">join</span> film_actor <span style="color:#fff;font-weight:bold">on</span> film.id = film_actor.film_id;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span>      | <span style="color:#fff;font-weight:bold">type</span>  | possible_keys     | <span style="color:#fff;font-weight:bold">key</span>               | key_len | <span style="color:#fff;font-weight:bold">ref</span>          | <span style="color:#fff;font-weight:bold">rows</span> | Extra                        |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film       | <span style="color:#fff;font-weight:bold">index</span> | idx_name          | idx_name          | <span style="color:#ff0;font-weight:bold">33</span>      | <span style="color:#fff;font-weight:bold">NULL</span>         |    <span style="color:#ff0;font-weight:bold">3</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span>; <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">temporary</span> |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film_actor | <span style="color:#fff;font-weight:bold">ref</span>   | idx_film_actor_id | idx_film_actor_id | <span style="color:#ff0;font-weight:bold">4</span>       | test.film.id |    <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span>; <span style="color:#fff;font-weight:bold">Distinct</span>        |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+------------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="using-index">Using index<a hidden class="anchor" aria-hidden="true" href="#using-index">#</a></h3>
<p>这发生在对表的请求列都是同一索引的部分的时候，返回的列数据只使用了索引中的信息，而没有再去访问表中的行记录，而不需要回行（从磁盘中取数据），是性能高的表现。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> id <span style="color:#fff;font-weight:bold">from</span> film <span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> id;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span>  | possible_keys | <span style="color:#fff;font-weight:bold">key</span>     | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film  | <span style="color:#fff;font-weight:bold">index</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">PRIMARY</span> | <span style="color:#ff0;font-weight:bold">4</span>       | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">3</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="using-where">Using where<a hidden class="anchor" aria-hidden="true" href="#using-where">#</a></h3>
<p>mysql服务器将在存储引擎检索行后再进行过滤。就是先读取整行数据，再按 where 条件进行检查，符合就留下，不符合就丢弃。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> film <span style="color:#fff;font-weight:bold">where</span> id &gt; <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span>  | possible_keys | <span style="color:#fff;font-weight:bold">key</span>      | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra                    |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film  | <span style="color:#fff;font-weight:bold">index</span> | <span style="color:#fff;font-weight:bold">PRIMARY</span>       | idx_name | <span style="color:#ff0;font-weight:bold">33</span>      | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">3</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">where</span>; <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="using-temporary">Using temporary<a hidden class="anchor" aria-hidden="true" href="#using-temporary">#</a></h3>
<p>mysql需要创建一张临时表来处理查询。出现这种情况一般是要进行优化的，首先是想到用索引来优化。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">1</span>. actor.name<span style="color:#f00">没有索引，此时创建了张临时表来</span><span style="color:#fff;font-weight:bold">distinct</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">distinct</span> name <span style="color:#fff;font-weight:bold">from</span> actor;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+-----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span> | possible_keys | <span style="color:#fff;font-weight:bold">key</span>  | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra           |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+-----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | actor | <span style="color:#fff;font-weight:bold">ALL</span>  | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">2</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">temporary</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+-----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">2</span>. film.name<span style="color:#f00">建立了</span>idx_name<span style="color:#f00">索引，此时查询时</span>extra<span style="color:#f00">是</span><span style="color:#fff;font-weight:bold">using</span> <span style="color:#fff;font-weight:bold">index</span>,<span style="color:#f00">没有用临时表</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> <span style="color:#fff;font-weight:bold">distinct</span> name <span style="color:#fff;font-weight:bold">from</span> film;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span>  | possible_keys | <span style="color:#fff;font-weight:bold">key</span>      | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film  | <span style="color:#fff;font-weight:bold">index</span> | idx_name      | idx_name | <span style="color:#ff0;font-weight:bold">33</span>      | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">3</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="using-filesort">Using filesort<a hidden class="anchor" aria-hidden="true" href="#using-filesort">#</a></h3>
<p>mysql 会对结果使用一个外部索引排序，而不是按索引次序从表里读取行。此时mysql会根据联接类型浏览所有符合条件的记录，并保存排序关键字和行指针，然后排序关键字并按顺序检索行信息。这种情况下一般也是要考虑使用索引来优化的。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">1</span>. actor.name<span style="color:#f00">未创建索引，会浏览</span>actor<span style="color:#f00">整个表，保存排序关键字</span>name<span style="color:#f00">和对应的</span>id<span style="color:#f00">，然后排序</span>name<span style="color:#f00">并检索行记录</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> actor <span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> name;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span> | possible_keys | <span style="color:#fff;font-weight:bold">key</span>  | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra          |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | actor | <span style="color:#fff;font-weight:bold">ALL</span>  | <span style="color:#fff;font-weight:bold">NULL</span>          | <span style="color:#fff;font-weight:bold">NULL</span> | <span style="color:#fff;font-weight:bold">NULL</span>    | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">2</span> | <span style="color:#fff;font-weight:bold">Using</span> filesort |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+------+---------------+------+---------+------+------+----------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">2</span>. film.name<span style="color:#f00">建立了</span>idx_name<span style="color:#f00">索引</span>,<span style="color:#f00">此时查询时</span>extra<span style="color:#f00">是</span><span style="color:#fff;font-weight:bold">using</span> <span style="color:#fff;font-weight:bold">index</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">explain</span> <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> film <span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> name;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | select_type | <span style="color:#fff;font-weight:bold">table</span> | <span style="color:#fff;font-weight:bold">type</span>  | possible_keys | <span style="color:#fff;font-weight:bold">key</span>      | key_len | <span style="color:#fff;font-weight:bold">ref</span>  | <span style="color:#fff;font-weight:bold">rows</span> | Extra       |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#fff;font-weight:bold">SIMPLE</span>      | film  | <span style="color:#fff;font-weight:bold">index</span> | <span style="color:#fff;font-weight:bold">NULL</span>          | idx_name | <span style="color:#ff0;font-weight:bold">33</span>      | <span style="color:#fff;font-weight:bold">NULL</span> |    <span style="color:#ff0;font-weight:bold">3</span> | <span style="color:#fff;font-weight:bold">Using</span> <span style="color:#fff;font-weight:bold">index</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="以上所有sql使用的表和数据">以上所有sql使用的表和数据<a hidden class="anchor" aria-hidden="true" href="#以上所有sql使用的表和数据">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">DROP</span> <span style="color:#fff;font-weight:bold">TABLE</span> <span style="color:#fff;font-weight:bold">IF</span> <span style="color:#fff;font-weight:bold">EXISTS</span> `actor`;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `actor` (
</span></span><span style="display:flex;"><span>  `id` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `name` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">45</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `update_time` datetime <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `actor` (`id`, `name`, `update_time`) <span style="color:#fff;font-weight:bold">VALUES</span> (<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#0ff;font-weight:bold">&#39;a&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;2017-12-22 15:27:18&#39;</span>), (<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#0ff;font-weight:bold">&#39;b&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;2017-12-22 15:27:18&#39;</span>), (<span style="color:#ff0;font-weight:bold">3</span>,<span style="color:#0ff;font-weight:bold">&#39;c&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;2017-12-22 15:27:18&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">DROP</span> <span style="color:#fff;font-weight:bold">TABLE</span> <span style="color:#fff;font-weight:bold">IF</span> <span style="color:#fff;font-weight:bold">EXISTS</span> `film`;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `film` (
</span></span><span style="display:flex;"><span>  `id` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT,
</span></span><span style="display:flex;"><span>  `name` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">10</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`),
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">KEY</span> `idx_name` (`name`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `film` (`id`, `name`) <span style="color:#fff;font-weight:bold">VALUES</span> (<span style="color:#ff0;font-weight:bold">3</span>,<span style="color:#0ff;font-weight:bold">&#39;film0&#39;</span>),(<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#0ff;font-weight:bold">&#39;film1&#39;</span>),(<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#0ff;font-weight:bold">&#39;film2&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">DROP</span> <span style="color:#fff;font-weight:bold">TABLE</span> <span style="color:#fff;font-weight:bold">IF</span> <span style="color:#fff;font-weight:bold">EXISTS</span> `film_actor`;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `film_actor` (
</span></span><span style="display:flex;"><span>  `id` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `film_id` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `actor_id` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`),
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">KEY</span> `idx_film_actor_id` (`film_id`,`actor_id`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `film_actor` (`id`, `film_id`, `actor_id`) <span style="color:#fff;font-weight:bold">VALUES</span> (<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">1</span>),(<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>),(<span style="color:#ff0;font-weight:bold">3</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">1</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="数据库三大范式">数据库三大范式<a hidden class="anchor" aria-hidden="true" href="#数据库三大范式">#</a></h1>
<ul>
<li>1NF，即第一范式，指同一列中不能有多个值，(即实体中的某个属性不能有多个值,或者不能有重复的属性)，简而言之，第一范式就是<strong>无重复的列</strong></li>
<li>2NF，第二范式，要求表中的每一行(每一条数据)，必须可以被唯一的区分(即唯一id，主键)</li>
<li>3NF，第三范式，要求一个表中不包含，已在其他表中包含的，非主关键字(主键)信息。
如：现有员工表，包含员工的姓名、年龄等，这时不应该将员工所属部门的信息放在员工表中，而应该新建一张部门表，在员工标中通过部门id与部门表对应。</li>
</ul>
<h1 id="group-by-的简单使用">group by 的简单使用<a hidden class="anchor" aria-hidden="true" href="#group-by-的简单使用">#</a></h1>
<p>我们先准备一张表和一些记录
创建学生的成绩表courses：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `courses` (
</span></span><span style="display:flex;"><span>	`id` <span style="color:#fff;font-weight:bold">INT</span>(<span style="color:#ff0;font-weight:bold">11</span>) UNSIGNED <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;自增id&#39;</span>,
</span></span><span style="display:flex;"><span>	`student` <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">255</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;学生&#39;</span>,
</span></span><span style="display:flex;"><span>	`<span style="color:#fff;font-weight:bold">class</span>` <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">255</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;课程&#39;</span>,
</span></span><span style="display:flex;"><span>	`score` <span style="color:#fff;font-weight:bold">INT</span>(<span style="color:#ff0;font-weight:bold">255</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;分数&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`),
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">UNIQUE</span> <span style="color:#fff;font-weight:bold">KEY</span> `course` (`student`, `<span style="color:#fff;font-weight:bold">class</span>`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8 <span style="color:#fff;font-weight:bold">comment</span> <span style="color:#0ff;font-weight:bold">&#39;课程分数表&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>该表记录了学生某节课的考试分数。向courses表中插入记录：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;A&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;Math&#39;</span>, <span style="color:#ff0;font-weight:bold">90</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;A&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;Chinese&#39;</span>, <span style="color:#ff0;font-weight:bold">80</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;A&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;English&#39;</span>, <span style="color:#ff0;font-weight:bold">70</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;A&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;History&#39;</span>, <span style="color:#ff0;font-weight:bold">80</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;B&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;Math&#39;</span>, <span style="color:#ff0;font-weight:bold">73</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;B&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;Chinese&#39;</span>, <span style="color:#ff0;font-weight:bold">60</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;B&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;English&#39;</span>, <span style="color:#ff0;font-weight:bold">70</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;B&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;History&#39;</span>, <span style="color:#ff0;font-weight:bold">90</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;C&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;Math&#39;</span>, <span style="color:#ff0;font-weight:bold">70</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;C&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;Chinese&#39;</span>, <span style="color:#ff0;font-weight:bold">50</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;C&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;English&#39;</span>, <span style="color:#ff0;font-weight:bold">20</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;C&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;History&#39;</span>, <span style="color:#ff0;font-weight:bold">10</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;D&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;Math&#39;</span>, <span style="color:#ff0;font-weight:bold">53</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;D&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;Chinese&#39;</span>, <span style="color:#ff0;font-weight:bold">32</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;D&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;English&#39;</span>, <span style="color:#ff0;font-weight:bold">99</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INSERT</span> <span style="color:#fff;font-weight:bold">INTO</span> `courses`(`student`, `<span style="color:#fff;font-weight:bold">class</span>`, `score`) <span style="color:#fff;font-weight:bold">VALUES</span>(<span style="color:#0ff;font-weight:bold">&#39;D&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;History&#39;</span>, <span style="color:#ff0;font-weight:bold">100</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用几个简单的例子看一下group by的作用：
<code>SELECT * FROM courses GROUP BY class;</code></p>
<table>
<thead>
<tr>
<th>id</th>
<th>student</th>
<th>class</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>A</td>
<td>Chinese</td>
<td>80</td>
</tr>
<tr>
<td>3</td>
<td>A</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>4</td>
<td>A</td>
<td>History</td>
<td>80</td>
</tr>
<tr>
<td>1</td>
<td>A</td>
<td>Math</td>
<td>90</td>
</tr>
</tbody>
</table>
<p>类似地，我们按照score对记录进行分组：
<code>SELECT * FROM courses GROUP BY score;</code></p>
<table>
<thead>
<tr>
<th>id</th>
<th>student</th>
<th>class</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>12</td>
<td>C</td>
<td>History</td>
<td>10</td>
</tr>
<tr>
<td>11</td>
<td>C</td>
<td>English</td>
<td>20</td>
</tr>
<tr>
<td>14</td>
<td>D</td>
<td>Chinese</td>
<td>32</td>
</tr>
<tr>
<td>10</td>
<td>C</td>
<td>Chinese</td>
<td>50</td>
</tr>
<tr>
<td>13</td>
<td>D</td>
<td>Math</td>
<td>53</td>
</tr>
<tr>
<td>6</td>
<td>B</td>
<td>Chinese</td>
<td>60</td>
</tr>
<tr>
<td>3</td>
<td>A</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>5</td>
<td>B</td>
<td>Math</td>
<td>73</td>
</tr>
<tr>
<td>2</td>
<td>A</td>
<td>Chinese</td>
<td>80</td>
</tr>
<tr>
<td>11</td>
<td>A</td>
<td>Math</td>
<td>90</td>
</tr>
<tr>
<td>15</td>
<td>D</td>
<td>English</td>
<td>99</td>
</tr>
<tr>
<td>16</td>
<td>D</td>
<td>History</td>
<td>100</td>
</tr>
</tbody>
</table>
<p>我们甚至可以对多个字段进行group by：
<code>SELECT * FROM courses GROUP BY class,student;</code></p>
<table>
<thead>
<tr>
<th>id</th>
<th>student</th>
<th>class</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>A</td>
<td>Chinese</td>
<td>80</td>
</tr>
<tr>
<td>6</td>
<td>B</td>
<td>Chinese</td>
<td>60</td>
</tr>
<tr>
<td>10</td>
<td>C</td>
<td>Chinese</td>
<td>50</td>
</tr>
<tr>
<td>14</td>
<td>D</td>
<td>Chinese</td>
<td>32</td>
</tr>
<tr>
<td>3</td>
<td>A</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>7</td>
<td>B</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>11</td>
<td>C</td>
<td>English</td>
<td>20</td>
</tr>
<tr>
<td>15</td>
<td>D</td>
<td>English</td>
<td>99</td>
</tr>
<tr>
<td>4</td>
<td>A</td>
<td>History</td>
<td>80</td>
</tr>
<tr>
<td>8</td>
<td>B</td>
<td>History</td>
<td>90</td>
</tr>
<tr>
<td>12</td>
<td>C</td>
<td>History</td>
<td>10</td>
</tr>
<tr>
<td>16</td>
<td>D</td>
<td>History</td>
<td>100</td>
</tr>
<tr>
<td>1</td>
<td>A</td>
<td>Math</td>
<td>90</td>
</tr>
<tr>
<td>5</td>
<td>B</td>
<td>Math</td>
<td>73</td>
</tr>
<tr>
<td>9</td>
<td>C</td>
<td>Math</td>
<td>70</td>
</tr>
<tr>
<td>13</td>
<td>D</td>
<td>Math</td>
<td>53</td>
</tr>
</tbody>
</table>
<p>最后，我们交换字段顺序对记录进行分组：
<code>SELECT * FROM courses GROUP BY student,class;</code></p>
<table>
<thead>
<tr>
<th>id</th>
<th>student</th>
<th>class</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>A</td>
<td>Chinese</td>
<td>80</td>
</tr>
<tr>
<td>3</td>
<td>A</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>4</td>
<td>A</td>
<td>History</td>
<td>80</td>
</tr>
<tr>
<td>1</td>
<td>A</td>
<td>Math</td>
<td>90</td>
</tr>
<tr>
<td>6</td>
<td>B</td>
<td>Chinese</td>
<td>60</td>
</tr>
<tr>
<td>7</td>
<td>B</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>8</td>
<td>B</td>
<td>History</td>
<td>90</td>
</tr>
<tr>
<td>5</td>
<td>B</td>
<td>Math</td>
<td>73</td>
</tr>
<tr>
<td>10</td>
<td>C</td>
<td>Chinese</td>
<td>50</td>
</tr>
<tr>
<td>11</td>
<td>C</td>
<td>English</td>
<td>20</td>
</tr>
<tr>
<td>12</td>
<td>C</td>
<td>History</td>
<td>10</td>
</tr>
<tr>
<td>9</td>
<td>C</td>
<td>Math</td>
<td>70</td>
</tr>
<tr>
<td>14</td>
<td>D</td>
<td>Chinese</td>
<td>32</td>
</tr>
<tr>
<td>15</td>
<td>D</td>
<td>English</td>
<td>99</td>
</tr>
<tr>
<td>16</td>
<td>D</td>
<td>History</td>
<td>100</td>
</tr>
<tr>
<td>13</td>
<td>D</td>
<td>Math</td>
<td>53</td>
</tr>
</tbody>
</table>
<p>这样的结果可能会使人困惑，我们以第一个sql为例，解释下sql执行的过程：
<img loading="lazy" src="1.png" alt=""  />

该sql首先会按照class进行分组得到四张中间表，然后将每一个分组的第一条记录组合在一起，形成了最终的结果。我们还可以发现，最终的记录是按照class进行排序的。</p>
<h2 id="与order-by结合">与order by结合<a hidden class="anchor" aria-hidden="true" href="#与order-by结合">#</a></h2>
<p>我们需要学生的成绩表，且每个学生每科的成绩按照由大到小的顺序排列
我们可以很自然的写出下面的sql:
<code>SELECT * FROM courses GROUP BY student,class ORDER BY score DESC;</code>
然而，执行的结果貌似并不是我们想要的：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>student</th>
<th>class</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>16</td>
<td>D</td>
<td>History</td>
<td>100</td>
</tr>
<tr>
<td>15</td>
<td>D</td>
<td>English</td>
<td>99</td>
</tr>
<tr>
<td>1</td>
<td>A</td>
<td>Math</td>
<td>90</td>
</tr>
<tr>
<td>8</td>
<td>B</td>
<td>History</td>
<td>90</td>
</tr>
<tr>
<td>2</td>
<td>A</td>
<td>Chinese</td>
<td>80</td>
</tr>
<tr>
<td>4</td>
<td>A</td>
<td>History</td>
<td>80</td>
</tr>
<tr>
<td>5</td>
<td>B</td>
<td>Math</td>
<td>73</td>
</tr>
<tr>
<td>9</td>
<td>C</td>
<td>Math</td>
<td>70</td>
</tr>
<tr>
<td>3</td>
<td>A</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>7</td>
<td>B</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>6</td>
<td>B</td>
<td>Chinese</td>
<td>60</td>
</tr>
<tr>
<td>13</td>
<td>D</td>
<td>Math</td>
<td>53</td>
</tr>
<tr>
<td>10</td>
<td>C</td>
<td>Chinese</td>
<td>50</td>
</tr>
<tr>
<td>14</td>
<td>D</td>
<td>Chinese</td>
<td>32</td>
</tr>
<tr>
<td>11</td>
<td>C</td>
<td>English</td>
<td>20</td>
</tr>
<tr>
<td>12</td>
<td>C</td>
<td>History</td>
<td>10</td>
</tr>
</tbody>
</table>
<p>通过观察，我们可以发现，事实上，这个sql是将所有的记录按照score由大到小的顺序排列了，为什么会出现这样的结果呢？事实上，这个取决于整个sql的执行顺序，真正的执行顺序是 from &hellip; where &hellip; group by &hellip; order by &hellip; select，order by 作用在整个记录，而不是每个分组上。
那么，怎么样能够得到我们期望的结果呢？这里给出我的sql实现：
<code>SELECT * FROM courses GROUP BY student,class ORDER BY student,score DESC;</code></p>
<table>
<thead>
<tr>
<th>id</th>
<th>student</th>
<th>class</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>A</td>
<td>Math</td>
<td>90</td>
</tr>
<tr>
<td>2</td>
<td>A</td>
<td>Chinese</td>
<td>80</td>
</tr>
<tr>
<td>4</td>
<td>A</td>
<td>History</td>
<td>80</td>
</tr>
<tr>
<td>3</td>
<td>A</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>8</td>
<td>B</td>
<td>History</td>
<td>90</td>
</tr>
<tr>
<td>5</td>
<td>B</td>
<td>Math</td>
<td>73</td>
</tr>
<tr>
<td>7</td>
<td>B</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>6</td>
<td>B</td>
<td>Chinese</td>
<td>60</td>
</tr>
<tr>
<td>9</td>
<td>C</td>
<td>Math</td>
<td>70</td>
</tr>
<tr>
<td>10</td>
<td>C</td>
<td>Chinese</td>
<td>50</td>
</tr>
<tr>
<td>11</td>
<td>C</td>
<td>English</td>
<td>20</td>
</tr>
<tr>
<td>12</td>
<td>C</td>
<td>History</td>
<td>10</td>
</tr>
<tr>
<td>16</td>
<td>D</td>
<td>History</td>
<td>100</td>
</tr>
<tr>
<td>15</td>
<td>D</td>
<td>English</td>
<td>99</td>
</tr>
<tr>
<td>13</td>
<td>D</td>
<td>Math</td>
<td>53</td>
</tr>
<tr>
<td>14</td>
<td>D</td>
<td>Chinese</td>
<td>32</td>
</tr>
</tbody>
</table>
<h2 id="与having结合">与having结合<a hidden class="anchor" aria-hidden="true" href="#与having结合">#</a></h2>
<p>我们需要得到所有功课平均分达到60分的同学和他们的均分：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> 
</span></span><span style="display:flex;"><span>    `student`, 
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">AVG</span>(`score`) <span style="color:#fff;font-weight:bold">AS</span>`avg_score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> `courses`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> `student`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">HAVING</span> <span style="color:#fff;font-weight:bold">AVG</span>(`score`) &gt;= <span style="color:#ff0;font-weight:bold">60</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> `avg_score` <span style="color:#fff;font-weight:bold">DESC</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>student</th>
<th>avg_score</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>80.0000</td>
</tr>
<tr>
<td>B</td>
<td>73.2500</td>
</tr>
<tr>
<td>D</td>
<td>71.0000</td>
</tr>
</tbody>
</table>
<p>这里需要注意一个问题：where 与 having的区别。where作用于所有的记录，而having则作用于一个分组。
举例说明：假设我们这里需要得到所有功课（除历史课）平均分达到60分的同学和他们的均分：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> `student`, <span style="color:#fff;font-weight:bold">AVG</span>(`score`) <span style="color:#fff;font-weight:bold">AS</span> `avg_score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> `courses`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">WHERE</span> `<span style="color:#fff;font-weight:bold">class</span>` &lt;&gt; <span style="color:#0ff;font-weight:bold">&#39;History&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> `student`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">HAVING</span> <span style="color:#fff;font-weight:bold">AVG</span>(`score`) &gt;= <span style="color:#ff0;font-weight:bold">60</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> `avg_score` <span style="color:#fff;font-weight:bold">DESC</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>student</th>
<th>avg_score</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>80.0000</td>
</tr>
<tr>
<td>B</td>
<td>67.6667</td>
</tr>
<tr>
<td>D</td>
<td>61.3333</td>
</tr>
</tbody>
</table>
<h2 id="group-by与limit">Group By与Limit<a hidden class="anchor" aria-hidden="true" href="#group-by与limit">#</a></h2>
<p>我们需要列出均分最高的三门课：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> `<span style="color:#fff;font-weight:bold">class</span>`, <span style="color:#fff;font-weight:bold">AVG</span>(`score`) <span style="color:#fff;font-weight:bold">AS</span> `avg_score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> `courses`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">By</span> `<span style="color:#fff;font-weight:bold">class</span>`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> `avg_score` <span style="color:#fff;font-weight:bold">DESC</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">LIMIT</span> <span style="color:#ff0;font-weight:bold">3</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>class</th>
<th>avg_score</th>
</tr>
</thead>
<tbody>
<tr>
<td>Math</td>
<td>71.5000</td>
</tr>
<tr>
<td>History</td>
<td>70.0000</td>
</tr>
<tr>
<td>English</td>
<td>64.7500</td>
</tr>
</tbody>
</table>
<p>我们需要理解的是：group by分组的依据，以及where过滤条件作用的粒度。</p>
<h2 id="group-by-练习">group by 练习<a hidden class="anchor" aria-hidden="true" href="#group-by-练习">#</a></h2>
<ul>
<li>获取所有课程
我们的第一反应是可以使用distinct关键字实现
<code>SELECT DISTINCT(class) FROM courses;</code></li>
</ul>
<table>
<thead>
<tr>
<th>class</th>
</tr>
</thead>
<tbody>
<tr>
<td>Chinese</td>
</tr>
<tr>
<td>English</td>
</tr>
<tr>
<td>History</td>
</tr>
<tr>
<td>Math</td>
</tr>
</tbody>
</table>
<p>事实上，我们同样可以使用group by来实现
<code>SELECT class FROM courses GROUP BY class;</code>
结果与上面相同。因此，我们可以发现group by的一个重要的作用就是枚举出所有满足group by条件的组合，间接达到了去重的效果。</p>
<ul>
<li>所有的学生对应修读的课程</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> 
</span></span><span style="display:flex;"><span>    `student`,
</span></span><span style="display:flex;"><span>    `<span style="color:#fff;font-weight:bold">class</span>` 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> `courses` 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> `student`, `<span style="color:#fff;font-weight:bold">class</span>`; 
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>student</th>
<th>class</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>Chinese</td>
</tr>
<tr>
<td>A</td>
<td>English</td>
</tr>
<tr>
<td>A</td>
<td>History</td>
</tr>
<tr>
<td>A</td>
<td>Math</td>
</tr>
<tr>
<td>B</td>
<td>Chinese</td>
</tr>
<tr>
<td>B</td>
<td>English</td>
</tr>
<tr>
<td>B</td>
<td>History</td>
</tr>
<tr>
<td>B</td>
<td>Math</td>
</tr>
<tr>
<td>C</td>
<td>Chinese</td>
</tr>
<tr>
<td>C</td>
<td>English</td>
</tr>
<tr>
<td>C</td>
<td>History</td>
</tr>
<tr>
<td>C</td>
<td>Math</td>
</tr>
<tr>
<td>D</td>
<td>Chinese</td>
</tr>
<tr>
<td>D</td>
<td>English</td>
</tr>
<tr>
<td>D</td>
<td>History</td>
</tr>
<tr>
<td>D</td>
<td>Math</td>
</tr>
</tbody>
</table>
<ul>
<li>每门课程的排名表</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> 
</span></span><span style="display:flex;"><span>    `<span style="color:#fff;font-weight:bold">class</span>`,
</span></span><span style="display:flex;"><span>    `student`,
</span></span><span style="display:flex;"><span>    `score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> `courses`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> `<span style="color:#fff;font-weight:bold">class</span>`, `score` <span style="color:#fff;font-weight:bold">DESC</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>class</th>
<th>student</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>Chinese</td>
<td>A</td>
<td>80</td>
</tr>
<tr>
<td>Chinese</td>
<td>B</td>
<td>60</td>
</tr>
<tr>
<td>Chinese</td>
<td>C</td>
<td>50</td>
</tr>
<tr>
<td>Chinese</td>
<td>D</td>
<td>32</td>
</tr>
<tr>
<td>English</td>
<td>D</td>
<td>99</td>
</tr>
<tr>
<td>English</td>
<td>A</td>
<td>70</td>
</tr>
<tr>
<td>English</td>
<td>B</td>
<td>70</td>
</tr>
<tr>
<td>English</td>
<td>C</td>
<td>20</td>
</tr>
<tr>
<td>History</td>
<td>D</td>
<td>100</td>
</tr>
<tr>
<td>History</td>
<td>B</td>
<td>90</td>
</tr>
<tr>
<td>History</td>
<td>A</td>
<td>80</td>
</tr>
<tr>
<td>History</td>
<td>C</td>
<td>10</td>
</tr>
<tr>
<td>Math</td>
<td>A</td>
<td>90</td>
</tr>
<tr>
<td>Math</td>
<td>B</td>
<td>73</td>
</tr>
<tr>
<td>Math</td>
<td>C</td>
<td>70</td>
</tr>
<tr>
<td>Math</td>
<td>D</td>
<td>53</td>
</tr>
</tbody>
</table>
<ul>
<li>参考每门课的最高分选择课代表</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> `<span style="color:#fff;font-weight:bold">c</span>`.`<span style="color:#fff;font-weight:bold">class</span>`, `<span style="color:#fff;font-weight:bold">c</span>`.`student`, `<span style="color:#fff;font-weight:bold">c</span>`.`score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> (
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> `<span style="color:#fff;font-weight:bold">class</span>`, <span style="color:#fff;font-weight:bold">MAX</span>(`score`) <span style="color:#fff;font-weight:bold">AS</span> `score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> `courses`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> `<span style="color:#fff;font-weight:bold">class</span>`
</span></span><span style="display:flex;"><span>)`T`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INNER</span> <span style="color:#fff;font-weight:bold">JOIN</span> `courses` `<span style="color:#fff;font-weight:bold">c</span>` <span style="color:#fff;font-weight:bold">ON</span> `T`.`<span style="color:#fff;font-weight:bold">class</span>` = `<span style="color:#fff;font-weight:bold">c</span>`.`<span style="color:#fff;font-weight:bold">class</span>` <span style="color:#fff;font-weight:bold">AND</span> `T`.`score` = `<span style="color:#fff;font-weight:bold">c</span>`.`score`;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>class</th>
<th>student</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>Math</td>
<td>A</td>
<td>90</td>
</tr>
<tr>
<td>Chinese</td>
<td>A</td>
<td>80</td>
</tr>
<tr>
<td>English</td>
<td>D</td>
<td>99</td>
</tr>
<tr>
<td>History</td>
<td>D</td>
<td>100</td>
</tr>
</tbody>
</table>
<ul>
<li>为每门课的前三名颁奖
我们容易写出这样的一个sql</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> 
</span></span><span style="display:flex;"><span>	`<span style="color:#fff;font-weight:bold">class</span>`,
</span></span><span style="display:flex;"><span>    `student`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> `courses`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> `<span style="color:#fff;font-weight:bold">class</span>`, `student`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> `<span style="color:#fff;font-weight:bold">class</span>`, `score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">LIMIT</span> <span style="color:#ff0;font-weight:bold">3</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>很显然，这并不是我们想要的结果，至于为什么结果是这个样子的，大家可以参考上面的order by，这里不再赘述。
正确的sql为</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> `c1`.`<span style="color:#fff;font-weight:bold">class</span>`, `c1`.`student`, `c1`.`score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> `courses` `c1`
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">INNER</span> <span style="color:#fff;font-weight:bold">JOIN</span> `courses` `c2` <span style="color:#fff;font-weight:bold">ON</span> `c1`.`<span style="color:#fff;font-weight:bold">class</span>` = `c2`.`<span style="color:#fff;font-weight:bold">class</span>` <span style="color:#fff;font-weight:bold">AND</span> `c1`.`student` &lt;&gt; `c2`.`student` <span style="color:#fff;font-weight:bold">AND</span> `c1`.`score` &gt; `c2`.`score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> `c1`.`<span style="color:#fff;font-weight:bold">class</span>`, `c1`.`student`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> `c1`.`<span style="color:#fff;font-weight:bold">class</span>`, `c1`.`score` <span style="color:#fff;font-weight:bold">DESC</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>再提供一种通用的解法</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> `c1`.`<span style="color:#fff;font-weight:bold">class</span>`, `c1`.`student`, `c1`.`score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> `courses` `c1`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INNER</span> <span style="color:#fff;font-weight:bold">JOIN</span> `courses` `c2` <span style="color:#fff;font-weight:bold">ON</span> `c1`.`<span style="color:#fff;font-weight:bold">class</span>` = `c2`.`<span style="color:#fff;font-weight:bold">class</span>` <span style="color:#fff;font-weight:bold">AND</span> `c1`.`score` &lt;= `c2`.`score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> `c1`.`<span style="color:#fff;font-weight:bold">class</span>`, `c1`.`student`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">HAVING</span> <span style="color:#fff;font-weight:bold">COUNT</span>(*) &lt;= <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">ORDER</span> <span style="color:#fff;font-weight:bold">BY</span> `c1`.`<span style="color:#fff;font-weight:bold">class</span>`, `c1`.`score` <span style="color:#fff;font-weight:bold">DESC</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述两个sql执行的结果均为</p>
<table>
<thead>
<tr>
<th>class</th>
<th>student</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>Chinese</td>
<td>A</td>
<td>80</td>
</tr>
<tr>
<td>Chinese</td>
<td>B</td>
<td>60</td>
</tr>
<tr>
<td>Chinese</td>
<td>C</td>
<td>50</td>
</tr>
<tr>
<td>English</td>
<td>D</td>
<td>99</td>
</tr>
<tr>
<td>English</td>
<td>A</td>
<td>70</td>
</tr>
<tr>
<td>English</td>
<td>B</td>
<td>70</td>
</tr>
<tr>
<td>History</td>
<td>D</td>
<td>100</td>
</tr>
<tr>
<td>History</td>
<td>B</td>
<td>90</td>
</tr>
<tr>
<td>History</td>
<td>A</td>
<td>80</td>
</tr>
<tr>
<td>Math</td>
<td>A</td>
<td>90</td>
</tr>
<tr>
<td>Math</td>
<td>B</td>
<td>73</td>
</tr>
<tr>
<td>Math</td>
<td>C</td>
<td>70</td>
</tr>
</tbody>
</table>
<p>两个sql中为什么一个条件是c1.score&gt;c2.score而另一个是c1.score&lt;=c2.score，以及count(<em>)&lt;=3而不是count(</em>)&lt;3，可以细细体会下。</p>
<ul>
<li>了解每个学生最擅长的科目和最不擅长的科目</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> `T`.`student`, `<span style="color:#fff;font-weight:bold">c</span>`.`<span style="color:#fff;font-weight:bold">class</span>` <span style="color:#fff;font-weight:bold">AS</span> `best_class`, `T`.`max_score` <span style="color:#fff;font-weight:bold">AS</span> `max_score`, `c2`.`<span style="color:#fff;font-weight:bold">class</span>` <span style="color:#fff;font-weight:bold">AS</span> `worst_class`, `T`.`min_score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">SELECT</span> `student`, <span style="color:#fff;font-weight:bold">MAX</span>(`score`) <span style="color:#fff;font-weight:bold">AS</span> `max_score`, <span style="color:#fff;font-weight:bold">MIN</span>(`score`) <span style="color:#fff;font-weight:bold">AS</span> `min_score`
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">FROM</span> `courses`
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">GROUP</span> <span style="color:#fff;font-weight:bold">BY</span> `student`
</span></span><span style="display:flex;"><span>) `T`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INNER</span> <span style="color:#fff;font-weight:bold">JOIN</span> `courses` `<span style="color:#fff;font-weight:bold">c</span>` <span style="color:#fff;font-weight:bold">ON</span> `T`.`student` = `<span style="color:#fff;font-weight:bold">c</span>`.`student` <span style="color:#fff;font-weight:bold">AND</span> `<span style="color:#fff;font-weight:bold">c</span>`.`score` = `T`.`max_score`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">INNER</span> <span style="color:#fff;font-weight:bold">JOIN</span> `courses` `c2` <span style="color:#fff;font-weight:bold">ON</span> `T`.`student` = `c2`.`student` <span style="color:#fff;font-weight:bold">AND</span> `c2`.`score` = `T`.`min_score`;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>student</th>
<th>best_class</th>
<th>max_score</th>
<th>worst_class</th>
<th>min_score</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>Math</td>
<td>90</td>
<td>English</td>
<td>70</td>
</tr>
<tr>
<td>B</td>
<td>History</td>
<td>90</td>
<td>Chinese</td>
<td>60</td>
</tr>
<tr>
<td>C</td>
<td>Math</td>
<td>70</td>
<td>History</td>
<td>10</td>
</tr>
<tr>
<td>D</td>
<td>History</td>
<td>100</td>
<td>Chinese</td>
<td>32</td>
</tr>
</tbody>
</table>
<h1 id="show-processlist显示正在运行的线程">show processlist：显示正在运行的线程<a hidden class="anchor" aria-hidden="true" href="#show-processlist显示正在运行的线程">#</a></h1>
<p><code>show processlist;</code> 显示用户正在运行的线程，不仅可以查看当前所有的连接数，还可以查看当前的连接状态，帮助识别出有问题的查询语句。
除了 root 用户能看到所有正在运行的线程外，其他用户都只能看到自己正在运行的线程，无法查看其它用户正在运行的线程，除非用户被赋予了PROCESS 权限。</p>
<p>show processlist 显示的信息都是来自MySQL系统库 information_schema 中的 processlist 表。所以使用下面的查询语句可以获得相同的结果：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> information_schema.processlist
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Id: 就是这个线程的唯一标识，当我们发现这个线程有问题的时候，可以通过 kill 命令（<code>kill 你找到的id</code>），加上这个Id值将这个线程杀掉。前面我们说了<code>show processlist</code> 显示的信息时来自information_schema.processlist 表，所以这个Id就是这个表的主键。</li>
<li>User: 就是指启动这个线程的用户。</li>
<li>Host: 记录了发送请求的客户端的 IP 和 端口号。</li>
<li>DB: 当前执行的命令是在哪一个数据库上。如果没有指定数据库，则该值为 NULL 。</li>
<li>Command: 是指此刻该线程正在执行的命令。</li>
<li>Time: 表示该线程处于当前状态的时间。</li>
<li>State: 线程的状态，和 Command 对应，下面单独解释。</li>
<li>Info: 一般记录的是线程执行的语句。默认只显示前100个字符，也就是你看到的语句可能是截断了的，要看全部信息，需要使用 <code>show full processlist</code></li>
</ul>
<p>Command 的含义，<a href="https://link.zhihu.com/?target=https%3A//dev.mysql.com/doc/refman/5.6/en/thread-commands.html">参考官方文档</a></p>
<p>State 的值，<a href="https://dev.mysql.com/doc/refman/5.6/en/general-thread-states.html">参考官方文档</a></p>
<p><a href="https://link.zhihu.com/?target=http%3A//www.ywnds.com/%3Fp%3D9337">state其他参考</a></p>
<p>按客户端 IP 分组，看哪个客户端的链接数最多</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> client_ip, <span style="color:#fff;font-weight:bold">count</span>(client_ip) <span style="color:#fff;font-weight:bold">as</span> client_num
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> (<span style="color:#fff;font-weight:bold">select</span> substring_index(<span style="color:#fff;font-weight:bold">host</span>, <span style="color:#0ff;font-weight:bold">&#39;:&#39;</span>, <span style="color:#ff0;font-weight:bold">1</span>) <span style="color:#fff;font-weight:bold">as</span> client_ip <span style="color:#fff;font-weight:bold">from</span> information_schema.processlist) <span style="color:#fff;font-weight:bold">as</span> connect_info
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">group</span> <span style="color:#fff;font-weight:bold">by</span> client_ip
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> client_num <span style="color:#fff;font-weight:bold">desc</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看正在执行的线程，并按 Time 倒排序，看看有没有执行时间特别长的线程</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> *
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> information_schema.processlist
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">where</span> Command != <span style="color:#0ff;font-weight:bold">&#39;Sleep&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> Time <span style="color:#fff;font-weight:bold">desc</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>找出所有执行时间超过 5 分钟的线程，拼凑出 kill 语句，方便后面查杀</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">select</span> concat(<span style="color:#0ff;font-weight:bold">&#39;kill &#39;</span>, id, <span style="color:#0ff;font-weight:bold">&#39;;&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> information_schema.processlist
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">where</span> Command != <span style="color:#0ff;font-weight:bold">&#39;Sleep&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">and</span> Time &gt; <span style="color:#ff0;font-weight:bold">300</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">order</span> <span style="color:#fff;font-weight:bold">by</span> Time <span style="color:#fff;font-weight:bold">desc</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="mysql账户">mysql账户<a hidden class="anchor" aria-hidden="true" href="#mysql账户">#</a></h1>
<p>添加用户
<code>create user zhangsan identified by 'myPass';</code>
上面的命令创建了用户zhangsan，密码是myPass。在mysql.user表里可以查看到新增用户的信息。
<code>select * from mysql.user</code></p>
<p>授权
<code>grant privilegesCode on dbName.tableName to username@host identified by &quot;password&quot;;</code></p>
<p>示例
<code>grant all privileges on zhangsanDb.* to zhangsan@'%' identified by 'myPass';</code>
<code>flush privileges;</code>
上面的语句将zhangsanDb数据库的所有操作权限都授权给了用户zhangsan。
在mysql.db表里可以查看到新增数据库权限的信息
<code>select * from mysql.db where User = 'zhangsan'</code></p>
<p>也可以通过<code>show grants</code>命令查看权限授予执行的命令：
<code>show grants for 'zhangsan';</code></p>
<p>privilegesCode表示授予的权限类型，常用的有以下几种类型：
<code>all privileges</code>：所有权限。
<code>select</code>：读取权限。
<code>delete</code>：删除权限。
<code>update</code>：更新权限。
<code>create</code>：创建权限。
<code>drop</code>：删除数据库、数据表权限。</p>
<p>dbName.tableName表示授予权限的具体库或表，常用的有以下几种选项：
<code>.</code>：授予该数据库服务器所有数据库的权限。
<code>dbName.*</code>：授予dbName数据库所有表的权限。
<code>dbName.dbTable</code>：授予数据库dbName中dbTable表的权限。
<code>username@host</code>：授予的用户以及允许该用户登录的IP地址。其中Host有以下几种类型：</p>
<p><code>localhost</code>：只允许该用户在本地登录，不能远程登录。
<code>%</code>：允许在除本机之外的任何一台机器远程登录。
<code>192.168.1.15</code>：具体的IP表示只允许该用户从特定IP登录。
<code>password</code>：指定该用户登录时的密码。
<code>flush privileges</code>：表示刷新权限变更。</p>
<p><a href="https://www.cnblogs.com/chanshuyi/p/mysql_user_mng.html">参考</a></p>
<h2 id="修改密码">修改密码<a hidden class="anchor" aria-hidden="true" href="#修改密码">#</a></h2>
<p><code>update mysql.user set password = password('zhangsannew') where user = 'zhangsan' and host = '%';</code>
<code>flush privileges;</code></p>
<h2 id="删除用户">删除用户<a hidden class="anchor" aria-hidden="true" href="#删除用户">#</a></h2>
<p><code>drop user zhangsan@'%';</code></p>
<h1 id="间隙锁死锁">间隙锁死锁<a hidden class="anchor" aria-hidden="true" href="#间隙锁死锁">#</a></h1>
<p>版本信息：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>MySQL版本：5.6.36-82.1-log 
</span></span><span style="display:flex;"><span>Mybatis-Plus的starter版本：3.3.2
</span></span><span style="display:flex;"><span>存储引擎：InnoDB
</span></span></code></pre></td></tr></table>
</div>
</div><p>死锁现象</p>
<p>A同学在<strong>生产环境</strong>使用了Mybatis-Plus提供的</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>com.baomidou.mybatisplus.extension.service.IService#saveOrUpdate(T,com.baomidou.mybatisplus.core.conditions.Wrapper)*
</span></span></code></pre></td></tr></table>
</div>
</div><p>方法（以下简称<strong>B方法</strong>），并发场景下，数据库报了如下错误</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Deadlock found when trying to get lock; try restarting transaction; nested exception is java.sql.BatchupdateException: Deadlock found when trying to get lock;try restarting transaction
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="为什么是间隙锁死锁">为什么是间隙锁死锁？<a hidden class="anchor" aria-hidden="true" href="#为什么是间隙锁死锁">#</a></h2>
<p>如上图示，数据库报了死锁，那死锁场景千万种，为什么确定B方法是由于间隙锁导致的死锁？</p>
<h3 id="什么是死锁">什么是死锁？<a hidden class="anchor" aria-hidden="true" href="#什么是死锁">#</a></h3>
<p>两个事务互相等待对方持有的锁，导致互相阻塞，从而导致死锁。</p>
<h3 id="什么是间隙锁">什么是间隙锁？<a hidden class="anchor" aria-hidden="true" href="#什么是间隙锁">#</a></h3>
<ul>
<li>间隙锁是MySQL行锁的一种，与Record lock不同的是间隙锁锁定的是一个间隙。</li>
<li>锁定规则如下：</li>
</ul>
<p>MySQL会向左找第一个比当前索引值小的值，向右找第一个比当前索引值大 的值（没有则为正无穷），将此区间锁住，从而阻止其他事务在此区间插入数据。</p>
<h3 id="mysql为什么要引入间隙锁">MySQL为什么要引入间隙锁？<a hidden class="anchor" aria-hidden="true" href="#mysql为什么要引入间隙锁">#</a></h3>
<p>与Record lock组合成Next-key lock，在可重复读这种隔离级别下一起工作避免幻读。</p>
<h3 id="间隙锁死锁分析">间隙锁死锁分析<a hidden class="anchor" aria-hidden="true" href="#间隙锁死锁分析">#</a></h3>
<p>理论上一款开源的框架，经过了多年打磨，提供的方法不应该造成如此严重的错误，但理论仅仅是理论上，事实就是发生了死锁，于是我们开始了一轮深度排查。首先我们从这个方法的源码入手，源码如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">boolean</span> saveOrUpdate(T entity, Wrapper&lt;T&gt; updateWrapper) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">update</span>(entity, updateWrapper) || <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">saveOrUpdate</span>(entity);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>从源码上看此方法就没有按套路出牌，正常逻辑应该是首先执行查询，存在则修改，不存在则新增，但此方法上来就执行了修改。我们就猜想是不是MySQL在修改时增加了什么锁导致了死锁，于是我们找到了DBA获取了最新的死锁日志，即执行<strong>show engine innodb status</strong>，我们发现了两项关键信息如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>*** (<span style="color:#ff0;font-weight:bold">1</span>) TRANSACTION:
</span></span><span style="display:flex;"><span>...<span style="color:#f00">省略日志</span>
</span></span><span style="display:flex;"><span>*** (<span style="color:#ff0;font-weight:bold">1</span>) WAITING <span style="color:#fff;font-weight:bold">FOR</span> THIS <span style="color:#fff;font-weight:bold">LOCK</span> <span style="color:#fff;font-weight:bold">TO</span> BE GRANTED:
</span></span><span style="display:flex;"><span>RECORD LOCKS space id <span style="color:#ff0;font-weight:bold">0</span> page no <span style="color:#ff0;font-weight:bold">347</span> n bits <span style="color:#ff0;font-weight:bold">80</span> <span style="color:#fff;font-weight:bold">index</span> `<span style="color:#fff;font-weight:bold">PRIMARY</span>` of <span style="color:#fff;font-weight:bold">table</span> `database_name`.`table_name` trx id <span style="color:#ff0;font-weight:bold">71</span>C lock_mode X locks gap <span style="color:#fff;font-weight:bold">before</span> rec <span style="color:#fff;font-weight:bold">insert</span> intention waiting
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>*** (<span style="color:#ff0;font-weight:bold">2</span>) TRANSACTION:
</span></span><span style="display:flex;"><span>...<span style="color:#f00">省略日志</span>
</span></span><span style="display:flex;"><span>*** (<span style="color:#ff0;font-weight:bold">2</span>) WAITING <span style="color:#fff;font-weight:bold">FOR</span> THIS <span style="color:#fff;font-weight:bold">LOCK</span> <span style="color:#fff;font-weight:bold">TO</span> BE GRANTED:
</span></span><span style="display:flex;"><span>RECORD LOCKS space id <span style="color:#ff0;font-weight:bold">0</span> page no <span style="color:#ff0;font-weight:bold">347</span> n bits <span style="color:#ff0;font-weight:bold">80</span> <span style="color:#fff;font-weight:bold">index</span> `<span style="color:#fff;font-weight:bold">PRIMARY</span>` of <span style="color:#fff;font-weight:bold">table</span> `database_name`.`table_name` trx id <span style="color:#ff0;font-weight:bold">71</span>D lock_mode X locks gap <span style="color:#fff;font-weight:bold">before</span> rec <span style="color:#fff;font-weight:bold">insert</span> intention waiting
</span></span></code></pre></td></tr></table>
</div>
</div><p>简单翻译一下，就是事务一在获取插入意向锁时，需要等待间隙锁（事务二添加）释放，同时事务二在获取插入意向锁时，也在等待间隙锁释放（事务一添加），**（本文不讨论MySQL在修改与插入时添加的锁，我们把修改时添加间隙锁，插入时获取插入意向锁为已知条件）**那我们回到B方法，并发场景下，是不是就很大几率会满足事务一和事务二相互等待对方持有的间隙锁，从而导致死锁。</p>
<p>现在我们理论有了，我们现在用真实数据来验证此场景。</p>
<h3 id="验证间隙锁死锁">验证间隙锁死锁<a hidden class="anchor" aria-hidden="true" href="#验证间隙锁死锁">#</a></h3>
<p>准备如下表结构（以下简称验证一）</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">table</span> t_gap_lock(
</span></span><span style="display:flex;"><span>    id <span style="color:#fff;font-weight:bold">int</span> auto_increment <span style="color:#fff;font-weight:bold">primary</span> <span style="color:#fff;font-weight:bold">key</span> <span style="color:#fff;font-weight:bold">comment</span> <span style="color:#0ff;font-weight:bold">&#39;主键ID&#39;</span>,
</span></span><span style="display:flex;"><span>    name <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">64</span>) <span style="color:#fff;font-weight:bold">not</span> <span style="color:#fff;font-weight:bold">null</span> <span style="color:#fff;font-weight:bold">comment</span> <span style="color:#0ff;font-weight:bold">&#39;名称&#39;</span>,
</span></span><span style="display:flex;"><span>    age <span style="color:#fff;font-weight:bold">int</span> <span style="color:#fff;font-weight:bold">not</span> <span style="color:#fff;font-weight:bold">null</span> <span style="color:#fff;font-weight:bold">comment</span> <span style="color:#0ff;font-weight:bold">&#39;年龄&#39;</span>
</span></span><span style="display:flex;"><span>) <span style="color:#fff;font-weight:bold">comment</span> <span style="color:#0ff;font-weight:bold">&#39;间隙锁测试表&#39;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>准备如下表数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">select</span> * <span style="color:#fff;font-weight:bold">from</span> t_gap_lock;
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>| id | name | age |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>|  <span style="color:#ff0;font-weight:bold">1</span> | <span style="color:#f00">张三</span> |  <span style="color:#ff0;font-weight:bold">18</span> |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">5</span> | <span style="color:#f00">李四</span> |  <span style="color:#ff0;font-weight:bold">19</span> |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">6</span> | <span style="color:#f00">王五</span> |  <span style="color:#ff0;font-weight:bold">20</span> |
</span></span><span style="display:flex;"><span>|  <span style="color:#ff0;font-weight:bold">9</span> | <span style="color:#f00">赵六</span> |  <span style="color:#ff0;font-weight:bold">21</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ff0;font-weight:bold">12</span> | <span style="color:#f00">孙七</span> |  <span style="color:#ff0;font-weight:bold">22</span> |
</span></span><span style="display:flex;"><span>+<span style="color:#007f7f">----+------+-----+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>我们开启事务一，并执行如下语句，注意这个时候我们还没有提交事务</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">begin</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">update</span> t_gap_lock t <span style="color:#fff;font-weight:bold">set</span> t.age = <span style="color:#ff0;font-weight:bold">25</span> <span style="color:#fff;font-weight:bold">where</span> t.id = <span style="color:#ff0;font-weight:bold">4</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">Rows</span> matched: <span style="color:#ff0;font-weight:bold">0</span>  Changed: <span style="color:#ff0;font-weight:bold">0</span>  Warnings: <span style="color:#ff0;font-weight:bold">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>同时我们开启事务二，并执行如下语句，事务二我们同样不提交事务</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">begin</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">update</span> t_gap_lock t <span style="color:#fff;font-weight:bold">set</span> t.age = <span style="color:#ff0;font-weight:bold">25</span> <span style="color:#fff;font-weight:bold">where</span> t.id = <span style="color:#ff0;font-weight:bold">7</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">Rows</span> matched: <span style="color:#ff0;font-weight:bold">0</span>  Changed: <span style="color:#ff0;font-weight:bold">0</span>  Warnings: <span style="color:#ff0;font-weight:bold">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来我们在事务一中执行如下语句</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_gap_lock(id, name, age) value (<span style="color:#ff0;font-weight:bold">7</span>,<span style="color:#0ff;font-weight:bold">&#39;间隙锁7&#39;</span>,<span style="color:#ff0;font-weight:bold">27</span>);  
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们会发现事务一被阻塞了，然后我们执行以下语句看下当前正在锁的事务。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> INFORMATION_SCHEMA.INNODB_LOCKS <span style="color:#f00">\</span><span style="color:#fff;font-weight:bold">G</span>;
</span></span><span style="display:flex;"><span>*************************** <span style="color:#ff0;font-weight:bold">1</span>. <span style="color:#fff;font-weight:bold">row</span> ***************************
</span></span><span style="display:flex;"><span>    lock_id: <span style="color:#ff0;font-weight:bold">749</span>:<span style="color:#ff0;font-weight:bold">0</span>:<span style="color:#ff0;font-weight:bold">360</span>:<span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>lock_trx_id: <span style="color:#ff0;font-weight:bold">749</span>
</span></span><span style="display:flex;"><span>  lock_mode: X,GAP
</span></span><span style="display:flex;"><span>  lock_type: RECORD
</span></span><span style="display:flex;"><span> lock_table: `test`.`t_gap_lock`
</span></span><span style="display:flex;"><span> lock_index: `<span style="color:#fff;font-weight:bold">PRIMARY</span>`
</span></span><span style="display:flex;"><span> lock_space: <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  lock_page: <span style="color:#ff0;font-weight:bold">360</span>
</span></span><span style="display:flex;"><span>   lock_rec: <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>  lock_data: <span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>*************************** <span style="color:#ff0;font-weight:bold">2</span>. <span style="color:#fff;font-weight:bold">row</span> ***************************
</span></span><span style="display:flex;"><span>    lock_id: <span style="color:#ff0;font-weight:bold">74</span>A:<span style="color:#ff0;font-weight:bold">0</span>:<span style="color:#ff0;font-weight:bold">360</span>:<span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>lock_trx_id: <span style="color:#ff0;font-weight:bold">74</span>A
</span></span><span style="display:flex;"><span>  lock_mode: X,GAP
</span></span><span style="display:flex;"><span>  lock_type: RECORD
</span></span><span style="display:flex;"><span> lock_table: `test`.`t_gap_lock`
</span></span><span style="display:flex;"><span> lock_index: `<span style="color:#fff;font-weight:bold">PRIMARY</span>`
</span></span><span style="display:flex;"><span> lock_space: <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  lock_page: <span style="color:#ff0;font-weight:bold">360</span>
</span></span><span style="display:flex;"><span>   lock_rec: <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>  lock_data: <span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">2</span> <span style="color:#fff;font-weight:bold">rows</span> <span style="color:#fff;font-weight:bold">in</span> <span style="color:#fff;font-weight:bold">set</span> (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据lock_type和lock_mode我们可以很清晰的看到锁类型是行锁，锁模式是间隙锁。</p>
<p>与此同时我们在事务二中执行如下语句</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_gap_lock(id, name, age) value (<span style="color:#ff0;font-weight:bold">4</span>,<span style="color:#0ff;font-weight:bold">&#39;间隙锁4&#39;</span>,<span style="color:#ff0;font-weight:bold">24</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>一执行以上语句，数据库就立马报了死锁，并且回滚了事务二（可以在死锁日志中看到*** WE ROLL BACK TRANSACTION (2)）</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>ERROR <span style="color:#ff0;font-weight:bold">1213</span> (<span style="color:#ff0;font-weight:bold">40001</span>): Deadlock <span style="color:#fff;font-weight:bold">found</span> <span style="color:#fff;font-weight:bold">when</span> trying <span style="color:#fff;font-weight:bold">to</span> <span style="color:#fff;font-weight:bold">get</span> <span style="color:#fff;font-weight:bold">lock</span>; try restarting <span style="color:#fff;font-weight:bold">transaction</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>到这里，细心的同学就会发现，诶，你这上面故意造了一个间隙，并且让两个事务分别在对方的间隙中插入数据，太刻意了，生产环境基本上不会有这种场景，是的，生产环境怎么会有这种场景呢，上面的数据只是为了让大家直观的看到间隙锁的死锁过程，接下来那我们再来一组数据，我们简称验证二。</p>
<p>我们还是以验证一的表结构与数据，我们来执行这样一个操作。首先我们开始开启事务一并且执行如下操作，依然不提交事务</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">begin</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">update</span> t_gap_lock t <span style="color:#fff;font-weight:bold">set</span> t.age = <span style="color:#ff0;font-weight:bold">25</span> <span style="color:#fff;font-weight:bold">where</span> t.id = <span style="color:#ff0;font-weight:bold">4</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">Rows</span> matched: <span style="color:#ff0;font-weight:bold">0</span>  Changed: <span style="color:#ff0;font-weight:bold">0</span>  Warnings: <span style="color:#ff0;font-weight:bold">0</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>同时我们开启事务二，执行与事务一一样的操作，我们会惊奇的发现，竟然也成功了。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">begin</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">update</span> t_gap_lock t <span style="color:#fff;font-weight:bold">set</span> t.age = <span style="color:#ff0;font-weight:bold">25</span> <span style="color:#fff;font-weight:bold">where</span> t.id = <span style="color:#ff0;font-weight:bold">4</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">Rows</span> matched: <span style="color:#ff0;font-weight:bold">0</span>  Changed: <span style="color:#ff0;font-weight:bold">0</span>  Warnings: <span style="color:#ff0;font-weight:bold">0</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>于是乎我们在事务一执行如下操作，我们又惊奇的发现事务一被阻塞了。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_gap_lock(id, name, age) value (<span style="color:#ff0;font-weight:bold">4</span>,<span style="color:#0ff;font-weight:bold">&#39;间隙锁4&#39;</span>,<span style="color:#ff0;font-weight:bold">24</span>);  
</span></span></code></pre></td></tr></table>
</div>
</div><p>在事务一被阻塞的同时，我们在事务二执行同样的语句，我们发现数据库立马就报了死锁。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> t_gap_lock(id, name, age) value (<span style="color:#ff0;font-weight:bold">4</span>,<span style="color:#0ff;font-weight:bold">&#39;间隙锁4&#39;</span>,<span style="color:#ff0;font-weight:bold">24</span>);    
</span></span><span style="display:flex;"><span>ERROR <span style="color:#ff0;font-weight:bold">1213</span> (<span style="color:#ff0;font-weight:bold">40001</span>): Deadlock <span style="color:#fff;font-weight:bold">found</span> <span style="color:#fff;font-weight:bold">when</span> trying <span style="color:#fff;font-weight:bold">to</span> <span style="color:#fff;font-weight:bold">get</span> <span style="color:#fff;font-weight:bold">lock</span>; try restarting <span style="color:#fff;font-weight:bold">transaction</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>验证二完整的复现了线上死锁的过程，也就是事务一先执行了更新语句，事务二在同一时刻也执行了更新语句，然后事务一发现没有更新到就去执行主键查询语句，发现确实没有，所以执行了插入语句，但是插入要先获取插入意向锁，在获取插入意向锁的时候发现这个间隙已经被事务二加锁了，所以事务一开始等待事务二释放间隙锁，同理，事务二也执行上述操作，最终导致事务一与事务二互相等待对方释放间隙锁，最终导致死锁。</p>
<p>验证二还说明了一个问题，就是间隙锁加锁是非互斥的，也就是事务一对间隙A加锁后，事务二依然可以给间隙A加锁。</p>
<h2 id="如何解决">如何解决？<a hidden class="anchor" aria-hidden="true" href="#如何解决">#</a></h2>
<h3 id="关闭间隙锁不推荐">关闭间隙锁（不推荐）<a hidden class="anchor" aria-hidden="true" href="#关闭间隙锁不推荐">#</a></h3>
<ul>
<li>降低隔离级别，例如降为提交读。</li>
<li>直接修改my.cnf，将开关，innodb_locks_unsafe_for_binlog改为1，默认为0即开启</li>
</ul>
<p>PS：以上方法仅适用于当前业务场景确实不关心幻读的问题。</p>
<h3 id="自定义saveorupdate方法推荐">自定义saveOrUpdate方法（推荐）<a hidden class="anchor" aria-hidden="true" href="#自定义saveorupdate方法推荐">#</a></h3>
<h2 id="拓展">拓展<a hidden class="anchor" aria-hidden="true" href="#拓展">#</a></h2>
<h3 id="如果两个事务同时修改存在的行会发生什么">如果两个事务同时修改存在的行会发生什么？<a hidden class="anchor" aria-hidden="true" href="#如果两个事务同时修改存在的行会发生什么">#</a></h3>
<p>在验证二中两个事务修改的都是不存在的行，都能加间隙锁成功，那如果两个事务修改的是存在的行，MySQL还会加间隙锁吗？或者说把间隙锁从锁间隙降为锁一行？带着疑问，我们执行以下数据验证，我们还是使用验证一的表和数据。</p>
<p>首先我们开启事务一执行以下语句</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">begin</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">update</span> t_gap_lock t <span style="color:#fff;font-weight:bold">set</span> t.age = <span style="color:#ff0;font-weight:bold">25</span> <span style="color:#fff;font-weight:bold">where</span> t.id = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#fff;font-weight:bold">row</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">Rows</span> matched: <span style="color:#ff0;font-weight:bold">1</span>  Changed: <span style="color:#ff0;font-weight:bold">1</span>  Warnings: <span style="color:#ff0;font-weight:bold">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们再开启事务二，执行同样的语句，发现事务二已经被阻塞</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">begin</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">rows</span> affected (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">update</span> t_gap_lock t <span style="color:#fff;font-weight:bold">set</span> t.age = <span style="color:#ff0;font-weight:bold">25</span> <span style="color:#fff;font-weight:bold">where</span> t.id = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个时候我们执行以下语句看下当前正在锁的事务。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql&gt; <span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> INFORMATION_SCHEMA.INNODB_LOCKS <span style="color:#f00">\</span><span style="color:#fff;font-weight:bold">G</span>;
</span></span><span style="display:flex;"><span>*************************** <span style="color:#ff0;font-weight:bold">1</span>. <span style="color:#fff;font-weight:bold">row</span> ***************************
</span></span><span style="display:flex;"><span>    lock_id: <span style="color:#ff0;font-weight:bold">75</span><span style="color:#fff;font-weight:bold">C</span>:<span style="color:#ff0;font-weight:bold">0</span>:<span style="color:#ff0;font-weight:bold">360</span>:<span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>lock_trx_id: <span style="color:#ff0;font-weight:bold">75</span><span style="color:#fff;font-weight:bold">C</span>
</span></span><span style="display:flex;"><span>  lock_mode: X
</span></span><span style="display:flex;"><span>  lock_type: RECORD
</span></span><span style="display:flex;"><span> lock_table: `test`.`t_gap_lock`
</span></span><span style="display:flex;"><span> lock_index: `<span style="color:#fff;font-weight:bold">PRIMARY</span>`
</span></span><span style="display:flex;"><span> lock_space: <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  lock_page: <span style="color:#ff0;font-weight:bold">360</span>
</span></span><span style="display:flex;"><span>   lock_rec: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>  lock_data: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>*************************** <span style="color:#ff0;font-weight:bold">2</span>. <span style="color:#fff;font-weight:bold">row</span> ***************************
</span></span><span style="display:flex;"><span>    lock_id: <span style="color:#ff0;font-weight:bold">75</span>B:<span style="color:#ff0;font-weight:bold">0</span>:<span style="color:#ff0;font-weight:bold">360</span>:<span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>lock_trx_id: <span style="color:#ff0;font-weight:bold">75</span>B
</span></span><span style="display:flex;"><span>  lock_mode: X
</span></span><span style="display:flex;"><span>  lock_type: RECORD
</span></span><span style="display:flex;"><span> lock_table: `test`.`t_gap_lock`
</span></span><span style="display:flex;"><span> lock_index: `<span style="color:#fff;font-weight:bold">PRIMARY</span>`
</span></span><span style="display:flex;"><span> lock_space: <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  lock_page: <span style="color:#ff0;font-weight:bold">360</span>
</span></span><span style="display:flex;"><span>   lock_rec: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>  lock_data: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">2</span> <span style="color:#fff;font-weight:bold">rows</span> <span style="color:#fff;font-weight:bold">in</span> <span style="color:#fff;font-weight:bold">set</span> (<span style="color:#ff0;font-weight:bold">0</span>.<span style="color:#ff0;font-weight:bold">00</span> sec)
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据lock_type和lock_mode我们看到事务一和二加的锁变成了Record Lock，并没有再添加间隙锁，根据以上数据验证MySQL在修改存在的数据时会给行加上Record Lock，与间隙锁不同的是该锁是互斥的，即不同的事务不能同时对同一行记录添加Record Lock。</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://funny-toffee-4aa7c3.netlify.app/tags/mysql/">mysql</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://funny-toffee-4aa7c3.netlify.app/posts/mysql/mysql%E6%8A%80%E5%B7%A7/">
    <span class="title">« Prev</span>
    <br>
    <span>mysql技巧</span>
  </a>
  <a class="next" href="https://funny-toffee-4aa7c3.netlify.app/posts/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/git/">
    <span class="title">Next »</span>
    <br>
    <span>git</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://funny-toffee-4aa7c3.netlify.app/">Wjy&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>