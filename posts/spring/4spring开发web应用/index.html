<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>4ã€Springå¼€å‘webåº”ç”¨ | Wjy&#39;s Blog</title>
<meta name="keywords" content="spring">
<meta name="description" content="å¼€å‘Webåº”ç”¨
åœ¨Webå¼€å‘ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†ä»‹ç»äº†JavaEEä¸­Webå¼€å‘çš„åŸºç¡€ï¼šServletã€‚å…·ä½“åœ°è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

Servletè§„èŒƒå®šä¹‰äº†å‡ ç§æ ‡å‡†ç»„ä»¶ï¼šServletã€JSPã€Filterå’ŒListenerï¼›
Servletçš„æ ‡å‡†ç»„ä»¶æ€»æ˜¯è¿è¡Œåœ¨Servletå®¹å™¨ä¸­ï¼Œå¦‚Tomcatã€Jettyã€WebLogicç­‰ã€‚

ç›´æ¥ä½¿ç”¨Servletè¿›è¡ŒWebå¼€å‘å¥½æ¯”ç›´æ¥åœ¨JDBCä¸Šæ“ä½œæ•°æ®åº“ï¼Œæ¯”è¾ƒç¹çï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨ServletåŸºç¡€ä¸Šå°è£…MVCæ¡†æ¶ï¼ŒåŸºäºMVCå¼€å‘Webåº”ç”¨ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ï¼Œä¸éœ€è¦æ¥è§¦Servlet APIï¼Œå¼€å‘çœæ—¶çœåŠ›ã€‚
æˆ‘ä»¬åœ¨MVCå¼€å‘å’ŒMVCé«˜çº§å¼€å‘å·²ç»ç”±æµ…å…¥æ·±åœ°ä»‹ç»äº†å¦‚ä½•ç¼–å†™MVCæ¡†æ¶ã€‚å½“ç„¶ï¼Œè‡ªå·±å†™çš„MVCä¸»è¦æ˜¯ç†è§£åŸç†ï¼Œè¦å®ç°ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„MVCéœ€è¦å¤§é‡çš„å·¥ä½œä»¥åŠå¹¿æ³›çš„æµ‹è¯•ã€‚
å› æ­¤ï¼Œå¼€å‘Webåº”ç”¨ï¼Œé¦–å…ˆè¦é€‰æ‹©ä¸€ä¸ªä¼˜ç§€çš„MVCæ¡†æ¶ã€‚å¸¸ç”¨çš„MVCæ¡†æ¶æœ‰ï¼š

Strutsï¼šæœ€å¤è€çš„ä¸€ä¸ªMVCæ¡†æ¶ï¼Œç›®å‰ç‰ˆæœ¬æ˜¯2ï¼Œå’Œ1.xæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼›
WebWorkï¼šä¸€ä¸ªæ¯”Strutsè®¾è®¡æ›´ä¼˜ç§€çš„MVCæ¡†æ¶ï¼Œä½†ä¸çŸ¥é“å‡ºäºä»€ä¹ˆåŸå› ï¼Œä»2.0å¼€å§‹æŠŠè‡ªå·±çš„ä»£ç å…¨éƒ¨å¡ç»™Struts 2äº†ï¼›
Turbineï¼šä¸€ä¸ªé‡åº¦ä½¿ç”¨Velocityï¼Œå¼ºè°ƒå¸ƒå±€çš„MVCæ¡†æ¶ï¼›
å…¶ä»–100&#43;MVCæ¡†æ¶â€¦â€¦ï¼ˆç•¥ï¼‰

Springè™½ç„¶éƒ½å¯ä»¥é›†æˆä»»ä½•Webæ¡†æ¶ï¼Œä½†æ˜¯ï¼ŒSpringæœ¬èº«ä¹Ÿå¼€å‘äº†ä¸€ä¸ªMVCæ¡†æ¶ï¼Œå°±å«Spring MVCã€‚è¿™ä¸ªMVCæ¡†æ¶è®¾è®¡å¾—è¶³å¤Ÿä¼˜ç§€ä»¥è‡³äºæˆ‘ä»¬å·²ç»ä¸æƒ³å†è´¹åŠ²å»é›†æˆç±»ä¼¼Strutsè¿™æ ·çš„æ¡†æ¶äº†ã€‚
æœ¬ç« æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»å¦‚ä½•åŸºäºSpring MVCå¼€å‘Webåº”ç”¨ã€‚">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://009965.xyz/posts/spring/4spring%E5%BC%80%E5%8F%91web%E5%BA%94%E7%94%A8/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://009965.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://009965.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://009965.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://009965.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://009965.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://009965.xyz/posts/spring/4spring%E5%BC%80%E5%8F%91web%E5%BA%94%E7%94%A8/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://009965.xyz/posts/spring/4spring%E5%BC%80%E5%8F%91web%E5%BA%94%E7%94%A8/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="4ã€Springå¼€å‘webåº”ç”¨">
  <meta property="og:description" content="å¼€å‘Webåº”ç”¨ åœ¨Webå¼€å‘ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†ä»‹ç»äº†JavaEEä¸­Webå¼€å‘çš„åŸºç¡€ï¼šServletã€‚å…·ä½“åœ°è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š
Servletè§„èŒƒå®šä¹‰äº†å‡ ç§æ ‡å‡†ç»„ä»¶ï¼šServletã€JSPã€Filterå’ŒListenerï¼› Servletçš„æ ‡å‡†ç»„ä»¶æ€»æ˜¯è¿è¡Œåœ¨Servletå®¹å™¨ä¸­ï¼Œå¦‚Tomcatã€Jettyã€WebLogicç­‰ã€‚ ç›´æ¥ä½¿ç”¨Servletè¿›è¡ŒWebå¼€å‘å¥½æ¯”ç›´æ¥åœ¨JDBCä¸Šæ“ä½œæ•°æ®åº“ï¼Œæ¯”è¾ƒç¹çï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨ServletåŸºç¡€ä¸Šå°è£…MVCæ¡†æ¶ï¼ŒåŸºäºMVCå¼€å‘Webåº”ç”¨ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ï¼Œä¸éœ€è¦æ¥è§¦Servlet APIï¼Œå¼€å‘çœæ—¶çœåŠ›ã€‚
æˆ‘ä»¬åœ¨MVCå¼€å‘å’ŒMVCé«˜çº§å¼€å‘å·²ç»ç”±æµ…å…¥æ·±åœ°ä»‹ç»äº†å¦‚ä½•ç¼–å†™MVCæ¡†æ¶ã€‚å½“ç„¶ï¼Œè‡ªå·±å†™çš„MVCä¸»è¦æ˜¯ç†è§£åŸç†ï¼Œè¦å®ç°ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„MVCéœ€è¦å¤§é‡çš„å·¥ä½œä»¥åŠå¹¿æ³›çš„æµ‹è¯•ã€‚
å› æ­¤ï¼Œå¼€å‘Webåº”ç”¨ï¼Œé¦–å…ˆè¦é€‰æ‹©ä¸€ä¸ªä¼˜ç§€çš„MVCæ¡†æ¶ã€‚å¸¸ç”¨çš„MVCæ¡†æ¶æœ‰ï¼š
Strutsï¼šæœ€å¤è€çš„ä¸€ä¸ªMVCæ¡†æ¶ï¼Œç›®å‰ç‰ˆæœ¬æ˜¯2ï¼Œå’Œ1.xæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼› WebWorkï¼šä¸€ä¸ªæ¯”Strutsè®¾è®¡æ›´ä¼˜ç§€çš„MVCæ¡†æ¶ï¼Œä½†ä¸çŸ¥é“å‡ºäºä»€ä¹ˆåŸå› ï¼Œä»2.0å¼€å§‹æŠŠè‡ªå·±çš„ä»£ç å…¨éƒ¨å¡ç»™Struts 2äº†ï¼› Turbineï¼šä¸€ä¸ªé‡åº¦ä½¿ç”¨Velocityï¼Œå¼ºè°ƒå¸ƒå±€çš„MVCæ¡†æ¶ï¼› å…¶ä»–100&#43;MVCæ¡†æ¶â€¦â€¦ï¼ˆç•¥ï¼‰ Springè™½ç„¶éƒ½å¯ä»¥é›†æˆä»»ä½•Webæ¡†æ¶ï¼Œä½†æ˜¯ï¼ŒSpringæœ¬èº«ä¹Ÿå¼€å‘äº†ä¸€ä¸ªMVCæ¡†æ¶ï¼Œå°±å«Spring MVCã€‚è¿™ä¸ªMVCæ¡†æ¶è®¾è®¡å¾—è¶³å¤Ÿä¼˜ç§€ä»¥è‡³äºæˆ‘ä»¬å·²ç»ä¸æƒ³å†è´¹åŠ²å»é›†æˆç±»ä¼¼Strutsè¿™æ ·çš„æ¡†æ¶äº†ã€‚
æœ¬ç« æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»å¦‚ä½•åŸºäºSpring MVCå¼€å‘Webåº”ç”¨ã€‚">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-01-04T18:56:17+00:00">
    <meta property="article:modified_time" content="2020-01-04T18:56:17+00:00">
    <meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="4ã€Springå¼€å‘webåº”ç”¨">
<meta name="twitter:description" content="å¼€å‘Webåº”ç”¨
åœ¨Webå¼€å‘ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†ä»‹ç»äº†JavaEEä¸­Webå¼€å‘çš„åŸºç¡€ï¼šServletã€‚å…·ä½“åœ°è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

Servletè§„èŒƒå®šä¹‰äº†å‡ ç§æ ‡å‡†ç»„ä»¶ï¼šServletã€JSPã€Filterå’ŒListenerï¼›
Servletçš„æ ‡å‡†ç»„ä»¶æ€»æ˜¯è¿è¡Œåœ¨Servletå®¹å™¨ä¸­ï¼Œå¦‚Tomcatã€Jettyã€WebLogicç­‰ã€‚

ç›´æ¥ä½¿ç”¨Servletè¿›è¡ŒWebå¼€å‘å¥½æ¯”ç›´æ¥åœ¨JDBCä¸Šæ“ä½œæ•°æ®åº“ï¼Œæ¯”è¾ƒç¹çï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨ServletåŸºç¡€ä¸Šå°è£…MVCæ¡†æ¶ï¼ŒåŸºäºMVCå¼€å‘Webåº”ç”¨ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ï¼Œä¸éœ€è¦æ¥è§¦Servlet APIï¼Œå¼€å‘çœæ—¶çœåŠ›ã€‚
æˆ‘ä»¬åœ¨MVCå¼€å‘å’ŒMVCé«˜çº§å¼€å‘å·²ç»ç”±æµ…å…¥æ·±åœ°ä»‹ç»äº†å¦‚ä½•ç¼–å†™MVCæ¡†æ¶ã€‚å½“ç„¶ï¼Œè‡ªå·±å†™çš„MVCä¸»è¦æ˜¯ç†è§£åŸç†ï¼Œè¦å®ç°ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„MVCéœ€è¦å¤§é‡çš„å·¥ä½œä»¥åŠå¹¿æ³›çš„æµ‹è¯•ã€‚
å› æ­¤ï¼Œå¼€å‘Webåº”ç”¨ï¼Œé¦–å…ˆè¦é€‰æ‹©ä¸€ä¸ªä¼˜ç§€çš„MVCæ¡†æ¶ã€‚å¸¸ç”¨çš„MVCæ¡†æ¶æœ‰ï¼š

Strutsï¼šæœ€å¤è€çš„ä¸€ä¸ªMVCæ¡†æ¶ï¼Œç›®å‰ç‰ˆæœ¬æ˜¯2ï¼Œå’Œ1.xæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼›
WebWorkï¼šä¸€ä¸ªæ¯”Strutsè®¾è®¡æ›´ä¼˜ç§€çš„MVCæ¡†æ¶ï¼Œä½†ä¸çŸ¥é“å‡ºäºä»€ä¹ˆåŸå› ï¼Œä»2.0å¼€å§‹æŠŠè‡ªå·±çš„ä»£ç å…¨éƒ¨å¡ç»™Struts 2äº†ï¼›
Turbineï¼šä¸€ä¸ªé‡åº¦ä½¿ç”¨Velocityï¼Œå¼ºè°ƒå¸ƒå±€çš„MVCæ¡†æ¶ï¼›
å…¶ä»–100&#43;MVCæ¡†æ¶â€¦â€¦ï¼ˆç•¥ï¼‰

Springè™½ç„¶éƒ½å¯ä»¥é›†æˆä»»ä½•Webæ¡†æ¶ï¼Œä½†æ˜¯ï¼ŒSpringæœ¬èº«ä¹Ÿå¼€å‘äº†ä¸€ä¸ªMVCæ¡†æ¶ï¼Œå°±å«Spring MVCã€‚è¿™ä¸ªMVCæ¡†æ¶è®¾è®¡å¾—è¶³å¤Ÿä¼˜ç§€ä»¥è‡³äºæˆ‘ä»¬å·²ç»ä¸æƒ³å†è´¹åŠ²å»é›†æˆç±»ä¼¼Strutsè¿™æ ·çš„æ¡†æ¶äº†ã€‚
æœ¬ç« æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»å¦‚ä½•åŸºäºSpring MVCå¼€å‘Webåº”ç”¨ã€‚">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://009965.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "4ã€Springå¼€å‘webåº”ç”¨",
      "item": "https://009965.xyz/posts/spring/4spring%E5%BC%80%E5%8F%91web%E5%BA%94%E7%94%A8/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "4ã€Springå¼€å‘webåº”ç”¨",
  "name": "4ã€Springå¼€å‘webåº”ç”¨",
  "description": "å¼€å‘Webåº”ç”¨ åœ¨Webå¼€å‘ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†ä»‹ç»äº†JavaEEä¸­Webå¼€å‘çš„åŸºç¡€ï¼šServletã€‚å…·ä½“åœ°è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š\nServletè§„èŒƒå®šä¹‰äº†å‡ ç§æ ‡å‡†ç»„ä»¶ï¼šServletã€JSPã€Filterå’ŒListenerï¼› Servletçš„æ ‡å‡†ç»„ä»¶æ€»æ˜¯è¿è¡Œåœ¨Servletå®¹å™¨ä¸­ï¼Œå¦‚Tomcatã€Jettyã€WebLogicç­‰ã€‚ ç›´æ¥ä½¿ç”¨Servletè¿›è¡ŒWebå¼€å‘å¥½æ¯”ç›´æ¥åœ¨JDBCä¸Šæ“ä½œæ•°æ®åº“ï¼Œæ¯”è¾ƒç¹çï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨ServletåŸºç¡€ä¸Šå°è£…MVCæ¡†æ¶ï¼ŒåŸºäºMVCå¼€å‘Webåº”ç”¨ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ï¼Œä¸éœ€è¦æ¥è§¦Servlet APIï¼Œå¼€å‘çœæ—¶çœåŠ›ã€‚\næˆ‘ä»¬åœ¨MVCå¼€å‘å’ŒMVCé«˜çº§å¼€å‘å·²ç»ç”±æµ…å…¥æ·±åœ°ä»‹ç»äº†å¦‚ä½•ç¼–å†™MVCæ¡†æ¶ã€‚å½“ç„¶ï¼Œè‡ªå·±å†™çš„MVCä¸»è¦æ˜¯ç†è§£åŸç†ï¼Œè¦å®ç°ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„MVCéœ€è¦å¤§é‡çš„å·¥ä½œä»¥åŠå¹¿æ³›çš„æµ‹è¯•ã€‚\nå› æ­¤ï¼Œå¼€å‘Webåº”ç”¨ï¼Œé¦–å…ˆè¦é€‰æ‹©ä¸€ä¸ªä¼˜ç§€çš„MVCæ¡†æ¶ã€‚å¸¸ç”¨çš„MVCæ¡†æ¶æœ‰ï¼š\nStrutsï¼šæœ€å¤è€çš„ä¸€ä¸ªMVCæ¡†æ¶ï¼Œç›®å‰ç‰ˆæœ¬æ˜¯2ï¼Œå’Œ1.xæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼› WebWorkï¼šä¸€ä¸ªæ¯”Strutsè®¾è®¡æ›´ä¼˜ç§€çš„MVCæ¡†æ¶ï¼Œä½†ä¸çŸ¥é“å‡ºäºä»€ä¹ˆåŸå› ï¼Œä»2.0å¼€å§‹æŠŠè‡ªå·±çš„ä»£ç å…¨éƒ¨å¡ç»™Struts 2äº†ï¼› Turbineï¼šä¸€ä¸ªé‡åº¦ä½¿ç”¨Velocityï¼Œå¼ºè°ƒå¸ƒå±€çš„MVCæ¡†æ¶ï¼› å…¶ä»–100+MVCæ¡†æ¶â€¦â€¦ï¼ˆç•¥ï¼‰ Springè™½ç„¶éƒ½å¯ä»¥é›†æˆä»»ä½•Webæ¡†æ¶ï¼Œä½†æ˜¯ï¼ŒSpringæœ¬èº«ä¹Ÿå¼€å‘äº†ä¸€ä¸ªMVCæ¡†æ¶ï¼Œå°±å«Spring MVCã€‚è¿™ä¸ªMVCæ¡†æ¶è®¾è®¡å¾—è¶³å¤Ÿä¼˜ç§€ä»¥è‡³äºæˆ‘ä»¬å·²ç»ä¸æƒ³å†è´¹åŠ²å»é›†æˆç±»ä¼¼Strutsè¿™æ ·çš„æ¡†æ¶äº†ã€‚\næœ¬ç« æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»å¦‚ä½•åŸºäºSpring MVCå¼€å‘Webåº”ç”¨ã€‚\n",
  "keywords": [
    "spring"
  ],
  "articleBody": "å¼€å‘Webåº”ç”¨ åœ¨Webå¼€å‘ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†ä»‹ç»äº†JavaEEä¸­Webå¼€å‘çš„åŸºç¡€ï¼šServletã€‚å…·ä½“åœ°è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š\nServletè§„èŒƒå®šä¹‰äº†å‡ ç§æ ‡å‡†ç»„ä»¶ï¼šServletã€JSPã€Filterå’ŒListenerï¼› Servletçš„æ ‡å‡†ç»„ä»¶æ€»æ˜¯è¿è¡Œåœ¨Servletå®¹å™¨ä¸­ï¼Œå¦‚Tomcatã€Jettyã€WebLogicç­‰ã€‚ ç›´æ¥ä½¿ç”¨Servletè¿›è¡ŒWebå¼€å‘å¥½æ¯”ç›´æ¥åœ¨JDBCä¸Šæ“ä½œæ•°æ®åº“ï¼Œæ¯”è¾ƒç¹çï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨ServletåŸºç¡€ä¸Šå°è£…MVCæ¡†æ¶ï¼ŒåŸºäºMVCå¼€å‘Webåº”ç”¨ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ï¼Œä¸éœ€è¦æ¥è§¦Servlet APIï¼Œå¼€å‘çœæ—¶çœåŠ›ã€‚\næˆ‘ä»¬åœ¨MVCå¼€å‘å’ŒMVCé«˜çº§å¼€å‘å·²ç»ç”±æµ…å…¥æ·±åœ°ä»‹ç»äº†å¦‚ä½•ç¼–å†™MVCæ¡†æ¶ã€‚å½“ç„¶ï¼Œè‡ªå·±å†™çš„MVCä¸»è¦æ˜¯ç†è§£åŸç†ï¼Œè¦å®ç°ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„MVCéœ€è¦å¤§é‡çš„å·¥ä½œä»¥åŠå¹¿æ³›çš„æµ‹è¯•ã€‚\nå› æ­¤ï¼Œå¼€å‘Webåº”ç”¨ï¼Œé¦–å…ˆè¦é€‰æ‹©ä¸€ä¸ªä¼˜ç§€çš„MVCæ¡†æ¶ã€‚å¸¸ç”¨çš„MVCæ¡†æ¶æœ‰ï¼š\nStrutsï¼šæœ€å¤è€çš„ä¸€ä¸ªMVCæ¡†æ¶ï¼Œç›®å‰ç‰ˆæœ¬æ˜¯2ï¼Œå’Œ1.xæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼› WebWorkï¼šä¸€ä¸ªæ¯”Strutsè®¾è®¡æ›´ä¼˜ç§€çš„MVCæ¡†æ¶ï¼Œä½†ä¸çŸ¥é“å‡ºäºä»€ä¹ˆåŸå› ï¼Œä»2.0å¼€å§‹æŠŠè‡ªå·±çš„ä»£ç å…¨éƒ¨å¡ç»™Struts 2äº†ï¼› Turbineï¼šä¸€ä¸ªé‡åº¦ä½¿ç”¨Velocityï¼Œå¼ºè°ƒå¸ƒå±€çš„MVCæ¡†æ¶ï¼› å…¶ä»–100+MVCæ¡†æ¶â€¦â€¦ï¼ˆç•¥ï¼‰ Springè™½ç„¶éƒ½å¯ä»¥é›†æˆä»»ä½•Webæ¡†æ¶ï¼Œä½†æ˜¯ï¼ŒSpringæœ¬èº«ä¹Ÿå¼€å‘äº†ä¸€ä¸ªMVCæ¡†æ¶ï¼Œå°±å«Spring MVCã€‚è¿™ä¸ªMVCæ¡†æ¶è®¾è®¡å¾—è¶³å¤Ÿä¼˜ç§€ä»¥è‡³äºæˆ‘ä»¬å·²ç»ä¸æƒ³å†è´¹åŠ²å»é›†æˆç±»ä¼¼Strutsè¿™æ ·çš„æ¡†æ¶äº†ã€‚\næœ¬ç« æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»å¦‚ä½•åŸºäºSpring MVCå¼€å‘Webåº”ç”¨ã€‚\nä½¿ç”¨Spring MVC æˆ‘ä»¬åœ¨å‰é¢ä»‹ç»Webå¼€å‘æ—¶å·²ç»è®²è¿‡äº†Java Webçš„åŸºç¡€ï¼šServletå®¹å™¨ï¼Œä»¥åŠæ ‡å‡†çš„Servletç»„ä»¶ï¼š\nServletï¼šèƒ½å¤„ç†HTTPè¯·æ±‚å¹¶å°†HTTPå“åº”è¿”å›ï¼› JSPï¼šä¸€ç§åµŒå¥—Javaä»£ç çš„HTMLï¼Œå°†è¢«ç¼–è¯‘ä¸ºServletï¼› Filterï¼šèƒ½è¿‡æ»¤æŒ‡å®šçš„URLä»¥å®ç°æ‹¦æˆªåŠŸèƒ½ï¼› Listenerï¼šç›‘å¬æŒ‡å®šçš„äº‹ä»¶ï¼Œå¦‚ServletContextã€HttpSessionçš„åˆ›å»ºå’Œé”€æ¯ã€‚ æ­¤å¤–ï¼ŒServletå®¹å™¨ä¸ºæ¯ä¸ªWebåº”ç”¨ç¨‹åºè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ServletContextå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å°±ä»£è¡¨äº†Webåº”ç”¨ç¨‹åºæœ¬èº«ã€‚\nåœ¨MVCé«˜çº§å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ‰‹æ’¸äº†ä¸€ä¸ªMVCæ¡†æ¶ï¼Œæ¥å£å’ŒSpring MVCç±»ä¼¼ã€‚å¦‚æœç›´æ¥ä½¿ç”¨Spring MVCï¼Œæˆ‘ä»¬å†™å‡ºæ¥çš„ä»£ç ç±»ä¼¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 @Controller public class UserController { @GetMapping(\"/register\") public ModelAndView register() { ... } @PostMapping(\"/signin\") public ModelAndView signin(@RequestParam(\"email\") String email, @RequestParam(\"password\") String password) { ... } ... } ä½†æ˜¯ï¼ŒSpringæä¾›çš„æ˜¯ä¸€ä¸ªIoCå®¹å™¨ï¼Œæ‰€æœ‰çš„Beanï¼ŒåŒ…æ‹¬Controllerï¼Œéƒ½åœ¨Spring IoCå®¹å™¨ä¸­è¢«åˆå§‹åŒ–ï¼Œè€ŒServletå®¹å™¨ç”±JavaEEæœåŠ¡å™¨æä¾›ï¼ˆå¦‚Tomcatï¼‰ï¼ŒServletå®¹å™¨å¯¹Springä¸€æ— æ‰€çŸ¥ï¼Œä»–ä»¬ä¹‹é—´åˆ°åº•ä¾é ä»€ä¹ˆè¿›è¡Œè”ç³»ï¼Œåˆæ˜¯ä»¥ä½•ç§é¡ºåºåˆå§‹åŒ–çš„ï¼Ÿ\nåœ¨ç†è§£ä¸Šè¿°é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæŠŠåŸºäºSpring MVCå¼€å‘çš„é¡¹ç›®ç»“æ„æ­å»ºèµ·æ¥ã€‚é¦–å…ˆåˆ›å»ºåŸºäºWebçš„Mavenå·¥ç¨‹ï¼Œå¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š\norg.springframework:spring-context:5.2.0.RELEASE org.springframework:spring-webmvc:5.2.0.RELEASE org.springframework:spring-jdbc:5.2.0.RELEASE javax.annotation:javax.annotation-api:1.3.2 io.pebbletemplates:pebble-spring5:3.1.2 ch.qos.logback:logback-core:1.2.3 ch.qos.logback:logback-classic:1.2.3 com.zaxxer:HikariCP:3.4.2 org.hsqldb:hsqldb:2.5.0 ä»¥åŠprovidedä¾èµ–ï¼š\norg.apache.tomcat.embed:tomcat-embed-core:9.0.26 org.apache.tomcat.embed:tomcat-embed-jasper:9.0.26 è¿™ä¸ªæ ‡å‡†çš„Maven Webå·¥ç¨‹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 spring-web-mvc â”œâ”€â”€ pom.xml â””â”€â”€ src â””â”€â”€ main â”œâ”€â”€ java â”‚ â””â”€â”€ com â”‚ â””â”€â”€ itranswarp â”‚ â””â”€â”€ learnjava â”‚ â”œâ”€â”€ AppConfig.java â”‚ â”œâ”€â”€ DatabaseInitializer.java â”‚ â”œâ”€â”€ entity â”‚ â”‚ â””â”€â”€ User.java â”‚ â”œâ”€â”€ service â”‚ â”‚ â””â”€â”€ UserService.java â”‚ â””â”€â”€ web â”‚ â””â”€â”€ UserController.java â”œâ”€â”€ resources â”‚ â”œâ”€â”€ jdbc.properties â”‚ â””â”€â”€ logback.xml â””â”€â”€ webapp â”œâ”€â”€ WEB-INF â”‚ â”œâ”€â”€ templates â”‚ â”‚ â”œâ”€â”€ _base.html â”‚ â”‚ â”œâ”€â”€ index.html â”‚ â”‚ â”œâ”€â”€ profile.html â”‚ â”‚ â”œâ”€â”€ register.html â”‚ â”‚ â””â”€â”€ signin.html â”‚ â””â”€â”€ web.xml â””â”€â”€ static â”œâ”€â”€ css â”‚ â””â”€â”€ bootstrap.css â””â”€â”€ js â””â”€â”€ jquery.js å…¶ä¸­ï¼Œsrc/main/webappæ˜¯æ ‡å‡†webç›®å½•ï¼ŒWEB-INFå­˜æ”¾web.xmlï¼Œç¼–è¯‘çš„classï¼Œç¬¬ä¸‰æ–¹jarï¼Œä»¥åŠä¸å…è®¸æµè§ˆå™¨ç›´æ¥è®¿é—®çš„Viewæ¨¡ç‰ˆï¼Œstaticç›®å½•å­˜æ”¾æ‰€æœ‰é™æ€æ–‡ä»¶ã€‚\nåœ¨src/main/resourcesç›®å½•ä¸­å­˜æ”¾çš„æ˜¯Javaç¨‹åºè¯»å–çš„classpathèµ„æºæ–‡ä»¶ï¼Œé™¤äº†JDBCçš„é…ç½®æ–‡ä»¶jdbc.propertieså¤–ï¼Œæˆ‘ä»¬åˆæ–°å¢äº†ä¸€ä¸ªlogback.xmlï¼Œè¿™æ˜¯Logbackçš„é»˜è®¤æŸ¥æ‰¾çš„é…ç½®æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \"STDOUT\" class=\"ch.qos.logback.core.ConsoleAppender\"\u003e ",
  "wordCount" : "34103",
  "inLanguage": "en",
  "datePublished": "2020-01-04T18:56:17Z",
  "dateModified": "2020-01-04T18:56:17Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://009965.xyz/posts/spring/4spring%E5%BC%80%E5%8F%91web%E5%BA%94%E7%94%A8/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://009965.xyz/favicon.ico"
    }
  }
}
</script>

  <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.min.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath:  [['\\(', '\\)'], ['$', '$']],  
    }
  };
</script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;Â»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      4ã€Springå¼€å‘webåº”ç”¨
    </h1>
    <div class="post-meta"><span title='2020-01-04 18:56:17 +0000 UTC'>2020-01-04</span>&nbsp;Â·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%bc%80%e5%8f%91web%e5%ba%94%e7%94%a8" aria-label="å¼€å‘Webåº”ç”¨">å¼€å‘Webåº”ç”¨</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8spring-mvc" aria-label="ä½¿ç”¨Spring MVC">ä½¿ç”¨Spring MVC</a><ul>
                        
                <li>
                    <a href="#%e9%85%8d%e7%bd%aespring-mvc" aria-label="é…ç½®Spring MVC">é…ç½®Spring MVC</a></li>
                <li>
                    <a href="#%e7%bc%96%e5%86%99controller" aria-label="ç¼–å†™Controller">ç¼–å†™Controller</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8rest" aria-label="ä½¿ç”¨REST">ä½¿ç”¨REST</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-1" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%9b%86%e6%88%90filter" aria-label="é›†æˆFilter">é›†æˆFilter</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8interceptor" aria-label="ä½¿ç”¨Interceptor">ä½¿ç”¨Interceptor</a><ul>
                        
                <li>
                    <a href="#%e5%a4%84%e7%90%86%e5%bc%82%e5%b8%b8" aria-label="å¤„ç†å¼‚å¸¸">å¤„ç†å¼‚å¸¸</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-2" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a4%84%e7%90%86cors" aria-label="å¤„ç†CORS">å¤„ç†CORS</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8crossorigin" aria-label="ä½¿ç”¨@CrossOrigin">ä½¿ç”¨@CrossOrigin</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8corsregistry" aria-label="ä½¿ç”¨CorsRegistry">ä½¿ç”¨CorsRegistry</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8corsfilter" aria-label="ä½¿ç”¨CorsFilter">ä½¿ç”¨CorsFilter</a></li>
                <li>
                    <a href="#%e6%b5%8b%e8%af%95" aria-label="æµ‹è¯•">æµ‹è¯•</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%9b%bd%e9%99%85%e5%8c%96" aria-label="å›½é™…åŒ–">å›½é™…åŒ–</a><ul>
                        
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96locale" aria-label="è·å–Locale">è·å–Locale</a></li>
                <li>
                    <a href="#%e6%8f%90%e5%8f%96%e8%b5%84%e6%ba%90%e6%96%87%e4%bb%b6" aria-label="æå–èµ„æºæ–‡ä»¶">æå–èµ„æºæ–‡ä»¶</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%bamessagesource" aria-label="åˆ›å»ºMessageSource">åˆ›å»ºMessageSource</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0%e5%a4%9a%e8%af%ad%e8%a8%80" aria-label="å®ç°å¤šè¯­è¨€">å®ç°å¤šè¯­è¨€</a></li>
                <li>
                    <a href="#%e5%88%87%e6%8d%a2locale" aria-label="åˆ‡æ¢Locale">åˆ‡æ¢Locale</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-3" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%bc%82%e6%ad%a5%e5%a4%84%e7%90%86" aria-label="å¼‚æ­¥å¤„ç†">å¼‚æ­¥å¤„ç†</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8filter" aria-label="ä½¿ç”¨Filter">ä½¿ç”¨Filter</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-4" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8websocket" aria-label="ä½¿ç”¨WebSocket">ä½¿ç”¨WebSocket</a><ul>
                        
                <li>
                    <a href="#%e5%a4%84%e7%90%86websocket%e8%bf%9e%e6%8e%a5" aria-label="å¤„ç†WebSocketè¿æ¥">å¤„ç†WebSocketè¿æ¥</a></li>
                <li>
                    <a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e5%bc%80%e5%8f%91" aria-label="å®¢æˆ·ç«¯å¼€å‘">å®¢æˆ·ç«¯å¼€å‘</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93-5" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%9b%86%e6%88%90javamail" aria-label="é›†æˆJavaMail">é›†æˆJavaMail</a></li>
                <li>
                    <a href="#%e9%9b%86%e6%88%90jms" aria-label="é›†æˆJMS">é›†æˆJMS</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8scheduler" aria-label="ä½¿ç”¨Scheduler">ä½¿ç”¨Scheduler</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8cron%e4%bb%bb%e5%8a%a1" aria-label="ä½¿ç”¨Cronä»»åŠ¡">ä½¿ç”¨Cronä»»åŠ¡</a></li>
                <li>
                    <a href="#%e9%9b%86%e6%88%90quartz" aria-label="é›†æˆQuartz">é›†æˆQuartz</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e9%9b%86%e6%88%90jmx" aria-label="é›†æˆJMX">é›†æˆJMX</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="å¼€å‘webåº”ç”¨">å¼€å‘Webåº”ç”¨<a hidden class="anchor" aria-hidden="true" href="#å¼€å‘webåº”ç”¨">#</a></h1>
<p>åœ¨<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1255945497738400">Webå¼€å‘</a>ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†ä»‹ç»äº†JavaEEä¸­Webå¼€å‘çš„åŸºç¡€ï¼šServletã€‚å…·ä½“åœ°è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>Servletè§„èŒƒå®šä¹‰äº†å‡ ç§æ ‡å‡†ç»„ä»¶ï¼šServletã€JSPã€Filterå’ŒListenerï¼›</li>
<li>Servletçš„æ ‡å‡†ç»„ä»¶æ€»æ˜¯è¿è¡Œåœ¨Servletå®¹å™¨ä¸­ï¼Œå¦‚Tomcatã€Jettyã€WebLogicç­‰ã€‚</li>
</ol>
<p>ç›´æ¥ä½¿ç”¨Servletè¿›è¡ŒWebå¼€å‘å¥½æ¯”ç›´æ¥åœ¨JDBCä¸Šæ“ä½œæ•°æ®åº“ï¼Œæ¯”è¾ƒç¹çï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨ServletåŸºç¡€ä¸Šå°è£…MVCæ¡†æ¶ï¼ŒåŸºäºMVCå¼€å‘Webåº”ç”¨ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ï¼Œä¸éœ€è¦æ¥è§¦Servlet APIï¼Œå¼€å‘çœæ—¶çœåŠ›ã€‚</p>
<p>æˆ‘ä»¬åœ¨<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1266264917931808">MVCå¼€å‘</a>å’Œ<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1337408645759009">MVCé«˜çº§å¼€å‘</a>å·²ç»ç”±æµ…å…¥æ·±åœ°ä»‹ç»äº†å¦‚ä½•ç¼–å†™MVCæ¡†æ¶ã€‚å½“ç„¶ï¼Œè‡ªå·±å†™çš„MVCä¸»è¦æ˜¯ç†è§£åŸç†ï¼Œè¦å®ç°ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„MVCéœ€è¦å¤§é‡çš„å·¥ä½œä»¥åŠå¹¿æ³›çš„æµ‹è¯•ã€‚</p>
<p>å› æ­¤ï¼Œå¼€å‘Webåº”ç”¨ï¼Œé¦–å…ˆè¦é€‰æ‹©ä¸€ä¸ªä¼˜ç§€çš„MVCæ¡†æ¶ã€‚å¸¸ç”¨çš„MVCæ¡†æ¶æœ‰ï¼š</p>
<ul>
<li><a href="https://struts.apache.org/">Struts</a>ï¼šæœ€å¤è€çš„ä¸€ä¸ªMVCæ¡†æ¶ï¼Œç›®å‰ç‰ˆæœ¬æ˜¯2ï¼Œå’Œ1.xæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼›</li>
<li>WebWorkï¼šä¸€ä¸ªæ¯”Strutsè®¾è®¡æ›´ä¼˜ç§€çš„MVCæ¡†æ¶ï¼Œä½†ä¸çŸ¥é“å‡ºäºä»€ä¹ˆåŸå› ï¼Œä»2.0å¼€å§‹æŠŠè‡ªå·±çš„ä»£ç å…¨éƒ¨å¡ç»™Struts 2äº†ï¼›</li>
<li><a href="https://turbine.apache.org/">Turbine</a>ï¼šä¸€ä¸ªé‡åº¦ä½¿ç”¨Velocityï¼Œå¼ºè°ƒå¸ƒå±€çš„MVCæ¡†æ¶ï¼›</li>
<li>å…¶ä»–100+MVCæ¡†æ¶â€¦â€¦ï¼ˆç•¥ï¼‰</li>
</ul>
<p>Springè™½ç„¶éƒ½å¯ä»¥é›†æˆä»»ä½•Webæ¡†æ¶ï¼Œä½†æ˜¯ï¼ŒSpringæœ¬èº«ä¹Ÿå¼€å‘äº†ä¸€ä¸ªMVCæ¡†æ¶ï¼Œå°±å«<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">Spring MVC</a>ã€‚è¿™ä¸ªMVCæ¡†æ¶è®¾è®¡å¾—è¶³å¤Ÿä¼˜ç§€ä»¥è‡³äºæˆ‘ä»¬å·²ç»ä¸æƒ³å†è´¹åŠ²å»é›†æˆç±»ä¼¼Strutsè¿™æ ·çš„æ¡†æ¶äº†ã€‚</p>
<p>æœ¬ç« æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»å¦‚ä½•åŸºäºSpring MVCå¼€å‘Webåº”ç”¨ã€‚</p>
<h1 id="ä½¿ç”¨spring-mvc">ä½¿ç”¨Spring MVC<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨spring-mvc">#</a></h1>
<p>æˆ‘ä»¬åœ¨å‰é¢ä»‹ç»<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1255945497738400">Webå¼€å‘</a>æ—¶å·²ç»è®²è¿‡äº†Java Webçš„åŸºç¡€ï¼šServletå®¹å™¨ï¼Œä»¥åŠæ ‡å‡†çš„Servletç»„ä»¶ï¼š</p>
<ul>
<li>Servletï¼šèƒ½å¤„ç†HTTPè¯·æ±‚å¹¶å°†HTTPå“åº”è¿”å›ï¼›</li>
<li>JSPï¼šä¸€ç§åµŒå¥—Javaä»£ç çš„HTMLï¼Œå°†è¢«ç¼–è¯‘ä¸ºServletï¼›</li>
<li>Filterï¼šèƒ½è¿‡æ»¤æŒ‡å®šçš„URLä»¥å®ç°æ‹¦æˆªåŠŸèƒ½ï¼›</li>
<li>Listenerï¼šç›‘å¬æŒ‡å®šçš„äº‹ä»¶ï¼Œå¦‚ServletContextã€HttpSessionçš„åˆ›å»ºå’Œé”€æ¯ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼ŒServletå®¹å™¨ä¸ºæ¯ä¸ªWebåº”ç”¨ç¨‹åºè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„<code>ServletContext</code>å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å°±ä»£è¡¨äº†Webåº”ç”¨ç¨‹åºæœ¬èº«ã€‚</p>
<p>åœ¨<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1337408645759009">MVCé«˜çº§å¼€å‘</a>ä¸­ï¼Œæˆ‘ä»¬æ‰‹æ’¸äº†ä¸€ä¸ªMVCæ¡†æ¶ï¼Œæ¥å£å’ŒSpring MVCç±»ä¼¼ã€‚å¦‚æœç›´æ¥ä½¿ç”¨Spring MVCï¼Œæˆ‘ä»¬å†™å‡ºæ¥çš„ä»£ç ç±»ä¼¼ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserController {
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/register&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView register() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PostMapping(<span style="color:#0ff;font-weight:bold">&#34;/signin&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView signin(@RequestParam(<span style="color:#0ff;font-weight:bold">&#34;email&#34;</span>) String email, @RequestParam(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>) String password) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯ï¼ŒSpringæä¾›çš„æ˜¯ä¸€ä¸ªIoCå®¹å™¨ï¼Œæ‰€æœ‰çš„Beanï¼ŒåŒ…æ‹¬Controllerï¼Œéƒ½åœ¨Spring IoCå®¹å™¨ä¸­è¢«åˆå§‹åŒ–ï¼Œè€ŒServletå®¹å™¨ç”±JavaEEæœåŠ¡å™¨æä¾›ï¼ˆå¦‚Tomcatï¼‰ï¼ŒServletå®¹å™¨å¯¹Springä¸€æ— æ‰€çŸ¥ï¼Œä»–ä»¬ä¹‹é—´åˆ°åº•ä¾é ä»€ä¹ˆè¿›è¡Œè”ç³»ï¼Œåˆæ˜¯ä»¥ä½•ç§é¡ºåºåˆå§‹åŒ–çš„ï¼Ÿ</p>
<p>åœ¨ç†è§£ä¸Šè¿°é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæŠŠåŸºäºSpring MVCå¼€å‘çš„é¡¹ç›®ç»“æ„æ­å»ºèµ·æ¥ã€‚é¦–å…ˆåˆ›å»ºåŸºäºWebçš„Mavenå·¥ç¨‹ï¼Œå¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š</p>
<ul>
<li>org.springframework:spring-context:5.2.0.RELEASE</li>
<li>org.springframework:spring-webmvc:5.2.0.RELEASE</li>
<li>org.springframework:spring-jdbc:5.2.0.RELEASE</li>
<li>javax.annotation:javax.annotation-api:1.3.2</li>
<li>io.pebbletemplates:pebble-spring5:3.1.2</li>
<li>ch.qos.logback:logback-core:1.2.3</li>
<li>ch.qos.logback:logback-classic:1.2.3</li>
<li>com.zaxxer:HikariCP:3.4.2</li>
<li>org.hsqldb:hsqldb:2.5.0</li>
</ul>
<p>ä»¥åŠ<code>provided</code>ä¾èµ–ï¼š</p>
<ul>
<li>org.apache.tomcat.embed:tomcat-embed-core:9.0.26</li>
<li>org.apache.tomcat.embed:tomcat-embed-jasper:9.0.26</li>
</ul>
<p>è¿™ä¸ªæ ‡å‡†çš„Maven Webå·¥ç¨‹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>spring-web-mvc
</span></span><span style="display:flex;"><span>â”œâ”€â”€ pom.xml
</span></span><span style="display:flex;"><span>â””â”€â”€ src
</span></span><span style="display:flex;"><span>    â””â”€â”€ main
</span></span><span style="display:flex;"><span>        â”œâ”€â”€ java
</span></span><span style="display:flex;"><span>        â”‚   â””â”€â”€ com
</span></span><span style="display:flex;"><span>        â”‚       â””â”€â”€ itranswarp
</span></span><span style="display:flex;"><span>        â”‚           â””â”€â”€ learnjava
</span></span><span style="display:flex;"><span>        â”‚               â”œâ”€â”€ AppConfig.java
</span></span><span style="display:flex;"><span>        â”‚               â”œâ”€â”€ DatabaseInitializer.java
</span></span><span style="display:flex;"><span>        â”‚               â”œâ”€â”€ entity
</span></span><span style="display:flex;"><span>        â”‚               â”‚   â””â”€â”€ User.java
</span></span><span style="display:flex;"><span>        â”‚               â”œâ”€â”€ service
</span></span><span style="display:flex;"><span>        â”‚               â”‚   â””â”€â”€ UserService.java
</span></span><span style="display:flex;"><span>        â”‚               â””â”€â”€ web
</span></span><span style="display:flex;"><span>        â”‚                   â””â”€â”€ UserController.java
</span></span><span style="display:flex;"><span>        â”œâ”€â”€ resources
</span></span><span style="display:flex;"><span>        â”‚   â”œâ”€â”€ jdbc.properties
</span></span><span style="display:flex;"><span>        â”‚   â””â”€â”€ logback.xml
</span></span><span style="display:flex;"><span>        â””â”€â”€ webapp
</span></span><span style="display:flex;"><span>            â”œâ”€â”€ WEB-INF
</span></span><span style="display:flex;"><span>            â”‚   â”œâ”€â”€ templates
</span></span><span style="display:flex;"><span>            â”‚   â”‚   â”œâ”€â”€ _base.html
</span></span><span style="display:flex;"><span>            â”‚   â”‚   â”œâ”€â”€ index.html
</span></span><span style="display:flex;"><span>            â”‚   â”‚   â”œâ”€â”€ profile.html
</span></span><span style="display:flex;"><span>            â”‚   â”‚   â”œâ”€â”€ register.html
</span></span><span style="display:flex;"><span>            â”‚   â”‚   â””â”€â”€ signin.html
</span></span><span style="display:flex;"><span>            â”‚   â””â”€â”€ web.xml
</span></span><span style="display:flex;"><span>            â””â”€â”€ static
</span></span><span style="display:flex;"><span>                â”œâ”€â”€ css
</span></span><span style="display:flex;"><span>                â”‚   â””â”€â”€ bootstrap.css
</span></span><span style="display:flex;"><span>                â””â”€â”€ js
</span></span><span style="display:flex;"><span>                    â””â”€â”€ jquery.js
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œ<code>src/main/webapp</code>æ˜¯æ ‡å‡†webç›®å½•ï¼Œ<code>WEB-INF</code>å­˜æ”¾<code>web.xml</code>ï¼Œç¼–è¯‘çš„classï¼Œç¬¬ä¸‰æ–¹jarï¼Œä»¥åŠä¸å…è®¸æµè§ˆå™¨ç›´æ¥è®¿é—®çš„Viewæ¨¡ç‰ˆï¼Œ<code>static</code>ç›®å½•å­˜æ”¾æ‰€æœ‰é™æ€æ–‡ä»¶ã€‚</p>
<p>åœ¨<code>src/main/resources</code>ç›®å½•ä¸­å­˜æ”¾çš„æ˜¯Javaç¨‹åºè¯»å–çš„classpathèµ„æºæ–‡ä»¶ï¼Œé™¤äº†JDBCçš„é…ç½®æ–‡ä»¶<code>jdbc.properties</code>å¤–ï¼Œæˆ‘ä»¬åˆæ–°å¢äº†ä¸€ä¸ª<code>logback.xml</code>ï¼Œè¿™æ˜¯Logbackçš„é»˜è®¤æŸ¥æ‰¾çš„é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>&lt;?xml version=<span style="color:#0ff;font-weight:bold">&#34;1.0&#34;</span> encoding=<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span>&lt;configuration&gt;
</span></span><span style="display:flex;"><span>	&lt;appender name=<span style="color:#0ff;font-weight:bold">&#34;STDOUT&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">class</span><span style="color:#f00">=&#34;</span>ch.<span style="color:#007f7f">qos</span>.<span style="color:#007f7f">logback</span>.<span style="color:#007f7f">core</span>.<span style="color:#007f7f">ConsoleAppender</span><span style="color:#0ff;font-weight:bold">&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">		&lt;layout class=&#34;</span>ch.<span style="color:#007f7f">qos</span>.<span style="color:#007f7f">logback</span>.<span style="color:#007f7f">classic</span>.<span style="color:#007f7f">PatternLayout</span><span style="color:#0ff;font-weight:bold">&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">			&lt;Pattern&gt;%d{yyyy-MM-dd HH:mm:ss} %-5level %logger{36} - %msg%n&lt;/Pattern&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">		&lt;/layout&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">	&lt;/appender&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">	&lt;logger name=&#34;</span>com.<span style="color:#007f7f">itranswarp</span>.<span style="color:#007f7f">learnjava</span><span style="color:#0ff;font-weight:bold">&#34; level=&#34;</span>info<span style="color:#0ff;font-weight:bold">&#34; additivity=&#34;</span><span style="color:#fff;font-weight:bold">false</span><span style="color:#0ff;font-weight:bold">&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">		&lt;appender-ref ref=&#34;</span>STDOUT<span style="color:#0ff;font-weight:bold">&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">	&lt;/logger&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">	&lt;root level=&#34;</span>info<span style="color:#0ff;font-weight:bold">&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">		&lt;appender-ref ref=&#34;</span>STDOUT<span style="color:#0ff;font-weight:bold">&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">	&lt;/root&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&lt;/configuration&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢ç»™å‡ºäº†ä¸€ä¸ªå†™å…¥åˆ°æ ‡å‡†è¾“å‡ºçš„Logbacké…ç½®ï¼Œå¯ä»¥åŸºäºä¸Šè¿°é…ç½®æ·»åŠ å†™å…¥åˆ°æ–‡ä»¶çš„é…ç½®ã€‚</p>
<p>åœ¨<code>src/main/java</code>ä¸­å°±æ˜¯æˆ‘ä»¬ç¼–å†™çš„Javaä»£ç äº†ã€‚</p>
<h2 id="é…ç½®spring-mvc">é…ç½®Spring MVC<a hidden class="anchor" aria-hidden="true" href="#é…ç½®spring-mvc">#</a></h2>
<p>å’Œæ™®é€šSpringé…ç½®ä¸€æ ·ï¼Œæˆ‘ä»¬ç¼–å†™æ­£å¸¸çš„<code>AppConfig</code>åï¼Œåªéœ€åŠ ä¸Š<code>@EnableWebMvc</code>æ³¨è§£ï¼Œå°±â€œæ¿€æ´»â€äº†Spring MVCï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableWebMvc <span style="color:#007f7f">// å¯ç”¨Spring MVC</span>
</span></span><span style="display:flex;"><span>@EnableTransactionManagement
</span></span><span style="display:flex;"><span>@PropertySource(<span style="color:#0ff;font-weight:bold">&#34;classpath:/jdbc.properties&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†åˆ›å»º<code>DataSource</code>ã€<code>JdbcTemplate</code>ã€<code>PlatformTransactionManager</code>å¤–ï¼Œ<code>AppConfig</code>éœ€è¦é¢å¤–åˆ›å»ºå‡ ä¸ªç”¨äºSpring MVCçš„Beanï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>WebMvcConfigurer createWebMvcConfigurer() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> WebMvcConfigurer() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
</span></span><span style="display:flex;"><span>            registry.<span style="color:#007f7f">addResourceHandler</span>(<span style="color:#0ff;font-weight:bold">&#34;/static/**&#34;</span>).<span style="color:#007f7f">addResourceLocations</span>(<span style="color:#0ff;font-weight:bold">&#34;/static/&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>WebMvcConfigurer</code>å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æˆ‘ä»¬åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„<code>WebMvcConfigurer</code>ï¼Œåªè¦†å†™<code>addResourceHandlers()</code>ï¼Œç›®çš„æ˜¯è®©Spring MVCè‡ªåŠ¨å¤„ç†é™æ€æ–‡ä»¶ï¼Œå¹¶ä¸”æ˜ å°„è·¯å¾„ä¸º<code>/static/**</code>ã€‚</p>
<p>å¦ä¸€ä¸ªå¿…é¡»è¦åˆ›å»ºçš„Beanæ˜¯<code>ViewResolver</code>ï¼Œå› ä¸ºSpring MVCå…è®¸é›†æˆä»»ä½•æ¨¡æ¿å¼•æ“ï¼Œä½¿ç”¨å“ªä¸ªæ¨¡æ¿å¼•æ“ï¼Œå°±å®ä¾‹åŒ–ä¸€ä¸ªå¯¹åº”çš„<code>ViewResolver</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>ViewResolver createViewResolver(@Autowired ServletContext servletContext) {
</span></span><span style="display:flex;"><span>    PebbleEngine engine = <span style="color:#fff;font-weight:bold">new</span> PebbleEngine.<span style="color:#007f7f">Builder</span>().<span style="color:#007f7f">autoEscaping</span>(<span style="color:#fff;font-weight:bold">true</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">cacheActive</span>(<span style="color:#fff;font-weight:bold">false</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">loader</span>(<span style="color:#fff;font-weight:bold">new</span> ServletLoader(servletContext))
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">extension</span>(<span style="color:#fff;font-weight:bold">new</span> SpringExtension())
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>    PebbleViewResolver viewResolver = <span style="color:#fff;font-weight:bold">new</span> PebbleViewResolver();
</span></span><span style="display:flex;"><span>    viewResolver.<span style="color:#007f7f">setPrefix</span>(<span style="color:#0ff;font-weight:bold">&#34;/WEB-INF/templates/&#34;</span>);
</span></span><span style="display:flex;"><span>    viewResolver.<span style="color:#007f7f">setSuffix</span>(<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>    viewResolver.<span style="color:#007f7f">setPebbleEngine</span>(engine);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> viewResolver;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ViewResolver</code>é€šè¿‡æŒ‡å®šprefixå’Œsuffixæ¥ç¡®å®šå¦‚ä½•æŸ¥æ‰¾Viewã€‚ä¸Šè¿°é…ç½®ä½¿ç”¨Pebbleå¼•æ“ï¼ŒæŒ‡å®šæ¨¡æ¿æ–‡ä»¶å­˜æ”¾åœ¨<code>/WEB-INF/templates/</code>ç›®å½•ä¸‹ã€‚</p>
<p>å‰©ä¸‹çš„Beanéƒ½æ˜¯æ™®é€šçš„<code>@Component</code>ï¼Œä½†Controllerå¿…é¡»æ ‡è®°ä¸º<code>@Controller</code>ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// Controllerä½¿ç”¨@Controlleræ ‡è®°è€Œä¸æ˜¯@Component:</span>
</span></span><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserController {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ­£å¸¸ä½¿ç”¨@Autowiredæ³¨å…¥:</span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¤„ç†ä¸€ä¸ªURLæ˜ å°„:</span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView index() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ˜¯æ™®é€šçš„Javaåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬é€šè¿‡<code>main()</code>æ–¹æ³•å¯ä»¥å¾ˆç®€å•åœ°åˆ›å»ºä¸€ä¸ªSpringå®¹å™¨çš„å®ä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>    ApplicationContext context = <span style="color:#fff;font-weight:bold">new</span> AnnotationConfigApplicationContext(AppConfig.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œç°åœ¨æ˜¯Webåº”ç”¨ç¨‹åºï¼Œè€ŒWebåº”ç”¨ç¨‹åºæ€»æ˜¯ç”±Servletå®¹å™¨åˆ›å»ºï¼Œé‚£ä¹ˆï¼ŒSpringå®¹å™¨åº”è¯¥ç”±è°åˆ›å»ºï¼Ÿåœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼ŸSpringå®¹å™¨ä¸­çš„Controlleråˆæ˜¯å¦‚ä½•é€šè¿‡Servletè°ƒç”¨çš„ï¼Ÿ</p>
<p>åœ¨Webåº”ç”¨ä¸­å¯åŠ¨Springå®¹å™¨æœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡Listenerå¯åŠ¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Servletå¯åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨XMLé…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£é…ç½®ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬åªä»‹ç»ä¸€ç§<em>æœ€ç®€å•</em>çš„å¯åŠ¨Springå®¹å™¨çš„æ–¹å¼ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨<code>web.xml</code>ä¸­é…ç½®Spring MVCæä¾›çš„<code>DispatcherServlet</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>&lt;!DOCTYPE web-app PUBLIC
</span></span><span style="display:flex;"><span> <span style="color:#0ff;font-weight:bold">&#34;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#0ff;font-weight:bold">&#34;http://java.sun.com/dtd/web-app_2_3.dtd&#34;</span> &gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;web-app&gt;
</span></span><span style="display:flex;"><span>    &lt;servlet&gt;
</span></span><span style="display:flex;"><span>        &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
</span></span><span style="display:flex;"><span>        &lt;servlet-<span style="color:#fff;font-weight:bold">class</span><span style="color:#f00">&gt;</span>org.<span style="color:#007f7f">springframework</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">servlet</span>.<span style="color:#007f7f">DispatcherServlet</span>&lt;/servlet-<span style="color:#fff;font-weight:bold">class</span><span style="color:#f00">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f00">&lt;</span>init-param&gt;
</span></span><span style="display:flex;"><span>            &lt;param-name&gt;contextClass&lt;/param-name&gt;
</span></span><span style="display:flex;"><span>            &lt;param-value&gt;org.<span style="color:#007f7f">springframework</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">context</span>.<span style="color:#007f7f">support</span>.<span style="color:#007f7f">AnnotationConfigWebApplicationContext</span>&lt;/param-value&gt;
</span></span><span style="display:flex;"><span>        &lt;/init-param&gt;
</span></span><span style="display:flex;"><span>        &lt;init-param&gt;
</span></span><span style="display:flex;"><span>            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
</span></span><span style="display:flex;"><span>            &lt;param-value&gt;com.<span style="color:#007f7f">itranswarp</span>.<span style="color:#007f7f">learnjava</span>.<span style="color:#007f7f">AppConfig</span>&lt;/param-value&gt;
</span></span><span style="display:flex;"><span>        &lt;/init-param&gt;
</span></span><span style="display:flex;"><span>        &lt;load-on-startup&gt;0&lt;/load-on-startup&gt;
</span></span><span style="display:flex;"><span>    &lt;/servlet&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;servlet-mapping&gt;
</span></span><span style="display:flex;"><span>        &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
</span></span><span style="display:flex;"><span>        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</span></span><span style="display:flex;"><span>    &lt;/servlet-mapping&gt;
</span></span><span style="display:flex;"><span>&lt;/web-app&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆå§‹åŒ–å‚æ•°<code>contextClass</code>æŒ‡å®šä½¿ç”¨æ³¨è§£é…ç½®çš„<code>AnnotationConfigWebApplicationContext</code>ï¼Œé…ç½®æ–‡ä»¶çš„ä½ç½®å‚æ•°<code>contextConfigLocation</code>æŒ‡å‘<code>AppConfig</code>çš„å®Œæ•´ç±»åï¼Œæœ€åï¼ŒæŠŠè¿™ä¸ªServletæ˜ å°„åˆ°<code>/*</code>ï¼Œå³å¤„ç†æ‰€æœ‰URLã€‚</p>
<p>ä¸Šè¿°é…ç½®å¯ä»¥çœ‹ä½œä¸€ä¸ªæ ·æ¿é…ç½®ï¼Œæœ‰äº†è¿™ä¸ªé…ç½®ï¼ŒServletå®¹å™¨ä¼šé¦–å…ˆåˆå§‹åŒ–Spring MVCçš„<code>DispatcherServlet</code>ï¼Œåœ¨<code>DispatcherServlet</code>å¯åŠ¨æ—¶ï¼Œå®ƒæ ¹æ®é…ç½®<code>AppConfig</code>åˆ›å»ºäº†ä¸€ä¸ªç±»å‹æ˜¯WebApplicationContextçš„IoCå®¹å™¨ï¼Œå®Œæˆæ‰€æœ‰Beançš„åˆå§‹åŒ–ï¼Œå¹¶å°†å®¹å™¨ç»‘åˆ°ServletContextä¸Šã€‚</p>
<p>å› ä¸º<code>DispatcherServlet</code>æŒæœ‰IoCå®¹å™¨ï¼Œèƒ½ä»IoCå®¹å™¨ä¸­è·å–æ‰€æœ‰<code>@Controller</code>çš„Beanï¼Œå› æ­¤ï¼Œ<code>DispatcherServlet</code>æ¥æ”¶åˆ°æ‰€æœ‰HTTPè¯·æ±‚åï¼Œæ ¹æ®Controlleræ–¹æ³•é…ç½®çš„è·¯å¾„ï¼Œå°±å¯ä»¥æ­£ç¡®åœ°æŠŠè¯·æ±‚è½¬å‘åˆ°æŒ‡å®šæ–¹æ³•ï¼Œå¹¶æ ¹æ®è¿”å›çš„<code>ModelAndView</code>å†³å®šå¦‚ä½•æ¸²æŸ“é¡µé¢ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬åœ¨<code>AppConfig</code>ä¸­é€šè¿‡<code>main()</code>æ–¹æ³•å¯åŠ¨åµŒå…¥å¼Tomcatï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    Tomcat tomcat = <span style="color:#fff;font-weight:bold">new</span> Tomcat();
</span></span><span style="display:flex;"><span>    tomcat.<span style="color:#007f7f">setPort</span>(Integer.<span style="color:#007f7f">getInteger</span>(<span style="color:#0ff;font-weight:bold">&#34;port&#34;</span>, 8080));
</span></span><span style="display:flex;"><span>    tomcat.<span style="color:#007f7f">getConnector</span>();
</span></span><span style="display:flex;"><span>    Context ctx = tomcat.<span style="color:#007f7f">addWebapp</span>(<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;src/main/webapp&#34;</span>).<span style="color:#007f7f">getAbsolutePath</span>());
</span></span><span style="display:flex;"><span>    WebResourceRoot resources = <span style="color:#fff;font-weight:bold">new</span> StandardRoot(ctx);
</span></span><span style="display:flex;"><span>    resources.<span style="color:#007f7f">addPreResources</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">new</span> DirResourceSet(resources, <span style="color:#0ff;font-weight:bold">&#34;/WEB-INF/classes&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;target/classes&#34;</span>).<span style="color:#007f7f">getAbsolutePath</span>(), <span style="color:#0ff;font-weight:bold">&#34;/&#34;</span>));
</span></span><span style="display:flex;"><span>    ctx.<span style="color:#007f7f">setResources</span>(resources);
</span></span><span style="display:flex;"><span>    tomcat.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>    tomcat.<span style="color:#007f7f">getServer</span>().<span style="color:#007f7f">await</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°Webåº”ç”¨ç¨‹åºå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨Spring MVCæ—¶çš„ä¸€ä¸ªæœ€å°å¯åŠ¨åŠŸèƒ½é›†ã€‚ç”±äºä½¿ç”¨äº†JDBCå’Œæ•°æ®åº“ï¼Œç”¨æˆ·çš„æ³¨å†Œã€ç™»å½•ä¿¡æ¯ä¼šè¢«æŒä¹…åŒ–ã€‚</p>
<h2 id="ç¼–å†™controller">ç¼–å†™Controller<a hidden class="anchor" aria-hidden="true" href="#ç¼–å†™controller">#</a></h2>
<p>æœ‰äº†Webåº”ç”¨ç¨‹åºçš„æœ€åŸºæœ¬çš„ç»“æ„ï¼Œæˆ‘ä»¬çš„é‡ç‚¹å°±å¯ä»¥æ”¾åœ¨å¦‚ä½•ç¼–å†™Controllerä¸Šã€‚Spring MVCå¯¹Controlleræ²¡æœ‰å›ºå®šçš„è¦æ±‚ï¼Œä¹Ÿä¸éœ€è¦å®ç°ç‰¹å®šçš„æ¥å£ã€‚ä»¥UserControllerä¸ºä¾‹ï¼Œç¼–å†™Controlleråªéœ€è¦éµå¾ªä»¥ä¸‹è¦ç‚¹ï¼š</p>
<p>æ€»æ˜¯æ ‡è®°<code>@Controller</code>è€Œä¸æ˜¯<code>@Component</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserController {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªHTTPè¯·æ±‚è·¯å¾„ï¼Œç”¨<code>@GetMapping</code>æˆ–<code>@PostMapping</code>è¡¨ç¤ºGETæˆ–POSTè¯·æ±‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@PostMapping(<span style="color:#0ff;font-weight:bold">&#34;/signin&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ModelAndView doSignin(
</span></span><span style="display:flex;"><span>        @RequestParam(<span style="color:#0ff;font-weight:bold">&#34;email&#34;</span>) String email,
</span></span><span style="display:flex;"><span>        @RequestParam(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>) String password,
</span></span><span style="display:flex;"><span>        HttpSession session) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦æ¥æ”¶çš„HTTPå‚æ•°ä»¥<code>@RequestParam()</code>æ ‡æ³¨ï¼Œå¯ä»¥è®¾ç½®é»˜è®¤å€¼ã€‚å¦‚æœæ–¹æ³•å‚æ•°éœ€è¦ä¼ å…¥<code>HttpServletRequest</code>ã€<code>HttpServletResponse</code>æˆ–è€…<code>HttpSession</code>ï¼Œç›´æ¥æ·»åŠ è¿™ä¸ªç±»å‹çš„å‚æ•°å³å¯ï¼ŒSpring MVCä¼šè‡ªåŠ¨æŒ‰ç±»å‹ä¼ å…¥ã€‚</p>
<p>è¿”å›çš„ModelAndViewé€šå¸¸åŒ…å«Viewçš„è·¯å¾„å’Œä¸€ä¸ªMapä½œä¸ºModelï¼Œä½†ä¹Ÿå¯ä»¥æ²¡æœ‰Modelï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ModelAndView(<span style="color:#0ff;font-weight:bold">&#34;signin.html&#34;</span>); <span style="color:#007f7f">// ä»…Viewï¼Œæ²¡æœ‰Model</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿”å›é‡å®šå‘æ—¶æ—¢å¯ä»¥å†™<code>new ModelAndView(&quot;redirect:/signin&quot;)</code>ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿”å›Stringï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> String index() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (...) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;redirect:/signin&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;redirect:/profile&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœåœ¨æ–¹æ³•å†…éƒ¨ç›´æ¥æ“ä½œ<code>HttpServletResponse</code>å‘é€å“åº”ï¼Œè¿”å›<code>null</code>è¡¨ç¤ºæ— éœ€è¿›ä¸€æ­¥å¤„ç†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ModelAndView download(HttpServletResponse response) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">byte</span>[] data = ...
</span></span><span style="display:flex;"><span>    response.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;application/octet-stream&#34;</span>);
</span></span><span style="display:flex;"><span>    OutputStream output = response.<span style="color:#007f7f">getOutputStream</span>();
</span></span><span style="display:flex;"><span>    output.<span style="color:#007f7f">write</span>(data);
</span></span><span style="display:flex;"><span>    output.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹URLè¿›è¡Œåˆ†ç»„ï¼Œæ¯ç»„å¯¹åº”ä¸€ä¸ªControlleræ˜¯ä¸€ç§å¾ˆå¥½çš„ç»„ç»‡å½¢å¼ï¼Œå¹¶å¯ä»¥åœ¨Controllerçš„classå®šä¹‰å‡ºæ·»åŠ URLå‰ç¼€ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span>@RequestMapping(<span style="color:#0ff;font-weight:bold">&#34;/user&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserController {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ³¨æ„å®é™…URLæ˜ å°„æ˜¯/user/profile</span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/profile&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView profile() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ³¨æ„å®é™…URLæ˜ å°„æ˜¯/user/changePassword</span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/changePassword&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView changePassword() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…æ–¹æ³•çš„URLæ˜ å°„æ€»æ˜¯å‰ç¼€+è·¯å¾„ï¼Œè¿™ç§å½¢å¼è¿˜å¯ä»¥æœ‰æ•ˆé¿å…ä¸å°å¿ƒå¯¼è‡´çš„é‡å¤çš„URLæ˜ å°„ã€‚</p>
<p>å¯è§ï¼ŒSpring MVCå…è®¸æˆ‘ä»¬ç¼–å†™æ—¢ç®€å•åˆçµæ´»çš„Controllerå®ç°ã€‚</p>
<h2 id="å°ç»“">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“">#</a></h2>
<p>ä½¿ç”¨Spring MVCæ—¶ï¼Œæ•´ä¸ªWebåº”ç”¨ç¨‹åºæŒ‰å¦‚ä¸‹é¡ºåºå¯åŠ¨ï¼š</p>
<ol>
<li>å¯åŠ¨TomcatæœåŠ¡å™¨ï¼›</li>
<li>Tomcatè¯»å–web.xmlå¹¶åˆå§‹åŒ–DispatcherServletï¼›</li>
<li>DispatcherServletåˆ›å»ºIoCå®¹å™¨å¹¶è‡ªåŠ¨æ³¨å†Œåˆ°ServletContextä¸­ã€‚</li>
</ol>
<p>å¯åŠ¨åï¼Œæµè§ˆå™¨å‘å‡ºçš„HTTPè¯·æ±‚å…¨éƒ¨ç”±DispatcherServletæ¥æ”¶ï¼Œå¹¶æ ¹æ®é…ç½®è½¬å‘åˆ°æŒ‡å®šControllerçš„æŒ‡å®šæ–¹æ³•å¤„ç†ã€‚</p>
<h1 id="ä½¿ç”¨rest">ä½¿ç”¨REST<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨rest">#</a></h1>
<p>ä½¿ç”¨Spring MVCå¼€å‘Webåº”ç”¨ç¨‹åºçš„ä¸»è¦å·¥ä½œå°±æ˜¯ç¼–å†™Controlleré€»è¾‘ã€‚åœ¨Webåº”ç”¨ä¸­ï¼Œé™¤äº†éœ€è¦ä½¿ç”¨MVCç»™ç”¨æˆ·æ˜¾ç¤ºé¡µé¢å¤–ï¼Œè¿˜æœ‰ä¸€ç±»APIæ¥å£ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºRESTï¼Œé€šå¸¸è¾“å…¥è¾“å‡ºéƒ½æ˜¯JSONï¼Œä¾¿äºç¬¬ä¸‰æ–¹è°ƒç”¨æˆ–è€…ä½¿ç”¨é¡µé¢JavaScriptä¸ä¹‹äº¤äº’ã€‚</p>
<p>ç›´æ¥åœ¨Controllerä¸­å¤„ç†JSONæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºSpring MVCçš„<code>@GetMapping</code>å’Œ<code>@PostMapping</code>éƒ½æ”¯æŒæŒ‡å®šè¾“å…¥å’Œè¾“å‡ºçš„æ ¼å¼ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ¥æ”¶JSONï¼Œè¾“å‡ºJSONï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å†™ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@PostMapping(value = <span style="color:#0ff;font-weight:bold">&#34;/rest&#34;</span>,
</span></span><span style="display:flex;"><span>             consumes = <span style="color:#0ff;font-weight:bold">&#34;application/json;charset=UTF-8&#34;</span>,
</span></span><span style="display:flex;"><span>             produces = <span style="color:#0ff;font-weight:bold">&#34;application/json;charset=UTF-8&#34;</span>)
</span></span><span style="display:flex;"><span>@ResponseBody
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> String rest(@RequestBody User user) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;{\&#34;restSupport\&#34;:true}&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹åº”çš„Mavenå·¥ç¨‹éœ€è¦åŠ å…¥Jacksonè¿™ä¸ªä¾èµ–ï¼š<code>com.fasterxml.jackson.core:jackson-databind:2.11.0</code></p>
<p>æ³¨æ„åˆ°<code>@PostMapping</code>ä½¿ç”¨<code>consumes</code>å£°æ˜èƒ½æ¥æ”¶çš„ç±»å‹ï¼Œä½¿ç”¨<code>produces</code>å£°æ˜è¾“å‡ºçš„ç±»å‹ï¼Œå¹¶ä¸”é¢å¤–åŠ äº†<code>@ResponseBody</code>è¡¨ç¤ºè¿”å›çš„<code>String</code>æ— éœ€é¢å¤–å¤„ç†ï¼Œç›´æ¥ä½œä¸ºè¾“å‡ºå†…å®¹å†™å…¥<code>HttpServletResponse</code>ã€‚è¾“å…¥çš„JSONåˆ™æ ¹æ®æ³¨è§£<code>@RequestBody</code>ç›´æ¥è¢«Springååºåˆ—åŒ–ä¸º<code>User</code>è¿™ä¸ªJavaBeanã€‚</p>
<p>ä½¿ç”¨curlå‘½ä»¤æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ curl -v -H &#34;Content-Type: application/json&#34; -d &#39;{&#34;email&#34;:&#34;bob@example.com&#34;}&#39; http://localhost:8080/rest      
</span></span><span style="display:flex;"><span>&gt; POST /rest HTTP/1.1
</span></span><span style="display:flex;"><span>&gt; Host: localhost:8080
</span></span><span style="display:flex;"><span>&gt; User-Agent: curl/7.64.1
</span></span><span style="display:flex;"><span>&gt; Accept: */*
</span></span><span style="display:flex;"><span>&gt; Content-Type: application/json
</span></span><span style="display:flex;"><span>&gt; Content-Length: 27
</span></span><span style="display:flex;"><span>&gt; 
</span></span><span style="display:flex;"><span>&lt; HTTP/1.1 200 
</span></span><span style="display:flex;"><span>&lt; Content-Type: application/json;charset=utf-8
</span></span><span style="display:flex;"><span>&lt; Content-Length: 20
</span></span><span style="display:flex;"><span>&lt; Date: Sun, 10 May 2020 09:56:01 GMT
</span></span><span style="display:flex;"><span>&lt; 
</span></span><span style="display:flex;"><span>{&#34;restSupport&#34;:true}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºæ­£æ˜¯æˆ‘ä»¬å†™å…¥çš„å­—ç¬¦ä¸²ã€‚</p>
<p>ç›´æ¥ç”¨Springçš„Controlleré…åˆä¸€å¤§å †æ³¨è§£å†™RESTå¤ªéº»çƒ¦äº†ï¼Œå› æ­¤ï¼ŒSpringè¿˜é¢å¤–æä¾›äº†ä¸€ä¸ª<code>@RestController</code>æ³¨è§£ï¼Œä½¿ç”¨<code>@RestController</code>æ›¿ä»£<code>@Controller</code>åï¼Œæ¯ä¸ªæ–¹æ³•è‡ªåŠ¨å˜æˆAPIæ¥å£æ–¹æ³•ã€‚æˆ‘ä»¬è¿˜æ˜¯ä»¥å®é™…ä»£ç ä¸¾ä¾‹ï¼Œç¼–å†™<code>ApiController</code>å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span>@RequestMapping(<span style="color:#0ff;font-weight:bold">&#34;/api&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ApiController {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/users&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> List&lt;User&gt; users() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> userService.<span style="color:#007f7f">getUsers</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/users/{id}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User user(@PathVariable(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>) <span style="color:#fff;font-weight:bold">long</span> id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> userService.<span style="color:#007f7f">getUserById</span>(id);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PostMapping(<span style="color:#0ff;font-weight:bold">&#34;/signin&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Map&lt;String, Object&gt; signin(@RequestBody SignInRequest signinRequest) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            User user = userService.<span style="color:#007f7f">signin</span>(signinRequest.<span style="color:#007f7f">email</span>, signinRequest.<span style="color:#007f7f">password</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> Map.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>, user);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> Map.<span style="color:#007f7f">of</span>(<span style="color:#0ff;font-weight:bold">&#34;error&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;SIGNIN_FAILED&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;message&#34;</span>, e.<span style="color:#007f7f">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> SignInRequest {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> String email;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> String password;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–å†™RESTæ¥å£åªéœ€è¦å®šä¹‰<code>@RestController</code>ï¼Œç„¶åï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªAPIæ¥å£ï¼Œè¾“å…¥å’Œè¾“å‡ºåªè¦èƒ½è¢«Jacksonåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ä¸ºJSONå°±æ²¡æœ‰é—®é¢˜ã€‚æˆ‘ä»¬ç”¨æµè§ˆå™¨æµ‹è¯•GETè¯·æ±‚ï¼Œå¯ç›´æ¥æ˜¾ç¤ºJSONå“åº”ã€‚</p>
<p>è¦æµ‹è¯•POSTè¯·æ±‚ï¼Œå¯ä»¥ç”¨curlå‘½ä»¤ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ curl -v -H &#34;Content-Type: application/json&#34; -d &#39;{&#34;email&#34;:&#34;bob@example.com&#34;,&#34;password&#34;:&#34;bob123&#34;}&#39; http://localhost:8080/api/signin
</span></span><span style="display:flex;"><span>&gt; POST /api/signin HTTP/1.1
</span></span><span style="display:flex;"><span>&gt; Host: localhost:8080
</span></span><span style="display:flex;"><span>&gt; User-Agent: curl/7.64.1
</span></span><span style="display:flex;"><span>&gt; Accept: */*
</span></span><span style="display:flex;"><span>&gt; Content-Type: application/json
</span></span><span style="display:flex;"><span>&gt; Content-Length: 47
</span></span><span style="display:flex;"><span>&gt; 
</span></span><span style="display:flex;"><span>&lt; HTTP/1.1 200 
</span></span><span style="display:flex;"><span>&lt; Content-Type: application/json
</span></span><span style="display:flex;"><span>&lt; Transfer-Encoding: chunked
</span></span><span style="display:flex;"><span>&lt; Date: Sun, 10 May 2020 08:14:13 GMT
</span></span><span style="display:flex;"><span>&lt; 
</span></span><span style="display:flex;"><span>{&#34;user&#34;:{&#34;id&#34;:1,&#34;email&#34;:&#34;bob@example.com&#34;,&#34;password&#34;:&#34;bob123&#34;,&#34;name&#34;:&#34;Bob&#34;,...
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„è§‚å¯Ÿä¸Šè¿°JSONçš„è¾“å‡ºï¼Œ<code>User</code>èƒ½è¢«æ­£ç¡®åœ°åºåˆ—åŒ–ä¸ºJSONï¼Œä½†æš´éœ²äº†<code>password</code>å±æ€§ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸æœŸæœ›çš„ã€‚è¦é¿å…è¾“å‡º<code>password</code>å±æ€§ï¼Œå¯ä»¥æŠŠ<code>User</code>å¤åˆ¶åˆ°å¦ä¸€ä¸ª<code>UserBean</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åªæŒæœ‰å¿…è¦çš„å±æ€§ï¼Œä½†è¿™æ ·åšæ¯”è¾ƒç¹çã€‚å¦ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥åœ¨<code>User</code>çš„<code>password</code>å±æ€§å®šä¹‰å¤„åŠ ä¸Š<code>@JsonIgnore</code>è¡¨ç¤ºå®Œå…¨å¿½ç•¥è¯¥å±æ€§ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @JsonIgnore
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getPassword() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> password;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœå†™ä¸€ä¸ª<code>register(User user)</code>æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•çš„Userå¯¹è±¡ä¹Ÿæ‹¿ä¸åˆ°æ³¨å†Œæ—¶ç”¨æˆ·ä¼ å…¥çš„å¯†ç äº†ã€‚å¦‚æœè¦å…è®¸è¾“å…¥<code>password</code>ï¼Œä½†ä¸å…è®¸è¾“å‡º<code>password</code>ï¼Œå³åœ¨JSONåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶ï¼Œå…è®¸å†™å±æ€§ï¼Œç¦ç”¨è¯»å±æ€§ï¼Œå¯ä»¥æ›´ç²¾ç»†åœ°æ§åˆ¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @JsonProperty(access = Access.<span style="color:#007f7f">WRITE_ONLY</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getPassword() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> password;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŒæ ·çš„ï¼Œå¯ä»¥ä½¿ç”¨<code>@JsonProperty(access = Access.READ_ONLY)</code>å…è®¸è¾“å‡ºï¼Œä¸å…è®¸è¾“å…¥ã€‚</p>
<h2 id="å°ç»“-1">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-1">#</a></h2>
<p>ä½¿ç”¨<code>@RestController</code>å¯ä»¥æ–¹ä¾¿åœ°ç¼–å†™RESTæœåŠ¡ï¼ŒSpringé»˜è®¤ä½¿ç”¨JSONä½œä¸ºè¾“å…¥å’Œè¾“å‡ºã€‚</p>
<p>è¦æ§åˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå¯ä»¥ä½¿ç”¨Jacksonæä¾›çš„<code>@JsonIgnore</code>å’Œ<code>@JsonProperty</code>æ³¨è§£ã€‚</p>
<h1 id="é›†æˆfilter">é›†æˆFilter<a hidden class="anchor" aria-hidden="true" href="#é›†æˆfilter">#</a></h1>
<p>åœ¨Spring MVCä¸­ï¼Œ<code>DispatcherServlet</code>åªéœ€è¦å›ºå®šé…ç½®åˆ°<code>web.xml</code>ä¸­ï¼Œå‰©ä¸‹çš„å·¥ä½œä¸»è¦æ˜¯ä¸“æ³¨äºç¼–å†™Controllerã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨Servletè§„èŒƒä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1266264823560128">ä½¿ç”¨Filter</a>ã€‚å¦‚æœè¦åœ¨Spring MVCä¸­ä½¿ç”¨<code>Filter</code>ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ</p>
<p>æœ‰çš„ç«¥é‹åœ¨ä¸Šä¸€èŠ‚çš„Webåº”ç”¨ä¸­å¯èƒ½å‘ç°äº†ï¼Œå¦‚æœæ³¨å†Œæ—¶è¾“å…¥ä¸­æ–‡ä¼šå¯¼è‡´ä¹±ç ï¼Œå› ä¸ºServleté»˜è®¤æŒ‰éUTF-8ç¼–ç è¯»å–å‚æ•°ã€‚ä¸ºäº†ä¿®å¤è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨ä¸€ä¸ªEncodingFilterï¼Œåœ¨å…¨å±€èŒƒå›´ç±»ç»™<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å¼ºåˆ¶è®¾ç½®ä¸ºUTF-8ç¼–ç ã€‚</p>
<p>å¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ªEncodingFilterï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨Spring MVCè‡ªå¸¦çš„ä¸€ä¸ª<code>CharacterEncodingFilter</code>ã€‚é…ç½®Filteræ—¶ï¼Œåªéœ€åœ¨<code>web.xml</code>ä¸­å£°æ˜å³å¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;web-app&gt;
</span></span><span style="display:flex;"><span>    &lt;filter&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
</span></span><span style="display:flex;"><span>        &lt;init-param&gt;
</span></span><span style="display:flex;"><span>            &lt;param-name&gt;encoding&lt;/param-name&gt;
</span></span><span style="display:flex;"><span>            &lt;param-value&gt;UTF-8&lt;/param-value&gt;
</span></span><span style="display:flex;"><span>        &lt;/init-param&gt;
</span></span><span style="display:flex;"><span>        &lt;init-param&gt;
</span></span><span style="display:flex;"><span>            &lt;param-name&gt;forceEncoding&lt;/param-name&gt;
</span></span><span style="display:flex;"><span>            &lt;param-value&gt;true&lt;/param-value&gt;
</span></span><span style="display:flex;"><span>        &lt;/init-param&gt;
</span></span><span style="display:flex;"><span>    &lt;/filter&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;filter-mapping&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;
</span></span><span style="display:flex;"><span>        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</span></span><span style="display:flex;"><span>    &lt;/filter-mapping&gt;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>&lt;/web-app&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºè¿™ç§Filterå’Œæˆ‘ä»¬ä¸šåŠ¡å…³ç³»ä¸å¤§ï¼Œæ³¨æ„åˆ°<code>CharacterEncodingFilter</code>å…¶å®å’ŒSpringçš„IoCå®¹å™¨æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œä¸¤è€…å‡äº’ä¸çŸ¥æ™“å¯¹æ–¹çš„å­˜åœ¨ï¼Œå› æ­¤ï¼Œé…ç½®è¿™ç§Filterååˆ†ç®€å•ã€‚</p>
<p>æˆ‘ä»¬å†è€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœå…è®¸ç”¨æˆ·ä½¿ç”¨Basicæ¨¡å¼è¿›è¡Œç”¨æˆ·éªŒè¯ï¼Œå³åœ¨HTTPè¯·æ±‚ä¸­æ·»åŠ å¤´<code>Authorization: Basic email:password</code>ï¼Œè¿™ä¸ªéœ€æ±‚å¦‚ä½•å®ç°ï¼Ÿ</p>
<p>ç¼–å†™ä¸€ä¸ª<code>AuthFilter</code>æ˜¯æœ€ç®€å•çš„å®ç°æ–¹å¼ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AuthFilter <span style="color:#fff;font-weight:bold">implements</span> Filter {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>        HttpServletRequest req = (HttpServletRequest) request;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–Authorizationå¤´:</span>
</span></span><span style="display:flex;"><span>        String authHeader = req.<span style="color:#007f7f">getHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Authorization&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (authHeader != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; authHeader.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;Basic &#34;</span>)) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// ä»Headerä¸­æå–emailå’Œpassword:</span>
</span></span><span style="display:flex;"><span>            String email = prefixFrom(authHeader);
</span></span><span style="display:flex;"><span>            String password = suffixFrom(authHeader);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// ç™»å½•:</span>
</span></span><span style="display:flex;"><span>            User user = userService.<span style="color:#007f7f">signin</span>(email, password);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ”¾å…¥Session:</span>
</span></span><span style="display:flex;"><span>            req.<span style="color:#007f7f">getSession</span>().<span style="color:#007f7f">setAttribute</span>(UserController.<span style="color:#007f7f">KEY_USER</span>, user);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ç»§ç»­å¤„ç†è¯·æ±‚:</span>
</span></span><span style="display:flex;"><span>        chain.<span style="color:#007f7f">doFilter</span>(request, response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨é—®é¢˜æ¥äº†ï¼šåœ¨Springä¸­åˆ›å»ºçš„è¿™ä¸ª<code>AuthFilter</code>æ˜¯ä¸€ä¸ªæ™®é€šBeanï¼ŒServletå®¹å™¨å¹¶ä¸çŸ¥é“ï¼Œæ‰€ä»¥å®ƒä¸ä¼šèµ·ä½œç”¨ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨<code>web.xml</code>ä¸­å£°æ˜è¿™ä¸ª<code>AuthFilter</code>ï¼Œæ³¨æ„åˆ°<code>AuthFilter</code>çš„å®ä¾‹å°†ç”±Servletå®¹å™¨è€Œä¸æ˜¯Springå®¹å™¨åˆå§‹åŒ–ï¼Œå› æ­¤ï¼Œ<code>@Autowire</code>æ ¹æœ¬ä¸ç”Ÿæ•ˆï¼Œç”¨äºç™»å½•çš„<code>UserService</code>æˆå‘˜å˜é‡æ°¸è¿œæ˜¯<code>null</code>ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¾—é€šè¿‡ä¸€ç§æ–¹å¼ï¼Œè®©Servletå®¹å™¨å®ä¾‹åŒ–çš„Filterï¼Œé—´æ¥å¼•ç”¨Springå®¹å™¨å®ä¾‹åŒ–çš„<code>AuthFilter</code>ã€‚Spring MVCæä¾›äº†ä¸€ä¸ª<code>DelegatingFilterProxy</code>ï¼Œä¸“é—¨æ¥å¹²è¿™ä¸ªäº‹æƒ…ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;web-app&gt;
</span></span><span style="display:flex;"><span>    &lt;filter&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-name&gt;authFilter&lt;/filter-name&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
</span></span><span style="display:flex;"><span>    &lt;/filter&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;filter-mapping&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-name&gt;authFilter&lt;/filter-name&gt;
</span></span><span style="display:flex;"><span>        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</span></span><span style="display:flex;"><span>    &lt;/filter-mapping&gt;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>&lt;/web-app&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æ¥çœ‹å®ç°åŸç†ï¼š</p>
<ol>
<li>Servletå®¹å™¨ä»<code>web.xml</code>ä¸­è¯»å–é…ç½®ï¼Œå®ä¾‹åŒ–<code>DelegatingFilterProxy</code>ï¼Œæ³¨æ„å‘½åæ˜¯<code>authFilter</code>ï¼›</li>
<li>Springå®¹å™¨é€šè¿‡æ‰«æ<code>@Component</code>å®ä¾‹åŒ–<code>AuthFilter</code>ã€‚</li>
</ol>
<p>å½“<code>DelegatingFilterProxy</code>ç”Ÿæ•ˆåï¼Œå®ƒä¼šè‡ªåŠ¨æŸ¥æ‰¾æ³¨å†Œåœ¨<code>ServletContext</code>ä¸Šçš„Springå®¹å™¨ï¼Œå†è¯•å›¾ä»å®¹å™¨ä¸­æŸ¥æ‰¾åä¸º<code>authFilter</code>çš„Beanï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç”¨<code>@Component</code>å£°æ˜çš„<code>AuthFilter</code>ã€‚</p>
<p><code>DelegatingFilterProxy</code>å°†è¯·æ±‚ä»£ç†ç»™<code>AuthFilter</code>ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DelegatingFilterProxy <span style="color:#fff;font-weight:bold">implements</span> Filter {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Filter delegate;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doFilter(...) <span style="color:#fff;font-weight:bold">throws</span> ... {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (delegate == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            delegate = findBeanFromSpringContainer();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        delegate.<span style="color:#007f7f">doFilter</span>(req, resp, chain);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™å°±æ˜¯ä¸€ä¸ª<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1281319432618017">ä»£ç†æ¨¡å¼</a>çš„ç®€å•åº”ç”¨ã€‚æˆ‘ä»¬ç”»ä¸ªå›¾è¡¨ç¤ºå®ƒä»¬ä¹‹é—´çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â” â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
</span></span><span style="display:flex;"><span>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
</span></span><span style="display:flex;"><span>â”‚ â”‚DelegatingFilterProxyâ”‚â”€â”‚â”€â”‚â”€ â”€&gt;â”‚AuthFilter â”‚
</span></span><span style="display:flex;"><span>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
</span></span><span style="display:flex;"><span>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>  â”‚  DispatcherServlet  â”‚â”€ â”€ â”€ â”€&gt;â”‚Controllersâ”‚   â”‚
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>                                                 â”‚
</span></span><span style="display:flex;"><span>â”‚    Servlet Container    â”‚ â”‚  Spring Container
</span></span><span style="display:flex;"><span> â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€   â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœåœ¨<code>web.xml</code>ä¸­é…ç½®çš„Filteråå­—å’ŒSpringå®¹å™¨çš„Beançš„åå­—ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆéœ€è¦æŒ‡å®šBeançš„åå­—ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;filter&gt;
</span></span><span style="display:flex;"><span>    &lt;filter-name&gt;basicAuthFilter&lt;/filter-name&gt;
</span></span><span style="display:flex;"><span>    &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
</span></span><span style="display:flex;"><span>    &lt;!-- æŒ‡å®šBeançš„åå­— --&gt;
</span></span><span style="display:flex;"><span>    &lt;init-param&gt;
</span></span><span style="display:flex;"><span>        &lt;param-name&gt;targetBeanName&lt;/param-name&gt;
</span></span><span style="display:flex;"><span>        &lt;param-value&gt;authFilter&lt;/param-value&gt;
</span></span><span style="display:flex;"><span>    &lt;/init-param&gt;
</span></span><span style="display:flex;"><span>&lt;/filter&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…åº”ç”¨æ—¶ï¼Œå°½é‡ä¿æŒåå­—ä¸€è‡´ï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„é…ç½®ã€‚</p>
<p>è¦ä½¿ç”¨Basicæ¨¡å¼çš„ç”¨æˆ·è®¤è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨curlå‘½ä»¤æµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·ç™»å½•åæ˜¯<code>tom@example.com</code>ï¼Œå£ä»¤æ˜¯<code>tomcat</code>ï¼Œé‚£ä¹ˆå…ˆæ„é€ ä¸€ä¸ªä½¿ç”¨URLç¼–ç çš„<code>ç”¨æˆ·å:å£ä»¤</code>çš„å­—ç¬¦ä¸²ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>tom%40example.com:tomcat
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹å…¶è¿›è¡ŒBase64ç¼–ç ï¼Œæœ€ç»ˆæ„é€ å‡ºçš„Headerå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Authorization: Basic dG9tJTQwZXhhbXBsZS5jb206dG9tY2F0
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨å¦‚ä¸‹çš„<code>curl</code>å‘½ä»¤å¹¶è·å¾—å“åº”å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ curl -v -H &#39;Authorization: Basic dG9tJTQwZXhhbXBsZS5jb206dG9tY2F0&#39; http://localhost:8080/profile
</span></span><span style="display:flex;"><span>&gt; GET /profile HTTP/1.1
</span></span><span style="display:flex;"><span>&gt; Host: localhost:8080
</span></span><span style="display:flex;"><span>&gt; User-Agent: curl/7.64.1
</span></span><span style="display:flex;"><span>&gt; Accept: */*
</span></span><span style="display:flex;"><span>&gt; Authorization: Basic dG9tJTQwZXhhbXBsZS5jb206dG9tY2F0
</span></span><span style="display:flex;"><span>&gt; 
</span></span><span style="display:flex;"><span>&lt; HTTP/1.1 200 
</span></span><span style="display:flex;"><span>&lt; Set-Cookie: JSESSIONID=CE0F4BFC394816F717443397D4FEABBE; Path=/; HttpOnly
</span></span><span style="display:flex;"><span>&lt; Content-Type: text/html;charset=UTF-8
</span></span><span style="display:flex;"><span>&lt; Content-Language: en-CN
</span></span><span style="display:flex;"><span>&lt; Transfer-Encoding: chunked
</span></span><span style="display:flex;"><span>&lt; Date: Wed, 29 Apr 2020 00:15:50 GMT
</span></span><span style="display:flex;"><span>&lt; 
</span></span><span style="display:flex;"><span>&lt;!doctype html&gt;
</span></span><span style="display:flex;"><span>...HTMLè¾“å‡º...
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°å“åº”è¯´æ˜<code>AuthFilter</code>å·²ç”Ÿæ•ˆã€‚</p>
<p>æ³¨æ„ï¼šBasicè®¤è¯æ¨¡å¼å¹¶ä¸å®‰å…¨ï¼Œæœ¬èŠ‚åªç”¨æ¥ä½œä¸ºä½¿ç”¨Filterçš„ç¤ºä¾‹ã€‚</p>
<h1 id="ä½¿ç”¨interceptor">ä½¿ç”¨Interceptor<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨interceptor">#</a></h1>
<p>åœ¨Webç¨‹åºä¸­ï¼Œæ³¨æ„åˆ°ä½¿ç”¨Filterçš„æ—¶å€™ï¼ŒFilterç”±Servletå®¹å™¨ç®¡ç†ï¼Œå®ƒåœ¨Spring MVCçš„Webåº”ç”¨ç¨‹åºä¸­ä½œç”¨èŒƒå›´å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>         â”‚   â–²
</span></span><span style="display:flex;"><span>         â–¼   â”‚
</span></span><span style="display:flex;"><span>       â”Œâ”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>       â”‚Filter1â”‚
</span></span><span style="display:flex;"><span>       â””â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>         â”‚   â–²
</span></span><span style="display:flex;"><span>         â–¼   â”‚
</span></span><span style="display:flex;"><span>       â”Œâ”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”Œ â”€ â”€ â”€â”‚Filter2â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”
</span></span><span style="display:flex;"><span>       â””â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>â”‚        â”‚   â–²                  â”‚
</span></span><span style="display:flex;"><span>         â–¼   â”‚
</span></span><span style="display:flex;"><span>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
</span></span><span style="display:flex;"><span>  â”‚DispatcherServletâ”‚&lt;â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚      â”‚
</span></span><span style="display:flex;"><span>   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚  â”‚              â”‚ModelAndViewâ”‚â”‚
</span></span><span style="display:flex;"><span>   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>â”‚  â”‚                     â–²      â”‚
</span></span><span style="display:flex;"><span>   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
</span></span><span style="display:flex;"><span>â”‚  â”œâ”€â”€â”€&gt;â”‚Controller1â”‚â”€â”€â”€â”€â”¤      â”‚
</span></span><span style="display:flex;"><span>   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
</span></span><span style="display:flex;"><span>â”‚  â”‚                     â”‚      â”‚
</span></span><span style="display:flex;"><span>   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
</span></span><span style="display:flex;"><span>â”‚  â””â”€â”€â”€&gt;â”‚Controller2â”‚â”€â”€â”€â”€â”˜      â”‚
</span></span><span style="display:flex;"><span>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šå›¾è™šçº¿æ¡†å°±æ˜¯Filter2çš„æ‹¦æˆªèŒƒå›´ï¼ŒFilterç»„ä»¶å®é™…ä¸Šå¹¶ä¸çŸ¥é“åç»­å†…éƒ¨å¤„ç†æ˜¯é€šè¿‡Spring MVCæä¾›çš„<code>DispatcherServlet</code>è¿˜æ˜¯å…¶ä»–Servletç»„ä»¶ï¼Œå› ä¸ºFilteræ˜¯Servletè§„èŒƒå®šä¹‰çš„æ ‡å‡†ç»„ä»¶ï¼Œå®ƒå¯ä»¥åº”ç”¨åœ¨ä»»ä½•åŸºäºServletçš„ç¨‹åºä¸­ã€‚</p>
<p>å¦‚æœåªåŸºäºSpring MVCå¼€å‘åº”ç”¨ç¨‹åºï¼Œè¿˜å¯ä»¥ä½¿ç”¨Spring MVCæä¾›çš„ä¸€ç§åŠŸèƒ½ç±»ä¼¼Filterçš„æ‹¦æˆªå™¨ï¼šInterceptorã€‚å’ŒFilterç›¸æ¯”ï¼ŒInterceptoræ‹¦æˆªèŒƒå›´ä¸æ˜¯åç»­æ•´ä¸ªå¤„ç†æµç¨‹ï¼Œè€Œæ˜¯ä»…é’ˆå¯¹Controlleræ‹¦æˆªï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>       â”‚   â–²
</span></span><span style="display:flex;"><span>       â–¼   â”‚
</span></span><span style="display:flex;"><span>     â”Œâ”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>     â”‚Filter1â”‚
</span></span><span style="display:flex;"><span>     â””â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>       â”‚   â–²
</span></span><span style="display:flex;"><span>       â–¼   â”‚
</span></span><span style="display:flex;"><span>     â”Œâ”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>     â”‚Filter2â”‚
</span></span><span style="display:flex;"><span>     â””â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>       â”‚   â–²
</span></span><span style="display:flex;"><span>       â–¼   â”‚
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚DispatcherServletâ”‚&lt;â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
</span></span><span style="display:flex;"><span> â”‚ â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”¼ â”€ â”€ â”€ â”
</span></span><span style="display:flex;"><span> â”‚                     â”‚
</span></span><span style="display:flex;"><span> â”‚ â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span> â”‚              â”‚   Render   â”‚
</span></span><span style="display:flex;"><span> â”‚ â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span> â”‚                     â–²
</span></span><span style="display:flex;"><span> â”‚ â”‚                   â”‚       â”‚
</span></span><span style="display:flex;"><span> â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span> â”‚ â”‚            â”‚ModelAndViewâ”‚ â”‚
</span></span><span style="display:flex;"><span> â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span> â”‚ â”‚                   â–²       â”‚
</span></span><span style="display:flex;"><span> â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
</span></span><span style="display:flex;"><span> â”œâ”€â”¼â”€&gt;â”‚Controller1â”‚â”€â”€â”€â”€â”¤       â”‚
</span></span><span style="display:flex;"><span> â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
</span></span><span style="display:flex;"><span> â”‚ â”‚                   â”‚       â”‚
</span></span><span style="display:flex;"><span> â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
</span></span><span style="display:flex;"><span> â””â”€â”¼â”€&gt;â”‚Controller2â”‚â”€â”€â”€â”€â”˜       â”‚
</span></span><span style="display:flex;"><span>      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>   â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šå›¾è™šçº¿æ¡†å°±æ˜¯Interceptorçš„æ‹¦æˆªèŒƒå›´ï¼Œæ³¨æ„åˆ°Controllerçš„å¤„ç†æ–¹æ³•ä¸€èˆ¬éƒ½ç±»ä¼¼è¿™æ ·ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span>public class Controller1 {
</span></span><span style="display:flex;"><span>    @GetMapping(&#34;/path/to/hello&#34;)
</span></span><span style="display:flex;"><span>    ModelAndView hello() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥ï¼ŒInterceptorçš„æ‹¦æˆªèŒƒå›´å…¶å®å°±æ˜¯Controlleræ–¹æ³•ï¼Œå®ƒå®é™…ä¸Šå°±ç›¸å½“äºåŸºäºAOPçš„æ–¹æ³•æ‹¦æˆªã€‚å› ä¸ºInterceptoråªæ‹¦æˆªControlleræ–¹æ³•ï¼Œæ‰€ä»¥è¦æ³¨æ„ï¼Œè¿”å›<code>ModelAndView</code>å¹¶æ¸²æŸ“åï¼Œåç»­å¤„ç†å°±è„±ç¦»äº†Interceptorçš„æ‹¦æˆªèŒƒå›´ã€‚</p>
<p>ä½¿ç”¨Interceptorçš„å¥½å¤„æ˜¯Interceptoræœ¬èº«æ˜¯Springç®¡ç†çš„Beanï¼Œå› æ­¤æ³¨å…¥ä»»æ„Beanéƒ½éå¸¸ç®€å•ã€‚æ­¤å¤–ï¼Œå¯ä»¥åº”ç”¨å¤šä¸ªInterceptorï¼Œå¹¶é€šè¿‡ç®€å•çš„<code>@Order</code>æŒ‡å®šé¡ºåºã€‚æˆ‘ä»¬å…ˆå†™ä¸€ä¸ª<code>LoggerInterceptor</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@Order(1)
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>public class LoggerInterceptor implements HandlerInterceptor {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    final Logger logger = LoggerFactory.getLogger(getClass());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
</span></span><span style="display:flex;"><span>        logger.info(&#34;preHandle {}...&#34;, request.getRequestURI());
</span></span><span style="display:flex;"><span>        if (request.getParameter(&#34;debug&#34;) != null) {
</span></span><span style="display:flex;"><span>            PrintWriter pw = response.getWriter();
</span></span><span style="display:flex;"><span>            pw.write(&#34;&lt;p&gt;DEBUG MODE&lt;/p&gt;&#34;);
</span></span><span style="display:flex;"><span>            pw.flush();
</span></span><span style="display:flex;"><span>            return false;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        return true;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
</span></span><span style="display:flex;"><span>        logger.info(&#34;postHandle {}.&#34;, request.getRequestURI());
</span></span><span style="display:flex;"><span>        if (modelAndView != null) {
</span></span><span style="display:flex;"><span>            modelAndView.addObject(&#34;__time__&#34;, LocalDateTime.now());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
</span></span><span style="display:flex;"><span>        logger.info(&#34;afterCompletion {}: exception = {}&#34;, request.getRequestURI(), ex);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€ä¸ªInterceptorå¿…é¡»å®ç°<code>HandlerInterceptor</code>æ¥å£ï¼Œå¯ä»¥é€‰æ‹©å®ç°<code>preHandle()</code>ã€<code>postHandle()</code>å’Œ<code>afterCompletion()</code>æ–¹æ³•ã€‚<code>preHandle()</code>æ˜¯Controlleræ–¹æ³•è°ƒç”¨å‰æ‰§è¡Œï¼Œ<code>postHandle()</code>æ˜¯Controlleræ–¹æ³•æ­£å¸¸è¿”å›åæ‰§è¡Œï¼Œè€Œ<code>afterCompletion()</code>æ— è®ºControlleræ–¹æ³•æ˜¯å¦æŠ›å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œï¼Œå‚æ•°<code>ex</code>å°±æ˜¯Controlleræ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆæœªæŠ›å‡ºå¼‚å¸¸æ˜¯<code>null</code>ï¼‰ã€‚</p>
<p>åœ¨<code>preHandle()</code>ä¸­ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¤„ç†å“åº”ï¼Œç„¶åè¿”å›<code>false</code>è¡¨ç¤ºæ— éœ€è°ƒç”¨Controlleræ–¹æ³•ç»§ç»­å¤„ç†äº†ï¼Œé€šå¸¸åœ¨è®¤è¯æˆ–è€…å®‰å…¨æ£€æŸ¥å¤±è´¥æ—¶ç›´æ¥è¿”å›é”™è¯¯å“åº”ã€‚åœ¨<code>postHandle()</code>ä¸­ï¼Œå› ä¸ºæ•è·äº†Controlleræ–¹æ³•è¿”å›çš„<code>ModelAndView</code>ï¼Œæ‰€ä»¥å¯ä»¥ç»§ç»­å¾€<code>ModelAndView</code>é‡Œæ·»åŠ ä¸€äº›é€šç”¨æ•°æ®ï¼Œå¾ˆå¤šé¡µé¢éœ€è¦çš„å…¨å±€æ•°æ®å¦‚Copyrightä¿¡æ¯ç­‰éƒ½å¯ä»¥æ”¾åˆ°è¿™é‡Œï¼Œæ— éœ€åœ¨æ¯ä¸ªControlleræ–¹æ³•ä¸­é‡å¤æ·»åŠ ã€‚</p>
<p>æˆ‘ä»¬å†ç»§ç»­æ·»åŠ ä¸€ä¸ª<code>AuthInterceptor</code>ï¼Œç”¨äºæ›¿ä»£ä¸Šä¸€èŠ‚ä½¿ç”¨<code>AuthFilter</code>è¿›è¡ŒBasicè®¤è¯çš„åŠŸèƒ½ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@Order(2)
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>public class AuthInterceptor implements HandlerInterceptor {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    final Logger logger = LoggerFactory.getLogger(getClass());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
</span></span><span style="display:flex;"><span>            throws Exception {
</span></span><span style="display:flex;"><span>        logger.info(&#34;pre authenticate {}...&#34;, request.getRequestURI());
</span></span><span style="display:flex;"><span>        try {
</span></span><span style="display:flex;"><span>            authenticateByHeader(request);
</span></span><span style="display:flex;"><span>        } catch (RuntimeException e) {
</span></span><span style="display:flex;"><span>            logger.warn(&#34;login by authorization header failed.&#34;, e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        return true;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    private void authenticateByHeader(HttpServletRequest req) {
</span></span><span style="display:flex;"><span>        String authHeader = req.getHeader(&#34;Authorization&#34;);
</span></span><span style="display:flex;"><span>        if (authHeader != null &amp;&amp; authHeader.startsWith(&#34;Basic &#34;)) {
</span></span><span style="display:flex;"><span>            logger.info(&#34;try authenticate by authorization header...&#34;);
</span></span><span style="display:flex;"><span>            String up = new String(Base64.getDecoder().decode(authHeader.substring(6)), StandardCharsets.UTF_8);
</span></span><span style="display:flex;"><span>            int pos = up.indexOf(&#39;:&#39;);
</span></span><span style="display:flex;"><span>            if (pos &gt; 0) {
</span></span><span style="display:flex;"><span>                String email = URLDecoder.decode(up.substring(0, pos), StandardCharsets.UTF_8);
</span></span><span style="display:flex;"><span>                String password = URLDecoder.decode(up.substring(pos + 1), StandardCharsets.UTF_8);
</span></span><span style="display:flex;"><span>                User user = userService.signin(email, password);
</span></span><span style="display:flex;"><span>                req.getSession().setAttribute(UserController.KEY_USER, user);
</span></span><span style="display:flex;"><span>                logger.info(&#34;user {} login by authorization header ok.&#34;, email);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ª<code>AuthInterceptor</code>æ˜¯ç”±Springå®¹å™¨ç›´æ¥ç®¡ç†çš„ï¼Œå› æ­¤æ³¨å…¥<code>UserService</code>éå¸¸æ–¹ä¾¿ã€‚</p>
<p>æœ€åï¼Œè¦è®©æ‹¦æˆªå™¨ç”Ÿæ•ˆï¼Œæˆ‘ä»¬åœ¨<code>WebMvcConfigurer</code>ä¸­æ³¨å†Œæ‰€æœ‰çš„Interceptorï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f00">@</span>Bean
</span></span><span style="display:flex;"><span>WebMvcConfigurer createWebMvcConfigurer(<span style="color:#f00">@</span>Autowired HandlerInterceptor[] interceptors) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> new WebMvcConfigurer() {
</span></span><span style="display:flex;"><span>        public void addInterceptors(InterceptorRegistry registry) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">var</span> interceptor : interceptors) {
</span></span><span style="display:flex;"><span>                registry.addInterceptor(interceptor);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ‹¦æˆªå™¨æ²¡æœ‰ç”Ÿæ•ˆï¼Œè¯·æ£€æŸ¥æ˜¯å¦å¿˜äº†åœ¨WebMvcConfigurerä¸­æ³¨å†Œã€‚</p>
<h2 id="å¤„ç†å¼‚å¸¸">å¤„ç†å¼‚å¸¸<a hidden class="anchor" aria-hidden="true" href="#å¤„ç†å¼‚å¸¸">#</a></h2>
<p>åœ¨Controllerä¸­ï¼ŒSpring MVCè¿˜å…è®¸å®šä¹‰åŸºäº<code>@ExceptionHandler</code>æ³¨è§£çš„å¼‚å¸¸å¤„ç†æ–¹æ³•ã€‚æˆ‘ä»¬æ¥çœ‹å…·ä½“çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span>public class UserController {
</span></span><span style="display:flex;"><span>    @ExceptionHandler(RuntimeException.class)
</span></span><span style="display:flex;"><span>    public ModelAndView handleUnknowException(Exception ex) {
</span></span><span style="display:flex;"><span>        return new ModelAndView(&#34;500.html&#34;, Map.of(&#34;error&#34;, ex.getClass().getSimpleName(), &#34;message&#34;, ex.getMessage()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¼‚å¸¸å¤„ç†æ–¹æ³•æ²¡æœ‰å›ºå®šçš„æ–¹æ³•ç­¾åï¼Œå¯ä»¥ä¼ å…¥<code>Exception</code>ã€<code>HttpServletRequest</code>ç­‰ï¼Œè¿”å›å€¼å¯ä»¥æ˜¯<code>void</code>ï¼Œä¹Ÿå¯ä»¥æ˜¯<code>ModelAndView</code>ï¼Œä¸Šè¿°ä»£ç é€šè¿‡<code>@ExceptionHandler(RuntimeException.class)</code>è¡¨ç¤ºå½“å‘ç”Ÿ<code>RuntimeException</code>çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨è°ƒç”¨æ­¤æ–¹æ³•å¤„ç†ã€‚</p>
<p>æ³¨æ„åˆ°æˆ‘ä»¬è¿”å›äº†ä¸€ä¸ªæ–°çš„<code>ModelAndView</code>ï¼Œè¿™æ ·åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨å¦‚æœå‘ç”Ÿäº†é¢„æ–™ä¹‹å¤–çš„å¼‚å¸¸ï¼Œå¯ä»¥ç»™ç”¨æˆ·æ˜¾ç¤ºä¸€ä¸ªå‡ºé”™é¡µé¢ï¼Œè€Œä¸æ˜¯ç®€å•çš„500 Internal Server Erroræˆ–404 Not Foundã€‚ä¾‹å¦‚Bç«™çš„é”™è¯¯é¡µã€‚</p>
<p>å¯ä»¥ç¼–å†™å¤šä¸ªé”™è¯¯å¤„ç†æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•é’ˆå¯¹ç‰¹å®šçš„å¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œå¤„ç†<code>LoginException</code>ä½¿å¾—é¡µé¢å¯ä»¥è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µã€‚</p>
<p>ä½¿ç”¨<code>ExceptionHandler</code>æ—¶ï¼Œè¦æ³¨æ„å®ƒä»…ä½œç”¨äºå½“å‰çš„Controllerï¼Œå³ControllerAä¸­å®šä¹‰çš„ä¸€ä¸ª<code>ExceptionHandler</code>æ–¹æ³•å¯¹ControllerBä¸èµ·ä½œç”¨ã€‚å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šControllerï¼Œæ¯ä¸ªControlleréƒ½éœ€è¦å¤„ç†ä¸€äº›é€šç”¨çš„å¼‚å¸¸ï¼Œä¾‹å¦‚<code>LoginException</code>ï¼Œæ€è€ƒä¸€ä¸‹åº”è¯¥æ€ä¹ˆé¿å…é‡å¤ä»£ç ï¼Ÿ</p>
<h2 id="å°ç»“-2">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-2">#</a></h2>
<p>Spring MVCæä¾›äº†Interceptorç»„ä»¶æ¥æ‹¦æˆªControlleræ–¹æ³•ï¼Œä½¿ç”¨æ—¶è¦æ³¨æ„Interceptorçš„ä½œç”¨èŒƒå›´ã€‚</p>
<h1 id="å¤„ç†cors">å¤„ç†CORS<a hidden class="anchor" aria-hidden="true" href="#å¤„ç†cors">#</a></h1>
<p>åœ¨å¼€å‘RESTåº”ç”¨æ—¶ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæ˜¯é€šè¿‡é¡µé¢çš„JavaScriptå’Œåç«¯çš„REST APIäº¤äº’ã€‚</p>
<p>åœ¨JavaScriptä¸RESTäº¤äº’çš„æ—¶å€™ï¼Œæœ‰å¾ˆå¤šå®‰å…¨é™åˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨æŒ‰åŒæºç­–ç•¥æ”¾è¡ŒJavaScriptè°ƒç”¨APIï¼Œå³ï¼š</p>
<ul>
<li>å¦‚æœAç«™åœ¨åŸŸå<code>a.com</code>é¡µé¢çš„JavaScriptè°ƒç”¨Aç«™è‡ªå·±çš„APIæ—¶ï¼Œæ²¡æœ‰é—®é¢˜ï¼›</li>
<li>å¦‚æœAç«™åœ¨åŸŸå<code>a.com</code>é¡µé¢çš„JavaScriptè°ƒç”¨Bç«™<code>b.com</code>çš„APIæ—¶ï¼Œå°†è¢«æµè§ˆå™¨æ‹’ç»è®¿é—®ï¼Œå› ä¸ºä¸æ»¡è¶³åŒæºç­–ç•¥ã€‚</li>
</ul>
<p>åŒæºè¦æ±‚åŸŸåè¦å®Œå…¨ç›¸åŒï¼ˆ<code>a.com</code>å’Œ<code>www.a.com</code>ä¸åŒï¼‰ï¼Œåè®®è¦ç›¸åŒï¼ˆ<code>http</code>å’Œ<code>https</code>ä¸åŒï¼‰ï¼Œç«¯å£è¦ç›¸åŒ ã€‚</p>
<p>é‚£ä¹ˆï¼Œåœ¨åŸŸå<code>a.com</code>é¡µé¢çš„JavaScriptè¦è°ƒç”¨Bç«™<code>b.com</code>çš„APIæ—¶ï¼Œè¿˜æœ‰æ²¡æœ‰åŠæ³•ï¼Ÿ</p>
<p>åŠæ³•æ˜¯æœ‰çš„ï¼Œé‚£å°±æ˜¯CORSï¼Œå…¨ç§°Cross-Origin Resource Sharingï¼Œæ˜¯HTML5è§„èŒƒå®šä¹‰çš„å¦‚ä½•è·¨åŸŸè®¿é—®èµ„æºã€‚å¦‚æœAç«™çš„JavaScriptè®¿é—®Bç«™APIçš„æ—¶å€™ï¼ŒBç«™èƒ½å¤Ÿè¿”å›å“åº”å¤´<code>Access-Control-Allow-Origin: http://a.com</code>ï¼Œé‚£ä¹ˆï¼Œæµè§ˆå™¨å°±å…è®¸Aç«™çš„JavaScriptè®¿é—®Bç«™çš„APIã€‚</p>
<p>æ³¨æ„åˆ°è·¨åŸŸè®¿é—®èƒ½å¦æˆåŠŸï¼Œå–å†³äºBç«™æ˜¯å¦æ„¿æ„ç»™Aç«™è¿”å›ä¸€ä¸ªæ­£ç¡®çš„<code>Access-Control-Allow-Origin</code>å“åº”å¤´ï¼Œæ‰€ä»¥å†³å®šæƒæ°¸è¿œåœ¨æä¾›APIçš„æœåŠ¡æ–¹æ‰‹ä¸­ã€‚</p>
<p>å…³äºCORSçš„è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒ<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">MDNæ–‡æ¡£</a>ï¼Œè¿™é‡Œä¸å†è¯¦è¿°ã€‚</p>
<p>ä½¿ç”¨Springçš„<code>@RestController</code>å¼€å‘RESTåº”ç”¨æ—¶ï¼ŒåŒæ ·ä¼šé¢å¯¹è·¨åŸŸé—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬å…è®¸æŒ‡å®šçš„ç½‘ç«™é€šè¿‡é¡µé¢JavaScriptè®¿é—®è¿™äº›REST APIï¼Œå°±å¿…é¡»æ­£ç¡®åœ°è®¾ç½®CORSã€‚</p>
<p>æœ‰å¥½å‡ ç§æ–¹æ³•è®¾ç½®CORSï¼Œæˆ‘ä»¬æ¥ä¸€ä¸€ä»‹ç»ã€‚</p>
<h2 id="ä½¿ç”¨crossorigin">ä½¿ç”¨@CrossOrigin<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨crossorigin">#</a></h2>
<p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<code>@CrossOrigin</code>æ³¨è§£ï¼Œå¯ä»¥åœ¨<code>@RestController</code>çš„classçº§åˆ«æˆ–æ–¹æ³•çº§åˆ«å®šä¹‰ä¸€ä¸ª<code>@CrossOrigin</code>ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@CrossOrigin(origins = <span style="color:#0ff;font-weight:bold">&#34;http://local.liaoxuefeng.com:8080&#34;</span>)
</span></span><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span>@RequestMapping(<span style="color:#0ff;font-weight:bold">&#34;/api&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ApiController {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°å®šä¹‰åœ¨<code>ApiController</code>å¤„çš„<code>@CrossOrigin</code>æŒ‡å®šäº†åªå…è®¸æ¥è‡ª<code>local.liaoxuefeng.com</code>è·¨åŸŸè®¿é—®ï¼Œå…è®¸å¤šä¸ªåŸŸè®¿é—®éœ€è¦å†™æˆæ•°ç»„å½¢å¼ï¼Œä¾‹å¦‚<code>origins = {&quot;http://a.com&quot;, &quot;https://www.b.com&quot;})</code>ã€‚å¦‚æœè¦å…è®¸ä»»ä½•åŸŸè®¿é—®ï¼Œå†™æˆ<code>origins = &quot;*&quot;</code>å³å¯ã€‚</p>
<p>å¦‚æœæœ‰å¤šä¸ªREST Controlleréƒ½éœ€è¦ä½¿ç”¨CORSï¼Œé‚£ä¹ˆï¼Œæ¯ä¸ªControlleréƒ½å¿…é¡»æ ‡æ³¨<code>@CrossOrigin</code>æ³¨è§£ã€‚</p>
<h2 id="ä½¿ç”¨corsregistry">ä½¿ç”¨CorsRegistry<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨corsregistry">#</a></h2>
<p>ç¬¬äºŒç§æ–¹æ³•æ˜¯åœ¨<code>WebMvcConfigurer</code>ä¸­å®šä¹‰ä¸€ä¸ªå…¨å±€CORSé…ç½®ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>WebMvcConfigurer createWebMvcConfigurer() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> WebMvcConfigurer() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addCorsMappings(CorsRegistry registry) {
</span></span><span style="display:flex;"><span>            registry.<span style="color:#007f7f">addMapping</span>(<span style="color:#0ff;font-weight:bold">&#34;/api/**&#34;</span>)
</span></span><span style="display:flex;"><span>                    .<span style="color:#007f7f">allowedOrigins</span>(<span style="color:#0ff;font-weight:bold">&#34;http://local.liaoxuefeng.com:8080&#34;</span>)
</span></span><span style="display:flex;"><span>                    .<span style="color:#007f7f">allowedMethods</span>(<span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;POST&#34;</span>)
</span></span><span style="display:flex;"><span>                    .<span style="color:#007f7f">maxAge</span>(3600);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–URLè§„åˆ™:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// registry.addMapping(&#34;/rest/v2/**&#34;)...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ–¹å¼å¯ä»¥åˆ›å»ºä¸€ä¸ªå…¨å±€CORSé…ç½®ï¼Œå¦‚æœä»”ç»†åœ°è®¾è®¡URLç»“æ„ï¼Œé‚£ä¹ˆå¯ä»¥ä¸€ç›®äº†ç„¶åœ°çœ‹åˆ°å„ä¸ªURLçš„CORSè§„åˆ™ï¼Œæ¨èä½¿ç”¨è¿™ç§æ–¹å¼é…ç½®CORSã€‚</p>
<h2 id="ä½¿ç”¨corsfilter">ä½¿ç”¨CorsFilter<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨corsfilter">#</a></h2>
<p>ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯ä½¿ç”¨Springæä¾›çš„<code>CorsFilter</code>ï¼Œæˆ‘ä»¬åœ¨<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1282384114745378/">é›†æˆFilter</a>ä¸­è¯¦ç»†ä»‹ç»äº†å°†Springå®¹å™¨å†…ç½®çš„Beanæš´éœ²ä¸ºServletå®¹å™¨çš„Filterçš„æ–¹æ³•ï¼Œç”±äºè¿™ç§é…ç½®æ–¹å¼éœ€è¦ä¿®æ”¹<code>web.xml</code>ï¼Œä¹Ÿæ¯”è¾ƒç¹çï¼Œæ‰€ä»¥æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚</p>
<h2 id="æµ‹è¯•">æµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#æµ‹è¯•">#</a></h2>
<p>å½“æˆ‘ä»¬é…ç½®å¥½CORSåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ä¸€ä¸‹è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆã€‚</p>
<p>æˆ‘ä»¬å…ˆç”¨<code>http://localhost:8080</code>åœ¨Chromeæµè§ˆå™¨ä¸­æ‰“å¼€é¦–é¡µï¼Œç„¶åæ‰“å¼€Chromeçš„å¼€å‘è€…å·¥å…·ï¼Œåˆ‡æ¢åˆ°Consoleï¼Œè¾“å…¥ä¸€ä¸ªJavaScriptè¯­å¥æ¥è·¨åŸŸè®¿é—®APIï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$.getJSON( &#34;http://local.liaoxuefeng.com:8080/api/users&#34;, (data) =&gt; console.log(JSON.stringify(data)));
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°æºç«™çš„åŸŸæ˜¯<code>http://localhost:8080</code>ï¼Œè·¨åŸŸè®¿é—®çš„æ˜¯<code>http://local.liaoxuefeng.com:8080</code>ï¼Œå› ä¸ºé…ç½®çš„CORSä¸å…è®¸<code>localhost</code>è®¿é—®ï¼Œæ‰€ä»¥ä¸å‡ºæ„å¤–åœ°å¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚</p>
<p>æµè§ˆé¢˜æ‰“å°äº†é”™è¯¯åŸå› å°±æ˜¯<code>been blocked by CORS policy</code>ã€‚</p>
<p>æˆ‘ä»¬å†ç”¨<code>http://local.liaoxuefeng.com:8080</code>åœ¨Chromeæµè§ˆå™¨ä¸­æ‰“å¼€é¦–é¡µï¼Œåœ¨Consoleä¸­æ‰§è¡ŒJavaScriptè®¿é—®<code>localhost</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$.getJSON( &#34;http://localhost:8080/api/users&#34;, (data) =&gt; console.log(JSON.stringify(data)));
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºCORSè§„åˆ™å…è®¸æ¥è‡ª<code>http://local.liaoxuefeng.com:8080</code>çš„è®¿é—®ï¼Œå› æ­¤è®¿é—®æˆåŠŸï¼Œæ‰“å°å‡ºAPIçš„è¿”å›å€¼ã€‚</p>
<h1 id="å›½é™…åŒ–">å›½é™…åŒ–<a hidden class="anchor" aria-hidden="true" href="#å›½é™…åŒ–">#</a></h1>
<p>åœ¨å¼€å‘åº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œç»å¸¸ä¼šé‡åˆ°æ”¯æŒå¤šè¯­è¨€çš„éœ€æ±‚ï¼Œè¿™ç§æ”¯æŒå¤šè¯­è¨€çš„åŠŸèƒ½ç§°ä¹‹ä¸ºå›½é™…åŒ–ï¼Œè‹±æ–‡æ˜¯internationalizationï¼Œç¼©å†™ä¸ºi18nï¼ˆå› ä¸ºé¦–å­—æ¯iå’Œæœ«å­—æ¯nä¸­é—´æœ‰18ä¸ªå­—æ¯ï¼‰ã€‚</p>
<p>è¿˜æœ‰é’ˆå¯¹ç‰¹å®šåœ°åŒºçš„æœ¬åœ°åŒ–åŠŸèƒ½ï¼Œè‹±æ–‡æ˜¯localizationï¼Œç¼©å†™ä¸ºL10nï¼Œæœ¬åœ°åŒ–æ˜¯æŒ‡æ ¹æ®åœ°åŒºè°ƒæ•´ç±»ä¼¼å§“åã€æ—¥æœŸçš„æ˜¾ç¤ºç­‰ã€‚</p>
<p>ä¹Ÿæœ‰æŠŠä¸Šé¢ä¸¤è€…åˆç§°ä¸ºå…¨çƒåŒ–ï¼Œè‹±æ–‡æ˜¯globalizationï¼Œç¼©å†™ä¸ºg11nã€‚</p>
<p>åœ¨Javaä¸­ï¼Œæ”¯æŒå¤šè¯­è¨€å’Œæœ¬åœ°åŒ–æ˜¯é€šè¿‡<code>MessageFormat</code>é…åˆ<code>Locale</code>å®ç°çš„ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.text.MessageFormat;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Locale;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Time {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">double</span> price = 123.<span style="color:#007f7f">5</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> number = 10;
</span></span><span style="display:flex;"><span>        Object[] arguments = { price, number };
</span></span><span style="display:flex;"><span>        MessageFormat mfUS = <span style="color:#fff;font-weight:bold">new</span> MessageFormat(<span style="color:#0ff;font-weight:bold">&#34;Pay {0,number,currency} for {1} books.&#34;</span>, Locale.<span style="color:#007f7f">US</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(mfUS.<span style="color:#007f7f">format</span>(arguments));
</span></span><span style="display:flex;"><span>        MessageFormat mfZH = <span style="color:#fff;font-weight:bold">new</span> MessageFormat(<span style="color:#0ff;font-weight:bold">&#34;{1}æœ¬ä¹¦ä¸€å…±{0,number,currency}ã€‚&#34;</span>, Locale.<span style="color:#007f7f">CHINA</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(mfZH.<span style="color:#007f7f">format</span>(arguments));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºWebåº”ç”¨ç¨‹åºï¼Œè¦å®ç°å›½é™…åŒ–åŠŸèƒ½ï¼Œä¸»è¦æ˜¯æ¸²æŸ“Viewçš„æ—¶å€™ï¼Œè¦æŠŠå„ç§è¯­è¨€çš„èµ„æºæ–‡ä»¶æå‡ºæ¥ï¼Œè¿™æ ·ï¼Œä¸åŒçš„ç”¨æˆ·è®¿é—®åŒä¸€ä¸ªé¡µé¢æ—¶ï¼Œæ˜¾ç¤ºçš„è¯­è¨€å°±æ˜¯ä¸åŒçš„ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨Spring MVCåº”ç”¨ç¨‹åºä¸­å¦‚ä½•å®ç°å›½é™…åŒ–ã€‚</p>
<h2 id="è·å–locale">è·å–Locale<a hidden class="anchor" aria-hidden="true" href="#è·å–locale">#</a></h2>
<p>å®ç°å›½é™…åŒ–çš„ç¬¬ä¸€æ­¥æ˜¯è·å–åˆ°ç”¨æˆ·çš„<code>Locale</code>ã€‚åœ¨Webåº”ç”¨ç¨‹åºä¸­ï¼ŒHTTPè§„èŒƒè§„å®šäº†æµè§ˆå™¨ä¼šåœ¨è¯·æ±‚ä¸­æºå¸¦<code>Accept-Language</code>å¤´ï¼Œç”¨æ¥æŒ‡ç¤ºç”¨æˆ·æµè§ˆå™¨è®¾å®šçš„è¯­è¨€é¡ºåºï¼Œå¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Accept-Language: zh-CN,zh;q=0.8,en;q=0.2
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°HTTPè¯·æ±‚å¤´è¡¨ç¤ºä¼˜å…ˆé€‰æ‹©ç®€ä½“ä¸­æ–‡ï¼Œå…¶æ¬¡é€‰æ‹©ä¸­æ–‡ï¼Œæœ€åé€‰æ‹©è‹±æ–‡ã€‚<code>q</code>è¡¨ç¤ºæƒé‡ï¼Œè§£æåæˆ‘ä»¬å¯è·å¾—ä¸€ä¸ªæ ¹æ®ä¼˜å…ˆçº§æ’åºçš„è¯­è¨€åˆ—è¡¨ï¼ŒæŠŠå®ƒè½¬æ¢ä¸ºJavaçš„<code>Locale</code>ï¼Œå³è·å¾—äº†ç”¨æˆ·çš„<code>Locale</code>ã€‚å¤§å¤šæ•°æ¡†æ¶é€šå¸¸åªè¿”å›æƒé‡æœ€é«˜çš„<code>Locale</code>ã€‚</p>
<p>Spring MVCé€šè¿‡<code>LocaleResolver</code>æ¥è‡ªåŠ¨ä»<code>HttpServletRequest</code>ä¸­è·å–<code>Locale</code>ã€‚æœ‰å¤šç§<code>LocaleResolver</code>çš„å®ç°ç±»ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯<code>CookieLocaleResolver</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f00">@</span>Bean
</span></span><span style="display:flex;"><span>LocaleResolver createLocaleResolver() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">var</span> clr = new CookieLocaleResolver();
</span></span><span style="display:flex;"><span>    clr.setDefaultLocale(Locale.ENGLISH);
</span></span><span style="display:flex;"><span>    clr.setDefaultTimeZone(TimeZone.getDefault());
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> clr;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>CookieLocaleResolver</code>ä»<code>HttpServletRequest</code>ä¸­è·å–<code>Locale</code>æ—¶ï¼Œé¦–å…ˆæ ¹æ®ä¸€ä¸ªç‰¹å®šçš„Cookieåˆ¤æ–­æ˜¯å¦æŒ‡å®šäº†<code>Locale</code>ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä»HTTPå¤´è·å–ï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼Œå°±è¿”å›é»˜è®¤çš„<code>Locale</code>ã€‚</p>
<p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™æ—¶ï¼Œ<code>CookieLocaleResolver</code>åªèƒ½ä»HTTPå¤´è·å–<code>Locale</code>ï¼Œå³ä½¿ç”¨æµè§ˆå™¨çš„é»˜è®¤è¯­è¨€ã€‚é€šå¸¸ç½‘ç«™ä¹Ÿå…è®¸ç”¨æˆ·è‡ªå·±é€‰æ‹©è¯­è¨€ï¼Œæ­¤æ—¶ï¼Œ<code>CookieLocaleResolver</code>å°±ä¼šæŠŠç”¨æˆ·é€‰æ‹©çš„è¯­è¨€å­˜æ”¾åˆ°Cookieä¸­ï¼Œä¸‹ä¸€æ¬¡è®¿é—®æ—¶ï¼Œå°±ä¼šè¿”å›ç”¨æˆ·ä¸Šæ¬¡é€‰æ‹©çš„è¯­è¨€è€Œä¸æ˜¯æµè§ˆå™¨é»˜è®¤è¯­è¨€ã€‚</p>
<h2 id="æå–èµ„æºæ–‡ä»¶">æå–èµ„æºæ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#æå–èµ„æºæ–‡ä»¶">#</a></h2>
<p>ç¬¬äºŒæ­¥æ˜¯æŠŠå†™æ­»åœ¨æ¨¡æ¿ä¸­çš„å­—ç¬¦ä¸²ä»¥èµ„æºæ–‡ä»¶çš„æ–¹å¼å­˜å‚¨åœ¨å¤–éƒ¨ã€‚å¯¹äºå¤šè¯­è¨€ï¼Œä¸»æ–‡ä»¶åå¦‚æœå‘½åä¸º<code>messages</code>ï¼Œé‚£ä¹ˆèµ„æºæ–‡ä»¶å¿…é¡»æŒ‰å¦‚ä¸‹æ–¹å¼å‘½åå¹¶æ”¾å…¥classpathä¸­ï¼š</p>
<ul>
<li>é»˜è®¤è¯­è¨€ï¼Œæ–‡ä»¶åå¿…é¡»ä¸º<code>messages.properties</code>ï¼›</li>
<li>ç®€ä½“ä¸­æ–‡ï¼ŒLocaleæ˜¯<code>zh_CN</code>ï¼Œæ–‡ä»¶åå¿…é¡»ä¸º<code>messages_zh_CN.properties</code>ï¼›</li>
<li>æ—¥æ–‡ï¼ŒLocaleæ˜¯<code>ja_JP</code>ï¼Œæ–‡ä»¶åå¿…é¡»ä¸º<code>messages_ja_JP.properties</code>ï¼›</li>
<li>å…¶å®ƒæ›´å¤šè¯­è¨€â€¦â€¦</li>
</ul>
<p>æ¯ä¸ªèµ„æºæ–‡ä»¶éƒ½æœ‰ç›¸åŒçš„keyï¼Œä¾‹å¦‚ï¼Œé»˜è®¤è¯­è¨€æ˜¯è‹±æ–‡ï¼Œæ–‡ä»¶<code>messages.properties</code>å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>language.select=Language
</span></span><span style="display:flex;"><span>home=Home
</span></span><span style="display:flex;"><span>signin=Sign In
</span></span><span style="display:flex;"><span>copyright=CopyrightÂ©{0,number,#}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ–‡ä»¶<code>messages_zh_CN.properties</code>å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>language.select=è¯­è¨€
</span></span><span style="display:flex;"><span>home=é¦–é¡µ
</span></span><span style="display:flex;"><span>signin=ç™»å½•
</span></span><span style="display:flex;"><span>copyright=ç‰ˆæƒæ‰€æœ‰Â©{0,number,#}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ›å»ºmessagesource">åˆ›å»ºMessageSource<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»ºmessagesource">#</a></h2>
<p>ç¬¬ä¸‰æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªSpringæä¾›çš„<code>MessageSource</code>å®ä¾‹ï¼Œå®ƒè‡ªåŠ¨è¯»å–æ‰€æœ‰çš„<code>.properties</code>æ–‡ä»¶ï¼Œå¹¶æä¾›ä¸€ä¸ªç»Ÿä¸€æ¥å£æ¥å®ç°â€œç¿»è¯‘â€ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// code, arguments, locale:
</span></span><span style="display:flex;"><span>String text = messageSource.getMessage(&#34;signin&#34;, null, locale);
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œ<code>signin</code>æ˜¯æˆ‘ä»¬åœ¨<code>.properties</code>æ–‡ä»¶ä¸­å®šä¹‰çš„keyï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯<code>Object[]</code>æ•°ç»„ä½œä¸ºæ ¼å¼åŒ–æ—¶ä¼ å…¥çš„å‚æ•°ï¼Œæœ€åä¸€ä¸ªå‚æ•°å°±æ˜¯è·å–çš„ç”¨æˆ·<code>Locale</code>å®ä¾‹ã€‚</p>
<p>åˆ›å»º<code>MessageSource</code>å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f00">@</span>Bean(<span style="color:#0ff;font-weight:bold">&#34;i18n&#34;</span>)
</span></span><span style="display:flex;"><span>MessageSource createMessageSource() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">var</span> messageSource = new ResourceBundleMessageSource();
</span></span><span style="display:flex;"><span>    // <span style="color:#f00">æŒ‡å®šæ–‡ä»¶æ˜¯</span>UTF-<span style="color:#ff0;font-weight:bold">8</span><span style="color:#f00">ç¼–ç </span>:
</span></span><span style="display:flex;"><span>    messageSource.setDefaultEncoding(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>    // <span style="color:#f00">æŒ‡å®šä¸»æ–‡ä»¶å</span>:
</span></span><span style="display:flex;"><span>    messageSource.setBasename(<span style="color:#0ff;font-weight:bold">&#34;messages&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> messageSource;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°<code>ResourceBundleMessageSource</code>ä¼šè‡ªåŠ¨æ ¹æ®ä¸»æ–‡ä»¶åè‡ªåŠ¨æŠŠæ‰€æœ‰ç›¸å…³è¯­è¨€çš„èµ„æºæ–‡ä»¶éƒ½è¯»è¿›æ¥ã€‚</p>
<p>å†æ³¨æ„åˆ°Springå®¹å™¨ä¼šåˆ›å»ºä¸åªä¸€ä¸ª<code>MessageSource</code>å®ä¾‹ï¼Œæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„è¿™ä¸ª<code>MessageSource</code>æ˜¯ä¸“é—¨ç»™é¡µé¢å›½é™…åŒ–ä½¿ç”¨çš„ï¼Œå› æ­¤å‘½åä¸º<code>i18n</code>ï¼Œä¸ä¼šä¸å…¶å®ƒ<code>MessageSource</code>å®ä¾‹å†²çªã€‚</p>
<h2 id="å®ç°å¤šè¯­è¨€">å®ç°å¤šè¯­è¨€<a hidden class="anchor" aria-hidden="true" href="#å®ç°å¤šè¯­è¨€">#</a></h2>
<p>è¦åœ¨Viewä¸­ä½¿ç”¨<code>MessageSource</code>åŠ ä¸Š<code>Locale</code>è¾“å‡ºå¤šè¯­è¨€ï¼Œæˆ‘ä»¬é€šè¿‡ç¼–å†™ä¸€ä¸ª<code>MvcInterceptor</code>ï¼ŒæŠŠç›¸å…³èµ„æºæ³¨å…¥åˆ°<code>ModelAndView</code>ä¸­ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>public class MvcInterceptor implements HandlerInterceptor {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    LocaleResolver localeResolver;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    // æ³¨æ„æ³¨å…¥çš„MessageSourceåç§°æ˜¯i18n:
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    @Qualifier(&#34;i18n&#34;)
</span></span><span style="display:flex;"><span>    MessageSource messageSource;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
</span></span><span style="display:flex;"><span>        if (modelAndView != null) {
</span></span><span style="display:flex;"><span>            // è§£æç”¨æˆ·çš„Locale:
</span></span><span style="display:flex;"><span>            Locale locale = localeResolver.resolveLocale(request);
</span></span><span style="display:flex;"><span>            // æ”¾å…¥Model:
</span></span><span style="display:flex;"><span>            modelAndView.addObject(&#34;__messageSource__&#34;, messageSource);
</span></span><span style="display:flex;"><span>            modelAndView.addObject(&#34;__locale__&#34;, locale);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸è¦å¿˜äº†åœ¨<code>WebMvcConfigurer</code>ä¸­æ³¨å†Œ<code>MvcInterceptor</code>ã€‚ç°åœ¨ï¼Œå°±å¯ä»¥åœ¨Viewä¸­è°ƒç”¨<code>MessageSource.getMessage()</code>æ–¹æ³•æ¥å®ç°å¤šè¯­è¨€ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;a href=&#34;/signin&#34;&gt;{{ __messageSource__.getMessage(&#39;signin&#39;, null, __locale__) }}&lt;/a&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°è¿™ç§å†™æ³•è™½ç„¶å¯è¡Œï¼Œä½†æ ¼å¼å¤ªå¤æ‚äº†ã€‚ä½¿ç”¨Viewæ—¶ï¼Œè¦æ ¹æ®æ¯ä¸ªç‰¹å®šçš„Viewå¼•æ“å®šåˆ¶å›½é™…åŒ–å‡½æ•°ã€‚åœ¨Pebbleä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªå›½é™…åŒ–å‡½æ•°ï¼Œåç§°å°±æ˜¯ä¸‹åˆ’çº¿<code>_</code>ï¼Œæ”¹é€ ä¸€ä¸‹åˆ›å»º<code>ViewResolver</code>çš„ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f00">@</span>Bean
</span></span><span style="display:flex;"><span>ViewResolver createViewResolver(<span style="color:#f00">@</span>Autowired ServletContext servletContext, <span style="color:#f00">@</span>Autowired <span style="color:#f00">@</span>Qualifier(<span style="color:#0ff;font-weight:bold">&#34;i18n&#34;</span>) MessageSource messageSource) {
</span></span><span style="display:flex;"><span>    PebbleEngine engine = new PebbleEngine.Builder()
</span></span><span style="display:flex;"><span>            .autoEscaping(true)
</span></span><span style="display:flex;"><span>            .cacheActive(false)
</span></span><span style="display:flex;"><span>            .loader(new ServletLoader(servletContext))
</span></span><span style="display:flex;"><span>            // <span style="color:#f00">æ·»åŠ æ‰©å±•</span>:
</span></span><span style="display:flex;"><span>            .extension(createExtension(messageSource))
</span></span><span style="display:flex;"><span>            .build();
</span></span><span style="display:flex;"><span>    PebbleViewResolver viewResolver = new PebbleViewResolver();
</span></span><span style="display:flex;"><span>    viewResolver.setPrefix(<span style="color:#0ff;font-weight:bold">&#34;/WEB-INF/templates/&#34;</span>);
</span></span><span style="display:flex;"><span>    viewResolver.setSuffix(<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>    viewResolver.setPebbleEngine(engine);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> viewResolver;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>private Extension createExtension(MessageSource messageSource) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> new AbstractExtension() {
</span></span><span style="display:flex;"><span>        <span style="color:#f00">@</span>Override
</span></span><span style="display:flex;"><span>        public Map&lt;String, Function&gt; getFunctions() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> Map.of(<span style="color:#0ff;font-weight:bold">&#34;_&#34;</span>, new Function() {
</span></span><span style="display:flex;"><span>                public Object execute(Map&lt;String, Object&gt; args, PebbleTemplate self, EvaluationContext context, int lineNumber) {
</span></span><span style="display:flex;"><span>                    String key = (String) args.get(<span style="color:#0ff;font-weight:bold">&#34;0&#34;</span>);
</span></span><span style="display:flex;"><span>                    List&lt;Object&gt; arguments = this.extractArguments(args);
</span></span><span style="display:flex;"><span>                    Locale locale = (Locale) context.getVariable(<span style="color:#0ff;font-weight:bold">&#34;__locale__&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">return</span> messageSource.getMessage(key, arguments.toArray(), <span style="color:#0ff;font-weight:bold">&#34;???&#34;</span> + key + <span style="color:#0ff;font-weight:bold">&#34;???&#34;</span>, locale);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                private List&lt;Object&gt; extractArguments(Map&lt;String, Object&gt; args) {
</span></span><span style="display:flex;"><span>                    int i = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>                    List&lt;Object&gt; arguments = new ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">while</span> (args.containsKey(String.valueOf(i))) {
</span></span><span style="display:flex;"><span>                        Object param = args.get(String.valueOf(i));
</span></span><span style="display:flex;"><span>                        arguments.add(param);
</span></span><span style="display:flex;"><span>                        i++;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">return</span> arguments;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                public List&lt;String&gt; getArgumentNames() {
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">return</span> null;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤šè¯­è¨€é¡µé¢æ”¹å†™ä¸ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;a href=&#34;/signin&#34;&gt;{{ _(&#39;signin&#39;) }}&lt;/a&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ˜¯å¸¦å‚æ•°çš„å¤šè¯­è¨€ï¼Œéœ€è¦æŠŠå‚æ•°ä¼ è¿›å»ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;h5&gt;{{ _(&#39;copyright&#39;, 2020) }}&lt;/h5&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨å…¶å®ƒViewå¼•æ“æ—¶ï¼Œä¹Ÿåº”å½“æ ¹æ®å¼•æ“æ¥å£å®ç°æ›´æ–¹ä¾¿çš„è¯­æ³•ã€‚</p>
<h2 id="åˆ‡æ¢locale">åˆ‡æ¢Locale<a hidden class="anchor" aria-hidden="true" href="#åˆ‡æ¢locale">#</a></h2>
<p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦å…è®¸ç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢<code>Locale</code>ï¼Œç¼–å†™ä¸€ä¸ª<code>LocaleController</code>æ¥å®ç°è¯¥åŠŸèƒ½ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span>public class LocaleController {
</span></span><span style="display:flex;"><span>    final Logger logger = LoggerFactory.getLogger(getClass());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    LocaleResolver localeResolver;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(&#34;/locale/{lo}&#34;)
</span></span><span style="display:flex;"><span>    public String setLocale(@PathVariable(&#34;lo&#34;) String lo, HttpServletRequest request, HttpServletResponse response) {
</span></span><span style="display:flex;"><span>        // æ ¹æ®ä¼ å…¥çš„loåˆ›å»ºLocaleå®ä¾‹:
</span></span><span style="display:flex;"><span>        Locale locale = null;
</span></span><span style="display:flex;"><span>        int pos = lo.indexOf(&#39;_&#39;);
</span></span><span style="display:flex;"><span>        if (pos &gt; 0) {
</span></span><span style="display:flex;"><span>            String lang = lo.substring(0, pos);
</span></span><span style="display:flex;"><span>            String country = lo.substring(pos + 1);
</span></span><span style="display:flex;"><span>            locale = new Locale(lang, country);
</span></span><span style="display:flex;"><span>        } else {
</span></span><span style="display:flex;"><span>            locale = new Locale(lo);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        // è®¾å®šæ­¤Locale:
</span></span><span style="display:flex;"><span>        localeResolver.setLocale(request, response, locale);
</span></span><span style="display:flex;"><span>        logger.info(&#34;locale is set to {}.&#34;, locale);
</span></span><span style="display:flex;"><span>        // åˆ·æ–°é¡µé¢:
</span></span><span style="display:flex;"><span>        String referer = request.getHeader(&#34;Referer&#34;);
</span></span><span style="display:flex;"><span>        return &#34;redirect:&#34; + (referer == null ? &#34;/&#34; : referer);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨é¡µé¢è®¾è®¡ä¸­ï¼Œé€šå¸¸åœ¨å³ä¸Šè§’ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªè¯­è¨€é€‰æ‹©åˆ—è¡¨ã€‚</p>
<h2 id="å°ç»“-3">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-3">#</a></h2>
<p>å¤šè¯­è¨€æ”¯æŒéœ€è¦ä»HTTPè¯·æ±‚ä¸­è§£æç”¨æˆ·çš„Localeï¼Œç„¶åé’ˆå¯¹ä¸åŒLocaleæ˜¾ç¤ºä¸åŒçš„è¯­è¨€ï¼›</p>
<p>Spring MVCåº”ç”¨ç¨‹åºé€šè¿‡<code>MessageSource</code>å’Œ<code>LocaleResolver</code>ï¼Œé…åˆViewå®ç°å›½é™…åŒ–ã€‚</p>
<h1 id="å¼‚æ­¥å¤„ç†">å¼‚æ­¥å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#å¼‚æ­¥å¤„ç†">#</a></h1>
<p>åœ¨Servletæ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç”±æŸä¸ªçº¿ç¨‹å¤„ç†ï¼Œç„¶åï¼Œå°†å“åº”å†™å…¥IOæµï¼Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚ä»å¼€å§‹å¤„ç†è¯·æ±‚ï¼Œåˆ°å†™å…¥å“åº”å®Œæˆï¼Œéƒ½æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­å¤„ç†çš„ã€‚</p>
<p>å®ç°Servletå®¹å™¨çš„æ—¶å€™ï¼Œåªè¦æ¯å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¤„ç†å®ƒï¼Œå°±èƒ½ä¿è¯æ­£ç¡®å®ç°äº†Servletçº¿ç¨‹æ¨¡å‹ã€‚åœ¨å®é™…äº§å“ä¸­ï¼Œä¾‹å¦‚Tomcatï¼Œæ€»æ˜¯é€šè¿‡çº¿ç¨‹æ± æ¥å¤„ç†è¯·æ±‚ï¼Œå®ƒä»ç„¶ç¬¦åˆä¸€ä¸ªè¯·æ±‚ä»å¤´åˆ°å°¾éƒ½ç”±æŸä¸€ä¸ªçº¿ç¨‹å¤„ç†ã€‚</p>
<p>è¿™ç§çº¿ç¨‹æ¨¡å‹éå¸¸é‡è¦ï¼Œå› ä¸ºSpringçš„JDBCäº‹åŠ¡æ˜¯åŸºäº<code>ThreadLocal</code>å®ç°çš„ï¼Œå¦‚æœåœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œä¸€ä¼šç”±çº¿ç¨‹Aå¤„ç†ï¼Œä¸€ä¼šåˆç”±çº¿ç¨‹Bå¤„ç†ï¼Œé‚£äº‹åŠ¡å°±å…¨ä¹±å¥—äº†ã€‚æ­¤å¤–ï¼Œå¾ˆå¤šå®‰å…¨è®¤è¯ï¼Œä¹Ÿæ˜¯åŸºäº<code>ThreadLocal</code>å®ç°çš„ï¼Œå¯ä»¥ä¿è¯åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œå„ä¸ªçº¿ç¨‹äº’ä¸å½±å“ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚å¤„ç†çš„æ—¶é—´è¾ƒé•¿ï¼Œä¾‹å¦‚å‡ ç§’é’Ÿç”šè‡³æ›´é•¿ï¼Œé‚£ä¹ˆï¼Œè¿™ç§åŸºäºçº¿ç¨‹æ± çš„åŒæ­¥æ¨¡å‹å¾ˆå¿«å°±ä¼šæŠŠæ‰€æœ‰çº¿ç¨‹è€—å°½ï¼Œå¯¼è‡´æœåŠ¡å™¨æ— æ³•å“åº”æ–°çš„è¯·æ±‚ã€‚å¦‚æœæŠŠé•¿æ—¶é—´å¤„ç†çš„è¯·æ±‚æ”¹ä¸ºå¼‚æ­¥å¤„ç†ï¼Œé‚£ä¹ˆçº¿ç¨‹æ± çš„åˆ©ç”¨ç‡å°±ä¼šå¤§å¤§æé«˜ã€‚Servletä»3.0è§„èŒƒå¼€å§‹æ·»åŠ äº†å¼‚æ­¥æ”¯æŒï¼Œå…è®¸å¯¹ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åœ¨Spring MVCä¸­å¦‚ä½•å®ç°å¯¹è¯·æ±‚è¿›è¡Œå¼‚æ­¥å¤„ç†çš„é€»è¾‘ã€‚é¦–å…ˆå»ºç«‹ä¸€ä¸ªWebå·¥ç¨‹ï¼Œç„¶åç¼–è¾‘<code>web.xml</code>æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>&lt;web-app xmlns=<span style="color:#0ff;font-weight:bold">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
</span></span><span style="display:flex;"><span>    xmlns:xsi=<span style="color:#0ff;font-weight:bold">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>    xsi:schemaLocation=<span style="color:#0ff;font-weight:bold">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span>
</span></span><span style="display:flex;"><span>    version=<span style="color:#0ff;font-weight:bold">&#34;3.1&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;servlet&gt;
</span></span><span style="display:flex;"><span>        &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
</span></span><span style="display:flex;"><span>        &lt;servlet-<span style="color:#fff;font-weight:bold">class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-<span style="color:#fff;font-weight:bold">class</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;init-param&gt;
</span></span><span style="display:flex;"><span>            &lt;param-name&gt;contextClass&lt;/param-name&gt;
</span></span><span style="display:flex;"><span>            &lt;param-value&gt;org.springframework.web.context.support.AnnotationConfigWebApplicationContext&lt;/param-value&gt;
</span></span><span style="display:flex;"><span>        &lt;/init-param&gt;
</span></span><span style="display:flex;"><span>        &lt;init-param&gt;
</span></span><span style="display:flex;"><span>            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
</span></span><span style="display:flex;"><span>            &lt;param-value&gt;com.itranswarp.learnjava.AppConfig&lt;/param-value&gt;
</span></span><span style="display:flex;"><span>        &lt;/init-param&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#fff;font-weight:bold">load</span>-on-startup&gt;<span style="color:#ff0;font-weight:bold">0</span>&lt;/<span style="color:#fff;font-weight:bold">load</span>-on-startup&gt;
</span></span><span style="display:flex;"><span>        &lt;async-supported&gt;true&lt;/async-supported&gt;
</span></span><span style="display:flex;"><span>    &lt;/servlet&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;servlet-mapping&gt;
</span></span><span style="display:flex;"><span>        &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
</span></span><span style="display:flex;"><span>        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</span></span><span style="display:flex;"><span>    &lt;/servlet-mapping&gt;
</span></span><span style="display:flex;"><span>&lt;/web-app&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å’Œå‰é¢æ™®é€šçš„MVCç¨‹åºç›¸æ¯”ï¼Œè¿™ä¸ª<code>web.xml</code>ä¸»è¦æœ‰å‡ ç‚¹ä¸åŒï¼š</p>
<ul>
<li>ä¸èƒ½å†ä½¿ç”¨<code>&lt;!DOCTYPE ...web-app_2_3.dtd&quot;&gt;</code>çš„DTDå£°æ˜ï¼Œå¿…é¡»ç”¨æ–°çš„æ”¯æŒServlet 3.1è§„èŒƒçš„XSDå£°æ˜ï¼Œç…§æŠ„å³å¯ï¼›</li>
<li>å¯¹<code>DispatcherServlet</code>çš„é…ç½®å¤šäº†ä¸€ä¸ª<code>&lt;async-supported&gt;</code>ï¼Œé»˜è®¤å€¼æ˜¯<code>false</code>ï¼Œå¿…é¡»æ˜ç¡®å†™æˆ<code>true</code>ï¼Œè¿™æ ·Servletå®¹å™¨æ‰ä¼šæ”¯æŒasyncå¤„ç†ã€‚</li>
</ul>
<p>ä¸‹ä¸€æ­¥å°±æ˜¯åœ¨Controllerä¸­ç¼–å†™asyncå¤„ç†é€»è¾‘ã€‚æˆ‘ä»¬ä»¥<code>ApiController</code>ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•å¼‚æ­¥å¤„ç†è¯·æ±‚ã€‚</p>
<p>ç¬¬ä¸€ç§asyncå¤„ç†æ–¹å¼æ˜¯è¿”å›ä¸€ä¸ª<code>Callable</code>ï¼ŒSpring MVCè‡ªåŠ¨æŠŠè¿”å›çš„<code>Callable</code>æ”¾å…¥çº¿ç¨‹æ± æ‰§è¡Œï¼Œç­‰å¾…ç»“æœè¿”å›åå†å†™å…¥å“åº”ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@GetMapping(&#34;/users&#34;)
</span></span><span style="display:flex;"><span>public Callable&lt;List&lt;User&gt;&gt; users() {
</span></span><span style="display:flex;"><span>    return () -&gt; {
</span></span><span style="display:flex;"><span>        // æ¨¡æ‹Ÿ3ç§’è€—æ—¶:
</span></span><span style="display:flex;"><span>        try {
</span></span><span style="display:flex;"><span>            Thread.sleep(3000);
</span></span><span style="display:flex;"><span>        } catch (InterruptedException e) {
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        return userService.getUsers();
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒç§asyncå¤„ç†æ–¹å¼æ˜¯è¿”å›ä¸€ä¸ª<code>DeferredResult</code>å¯¹è±¡ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè®¾ç½®æ­¤å¯¹è±¡çš„å€¼å¹¶å†™å…¥å“åº”ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@GetMapping(&#34;/users/{id}&#34;)
</span></span><span style="display:flex;"><span>public DeferredResult&lt;User&gt; user(@PathVariable(&#34;id&#34;) long id) {
</span></span><span style="display:flex;"><span>    DeferredResult&lt;User&gt; result = new DeferredResult&lt;&gt;(3000L); // 3ç§’è¶…æ—¶
</span></span><span style="display:flex;"><span>    new Thread(() -&gt; {
</span></span><span style="display:flex;"><span>        // ç­‰å¾…1ç§’:
</span></span><span style="display:flex;"><span>        try {
</span></span><span style="display:flex;"><span>            Thread.sleep(1000);
</span></span><span style="display:flex;"><span>        } catch (InterruptedException e) {
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        try {
</span></span><span style="display:flex;"><span>            User user = userService.getUserById(id);
</span></span><span style="display:flex;"><span>            // è®¾ç½®æ­£å¸¸ç»“æœå¹¶ç”±Spring MVCå†™å…¥Response:
</span></span><span style="display:flex;"><span>            result.setResult(user);
</span></span><span style="display:flex;"><span>        } catch (Exception e) {
</span></span><span style="display:flex;"><span>            // è®¾ç½®é”™è¯¯ç»“æœå¹¶ç”±Spring MVCå†™å…¥Response:
</span></span><span style="display:flex;"><span>            result.setErrorResult(Map.of(&#34;error&#34;, e.getClass().getSimpleName(), &#34;message&#34;, e.getMessage()));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }).start();
</span></span><span style="display:flex;"><span>    return result;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨<code>DeferredResult</code>æ—¶ï¼Œå¯ä»¥è®¾ç½®è¶…æ—¶ï¼Œè¶…æ—¶ä¼šè‡ªåŠ¨è¿”å›è¶…æ—¶é”™è¯¯å“åº”ã€‚åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œå¯ä»¥è°ƒç”¨<code>setResult()</code>å†™å…¥ç»“æœï¼Œä¹Ÿå¯ä»¥è°ƒç”¨<code>setErrorResult()</code>å†™å…¥ä¸€ä¸ªé”™è¯¯ç»“æœã€‚</p>
<p>è¿è¡Œç¨‹åºï¼Œå½“æˆ‘ä»¬è®¿é—®<code>http://localhost:8080/api/users/1</code>æ—¶ï¼Œå‡å®šç”¨æˆ·å­˜åœ¨ï¼Œåˆ™æµè§ˆå™¨åœ¨1ç§’åè¿”å›ç»“æœã€‚</p>
<p>è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„User IDï¼Œåˆ™ç­‰å¾…1ç§’åè¿”å›é”™è¯¯ç»“æœã€‚</p>
<h2 id="ä½¿ç”¨filter">ä½¿ç”¨Filter<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨filter">#</a></h2>
<p>å½“æˆ‘ä»¬ä½¿ç”¨asyncæ¨¡å¼å¤„ç†è¯·æ±‚æ—¶ï¼ŒåŸæœ‰çš„Filterä¹Ÿå¯ä»¥å·¥ä½œï¼Œä½†æˆ‘ä»¬å¿…é¡»åœ¨<code>web.xml</code>ä¸­æ·»åŠ <code>&lt;async-supported&gt;</code>å¹¶è®¾ç½®ä¸º<code>true</code>ã€‚æˆ‘ä»¬ç”¨ä¸¤ä¸ªFilterï¼šSyncFilterå’ŒAsyncFilteråˆ†åˆ«æµ‹è¯•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;web-app ...&gt;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    &lt;filter&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-name&gt;sync-filter&lt;/filter-name&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-class&gt;com.itranswarp.learnjava.web.SyncFilter&lt;/filter-class&gt;
</span></span><span style="display:flex;"><span>    &lt;/filter&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;filter&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-name&gt;async-filter&lt;/filter-name&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-class&gt;com.itranswarp.learnjava.web.AsyncFilter&lt;/filter-class&gt;
</span></span><span style="display:flex;"><span>        &lt;async-supported&gt;true&lt;/async-supported&gt;
</span></span><span style="display:flex;"><span>    &lt;/filter&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;filter-mapping&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-name&gt;sync-filter&lt;/filter-name&gt;
</span></span><span style="display:flex;"><span>        &lt;url-pattern&gt;/api/version&lt;/url-pattern&gt;
</span></span><span style="display:flex;"><span>    &lt;/filter-mapping&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;filter-mapping&gt;
</span></span><span style="display:flex;"><span>        &lt;filter-name&gt;async-filter&lt;/filter-name&gt;
</span></span><span style="display:flex;"><span>        &lt;url-pattern&gt;/api/*&lt;/url-pattern&gt;
</span></span><span style="display:flex;"><span>    &lt;/filter-mapping&gt;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>&lt;/web-app&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€ä¸ªå£°æ˜ä¸ºæ”¯æŒ<code>&lt;async-supported&gt;</code>çš„Filteræ—¢å¯ä»¥è¿‡æ»¤asyncå¤„ç†è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥è¿‡æ»¤æ­£å¸¸çš„åŒæ­¥å¤„ç†è¯·æ±‚ï¼Œè€Œæœªå£°æ˜<code>&lt;async-supported&gt;</code>çš„Filteræ— æ³•æ”¯æŒasyncè¯·æ±‚ï¼Œå¦‚æœä¸€ä¸ªæ™®é€šçš„Filteré‡åˆ°asyncè¯·æ±‚æ—¶ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼Œå› æ­¤ï¼ŒåŠ¡å¿…æ³¨æ„æ™®é€šFilterçš„<code>&lt;url-pattern&gt;</code>ä¸è¦åŒ¹é…asyncè¯·æ±‚è·¯å¾„ã€‚</p>
<p>åœ¨<code>logback.xml</code>é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æŠŠè¾“å‡ºæ ¼å¼åŠ ä¸Š<code>[%thread]</code>ï¼Œå¯ä»¥è¾“å‡ºå½“å‰çº¿ç¨‹çš„åç§°ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span style="display:flex;"><span>&lt;configuration&gt;
</span></span><span style="display:flex;"><span>    &lt;appender name=&#34;STDOUT&#34; class=&#34;ch.qos.logback.core.ConsoleAppender&#34;&gt;
</span></span><span style="display:flex;"><span>        &lt;layout class=&#34;ch.qos.logback.classic.PatternLayout&#34;&gt;
</span></span><span style="display:flex;"><span>            &lt;Pattern&gt;%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n&lt;/Pattern&gt;
</span></span><span style="display:flex;"><span>        &lt;/layout&gt;
</span></span><span style="display:flex;"><span>    &lt;/appender&gt;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>&lt;/configuration&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºåŒæ­¥è¯·æ±‚ï¼Œä¾‹å¦‚<code>/api/version</code>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>2020-05-16 11:22:40 [http-nio-8080-exec-1] INFO  c.i.learnjava.web.SyncFilter - start SyncFilter...
</span></span><span style="display:flex;"><span>2020-05-16 11:22:40 [http-nio-8080-exec-1] INFO  c.i.learnjava.web.AsyncFilter - start AsyncFilter...
</span></span><span style="display:flex;"><span>2020-05-16 11:22:40 [http-nio-8080-exec-1] INFO  c.i.learnjava.web.ApiController - get version...
</span></span><span style="display:flex;"><span>2020-05-16 11:22:40 [http-nio-8080-exec-1] INFO  c.i.learnjava.web.AsyncFilter - end AsyncFilter.
</span></span><span style="display:flex;"><span>2020-05-16 11:22:40 [http-nio-8080-exec-1] INFO  c.i.learnjava.web.SyncFilter - end SyncFilter.
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼Œæ¯ä¸ªFilterå’Œ<code>ApiController</code>éƒ½æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p>
<p>å¯¹äºå¼‚æ­¥è¯·æ±‚ï¼Œä¾‹å¦‚<code>/api/users</code>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>2020-05-16 11:23:49 [http-nio-8080-exec-4] INFO  c.i.learnjava.web.AsyncFilter - start AsyncFilter...
</span></span><span style="display:flex;"><span>2020-05-16 11:23:49 [http-nio-8080-exec-4] INFO  c.i.learnjava.web.ApiController - get users...
</span></span><span style="display:flex;"><span>2020-05-16 11:23:49 [http-nio-8080-exec-4] INFO  c.i.learnjava.web.AsyncFilter - end AsyncFilter.
</span></span><span style="display:flex;"><span>2020-05-16 11:23:52 [MvcAsync1] INFO  c.i.learnjava.web.ApiController - return users...
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼Œ<code>AsyncFilter</code>å’Œ<code>ApiController</code>æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ï¼Œä½†æ˜¯ï¼Œè¿”å›å“åº”çš„æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<p>å¯¹<code>DeferredResult</code>æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>2020-05-16 11:25:24 [http-nio-8080-exec-8] INFO  c.i.learnjava.web.AsyncFilter - start AsyncFilter...
</span></span><span style="display:flex;"><span>2020-05-16 11:25:24 [http-nio-8080-exec-8] INFO  c.i.learnjava.web.AsyncFilter - end AsyncFilter.
</span></span><span style="display:flex;"><span>2020-05-16 11:25:25 [Thread-2] INFO  c.i.learnjava.web.ApiController - deferred result is set.
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŒæ ·ï¼Œè¿”å›å“åº”çš„æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<p>åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œç»å¸¸ç”¨åˆ°çš„å°±æ˜¯<code>DeferredResult</code>ï¼Œå› ä¸ºè¿”å›<code>DeferredResult</code>æ—¶ï¼Œå¯ä»¥è®¾ç½®è¶…æ—¶ã€æ­£å¸¸ç»“æœå’Œé”™è¯¯ç»“æœï¼Œæ˜“äºç¼–å†™æ¯”è¾ƒçµæ´»çš„é€»è¾‘ã€‚</p>
<p>ä½¿ç”¨asyncå¼‚æ­¥å¤„ç†å“åº”æ—¶ï¼Œè¦æ—¶åˆ»ç‰¢è®°ï¼Œåœ¨å¦ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹ä¸­çš„äº‹åŠ¡å’ŒControlleræ–¹æ³•ä¸­æ‰§è¡Œçš„äº‹åŠ¡ä¸æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨Controllerä¸­ç»‘å®šçš„<code>ThreadLocal</code>ä¿¡æ¯ä¹Ÿæ— æ³•åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­è·å–ã€‚</p>
<p>æ­¤å¤–ï¼ŒServlet 3.0è§„èŒƒæ·»åŠ çš„å¼‚æ­¥æ”¯æŒæ˜¯é’ˆå¯¹åŒæ­¥æ¨¡å‹æ‰“äº†ä¸€ä¸ªâ€œè¡¥ä¸â€ï¼Œè™½ç„¶å¯ä»¥å¼‚æ­¥å¤„ç†è¯·æ±‚ï¼Œä½†é«˜å¹¶å‘å¼‚æ­¥è¯·æ±‚æ—¶ï¼Œå®ƒçš„å¤„ç†æ•ˆç‡å¹¶ä¸é«˜ï¼Œå› ä¸ºè¿™ç§å¼‚æ­¥æ¨¡å‹å¹¶æ²¡æœ‰ç”¨åˆ°çœŸæ­£çš„â€œåŸç”Ÿâ€å¼‚æ­¥ã€‚Javaæ ‡å‡†åº“æä¾›äº†å°è£…æ“ä½œç³»ç»Ÿçš„å¼‚æ­¥IOåŒ…<code>java.nio</code>ï¼Œæ˜¯çœŸæ­£çš„å¤šè·¯å¤ç”¨IOæ¨¡å‹ï¼Œå¯ä»¥ç”¨å°‘é‡çº¿ç¨‹æ”¯æŒå¤§é‡å¹¶å‘ã€‚ä½¿ç”¨NIOç¼–ç¨‹å¤æ‚åº¦æ¯”åŒæ­¥IOé«˜å¾ˆå¤šï¼Œå› æ­¤æˆ‘ä»¬å¾ˆå°‘ç›´æ¥ä½¿ç”¨NIOã€‚ç›¸åï¼Œå¤§éƒ¨åˆ†éœ€è¦é«˜æ€§èƒ½å¼‚æ­¥IOçš„åº”ç”¨ç¨‹åºä¼šé€‰æ‹©<a href="https://netty.io/">Netty</a>è¿™æ ·çš„æ¡†æ¶ï¼Œå®ƒåŸºäºNIOæä¾›äº†æ›´æ˜“äºä½¿ç”¨çš„APIï¼Œæ–¹ä¾¿å¼€å‘å¼‚æ­¥åº”ç”¨ç¨‹åºã€‚</p>
<h2 id="å°ç»“-4">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-4">#</a></h2>
<p>åœ¨Spring MVCä¸­å¼‚æ­¥å¤„ç†è¯·æ±‚éœ€è¦æ­£ç¡®é…ç½®<code>web.xml</code>ï¼Œå¹¶è¿”å›<code>Callable</code>æˆ–<code>DeferredResult</code>å¯¹è±¡ã€‚</p>
<h1 id="ä½¿ç”¨websocket">ä½¿ç”¨WebSocket<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨websocket">#</a></h1>
<p>WebSocketæ˜¯ä¸€ç§åŸºäºHTTPçš„é•¿é“¾æ¥æŠ€æœ¯ã€‚ä¼ ç»Ÿçš„HTTPåè®®æ˜¯ä¸€ç§è¯·æ±‚-å“åº”æ¨¡å‹ï¼Œå¦‚æœæµè§ˆå™¨ä¸å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆæœåŠ¡å™¨æ— æ³•ä¸»åŠ¨ç»™æµè§ˆå™¨æ¨é€æ•°æ®ã€‚å¦‚æœéœ€è¦å®šæœŸç»™æµè§ˆå™¨æ¨é€æ•°æ®ï¼Œä¾‹å¦‚è‚¡ç¥¨è¡Œæƒ…ï¼Œæˆ–è€…ä¸å®šæœŸç»™æµè§ˆå™¨æ¨é€æ•°æ®ï¼Œä¾‹å¦‚åœ¨çº¿èŠå¤©ï¼ŒåŸºäºHTTPåè®®å®ç°è¿™ç±»éœ€æ±‚ï¼Œåªèƒ½ä¾é æµè§ˆå™¨çš„JavaScriptå®šæ—¶è½®è¯¢ï¼Œæ•ˆç‡å¾ˆä½ä¸”å®æ—¶æ€§ä¸é«˜ã€‚</p>
<p>å› ä¸ºHTTPæœ¬èº«æ˜¯åŸºäºTCPè¿æ¥çš„ï¼Œæ‰€ä»¥ï¼ŒWebSocketåœ¨HTTPåè®®çš„åŸºç¡€ä¸Šåšäº†ä¸€ä¸ªç®€å•çš„å‡çº§ï¼Œå³å»ºç«‹TCPè¿æ¥åï¼Œæµè§ˆå™¨å‘é€è¯·æ±‚æ—¶ï¼Œé™„å¸¦å‡ ä¸ªå¤´ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>GET /chat HTTP/1.1
</span></span><span style="display:flex;"><span>Host: www.example.com
</span></span><span style="display:flex;"><span>Upgrade: websocket
</span></span><span style="display:flex;"><span>Connection: Upgrade
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°±è¡¨ç¤ºå®¢æˆ·ç«¯å¸Œæœ›å‡çº§è¿æ¥ï¼Œå˜æˆé•¿è¿æ¥çš„WebSocketï¼ŒæœåŠ¡å™¨è¿”å›å‡çº§æˆåŠŸçš„å“åº”ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>HTTP/1.1 101 Switching Protocols
</span></span><span style="display:flex;"><span>Upgrade: websocket
</span></span><span style="display:flex;"><span>Connection: Upgrade
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ”¶åˆ°æˆåŠŸå“åº”åè¡¨ç¤ºWebSocketâ€œæ¡æ‰‹â€æˆåŠŸï¼Œè¿™æ ·ï¼Œä»£è¡¨WebSocketçš„è¿™ä¸ªTCPè¿æ¥å°†ä¸ä¼šè¢«æœåŠ¡å™¨å…³é—­ï¼Œè€Œæ˜¯ä¸€ç›´ä¿æŒï¼ŒæœåŠ¡å™¨å¯éšæ—¶å‘æµè§ˆå™¨æ¨é€æ¶ˆæ¯ï¼Œæµè§ˆå™¨ä¹Ÿå¯éšæ—¶å‘æœåŠ¡å™¨æ¨é€æ¶ˆæ¯ã€‚åŒæ–¹æ¨é€çš„æ¶ˆæ¯æ—¢å¯ä»¥æ˜¯æ–‡æœ¬æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒè¿›åˆ¶æ¶ˆæ¯ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç»å¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºä¼šæ¨é€åŸºäºJSONçš„æ–‡æœ¬æ¶ˆæ¯ã€‚</p>
<p>ç°ä»£æµè§ˆå™¨éƒ½å·²ç»æ”¯æŒWebSocketåè®®ï¼ŒæœåŠ¡å™¨åˆ™éœ€è¦åº•å±‚æ¡†æ¶æ”¯æŒã€‚Javaçš„Servletè§„èŒƒä»3.1å¼€å§‹æ”¯æŒWebSocketï¼Œæ‰€ä»¥ï¼Œå¿…é¡»é€‰æ‹©æ”¯æŒServlet 3.1æˆ–æ›´é«˜è§„èŒƒçš„Servletå®¹å™¨ï¼Œæ‰èƒ½æ”¯æŒWebSocketã€‚æœ€æ–°ç‰ˆæœ¬çš„Tomcatã€Jettyç­‰å¼€æºæœåŠ¡å™¨å‡æ”¯æŒWebSocketã€‚</p>
<p>æˆ‘ä»¬ä»¥å®é™…ä»£ç æ¼”ç¤ºå¦‚ä½•åœ¨Spring MVCä¸­å®ç°å¯¹WebSocketçš„æ”¯æŒã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>pom.xml</code>ä¸­åŠ å…¥ä»¥ä¸‹ä¾èµ–ï¼š</p>
<ul>
<li>org.apache.tomcat.embed:tomcat-embed-websocket:9.0.26</li>
<li>org.springframework:spring-websocket:5.2.0.RELEASE</li>
</ul>
<p>ç¬¬ä¸€é¡¹æ˜¯åµŒå…¥å¼Tomcatæ”¯æŒWebSocketçš„ç»„ä»¶ï¼Œç¬¬äºŒé¡¹æ˜¯Springå°è£…çš„æ”¯æŒWebSocketçš„æ¥å£ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨AppConfigä¸­åŠ å…¥Spring Webå¯¹WebSocketçš„é…ç½®ï¼Œæ­¤å¤„æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<code>WebSocketConfigurer</code>å®ä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>WebSocketConfigurer createWebSocketConfigurer(
</span></span><span style="display:flex;"><span>        @Autowired ChatHandler chatHandler,
</span></span><span style="display:flex;"><span>        @Autowired ChatHandshakeInterceptor chatInterceptor)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    return new WebSocketConfigurer() {
</span></span><span style="display:flex;"><span>        public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
</span></span><span style="display:flex;"><span>            // æŠŠURLä¸æŒ‡å®šçš„WebSocketHandlerå…³è”ï¼Œå¯å…³è”å¤šä¸ª:
</span></span><span style="display:flex;"><span>            registry.addHandler(chatHandler, &#34;/chat&#34;).addInterceptors(chatInterceptor);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤å®ä¾‹åœ¨å†…éƒ¨é€šè¿‡<code>WebSocketHandlerRegistry</code>æ³¨å†Œèƒ½å¤„ç†WebSocketçš„<code>WebSocketHandler</code>ï¼Œä»¥åŠå¯é€‰çš„WebSocketæ‹¦æˆªå™¨<code>HandshakeInterceptor</code>ã€‚æˆ‘ä»¬æ³¨å…¥çš„è¿™ä¸¤ä¸ªç±»éƒ½æ˜¯è‡ªå·±ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ï¼Œåé¢æˆ‘ä»¬è¯¦ç»†è®¨è®ºå¦‚ä½•ç¼–å†™å®ƒä»¬ï¼Œè¿™é‡Œåªéœ€å…³æ³¨æµè§ˆå™¨è¿æ¥åˆ°WebSocketçš„URLæ˜¯<code>/chat</code>ã€‚</p>
<h2 id="å¤„ç†websocketè¿æ¥">å¤„ç†WebSocketè¿æ¥<a hidden class="anchor" aria-hidden="true" href="#å¤„ç†websocketè¿æ¥">#</a></h2>
<p>å’Œå¤„ç†æ™®é€šHTTPè¯·æ±‚ä¸åŒï¼Œæ²¡æ³•ç”¨ä¸€ä¸ªæ–¹æ³•å¤„ç†ä¸€ä¸ªURLã€‚Springæä¾›äº†<code>TextWebSocketHandler</code>å’Œ<code>BinaryWebSocketHandler</code>åˆ†åˆ«å¤„ç†æ–‡æœ¬æ¶ˆæ¯å’ŒäºŒè¿›åˆ¶æ¶ˆæ¯ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©æ–‡æœ¬æ¶ˆæ¯ä½œä¸ºèŠå¤©å®¤çš„åè®®ï¼Œå› æ­¤ï¼Œ<code>ChatHandler</code>éœ€è¦ç»§æ‰¿è‡ª<code>TextWebSocketHandler</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f00">@</span>Component
</span></span><span style="display:flex;"><span>public <span style="color:#fff;font-weight:bold">class</span> ChatHandler <span style="color:#fff;font-weight:bold">extends</span> TextWebSocketHandler {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªWebSocketè¿æ¥åï¼Œå¦‚æœæˆåŠŸå»ºç«‹è¿æ¥ï¼ŒSpringä¼šè‡ªåŠ¨è°ƒç”¨<code>afterConnectionEstablished()</code>æ–¹æ³•ï¼Œä»»ä½•åŸå› å¯¼è‡´WebSocketè¿æ¥ä¸­æ–­æ—¶ï¼ŒSpringä¼šè‡ªåŠ¨è°ƒç”¨<code>afterConnectionClosed</code>æ–¹æ³•ï¼Œå› æ­¤ï¼Œè¦†å†™è¿™ä¸¤ä¸ªæ–¹æ³•å³å¯å¤„ç†è¿æ¥æˆåŠŸå’Œç»“æŸåçš„ä¸šåŠ¡é€»è¾‘ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f00">@</span>Component
</span></span><span style="display:flex;"><span>public <span style="color:#fff;font-weight:bold">class</span> ChatHandler <span style="color:#fff;font-weight:bold">extends</span> TextWebSocketHandler {
</span></span><span style="display:flex;"><span>    // <span style="color:#f00">ä¿å­˜æ‰€æœ‰</span>Clientçš„WebSocketä¼šè¯å®ä¾‹:
</span></span><span style="display:flex;"><span>    private Map&lt;String, WebSocketSession&gt; clients = new ConcurrentHashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f00">@</span>Override
</span></span><span style="display:flex;"><span>    public void afterConnectionEstablished(WebSocketSession session) throws Exception {
</span></span><span style="display:flex;"><span>        // <span style="color:#f00">æ–°ä¼šè¯æ ¹æ®</span>IDæ”¾å…¥Map:
</span></span><span style="display:flex;"><span>        clients.put(session.getId(), session);
</span></span><span style="display:flex;"><span>        session.getAttributes().put(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Guest1&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f00">@</span>Override
</span></span><span style="display:flex;"><span>    public void afterConnectionClosed(WebSocketSession session, CloseStatus status) throws Exception {
</span></span><span style="display:flex;"><span>        clients.remove(session.getId());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¯ä¸ªWebSocketä¼šè¯ä»¥<code>WebSocketSession</code>è¡¨ç¤ºï¼Œä¸”å·²åˆ†é…å”¯ä¸€IDã€‚å’ŒWebSocketç›¸å…³çš„æ•°æ®ï¼Œä¾‹å¦‚ç”¨æˆ·åç§°ç­‰ï¼Œå‡å¯æ”¾å…¥å…³è”çš„<code>getAttributes()</code>ä¸­ã€‚</p>
<p>ç”¨å®ä¾‹å˜é‡<code>clients</code>æŒæœ‰å½“å‰æ‰€æœ‰çš„<code>WebSocketSession</code>æ˜¯ä¸ºäº†å¹¿æ’­ï¼Œå³å‘æ‰€æœ‰ç”¨æˆ·æ¨é€åŒä¸€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>String json = ...
</span></span><span style="display:flex;"><span>TextMessage message = new TextMessage(json);
</span></span><span style="display:flex;"><span>for (String id : clients.keySet()) {
</span></span><span style="display:flex;"><span>    WebSocketSession session = clients.get(id);
</span></span><span style="display:flex;"><span>    session.sendMessage(message);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å‘é€çš„æ¶ˆæ¯æ˜¯åºåˆ—åŒ–åçš„JSONï¼Œå¯ä»¥ç”¨ChatMessageè¡¨ç¤ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>public class ChatMessage {
</span></span><span style="display:flex;"><span>	public long timestamp;
</span></span><span style="display:flex;"><span>	public String name;
</span></span><span style="display:flex;"><span>    public String text;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¯æ”¶åˆ°ä¸€ä¸ªç”¨æˆ·çš„æ¶ˆæ¯åï¼Œæˆ‘ä»¬å°±éœ€è¦å¹¿æ’­ç»™æ‰€æœ‰ç”¨æˆ·ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f00">@</span>Component
</span></span><span style="display:flex;"><span>public <span style="color:#fff;font-weight:bold">class</span> ChatHandler <span style="color:#fff;font-weight:bold">extends</span> TextWebSocketHandler {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#f00">@</span>Override
</span></span><span style="display:flex;"><span>    protected void handleTextMessage(WebSocketSession session, TextMessage message) throws Exception {
</span></span><span style="display:flex;"><span>        String s = message.getPayload();
</span></span><span style="display:flex;"><span>        String r = ... // <span style="color:#f00">æ ¹æ®è¾“å…¥æ¶ˆæ¯æ„é€ å¾…å‘é€æ¶ˆæ¯</span>
</span></span><span style="display:flex;"><span>        broadcastMessage(r); // <span style="color:#f00">æ¨é€ç»™æ‰€æœ‰ç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¦æ¨é€ç»™æŒ‡å®šçš„å‡ ä¸ªç”¨æˆ·ï¼Œé‚£å°±éœ€è¦åœ¨<code>clients</code>ä¸­æ ¹æ®æ¡ä»¶æŸ¥æ‰¾å‡ºæŸäº›<code>WebSocketSession</code>ï¼Œç„¶åå‘é€æ¶ˆæ¯ã€‚</p>
<p>æ³¨æ„åˆ°æˆ‘ä»¬åœ¨æ³¨å†ŒWebSocketæ—¶è¿˜ä¼ å…¥äº†ä¸€ä¸ª<code>ChatHandshakeInterceptor</code>ï¼Œè¿™ä¸ªç±»å®é™…ä¸Šå¯ä»¥ä»<code>HttpSessionHandshakeInterceptor</code>ç»§æ‰¿ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯åœ¨WebSocketå»ºç«‹è¿æ¥åï¼ŒæŠŠHttpSessionçš„ä¸€äº›å±æ€§å¤åˆ¶åˆ°WebSocketSessionï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ç­‰ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f00">@</span>Component
</span></span><span style="display:flex;"><span>public <span style="color:#fff;font-weight:bold">class</span> ChatHandshakeInterceptor <span style="color:#fff;font-weight:bold">extends</span> HttpSessionHandshakeInterceptor {
</span></span><span style="display:flex;"><span>    public ChatHandshakeInterceptor() {
</span></span><span style="display:flex;"><span>        // <span style="color:#f00">æŒ‡å®šä»</span>HttpSessionå¤åˆ¶å±æ€§åˆ°WebSocketSession:
</span></span><span style="display:flex;"><span>        super(List.of(UserController.KEY_USER));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œåœ¨<code>ChatHandler</code>ä¸­ï¼Œå¯ä»¥ä»<code>WebSocketSession.getAttributes()</code>ä¸­è·å–åˆ°å¤åˆ¶è¿‡æ¥çš„å±æ€§ã€‚</p>
<h2 id="å®¢æˆ·ç«¯å¼€å‘">å®¢æˆ·ç«¯å¼€å‘<a hidden class="anchor" aria-hidden="true" href="#å®¢æˆ·ç«¯å¼€å‘">#</a></h2>
<p>åœ¨å®Œæˆäº†æœåŠ¡å™¨ç«¯çš„å¼€å‘åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨é¡µé¢ç¼–å†™ä¸€ç‚¹JavaScripté€»è¾‘ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>// <span style="color:#f00">åˆ›å»º</span>WebSocketè¿æ¥:
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">var</span> ws = new WebSocket(<span style="color:#0ff;font-weight:bold">&#39;ws://&#39;</span> + location.host + <span style="color:#0ff;font-weight:bold">&#39;/chat&#39;</span>);
</span></span><span style="display:flex;"><span>// <span style="color:#f00">è¿æ¥æˆåŠŸæ—¶</span>:
</span></span><span style="display:flex;"><span>ws.addEventListener(<span style="color:#0ff;font-weight:bold">&#39;open&#39;</span>, function (event) {
</span></span><span style="display:flex;"><span>    console.log(<span style="color:#0ff;font-weight:bold">&#39;websocket connected.&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>// <span style="color:#f00">æ”¶åˆ°æ¶ˆæ¯æ—¶</span>:
</span></span><span style="display:flex;"><span>ws.addEventListener(<span style="color:#0ff;font-weight:bold">&#39;message&#39;</span>, function (event) {
</span></span><span style="display:flex;"><span>    console.log(<span style="color:#0ff;font-weight:bold">&#39;message: &#39;</span> + event.data);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">var</span> msgs = JSON.parse(event.data);
</span></span><span style="display:flex;"><span>    // TODO:
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>// <span style="color:#f00">è¿æ¥å…³é—­æ—¶</span>:
</span></span><span style="display:flex;"><span>ws.addEventListener(<span style="color:#0ff;font-weight:bold">&#39;close&#39;</span>, function () {
</span></span><span style="display:flex;"><span>    console.log(<span style="color:#0ff;font-weight:bold">&#39;websocket closed.&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>// <span style="color:#f00">ç»‘å®šåˆ°å…¨å±€å˜é‡</span>:
</span></span><span style="display:flex;"><span>window.chatWs = ws;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨æˆ·å¯ä»¥åœ¨è¿æ¥æˆåŠŸåä»»ä½•æ—¶å€™ç»™æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">var</span> inputText = <span style="color:#0ff;font-weight:bold">&#39;Hello, WebSocket.&#39;</span>;
</span></span><span style="display:flex;"><span>window.chatWs.send(JSON.stringify({text: inputText}));
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œè¿è°ƒæµè§ˆå™¨å’ŒæœåŠ¡å™¨ç«¯ï¼Œå¦‚æœä¸€åˆ‡æ— è¯¯ï¼Œå¯ä»¥å¼€å¤šä¸ªä¸åŒçš„æµè§ˆå™¨æµ‹è¯•WebSocketçš„æ¨é€å’Œå¹¿æ’­ã€‚</p>
<p>å’Œä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»çš„å¼‚æ­¥å¤„ç†ç±»ä¼¼ï¼ŒServletçš„çº¿ç¨‹æ¨¡å‹å¹¶ä¸é€‚åˆå¤§è§„æ¨¡çš„é•¿é“¾æ¥ã€‚åŸºäºNIOçš„Nettyç­‰æ¡†æ¶æ›´é€‚åˆå¤„ç†WebSocketé•¿é“¾æ¥ï¼Œæˆ‘ä»¬å°†åœ¨åé¢ä»‹ç»ã€‚</p>
<h2 id="å°ç»“-5">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“-5">#</a></h2>
<p>åœ¨Servletä¸­ä½¿ç”¨WebSocketéœ€è¦3.1åŠä»¥ä¸Šç‰ˆæœ¬ï¼›</p>
<p>é€šè¿‡<code>spring-websocket</code>å¯ä»¥ç®€åŒ–WebSocketçš„å¼€å‘ã€‚</p>
<h1 id="é›†æˆjavamail">é›†æˆJavaMail<a hidden class="anchor" aria-hidden="true" href="#é›†æˆjavamail">#</a></h1>
<p>æˆ‘ä»¬åœ¨<a href="https://liaoxuefeng.com/books/java/network/send-email/index.html">å‘é€Email</a>å’Œ<a href="https://liaoxuefeng.com/books/java/network/receive-email/index.html">æ¥æ”¶Email</a>ä¸­å·²ç»ä»‹ç»äº†å¦‚ä½•é€šè¿‡JavaMailæ¥æ”¶å‘ç”µå­é‚®ä»¶ã€‚åœ¨Springä¸­ï¼ŒåŒæ ·å¯ä»¥é›†æˆJavaMailã€‚</p>
<p>å› ä¸ºåœ¨æœåŠ¡å™¨ç«¯ï¼Œä¸»è¦ä»¥å‘é€é‚®ä»¶ä¸ºä¸»ï¼Œä¾‹å¦‚åœ¨æ³¨å†ŒæˆåŠŸã€ç™»å½•æ—¶ã€è´­ç‰©ä»˜æ¬¾åé€šçŸ¥ç”¨æˆ·ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šé‡åˆ°æ¥æ”¶ç”¨æˆ·é‚®ä»¶çš„æƒ…å†µï¼Œæ‰€ä»¥æœ¬èŠ‚æˆ‘ä»¬åªè®¨è®ºå¦‚ä½•åœ¨Springä¸­å‘é€é‚®ä»¶ã€‚</p>
<p>åœ¨Springä¸­ï¼Œå‘é€é‚®ä»¶æœ€ç»ˆä¹Ÿæ˜¯éœ€è¦JavaMailï¼ŒSpringåªå¯¹JavaMailåšäº†ä¸€ç‚¹ç®€å•çš„å°è£…ï¼Œç›®çš„æ˜¯ç®€åŒ–ä»£ç ã€‚ä¸ºäº†åœ¨Springä¸­é›†æˆJavaMailï¼Œæˆ‘ä»¬åœ¨<code>pom.xml</code>ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p>
<ul>
<li>org.springframework:spring-context-support:6.0.0</li>
<li>jakarta.mail:jakarta.mail-api:2.0.1</li>
<li>com.sun.mail:jakarta.mail:2.0.1</li>
</ul>
<p>ä»¥åŠå…¶ä»–Webç›¸å…³ä¾èµ–ã€‚</p>
<p>æˆ‘ä»¬å¸Œæœ›ç”¨æˆ·åœ¨æ³¨å†ŒæˆåŠŸåèƒ½æ”¶åˆ°æ³¨å†Œé‚®ä»¶ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ª<code>JavaMailSender</code>çš„Beanï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>JavaMailSender createJavaMailSender(
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// smtp.properties:</span>
</span></span><span style="display:flex;"><span>        @Value(<span style="color:#0ff;font-weight:bold">&#34;${smtp.host}&#34;</span>) String host,
</span></span><span style="display:flex;"><span>        @Value(<span style="color:#0ff;font-weight:bold">&#34;${smtp.port}&#34;</span>) <span style="color:#fff;font-weight:bold">int</span> port,
</span></span><span style="display:flex;"><span>        @Value(<span style="color:#0ff;font-weight:bold">&#34;${smtp.auth}&#34;</span>) String auth,
</span></span><span style="display:flex;"><span>        @Value(<span style="color:#0ff;font-weight:bold">&#34;${smtp.username}&#34;</span>) String username,
</span></span><span style="display:flex;"><span>        @Value(<span style="color:#0ff;font-weight:bold">&#34;${smtp.password}&#34;</span>) String password,
</span></span><span style="display:flex;"><span>        @Value(<span style="color:#0ff;font-weight:bold">&#34;${smtp.debug:true}&#34;</span>) String debug)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">var</span> mailSender = <span style="color:#fff;font-weight:bold">new</span> JavaMailSenderImpl();
</span></span><span style="display:flex;"><span>    mailSender.<span style="color:#007f7f">setHost</span>(host);
</span></span><span style="display:flex;"><span>    mailSender.<span style="color:#007f7f">setPort</span>(port);
</span></span><span style="display:flex;"><span>    mailSender.<span style="color:#007f7f">setUsername</span>(username);
</span></span><span style="display:flex;"><span>    mailSender.<span style="color:#007f7f">setPassword</span>(password);
</span></span><span style="display:flex;"><span>    Properties props = mailSender.<span style="color:#007f7f">getJavaMailProperties</span>();
</span></span><span style="display:flex;"><span>    props.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;mail.transport.protocol&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;smtp&#34;</span>);
</span></span><span style="display:flex;"><span>    props.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;mail.smtp.auth&#34;</span>, auth);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (port == 587) {
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;mail.smtp.starttls.enable&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (port == 465) {
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;mail.smtp.socketFactory.port&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;465&#34;</span>);
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;mail.smtp.socketFactory.class&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;javax.net.ssl.SSLSocketFactory&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    props.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;mail.debug&#34;</span>, debug);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> mailSender;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ª<code>JavaMailSender</code>æ¥å£çš„å®ç°ç±»æ˜¯<code>JavaMailSenderImpl</code>ï¼Œåˆå§‹åŒ–æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¸JavaMailæ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</p>
<p>å¦å¤–æ³¨æ„åˆ°éœ€è¦æ³¨å…¥çš„å±æ€§æ˜¯ä»<code>smtp.properties</code>ä¸­è¯»å–çš„ï¼Œå› æ­¤ï¼Œ<code>AppConfig</code>å¯¼å…¥çš„å°±ä¸æ­¢ä¸€ä¸ª<code>.properties</code>æ–‡ä»¶ï¼Œå¯ä»¥å¯¼å…¥å¤šä¸ªï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableWebMvc
</span></span><span style="display:flex;"><span>@EnableTransactionManagement
</span></span><span style="display:flex;"><span>@PropertySource({ <span style="color:#0ff;font-weight:bold">&#34;classpath:/jdbc.properties&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;classpath:/smtp.properties&#34;</span> })
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹ä¸€æ­¥æ˜¯å°è£…ä¸€ä¸ª<code>MailService</code>ï¼Œå¹¶å®šä¹‰<code>sendRegistrationMail()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MailService {
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${smtp.from}&#34;</span>)
</span></span><span style="display:flex;"><span>    String from;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    JavaMailSender mailSender;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> sendRegistrationMail(User user) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            MimeMessage mimeMessage = mailSender.<span style="color:#007f7f">createMimeMessage</span>();
</span></span><span style="display:flex;"><span>            MimeMessageHelper helper = <span style="color:#fff;font-weight:bold">new</span> MimeMessageHelper(mimeMessage, <span style="color:#0ff;font-weight:bold">&#34;utf-8&#34;</span>);
</span></span><span style="display:flex;"><span>            helper.<span style="color:#007f7f">setFrom</span>(from);
</span></span><span style="display:flex;"><span>            helper.<span style="color:#007f7f">setTo</span>(user.<span style="color:#007f7f">getEmail</span>());
</span></span><span style="display:flex;"><span>            helper.<span style="color:#007f7f">setSubject</span>(<span style="color:#0ff;font-weight:bold">&#34;Welcome to Java course!&#34;</span>);
</span></span><span style="display:flex;"><span>            String html = String.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;&lt;p&gt;Hi, %s,&lt;/p&gt;&lt;p&gt;Welcome to Java course!&lt;/p&gt;&lt;p&gt;Sent at %s&lt;/p&gt;&#34;</span>, user.<span style="color:#007f7f">getName</span>(), LocalDateTime.<span style="color:#007f7f">now</span>());
</span></span><span style="display:flex;"><span>            helper.<span style="color:#007f7f">setText</span>(html, <span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>            mailSender.<span style="color:#007f7f">send</span>(mimeMessage);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (MessagingException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§‚å¯Ÿä¸Šè¿°ä»£ç ï¼Œ<code>MimeMessage</code>æ˜¯JavaMailçš„é‚®ä»¶å¯¹è±¡ï¼Œè€Œ<code>MimeMessageHelper</code>æ˜¯Springæä¾›çš„ç”¨äºç®€åŒ–è®¾ç½®MimeMessageçš„ç±»ï¼Œæ¯”å¦‚æˆ‘ä»¬è®¾ç½®HTMLé‚®ä»¶å°±å¯ä»¥ç›´æ¥è°ƒç”¨<code>setText(String text, boolean html)</code>æ–¹æ³•ï¼Œè€Œä¸å¿…å†è°ƒç”¨æ¯”è¾ƒç¹ççš„JavaMailæ¥å£æ–¹æ³•ã€‚</p>
<p>æœ€åä¸€æ­¥æ˜¯è°ƒç”¨<code>JavaMailSender.send()</code>æ–¹æ³•æŠŠé‚®ä»¶å‘é€å‡ºå»ã€‚</p>
<p>åœ¨MVCçš„æŸä¸ªControlleræ–¹æ³•ä¸­ï¼Œå½“ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹æ¥å¼‚æ­¥å‘é€é‚®ä»¶ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>User user = userService.<span style="color:#007f7f">register</span>(email, password, name);
</span></span><span style="display:flex;"><span>logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;user registered: {}&#34;</span>, user.<span style="color:#007f7f">getEmail</span>());
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// send registration mail:</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">new</span> Thread(() -&gt; {
</span></span><span style="display:flex;"><span>    mailService.<span style="color:#007f7f">sendRegistrationMail</span>(user);
</span></span><span style="display:flex;"><span>}).<span style="color:#007f7f">start</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºå‘é€é‚®ä»¶æ˜¯ä¸€ç§è€—æ—¶çš„ä»»åŠ¡ï¼Œä»å‡ ç§’åˆ°å‡ åˆ†é’Ÿä¸ç­‰ï¼Œå› æ­¤ï¼Œå¼‚æ­¥å‘é€æ˜¯ä¿è¯é¡µé¢èƒ½å¿«é€Ÿæ˜¾ç¤ºçš„å¿…è¦æªæ–½ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥å¯åŠ¨äº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œä½†å®é™…ä¸Šè¿˜æœ‰æ›´ä¼˜åŒ–çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚è®¨è®ºã€‚</p>
<p><strong>å°ç»“</strong></p>
<p>Springå¯ä»¥é›†æˆJavaMailï¼Œé€šè¿‡ç®€å•çš„å°è£…ï¼Œèƒ½ç®€åŒ–é‚®ä»¶å‘é€ä»£ç ã€‚å…¶æ ¸å¿ƒæ˜¯å®šä¹‰ä¸€ä¸ª<code>JavaMailSender</code>çš„Beanï¼Œç„¶åè°ƒç”¨å…¶<code>send()</code>æ–¹æ³•ã€‚</p>
<h1 id="é›†æˆjms">é›†æˆJMS<a hidden class="anchor" aria-hidden="true" href="#é›†æˆjms">#</a></h1>
<p>JMSå³Java Message Serviceï¼Œæ˜¯JavaEEçš„æ¶ˆæ¯æœåŠ¡æ¥å£ã€‚JMSä¸»è¦æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼š1.1å’Œ2.0ã€‚2.0å’Œ1.1ç›¸æ¯”ï¼Œä¸»è¦æ˜¯ç®€åŒ–äº†æ”¶å‘æ¶ˆæ¯çš„ä»£ç ã€‚</p>
<p>æ‰€è°“æ¶ˆæ¯æœåŠ¡ï¼Œå°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´ï¼Œé€šè¿‡æ¶ˆæ¯æœåŠ¡å™¨ä¼ é€’æ¶ˆæ¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚Producerâ”‚â”€â”€â”€â–¶â”‚Message Serverâ”‚â”€â”€â”€â–¶â”‚Consumerâ”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ¶ˆæ¯æœåŠ¡ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨å¯¹æ–¹çš„APIï¼Œå®ƒçš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li>åŒæ–¹å„è‡ªæ— éœ€çŸ¥æ™“å¯¹æ–¹çš„å­˜åœ¨ï¼Œæ¶ˆæ¯å¯ä»¥å¼‚æ­¥å¤„ç†ï¼Œå› ä¸ºæ¶ˆæ¯æœåŠ¡å™¨ä¼šåœ¨Consumerç¦»çº¿çš„æ—¶å€™è‡ªåŠ¨ç¼“å­˜æ¶ˆæ¯ï¼›</li>
<li>å¦‚æœProducerå‘é€çš„æ¶ˆæ¯é¢‘ç‡é«˜äºConsumerçš„å¤„ç†èƒ½åŠ›ï¼Œæ¶ˆæ¯å¯ä»¥ç§¯å‹åœ¨æ¶ˆæ¯æœåŠ¡å™¨ï¼Œä¸è‡³äºå‹å®Consumerï¼›</li>
<li>é€šè¿‡ä¸€ä¸ªæ¶ˆæ¯æœåŠ¡å™¨ï¼Œå¯ä»¥è¿æ¥å¤šä¸ªProducerå’Œå¤šä¸ªConsumerã€‚</li>
</ul>
<p>å› ä¸ºæ¶ˆæ¯æœåŠ¡åœ¨å„ç±»åº”ç”¨ç¨‹åºä¸­éå¸¸æœ‰ç”¨ï¼Œæ‰€ä»¥JavaEEä¸“é—¨å®šä¹‰äº†JMSè§„èŒƒã€‚æ³¨æ„åˆ°JMSæ˜¯ä¸€ç»„æ¥å£å®šä¹‰ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨JMSï¼Œè¿˜éœ€è¦é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„JMSäº§å“ã€‚å¸¸ç”¨çš„JMSæœåŠ¡å™¨æœ‰å¼€æºçš„<a href="https://activemq.apache.org/">ActiveMQ</a>ï¼Œå•†ä¸šæœåŠ¡å™¨å¦‚WebLogicã€WebSphereç­‰ä¹Ÿå†…ç½®äº†JMSæ”¯æŒã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¼€æºçš„ActiveMQä½œä¸ºJMSæœåŠ¡å™¨ï¼Œå› æ­¤ï¼Œåœ¨å¼€å‘JMSä¹‹å‰æˆ‘ä»¬å¿…é¡»é¦–å…ˆå®‰è£…ActiveMQã€‚</p>
<p>ç°åœ¨é—®é¢˜æ¥äº†ï¼šä»å®˜ç½‘ä¸‹è½½ActiveMQæ—¶ï¼Œè¹¦å‡ºä¸€ä¸ªé¡µé¢ï¼Œè®©æˆ‘ä»¬é€‰æ‹©ActiveMQ Classicæˆ–è€…ActiveMQ Artemisï¼Œè¿™ä¸¤ä¸ªæ˜¯ä»€ä¹ˆå…³ç³»ï¼Œåˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>å®é™…ä¸ŠActiveMQ ClassicåŸæ¥å°±å«ActiveMQï¼Œæ˜¯Apacheå¼€å‘çš„åŸºäºJMS 1.1çš„æ¶ˆæ¯æœåŠ¡å™¨ï¼Œç›®å‰ç¨³å®šç‰ˆæœ¬å·æ˜¯5.xï¼Œè€ŒActiveMQ Artemisæ˜¯ç”±RedHatæèµ çš„<a href="https://hornetq.jboss.org/">HornetQ</a>æœåŠ¡å™¨ä»£ç çš„åŸºç¡€ä¸Šå¼€å‘çš„ï¼Œç›®å‰ç¨³å®šç‰ˆæœ¬å·æ˜¯2.xã€‚å’ŒActiveMQ Classicç›¸æ¯”ï¼ŒArtemisç‰ˆçš„ä»£ç ä¸Classicå®Œå…¨ä¸åŒï¼Œå¹¶ä¸”ï¼Œå®ƒæ”¯æŒJMS 2.0ï¼Œä½¿ç”¨åŸºäºNettyçš„å¼‚æ­¥IOï¼Œå¤§å¤§æå‡äº†æ€§èƒ½ã€‚æ­¤å¤–ï¼ŒArtemisä¸ä»…æä¾›äº†JMSæ¥å£ï¼Œå®ƒè¿˜æä¾›äº†AMQPæ¥å£ï¼ŒSTOMPæ¥å£å’Œç‰©è”ç½‘ä½¿ç”¨çš„MQTTæ¥å£ã€‚é€‰æ‹©Artemisï¼Œç›¸å½“äºä¸€é±¼å››åƒã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥é€‰æ‹©ActiveMQ Artemisã€‚ä»å®˜ç½‘<a href="https://activemq.apache.org/components/artemis/download/">ä¸‹è½½</a>æœ€æ–°çš„2.xç‰ˆæœ¬ï¼Œè§£å‹åè®¾ç½®ç¯å¢ƒå˜é‡<code>ARTEMIS_HOME</code>ï¼ŒæŒ‡å‘Artemisæ ¹ç›®å½•ï¼Œä¾‹å¦‚<code>C:\Apps\artemis</code>ï¼Œç„¶åï¼ŒæŠŠ<code>ARTEMIS_HOME/bin</code>åŠ å…¥PATHç¯å¢ƒå˜é‡ï¼š</p>
<ul>
<li>Windowsä¸‹æ·»åŠ <code>%ARTEMIS_HOME%\bin</code>åˆ°Pathè·¯å¾„ï¼›</li>
<li>Macå’ŒLinuxä¸‹æ·»åŠ <code>$ARTEMIS_HOME/bin</code>åˆ°PATHè·¯å¾„ã€‚</li>
</ul>
<p>Artemisæœ‰ä¸ªå¾ˆå¥½çš„è®¾è®¡ï¼Œå°±æ˜¯å®ƒæŠŠç¨‹åºå’Œæ•°æ®å®Œå…¨åˆ†ç¦»äº†ã€‚æˆ‘ä»¬è§£å‹åçš„<code>ARTEMIS_HOME</code>ç›®å½•æ˜¯ç¨‹åºç›®å½•ï¼Œè¦å¯åŠ¨ä¸€ä¸ªArtemisæœåŠ¡ï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ•°æ®ç›®å½•ã€‚æˆ‘ä»¬æŠŠæ•°æ®ç›®å½•ç›´æ¥è®¾å®šåœ¨é¡¹ç›®<code>spring-integration-jms</code>çš„<code>jms-data</code>ç›®å½•ä¸‹ã€‚æ‰§è¡Œå‘½ä»¤<code>artemis create jms-data</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>$ pwd
</span></span><span style="display:flex;"><span>/Users/liaoxuefeng/workspace/spring-integration-jms
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ artemis create jms-data
</span></span><span style="display:flex;"><span>Creating ActiveMQ Artemis instance at: /Users/liaoxuefeng/workspace/spring-integration-jms/jms-data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--user: is a mandatory property!
</span></span><span style="display:flex;"><span>Please provide the default username:
</span></span><span style="display:flex;"><span>admin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--password: is mandatory with this configuration:
</span></span><span style="display:flex;"><span>Please provide the default password:
</span></span><span style="display:flex;"><span>********
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--allow-anonymous | --require-login: is a mandatory property!
</span></span><span style="display:flex;"><span>Allow anonymous access?, valid values are Y,N,True,False
</span></span><span style="display:flex;"><span>N
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Auto tuning journal ...
</span></span><span style="display:flex;"><span>done! Your system can make 0.09 writes per millisecond, your journal-buffer-timeout will be 11392000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You can now start the broker by executing:  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   &#34;/Users/liaoxuefeng/workspace/spring-integration-jms/jms-data/bin/artemis&#34; run
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Or you can run the broker in the background using:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   &#34;/Users/liaoxuefeng/workspace/spring-integration-jms/jms-data/bin/artemis-service&#34; start
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œä¼šè¦æ±‚è¾“å…¥è¿æ¥ç”¨æˆ·å’Œå£ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾å®š<code>admin</code>å’Œ<code>password</code>ï¼Œä»¥åŠæ˜¯å¦å…è®¸åŒ¿åè®¿é—®ï¼ˆè¿™é‡Œé€‰æ‹©<code>N</code>ï¼‰ã€‚</p>
<p>æ­¤æ•°æ®ç›®å½•<code>jms-data</code>ä¸ä»…åŒ…å«æ¶ˆæ¯æ•°æ®ã€æ—¥å¿—ï¼Œè¿˜è‡ªåŠ¨åˆ›å»ºäº†ä¸¤ä¸ªå¯åŠ¨æœåŠ¡çš„å‘½ä»¤<code>bin/artemis</code>å’Œ<code>bin/artemis-service</code>ï¼Œå‰è€…åœ¨å‰å°å¯åŠ¨è¿è¡Œï¼ŒæŒ‰Ctrl+Cç»“æŸï¼Œåè€…ä¼šä¸€ç›´åœ¨åå°è¿è¡Œã€‚</p>
<p>æˆ‘ä»¬æŠŠç›®å½•åˆ‡æ¢åˆ°<code>jms-data/bin</code>ï¼Œç›´æ¥è¿è¡Œ<code>artemis run</code>å³å¯å¯åŠ¨ArtemisæœåŠ¡ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>$ ./artemis run
</span></span><span style="display:flex;"><span>     _        _               _
</span></span><span style="display:flex;"><span>    / \  ____| |_  ___ __  __(_) _____
</span></span><span style="display:flex;"><span>   / _ \|  _ \ __|/ _ \  \/  | |/  __/
</span></span><span style="display:flex;"><span>  / ___ \ | \/ |_/  __/ |\/| | |\___ \
</span></span><span style="display:flex;"><span> /_/   \_\|   \__\____|_|  |_|_|/___ /
</span></span><span style="display:flex;"><span> Apache ActiveMQ Artemis 2.13.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2020-06-02 07:50:21,718 INFO  [org.apache.activemq.artemis] AMQ241001: HTTP Server started at http://localhost:8161
</span></span><span style="display:flex;"><span>2020-06-02 07:50:21,718 INFO  [org.apache.activemq.artemis] AMQ241002: Artemis Jolokia REST API available at http://localhost:8161/console/jolokia
</span></span><span style="display:flex;"><span>2020-06-02 07:50:21,719 INFO  [org.apache.activemq.artemis] AMQ241004: Artemis Console available at http://localhost:8161/console
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯åŠ¨æˆåŠŸåï¼ŒArtemisæç¤ºå¯ä»¥é€šè¿‡URL<code>http://localhost:8161/console</code>è®¿é—®ç®¡ç†åå°ã€‚æ³¨æ„<em>ä¸è¦å…³é—­å‘½ä»¤è¡Œçª—å£</em>ã€‚</p>
<p>æ³¨æ„</p>
<p>å¦‚æœArtemiså¯åŠ¨æ—¶æ˜¾ç¤ºè­¦å‘Šï¼šAMQ222212: Disk Full! &hellip; Clients will report blocked.è¿™æ˜¯å› ä¸ºç£ç›˜ç©ºé—´ä¸å¤Ÿï¼Œå¯ä»¥åœ¨etc/broker.xmlé…ç½®ä¸­æ‰¾åˆ°å¹¶æ”¹ä¸º99ã€‚</p>
<p>åœ¨ç¼–å†™JMSä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—ç†è§£JMSçš„æ¶ˆæ¯æ¨¡å‹ã€‚JMSæŠŠç”Ÿäº§æ¶ˆæ¯çš„ä¸€æ–¹ç§°ä¸ºProducerï¼Œå¤„ç†æ¶ˆæ¯çš„ä¸€æ–¹ç§°ä¸ºConsumerã€‚æœ‰ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯é€šé“ï¼Œä¸€ç§æ˜¯Queueï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚Producerâ”‚â”€â”€â”€â–¶â”‚ Queue  â”‚â”€â”€â”€â–¶â”‚Consumerâ”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€ç§æ˜¯Topicï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                         â”Œâ”€â–¶â”‚Consumerâ”‚
</span></span><span style="display:flex;"><span>                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚Producerâ”‚â”€â”€â”€â–¶â”‚ Topic  â”‚â”€â”¼â”€â–¶â”‚Consumerâ”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>                         â””â”€â–¶â”‚Consumerâ”‚
</span></span><span style="display:flex;"><span>                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼ŒQueueæ˜¯ä¸€ç§ä¸€å¯¹ä¸€çš„é€šé“ï¼Œå¦‚æœConsumerç¦»çº¿æ— æ³•å¤„ç†æ¶ˆæ¯æ—¶ï¼ŒQueueä¼šæŠŠæ¶ˆæ¯å­˜èµ·æ¥ï¼Œç­‰Consumerå†æ¬¡è¿æ¥çš„æ—¶å€™å‘ç»™å®ƒã€‚è®¾å®šäº†æŒä¹…åŒ–æœºåˆ¶çš„Queueä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚å¦‚æœæœ‰å¤šä¸ªConsumeræ¥å…¥åŒä¸€ä¸ªQueueï¼Œé‚£ä¹ˆå®ƒä»¬ç­‰æ•ˆäºä»¥é›†ç¾¤æ–¹å¼å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼Œå‘é€æ–¹å‘é€çš„æ¶ˆæ¯æ˜¯Aï¼ŒBï¼ŒCï¼ŒDï¼ŒEï¼ŒFï¼Œä¸¤ä¸ªConsumerå¯èƒ½åˆ†åˆ«æ”¶åˆ°Aï¼ŒCï¼ŒEå’ŒBï¼ŒDï¼ŒFï¼Œå³æ¯ä¸ªæ¶ˆæ¯åªä¼šäº¤ç»™å…¶ä¸­ä¸€ä¸ªConsumerå¤„ç†ã€‚</p>
<p>Topicåˆ™æ˜¯ä¸€ç§ä¸€å¯¹å¤šé€šé“ã€‚ä¸€ä¸ªProducerå‘å‡ºçš„æ¶ˆæ¯ï¼Œä¼šè¢«å¤šä¸ªConsumeråŒæ—¶æ”¶åˆ°ï¼Œå³æ¯ä¸ªConsumeréƒ½ä¼šæ”¶åˆ°ä¸€ä»½å®Œæ•´çš„æ¶ˆæ¯æµã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå¦‚æœæŸä¸ªConsumeræš‚æ—¶ç¦»çº¿ï¼Œè¿‡ä¸€æ®µæ—¶é—´ååˆä¸Šçº¿äº†ï¼Œé‚£ä¹ˆåœ¨å®ƒç¦»çº¿æœŸé—´äº§ç”Ÿçš„æ¶ˆæ¯è¿˜èƒ½ä¸èƒ½æ”¶åˆ°å‘¢ï¼Ÿ</p>
<p>è¿™å–å†³äºæ¶ˆæ¯æœåŠ¡å™¨å¯¹Topicç±»å‹æ¶ˆæ¯çš„æŒä¹…åŒ–æœºåˆ¶ã€‚å¦‚æœæ¶ˆæ¯æœåŠ¡å™¨ä¸å­˜å‚¨Topicæ¶ˆæ¯ï¼Œé‚£ä¹ˆç¦»çº¿çš„Consumerä¼šä¸¢å¤±éƒ¨åˆ†ç¦»çº¿æ—¶æœŸçš„æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯æœåŠ¡å™¨å­˜å‚¨äº†Topicæ¶ˆæ¯ï¼Œé‚£ä¹ˆç¦»çº¿çš„Consumerå¯ä»¥æ”¶åˆ°è‡ªä¸Šæ¬¡ç¦»çº¿æ—¶åˆ»å¼€å§‹åäº§ç”Ÿçš„æ‰€æœ‰æ¶ˆæ¯ã€‚JMSè§„èŒƒé€šè¿‡ConsumeræŒ‡å®šä¸€ä¸ªæŒä¹…åŒ–è®¢é˜…å¯ä»¥åœ¨ä¸Šçº¿åæ”¶å–æ‰€æœ‰ç¦»çº¿æœŸé—´çš„æ¶ˆæ¯ï¼Œå¦‚æœæŒ‡å®šçš„æ˜¯éæŒä¹…åŒ–è®¢é˜…ï¼Œé‚£ä¹ˆç¦»çº¿æœŸé—´çš„æ¶ˆæ¯ä¼šå…¨éƒ¨ä¸¢å¤±ã€‚</p>
<p>ç»†å¿ƒçš„ç«¥é‹å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¦‚æœä¸€ä¸ªTopicçš„æ¶ˆæ¯å…¨éƒ¨éƒ½æŒä¹…åŒ–äº†ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªConsumerï¼Œé‚£ä¹ˆå®ƒå’ŒQueueå…¶å®æ˜¯ä¸€æ ·çš„ã€‚å®é™…ä¸Šï¼Œå¾ˆå¤šæ¶ˆæ¯æœåŠ¡å™¨å†…éƒ¨éƒ½åªæœ‰Topicç±»å‹çš„æ¶ˆæ¯æ¶æ„ï¼ŒQueueå¯ä»¥é€šè¿‡Topicâ€œæ¨¡æ‹Ÿâ€å‡ºæ¥ã€‚</p>
<p>æ— è®ºæ˜¯Queueè¿˜æ˜¯Topicï¼Œå¯¹Produceræ²¡æœ‰ä»€ä¹ˆè¦æ±‚ã€‚å¤šä¸ªProducerä¹Ÿå¯ä»¥å†™å…¥åŒä¸€ä¸ªQueueæˆ–è€…Topicï¼Œæ­¤æ—¶æ¶ˆæ¯æœåŠ¡å™¨å†…éƒ¨ä¼šè‡ªåŠ¨æ’åºç¡®ä¿æ¶ˆæ¯æ€»æ˜¯æœ‰åºçš„ã€‚</p>
<p>ä»¥ä¸Šæ˜¯æ¶ˆæ¯æœåŠ¡çš„åŸºæœ¬æ¨¡å‹ã€‚å…·ä½“åˆ°æŸä¸ªæ¶ˆæ¯æœåŠ¡å™¨æ—¶ï¼ŒProducerå’ŒConsumeré€šå¸¸æ˜¯é€šè¿‡TCPè¿æ¥æ¶ˆæ¯æœåŠ¡å™¨ï¼Œåœ¨ç¼–å†™JMSç¨‹åºæ—¶ï¼Œåˆä¼šé‡åˆ°<code>ConnectionFactory</code>ã€<code>Connection</code>ã€<code>Session</code>ç­‰æ¦‚å¿µï¼Œå…¶å®è¿™å’ŒJDBCè¿æ¥æ˜¯ç±»ä¼¼çš„ï¼š</p>
<ul>
<li>ConnectionFactoryï¼šä»£è¡¨ä¸€ä¸ªåˆ°æ¶ˆæ¯æœåŠ¡å™¨çš„è¿æ¥æ± ï¼Œç±»ä¼¼JDBCçš„DataSourceï¼›</li>
<li>Connectionï¼šä»£è¡¨ä¸€ä¸ªåˆ°æ¶ˆæ¯æœåŠ¡å™¨çš„è¿æ¥ï¼Œç±»ä¼¼JDBCçš„Connectionï¼›</li>
<li>Sessionï¼šä»£è¡¨ä¸€ä¸ªç»è¿‡è®¤è¯åçš„è¿æ¥ä¼šè¯ï¼›</li>
<li>Messageï¼šä»£è¡¨ä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡ã€‚</li>
</ul>
<p>åœ¨JMS 1.1ä¸­ï¼Œå‘é€æ¶ˆæ¯çš„å…¸å‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>    Connection connection = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºè¿æ¥:</span>
</span></span><span style="display:flex;"><span>        connection = connectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºä¼šè¯:</span>
</span></span><span style="display:flex;"><span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>,Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªProducerå¹¶å…³è”åˆ°æŸä¸ªQueue:</span>
</span></span><span style="display:flex;"><span>        MessageProducer messageProducer = session.<span style="color:#007f7f">createProducer</span>(queue);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªæ–‡æœ¬æ¶ˆæ¯:</span>
</span></span><span style="display:flex;"><span>        TextMessage textMessage = session.<span style="color:#007f7f">createTextMessage</span>(text);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å‘é€æ¶ˆæ¯:</span>
</span></span><span style="display:flex;"><span>        messageProducer.<span style="color:#007f7f">send</span>(textMessage);
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å…³é—­è¿æ¥:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (connection != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (JMSException ex) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¤„ç†JMSå¼‚å¸¸</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>JMS 2.0æ”¹è¿›äº†ä¸€äº›APIæ¥å£ï¼Œå‘é€æ¶ˆæ¯å˜å¾—æ›´ç®€å•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> (JMSContext context = connectionFactory.<span style="color:#007f7f">createContext</span>()) {
</span></span><span style="display:flex;"><span>    context.<span style="color:#007f7f">createProducer</span>().<span style="color:#007f7f">send</span>(queue, text);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>JMSContext</code>å®ç°äº†<code>AutoCloseable</code>æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨<code>try(resource)</code>è¯­æ³•ï¼Œä»£ç æ›´ç®€å•ã€‚</p>
<p>æœ‰äº†ä»¥ä¸Šé¢„å¤‡çŸ¥è¯†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å¼€å‘JMSåº”ç”¨äº†ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p>
<ul>
<li>org.springframework:spring-jms:6.0.0</li>
<li>org.apache.activemq:artemis-jakarta-client:2.27.0</li>
</ul>
<p>Artemisçš„Clientæ¥å£ä¾èµ–äº†<code>jakarta.jms:jakarta.jms-api</code>ï¼Œå› æ­¤ä¸å¿…å†å¼•å…¥JMS APIçš„ä¾èµ–ã€‚</p>
<p>åœ¨AppConfigä¸­ï¼Œé€šè¿‡<code>@EnableJms</code>è®©Springè‡ªåŠ¨æ‰«æJMSç›¸å…³çš„Beanï¼Œå¹¶åŠ è½½JMSé…ç½®æ–‡ä»¶<code>jms.properties</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableWebMvc
</span></span><span style="display:flex;"><span>@EnableJms <span style="color:#007f7f">// å¯ç”¨JMS</span>
</span></span><span style="display:flex;"><span>@EnableTransactionManagement
</span></span><span style="display:flex;"><span>@PropertySource({ <span style="color:#0ff;font-weight:bold">&#34;classpath:/jdbc.properties&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;classpath:/jms.properties&#34;</span> })
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆè¦åˆ›å»ºçš„Beanæ˜¯<code>ConnectionFactory</code>ï¼Œå³è¿æ¥æ¶ˆæ¯æœåŠ¡å™¨çš„è¿æ¥æ± ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>ConnectionFactory createJMSConnectionFactory(
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${jms.uri:tcp://localhost:61616}&#34;</span>) String uri,
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${jms.username:admin}&#34;</span>) String username,
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${jms.password:password}&#34;</span>) String password)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ActiveMQJMSConnectionFactory(uri, username, password);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ¶ˆæ¯æœåŠ¡å™¨æ˜¯ActiveMQ Artemisï¼Œæ‰€ä»¥<code>ConnectionFactory</code>çš„å®ç°ç±»å°±æ˜¯æ¶ˆæ¯æœåŠ¡å™¨æä¾›çš„<code>ActiveMQJMSConnectionFactory</code>ï¼Œå®ƒéœ€è¦çš„å‚æ•°å‡ç”±é…ç½®æ–‡ä»¶è¯»å–åä¼ å…¥ï¼Œå¹¶è®¾ç½®äº†é»˜è®¤å€¼ã€‚</p>
<p>æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ª<code>JmsTemplate</code>ï¼Œå®ƒæ˜¯Springæä¾›çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œå’Œ<code>JdbcTemplate</code>ç±»ä¼¼ï¼Œå¯ä»¥ç®€åŒ–å‘é€æ¶ˆæ¯çš„ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>JmsTemplate createJmsTemplate(@Autowired ConnectionFactory connectionFactory) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> JmsTemplate(connectionFactory);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹ä¸€æ­¥è¦åˆ›å»ºçš„æ˜¯<code>JmsListenerContainerFactory</code>ï¼Œ</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean(<span style="color:#0ff;font-weight:bold">&#34;jmsListenerContainerFactory&#34;</span>)
</span></span><span style="display:flex;"><span>DefaultJmsListenerContainerFactory createJmsListenerContainerFactory(@Autowired ConnectionFactory connectionFactory) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">var</span> factory = <span style="color:#fff;font-weight:bold">new</span> DefaultJmsListenerContainerFactory();
</span></span><span style="display:flex;"><span>    factory.<span style="color:#007f7f">setConnectionFactory</span>(connectionFactory);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> factory;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†å¿…é¡»æŒ‡å®šBeançš„åç§°ä¸º<code>jmsListenerContainerFactory</code>å¤–ï¼Œè¿™ä¸ªBeançš„ä½œç”¨æ˜¯å¤„ç†å’ŒConsumerç›¸å…³çš„Beanã€‚æˆ‘ä»¬å…ˆè·³è¿‡å®ƒçš„åŸç†ï¼Œç»§ç»­ç¼–å†™<code>MessagingService</code>æ¥å‘é€æ¶ˆæ¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MessagingService {
</span></span><span style="display:flex;"><span>    @Autowired ObjectMapper objectMapper;
</span></span><span style="display:flex;"><span>    @Autowired JmsTemplate jmsTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> sendMailMessage(MailMessage msg) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        String text = objectMapper.<span style="color:#007f7f">writeValueAsString</span>(msg);
</span></span><span style="display:flex;"><span>        jmsTemplate.<span style="color:#007f7f">send</span>(<span style="color:#0ff;font-weight:bold">&#34;jms/queue/mail&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> MessageCreator() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> Message createMessage(Session session) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> session.<span style="color:#007f7f">createTextMessage</span>(text);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>JMSçš„æ¶ˆæ¯ç±»å‹æ”¯æŒä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>TextMessageï¼šæ–‡æœ¬æ¶ˆæ¯ï¼›</li>
<li>BytesMessageï¼šäºŒè¿›åˆ¶æ¶ˆæ¯ï¼›</li>
<li>MapMessageï¼šåŒ…å«å¤šä¸ªKey-Valueå¯¹çš„æ¶ˆæ¯ï¼›</li>
<li>ObjectMessageï¼šç›´æ¥åºåˆ—åŒ–Javaå¯¹è±¡çš„æ¶ˆæ¯ï¼›</li>
<li>StreamMessageï¼šä¸€ä¸ªåŒ…å«åŸºæœ¬ç±»å‹åºåˆ—çš„æ¶ˆæ¯ã€‚</li>
</ul>
<p>æœ€å¸¸ç”¨çš„æ˜¯å‘é€åŸºäºJSONçš„æ–‡æœ¬æ¶ˆæ¯ï¼Œä¸Šè¿°ä»£ç é€šè¿‡<code>JmsTemplate</code>åˆ›å»ºä¸€ä¸ª<code>TextMessage</code>å¹¶å‘é€åˆ°åç§°ä¸º<code>jms/queue/mail</code>çš„Queueã€‚</p>
<p>æ³¨æ„ï¼šArtemisæ¶ˆæ¯æœåŠ¡å™¨é»˜è®¤é…ç½®ä¸‹ä¼šè‡ªåŠ¨åˆ›å»ºQueueï¼Œå› æ­¤ä¸å¿…æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªåä¸º<code>jms/queue/mail</code>çš„Queueï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„æ¶ˆæ¯æœåŠ¡å™¨éƒ½ä¼šè‡ªåŠ¨åˆ›å»ºQueueï¼Œç”Ÿäº§ç¯å¢ƒçš„æ¶ˆæ¯æœåŠ¡å™¨é€šå¸¸ä¼šå…³é—­è‡ªåŠ¨åˆ›å»ºåŠŸèƒ½ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºQueueã€‚</p>
<p>å†æ³¨æ„åˆ°<code>MailMessage</code>æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ä¸€ä¸ªJavaBeanï¼ŒçœŸæ­£çš„JMSæ¶ˆæ¯æ˜¯åˆ›å»ºçš„<code>TextMessage</code>ï¼Œå®ƒçš„å†…å®¹æ˜¯JSONã€‚</p>
<p>å½“ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œæˆ‘ä»¬å°±è°ƒç”¨<code>MessagingService.sendMailMessage()</code>å‘é€ä¸€æ¡JMSæ¶ˆæ¯ï¼Œæ­¤ä»£ç ååˆ†ç®€å•ï¼Œè¿™é‡Œä¸å†è´´å‡ºã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬è¦è¯¦ç»†è®¨è®ºçš„æ˜¯å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œå³ç¼–å†™Consumerã€‚ä»ç†è®ºä¸Šè®²ï¼Œå¯ä»¥åˆ›å»ºå¦ä¸€ä¸ªJavaè¿›ç¨‹æ¥å¤„ç†æ¶ˆæ¯ï¼Œä½†å¯¹äºæˆ‘ä»¬è¿™ä¸ªç®€å•çš„Webç¨‹åºæ¥è¯´æ²¡æœ‰å¿…è¦ï¼Œç›´æ¥åœ¨åŒä¸€ä¸ªWebåº”ç”¨ä¸­æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯å³å¯ã€‚</p>
<p>å¤„ç†æ¶ˆæ¯çš„æ ¸å¿ƒä»£ç æ˜¯ç¼–å†™ä¸€ä¸ªBeanï¼Œå¹¶åœ¨å¤„ç†æ–¹æ³•ä¸Šæ ‡æ³¨<code>@JmsListener</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MailMessageListener {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Logger logger = LoggerFactory.<span style="color:#007f7f">getLogger</span>(getClass());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired ObjectMapper objectMapper;
</span></span><span style="display:flex;"><span>    @Autowired MailService mailService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @JmsListener(destination = <span style="color:#0ff;font-weight:bold">&#34;jms/queue/mail&#34;</span>, concurrency = <span style="color:#0ff;font-weight:bold">&#34;10&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> onMailMessageReceived(Message message) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;received message: &#34;</span> + message);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (message <span style="color:#fff;font-weight:bold">instanceof</span> TextMessage) {
</span></span><span style="display:flex;"><span>            String text = ((TextMessage) message).<span style="color:#007f7f">getText</span>();
</span></span><span style="display:flex;"><span>            MailMessage mm = objectMapper.<span style="color:#007f7f">readValue</span>(text, MailMessage.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>            mailService.<span style="color:#007f7f">sendRegistrationMail</span>(mm);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;unable to process non-text message!&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°<code>@JmsListener</code>æŒ‡å®šäº†Queueçš„åç§°ï¼Œå› æ­¤ï¼Œå‡¡æ˜¯å‘åˆ°æ­¤Queueçš„æ¶ˆæ¯éƒ½ä¼šè¢«è¿™ä¸ª<code>onMailMessageReceived()</code>æ–¹æ³•å¤„ç†ï¼Œæ–¹æ³•å‚æ•°æ˜¯JMSçš„<code>Message</code>æ¥å£ï¼Œæˆ‘ä»¬é€šè¿‡å¼ºåˆ¶è½¬å‹ä¸º<code>TextMessage</code>å¹¶æå–JSONï¼Œååºåˆ—åŒ–åè·å¾—è‡ªå®šä¹‰çš„JavaBeanï¼Œä¹Ÿå°±è·å¾—äº†å‘é€é‚®ä»¶æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<p>ä¸‹é¢é—®é¢˜æ¥äº†ï¼šSpringå¤„ç†JMSæ¶ˆæ¯çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å¦‚æœæˆ‘ä»¬ç›´æ¥è°ƒç”¨JMSçš„APIæ¥å¤„ç†æ¶ˆæ¯ï¼Œé‚£ä¹ˆç¼–å†™çš„ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºJMSè¿æ¥:</span>
</span></span><span style="display:flex;"><span>Connection connection = connectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¼šè¯:</span>
</span></span><span style="display:flex;"><span>Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªConsumer:</span>
</span></span><span style="display:flex;"><span>MessageConsumer consumer = session.<span style="color:#007f7f">createConsumer</span>(queue);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä¸ºConsumeræŒ‡å®šä¸€ä¸ªæ¶ˆæ¯å¤„ç†å™¨:</span>
</span></span><span style="display:flex;"><span>consumer.<span style="color:#007f7f">setMessageListener</span>(<span style="color:#fff;font-weight:bold">new</span> MessageListener() { 
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> onMessage(Message message) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åœ¨æ­¤å¤„ç†æ¶ˆæ¯... </span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¯åŠ¨æ¥æ”¶æ¶ˆæ¯çš„å¾ªç¯:</span>
</span></span><span style="display:flex;"><span>connection.<span style="color:#007f7f">start</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„<code>MailMessageListener.onMailMessageReceived()</code>ç›¸å½“äºæ¶ˆæ¯å¤„ç†å™¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>consumer.<span style="color:#007f7f">setMessageListener</span>(<span style="color:#fff;font-weight:bold">new</span> MessageListener() { 
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> onMessage(Message message) {
</span></span><span style="display:flex;"><span>        mailMessageListener.<span style="color:#007f7f">onMailMessageReceived</span>(message); 
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥ï¼ŒSpringæ ¹æ®<code>AppConfig</code>çš„æ³¨è§£<code>@EnableJms</code>è‡ªåŠ¨æ‰«æå¸¦æœ‰<code>@JmsListener</code>çš„Beanæ–¹æ³•ï¼Œå¹¶ä¸ºå…¶åˆ›å»ºä¸€ä¸ª<code>MessageListener</code>æŠŠå®ƒåŒ…è£…èµ·æ¥ã€‚</p>
<p>æ³¨æ„åˆ°å‰é¢æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ª<code>JmsListenerContainerFactory</code>çš„Beanï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä¸ºæ¯ä¸ª<code>MessageListener</code>åˆ›å»º<code>MessageConsumer</code>å¹¶å¯åŠ¨æ¶ˆæ¯æ¥æ”¶å¾ªç¯ã€‚</p>
<p>å†æ³¨æ„åˆ°<code>@JmsListener</code>è¿˜æœ‰ä¸€ä¸ª<code>concurrency</code>å‚æ•°ï¼Œ10è¡¨ç¤ºå¯ä»¥æœ€å¤šåŒæ—¶å¹¶å‘å¤„ç†10ä¸ªæ¶ˆæ¯ï¼Œ<code>5-10</code>è¡¨ç¤ºå¹¶å‘å¤„ç†çš„çº¿ç¨‹å¯ä»¥åœ¨5~10ä¹‹é—´è°ƒæ•´ã€‚</p>
<p>å› æ­¤ï¼ŒSpringåœ¨é€šè¿‡<code>MessageListener</code>æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå¹¶ä¸æ˜¯ç›´æ¥è°ƒç”¨<code>mailMessageListener.onMailMessageReceived()</code>ï¼Œè€Œæ˜¯ç”¨çº¿ç¨‹æ± è°ƒç”¨ï¼Œå› æ­¤ï¼Œè¦æ—¶åˆ»ç‰¢è®°ï¼Œ<code>onMailMessageReceived()</code>æ–¹æ³•å¯èƒ½è¢«å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œä¸€å®šè¦ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹Springæ¥æ”¶æ¶ˆæ¯çš„æ­¥éª¤ï¼š</p>
<p>é€šè¿‡<code>JmsListenerContainerFactory</code>é…åˆ<code>@EnableJms</code>æ‰«ææ‰€æœ‰<code>@JmsListener</code>æ–¹æ³•ï¼Œè‡ªåŠ¨åˆ›å»º<code>MessageConsumer</code>ã€<code>MessageListener</code>ä»¥åŠçº¿ç¨‹æ± ï¼Œå¯åŠ¨æ¶ˆæ¯å¾ªç¯æ¥æ”¶å¤„ç†æ¶ˆæ¯ï¼Œæœ€ç»ˆç”±æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„<code>@JmsListener</code>æ–¹æ³•å¤„ç†æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šç”±å¤šçº¿ç¨‹åŒæ—¶å¹¶å‘å¤„ç†ã€‚</p>
<p>è¦éªŒè¯æ¶ˆæ¯å‘é€å’Œå¤„ç†ï¼Œæˆ‘ä»¬æ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ—¥å¿—è¾“å‡ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>2020-06-02 08:04:27 INFO  c.<span style="color:#007f7f">i</span>.<span style="color:#007f7f">learnjava</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">UserController</span> - user registered: bob@example.com
</span></span><span style="display:flex;"><span>2020-06-02 08:04:27 INFO  c.<span style="color:#007f7f">i</span>.<span style="color:#007f7f">l</span>.<span style="color:#007f7f">service</span>.<span style="color:#007f7f">MailMessageListener</span> - received message: ActiveMQMessage[ID:9fc5...]:PERSISTENT/ClientMessageImpl[messageID=983, durable=<span style="color:#fff;font-weight:bold">true</span>, address=jms/queue/mail, ...]]
</span></span><span style="display:flex;"><span>2020-06-02 08:04:27 INFO  c.<span style="color:#007f7f">i</span>.<span style="color:#007f7f">learnjava</span>.<span style="color:#007f7f">service</span>.<span style="color:#007f7f">MailService</span> - [send mail] sending registration mail to bob@example.com...
</span></span><span style="display:flex;"><span>2020-06-02 08:04:30 INFO  c.<span style="color:#007f7f">i</span>.<span style="color:#007f7f">learnjava</span>.<span style="color:#007f7f">service</span>.<span style="color:#007f7f">MailService</span> - [send mail] registration mail was sent to bob@example.com.
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼Œæ¶ˆæ¯è¢«æˆåŠŸå‘é€åˆ°Artemisï¼Œç„¶ååœ¨å¾ˆçŸ­çš„æ—¶é—´å†…è¢«æ¥æ”¶å¤„ç†äº†ã€‚</p>
<p>ä½¿ç”¨æ¶ˆæ¯æœåŠ¡å¯¹å‘é€Emailè¿›è¡Œæ”¹é€ çš„å¥½å¤„æ˜¯ï¼Œå‘é€Emailçš„èƒ½åŠ›é€šå¸¸æ˜¯æœ‰é™çš„ï¼Œé€šè¿‡JMSæ¶ˆæ¯æœåŠ¡ï¼Œå¦‚æœçŸ­æ—¶é—´å†…éœ€è¦ç»™å¤§é‡ç”¨æˆ·å‘é€Emailï¼Œå¯ä»¥å…ˆæŠŠæ¶ˆæ¯å †ç§¯åœ¨JMSæœåŠ¡å™¨ä¸Šæ…¢æ…¢å‘é€ï¼Œå¯¹äºæ‰¹é‡å‘é€é‚®ä»¶ã€çŸ­ä¿¡ç­‰å°¤å…¶æœ‰ç”¨ã€‚</p>
<p><strong>å°ç»“</strong></p>
<p>JMSæ˜¯Javaæ¶ˆæ¯æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡JMSæœåŠ¡å™¨å®ç°æ¶ˆæ¯çš„å¼‚æ­¥å¤„ç†ã€‚</p>
<p>æ¶ˆæ¯æœåŠ¡ä¸»è¦è§£å†³Producerå’ŒConsumerç”Ÿäº§å’Œå¤„ç†é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ã€‚</p>
<h1 id="ä½¿ç”¨scheduler">ä½¿ç”¨Scheduler<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨scheduler">#</a></h1>
<p>åœ¨å¾ˆå¤šåº”ç”¨ç¨‹åºä¸­ï¼Œç»å¸¸éœ€è¦æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œæ¯å¤©æˆ–æ¯æœˆç»™ç”¨æˆ·å‘é€è´¦æˆ·æ±‡æ€»æŠ¥è¡¨ï¼Œå®šæœŸæ£€æŸ¥å¹¶å‘é€ç³»ç»ŸçŠ¶æ€æŠ¥å‘Šï¼Œç­‰ç­‰ã€‚</p>
<p>å®šæ—¶ä»»åŠ¡æˆ‘ä»¬åœ¨<a href="https://liaoxuefeng.com/books/java/threading/pool/index.html">ä½¿ç”¨çº¿ç¨‹æ± </a>ä¸€èŠ‚ä¸­å·²ç»è®²åˆ°äº†ï¼ŒJavaæ ‡å‡†åº“æœ¬èº«å°±æä¾›äº†å®šæ—¶æ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½ã€‚åœ¨Springä¸­ï¼Œä½¿ç”¨å®šæ—¶ä»»åŠ¡æ›´ç®€å•ï¼Œä¸éœ€è¦æ‰‹å†™çº¿ç¨‹æ± ç›¸å…³ä»£ç ï¼Œåªéœ€è¦ä¸¤ä¸ªæ³¨è§£å³å¯ã€‚</p>
<p>æˆ‘ä»¬è¿˜æ˜¯ä»¥å®é™…ä»£ç ä¸ºä¾‹ï¼Œå»ºç«‹å·¥ç¨‹<code>spring-integration-schedule</code>ï¼Œæ— éœ€é¢å¤–çš„ä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨<code>AppConfig</code>ä¸­åŠ ä¸Š<code>@EnableScheduling</code>å°±å¼€å¯äº†å®šæ—¶ä»»åŠ¡çš„æ”¯æŒï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableWebMvc
</span></span><span style="display:flex;"><span>@EnableScheduling
</span></span><span style="display:flex;"><span>@EnableTransactionManagement
</span></span><span style="display:flex;"><span>@PropertySource({ <span style="color:#0ff;font-weight:bold">&#34;classpath:/jdbc.properties&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;classpath:/task.properties&#34;</span> })
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä¸€ä¸ªBeanä¸­ç¼–å†™ä¸€ä¸ª<code>public void</code>æ— å‚æ•°æ–¹æ³•ï¼Œç„¶ååŠ ä¸Š<code>@Scheduled</code>æ³¨è§£ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TaskService {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Logger logger = LoggerFactory.<span style="color:#007f7f">getLogger</span>(getClass());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Scheduled(initialDelay = 60_000, fixedRate = 60_000)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> checkSystemStatusEveryMinute() {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;Start check system status...&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°æ³¨è§£æŒ‡å®šäº†å¯åŠ¨å»¶è¿Ÿ60ç§’ï¼Œå¹¶ä»¥60ç§’çš„é—´éš”æ‰§è¡Œä»»åŠ¡ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå°±å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°å®šæ—¶ä»»åŠ¡æ‰“å°çš„æ—¥å¿—ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>2020-06-03 18:47:32 INFO  [pool-1-thread-1] c.i.learnjava.service.TaskService - Start check system status...
</span></span><span style="display:flex;"><span>2020-06-03 18:48:32 INFO  [pool-1-thread-1] c.i.learnjava.service.TaskService - Start check system status...
</span></span><span style="display:flex;"><span>2020-06-03 18:49:32 INFO  [pool-1-thread-1] c.i.learnjava.service.TaskService - Start check system status...
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ²¡æœ‰çœ‹åˆ°å®šæ—¶ä»»åŠ¡çš„æ—¥å¿—ï¼Œéœ€è¦æ£€æŸ¥ï¼š</p>
<ul>
<li>æ˜¯å¦å¿˜è®°äº†åœ¨<code>AppConfig</code>ä¸­æ ‡æ³¨<code>@EnableScheduling</code>ï¼›</li>
<li>æ˜¯å¦å¿˜è®°äº†åœ¨å®šæ—¶ä»»åŠ¡çš„æ–¹æ³•æ‰€åœ¨çš„classæ ‡æ³¨<code>@Component</code>ã€‚</li>
</ul>
<p>é™¤äº†å¯ä»¥ä½¿ç”¨<code>fixedRate</code>å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>fixedDelay</code>ï¼Œä¸¤è€…çš„åŒºåˆ«æˆ‘ä»¬å·²ç»åœ¨ä½¿ç”¨çº¿ç¨‹æ± ä¸€èŠ‚ä¸­è®²è¿‡ï¼Œè¿™é‡Œä¸å†é‡å¤ã€‚</p>
<p>æœ‰çš„ç«¥é‹åœ¨å®é™…å¼€å‘ä¸­ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºJavaçš„æ³¨è§£å…¨éƒ¨æ˜¯å¸¸é‡ï¼Œå†™æ­»äº†<code>fixedDelay=30000</code>ï¼Œå¦‚æœæ ¹æ®å®é™…æƒ…å†µè¦æ”¹æˆ60ç§’æ€ä¹ˆåŠï¼Œåªèƒ½é‡æ–°ç¼–è¯‘ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠå®šæ—¶ä»»åŠ¡çš„é…ç½®æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚<code>task.properties</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>task.checkDiskSpace=30000
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±å¯ä»¥éšæ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶è€Œæ— éœ€åŠ¨ä»£ç ã€‚ä½†æ˜¯åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç”¨<code>fixedDelayString</code>å–ä»£<code>fixedDelay</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TaskService {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Scheduled(initialDelay = 30_000, fixedDelayString = <span style="color:#0ff;font-weight:bold">&#34;${task.checkDiskSpace:30000}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> checkDiskSpaceEveryMinute() {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;Start check disk space...&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°ä¸Šè¿°ä»£ç çš„æ³¨è§£å‚æ•°<code>fixedDelayString</code>æ˜¯ä¸€ä¸ªå±æ€§å ä½ç¬¦ï¼Œå¹¶é…æœ‰é»˜è®¤å€¼30000ï¼ŒSpringåœ¨å¤„ç†<code>@Scheduled</code>æ³¨è§£æ—¶ï¼Œå¦‚æœé‡åˆ°<code>String</code>ï¼Œä¼šæ ¹æ®å ä½ç¬¦è‡ªåŠ¨ç”¨é…ç½®é¡¹æ›¿æ¢ï¼Œè¿™æ ·å°±å¯ä»¥çµæ´»åœ°ä¿®æ”¹å®šæ—¶ä»»åŠ¡çš„é…ç½®ã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>fixedDelayString</code>è¿˜å¯ä»¥ä½¿ç”¨æ›´æ˜“è¯»çš„<code>Duration</code>ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Scheduled(initialDelay = 30_000, fixedDelayString = <span style="color:#0ff;font-weight:bold">&#34;${task.checkDiskSpace:PT2M30S}&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»¥å­—ç¬¦ä¸²<code>PT2M30S</code>è¡¨ç¤ºçš„<code>Duration</code>å°±æ˜¯2åˆ†30ç§’ï¼Œè¯·å‚è€ƒ<a href="https://liaoxuefeng.com/books/java/datetime/local-datetime/index.html">LocalDateTime</a>ä¸€èŠ‚çš„Durationç›¸å…³éƒ¨åˆ†ã€‚</p>
<p>å¤šä¸ª<code>@Scheduled</code>æ–¹æ³•å®Œå…¨å¯ä»¥æ”¾åˆ°ä¸€ä¸ªBeanä¸­ï¼Œè¿™æ ·ä¾¿äºç»Ÿä¸€ç®¡ç†å„ç±»å®šæ—¶ä»»åŠ¡ã€‚</p>
<h3 id="ä½¿ç”¨cronä»»åŠ¡">ä½¿ç”¨Cronä»»åŠ¡<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨cronä»»åŠ¡">#</a></h3>
<p>è¿˜æœ‰ä¸€ç±»å®šæ—¶ä»»åŠ¡ï¼Œå®ƒä¸æ˜¯ç®€å•çš„é‡å¤æ‰§è¡Œï¼Œè€Œæ˜¯æŒ‰æ—¶é—´è§¦å‘ï¼Œæˆ‘ä»¬æŠŠè¿™ç±»ä»»åŠ¡ç§°ä¸ºCronä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>æ¯å¤©å‡Œæ™¨2:15æ‰§è¡ŒæŠ¥è¡¨ä»»åŠ¡ï¼›</li>
<li>æ¯ä¸ªå·¥ä½œæ—¥12:00æ‰§è¡Œç‰¹å®šä»»åŠ¡ï¼›</li>
<li>â€¦â€¦</li>
</ul>
<p>Cronæºè‡ªUnix/Linuxç³»ç»Ÿè‡ªå¸¦çš„crondå®ˆæŠ¤è¿›ç¨‹ï¼Œä»¥ä¸€ä¸ªç®€æ´çš„è¡¨è¾¾å¼å®šä¹‰ä»»åŠ¡è§¦å‘æ—¶é—´ã€‚åœ¨Springä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Cronè¡¨è¾¾å¼æ¥æ‰§è¡ŒCronä»»åŠ¡ï¼Œåœ¨Springä¸­ï¼Œå®ƒçš„æ ¼å¼æ˜¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>ç§’ åˆ† å°æ—¶ å¤© æœˆä»½ æ˜ŸæœŸ å¹´
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¹´æ˜¯å¯ä»¥å¿½ç•¥çš„ï¼Œé€šå¸¸ä¸å†™ã€‚æ¯å¤©å‡Œæ™¨2:15æ‰§è¡Œçš„Cronè¡¨è¾¾å¼å°±æ˜¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>0 15 2 * * *
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¯ä¸ªå·¥ä½œæ—¥12:00æ‰§è¡Œçš„Cronè¡¨è¾¾å¼å°±æ˜¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>0 0 12 * * MON-FRI
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¯ä¸ªæœˆ1å·ï¼Œ2å·ï¼Œ3å·å’Œ10å·12:00æ‰§è¡Œçš„Cronè¡¨è¾¾å¼å°±æ˜¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>0 0 12 1-3,10 * *
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨Springä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¯å¤©å‡Œæ™¨2:15æ‰§è¡Œçš„ä»»åŠ¡ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TaskService {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Scheduled(cron = <span style="color:#0ff;font-weight:bold">&#34;${task.report:0 15 2 * * *}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> cronDailyReport() {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;Start daily report task...&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Cronä»»åŠ¡åŒæ ·å¯ä»¥ä½¿ç”¨å±æ€§å ä½ç¬¦ï¼Œè¿™æ ·ä¿®æ”¹èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚</p>
<p>Cronè¡¨è¾¾å¼è¿˜å¯ä»¥è¡¨è¾¾æ¯10åˆ†é’Ÿæ‰§è¡Œï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>0 */10 * * * *
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œåœ¨æ¯ä¸ªå°æ—¶çš„0:00ï¼Œ10:00ï¼Œ20:00ï¼Œ30:00ï¼Œ40:00ï¼Œ50:00å‡ä¼šæ‰§è¡Œä»»åŠ¡ï¼Œå®é™…ä¸Šå®ƒå¯ä»¥å–ä»£<code>fixedRate</code>ç±»å‹çš„å®šæ—¶ä»»åŠ¡ã€‚</p>
<h3 id="é›†æˆquartz">é›†æˆQuartz<a hidden class="anchor" aria-hidden="true" href="#é›†æˆquartz">#</a></h3>
<p>åœ¨Springä¸­ä½¿ç”¨å®šæ—¶ä»»åŠ¡å’ŒCronä»»åŠ¡éƒ½ååˆ†ç®€å•ï¼Œä½†æ˜¯è¦æ³¨æ„åˆ°ï¼Œè¿™äº›ä»»åŠ¡çš„è°ƒåº¦éƒ½æ˜¯åœ¨æ¯ä¸ªJVMè¿›ç¨‹ä¸­çš„ã€‚å¦‚æœåœ¨æœ¬æœºå¯åŠ¨ä¸¤ä¸ªè¿›ç¨‹ï¼Œæˆ–è€…åœ¨å¤šå°æœºå™¨ä¸Šå¯åŠ¨åº”ç”¨ï¼Œè¿™äº›è¿›ç¨‹çš„å®šæ—¶ä»»åŠ¡å’ŒCronä»»åŠ¡éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œäº’ä¸å½±å“ã€‚</p>
<p>å¦‚æœä¸€äº›å®šæ—¶ä»»åŠ¡è¦ä»¥é›†ç¾¤çš„æ–¹å¼è¿è¡Œï¼Œä¾‹å¦‚æ¯å¤©23:00æ‰§è¡Œæ£€æŸ¥ä»»åŠ¡ï¼Œåªéœ€è¦é›†ç¾¤ä¸­çš„ä¸€å°è¿è¡Œå³å¯ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<a href="https://www.quartz-scheduler.org/">Quartz</a>ã€‚</p>
<p>Quartzå¯ä»¥é…ç½®ä¸€ä¸ªJDBCæ•°æ®æºï¼Œä»¥ä¾¿å­˜å‚¨æ‰€æœ‰çš„ä»»åŠ¡è°ƒåº¦è®¡åˆ’ä»¥åŠä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å†…å­˜æ¥è°ƒåº¦ä»»åŠ¡ï¼Œä½†è¿™æ ·é…ç½®å°±å’Œä½¿ç”¨Springçš„è°ƒåº¦æ²¡å•¥åŒºåˆ«äº†ï¼Œé¢å¤–é›†æˆQuartzçš„æ„ä¹‰å°±ä¸å¤§ã€‚</p>
<p>Quartzçš„JDBCé…ç½®æ¯”è¾ƒå¤æ‚ï¼ŒSpringå¯¹å…¶ä¹Ÿæœ‰ä¸€å®šçš„æ”¯æŒã€‚è¦è¯¦ç»†äº†è§£Quartzçš„é›†æˆï¼Œè¯·å‚è€ƒ<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#scheduling-quartz">Springçš„æ–‡æ¡£</a>ã€‚</p>
<p>æ€è€ƒï¼šå¦‚æœä¸ä½¿ç”¨Quartzçš„JDBCé…ç½®ï¼Œå¤šä¸ªSpringåº”ç”¨åŒæ—¶è¿è¡Œæ—¶ï¼Œå¦‚ä½•ä¿è¯æŸä¸ªä»»åŠ¡åªåœ¨æŸä¸€å°æœºå™¨æ‰§è¡Œï¼Ÿ</p>
<p><strong>å°ç»“</strong></p>
<p>Springå†…ç½®å®šæ—¶ä»»åŠ¡å’ŒCronä»»åŠ¡çš„æ”¯æŒï¼Œç¼–å†™è°ƒåº¦ä»»åŠ¡ååˆ†æ–¹ä¾¿ã€‚</p>
<h1 id="é›†æˆjmx">é›†æˆJMX<a hidden class="anchor" aria-hidden="true" href="#é›†æˆjmx">#</a></h1>
<p>åœ¨Springä¸­ï¼Œå¯ä»¥æ–¹ä¾¿åœ°é›†æˆJMXã€‚</p>
<p>é‚£ä¹ˆç¬¬ä¸€ä¸ªé—®é¢˜æ¥äº†ï¼šä»€ä¹ˆæ˜¯JMXï¼Ÿ</p>
<p>JMXæ˜¯Java Management Extensionsï¼Œå®ƒæ˜¯ä¸€ä¸ªJavaå¹³å°çš„ç®¡ç†å’Œç›‘æ§æ¥å£ã€‚ä¸ºä»€ä¹ˆè¦æJMXå‘¢ï¼Ÿå› ä¸ºåœ¨æ‰€æœ‰çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¯¹è¿è¡Œä¸­çš„ç¨‹åºè¿›è¡Œç›‘æ§éƒ½æ˜¯éå¸¸é‡è¦çš„ï¼ŒJavaåº”ç”¨ç¨‹åºä¹Ÿä¸ä¾‹å¤–ã€‚æˆ‘ä»¬è‚¯å®šå¸Œæœ›çŸ¥é“Javaåº”ç”¨ç¨‹åºå½“å‰çš„çŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œå ç”¨äº†å¤šå°‘å†…å­˜ï¼Œåˆ†é…äº†å¤šå°‘å†…å­˜ï¼Œå½“å‰æœ‰å¤šå°‘æ´»åŠ¨çº¿ç¨‹ï¼Œæœ‰å¤šå°‘ä¼‘çœ çº¿ç¨‹ç­‰ç­‰ã€‚å¦‚ä½•è·å–è¿™äº›ä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>ä¸ºäº†æ ‡å‡†åŒ–ç®¡ç†å’Œç›‘æ§ï¼ŒJavaå¹³å°ä½¿ç”¨JMXä½œä¸ºç®¡ç†å’Œç›‘æ§çš„æ ‡å‡†æ¥å£ï¼Œä»»ä½•ç¨‹åºï¼Œåªè¦æŒ‰JMXè§„èŒƒè®¿é—®è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è·å–æ‰€æœ‰ç®¡ç†ä¸ç›‘æ§ä¿¡æ¯ã€‚</p>
<p>å®é™…ä¸Šï¼Œå¸¸ç”¨çš„è¿ç»´ç›‘æ§å¦‚Zabbixã€Nagiosç­‰å·¥å…·å¯¹JVMæœ¬èº«çš„ç›‘æ§éƒ½æ˜¯é€šè¿‡JMXè·å–çš„ä¿¡æ¯ã€‚</p>
<p>å› ä¸ºJMXæ˜¯ä¸€ä¸ªæ ‡å‡†æ¥å£ï¼Œä¸ä½†å¯ä»¥ç”¨äºç®¡ç†JVMï¼Œè¿˜å¯ä»¥ç®¡ç†åº”ç”¨ç¨‹åºè‡ªèº«ã€‚ä¸‹å›¾æ˜¯JMXçš„æ¶æ„ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>    â”‚jconsole â”‚  â”‚   Web   â”‚
</span></span><span style="display:flex;"><span>    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>         â”‚            â”‚
</span></span><span style="display:flex;"><span>â”Œ â”€ â”€ â”€ â”€â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”¼ â”€ â”€ â”€ â”€
</span></span><span style="display:flex;"><span> JVM     â–¼            â–¼        â”‚
</span></span><span style="display:flex;"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>  â”Œâ”€â”¤Connectorâ”œâ”€â”€â”¤ Adaptor â”œâ”€â” â”‚
</span></span><span style="display:flex;"><span>â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
</span></span><span style="display:flex;"><span>  â”‚       MBeanServer        â”‚ â”‚
</span></span><span style="display:flex;"><span>â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â” â”‚
</span></span><span style="display:flex;"><span>  â””â”€â”¤MBean1â”œâ”¤MBean2â”œâ”¤MBean3â”œâ”€â”˜ â”‚
</span></span><span style="display:flex;"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span> â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>JMXæŠŠæ‰€æœ‰è¢«ç®¡ç†çš„èµ„æºéƒ½ç§°ä¸ºMBeanï¼ˆManaged Beanï¼‰ï¼Œè¿™äº›MBeanå…¨éƒ¨ç”±MBeanServerç®¡ç†ï¼Œå¦‚æœè¦è®¿é—®MBeanï¼Œå¯ä»¥é€šè¿‡MBeanServerå¯¹å¤–æä¾›çš„è®¿é—®æ¥å£ï¼Œä¾‹å¦‚é€šè¿‡RMIæˆ–HTTPè®¿é—®ã€‚</p>
<p>æ³¨æ„åˆ°ä½¿ç”¨JMXä¸éœ€è¦å®‰è£…ä»»ä½•é¢å¤–ç»„ä»¶ï¼Œä¹Ÿä¸éœ€è¦ç¬¬ä¸‰æ–¹åº“ï¼Œå› ä¸ºMBeanServerå·²ç»å†…ç½®åœ¨JavaSEæ ‡å‡†åº“ä¸­äº†ã€‚JavaSEè¿˜æä¾›äº†ä¸€ä¸ª<code>jconsole</code>ç¨‹åºï¼Œç”¨äºé€šè¿‡RMIè¿æ¥åˆ°MBeanServerï¼Œè¿™æ ·å°±å¯ä»¥ç®¡ç†æ•´ä¸ªJavaè¿›ç¨‹ã€‚</p>
<p>é™¤äº†JVMä¼šæŠŠè‡ªèº«çš„å„ç§èµ„æºä»¥MBeanæ³¨å†Œåˆ°JMXä¸­ï¼Œæˆ‘ä»¬è‡ªå·±çš„é…ç½®ã€ç›‘æ§ä¿¡æ¯ä¹Ÿå¯ä»¥ä½œä¸ºMBeanæ³¨å†Œåˆ°JMXï¼Œè¿™æ ·ï¼Œç®¡ç†ç¨‹åºå°±å¯ä»¥ç›´æ¥æ§åˆ¶æˆ‘ä»¬æš´éœ²çš„MBeanã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨JMXï¼Œåªéœ€è¦ä¸¤æ­¥ï¼š</p>
<ol>
<li>ç¼–å†™MBeanæä¾›ç®¡ç†æ¥å£å’Œç›‘æ§æ•°æ®ï¼›</li>
<li>æ³¨å†ŒMBeanã€‚</li>
</ol>
<p>åœ¨Springåº”ç”¨ç¨‹åºä¸­ï¼Œä½¿ç”¨JMXåªéœ€è¦ä¸€æ­¥ï¼š</p>
<ol>
<li>ç¼–å†™MBeanæä¾›ç®¡ç†æ¥å£å’Œç›‘æ§æ•°æ®ã€‚</li>
</ol>
<p>ç¬¬äºŒæ­¥æ³¨å†Œçš„è¿‡ç¨‹ç”±Springè‡ªåŠ¨å®Œæˆã€‚æˆ‘ä»¬ä»¥å®é™…å·¥ç¨‹ä¸ºä¾‹ï¼Œé¦–å…ˆåœ¨<code>AppConfig</code>ä¸­åŠ ä¸Š<code>@EnableMBeanExport</code>æ³¨è§£ï¼Œå‘Šè¯‰Springè‡ªåŠ¨æ³¨å†ŒMBeanï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableWebMvc
</span></span><span style="display:flex;"><span>@EnableMBeanExport <span style="color:#007f7f">// è‡ªåŠ¨æ³¨å†ŒMBean</span>
</span></span><span style="display:flex;"><span>@EnableTransactionManagement
</span></span><span style="display:flex;"><span>@PropertySource({ <span style="color:#0ff;font-weight:bold">&#34;classpath:/jdbc.properties&#34;</span> })
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‰©ä¸‹çš„å…¨éƒ¨å·¥ä½œå°±æ˜¯ç¼–å†™MBeanã€‚æˆ‘ä»¬ä»¥å®é™…é—®é¢˜ä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬å¸Œæœ›ç»™åº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ªIPé»‘åå•åŠŸèƒ½ï¼Œå‡¡æ˜¯åœ¨é»‘åå•ä¸­çš„IPç¦æ­¢è®¿é—®ï¼Œä¼ ç»Ÿçš„åšæ³•æ˜¯å®šä¹‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨çš„æ—¶å€™è¯»å–ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span># blacklist.txt
</span></span><span style="display:flex;"><span>1.2.3.4
</span></span><span style="display:flex;"><span>5.6.7.8
</span></span><span style="display:flex;"><span>2.2.3.4
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¦ä¿®æ”¹é»‘åå•æ€ä¹ˆåŠï¼Ÿä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡å¯åº”ç”¨ç¨‹åºã€‚</p>
<p>ä½†æ˜¯æ¯æ¬¡éƒ½é‡å¯åº”ç”¨ç¨‹åºå®åœ¨æ˜¯å¤ªéº»çƒ¦äº†ï¼Œèƒ½ä¸èƒ½ä¸é‡å¯åº”ç”¨ç¨‹åºï¼Ÿå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªå®šæ—¶è¯»å–é…ç½®æ–‡ä»¶çš„åŠŸèƒ½ï¼Œæ£€æµ‹åˆ°æ–‡ä»¶æ”¹åŠ¨æ—¶è‡ªåŠ¨é‡æ–°è¯»å–ã€‚</p>
<p>ä¸Šè¿°éœ€æ±‚æœ¬è´¨ä¸Šæ˜¯åœ¨åº”ç”¨ç¨‹åºè¿è¡ŒæœŸé—´å¯¹å‚æ•°ã€é…ç½®ç­‰è¿›è¡Œçƒ­æ›´æ–°å¹¶è¦æ±‚å°½å¿«ç”Ÿæ•ˆã€‚å¦‚æœä»¥JMXçš„æ–¹å¼å®ç°ï¼Œæˆ‘ä»¬ä¸å¿…è‡ªå·±ç¼–å†™è‡ªåŠ¨é‡æ–°è¯»å–ç­‰ä»»ä½•ä»£ç ï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªç¬¦åˆJMXæ ‡å‡†çš„MBeanæ¥å­˜å‚¨é…ç½®å³å¯ã€‚</p>
<p>è¿˜æ˜¯ä»¥IPé»‘åå•ä¸ºä¾‹ï¼ŒJMXçš„MBeané€šå¸¸ä»¥MBeanç»“å°¾ï¼Œå› æ­¤æˆ‘ä»¬éµå¾ªæ ‡å‡†å‘½åè§„èŒƒï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ª<code>BlacklistMBean</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> BlacklistMBean {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Set&lt;String&gt; ips = <span style="color:#fff;font-weight:bold">new</span> HashSet&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String[] getBlacklist() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> ips.<span style="color:#007f7f">toArray</span>(String[]::<span style="color:#fff;font-weight:bold">new</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addBlacklist(String ip) {
</span></span><span style="display:flex;"><span>        ips.<span style="color:#007f7f">add</span>(ip);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> removeBlacklist(String ip) {
</span></span><span style="display:flex;"><span>        ips.<span style="color:#007f7f">remove</span>(ip);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> shouldBlock(String ip) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> ips.<span style="color:#007f7f">contains</span>(ip);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªMBeanæ²¡ä»€ä¹ˆç‰¹æ®Šçš„ï¼Œå®ƒçš„é€»è¾‘å’Œæ™®é€šJavaç±»æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p>
<p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨JMXçš„å®¢æˆ·ç«¯æ¥å®æ—¶çƒ­æ›´æ–°è¿™ä¸ªMBeanï¼Œæ‰€ä»¥è¦ç»™å®ƒåŠ ä¸Šä¸€äº›æ³¨è§£ï¼Œè®©Springèƒ½æ ¹æ®æ³¨è§£è‡ªåŠ¨æŠŠç›¸å…³æ–¹æ³•æ³¨å†Œåˆ°MBeanServerä¸­ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@ManagedResource(objectName = <span style="color:#0ff;font-weight:bold">&#34;sample:name=blacklist&#34;</span>, description = <span style="color:#0ff;font-weight:bold">&#34;Blacklist of IP addresses&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> BlacklistMBean {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Set&lt;String&gt; ips = <span style="color:#fff;font-weight:bold">new</span> HashSet&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ManagedAttribute(description = <span style="color:#0ff;font-weight:bold">&#34;Get IP addresses in blacklist&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String[] getBlacklist() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> ips.<span style="color:#007f7f">toArray</span>(String[]::<span style="color:#fff;font-weight:bold">new</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ManagedOperation
</span></span><span style="display:flex;"><span>    @ManagedOperationParameter(name = <span style="color:#0ff;font-weight:bold">&#34;ip&#34;</span>, description = <span style="color:#0ff;font-weight:bold">&#34;Target IP address that will be added to blacklist&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addBlacklist(String ip) {
</span></span><span style="display:flex;"><span>        ips.<span style="color:#007f7f">add</span>(ip);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ManagedOperation
</span></span><span style="display:flex;"><span>    @ManagedOperationParameter(name = <span style="color:#0ff;font-weight:bold">&#34;ip&#34;</span>, description = <span style="color:#0ff;font-weight:bold">&#34;Target IP address that will be removed from blacklist&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> removeBlacklist(String ip) {
</span></span><span style="display:flex;"><span>        ips.<span style="color:#007f7f">remove</span>(ip);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> shouldBlock(String ip) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> ips.<span style="color:#007f7f">contains</span>(ip);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§‚å¯Ÿä¸Šè¿°ä»£ç ï¼Œ<code>BlacklistMBean</code>é¦–å…ˆæ˜¯ä¸€ä¸ªæ ‡å‡†çš„Springç®¡ç†çš„Beanï¼Œå…¶æ¬¡ï¼Œæ·»åŠ äº†<code>@ManagedResource</code>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªMBeanï¼Œå°†è¦è¢«æ³¨å†Œåˆ°JMXã€‚objectNameæŒ‡å®šäº†è¿™ä¸ªMBeançš„åå­—ï¼Œé€šå¸¸ä»¥<code>company:name=Xxx</code>æ¥åˆ†ç±»MBeanã€‚</p>
<p>å¯¹äºå±æ€§ï¼Œä½¿ç”¨<code>@ManagedAttribute</code>æ³¨è§£æ ‡æ³¨ã€‚ä¸Šè¿°MBeanåªæœ‰getå±æ€§ï¼Œæ²¡æœ‰setå±æ€§ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ã€‚</p>
<p>å¯¹äºæ“ä½œï¼Œä½¿ç”¨<code>@ManagedOperation</code>æ³¨è§£æ ‡å‡†ã€‚ä¸Šè¿°MBeanå®šä¹‰äº†ä¸¤ä¸ªæ“ä½œï¼š<code>addBlacklist()</code>å’Œ<code>removeBlacklist()</code>ï¼Œå…¶ä»–æ–¹æ³•å¦‚<code>shouldBlock()</code>ä¸ä¼šè¢«æš´éœ²ç»™JMXã€‚</p>
<p>ä½¿ç”¨MBeanå’Œæ™®é€šBeanæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨<code>BlacklistInterceptor</code>å¯¹IPè¿›è¡Œé»‘åå•æ‹¦æˆªï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Order(1)
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> BlacklistInterceptor <span style="color:#fff;font-weight:bold">implements</span> HandlerInterceptor {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Logger logger = LoggerFactory.<span style="color:#007f7f">getLogger</span>(getClass());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    BlacklistMBean blacklistMBean;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        String ip = request.<span style="color:#007f7f">getRemoteAddr</span>();
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;check ip address {}...&#34;</span>, ip);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ˜¯å¦åœ¨é»‘åå•ä¸­:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (blacklistMBean.<span style="color:#007f7f">shouldBlock</span>(ip)) {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#007f7f">warn</span>(<span style="color:#0ff;font-weight:bold">&#34;will block ip {} for it is in blacklist.&#34;</span>, ip);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å‘é€403é”™è¯¯å“åº”:</span>
</span></span><span style="display:flex;"><span>            response.<span style="color:#007f7f">sendError</span>(403);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‹ä¸€æ­¥å°±æ˜¯æ­£å¸¸å¯åŠ¨Webåº”ç”¨ç¨‹åºï¼Œä¸è¦å…³é—­å®ƒï¼Œæˆ‘ä»¬æ‰“å¼€å¦ä¸€ä¸ªå‘½ä»¤è¡Œçª—å£ï¼Œè¾“å…¥<code>jconsole</code>å¯åŠ¨JavaSEè‡ªå¸¦çš„ä¸€ä¸ªJMXå®¢æˆ·ç«¯ç¨‹åºï¼š</p>
<p><img alt="jconsole" loading="lazy" src="https://liaoxuefeng.com/books/java/spring/integration/jmx/jconsole.png"></p>
<p>é€šè¿‡jconsoleè¿æ¥åˆ°ä¸€ä¸ªJavaè¿›ç¨‹æœ€ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥åœ¨Local Processä¸­æ‰¾åˆ°æ­£åœ¨è¿è¡Œçš„<code>AppConfig</code>ï¼Œç‚¹å‡»Connectå³å¯è¿æ¥åˆ°æˆ‘ä»¬å½“å‰æ­£åœ¨è¿è¡Œçš„Webåº”ç”¨ï¼Œåœ¨jconsoleä¸­å¯ç›´æ¥çœ‹åˆ°å†…å­˜ã€CPUç­‰èµ„æºçš„ç›‘æ§ã€‚</p>
<p>æˆ‘ä»¬ç‚¹å‡»MBeanï¼Œå·¦ä¾§æŒ‰åˆ†ç±»åˆ—å‡ºæ‰€æœ‰MBeanï¼Œå¯ä»¥åœ¨<code>java.lang</code>æŸ¥çœ‹å†…å­˜ç­‰ä¿¡æ¯ï¼š</p>
<p><img alt="mbean" loading="lazy" src="https://liaoxuefeng.com/books/java/spring/integration/jmx/mbeans.png"></p>
<p>ç»†å¿ƒçš„ç«¥é‹å¯ä»¥çœ‹åˆ°HikariCPè¿æ¥æ± ä¹Ÿæ˜¯é€šè¿‡JMXç›‘æ§çš„ã€‚</p>
<p>åœ¨<code>sample</code>ä¸­å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è‡ªå·±çš„MBeanï¼Œç‚¹å‡»å¯æŸ¥çœ‹å±æ€§<code>blacklist</code>ï¼š</p>
<p><img alt="mbean-value" loading="lazy" src="https://liaoxuefeng.com/books/java/spring/integration/jmx/my-mbean.png"></p>
<p>ç‚¹å‡»<code>Operations</code>-<code>addBlacklist</code>ï¼Œå¯ä»¥å¡«å…¥<code>127.0.0.1</code>å¹¶ç‚¹å‡»<code>addBlacklist</code>æŒ‰é’®ï¼Œç›¸å½“äºjconsoleé€šè¿‡JMXæ¥å£ï¼Œè°ƒç”¨äº†æˆ‘ä»¬è‡ªå·±çš„<code>BlacklistMBean</code>çš„<code>addBlacklist()</code>æ–¹æ³•ï¼Œä¼ å…¥çš„å‚æ•°å°±æ˜¯å¡«å…¥çš„<code>127.0.0.1</code>ï¼š</p>
<p><img alt="mbean-invoke-ok" loading="lazy" src="https://liaoxuefeng.com/books/java/spring/integration/jmx/mbean-edit.png"></p>
<p>å†æ¬¡æŸ¥çœ‹å±æ€§<code>blacklist</code>ï¼Œå¯ä»¥çœ‹åˆ°ç»“æœå·²ç»æ›´æ–°äº†ï¼š</p>
<p><img alt="mbean-modified" loading="lazy" src="https://liaoxuefeng.com/books/java/spring/integration/jmx/mbean-attr.png"></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ä¸€ä¸‹é»‘åå•åŠŸèƒ½æ˜¯å¦å·²ç”Ÿæ•ˆï¼š</p>
<p><img alt="403" loading="lazy" src="https://liaoxuefeng.com/books/java/spring/integration/jmx/mbean-enabled.png"></p>
<p>å¯è§ï¼Œ<code>127.0.0.1</code>ç¡®å®è¢«æ·»åŠ åˆ°äº†é»‘åå•ï¼Œåå°æ—¥å¿—æ‰“å°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>2020-06-06 20:22:12 INFO  c.i.l.web.BlacklistInterceptor - check ip address 127.0.0.1...
</span></span><span style="display:flex;"><span>2020-06-06 20:22:12 WARN  c.i.l.web.BlacklistInterceptor - will block ip 127.0.0.1 for it is in blacklist.
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨IPv6ï¼Œé‚£ä¹ˆéœ€è¦æŠŠ<code>0:0:0:0:0:0:0:1</code>è¿™ä¸ªæœ¬æœºåœ°å€åŠ åˆ°é»‘åå•ã€‚</p>
<p>å¦‚æœä»jconsoleä¸­è°ƒç”¨<code>removeBlacklist</code>ç§»é™¤<code>127.0.0.1</code>ï¼Œåˆ·æ–°æµè§ˆå™¨å¯ä»¥çœ‹åˆ°åˆå…è®¸è®¿é—®äº†ã€‚</p>
<p>ä½¿ç”¨jconsoleç›´æ¥é€šè¿‡Local Processè¿æ¥JVMæœ‰ä¸ªé™åˆ¶ï¼Œå°±æ˜¯jconsoleå’Œæ­£åœ¨è¿è¡Œçš„JVMå¿…é¡»åœ¨åŒä¸€å°æœºå™¨ã€‚å¦‚æœè¦è¿œç¨‹è¿æ¥ï¼Œé¦–å…ˆè¦æ‰“å¼€JMXç«¯å£ã€‚æˆ‘ä»¬åœ¨å¯åŠ¨<code>AppConfig</code>æ—¶ï¼Œéœ€è¦ä¼ å…¥ä»¥ä¸‹JVMå¯åŠ¨å‚æ•°ï¼š</p>
<ul>
<li>-Dcom.sun.management.jmxremote.port=19999</li>
<li>-Dcom.sun.management.jmxremote.authenticate=false</li>
<li>-Dcom.sun.management.jmxremote.ssl=false</li>
</ul>
<p>ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºåœ¨19999ç«¯å£ç›‘å¬JMXè¿æ¥ï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ— éœ€éªŒè¯ï¼Œä¸ä½¿ç”¨SSLè¿æ¥ï¼Œåœ¨å¼€å‘æµ‹è¯•é˜¶æ®µæ¯”è¾ƒæ–¹ä¾¿ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»æŒ‡å®šéªŒè¯æ–¹å¼å¹¶å¯ç”¨SSLã€‚è¯¦ç»†å‚æ•°å¯å‚è€ƒOracle<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/management/agent.html#gdeum">å®˜æ–¹æ–‡æ¡£</a>ã€‚è¿™æ ·jconsoleå¯ä»¥ç”¨<code>ip:19999</code>çš„è¿œç¨‹æ–¹å¼è¿æ¥JMXã€‚è¿æ¥åçš„æ“ä½œæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p>
<p>è®¸å¤šJavaEEæœåŠ¡å™¨å¦‚JBossçš„ç®¡ç†åå°éƒ½æ˜¯é€šè¿‡JMXæä¾›ç®¡ç†æ¥å£ï¼Œå¹¶ç”±Webæ–¹å¼è®¿é—®ï¼Œå¯¹ç”¨æˆ·æ›´åŠ å‹å¥½ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œé€šè¿‡JMXå®ç°é…ç½®çš„å®æ—¶æ›´æ–°å…¶å®å¹¶ä¸å¸¸ç”¨ï¼ŒJMXæ›´å¤šåœ°ç”¨äºæ”¶é›†JVMçš„è¿è¡ŒçŠ¶æ€å’Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½æ•°æ®ï¼Œç„¶åé€šè¿‡ç›‘æ§æœåŠ¡å™¨æ±‡æ€»æ•°æ®åå®ç°ç›‘æ§ä¸æŠ¥è­¦ã€‚ä¸€ä¸ªå…¸å‹çš„ç›‘æ§ç³»ç»Ÿæ¶æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>â”‚  Web Console  â”‚â—€â”€â”€â”‚Metrics Server â”‚
</span></span><span style="display:flex;"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>                            â”‚
</span></span><span style="display:flex;"><span>                            â”‚
</span></span><span style="display:flex;"><span>   â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”‚â”€ â”€ â”
</span></span><span style="display:flex;"><span>     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
</span></span><span style="display:flex;"><span>   â”‚ â”‚      App      â”‚      â”‚    â”‚
</span></span><span style="display:flex;"><span>     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¤   â”Œâ”€â”€â”€â”€â”€â”
</span></span><span style="display:flex;"><span>   â”‚ â”‚         â”‚ JMX â”‚â”€â”€â–¶â”‚Agentâ”‚ â”‚
</span></span><span style="display:flex;"><span>     â”‚         â””â”€â”€â”€â”€â”€â”¤   â””â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>   â”‚ â”‚      JVM      â”‚           â”‚
</span></span><span style="display:flex;"><span>     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span style="display:flex;"><span>   â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼ŒAppè‡ªèº«å’ŒJVMçš„çš„ç»Ÿè®¡æ•°æ®éƒ½é€šè¿‡JMXæ”¶é›†å¹¶å‘é€ç»™æœ¬æœºçš„ä¸€ä¸ªAgentï¼ŒAgentå†å°†æ•°æ®å‘é€è‡³ç›‘æ§æœåŠ¡å™¨ï¼Œæœ€åä»¥å¯è§†åŒ–çš„å½¢å¼å°†ç›‘æ§æ•°æ®é€šè¿‡Webç­‰å½¢å¼å±•ç¤ºç»™ç”¨æˆ·ã€‚å¸¸ç”¨çš„ç›‘æ§ç³»ç»Ÿæœ‰å¼€æºçš„<a href="https://prometheus.io/">Prometheus</a>å’Œä»¥äº‘æœåŠ¡æ–¹å¼æä¾›çš„<a href="https://www.datadoghq.com/">DataDog</a>ç­‰ã€‚</p>
<p><strong>å°ç»“</strong></p>
<p>åœ¨Springä¸­ä½¿ç”¨JMXéœ€è¦ï¼š</p>
<ul>
<li>é€šè¿‡<code>@EnableMBeanExport</code>å¯ç”¨è‡ªåŠ¨æ³¨å†ŒMBeanï¼›</li>
<li>ç¼–å†™MBeanå¹¶å®ç°ç®¡ç†å±æ€§å’Œç®¡ç†æ“ä½œã€‚</li>
</ul>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/spring/">Spring</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>