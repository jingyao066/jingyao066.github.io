<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>spring security | Wjy&#39;s Blog</title>
<meta name="keywords" content="spring">
<meta name="description" content="æ¦‚è¿° å®˜ç½‘ï¼šSpring Security å‚è€ƒï¼šspringsecurityè‡ªå­¦ç¬”è®° springsecurity æ˜¯å®‰å…¨æ¡†æ¶ï¼Œå‡†ç¡®æ¥è¯´æ˜¯å®‰å…¨ç®¡ç†æ¡†æ¶ã€‚ç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶Shiroï¼Œs">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://009965.xyz/posts/spring/spring-security/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://009965.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://009965.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://009965.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://009965.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://009965.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://009965.xyz/posts/spring/spring-security/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://009965.xyz/posts/spring/spring-security/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="spring security">
  <meta property="og:description" content="æ¦‚è¿° å®˜ç½‘ï¼šSpring Security å‚è€ƒï¼šspringsecurityè‡ªå­¦ç¬”è®° springsecurity æ˜¯å®‰å…¨æ¡†æ¶ï¼Œå‡†ç¡®æ¥è¯´æ˜¯å®‰å…¨ç®¡ç†æ¡†æ¶ã€‚ç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶Shiroï¼Œs">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-03-10T10:50:58+00:00">
    <meta property="article:modified_time" content="2025-03-10T10:50:58+00:00">
    <meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="spring security">
<meta name="twitter:description" content="æ¦‚è¿° å®˜ç½‘ï¼šSpring Security å‚è€ƒï¼šspringsecurityè‡ªå­¦ç¬”è®° springsecurity æ˜¯å®‰å…¨æ¡†æ¶ï¼Œå‡†ç¡®æ¥è¯´æ˜¯å®‰å…¨ç®¡ç†æ¡†æ¶ã€‚ç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶Shiroï¼Œs">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://009965.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "spring security",
      "item": "https://009965.xyz/posts/spring/spring-security/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "spring security",
  "name": "spring security",
  "description": "æ¦‚è¿° å®˜ç½‘ï¼šSpring Security å‚è€ƒï¼šspringsecurityè‡ªå­¦ç¬”è®° springsecurity æ˜¯å®‰å…¨æ¡†æ¶ï¼Œå‡†ç¡®æ¥è¯´æ˜¯å®‰å…¨ç®¡ç†æ¡†æ¶ã€‚ç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶Shiroï¼Œs",
  "keywords": [
    "spring"
  ],
  "articleBody": "æ¦‚è¿° å®˜ç½‘ï¼šSpring Security\nå‚è€ƒï¼šspringsecurityè‡ªå­¦ç¬”è®°\nspringsecurity æ˜¯å®‰å…¨æ¡†æ¶ï¼Œå‡†ç¡®æ¥è¯´æ˜¯å®‰å…¨ç®¡ç†æ¡†æ¶ã€‚ç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶Shiroï¼Œspringsecurity æä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œç¤¾åŒºèµ„æºä¹Ÿæ¯”Shiroä¸°å¯Œã€‚ springsecurity æ¡†æ¶ç”¨äºWebåº”ç”¨çš„éœ€è¦è¿›è¡Œè®¤è¯å’Œæˆæƒã€‚\nè®¤è¯ï¼šéªŒè¯å½“å‰è®¿é—®ç³»ç»Ÿçš„æ˜¯ä¸æ˜¯æœ¬ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå¹¶ä¸”è¦ç¡®è®¤å…·ä½“æ˜¯å“ªä¸ªç”¨æˆ·ã€‚\næˆæƒï¼šç»è¿‡è®¤è¯ååˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡ŒæŸä¸ªæ“ä½œã€‚ è®¤è¯å’Œæˆæƒä¹Ÿæ˜¯SpringSecurityä½œä¸ºå®‰å…¨æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½ ã€‚\nå¿«é€Ÿå¼€å§‹ æ–°å»ºspring boot é¡¹ç›®ï¼Œå¼•å…¥ä¾èµ–ï¼š\n1 2 3 4 5 6 7 8 9 org.springframework.boot spring-boot-starter-web org.projectlombok lombok true åˆ›å»ºæµ‹è¯•controller\n1 2 3 4 5 6 7 8 9 10 11 12 13 package com.wjy.springsecurity.controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class HelloController { @GetMapping(\"/hello\") public String hello(){ return \"ä½ å¥½\"; } } å¯åŠ¨é¡¹ç›®ï¼Œæµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8080/helloï¼Œçœ‹åˆ°ä½ å¥½ï¼Œè¯æ˜é¡¹ç›®æ­å»ºæˆåŠŸã€‚\næ•´åˆSpring Security 1 2 3 4 org.springframework.boot spring-boot-starter-security åˆ·æ–°mavenåé‡å¯é¡¹ç›®ï¼Œå†æ¬¡å°è¯•è®¿é—®ä¹‹å‰çš„æ¥å£ï¼Œå°±ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°ä¸€ä¸ªSpringSecurityçš„é»˜è®¤ç™»å½•é¡µé¢ï¼Œæ­¤æ—¶é¡µé¢çš„åœ°å€ä¸ºï¼šhttp://localhost:8080/login é»˜è®¤ç”¨æˆ·åä¸ºï¼šuserï¼Œå¯†ç åœ¨é¡¹ç›®å¯åŠ¨æ—¶æ‰“å°åœ¨æ§åˆ¶å°äº†ï¼š\n1 Using generated security password: 409fce70-25d6-49a2-8c6b-8bda3a95ba68 è¿™ä¸ªå¯†ç æ˜¯éšæœºçš„ã€‚ åœ¨é¡µé¢è¾“å…¥ç”¨æˆ·åå¯†ç åï¼Œä¼šé‡å®šå‘åˆ°helloæ¥å£ï¼š é»˜è®¤çš„é€€å‡ºç™»å½•æ¥å£æ˜¯ï¼š\n1 http://localhost:8080/logout ç‚¹å‡»log outï¼Œç™»å½•çŠ¶æ€å°±ä¼šæ¶ˆå¤±ï¼Œå†æ¬¡è®¿é—®helloæ¥å£ï¼Œå°±åˆä¼šå‡ºç°ç™»å½•é¡µé¢ã€‚\nè®¤è¯-å‰åç«¯äº¤äº’æµç¨‹ Spring SecurityåŸç† SpringSecurityçš„åŸç†å…¶å®å°±æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå†…éƒ¨åŒ…å«äº†æä¾›å„ç§åŠŸèƒ½çš„è¿‡æ»¤å™¨ã€‚ä¾‹å¦‚å¿«é€Ÿå…¥é—¨æ¡ˆä¾‹é‡Œé¢ä½¿ç”¨åˆ°çš„ä¸‰ç§è¿‡æ»¤å™¨ï¼Œå¦‚ä¸‹å›¾ï¼š\nç›‘å¬å™¨ -\u003e è¿‡æ»¤å™¨é“¾ -\u003e dispatcherservlet(å‰ç½®æ‹¦æˆªå™¨ -\u003e mapperHandle -\u003e åç½®æ‹¦æˆªå™¨ -\u003e æœ€ç»ˆæ‹¦æˆªå™¨) UsernamePasswordAuthenticationFilterï¼š è´Ÿè´£å¤„ç†æˆ‘ä»¬åœ¨ç™»é™†é¡µé¢å¡«å†™äº†ç”¨æˆ·åå¯†ç åçš„ç™»é™†è¯·æ±‚ã€‚å…¥é—¨æ¡ˆä¾‹çš„è®¤è¯å·¥ä½œä¸»è¦æœ‰å®ƒè´Ÿè´£ã€‚\nExceptionTranslationFilterï¼š å¤„ç†è¿‡æ»¤å™¨é“¾ä¸­æŠ›å‡ºçš„ä»»ä½•AccessDeniedExceptionå’ŒAuthenticationExceptionã€‚\nFilterSecurityInterceptorï¼šè´Ÿè´£æƒé™æ ¡éªŒçš„è¿‡æ»¤å™¨ã€‚\næ³¨æ„ä¸Šå›¾ï¼Œæ©™è‰²éƒ¨åˆ†è¡¨ç¤ºè®¤è¯ï¼Œé»„è‰²éƒ¨åˆ†è¡¨ç¤ºå¼‚å¸¸å¤„ç†ï¼Œçº¢è‰²éƒ¨åˆ†è¡¨ç¤ºæˆæƒã€‚\næŸ¥çœ‹å…±æœ‰å¤šå°‘ç§filterï¼š\n1 2 3 4 5 6 7 8 9 10 @SpringBootApplication public class SpringSecurityApplication { public static void main(String[] args) { ConfigurableApplicationContext run = SpringApplication.run(SpringSecurityApplication.class, args); DefaultSecurityFilterChain bean = run.getBean(DefaultSecurityFilterChain.class); List filters = bean.getFilters(); for (Filter filter : filters) { System.out.println(filter.getClass().getName()); } } } è®¤è¯æµç¨‹ Authenticationæ¥å£ï¼šå®ƒçš„å®ç°ç±»ï¼Œè¡¨ç¤ºå½“å‰è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå°è£…äº†ç”¨æˆ·ç›¸å…³ä¿¡æ¯ã€‚ AuthenticationManageræ¥å£ï¼šå®šä¹‰äº†è®¤è¯Authenticationçš„æ–¹æ³•ã€‚ UserDetailsServiceæ¥å£ï¼šåŠ è½½ç”¨æˆ·ç‰¹å®šæ•°æ®çš„æ ¸å¿ƒæ¥å£ã€‚é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•ã€‚ UserDetailsæ¥å£ï¼šæä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚é€šè¿‡UserDetailsServiceæ ¹æ®ç”¨æˆ·åè·å–å¤„ç†çš„ç”¨æˆ·ä¿¡æ¯è¦å°è£…æˆUserDetailså¯¹è±¡è¿”å›ã€‚ç„¶åå°†è¿™äº›ä¿¡æ¯å°è£…åˆ°Authenticationå¯¹è±¡ä¸­ã€‚\nè‡ªå®šä¹‰securityæ€è·¯ åœ¨ â€˜å¿«é€Ÿå¼€å§‹â€™ ä¸­ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®é‡Œé¢å¼•å…¥äº†Securityä¾èµ–ï¼Œå®ç°äº†å½“æˆ‘ä»¬è®¿é—®æŸä¸ªä¸šåŠ¡æ¥å£æ—¶ï¼Œä¼šè¢«Securityçš„loginæ¥å£æ‹¦æˆªï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸æƒ³ä½¿ç”¨Securityé»˜è®¤çš„ç™»å½•é¡µé¢ï¼Œé‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Œè¿˜æœ‰ï¼ŒSpring Securityçš„æ ¡éªŒï¼Œæˆ‘ä»¬å¸Œæœ›æ˜¯æ ¹æ®æ•°æ®åº“æ¥åšæ ¡éªŒï¼Œé‚£ä¹ˆæ€ä¹ˆå®ç°å‘¢ã€‚æˆ‘ä»¬éœ€è¦å®ç°å¦‚ä¸‹ï¼š\nã€ç™»å½•-æœªå®ç°ã€‘ â‘ ã€è‡ªå®šä¹‰ç™»å½•æ¥å£ã€‚ç”¨äºè°ƒç”¨ProviderManagerçš„æ–¹æ³•è¿›è¡Œè®¤è¯ å¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆjwtï¼Œç„¶åæŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisä¸­ã€‚ â‘¡ã€è‡ªå®šä¹‰UserDetailsServiceæ¥å£çš„å®ç°ç±»ã€‚åœ¨è¿™ä¸ªå®ç°ç±»ä¸­å»æŸ¥è¯¢æ•°æ®åº“ã€‚\nã€æ ¡éªŒ-æœªå®ç°ã€‘ â‘ ã€å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨ã€‚ç”¨äºè·å–tokenï¼Œç„¶åè§£ætokenè·å–å…¶ä¸­çš„useridï¼Œè¿˜éœ€è¦ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åå­˜å…¥SecurityContextHolderã€‚\nåŸºç¡€ä»£ç è¡¥å…¨ å®Œæ•´pomå¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e ",
  "wordCount" : "20145",
  "inLanguage": "en",
  "datePublished": "2025-03-10T10:50:58Z",
  "dateModified": "2025-03-10T10:50:58Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://009965.xyz/posts/spring/spring-security/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://009965.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;Â»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      spring security
    </h1>
    <div class="post-meta"><span title='2025-03-10 10:50:58 +0000 UTC'>2025-03-10</span>&nbsp;Â·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%a6%82%e8%bf%b0" aria-label="æ¦‚è¿°">æ¦‚è¿°</a></li>
                <li>
                    <a href="#%e5%bf%ab%e9%80%9f%e5%bc%80%e5%a7%8b" aria-label="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a><ul>
                        
                <li>
                    <a href="#%e6%95%b4%e5%90%88spring-security" aria-label="æ•´åˆSpring Security">æ•´åˆSpring Security</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%ae%a4%e8%af%81-%e5%89%8d%e5%90%8e%e7%ab%af%e4%ba%a4%e4%ba%92%e6%b5%81%e7%a8%8b" aria-label="è®¤è¯-å‰åç«¯äº¤äº’æµç¨‹">è®¤è¯-å‰åç«¯äº¤äº’æµç¨‹</a></li>
                <li>
                    <a href="#spring-security%e5%8e%9f%e7%90%86" aria-label="Spring SecurityåŸç†">Spring SecurityåŸç†</a></li>
                <li>
                    <a href="#%e8%ae%a4%e8%af%81%e6%b5%81%e7%a8%8b" aria-label="è®¤è¯æµç¨‹">è®¤è¯æµç¨‹</a></li>
                <li>
                    <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89security%e6%80%9d%e8%b7%af" aria-label="è‡ªå®šä¹‰securityæ€è·¯">è‡ªå®šä¹‰securityæ€è·¯</a></li>
                <li>
                    <a href="#%e5%9f%ba%e7%a1%80%e4%bb%a3%e7%a0%81%e8%a1%a5%e5%85%a8" aria-label="åŸºç¡€ä»£ç è¡¥å…¨">åŸºç¡€ä»£ç è¡¥å…¨</a><ul>
                        
                <li>
                    <a href="#%e5%ae%8c%e6%95%b4pom%e5%a6%82%e4%b8%8b" aria-label="å®Œæ•´pomå¦‚ä¸‹ï¼š">å®Œæ•´pomå¦‚ä¸‹ï¼š</a></li>
                <li>
                    <a href="#fastjson%e5%ba%8f%e5%88%97%e5%8c%96%e5%b7%a5%e5%85%b7%e7%b1%bb" aria-label="FastJsonåºåˆ—åŒ–å·¥å…·ç±»ï¼š">FastJsonåºåˆ—åŒ–å·¥å…·ç±»ï¼š</a></li>
                <li>
                    <a href="#redis%e9%85%8d%e7%bd%ae%e7%b1%bb" aria-label="redisé…ç½®ç±»ï¼š">redisé…ç½®ç±»ï¼š</a></li>
                <li>
                    <a href="#%e5%93%8d%e5%ba%94%e5%b7%a5%e5%85%b7%e7%b1%bb" aria-label="å“åº”å·¥å…·ç±»ï¼š">å“åº”å·¥å…·ç±»ï¼š</a></li>
                <li>
                    <a href="#jwt%e5%b7%a5%e5%85%b7%e7%b1%bb" aria-label="jwtå·¥å…·ç±»ï¼š">jwtå·¥å…·ç±»ï¼š</a></li>
                <li>
                    <a href="#redis%e5%b7%a5%e5%85%b7%e7%b1%bb" aria-label="rediså·¥å…·ç±»ï¼š">rediså·¥å…·ç±»ï¼š</a></li>
                <li>
                    <a href="#webutils%e5%b7%a5%e5%85%b7%e7%b1%bb" aria-label="WebUtilså·¥å…·ç±»ï¼š">WebUtilså·¥å…·ç±»ï¼š</a></li>
                <li>
                    <a href="#user%e7%b1%bb" aria-label="userç±»ï¼š">userç±»ï¼š</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="æ•°æ®åº“">æ•°æ®åº“</a></li>
                <li>
                    <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89security%e7%9a%84%e8%ae%a4%e8%af%81%e5%ae%9e%e7%8e%b0" aria-label="è‡ªå®šä¹‰securityçš„è®¤è¯å®ç°">è‡ªå®šä¹‰securityçš„è®¤è¯å®ç°</a></li>
                <li>
                    <a href="#%e5%af%86%e7%a0%81%e6%a0%a1%e9%aa%8c%e9%97%ae%e9%a2%98" aria-label="å¯†ç æ ¡éªŒé—®é¢˜">å¯†ç æ ¡éªŒé—®é¢˜</a></li>
                <li>
                    <a href="#jwt%e5%b7%a5%e5%85%b7%e7%b1%bb%e5%ae%9e%e7%8e%b0%e5%8a%a0%e5%af%86%e6%a0%a1%e9%aa%8c" aria-label="jwtå·¥å…·ç±»å®ç°åŠ å¯†æ ¡éªŒ">jwtå·¥å…·ç±»å®ç°åŠ å¯†æ ¡éªŒ</a></li>
                <li>
                    <a href="#%e7%99%bb%e5%bd%95%e6%8e%a5%e5%8f%a3%e7%9a%84%e5%88%86%e6%9e%90" aria-label="ç™»å½•æ¥å£çš„åˆ†æ">ç™»å½•æ¥å£çš„åˆ†æ</a></li>
                <li>
                    <a href="#%e7%99%bb%e5%bd%95%e6%8e%a5%e5%8f%a3%e7%9a%84%e5%ae%9e%e7%8e%b0" aria-label="ç™»å½•æ¥å£çš„å®ç°">ç™»å½•æ¥å£çš„å®ç°</a></li>
                <li>
                    <a href="#jwt%e8%ae%a4%e8%af%81%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="jwtè®¤è¯è¿‡æ»¤å™¨">jwtè®¤è¯è¿‡æ»¤å™¨</a></li>
                <li>
                    <a href="#%e6%8e%88%e6%9d%83" aria-label="æˆæƒ">æˆæƒ</a><ul>
                        
                <li>
                    <a href="#%e6%9d%83%e9%99%90%e7%b3%bb%e7%bb%9f%e7%9a%84%e4%bd%9c%e7%94%a8" aria-label="æƒé™ç³»ç»Ÿçš„ä½œç”¨">æƒé™ç³»ç»Ÿçš„ä½œç”¨</a></li>
                <li>
                    <a href="#%e6%8e%88%e6%9d%83%e5%9f%ba%e6%9c%ac%e6%b5%81%e7%a8%8b" aria-label="æˆæƒåŸºæœ¬æµç¨‹">æˆæƒåŸºæœ¬æµç¨‹</a></li>
                <li>
                    <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e8%ae%bf%e9%97%ae%e8%b7%af%e5%be%84%e7%9a%84%e6%9d%83%e9%99%90" aria-label="è‡ªå®šä¹‰è®¿é—®è·¯å¾„çš„æƒé™">è‡ªå®šä¹‰è®¿é—®è·¯å¾„çš„æƒé™</a></li>
                <li>
                    <a href="#%e5%b8%a6%e6%9d%83%e9%99%90%e8%ae%bf%e9%97%ae%e7%9a%84%e5%ae%9e%e7%8e%b0" aria-label="å¸¦æƒé™è®¿é—®çš„å®ç°">å¸¦æƒé™è®¿é—®çš„å®ç°</a></li></ul>
                </li>
                <li>
                    <a href="#rbac%e6%9d%83%e9%99%90%e6%a8%a1%e5%9e%8b" aria-label="RBACæƒé™æ¨¡å‹">RBACæƒé™æ¨¡å‹</a></li>
                <li>
                    <a href="#%e6%9d%83%e9%99%90%e8%a1%a8%e5%88%9b%e5%bb%ba" aria-label="æƒé™è¡¨åˆ›å»º">æƒé™è¡¨åˆ›å»º</a></li>
                <li>
                    <a href="#%e6%9f%a5%e8%af%a2%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e6%9d%83%e9%99%90%e4%bf%a1%e6%81%af" aria-label="æŸ¥è¯¢æ•°æ®åº“çš„æƒé™ä¿¡æ¯">æŸ¥è¯¢æ•°æ®åº“çš„æƒé™ä¿¡æ¯</a></li>
                <li>
                    <a href="#rbac%e6%9d%83%e9%99%90%e6%a8%a1%e5%9e%8b%e7%9a%84%e5%ae%9e%e7%8e%b0" aria-label="RBACæƒé™æ¨¡å‹çš„å®ç°">RBACæƒé™æ¨¡å‹çš„å®ç°</a></li>
                <li>
                    <a href="#-%e8%87%aa%e5%ae%9a%e4%b9%89%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86" aria-label="# è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†"># è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</a></li>
                <li>
                    <a href="#%e8%b7%a8%e5%9f%9f" aria-label="è·¨åŸŸ">è·¨åŸŸ</a></li>
                <li>
                    <a href="#%e6%9d%83%e9%99%90%e6%a0%a1%e9%aa%8c%e6%96%b9%e6%b3%95" aria-label="æƒé™æ ¡éªŒæ–¹æ³•">æƒé™æ ¡éªŒæ–¹æ³•</a><ul>
                        
                <li>
                    <a href="#hasauthorityhasanyauthority" aria-label="hasAuthorityã€hasAnyAuthority">hasAuthorityã€hasAnyAuthority</a></li>
                <li>
                    <a href="#hasrolehasanyrole" aria-label="hasRoleã€hasAnyRole">hasRoleã€hasAnyRole</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e6%9d%83%e9%99%90%e6%a0%a1%e9%aa%8c%e7%9a%84%e6%96%b9%e6%b3%95" aria-label="è‡ªå®šä¹‰æƒé™æ ¡éªŒçš„æ–¹æ³•">è‡ªå®šä¹‰æƒé™æ ¡éªŒçš„æ–¹æ³•</a></li>
                <li>
                    <a href="#%e5%9f%ba%e4%ba%8e%e9%85%8d%e7%bd%ae%e7%9a%84%e6%9d%83%e9%99%90%e6%8e%a7%e5%88%b6" aria-label="åŸºäºé…ç½®çš„æƒé™æ§åˆ¶">åŸºäºé…ç½®çš„æƒé™æ§åˆ¶</a></li>
                <li>
                    <a href="#csrf%e9%98%b2%e6%8a%a4" aria-label="CSRFé˜²æŠ¤">CSRFé˜²æŠ¤</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="æ¦‚è¿°">æ¦‚è¿°<a hidden class="anchor" aria-hidden="true" href="#æ¦‚è¿°">#</a></h1>
<p>å®˜ç½‘ï¼š<a href="https://spring.io/projects/spring-security">Spring Security</a></p>
<p>å‚è€ƒï¼š<a href="https://www.yuque.com/huanfqc/springsecurity/springsecurity">springsecurityè‡ªå­¦ç¬”è®°</a></p>
<p>springsecurity æ˜¯å®‰å…¨æ¡†æ¶ï¼Œå‡†ç¡®æ¥è¯´æ˜¯å®‰å…¨ç®¡ç†æ¡†æ¶ã€‚ç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶<strong>Shiro</strong>ï¼Œspringsecurity æä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œç¤¾åŒºèµ„æºä¹Ÿæ¯”Shiroä¸°å¯Œã€‚
springsecurity æ¡†æ¶ç”¨äºWebåº”ç”¨çš„éœ€è¦è¿›è¡Œè®¤è¯å’Œæˆæƒã€‚</p>
<p>è®¤è¯ï¼šéªŒè¯å½“å‰è®¿é—®ç³»ç»Ÿçš„æ˜¯ä¸æ˜¯æœ¬ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå¹¶ä¸”è¦ç¡®è®¤å…·ä½“æ˜¯å“ªä¸ªç”¨æˆ·ã€‚</p>
<p>æˆæƒï¼šç»è¿‡è®¤è¯ååˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡ŒæŸä¸ªæ“ä½œã€‚ è®¤è¯å’Œæˆæƒä¹Ÿæ˜¯SpringSecurityä½œä¸ºå®‰å…¨æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½ ã€‚</p>
<h1 id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹<a hidden class="anchor" aria-hidden="true" href="#å¿«é€Ÿå¼€å§‹">#</a></h1>
<p>æ–°å»ºspring boot é¡¹ç›®ï¼Œå¼•å…¥ä¾èµ–ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;groupId&gt;</span>org.projectlombok<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;artifactId&gt;</span>lombok<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;optional&gt;</span>true<span style="font-weight:bold">&lt;/optional&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»ºæµ‹è¯•controller</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.controller;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.GetMapping;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.RestController;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@RestController  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HelloController {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/hello&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String hello(){  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;ä½ å¥½&#34;</span>;  
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯åŠ¨é¡¹ç›®ï¼Œæµè§ˆå™¨è®¿é—®ï¼š<code>http://localhost:8080/hello</code>ï¼Œçœ‹åˆ°<strong>ä½ å¥½</strong>ï¼Œè¯æ˜é¡¹ç›®æ­å»ºæˆåŠŸã€‚</p>
<h2 id="æ•´åˆspring-security">æ•´åˆSpring Security<a hidden class="anchor" aria-hidden="true" href="#æ•´åˆspring-security">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-security<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ·æ–°mavenåé‡å¯é¡¹ç›®ï¼Œå†æ¬¡å°è¯•è®¿é—®ä¹‹å‰çš„æ¥å£ï¼Œå°±ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°ä¸€ä¸ªSpringSecurityçš„é»˜è®¤ç™»å½•é¡µé¢ï¼Œæ­¤æ—¶é¡µé¢çš„åœ°å€ä¸ºï¼š<code>http://localhost:8080/login</code>
<img loading="lazy" src="/posts/spring/spring-security/%E9%BB%98%E8%AE%A4%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2.png">
é»˜è®¤ç”¨æˆ·åä¸ºï¼šuserï¼Œå¯†ç åœ¨é¡¹ç›®å¯åŠ¨æ—¶æ‰“å°åœ¨æ§åˆ¶å°äº†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Using generated security password: 409fce70-25d6-49a2-8c6b-8bda3a95ba68
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå¯†ç æ˜¯éšæœºçš„ã€‚
åœ¨é¡µé¢è¾“å…¥ç”¨æˆ·åå¯†ç åï¼Œä¼šé‡å®šå‘åˆ°helloæ¥å£ï¼š
<img loading="lazy" src="/posts/spring/spring-security/%E7%99%BB%E5%BD%95%E5%90%8E.png"></p>
<p>é»˜è®¤çš„é€€å‡ºç™»å½•æ¥å£æ˜¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>http://localhost:8080/logout
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/posts/spring/spring-security/logout.png">
ç‚¹å‡»log outï¼Œç™»å½•çŠ¶æ€å°±ä¼šæ¶ˆå¤±ï¼Œå†æ¬¡è®¿é—®helloæ¥å£ï¼Œå°±åˆä¼šå‡ºç°ç™»å½•é¡µé¢ã€‚</p>
<h1 id="è®¤è¯-å‰åç«¯äº¤äº’æµç¨‹">è®¤è¯-å‰åç«¯äº¤äº’æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#è®¤è¯-å‰åç«¯äº¤äº’æµç¨‹">#</a></h1>
<p><img loading="lazy" src="/posts/spring/spring-security/%E5%89%8D%E5%90%8E%E7%AB%AF%E8%AE%A4%E8%AF%81%E4%BA%A4%E4%BA%92%E6%B5%81%E7%A8%8B.png"></p>
<h1 id="spring-securityåŸç†">Spring SecurityåŸç†<a hidden class="anchor" aria-hidden="true" href="#spring-securityåŸç†">#</a></h1>
<p>SpringSecurityçš„åŸç†å…¶å®å°±æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå†…éƒ¨åŒ…å«äº†æä¾›å„ç§åŠŸèƒ½çš„è¿‡æ»¤å™¨ã€‚ä¾‹å¦‚å¿«é€Ÿå…¥é—¨æ¡ˆä¾‹é‡Œé¢ä½¿ç”¨åˆ°çš„ä¸‰ç§è¿‡æ»¤å™¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p>ç›‘å¬å™¨ -&gt; è¿‡æ»¤å™¨é“¾ -&gt; dispatcherservlet(å‰ç½®æ‹¦æˆªå™¨ -&gt; mapperHandle -&gt; åç½®æ‹¦æˆªå™¨ -&gt; æœ€ç»ˆæ‹¦æˆªå™¨)
<img loading="lazy" src="/posts/spring/spring-security/Spring-Security%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE.png"></p>
<p><code>UsernamePasswordAuthenticationFilter</code>ï¼š
è´Ÿè´£å¤„ç†æˆ‘ä»¬åœ¨ç™»é™†é¡µé¢å¡«å†™äº†ç”¨æˆ·åå¯†ç åçš„ç™»é™†è¯·æ±‚ã€‚å…¥é—¨æ¡ˆä¾‹çš„è®¤è¯å·¥ä½œä¸»è¦æœ‰å®ƒè´Ÿè´£ã€‚</p>
<p><code>ExceptionTranslationFilter</code>ï¼š
å¤„ç†è¿‡æ»¤å™¨é“¾ä¸­æŠ›å‡ºçš„ä»»ä½•AccessDeniedExceptionå’ŒAuthenticationExceptionã€‚</p>
<p><code>FilterSecurityInterceptor</code>ï¼šè´Ÿè´£æƒé™æ ¡éªŒçš„è¿‡æ»¤å™¨ã€‚</p>
<p>æ³¨æ„ä¸Šå›¾ï¼Œæ©™è‰²éƒ¨åˆ†è¡¨ç¤ºè®¤è¯ï¼Œé»„è‰²éƒ¨åˆ†è¡¨ç¤ºå¼‚å¸¸å¤„ç†ï¼Œçº¢è‰²éƒ¨åˆ†è¡¨ç¤ºæˆæƒã€‚</p>
<p>æŸ¥çœ‹å…±æœ‰å¤šå°‘ç§filterï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@SpringBootApplication  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SpringSecurityApplication {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {  
</span></span><span style="display:flex;"><span>       ConfigurableApplicationContext run = SpringApplication.<span style="color:#007f7f">run</span>(SpringSecurityApplication.<span style="color:#007f7f">class</span>, args);  
</span></span><span style="display:flex;"><span>       DefaultSecurityFilterChain bean = run.<span style="color:#007f7f">getBean</span>(DefaultSecurityFilterChain.<span style="color:#007f7f">class</span>);  
</span></span><span style="display:flex;"><span>       List&lt;Filter&gt; filters = bean.<span style="color:#007f7f">getFilters</span>();       <span style="color:#fff;font-weight:bold">for</span> (Filter filter : filters) {  
</span></span><span style="display:flex;"><span>          System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(filter.<span style="color:#007f7f">getClass</span>().<span style="color:#007f7f">getName</span>());  
</span></span><span style="display:flex;"><span>       }    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="è®¤è¯æµç¨‹">è®¤è¯æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#è®¤è¯æµç¨‹">#</a></h1>
<p>Authenticationæ¥å£ï¼šå®ƒçš„å®ç°ç±»ï¼Œè¡¨ç¤ºå½“å‰è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå°è£…äº†ç”¨æˆ·ç›¸å…³ä¿¡æ¯ã€‚
AuthenticationManageræ¥å£ï¼šå®šä¹‰äº†è®¤è¯Authenticationçš„æ–¹æ³•ã€‚
UserDetailsServiceæ¥å£ï¼šåŠ è½½ç”¨æˆ·ç‰¹å®šæ•°æ®çš„æ ¸å¿ƒæ¥å£ã€‚é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•ã€‚
UserDetailsæ¥å£ï¼šæä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚é€šè¿‡UserDetailsServiceæ ¹æ®ç”¨æˆ·åè·å–å¤„ç†çš„ç”¨æˆ·ä¿¡æ¯è¦å°è£…æˆUserDetailså¯¹è±¡è¿”å›ã€‚ç„¶åå°†è¿™äº›ä¿¡æ¯å°è£…åˆ°Authenticationå¯¹è±¡ä¸­ã€‚<br>
<img loading="lazy" src="/posts/spring/spring-security/%E8%AE%A4%E8%AF%81.png"></p>
<h1 id="è‡ªå®šä¹‰securityæ€è·¯">è‡ªå®šä¹‰securityæ€è·¯<a hidden class="anchor" aria-hidden="true" href="#è‡ªå®šä¹‰securityæ€è·¯">#</a></h1>
<p>åœ¨ &lsquo;å¿«é€Ÿå¼€å§‹&rsquo; ä¸­ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®é‡Œé¢å¼•å…¥äº†Securityä¾èµ–ï¼Œå®ç°äº†å½“æˆ‘ä»¬è®¿é—®æŸä¸ªä¸šåŠ¡æ¥å£æ—¶ï¼Œä¼šè¢«Securityçš„loginæ¥å£æ‹¦æˆªï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸æƒ³ä½¿ç”¨Securityé»˜è®¤çš„ç™»å½•é¡µé¢ï¼Œé‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Œè¿˜æœ‰ï¼ŒSpring Securityçš„æ ¡éªŒï¼Œæˆ‘ä»¬å¸Œæœ›æ˜¯æ ¹æ®æ•°æ®åº“æ¥åšæ ¡éªŒï¼Œé‚£ä¹ˆæ€ä¹ˆå®ç°å‘¢ã€‚æˆ‘ä»¬éœ€è¦å®ç°å¦‚ä¸‹ï¼š</p>
<p>ã€ç™»å½•-æœªå®ç°ã€‘
â‘ ã€è‡ªå®šä¹‰ç™»å½•æ¥å£ã€‚ç”¨äºè°ƒç”¨ProviderManagerçš„æ–¹æ³•è¿›è¡Œè®¤è¯ å¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆjwtï¼Œç„¶åæŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisä¸­ã€‚
â‘¡ã€è‡ªå®šä¹‰UserDetailsServiceæ¥å£çš„å®ç°ç±»ã€‚åœ¨è¿™ä¸ªå®ç°ç±»ä¸­å»æŸ¥è¯¢æ•°æ®åº“ã€‚</p>
<p>ã€æ ¡éªŒ-æœªå®ç°ã€‘
â‘ ã€å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨ã€‚ç”¨äºè·å–tokenï¼Œç„¶åè§£ætokenè·å–å…¶ä¸­çš„useridï¼Œè¿˜éœ€è¦ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åå­˜å…¥SecurityContextHolderã€‚</p>
<h1 id="åŸºç¡€ä»£ç è¡¥å…¨">åŸºç¡€ä»£ç è¡¥å…¨<a hidden class="anchor" aria-hidden="true" href="#åŸºç¡€ä»£ç è¡¥å…¨">#</a></h1>
<h2 id="å®Œæ•´pomå¦‚ä¸‹">å®Œæ•´pomå¦‚ä¸‹ï¼š<a hidden class="anchor" aria-hidden="true" href="#å®Œæ•´pomå¦‚ä¸‹">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;project</span> <span style="color:#007f7f">xmlns=</span><span style="color:#0ff;font-weight:bold">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span style="color:#007f7f">xmlns:xsi=</span><span style="color:#0ff;font-weight:bold">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">xsi:schemaLocation=</span><span style="color:#0ff;font-weight:bold">&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="font-weight:bold">&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;modelVersion&gt;</span>4.0.0<span style="font-weight:bold">&lt;/modelVersion&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;parent&gt;</span>       <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-parent<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;version&gt;</span>3.4.3<span style="font-weight:bold">&lt;/version&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;relativePath/&gt;</span> <span style="color:#007f7f">&lt;!-- lookup parent from repository --&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/parent&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>com.wjy<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-security<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;version&gt;</span>0.0.1-SNAPSHOT<span style="font-weight:bold">&lt;/version&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;name&gt;</span>spring-security<span style="font-weight:bold">&lt;/name&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;description&gt;</span>spring-security<span style="font-weight:bold">&lt;/description&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;url/&gt;</span>    <span style="font-weight:bold">&lt;licenses&gt;</span>       <span style="font-weight:bold">&lt;license/&gt;</span>    <span style="font-weight:bold">&lt;/licenses&gt;</span>    <span style="font-weight:bold">&lt;developers&gt;</span>       <span style="font-weight:bold">&lt;developer/&gt;</span>    <span style="font-weight:bold">&lt;/developers&gt;</span>    <span style="font-weight:bold">&lt;scm&gt;</span>       <span style="font-weight:bold">&lt;connection/&gt;</span>       <span style="font-weight:bold">&lt;developerConnection/&gt;</span>       <span style="font-weight:bold">&lt;tag/&gt;</span>       <span style="font-weight:bold">&lt;url/&gt;</span>    <span style="font-weight:bold">&lt;/scm&gt;</span>    <span style="font-weight:bold">&lt;properties&gt;</span>       <span style="font-weight:bold">&lt;java.version&gt;</span>21<span style="font-weight:bold">&lt;/java.version&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/properties&gt;</span>    <span style="font-weight:bold">&lt;dependencies&gt;</span>       <span style="font-weight:bold">&lt;dependency&gt;</span>          <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;dependency&gt;</span>          <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;scope&gt;</span>test<span style="font-weight:bold">&lt;/scope&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;dependency&gt;</span>          <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;dependency&gt;</span>          <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-security<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#007f7f">&lt;!--redisä¾èµ–--&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#007f7f">&lt;!--jwtä¾èµ–--&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;groupId&gt;</span>io.jsonwebtoken<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;artifactId&gt;</span>jjwt<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;version&gt;</span>0.12.6<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#007f7f">&lt;!--å¼•å…¥Lombokä¾èµ–ï¼Œæ–¹ä¾¿å®ä½“ç±»å¼€å‘--&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;groupId&gt;</span>org.projectlombok<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;artifactId&gt;</span>lombok<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#007f7f">&lt;!--fastjsonä¾èµ–--&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;groupId&gt;</span>com.alibaba<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;artifactId&gt;</span>fastjson<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;version&gt;</span>1.2.33<span style="font-weight:bold">&lt;/version&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;dependency&gt;</span>          <span style="font-weight:bold">&lt;groupId&gt;</span>com.baomidou<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;artifactId&gt;</span>mybatis-plus-spring-boot3-starter<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;version&gt;</span>3.5.10.1<span style="font-weight:bold">&lt;/version&gt;</span>  
</span></span><span style="display:flex;"><span>       <span style="font-weight:bold">&lt;/dependency&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/dependencies&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;build&gt;</span>       <span style="font-weight:bold">&lt;plugins&gt;</span>          <span style="font-weight:bold">&lt;plugin&gt;</span>             <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>             <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">&lt;/plugin&gt;</span>       <span style="font-weight:bold">&lt;/plugins&gt;</span>    <span style="font-weight:bold">&lt;/build&gt;</span>  
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="fastjsonåºåˆ—åŒ–å·¥å…·ç±»">FastJsonåºåˆ—åŒ–å·¥å…·ç±»ï¼š<a hidden class="anchor" aria-hidden="true" href="#fastjsonåºåˆ—åŒ–å·¥å…·ç±»">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.controller.util;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.fastjson.JSON;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.fastjson.parser.ParserConfig;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.alibaba.fastjson.serializer.SerializerFeature;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.databind.JavaType;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.databind.type.TypeFactory;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.serializer.RedisSerializer;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.serializer.SerializationException;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.nio.charset.Charset;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> FastJsonRedisSerializer&lt;T&gt; <span style="color:#fff;font-weight:bold">implements</span> RedisSerializer&lt;T&gt; {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> Charset DEFAULT_CHARSET = Charset.<span style="color:#007f7f">forName</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Class&lt;T&gt; clazz;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> {  
</span></span><span style="display:flex;"><span>        ParserConfig.<span style="color:#007f7f">getGlobalInstance</span>().<span style="color:#007f7f">setAutoTypeSupport</span>(<span style="color:#fff;font-weight:bold">true</span>);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> FastJsonRedisSerializer(Class&lt;T&gt; clazz) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">clazz</span> = clazz;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">byte</span>[] serialize(T t) <span style="color:#fff;font-weight:bold">throws</span> SerializationException {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (t == <span style="color:#fff;font-weight:bold">null</span>) {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[0];  
</span></span><span style="display:flex;"><span>        }        <span style="color:#fff;font-weight:bold">return</span> JSON.<span style="color:#007f7f">toJSONString</span>(t, SerializerFeature.<span style="color:#007f7f">WriteClassName</span>).<span style="color:#007f7f">getBytes</span>(DEFAULT_CHARSET);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> T deserialize(<span style="color:#fff;font-weight:bold">byte</span>[] bytes) <span style="color:#fff;font-weight:bold">throws</span> SerializationException {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (bytes == <span style="color:#fff;font-weight:bold">null</span> || bytes.<span style="color:#007f7f">length</span> &lt;= 0) {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;  
</span></span><span style="display:flex;"><span>        }        String str = <span style="color:#fff;font-weight:bold">new</span> String(bytes, DEFAULT_CHARSET);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> JSON.<span style="color:#007f7f">parseObject</span>(str, clazz);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> JavaType getJavaType(Class&lt;?&gt; clazz) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> TypeFactory.<span style="color:#007f7f">defaultInstance</span>().<span style="color:#007f7f">constructType</span>(clazz);  
</span></span><span style="display:flex;"><span>    }}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="redisé…ç½®ç±»">redisé…ç½®ç±»ï¼š<a hidden class="anchor" aria-hidden="true" href="#redisé…ç½®ç±»">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.controller.util.config;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.controller.util.FastJsonRedisSerializer;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Bean;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.core.RedisTemplate;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@Configuration  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RedisConfig {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Bean  
</span></span><span style="display:flex;"><span>    @SuppressWarnings(value = {<span style="color:#0ff;font-weight:bold">&#34;unchecked&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;rawtypes&#34;</span>})  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory connectionFactory) {  
</span></span><span style="display:flex;"><span>        RedisTemplate&lt;Object, Object&gt; template = <span style="color:#fff;font-weight:bold">new</span> RedisTemplate&lt;&gt;();  
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">setConnectionFactory</span>(connectionFactory);  
</span></span><span style="display:flex;"><span>        FastJsonRedisSerializer serializer = <span style="color:#fff;font-weight:bold">new</span> FastJsonRedisSerializer(Object.<span style="color:#007f7f">class</span>);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼  </span>
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">setKeySerializer</span>(<span style="color:#fff;font-weight:bold">new</span> StringRedisSerializer());  
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">setValueSerializer</span>(serializer);  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Hashçš„keyä¹Ÿé‡‡ç”¨StringRedisSerializerçš„åºåˆ—åŒ–æ–¹å¼  </span>
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">setHashKeySerializer</span>(<span style="color:#fff;font-weight:bold">new</span> StringRedisSerializer());  
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">setHashValueSerializer</span>(serializer);  
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">afterPropertiesSet</span>();        <span style="color:#fff;font-weight:bold">return</span> template;  
</span></span><span style="display:flex;"><span>    }}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å“åº”å·¥å…·ç±»">å“åº”å·¥å…·ç±»ï¼š<a hidden class="anchor" aria-hidden="true" href="#å“åº”å·¥å…·ç±»">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.util;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.annotation.JsonInclude;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@JsonInclude(JsonInclude.<span style="color:#007f7f">Include</span>.<span style="color:#007f7f">NON_NULL</span>)  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ResponseResult&lt;T&gt; {  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * çŠ¶æ€ç   
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Integer code;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æç¤ºä¿¡æ¯ï¼Œå¦‚æœæœ‰é”™è¯¯æ—¶ï¼Œå‰ç«¯å¯ä»¥è·å–è¯¥å­—æ®µè¿›è¡Œæç¤º  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String msg;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æŸ¥è¯¢åˆ°çš„ç»“æœæ•°æ®ï¼Œ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> T data;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ResponseResult(Integer code, String msg) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">code</span> = code;  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">msg</span> = msg;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ResponseResult(Integer code, T data) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">code</span> = code;  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">data</span> = data;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Integer getCode() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> code;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setCode(Integer code) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">code</span> = code;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getMsg() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> msg;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setMsg(String msg) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">msg</span> = msg;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> T getData() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> data;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setData(T data) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">data</span> = data;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ResponseResult(Integer code, String msg, T data) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">code</span> = code;  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">msg</span> = msg;  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">data</span> = data;  
</span></span><span style="display:flex;"><span>    }}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="jwtå·¥å…·ç±»">jwtå·¥å…·ç±»ï¼š<a hidden class="anchor" aria-hidden="true" href="#jwtå·¥å…·ç±»">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.util;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> io.jsonwebtoken.Claims;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> io.jsonwebtoken.ExpiredJwtException;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> io.jsonwebtoken.Jwts;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> io.jsonwebtoken.SignatureAlgorithm;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> io.jsonwebtoken.security.Keys;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> io.jsonwebtoken.security.SignatureException;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.security.Key;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Date;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.HashMap;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Map;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.function.Function;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * JWTå·¥å…·ç±»ï¼Œç”¨äºJWTä»¤ç‰Œçš„ç”Ÿæˆã€éªŒè¯å’Œè§£æ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JwtUtil {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¯†é’¥ï¼Œå»ºè®®é€šè¿‡é…ç½®æ–‡ä»¶æ³¨å…¥  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String SECRET_KEY = <span style="color:#0ff;font-weight:bold">&#34;your_secret_key_should_be_at_least_256_bits_long_for_hs256&#34;</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä»¤ç‰Œæœ‰æ•ˆæœŸï¼ˆæ¯«ç§’ï¼‰  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">long</span> JWT_TOKEN_VALIDITY = 24 * 60 * 60 * 1000; <span style="color:#007f7f">// 24å°æ—¶  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ç­¾åç®—æ³•  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> SignatureAlgorithm SIGNATURE_ALGORITHM = SignatureAlgorithm.<span style="color:#007f7f">HS256</span>;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {  
</span></span><span style="display:flex;"><span>        JwtUtil jwtUtil = <span style="color:#fff;font-weight:bold">new</span> JwtUtil();  
</span></span><span style="display:flex;"><span>        String wjy = jwtUtil.<span style="color:#007f7f">generateToken</span>(<span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>);  
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(wjy);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(jwtUtil.<span style="color:#007f7f">getUsernameFromToken</span>(wjy));
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç”Ÿæˆå¯†é’¥  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Key getSigningKey() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">byte</span>[] keyBytes = SECRET_KEY.<span style="color:#007f7f">getBytes</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Keys.<span style="color:#007f7f">hmacShaKeyFor</span>(keyBytes);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ä»ä»¤ç‰Œä¸­è·å–ç”¨æˆ·å  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getUsernameFromToken(String token) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> getClaimFromToken(token, Claims::getSubject);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ä»ä»¤ç‰Œä¸­è·å–è¿‡æœŸæ—¥æœŸ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Date getExpirationDateFromToken(String token) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> getClaimFromToken(token, Claims::getExpiration);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ä»ä»¤ç‰Œä¸­è·å–å£°æ˜  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; T getClaimFromToken(String token, Function&lt;Claims, T&gt; claimsResolver) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">final</span> Claims claims = getAllClaimsFromToken(token);  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> claimsResolver.<span style="color:#007f7f">apply</span>(claims);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è§£æä»¤ç‰Œè·å–æ‰€æœ‰å£°æ˜  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Claims getAllClaimsFromToken(String token) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Jwts.<span style="color:#007f7f">parser</span>()  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">setSigningKey</span>(getSigningKey())                .<span style="color:#007f7f">build</span>()                .<span style="color:#007f7f">parseClaimsJws</span>(token)                .<span style="color:#007f7f">getBody</span>();    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦è¿‡æœŸ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Boolean isTokenExpired(String token) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">final</span> Date expiration = getExpirationDateFromToken(token);  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> expiration.<span style="color:#007f7f">before</span>(<span style="color:#fff;font-weight:bold">new</span> Date());  
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (ExpiredJwtException e) {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>        }    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ä¸ºæŒ‡å®šç”¨æˆ·ç”Ÿæˆä»¤ç‰Œ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String generateToken(String username) {  
</span></span><span style="display:flex;"><span>        Map&lt;String, Object&gt; claims = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> doGenerateToken(claims, username);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ä¸ºæŒ‡å®šç”¨æˆ·ç”Ÿæˆå¸¦è‡ªå®šä¹‰å£°æ˜çš„ä»¤ç‰Œ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String generateToken(String username, Map&lt;String, Object&gt; claims) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> doGenerateToken(claims, username);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç”Ÿæˆä»¤ç‰Œçš„æ ¸å¿ƒæ–¹æ³•  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String doGenerateToken(Map&lt;String, Object&gt; claims, String subject) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Jwts.<span style="color:#007f7f">builder</span>()  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">setClaims</span>(claims)                .<span style="color:#007f7f">setSubject</span>(subject)                .<span style="color:#007f7f">setIssuedAt</span>(<span style="color:#fff;font-weight:bold">new</span> Date())  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">setExpiration</span>(<span style="color:#fff;font-weight:bold">new</span> Date(System.<span style="color:#007f7f">currentTimeMillis</span>() + JWT_TOKEN_VALIDITY))  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">signWith</span>(getSigningKey(), SIGNATURE_ALGORITHM)  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">compact</span>();    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * éªŒè¯ä»¤ç‰Œ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Boolean validateToken(String token, String username) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">final</span> String tokenUsername = getUsernameFromToken(token);  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> (tokenUsername.<span style="color:#007f7f">equals</span>(username) &amp;&amp; !isTokenExpired(token));  
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (SignatureException | ExpiredJwtException e) {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;  
</span></span><span style="display:flex;"><span>        }    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * åˆ·æ–°ä»¤ç‰Œ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String refreshToken(String token) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">final</span> Claims claims = getAllClaimsFromToken(token);  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//claims.setIssuedAt(new Date());  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//claims.setExpiration(new Date(System.currentTimeMillis() + JWT_TOKEN_VALIDITY));            return Jwts.builder()  </span>
</span></span><span style="display:flex;"><span>                    .<span style="color:#007f7f">setClaims</span>(claims)                    .<span style="color:#007f7f">signWith</span>(getSigningKey(), SIGNATURE_ALGORITHM)  
</span></span><span style="display:flex;"><span>                    .<span style="color:#007f7f">compact</span>();        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;æ— æ³•åˆ·æ–°ä»¤ç‰Œ&#34;</span>, e);  
</span></span><span style="display:flex;"><span>        }    }}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="rediså·¥å…·ç±»">rediså·¥å…·ç±»ï¼š<a hidden class="anchor" aria-hidden="true" href="#rediså·¥å…·ç±»">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">193
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.util;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.core.BoundSetOperations;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.core.HashOperations;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.core.RedisTemplate;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.core.ValueOperations;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.*;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.TimeUnit;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@SuppressWarnings(value = {<span style="color:#0ff;font-weight:bold">&#34;unchecked&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;rawtypes&#34;</span>})  
</span></span><span style="display:flex;"><span>@Component  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//rediså·¥å…·ç±»  </span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RedisCache {  
</span></span><span style="display:flex;"><span>    @Autowired  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> RedisTemplate redisTemplate;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key   ç¼“å­˜çš„é”®å€¼  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value ç¼“å­˜çš„å€¼  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; <span style="color:#fff;font-weight:bold">void</span> setCacheObject(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> T value) {  
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#007f7f">opsForValue</span>().<span style="color:#007f7f">set</span>(key, value);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key      ç¼“å­˜çš„é”®å€¼  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value    ç¼“å­˜çš„å€¼  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param timeout  æ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param timeUnit æ—¶é—´é¢—ç²’åº¦  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; <span style="color:#fff;font-weight:bold">void</span> setCacheObject(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> T value, <span style="color:#fff;font-weight:bold">final</span> Integer timeout, <span style="color:#fff;font-weight:bold">final</span> TimeUnit timeUnit) {  
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#007f7f">opsForValue</span>().<span style="color:#007f7f">set</span>(key, value, timeout, timeUnit);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è®¾ç½®æœ‰æ•ˆæ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key     Redisé”®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param timeout è¶…æ—¶æ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> expire(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">long</span> timeout) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> expire(key, timeout, TimeUnit.<span style="color:#007f7f">SECONDS</span>);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è®¾ç½®æœ‰æ•ˆæ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key     Redisé”®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param timeout è¶…æ—¶æ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param unit    æ—¶é—´å•ä½  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> expire(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">long</span> timeout, <span style="color:#fff;font-weight:bold">final</span> TimeUnit unit) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">expire</span>(key, timeout, unit);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡ã€‚  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key ç¼“å­˜é”®å€¼  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; T getCacheObject(<span style="color:#fff;font-weight:bold">final</span> String key) {  
</span></span><span style="display:flex;"><span>        ValueOperations&lt;String, T&gt; operation = redisTemplate.<span style="color:#007f7f">opsForValue</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> operation.<span style="color:#007f7f">get</span>(key);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * åˆ é™¤å•ä¸ªå¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> deleteObject(<span style="color:#fff;font-weight:bold">final</span> String key) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">delete</span>(key);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * åˆ é™¤é›†åˆå¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param collection å¤šä¸ªå¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> deleteObject(<span style="color:#fff;font-weight:bold">final</span> Collection collection) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">delete</span>(collection);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç¼“å­˜Listæ•°æ®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key      ç¼“å­˜çš„é”®å€¼  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param dataList å¾…ç¼“å­˜çš„Listæ•°æ®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return ç¼“å­˜çš„å¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; <span style="color:#fff;font-weight:bold">long</span> setCacheList(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> List&lt;T&gt; dataList) {  
</span></span><span style="display:flex;"><span>        Long count = redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">rightPushAll</span>(key, dataList);  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> count == <span style="color:#fff;font-weight:bold">null</span> ? 0 : count;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è·å¾—ç¼“å­˜çš„listå¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key ç¼“å­˜çš„é”®å€¼  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; List&lt;T&gt; getCacheList(<span style="color:#fff;font-weight:bold">final</span> String key) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">range</span>(key, 0, -1);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç¼“å­˜Set  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *     * @param key     ç¼“å­˜é”®å€¼  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param dataSet ç¼“å­˜çš„æ•°æ®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return ç¼“å­˜æ•°æ®çš„å¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; BoundSetOperations&lt;String, T&gt; setCacheSet(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> Set&lt;T&gt; dataSet) {  
</span></span><span style="display:flex;"><span>        BoundSetOperations&lt;String, T&gt; setOperation = redisTemplate.<span style="color:#007f7f">boundSetOps</span>(key);  
</span></span><span style="display:flex;"><span>        Iterator&lt;T&gt; it = dataSet.<span style="color:#007f7f">iterator</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> (it.<span style="color:#007f7f">hasNext</span>()) {  
</span></span><span style="display:flex;"><span>            setOperation.<span style="color:#007f7f">add</span>(it.<span style="color:#007f7f">next</span>());        }        <span style="color:#fff;font-weight:bold">return</span> setOperation;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è·å¾—ç¼“å­˜çš„set  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *     * @param key  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; Set&lt;T&gt; getCacheSet(<span style="color:#fff;font-weight:bold">final</span> String key) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForSet</span>().<span style="color:#007f7f">members</span>(key);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç¼“å­˜Map  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *     * @param key  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param dataMap  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; <span style="color:#fff;font-weight:bold">void</span> setCacheMap(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> Map&lt;String, T&gt; dataMap) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (dataMap != <span style="color:#fff;font-weight:bold">null</span>) {  
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">putAll</span>(key, dataMap);  
</span></span><span style="display:flex;"><span>        }    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è·å¾—ç¼“å­˜çš„Map  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *     * @param key  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; Map&lt;String, T&gt; getCacheMap(<span style="color:#fff;font-weight:bold">final</span> String key) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">entries</span>(key);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * å¾€Hashä¸­å­˜å…¥æ•°æ®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key   Redisé”®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param hKey  Hashé”®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value å€¼  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; <span style="color:#fff;font-weight:bold">void</span> setCacheMapValue(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> String hKey, <span style="color:#fff;font-weight:bold">final</span> T value) {  
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">put</span>(key, hKey, value);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è·å–Hashä¸­çš„æ•°æ®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key  Redisé”®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param hKey Hashé”®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return Hashä¸­çš„å¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; T getCacheMapValue(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> String hKey) {  
</span></span><span style="display:flex;"><span>        HashOperations&lt;String, String, T&gt; opsForHash = redisTemplate.<span style="color:#007f7f">opsForHash</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> opsForHash.<span style="color:#007f7f">get</span>(key, hKey);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * åˆ é™¤Hashä¸­çš„æ•°æ®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param hkey  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> delCacheMapValue(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> String hkey) {  
</span></span><span style="display:flex;"><span>        HashOperations hashOperations = redisTemplate.<span style="color:#007f7f">opsForHash</span>();  
</span></span><span style="display:flex;"><span>        hashOperations.<span style="color:#007f7f">delete</span>(key, hkey);    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è·å–å¤šä¸ªHashä¸­çš„æ•°æ®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key   Redisé”®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param hKeys Hashé”®é›†åˆ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return Hashå¯¹è±¡é›†åˆ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; List&lt;T&gt; getMultiCacheMapValue(<span style="color:#fff;font-weight:bold">final</span> String key, <span style="color:#fff;font-weight:bold">final</span> Collection&lt;Object&gt; hKeys) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">multiGet</span>(key, hKeys);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡åˆ—è¡¨  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param pattern å­—ç¬¦ä¸²å‰ç¼€  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return å¯¹è±¡åˆ—è¡¨  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Collection&lt;String&gt; keys(<span style="color:#fff;font-weight:bold">final</span> String pattern) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">keys</span>(pattern);  
</span></span><span style="display:flex;"><span>    }}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="webutilså·¥å…·ç±»">WebUtilså·¥å…·ç±»ï¼š<a hidden class="anchor" aria-hidden="true" href="#webutilså·¥å…·ç±»">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.util;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletResponse;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WebUtils {  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * å°†å­—ç¬¦ä¸²æ¸²æŸ“åˆ°å®¢æˆ·ç«¯  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param response æ¸²æŸ“å¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param string   å¾…æ¸²æŸ“çš„å­—ç¬¦ä¸²  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return null  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> String renderString(HttpServletResponse response, String string) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {  
</span></span><span style="display:flex;"><span>            response.<span style="color:#007f7f">setStatus</span>(200);  
</span></span><span style="display:flex;"><span>            response.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;application/json&#34;</span>);  
</span></span><span style="display:flex;"><span>            response.<span style="color:#007f7f">setCharacterEncoding</span>(<span style="color:#0ff;font-weight:bold">&#34;utf-8&#34;</span>);  
</span></span><span style="display:flex;"><span>            response.<span style="color:#007f7f">getWriter</span>().<span style="color:#007f7f">print</span>(string);        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {  
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();        }        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;  
</span></span><span style="display:flex;"><span>    }}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="userç±»">userç±»ï¼š<a hidden class="anchor" aria-hidden="true" href="#userç±»">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.domain;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.baomidou.mybatisplus.annotation.TableId;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.baomidou.mybatisplus.annotation.TableName;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.AllArgsConstructor;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.Data;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.NoArgsConstructor;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.Serializable;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Date;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//ç”¨æˆ·è¡¨(User)å®ä½“ç±»  </span>
</span></span><span style="display:flex;"><span>@Data  
</span></span><span style="display:flex;"><span>@AllArgsConstructor  
</span></span><span style="display:flex;"><span>@NoArgsConstructor  
</span></span><span style="display:flex;"><span>@TableName(<span style="color:#0ff;font-weight:bold">&#34;sys_user&#34;</span>)  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User <span style="color:#fff;font-weight:bold">implements</span> Serializable {  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">long</span> serialVersionUID = -40356785423868312L;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ä¸»é”®  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    @TableId  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Long id;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç”¨æˆ·å  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String userName;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æ˜µç§°  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String nickName;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * å¯†ç   
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String password;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String status;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * é‚®ç®±  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String email;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æ‰‹æœºå·  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String phonenumber;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String sex;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * å¤´åƒ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String avatar;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String userType;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * åˆ›å»ºäººçš„ç”¨æˆ·id  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>    <span style="color:#fff;font-weight:bold">private</span> Long createBy;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * åˆ›å»ºæ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Date createTime;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æ›´æ–°äºº  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Long updateBy;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æ›´æ–°æ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Date updateTime;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Integer delFlag;  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="æ•°æ®åº“">æ•°æ®åº“<a hidden class="anchor" aria-hidden="true" href="#æ•°æ®åº“">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">create</span> <span style="color:#fff;font-weight:bold">database</span> <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">not</span> <span style="color:#fff;font-weight:bold">exists</span> wjy_security;  
</span></span><span style="display:flex;"><span>use wjy_security;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `sys_user`  
</span></span><span style="display:flex;"><span>(  
</span></span><span style="display:flex;"><span>    `id`          <span style="color:#fff;font-weight:bold">BIGINT</span>(<span style="color:#ff0;font-weight:bold">20</span>)  <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;ä¸»é”®&#39;</span>,  
</span></span><span style="display:flex;"><span>    `user_name`   <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">64</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;NULL&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;ç”¨æˆ·å&#39;</span>,  
</span></span><span style="display:flex;"><span>    `nick_name`   <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">64</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;NULL&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;æ˜µç§°&#39;</span>,  
</span></span><span style="display:flex;"><span>    `password`    <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">64</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;NULL&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;å¯†ç &#39;</span>,  
</span></span><span style="display:flex;"><span>    `status`      <span style="color:#fff;font-weight:bold">CHAR</span>(<span style="color:#ff0;font-weight:bold">1</span>)              <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#39;</span>,  
</span></span><span style="display:flex;"><span>    `email`       <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">64</span>)          <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;é‚®ç®±&#39;</span>,  
</span></span><span style="display:flex;"><span>    `phonenumber` <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">32</span>)          <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;æ‰‹æœºå·&#39;</span>,  
</span></span><span style="display:flex;"><span>    `sex`         <span style="color:#fff;font-weight:bold">CHAR</span>(<span style="color:#ff0;font-weight:bold">1</span>)              <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰&#39;</span>,  
</span></span><span style="display:flex;"><span>    `avatar`      <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">128</span>)         <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;å¤´åƒ&#39;</span>,  
</span></span><span style="display:flex;"><span>    `user_type`   <span style="color:#fff;font-weight:bold">CHAR</span>(<span style="color:#ff0;font-weight:bold">1</span>)     <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;1&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰&#39;</span>,  
</span></span><span style="display:flex;"><span>    `create_by`   <span style="color:#fff;font-weight:bold">BIGINT</span>(<span style="color:#ff0;font-weight:bold">20</span>)           <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;åˆ›å»ºäººçš„ç”¨æˆ·id&#39;</span>,  
</span></span><span style="display:flex;"><span>    `create_time` DATETIME             <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;åˆ›å»ºæ—¶é—´&#39;</span>,  
</span></span><span style="display:flex;"><span>    `update_by`   <span style="color:#fff;font-weight:bold">BIGINT</span>(<span style="color:#ff0;font-weight:bold">20</span>)           <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;æ›´æ–°äºº&#39;</span>,  
</span></span><span style="display:flex;"><span>    `update_time` DATETIME             <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;æ›´æ–°æ—¶é—´&#39;</span>,  
</span></span><span style="display:flex;"><span>    `del_flag`    <span style="color:#fff;font-weight:bold">INT</span>(<span style="color:#ff0;font-weight:bold">11</span>)              <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰&#39;</span>,  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`)  
</span></span><span style="display:flex;"><span>) ENGINE = INNODB  
</span></span><span style="display:flex;"><span>  AUTO_INCREMENT = <span style="color:#ff0;font-weight:bold">2</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET = utf8mb4 <span style="color:#fff;font-weight:bold">COMMENT</span> =<span style="color:#0ff;font-weight:bold">&#39;ç”¨æˆ·è¡¨&#39;</span>;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> sys_user  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">values</span> (<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#0ff;font-weight:bold">&#39;admin&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;ç®¡ç†å‘˜&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;{noop}123456&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>,  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>);  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> sys_user  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">values</span> (<span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#0ff;font-weight:bold">&#39;wjy&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;wjy&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;{noop}112233&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#0ff;font-weight:bold">&#39;1&#39;</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>,  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">DEFAULT</span>, <span style="color:#fff;font-weight:bold">DEFAULT</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>pomæ·»åŠ ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>com.baomidou<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>mybatis-plus-spring-boot3-starter<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;version&gt;</span>3.5.10.1<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">&lt;!-- ä¸‹é¢ä¸¤ä¸ªé©±åŠ¨äºŒé€‰ä¸€ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">&lt;!--mysqlé©±åŠ¨ï¼Œé€‚ç”¨äºspring boot 2--&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;groupId&gt;</span>mysql<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;artifactId&gt;</span>mysql-connector-java<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">&lt;!--mysqlé©±åŠ¨ï¼Œé€‚ç”¨äºspring boot 3--&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>com.mysql<span style="font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>mysql-connector-j<span style="font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ src/main/resources ç›®å½•æ–°å»ºFileï¼Œæ–‡ä»¶åä¸ºapplication.ymlï¼Œå†™å…¥å¦‚ä¸‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">datasource</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">url</span>: jdbc:mysql://localhost:3306/wjy_security?characterEncoding=utf-8&amp;serverTimezone=UTC
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">username</span>: root
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">password</span>: root
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">driver-class-name</span>: com.mysql.cj.jdbc.Driver
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ–°å»ºmapper</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.mapper;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.domain.User;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> UserMapper <span style="color:#fff;font-weight:bold">extends</span> BaseMapper&lt;User&gt; {  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å¯åŠ¨ç±»æ·»åŠ ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@MapperScan(<span style="color:#0ff;font-weight:bold">&#34;com.wjy.springsecurity.mapper&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@SpringBootTest  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> SpringSecurityApplicationTests {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Test  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> contextLoads() {  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Autowired  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> UserMapper userMapper;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Test  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testUserMapper(){  
</span></span><span style="display:flex;"><span>       <span style="color:#007f7f">//æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·  </span>
</span></span><span style="display:flex;"><span>       List&lt;User&gt; users = userMapper.<span style="color:#007f7f">selectList</span>(<span style="color:#fff;font-weight:bold">null</span>);  
</span></span><span style="display:flex;"><span>       System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(users);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="è‡ªå®šä¹‰securityçš„è®¤è¯å®ç°">è‡ªå®šä¹‰securityçš„è®¤è¯å®ç°<a hidden class="anchor" aria-hidden="true" href="#è‡ªå®šä¹‰securityçš„è®¤è¯å®ç°">#</a></h1>
<p>ä¸Šé¢æˆ‘ä»¬å·²ç»æŠŠå‡†å¤‡å·¥ä½œåšå¥½äº†ï¼ŒåŒ…æ‹¬æ­å»ºã€ä»£ç ã€æ•°æ®åº“ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå®ç°è®©securityåœ¨è®¤è¯çš„æ—¶å€™ï¼Œæ ¹æ®æˆ‘ä»¬æ•°æ®åº“çš„ç”¨æˆ·å’Œå¯†ç è¿›è¡Œè®¤è¯ï¼Œä¹Ÿå°±æ˜¯è¢«securityæ‹¦æˆªä¸šåŠ¡æ¥å£ï¼Œå‡ºç°ç™»å½•é¡µé¢ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è¾“å…¥æ•°æ®åº“é‡Œçš„ç”¨æˆ·å’Œå¯†ç æ¥ç™»å½•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨securityé»˜è®¤çš„ç”¨æˆ·å’Œå¯†ç è¿›è¡Œç™»å½•</p>
<p>æ€è·¯: åªéœ€è¦æ–°å»ºä¸€ä¸ªå®ç°ç±»ï¼Œåœ¨è¿™ä¸ªå®ç°ç±»é‡Œé¢å®ç°Securityå®˜æ–¹çš„UserDetailsServiceæ¥å£ï¼Œç„¶åé‡å†™é‡Œé¢çš„loadUserByUsernameæ–¹æ³•</p>
<p>æ³¨æ„: é‡å†™å¥½loadUserByUsernameæ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ‹¿åˆ° &lsquo;æ•°æ®åº“ä¸ç”¨æˆ·è¾“å…¥çš„æ•°æ®&rsquo; è¿›è¡Œæ¯”å¯¹çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯userå¯¹è±¡è¿™ä¸ªç»“æœå°è£…æˆèƒ½è¢« &lsquo;Securityå®˜æ–¹çš„UserDetailsServiceæ¥å£&rsquo; æ¥æ”¶çš„ç±»å‹ï¼Œä¾‹å¦‚å¯ä»¥å°è£…æˆæˆ‘ä»¬ä¸‹é¢å†™çš„LoginUserç±»å‹ã€‚ç„¶åæ‰èƒ½ä¼ªè£…å¥½æ•°æ®ï¼Œç»™Securityå®˜æ–¹çš„è®¤è¯æœºåˆ¶å»å¯¹æ¯”userå¯¹è±¡ä¸æ•°æ®åº“çš„ç»“æœæ˜¯å¦åŒ¹é…ã€‚Securityå®˜æ–¹çš„è®¤è¯æœºåˆ¶ä¼šæ‹¿LoginUserç±»çš„æ–¹æ³•æ•°æ®(æ•°æ®åº“æ‹¿ï¼Œä¸å†ç”¨é»˜è®¤çš„)ï¼Œè·Ÿæˆ‘ä»¬å°è£…è¿‡å»çš„userå¯¹è±¡è¿›è¡ŒåŒ¹é…ï¼Œè¦ä½¿åŒ¹é…ä¸€è‡´ï¼Œå°±è¯æ˜è®¤è¯é€šè¿‡ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·åœ¨æµè§ˆå™¨é¡µé¢è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç èƒ½è¢«Securityè®¤è¯é€šè¿‡ï¼Œå°±ä¸å†æ‹¦æˆªè¯¥ç”¨æˆ·å»è®¿é—®æˆ‘ä»¬çš„ä¸šåŠ¡æ¥å£</p>
<p>ç¬¬ä¸€æ­¥: åœ¨domainç›®å½•æ–°å»ºLoginUserç±»ï¼Œä½œä¸ºUserDetailsæ¥å£(Securityå®˜æ–¹æä¾›çš„æ¥å£)çš„å®ç°ç±»</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.domain;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.AllArgsConstructor;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.Data;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.NoArgsConstructor;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.core.GrantedAuthority;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.core.userdetails.UserDetails;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Collection;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@Data  
</span></span><span style="display:flex;"><span>@NoArgsConstructor  
</span></span><span style="display:flex;"><span>@AllArgsConstructor  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//å®ç°UserDetailsæ¥å£ä¹‹åï¼Œè¦é‡å†™UserDetailsæ¥å£é‡Œé¢çš„7ä¸ªæ–¹æ³•  </span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LoginUser <span style="color:#fff;font-weight:bold">implements</span> UserDetails {  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> User xxuser;  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//ç”¨äºè¿”å›æƒé™ä¿¡æ¯ã€‚ç°åœ¨æˆ‘ä»¬æ­£åœ¨å­¦&#39;è®¤è¯&#39;ï¼Œ&#39;æƒé™&#39;åé¢æ‰å­¦ã€‚æ‰€ä»¥è¿”å›nullå³å¯  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Collection&lt;? <span style="color:#fff;font-weight:bold">extends</span> GrantedAuthority&gt; getAuthorities() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//ç”¨äºè·å–ç”¨æˆ·å¯†ç ã€‚ç”±äºä½¿ç”¨çš„å®ä½“ç±»æ˜¯Userï¼Œæ‰€ä»¥è·å–çš„æ˜¯æ•°æ®åº“çš„ç”¨æˆ·å¯†ç   </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getPassword() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> xxuser.<span style="color:#007f7f">getPassword</span>();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//ç”¨äºè·å–ç”¨æˆ·åã€‚ç”±äºä½¿ç”¨çš„å®ä½“ç±»æ˜¯Userï¼Œæ‰€ä»¥è·å–çš„æ˜¯æ•°æ®åº“çš„ç”¨æˆ·å  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getUsername() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> xxuser.<span style="color:#007f7f">getUserName</span>();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//åˆ¤æ–­ç™»å½•çŠ¶æ€æ˜¯å¦è¿‡æœŸã€‚æŠŠè¿™ä¸ªæ”¹æˆtrueï¼Œè¡¨ç¤ºæ°¸ä¸è¿‡æœŸ  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isAccountNonExpired() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//åˆ¤æ–­è´¦å·æ˜¯å¦è¢«é”å®šã€‚æŠŠè¿™ä¸ªæ”¹æˆtrueï¼Œè¡¨ç¤ºæœªé”å®šï¼Œä¸ç„¶ç™»å½•çš„æ—¶å€™ï¼Œä¸è®©ä½ ç™»å½•  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isAccountNonLocked() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//åˆ¤æ–­ç™»å½•å‡­è¯æ˜¯å¦è¿‡æœŸã€‚æŠŠè¿™ä¸ªæ”¹æˆtrueï¼Œè¡¨ç¤ºæ°¸ä¸è¿‡æœŸ  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isCredentialsNonExpired() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¯ç”¨ã€‚æŠŠè¿™ä¸ªæ”¹æˆtrueï¼Œè¡¨ç¤ºå¯ç”¨çŠ¶æ€  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isEnabled() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>    }}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥: åœ¨ src/main/java/com.huanf ç›®å½•æ–°å»º service.impl.MyUserDetailServiceImpl ç±»ï¼Œå†™å…¥å¦‚ä¸‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.domain;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.mapper.UserMapper;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.core.userdetails.UserDetails;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.core.userdetails.UserDetailsService;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Service;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Objects;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@Service  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MyUserDetailServiceImpl <span style="color:#fff;font-weight:bold">implements</span> UserDetailsService {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Autowired  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> UserMapper userMapper;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//UserDetailsæ˜¯Securityå®˜æ–¹æä¾›çš„æ¥å£  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> UserDetails loadUserByUsername(String xxusername) <span style="color:#fff;font-weight:bold">throws</span> UsernameNotFoundException {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚æˆ‘ä»¬å†™çš„userMapperæ¥å£é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥è°ƒç”¨çš„æ˜¯mybatis-plusæä¾›çš„æ–¹æ³•  </span>
</span></span><span style="display:flex;"><span>        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span style="color:#fff;font-weight:bold">new</span> LambdaQueryWrapper&lt;&gt;();  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//eqæ–¹æ³•è¡¨ç¤ºç­‰å€¼åŒ¹é…ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°æ®åº“çš„ç”¨æˆ·åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬ä¼ è¿›æ¥çš„ç”¨æˆ·åï¼Œè¿™ä¸¤ä¸ªå‚æ•°è¿›è¡Œæ¯”è¾ƒæ˜¯å¦ç›¸ç­‰  </span>
</span></span><span style="display:flex;"><span>        queryWrapper.<span style="color:#007f7f">eq</span>(User::getUserName,xxusername);  
</span></span><span style="display:flex;"><span>        User user = userMapper.<span style="color:#007f7f">selectOne</span>(queryWrapper);  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å¦‚æœç”¨æˆ·ä¼ è¿›æ¥çš„ç”¨æˆ·åï¼Œä½†æ˜¯æ•°æ®åº“æ²¡æœ‰è¿™ä¸ªç”¨æˆ·åï¼Œå°±ä¼šå¯¼è‡´æˆ‘ä»¬æ˜¯æŸ¥ä¸åˆ°çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±è¿›è¡Œä¸‹é¢çš„åˆ¤æ–­ã€‚é¿å…ç¨‹åºå®‰å…¨é—®é¢˜  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(Objects.<span style="color:#007f7f">isNull</span>(user)){<span style="color:#007f7f">//åˆ¤æ–­userå¯¹è±¡æ˜¯å¦ä¸ºç©ºã€‚å½“åœ¨æ•°æ®åº“æ²¡æœ‰æŸ¥åˆ°æ•°æ®æ—¶ï¼Œuserå°±ä¼šä¸ºç©ºï¼Œä¹Ÿå°±ä¼šè¿›å…¥è¿™ä¸ªåˆ¤æ–­  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯&#34;</span>);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æŠŠæŸ¥è¯¢åˆ°çš„userç»“æœï¼Œå°è£…æˆUserDetailsç±»å‹ï¼Œç„¶åè¿”å›ã€‚  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ä½†æ˜¯ç”±äºUserDetailsæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆéœ€è¦åœ¨dominoç›®å½•æ–°å»ºLoginUserç±»ï¼Œä½œä¸ºUserDetailsçš„å®ç°ç±»ï¼Œå†å†™ä¸‹é¢é‚£è¡Œ  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> LoginUser(user);  
</span></span><span style="display:flex;"><span>    }}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰æ­¥: æµ‹è¯•ã€‚å¯åŠ¨é¡¹ç›®ï¼Œæµè§ˆå™¨è¾“å…¥å¦‚ä¸‹ï¼Œç„¶åæˆ‘ä»¬è¾“å…¥ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œçœ‹æ˜¯ä¸æ˜¯æ ¹æ®æ•°æ®åº“æ¥è¿›è¡Œè®¤è¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>http://localhost:8080/hello
</span></span></code></pre></td></tr></table>
</div>
</div><p>åº“é‡Œæœ‰ä¸ªç”¨æˆ·æ˜¯wjyï¼Œå¯†ç 112233ã€‚
ç‚¹å‡»ç™»å½•æŒ‰é’®åï¼ŒæˆåŠŸæ”¾è¡Œï¼ŒSecurityå…è®¸äº†æˆ‘ä»¬è®¿é—®ä¸šåŠ¡æ¥å£ã€‚
è¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿè‡ªå®šä¹‰Securityçš„è®¤è¯æœºåˆ¶ï¼Œä¸å†ä½¿ç”¨Securityé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç äº†ï¼Œæˆ‘ä»¬å®ç°äº†Securityæ ¹æ®æ•°æ®åº“çš„ç”¨æˆ·è¡¨æ¥è®¤è¯ã€‚</p>
<h1 id="å¯†ç æ ¡éªŒé—®é¢˜">å¯†ç æ ¡éªŒé—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#å¯†ç æ ¡éªŒé—®é¢˜">#</a></h1>
<p>ä¸Šé¢æˆ‘ä»¬å®ç°äº†è‡ªå®šä¹‰Securityçš„è®¤è¯æœºåˆ¶ï¼Œè®©Securityæ ¹æ®æ•°æ®åº“çš„æ•°æ®ï¼Œæ¥è®¤è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®æ˜¯å¦æ­£ç¡®ã€‚ä½†æ˜¯å½“æ—¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨æ•°æ®åº“å­˜å…¥ç”¨æˆ·è¡¨çš„æ—¶å€™ï¼Œæ’å…¥çš„wjyç”¨æˆ·çš„å¯†ç æ˜¯ {noop}112233ï¼Œä¸ºä»€ä¹ˆç”¨112233ä¸è¡Œå‘¢ã€‚</p>
<p>åŸå› : SpringSecurityé»˜è®¤ä½¿ç”¨çš„PasswordEncoderè¦æ±‚æ•°æ®åº“ä¸­çš„å¯†ç æ ¼å¼ä¸ºï¼š{åŠ å¯†æ–¹å¼}å¯†ç ã€‚å¯¹åº”çš„å°±æ˜¯{noop}112233ï¼Œå®é™…è¡¨ç¤ºçš„æ˜¯112233ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬åœ¨æ•°æ®åº“ç›´æ¥æš´éœ²112233ä¸ºå¯†ç ï¼Œä¼šé€ æˆå®‰å…¨é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠåŠ å¯†åçš„1234çš„å¯†æ–‡å½“ä½œå¯†ç ï¼Œæ­¤æ—¶ç”¨æˆ·åœ¨æµè§ˆå™¨ç™»å½•æ—¶è¾“å…¥1234ï¼Œæˆ‘ä»¬å¦‚ä½•ç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿç™»å½•è¿›å»å‘¢ï¼Œç­”æ¡ˆæ˜¯SpringSecurityé»˜è®¤çš„å¯†ç æ ¡éªŒï¼Œæ›¿æ¢ä¸ºSpringSecurityä¸ºæˆ‘ä»¬æä¾›çš„BCryptPasswordEncoderã€‚</p>
<p>æ³¨æ„ï¼šä» 5.7.0-M2 èµ·ï¼Œ<code>WebSecurityConfigureAdapter</code>Â è¢«åºŸå¼ƒäº†ï¼Œ<a href="https://spring.io/blog/2022/02/21/spring-security-without-the-websecurityconfigureradapter">ä¸æ¨èä½¿ç”¨</a>ã€‚
ä»¥ä¸‹ä»£ç ä¸è¦ä½¿ç”¨äº†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//å®ç°Securityæä¾›çš„WebSecurityConfigurerAdapterç±»ï¼Œå°±å¯ä»¥æ”¹å˜å¯†ç æ ¡éªŒçš„è§„åˆ™äº†</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SecurityConfig <span style="color:#fff;font-weight:bold">extends</span> WebSecurityConfigurerAdapter {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//æŠŠBCryptPasswordEncoderå¯¹è±¡æ³¨å…¥Springå®¹å™¨ä¸­ï¼ŒSpringSecurityå°±ä¼šä½¿ç”¨è¯¥PasswordEncoderæ¥è¿›è¡Œå¯†ç æ ¡éªŒ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//æ³¨æ„ä¹Ÿå¯ä»¥æ³¨å…¥PasswordEncoderï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºPasswordEncoderæ˜¯BCry..çš„çˆ¶ç±»</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> PasswordEncoder passwordEncoder(){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> BCryptPasswordEncoder();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨æŠŠBCryptPasswordEncoderå¯¹è±¡æ³¨å…¥Springå®¹å™¨ä¸­ï¼ŒSpringSecurityå°±ä¼šä½¿ç”¨è¯¥PasswordEncoderæ¥è¿›è¡Œå¯†ç æ ¡éªŒã€‚</p>
<p>æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> xxTestBCryptPasswordEncoder(){
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//å¦‚æœä¸æƒ³åœ¨ä¸‹é¢é‚£è¡Œnewçš„è¯ï¼Œé‚£ä¹ˆå°±åœ¨è¯¥ç±»æ³¨å…¥PasswordEncoderï¼Œä¾‹å¦‚å¦‚ä¸‹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @Autowired
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * private PasswordEncoder passwordEncoder;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    BCryptPasswordEncoder passwordEncoder = <span style="color:#fff;font-weight:bold">new</span> BCryptPasswordEncoder();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥çš„å¯†ç </span>
</span></span><span style="display:flex;"><span>	String encode1 = passwordEncoder.<span style="color:#007f7f">encode</span>(<span style="color:#0ff;font-weight:bold">&#34;1234&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//å†æ¨¡æ‹Ÿä¸€æ¬¡ç”¨æˆ·è¾“å…¥çš„å¯†ç </span>
</span></span><span style="display:flex;"><span>	String encode2 = passwordEncoder.<span style="color:#007f7f">encode</span>(<span style="color:#0ff;font-weight:bold">&#34;1234&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//è™½ç„¶è¿™ä¸¤æ¬¡çš„å¯†ç éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åŠ å¯†åæ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯æ¬¡è¿è¡Œï¼Œå¯¹åŒä¸€åŸæ–‡éƒ½ä¼šæœ‰ä¸åŒçš„åŠ å¯†ç»“æœ</span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//åŸå› :ä¼šæ·»åŠ éšæœºçš„ç›ï¼ŒåŠ å¯†ç»“æœ=ç›+åŸæ–‡+åŠ å¯†ã€‚è¾¾åˆ°æ¯æ¬¡åŠ å¯†åçš„å¯†æ–‡éƒ½ä¸ç›¸åŒçš„æ•ˆæœ</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(encode1);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(encode2);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="jwtå·¥å…·ç±»å®ç°åŠ å¯†æ ¡éªŒ">jwtå·¥å…·ç±»å®ç°åŠ å¯†æ ¡éªŒ<a hidden class="anchor" aria-hidden="true" href="#jwtå·¥å…·ç±»å®ç°åŠ å¯†æ ¡éªŒ">#</a></h1>
<p>jwtä½¿ç”¨ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šç”Ÿæˆå’Œè§£æã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ç”Ÿæˆtoken  </span>
</span></span><span style="display:flex;"><span>    JwtUtil jwtUtil = <span style="color:#fff;font-weight:bold">new</span> JwtUtil();  
</span></span><span style="display:flex;"><span>    String wjy = jwtUtil.<span style="color:#007f7f">generateToken</span>(<span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>);  
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(wjy);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è§£ætoken  </span>
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(jwtUtil.<span style="color:#007f7f">getUsernameFromToken</span>(wjy));  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="ç™»å½•æ¥å£çš„åˆ†æ">ç™»å½•æ¥å£çš„åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#ç™»å½•æ¥å£çš„åˆ†æ">#</a></h1>
<p>åœ¨ä¸Šé¢å­¦ä¹ çš„ &lsquo;è®¤è¯&rsquo; çš„ &lsquo;3. è‡ªå®šä¹‰securityçš„æ€è·¯&rsquo; å½“ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåŠŸèƒ½éœ€æ±‚æ˜¯è‡ªå®šä¹‰ç™»å½•æ¥å£ï¼Œè¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å®ç°ï¼Œæˆ‘ä»¬éœ€è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯ï¼Œå®ç°è¿™ä¸ªåŠŸèƒ½éœ€è¦ä½¿ç”¨åˆ°jwtï¼Œæˆ‘ä»¬åˆšåˆšä¹Ÿå­¦ä¹ äº†ä½¿ç”¨jwtæ¥å®ç°åŠ å¯†æ ¡éªŒï¼Œé‚£ä¹ˆä¸‹é¢å°±æ­£å¼å­¦ä¹ å¦‚ä½•å®ç°è¿™ä¸ªç™»å½•æ¥å£ï¼Œé¦–å…ˆæ˜¯åˆ†æï¼Œå¦‚ä¸‹</p>
<p>â‘ æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç™»é™†æ¥å£ï¼Œä¹Ÿå°±æ˜¯åœ¨controllerç›®å½•æ–°å»ºLoginControllerç±»ï¼Œåœ¨controlleræ–¹æ³•é‡Œé¢å»è°ƒç”¨serviceæ¥å£ï¼Œåœ¨serviceæ¥å£å®ç°AuthenticationManagerå»è¿›è¡Œç”¨æˆ·çš„è®¤è¯ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬å®šä¹‰çš„controlleræ–¹æ³•è¦è®©SpringSecurityå¯¹è¿™ä¸ªæ¥å£æ”¾è¡Œ(å¦‚æœä¸æ”¾è¡Œçš„è¯ï¼Œä¼šè¢«SpringSecurityæ‹¦æˆª)ï¼Œè®©ç”¨æˆ·è®¿é—®è¿™ä¸ªæ¥å£çš„æ—¶å€™ä¸ç”¨ç™»å½•ä¹Ÿèƒ½è®¿é—®ã€‚</p>
<p>â‘¡åœ¨serviceæ¥å£ä¸­æˆ‘ä»¬é€šè¿‡AuthenticationManagerçš„authenticateæ–¹æ³•æ¥è¿›è¡Œç”¨æˆ·è®¤è¯,æ‰€ä»¥éœ€è¦åœ¨SecurityConfigä¸­é…ç½®æŠŠAuthenticationManageræ³¨å…¥å®¹å™¨</p>
<p>â‘¢è®¤è¯æˆåŠŸçš„è¯è¦ç”Ÿæˆä¸€ä¸ªjwtï¼Œæ”¾å…¥å“åº”ä¸­è¿”å›ã€‚å¹¶ä¸”ä¸ºäº†è®©ç”¨æˆ·ä¸‹å›è¯·æ±‚æ—¶èƒ½é€šè¿‡jwtè¯†åˆ«å‡ºå…·ä½“çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisï¼Œå¯ä»¥æŠŠç”¨æˆ·idä½œä¸ºkeyã€‚</p>
<h1 id="ç™»å½•æ¥å£çš„å®ç°">ç™»å½•æ¥å£çš„å®ç°<a hidden class="anchor" aria-hidden="true" href="#ç™»å½•æ¥å£çš„å®ç°">#</a></h1>
<p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»º<code>SecurityConfig</code>ç±»ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Bean;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.authentication.AuthenticationManager;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.authentication.AuthenticationProvider;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.authentication.dao.DaoAuthenticationProvider;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.config.http.SessionCreationPolicy;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.crypto.password.PasswordEncoder;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.web.SecurityFilterChain;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@Configuration  
</span></span><span style="display:flex;"><span>@EnableMethodSecurity  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SecurityConfig {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Bean  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> SecurityFilterChain securityFilterChain(  
</span></span><span style="display:flex;"><span>            HttpSecurity httpSecurity,            JwtAuthenticationFilter jwtAuthenticationFilter,            AuthenticationProvider authenticationProvider,            CustomAuthorizationEntryPoint customAuthorizationEntryPoint,            CustomAccessDeniedHandler customAccessDeniedHandler) <span style="color:#fff;font-weight:bold">throws</span> Exception {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> httpSecurity  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">authorizeHttpRequests</span>(o -&gt; {  
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// å¯¹äºé™æ€èµ„æºéœ€è¦é€šè¿‡ requestMatchers é…ç½®è®¿é—®æƒé™ï¼Œå¯¹äºæ–¹æ³•å¯é€šè¿‡æ³¨è§£æˆ–é…ç½®ç±»æ¥æ§åˆ¶æƒé™  </span>
</span></span><span style="display:flex;"><span>                    o.<span style="color:#007f7f">requestMatchers</span>(<span style="color:#0ff;font-weight:bold">&#34;/login&#34;</span>).<span style="color:#007f7f">permitAll</span>();  
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// å…è®¸æ‰€æœ‰è®¿é—®  </span>
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">//o.anyRequest().permitAll();  </span>
</span></span><span style="display:flex;"><span>                })  
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// åœ¨ UsernamePasswordAuthenticationFilter è¿‡æ»¤å™¨ä¹‹å‰æ‰§è¡ŒJWTè®¤è¯è¿‡æ»¤å™¨  </span>
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">addFilterBefore</span>(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.<span style="color:#007f7f">class</span>)  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">authenticationProvider</span>(authenticationProvider)                .<span style="color:#007f7f">exceptionHandling</span>(o -&gt; {  
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// å¤„ç†æœªè®¤è¯å¼‚å¸¸  </span>
</span></span><span style="display:flex;"><span>                    o.<span style="color:#007f7f">authenticationEntryPoint</span>(customAuthorizationEntryPoint);  
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// å¤„ç†æœªæˆæƒå¼‚å¸¸  </span>
</span></span><span style="display:flex;"><span>                    o.<span style="color:#007f7f">accessDeniedHandler</span>(customAccessDeniedHandler);  
</span></span><span style="display:flex;"><span>                })                <span style="color:#007f7f">// å…³é—­csrfè¿‡æ»¤å™¨ï¼Œå› jwtä¸å­˜å‚¨åœ¨cookieï¼ˆjwtè¦å­˜å‚¨åœ¨localStorageä¸­ï¼Œå¦åˆ™ä»æœ‰csrfé£é™©ï¼‰  </span>
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">csrf</span>(AbstractHttpConfigurer::disable)  
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// åŸºäºtokenï¼Œä¸éœ€è¦session  </span>
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">sessionManagement</span>(o -&gt; o.<span style="color:#007f7f">sessionCreationPolicy</span>(SessionCreationPolicy.<span style="color:#007f7f">STATELESS</span>))  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">build</span>();    }  
</span></span><span style="display:flex;"><span>    @Bean  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) <span style="color:#fff;font-weight:bold">throws</span> Exception {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> authenticationConfiguration.<span style="color:#007f7f">getAuthenticationManager</span>();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * é…ç½®è‡ªå®šä¹‰çš„ UserDetailsService å­ç±»  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    @Bean  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> AuthenticationProvider authenticationProvider(MyUserDetailServiceImpl userDetailsService, PasswordEncoder passwordEncoder) {  
</span></span><span style="display:flex;"><span>        DaoAuthenticationProvider authenticationProvider = <span style="color:#fff;font-weight:bold">new</span> DaoAuthenticationProvider();  
</span></span><span style="display:flex;"><span>        authenticationProvider.<span style="color:#007f7f">setUserDetailsService</span>(userDetailsService);        authenticationProvider.<span style="color:#007f7f">setPasswordEncoder</span>(passwordEncoder);        <span style="color:#fff;font-weight:bold">return</span> authenticationProvider;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Bean  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> PasswordEncoder passwordEncoder() {  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä½¿ç”¨çš„å¯†ç æ¯”è¾ƒæ–¹å¼ï¼Œå•å‚æ„é€ ä¸ºåŠ å¯†å¼ºåº¦(4-31)ï¼Œé»˜è®¤10  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> BCryptPasswordEncoder(10);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»º<code>LoginService</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.domain.User;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.util.R;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> LoginService {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    R login(User user);  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ç°ç±»ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.domain.LoginUser;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.domain.User;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.service.LoginService;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.util.JwtUtil;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.util.R;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.util.RedisCache;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.authentication.AuthenticationManager;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.core.Authentication;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Service;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.HashMap;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Map;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Objects;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@Service  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LoginServiceImpl <span style="color:#fff;font-weight:bold">implements</span> LoginService {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åœ¨SecurityConfigé…ç½®åï¼Œè¿™é‡Œæ‰èƒ½ä½¿ç”¨  </span>
</span></span><span style="display:flex;"><span>    @Autowired  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> AuthenticationManager authenticationManager;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Autowired  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> RedisCache redisCache;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> R login(User user) {  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ç”¨æˆ·åœ¨ç™»å½•é¡µé¢è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç   </span>
</span></span><span style="display:flex;"><span>        UsernamePasswordAuthenticationToken authenticationToken = <span style="color:#fff;font-weight:bold">new</span> UsernamePasswordAuthenticationToken(user.<span style="color:#007f7f">getUserName</span>(),user.<span style="color:#007f7f">getPassword</span>());  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//è·å–AuthenticationManagerçš„authenticateæ–¹æ³•æ¥è¿›è¡Œç”¨æˆ·è®¤è¯  </span>
</span></span><span style="display:flex;"><span>        Authentication authenticate = authenticationManager.<span style="color:#007f7f">authenticate</span>(authenticationToken);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ¤æ–­ä¸Šé¢é‚£è¡Œçš„authenticateæ˜¯å¦ä¸ºnullï¼Œå¦‚æœæ˜¯åˆ™è®¤è¯æ²¡é€šè¿‡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(Objects.<span style="color:#007f7f">isNull</span>(authenticate)){  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;ç™»å½•å¤±è´¥&#34;</span>);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å¦‚æœè®¤è¯é€šè¿‡ï¼Œå°±ä½¿ç”¨useridç”Ÿæˆä¸€ä¸ªjwtï¼Œç„¶åæŠŠjwtå­˜å…¥ResponseResultåè¿”å›  </span>
</span></span><span style="display:flex;"><span>        LoginUser loginUser = (LoginUser) authenticate.<span style="color:#007f7f">getPrincipal</span>();  
</span></span><span style="display:flex;"><span>        String userid = loginUser.<span style="color:#007f7f">getXxuser</span>().<span style="color:#007f7f">getId</span>().<span style="color:#007f7f">toString</span>();        String jwt = JwtUtil.<span style="color:#007f7f">generateToken</span>(userid);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æŠŠå®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯å­˜å…¥redisï¼Œå…¶ä¸­useridä½œä¸ºkeyï¼Œæ³¨æ„å­˜å…¥redisçš„æ—¶å€™åŠ äº†å‰ç¼€ login:        Map&lt;String, String&gt; map = new HashMap&lt;&gt;();  </span>
</span></span><span style="display:flex;"><span>        map.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;token&#34;</span>,jwt);  
</span></span><span style="display:flex;"><span>        redisCache.<span style="color:#007f7f">setCacheObject</span>(<span style="color:#0ff;font-weight:bold">&#34;login:&#34;</span>+userid,loginUser);  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> R.<span style="color:#007f7f">ok</span>(<span style="color:#0ff;font-weight:bold">&#34;ç™»å½•æˆåŠŸ&#34;</span>,map);  
</span></span><span style="display:flex;"><span>    }}
</span></span></code></pre></td></tr></table>
</div>
</div><p>HelloControllerä¸­æ·»åŠ ç™»å½•æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@PostMapping(<span style="color:#0ff;font-weight:bold">&#34;/login&#34;</span>)  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> R login(@RequestBody User user){  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> loginService.<span style="color:#007f7f">login</span>(user);  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ·»åŠ redisé…ç½®ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">spring</span>:  
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">datasource</span>:  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">url</span>: jdbc:mysql://localhost:3306/wjy_security?characterEncoding=utf-8&amp;serverTimezone=UTC  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">username</span>: root  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">password</span>: root  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">driver-class-name</span>: com.mysql.cj.jdbc.Driver  
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">data</span>:  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">redis</span>:  
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">host</span>: localhost  
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">port</span>: <span style="color:#ff0;font-weight:bold">6379</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹æ•°æ®åº“ä¸­ç”¨æˆ·çš„å¯†ç ä¸ºåŠ å¯†åçš„ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$2a$10$/BavMP0Gud0RhGtAiiNcZ.EfY.uYsYW0d.b762n1Hj4wg21TyWgwO
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•ç™»å½•æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#f00">###  
</span></span></span><span style="display:flex;"><span><span style="color:#f00"># @name ç™»å½•  
</span></span></span><span style="display:flex;"><span><span style="color:#f00">POST localhost:8080/login  
</span></span></span><span style="display:flex;"><span><span style="color:#f00">Content-Type: application/json  
</span></span></span><span style="display:flex;"><span><span style="color:#f00">  
</span></span></span><span style="display:flex;"><span><span style="color:#f00">{  
</span></span></span><span style="display:flex;"><span><span style="color:#f00">  &#34;userName&#34;: &#34;wjy&#34;,  
</span></span></span><span style="display:flex;"><span><span style="color:#f00">  &#34;password&#34;: &#34;112233&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#f00">}
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆåŠŸï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#f00">{
</span></span></span><span style="display:flex;"><span><span style="color:#f00">  &#34;code&#34;: 200,
</span></span></span><span style="display:flex;"><span><span style="color:#f00">  &#34;msg&#34;: &#34;ç™»å½•æˆåŠŸ&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f00">  &#34;data&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#f00">    &#34;token&#34;: &#34;eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzQxNTgwMzI4LCJleHAiOjE3NDE2NjY3Mjh9.SpHiEAuK0ZSenoD6m25vnCY7en3PUHoYdfZXMeb9yBg&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f00">  }
</span></span></span><span style="display:flex;"><span><span style="color:#f00">}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="jwtè®¤è¯è¿‡æ»¤å™¨">jwtè®¤è¯è¿‡æ»¤å™¨<a hidden class="anchor" aria-hidden="true" href="#jwtè®¤è¯è¿‡æ»¤å™¨">#</a></h1>
<p>è¦å®ç°Jwtè®¤è¯è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬éœ€è¦è·å–tokenï¼Œç„¶åè§£ætokenè·å–å…¶ä¸­çš„useridï¼Œè¿˜éœ€è¦ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åå­˜å…¥SecurityContextHolder</p>
<p>ä¸ºä»€ä¹ˆè¦æœ‰rediså‚ä¸: æ˜¯ä¸ºäº†é˜²æ­¢è¿‡äº†å¾ˆä¹…ä¹‹åï¼Œæµè§ˆå™¨æ²¡æœ‰å…³é—­ï¼Œæ‹¿ç€tokenä¹Ÿèƒ½è®¿é—®ï¼Œè¿™æ ·ä¸å®‰å…¨</p>
<p>è®¤è¯è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆ: ä¸Šé¢æˆ‘ä»¬å®ç°ç™»å½•æ¥å£çš„æ—¶ï¼Œå½“æŸä¸ªç”¨æˆ·ç™»å½•ä¹‹åï¼Œè¯¥ç”¨æˆ·å°±ä¼šæœ‰ä¸€ä¸ªtokenå€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¤è¯è¿‡æ»¤å™¨ï¼Œç”±äºæœ‰tokenå€¼ï¼Œå¹¶ä¸”tokenå€¼è®¤è¯é€šè¿‡ï¼Œä¹Ÿå°±æ˜¯è¯æ˜æ˜¯è¿™ä¸ªç”¨æˆ·çš„tokenå€¼ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„ä¸šåŠ¡æ¥å£æ—¶ï¼Œå°±ä¸ä¼šè¢«Securityæ‹¦æˆªã€‚ç®€å•ç†è§£ä½œç”¨å°±æ˜¯ç™»å½•è¿‡çš„ç”¨æˆ·å¯ä»¥è®¿é—®æˆ‘ä»¬çš„ä¸šåŠ¡æ¥å£ï¼Œæ‹¿åˆ°å¯¹åº”çš„èµ„æº</p>
<p>ç¬¬ä¸€æ­¥: å®šä¹‰è¿‡æ»¤å™¨ã€‚æ–°å»º filter.JwtAuthenticationTokenFilter ç±»ï¼Œå†™å…¥å¦‚ä¸‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.domain.LoginUser;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.util.JwtUtil;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.util.RedisCache;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.annotation.Resource;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.FilterChain;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.ServletException;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletRequest;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletResponse;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.RequiredArgsConstructor;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.extern.slf4j.Slf4j;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.core.context.SecurityContextHolder;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.util.StringUtils;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.filter.OncePerRequestFilter;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Objects;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@Slf4j  
</span></span><span style="display:flex;"><span>@Component  
</span></span><span style="display:flex;"><span>@RequiredArgsConstructor  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JwtAuthenticationFilter <span style="color:#fff;font-weight:bold">extends</span> OncePerRequestFilter {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Resource  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> RedisCache redisCache;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//@Value(&#34;${jwt.token-prefix}&#34;)  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//private String tokenPrefix;    //@Value(&#34;${jwt.token-name}&#34;)    //private String tokenName;  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * doFilterInternalæ–¹æ³•ä¸­çš„é€»è¾‘æ˜¯åªè¦headerä¸­æœ‰jwtï¼Œå°±ä¼šç»è¿‡è¯¥è¿‡æ»¤å™¨  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * å› æ­¤å…¬å¼€çš„APIä¹Ÿä¼šèµ°ä¸€édoFilterInternalçš„æµç¨‹ï¼Œè¿™å¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“ï¼Œè€Œä¸”æ˜¯ä¸å¿…è¦çš„  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 2ç§è§£å†³æ–¹æ³•ï¼Œå‰ç«¯è¯·æ±‚å…¬å¼€APIæ—¶ä¸æºå¸¦tokenï¼›åç«¯é‡å†™å¦‚ä¸‹shouldNotFilteræ–¹æ³•  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return trueè¡¨ç¤ºä¸è¿‡æ»¤ï¼Œfalseåä¹‹  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">boolean</span> shouldNotFilter(HttpServletRequest request) {  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// do something...  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) <span style="color:#fff;font-weight:bold">throws</span> ServletException, IOException {  
</span></span><span style="display:flex;"><span>        log.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;request uri: {}&#34;</span>, request.<span style="color:#007f7f">getRequestURI</span>());  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        String s = request.<span style="color:#007f7f">getHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;Authorization&#34;</span>);  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¯·æ±‚æœªæºå¸¦token  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!StringUtils.<span style="color:#007f7f">hasText</span>(s) || !s.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;Bearer&#34;</span>)) {  
</span></span><span style="display:flex;"><span>            log.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;è¯·æ±‚æœªæºå¸¦token&#34;</span>);  
</span></span><span style="display:flex;"><span>            filterChain.<span style="color:#007f7f">doFilter</span>(request, response);            <span style="color:#fff;font-weight:bold">return</span>;  
</span></span><span style="display:flex;"><span>        }        <span style="color:#007f7f">// å¤„ç†ç©ºç™½å­—ç¬¦  </span>
</span></span><span style="display:flex;"><span>        String t = s.<span style="color:#007f7f">trim</span>().<span style="color:#007f7f">replaceAll</span>(<span style="color:#0ff;font-weight:bold">&#34;\\s+&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34; &#34;</span>);  
</span></span><span style="display:flex;"><span>        String token = t.<span style="color:#007f7f">substring</span>(t.<span style="color:#007f7f">indexOf</span>(<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>) + 1);  
</span></span><span style="display:flex;"><span>        String userId = JwtUtil.<span style="color:#007f7f">getUsernameFromToken</span>(token);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯  </span>
</span></span><span style="display:flex;"><span>        String redisKey = <span style="color:#0ff;font-weight:bold">&#34;login:&#34;</span> + userId;  
</span></span><span style="display:flex;"><span>        LoginUser loginUser = redisCache.<span style="color:#007f7f">getCacheObject</span>(redisKey);  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ¤æ–­è·å–åˆ°çš„ç”¨æˆ·ä¿¡æ¯æ˜¯å¦ä¸ºç©ºï¼Œå› ä¸ºredisé‡Œé¢å¯èƒ½å¹¶ä¸å­˜åœ¨è¿™ä¸ªç”¨æˆ·ä¿¡æ¯ï¼Œä¾‹å¦‚ç¼“å­˜è¿‡æœŸäº†  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(Objects.<span style="color:#007f7f">isNull</span>(loginUser)){  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;ç”¨æˆ·æœªç™»å½•&#34;</span>);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æŠŠæœ€ç»ˆçš„LoginUserç”¨æˆ·ä¿¡æ¯ï¼Œé€šè¿‡setAuthenticationæ–¹æ³•ï¼Œå­˜å…¥SecurityContextHolder  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//TODO è·å–æƒé™ä¿¡æ¯å°è£…åˆ°Authenticationä¸­  </span>
</span></span><span style="display:flex;"><span>        UsernamePasswordAuthenticationToken authenticationToken =  
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯LoginUserç”¨æˆ·ä¿¡æ¯ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡­è¯(null)ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æƒé™ä¿¡æ¯(null)  </span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> UsernamePasswordAuthenticationToken(loginUser,<span style="color:#fff;font-weight:bold">null</span>,<span style="color:#fff;font-weight:bold">null</span>);  
</span></span><span style="display:flex;"><span>        SecurityContextHolder.<span style="color:#007f7f">getContext</span>().<span style="color:#007f7f">setAuthentication</span>(authenticationToken);  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å…¨éƒ¨åšå®Œä¹‹åï¼Œæ”¾è¡Œ  </span>
</span></span><span style="display:flex;"><span>        filterChain.<span style="color:#007f7f">doFilter</span>(request, response);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥: ä¿®æ”¹SecurityConfigç±»ä¸ºå¦‚ä¸‹ï¼Œå…¶å®ä¹Ÿå°±æ˜¯åœ¨configureæ–¹æ³•åŠ äº†ä¸€ç‚¹ä»£ç ã€å¹¶ä¸”æ³¨å…¥äº†JwtAuthenticationTokenFilterç±»</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>.<span style="color:#007f7f">addFilterBefore</span>(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.<span style="color:#007f7f">class</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•æ‹¦æˆªèƒ½å¦ç”Ÿæ•ˆï¼Œä¸æºå¸¦tokenå‘é€getè¯·æ±‚æµ‹è¯•helloæ¥å£ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#f00">###  
</span></span></span><span style="display:flex;"><span><span style="color:#f00"># @name helloæ¥å£æµ‹è¯•  
</span></span></span><span style="display:flex;"><span><span style="color:#f00">GET localhost:8080/hello
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸é€šè¿‡ï¼Œè¿”å›403ã€‚</p>
<p>è¯·é‡æ–°ç™»å½•ï¼Œè·å–æ–°çš„tokenï¼Œç„¶åæºå¸¦tokenå‘é€getè¯·æ±‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#f00">###  
</span></span></span><span style="display:flex;"><span><span style="color:#f00"># @name helloæ¥å£æµ‹è¯•  
</span></span></span><span style="display:flex;"><span><span style="color:#f00">GET localhost:8080/hello  
</span></span></span><span style="display:flex;"><span><span style="color:#f00">Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzQxNTg2MjIxLCJleHAiOjE3NDE2NzI2MjF9.4Hz_fQ_Z8jj5UsMEgxCLxhiriZuQOT2xvvCV4tlv3PE
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•é€šè¿‡ã€‚</p>
<h1 id="æˆæƒ">æˆæƒ<a hidden class="anchor" aria-hidden="true" href="#æˆæƒ">#</a></h1>
<h2 id="æƒé™ç³»ç»Ÿçš„ä½œç”¨">æƒé™ç³»ç»Ÿçš„ä½œç”¨<a hidden class="anchor" aria-hidden="true" href="#æƒé™ç³»ç»Ÿçš„ä½œç”¨">#</a></h2>
<p>ä¸ºä»€ä¹ˆè¦è®¾è®¡æƒé™ç³»ç»Ÿ ?</p>
<p>ä¾‹å¦‚è¦è®¾è®¡ä¸€ä¸ªå›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼Œæ™®é€šå­¦ç”Ÿè´¦å·çš„æƒé™ä¸èƒ½ä½¿ç”¨ä¹¦ç±ç¼–è¾‘ã€åˆ é™¤çš„åŠŸèƒ½ï¼Œæ™®é€šå­¦ç”Ÿèƒ½ä½¿ç”¨çš„åŠŸèƒ½ä»…ä»…æ˜¯æµè§ˆé¡µé¢ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ˜¯å›¾ä¹¦ç®¡ç†å‘˜ç”¨æˆ·ï¼Œé‚£ä¹ˆå°±èƒ½ä½¿ç”¨æ‰€æœ‰æƒé™ã€‚ç®€å•ç†è§£å°±æ˜¯æˆ‘ä»¬éœ€è¦ä¸åŒçš„ç”¨æˆ·ä½¿ç”¨ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™å°±æ˜¯æƒé™ç³»ç»Ÿè¦å®ç°çš„æ•ˆæœã€‚</p>
<p>è™½ç„¶å‰ç«¯ä¹Ÿå¯ä»¥å»åˆ¤æ–­ç”¨æˆ·çš„æƒé™æ¥é€‰æ‹©æ˜¯å¦æ˜¾ç¤ºæŸäº›åŠŸèƒ½çš„é¡µé¢æˆ–ç»„ä»¶ï¼Œä½†æ˜¯ä¸å®‰å…¨ï¼Œå› ä¸ºå¦‚æœæœ‰äººçŸ¥é“äº†å¯¹åº”åŠŸèƒ½çš„æ¥å£åœ°å€å°±å¯ä»¥ä¸é€šè¿‡å‰ç«¯ï¼Œç›´æ¥å»å‘é€è¯·æ±‚æ¥å®ç°ç›¸å…³åŠŸèƒ½æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨åç«¯è¿›è¡Œç”¨æˆ·æƒé™çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰ç›¸åº”çš„æƒé™ï¼Œå¿…é¡»å…·æœ‰æ‰€éœ€æƒé™æ‰èƒ½è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p>
<p>å‰ç«¯é˜²å›å­ï¼Œåç«¯é˜²å°äººã€‚</p>
<h2 id="æˆæƒåŸºæœ¬æµç¨‹">æˆæƒåŸºæœ¬æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#æˆæƒåŸºæœ¬æµç¨‹">#</a></h2>
<p>åœ¨SpringSecurityä¸­ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„FilterSecurityInterceptoræ¥è¿›è¡Œæƒé™æ ¡éªŒã€‚åœ¨FilterSecurityInterceptorä¸­ä¼šä»SecurityContextHolderè·å–å…¶ä¸­çš„Authenticationï¼Œç„¶åè·å–å…¶ä¸­çš„æƒé™ä¿¡æ¯ã€‚å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®å½“å‰èµ„æºæ‰€éœ€çš„æƒé™ã€‚
æ‰€ä»¥æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åªéœ€è¦æŠŠå½“å‰ç™»å½•ç”¨æˆ·çš„æƒé™ä¿¡æ¯ä¹Ÿå­˜å…¥Authenticationï¼Œç„¶åè®¾ç½®æˆ‘ä»¬çš„èµ„æºæ‰€éœ€è¦çš„æƒé™å³å¯ã€‚</p>
<h2 id="è‡ªå®šä¹‰è®¿é—®è·¯å¾„çš„æƒé™">è‡ªå®šä¹‰è®¿é—®è·¯å¾„çš„æƒé™<a hidden class="anchor" aria-hidden="true" href="#è‡ªå®šä¹‰è®¿é—®è·¯å¾„çš„æƒé™">#</a></h2>
<p>SpringSecurityä¸ºæˆ‘ä»¬æä¾›äº†åŸºäºæ³¨è§£çš„æƒé™æ§åˆ¶æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­ä¸»è¦é‡‡ç”¨çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨è§£å»æŒ‡å®šè®¿é—®å¯¹åº”çš„èµ„æºæ‰€éœ€çš„æƒé™</p>
<p>ç¬¬ä¸€æ­¥: åœ¨SecurityConfigé…ç½®ç±»æ·»åŠ å¦‚ä¸‹ï¼Œä½œç”¨æ˜¯å¼€å¯ç›¸å…³é…ç½®</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@EnableMethodSecurity
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥: å¼€å¯äº†ç›¸å…³é…ç½®ä¹‹åï¼Œå°±èƒ½ä½¿ç”¨@PreAuthorizeç­‰æ³¨è§£äº†ã€‚åœ¨HelloControllerç±»çš„helloæ–¹æ³•ï¼Œæ·»åŠ å¦‚ä¸‹æ³¨è§£ï¼Œå…¶ä¸­testè¡¨ç¤ºè‡ªå®šä¹‰æƒé™çš„åå­—</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@PreAuthorize(&#34;hasAuthority(&#39;test&#39;)&#34;)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¸¦æƒé™è®¿é—®çš„å®ç°">å¸¦æƒé™è®¿é—®çš„å®ç°<a hidden class="anchor" aria-hidden="true" href="#å¸¦æƒé™è®¿é—®çš„å®ç°">#</a></h2>
<p>æƒé™ä¿¡æ¯å°±æ˜¯ï¼šæœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ä¸²ã€‚</p>
<p>æˆ‘ä»¬å‰é¢åœ¨ç™»å½•æ—¶ï¼Œä¼šè°ƒç”¨åˆ°MyUserDetailServiceImplç±»çš„loadUserByUsernameæ–¹æ³•ï¼Œå½“æ—¶æˆ‘ä»¬å†™loadUserByUsernameæ–¹æ³•æ—¶ï¼Œåªå†™äº†æŸ¥è¯¢ç”¨æˆ·æ•°æ®ä¿¡æ¯çš„ä»£ç ï¼Œè¿˜å·®æŸ¥è¯¢ç”¨æˆ·æƒé™ä¿¡æ¯çš„ä»£ç ã€‚åœ¨ç™»å½•å®Œä¹‹åï¼Œå› ä¸ºæºå¸¦äº†tokenï¼Œæ‰€ä»¥éœ€è¦åœ¨JwtAuthenticationTokenFilterç±»æ·»åŠ  &lsquo;è·å–æƒé™ä¿¡æ¯å°è£…åˆ°Authenticationä¸­&rsquo; çš„ä»£ç ï¼Œæ·»åŠ åˆ°UsernamePasswordAuthenticationTokençš„ç¬¬ä¸‰ä¸ªå‚æ•°é‡Œé¢ï¼Œæˆ‘ä»¬å½“æ—¶ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ çš„æ˜¯nullã€‚</p>
<p>ç¬¬ä¸€æ­¥: åœ¨ä¸Šé¢çš„'3. è‡ªå®šä¹‰è®¿é—®è·¯å¾„çš„æƒé™&rsquo;ï¼Œæˆ‘ä»¬ç»™HelloControllerç±»çš„ /hello è·¯å¾„æ·»åŠ äº†æƒé™é™åˆ¶ï¼Œåªæœ‰ç”¨æˆ·å…·æœ‰å«testçš„æƒé™ï¼Œæ‰èƒ½è®¿é—®è¿™ä¸ªè·¯å¾„ã€‚</p>
<p>ç¬¬äºŒæ­¥: æŠŠMyUserDetailServiceImplç±»ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼Œä¸»è¦æ˜¯å¢åŠ äº†æŸ¥è¯¢ç”¨æˆ·æƒé™ä¿¡æ¯çš„ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Service
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MyUserDetailServiceImpl <span style="color:#fff;font-weight:bold">implements</span> UserDetailsService {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> UserMapper userMapper;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//UserDetailsæ˜¯Securityå®˜æ–¹æä¾›çš„æ¥å£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> UserDetails loadUserByUsername(String xxusername) <span style="color:#fff;font-weight:bold">throws</span> UsernameNotFoundException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚æˆ‘ä»¬å†™çš„userMapperæ¥å£é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥è°ƒç”¨çš„æ˜¯mybatis-plusæä¾›çš„æ–¹æ³•</span>
</span></span><span style="display:flex;"><span>        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span style="color:#fff;font-weight:bold">new</span> LambdaQueryWrapper&lt;&gt;();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//eqæ–¹æ³•è¡¨ç¤ºç­‰å€¼åŒ¹é…ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°æ®åº“çš„ç”¨æˆ·åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬ä¼ è¿›æ¥çš„ç”¨æˆ·åï¼Œè¿™ä¸¤ä¸ªå‚æ•°è¿›è¡Œæ¯”è¾ƒæ˜¯å¦ç›¸ç­‰</span>
</span></span><span style="display:flex;"><span>        queryWrapper.<span style="color:#007f7f">eq</span>(User::getUserName,xxusername);
</span></span><span style="display:flex;"><span>        User user = userMapper.<span style="color:#007f7f">selectOne</span>(queryWrapper);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å¦‚æœç”¨æˆ·ä¼ è¿›æ¥çš„ç”¨æˆ·åï¼Œä½†æ˜¯æ•°æ®åº“æ²¡æœ‰è¿™ä¸ªç”¨æˆ·åï¼Œå°±ä¼šå¯¼è‡´æˆ‘ä»¬æ˜¯æŸ¥ä¸åˆ°çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±è¿›è¡Œä¸‹é¢çš„åˆ¤æ–­ã€‚é¿å…ç¨‹åºå®‰å…¨é—®é¢˜</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(Objects.<span style="color:#007f7f">isNull</span>(user)){<span style="color:#007f7f">//åˆ¤æ–­userå¯¹è±¡æ˜¯å¦ä¸ºç©ºã€‚å½“åœ¨æ•°æ®åº“æ²¡æœ‰æŸ¥åˆ°æ•°æ®æ—¶ï¼Œuserå°±ä¼šä¸ºç©ºï¼Œä¹Ÿå°±ä¼šè¿›å…¥è¿™ä¸ªåˆ¤æ–­</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//--------------------------------æŸ¥è¯¢ç”¨æˆ·æƒé™ä¿¡æ¯---------------------------------</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ç”±äºæˆ‘ä»¬è‡ªå®šä¹‰äº†3ä¸ªæƒé™ï¼Œæ‰€ä»¥ç”¨Listé›†åˆå­˜å‚¨ã€‚æ³¨æ„æƒé™å®é™…å°±æ˜¯&#39;æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ä¸²&#39;ï¼Œæ‰€ä»¥ä¸‹é¢çš„ä¸‰ä¸ªå­—ç¬¦ä¸²å°±æ˜¯è‡ªå®šä¹‰çš„</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ä¸‹é¢é‚£è¡Œå°±æ˜¯æˆ‘ä»¬çš„æƒé™é›†åˆï¼Œç­‰ä¸‹è¿˜è¦åœ¨LoginUserç±»åšæƒé™é›†åˆçš„è½¬æ¢</span>
</span></span><span style="display:flex;"><span>        List&lt;String&gt; list = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;(Arrays.<span style="color:#007f7f">asList</span>(<span style="color:#0ff;font-weight:bold">&#34;test&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;adminAuth&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;huanfAuth&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//------------------------------------------------------------------------------</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æŠŠæŸ¥è¯¢åˆ°çš„userç»“æœï¼Œå°è£…æˆUserDetailsç±»å‹ï¼Œç„¶åè¿”å›ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ä½†æ˜¯ç”±äºUserDetailsæ˜¯ä¸ªæ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆéœ€è¦åœ¨dominoç›®å½•æ–°å»ºLoginUserç±»ï¼Œä½œä¸ºUserDetailsçš„å®ç°ç±»ï¼Œå†å†™ä¸‹é¢é‚£è¡Œ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> LoginUser(user,list); <span style="color:#007f7f">//è¿™é‡Œä¼ äº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºçš„æ˜¯æƒé™ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰æ­¥: å°è£…æƒé™ä¿¡æ¯ã€‚æŠŠLoginUserç±»ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼Œä¸»è¦æ˜¯å¢åŠ äº†æŠŠç”¨æˆ·æƒé™å­—ç¬¦ä¸²çš„é›†åˆï¼Œè½¬æ¢å°è£…åœ¨authoritieså˜é‡é‡Œé¢</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data <span style="color:#007f7f">//getå’Œsetæ–¹æ³•  </span>
</span></span><span style="display:flex;"><span>@NoArgsConstructor <span style="color:#007f7f">//æ— å‚æ„é€   </span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//@AllArgsConstructor //åœ¨ä¸‹é¢å°è£…æƒé™ä¿¡æ¯æ—¶ï¼Œç”±äºæˆ‘ä»¬è‡ªå·±å†™æœ‰å‚æ„é€ ï¼Œæ‰€ä»¥è¿™ä¸ªæ³¨è§£éœ€è¦æ³¨é‡Šæ‰  </span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//å®ç°UserDetailsæ¥å£ä¹‹åï¼Œè¦é‡å†™UserDetailsæ¥å£é‡Œé¢çš„7ä¸ªæ–¹æ³•  </span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LoginUser <span style="color:#fff;font-weight:bold">implements</span> UserDetails {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//æŸ¥è¯¢ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ç­‰æ•°æ®ä¿¡æ¯  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> User xxuser;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//æŸ¥è¯¢ç”¨æˆ·æƒé™ä¿¡æ¯  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> List&lt;String&gt; xxpermissions;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> LoginUser(User xxuser, List&lt;String&gt; permissions) {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">xxuser</span> = xxuser;  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">xxpermissions</span> = permissions;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//æˆ‘ä»¬æŠŠè¿™ä¸ªListå†™åˆ°å¤–é¢è¿™é‡Œäº†ï¼Œæ³¨æ„æˆå‘˜å˜é‡åä¸€å®šè¦æ˜¯authoritiesï¼Œä¸ç„¶ä¼šå‡ºç°å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜  </span>
</span></span><span style="display:flex;"><span>    @JSONField(serialize = <span style="color:#fff;font-weight:bold">false</span>) <span style="color:#007f7f">//è¿™ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯ä¸è®©ä¸‹é¢é‚£è¡Œçš„æˆå‘˜å˜é‡åºåˆ—åŒ–å­˜å…¥redisï¼Œé¿å…redisä¸æ”¯æŒè€ŒæŠ¥å¼‚å¸¸  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> List&lt;SimpleGrantedAuthority&gt; authorities;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//ç”¨äºè¿”å›æƒé™ä¿¡æ¯ã€‚ç°åœ¨æˆ‘ä»¬æ­£åœ¨å­¦&#39;è®¤è¯&#39;ï¼Œ&#39;æƒé™&#39;åé¢æ‰å­¦ã€‚æ‰€ä»¥è¿”å›nullå³å¯  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//å½“è¦æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸èƒ½å•çº¯è¿”å›nullï¼Œè¦é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œä½œç”¨æ˜¯å°è£…æƒé™ä¿¡æ¯  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Collection&lt;? <span style="color:#fff;font-weight:bold">extends</span> GrantedAuthority&gt; getAuthorities() { <span style="color:#007f7f">//é‡å†™GrantedAuthorityæ¥å£çš„getAuthoritiesæ–¹æ³•  </span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">/* ç¬¬ä¸€ç§æƒé™é›†åˆçš„è½¬æ¢å†™æ³•å¦‚ä¸‹ï¼Œä¼ ç»Ÿçš„æ–¹å¼  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">        //æŠŠxxpermissionsä¸­çš„Stringç±»å‹çš„æƒé™ä¿¡æ¯(ä¹Ÿå°±æ˜¯&#34;test&#34;,&#34;adminAuth&#34;,&#34;huanfAuth&#34;)å°è£…æˆSimpleGrantedAuthorityå¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">        //List&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;(); //ç®€åŒ–è¿™è¡Œå¦‚ä¸‹ä¸€è¡Œï¼Œæˆ‘ä»¬æŠŠauthoritiesæˆå‘˜å˜é‡å†™åˆ°å¤–é¢äº†  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">        authorities = new ArrayList&lt;&gt;();        for (String yypermission : xxpermissions) {            SimpleGrantedAuthority yyauthority = new SimpleGrantedAuthority(yypermission);            authorities.add(yyauthority);        }        */</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">/* ç¬¬äºŒç§æƒé™é›†åˆçš„è½¬æ¢å†™æ³•å¦‚ä¸‹ï¼Œå‡½æ•°å¼ç¼–ç¨‹ + streamæµ çš„æ–¹å¼ï¼ŒåŒå¼•å·è¡¨ç¤ºæ–¹æ³•å¼•ç”¨ */</span>        <span style="color:#007f7f">//å½“authoritiesé›†åˆä¸ºç©ºï¼Œå°±è¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡ï¼Œå°±éœ€è¦è½¬æ¢ï¼Œå½“ä¸ä¸ºç©ºå°±è¯´æ˜ä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œå°±ä¸éœ€è¦è½¬æ¢ç›´æ¥è¿”å›  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(authorities != <span style="color:#fff;font-weight:bold">null</span>){ <span style="color:#007f7f">//ä¸¥è°¨æ¥è¯´è¿™ä¸ªifåˆ¤æ–­æ˜¯é¿å…æ•´ä¸ªè°ƒç”¨é“¾ä¸­securityæœ¬åœ°çº¿ç¨‹å˜é‡åœ¨è·å–ç”¨æˆ·æ—¶çš„é‡å¤è§£æï¼Œå’Œrediså­˜å–æ— å…³  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> authorities;  
</span></span><span style="display:flex;"><span>        }        <span style="color:#007f7f">//ä¸ºç©ºçš„è¯å°±ä¼šæ‰§è¡Œä¸‹é¢çš„è½¬æ¢ä»£ç   </span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//List&lt;SimpleGrantedAuthority&gt; authorities = xxpermissions //ç®€åŒ–è¿™è¡Œå¦‚ä¸‹ä¸€è¡Œï¼Œæˆ‘ä»¬æŠŠauthoritiesæˆå‘˜å˜é‡å†™åˆ°å¤–é¢äº†  </span>
</span></span><span style="display:flex;"><span>        authorities = xxpermissions  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">stream</span>()  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">map</span>(SimpleGrantedAuthority::<span style="color:#fff;font-weight:bold">new</span>)  
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æœ€ç»ˆè¿”å›è½¬æ¢ç»“æœ  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> authorities;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//ç”¨äºè·å–ç”¨æˆ·å¯†ç ã€‚ç”±äºä½¿ç”¨çš„å®ä½“ç±»æ˜¯Userï¼Œæ‰€ä»¥è·å–çš„æ˜¯æ•°æ®åº“çš„ç”¨æˆ·å¯†ç   </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getPassword() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> xxuser.<span style="color:#007f7f">getPassword</span>();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//ç”¨äºè·å–ç”¨æˆ·åã€‚ç”±äºä½¿ç”¨çš„å®ä½“ç±»æ˜¯Userï¼Œæ‰€ä»¥è·å–çš„æ˜¯æ•°æ®åº“çš„ç”¨æˆ·å  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getUsername() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> xxuser.<span style="color:#007f7f">getUserName</span>();  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//åˆ¤æ–­ç™»å½•çŠ¶æ€æ˜¯å¦è¿‡æœŸã€‚æŠŠè¿™ä¸ªæ”¹æˆtrueï¼Œè¡¨ç¤ºæ°¸ä¸è¿‡æœŸ  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isAccountNonExpired() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//åˆ¤æ–­è´¦å·æ˜¯å¦è¢«é”å®šã€‚æŠŠè¿™ä¸ªæ”¹æˆtrueï¼Œè¡¨ç¤ºæœªé”å®š  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isAccountNonLocked() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//åˆ¤æ–­ç™»å½•å‡­è¯æ˜¯å¦è¿‡æœŸã€‚æŠŠè¿™ä¸ªæ”¹æˆtrueï¼Œè¡¨ç¤ºæ°¸ä¸è¿‡æœŸ  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isCredentialsNonExpired() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¯ç”¨ã€‚æŠŠè¿™ä¸ªæ”¹æˆtrueï¼Œè¡¨ç¤ºå¯ç”¨çŠ¶æ€  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> isEnabled() {  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>    }}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬å››æ­¥: æŠŠJwtAuthenticationTokenFilterç±»ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼Œä¸»è¦æ˜¯è¡¥å……äº†å‰é¢æ²¡å†™çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå†™æˆç¬¬ä¸‰æ­¥å°è£…å¥½çš„æƒé™ä¿¡æ¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>UsernamePasswordAuthenticationToken authenticationToken =  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯LoginUserç”¨æˆ·ä¿¡æ¯ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡­è¯(null)ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æƒé™ä¿¡æ¯(null)  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> UsernamePasswordAuthenticationToken(loginUser,<span style="color:#fff;font-weight:bold">null</span>, loginUser.<span style="color:#007f7f">getAuthorities</span>());
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äº”æ­¥ï¼šæµ‹è¯•ã€‚</p>
<ol>
<li>é‡æ–°ç™»å½•ï¼Œè·å–tokenã€‚</li>
<li>è¯·æ±‚helloæ¥å£ï¼ŒæˆåŠŸã€‚</li>
<li>ä¿®æ”¹helloæ¥å£çš„æƒé™å€¼ä¸º<code>xxtest</code></li>
<li>å†æ¬¡è¯·æ±‚helloæ¥å£ï¼Œå¤±è´¥ï¼Œå› ä¸ºå½“å‰ç”¨æˆ·æ²¡æœ‰xxtestæƒé™ã€‚</li>
</ol>
<h1 id="rbacæƒé™æ¨¡å‹">RBACæƒé™æ¨¡å‹<a hidden class="anchor" aria-hidden="true" href="#rbacæƒé™æ¨¡å‹">#</a></h1>
<p>åˆšåˆšæˆ‘ä»¬å®ç°äº†åªæœ‰å½“ç”¨æˆ·å…·å¤‡æŸç§æƒé™ï¼Œæ‰èƒ½è®¿é—®æˆ‘ä»¬çš„æŸä¸ªä¸šåŠ¡æ¥å£ã€‚ä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ç»™ç”¨æˆ·è®¾ç½®æƒé™çš„æ—¶å€™ï¼Œæ˜¯å†™æ­»çš„ï¼Œåœ¨çœŸæ­£çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯ï¼Œä¸‹é¢å°±æ¥å­¦ä¹ å¦‚ä½•ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯ï¼Œç„¶åå°è£…ç»™ç”¨æˆ·ã€‚</p>
<p>RBACæƒé™æ¨¡å‹ (Role-Based Access Control) ï¼Œæ˜¯æƒé™ç³»ç»Ÿç”¨åˆ°çš„ç»å…¸æ¨¡å‹ï¼ŒåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚è¯¥æ¨¡å‹ç”±ä»¥ä¸‹äº”ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†æ„æˆ:</p>
<p>ä¸€ã€ç”¨æˆ·: åœ¨ç³»ç»Ÿä¸­ä»£è¡¨å…·ä½“ä¸ªä½“çš„å®ä½“ï¼Œå¯ä»¥æ˜¯äººå‘˜ã€ç¨‹åºæˆ–å…¶ä»–å®ä½“ã€‚ç”¨æˆ·éœ€è¦è®¿é—®ç³»ç»Ÿèµ„æºã€‚</p>
<p>äºŒã€è§’è‰²: è§’è‰²æ˜¯æƒé™çš„é›†åˆï¼Œç”¨äºå®šä¹‰ä¸€ç»„ç›¸ä¼¼æƒé™çš„é›†åˆã€‚è§’è‰²å¯ä»¥è¢«èµ‹äºˆç»™ç”¨æˆ·ï¼Œä»è€Œæˆäºˆç”¨æˆ·ç›¸åº”çš„æƒé™ã€‚</p>
<p>ä¸‰ã€æƒé™: æƒé™è¡¨ç¤ºç³»ç»Ÿä¸­å…·ä½“çš„æ“ä½œæˆ–åŠŸèƒ½ï¼Œä¾‹å¦‚è¯»å–ã€å†™å…¥ã€æ‰§è¡Œç­‰ã€‚æ¯ä¸ªæƒé™å®šä¹‰äº†å¯¹ç³»ç»Ÿèµ„æºçš„è®¿é—®è§„åˆ™ã€‚</p>
<p>å››ã€ç”¨æˆ·-è§’è‰²æ˜ å°„: ç”¨æˆ·-è§’è‰²æ˜ å°„ç”¨äºè¡¨ç¤ºç”¨æˆ·ä¸è§’è‰²ä¹‹é—´çš„å…³ç³»ã€‚é€šè¿‡ä¸ºç”¨æˆ·åˆ†é…é€‚å½“çš„è§’è‰²ï¼Œç”¨æˆ·å¯ä»¥è·å¾—ä¸è§’è‰²ç›¸å…³è”çš„æƒé™ã€‚</p>
<p>äº”ã€è§’è‰²-æƒé™æ˜ å°„: è§’è‰²-æƒé™æ˜ å°„è¡¨ç¤ºè§’è‰²ä¸æƒé™ä¹‹é—´çš„å…³ç³»ã€‚æ¯ä¸ªè§’è‰²éƒ½è¢«åˆ†é…äº†ä¸€ç»„æƒé™ï¼Œè¿™äº›æƒé™å†³å®šäº†è§’è‰²å¯æ‰§è¡Œçš„æ“ä½œã€‚</p>
<p>æˆªæ­¢ç›®å‰ï¼Œæˆ‘ä»¬æ•°æ®åº“åªæœ‰1å¼ è¡¨ï¼Œåœ¨ä¸Šé¢ &lsquo;è®¤è¯&rsquo; çš„ &lsquo;6. è‡ªå®šä¹‰securityçš„æ•°æ®åº“&rsquo; é‡Œé¢åˆ›å»ºçš„ sys_user ç”¨æˆ·è¡¨ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šæ–°å¢4å¼ è¡¨ï¼Œåˆ†åˆ«æ˜¯æƒé™è¡¨(æ¯æ¡æ•°æ®æ˜¯å•ä¸ª&rsquo;ç²’åº¦ç»†çš„æƒé™&rsquo;)ã€è§’è‰²è¡¨(æ¯æ¡æ•°æ®æ˜¯å¤šä¸ª&rsquo;ç²’åº¦ç»†çš„æƒé™&rsquo;)ã€è§’è‰²è¡¨ä¸æƒé™è¡¨çš„ä¸­é—´è¡¨ã€ç”¨æˆ·è¡¨ä¸è§’è‰²è¡¨çš„ä¸­é—´è¡¨ã€‚æ€»å…±5å¼ è¡¨ï¼Œç»„æˆäº†RBACæ¨¡å‹ï¼Œä¸­é—´è¡¨çš„ä½œç”¨æ˜¯ç»´æŠ¤ä¸¤å¼ è¡¨çš„å¤šå¯¹å¤šå…³ç³»ã€‚</p>
<h1 id="æƒé™è¡¨åˆ›å»º">æƒé™è¡¨åˆ›å»º<a hidden class="anchor" aria-hidden="true" href="#æƒé™è¡¨åˆ›å»º">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `sys_menu` (
</span></span><span style="display:flex;"><span>  `id` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">20</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT,
</span></span><span style="display:flex;"><span>  `menu_name` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">64</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;NULL&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;èœå•å&#39;</span>,
</span></span><span style="display:flex;"><span>  `path` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">200</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;è·¯ç”±åœ°å€&#39;</span>,
</span></span><span style="display:flex;"><span>  `component` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">255</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;ç»„ä»¶è·¯å¾„&#39;</span>,
</span></span><span style="display:flex;"><span>  `visible` <span style="color:#fff;font-weight:bold">char</span>(<span style="color:#ff0;font-weight:bold">1</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;èœå•çŠ¶æ€ï¼ˆ0æ˜¾ç¤º 1éšè—ï¼‰&#39;</span>,
</span></span><span style="display:flex;"><span>  `status` <span style="color:#fff;font-weight:bold">char</span>(<span style="color:#ff0;font-weight:bold">1</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;èœå•çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#39;</span>,
</span></span><span style="display:flex;"><span>  `perms` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;æƒé™æ ‡è¯†&#39;</span>,
</span></span><span style="display:flex;"><span>  `icon` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;#&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;èœå•å›¾æ ‡&#39;</span>,
</span></span><span style="display:flex;"><span>  `create_by` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">20</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `create_time` datetime <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `update_by` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">20</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `update_time` datetime <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `del_flag` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">11</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;æ˜¯å¦åˆ é™¤ï¼ˆ0æœªåˆ é™¤ 1å·²åˆ é™¤ï¼‰&#39;</span>,
</span></span><span style="display:flex;"><span>  `remark` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">500</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;å¤‡æ³¨&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB AUTO_INCREMENT=<span style="color:#ff0;font-weight:bold">2</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8mb4 <span style="color:#fff;font-weight:bold">COMMENT</span>=<span style="color:#0ff;font-weight:bold">&#39;æƒé™è¡¨&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `sys_role` (
</span></span><span style="display:flex;"><span>  `id` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">20</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT,
</span></span><span style="display:flex;"><span>  `name` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">128</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `role_key` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;è§’è‰²æƒé™å­—ç¬¦ä¸²&#39;</span>,
</span></span><span style="display:flex;"><span>  `status` <span style="color:#fff;font-weight:bold">char</span>(<span style="color:#ff0;font-weight:bold">1</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;è§’è‰²çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#39;</span>,
</span></span><span style="display:flex;"><span>  `del_flag` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">1</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;del_flag&#39;</span>,
</span></span><span style="display:flex;"><span>  `create_by` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">200</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `create_time` datetime <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `update_by` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">200</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `update_time` datetime <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>  `remark` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">500</span>) <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;å¤‡æ³¨&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB AUTO_INCREMENT=<span style="color:#ff0;font-weight:bold">3</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8mb4 <span style="color:#fff;font-weight:bold">COMMENT</span>=<span style="color:#0ff;font-weight:bold">&#39;è§’è‰²è¡¨&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `sys_role_menu` (
</span></span><span style="display:flex;"><span>  `role_id` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">200</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;è§’è‰²ID&#39;</span>,
</span></span><span style="display:flex;"><span>  `menu_id` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">200</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;èœå•id&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`role_id`,`menu_id`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB AUTO_INCREMENT=<span style="color:#ff0;font-weight:bold">2</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8mb4;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `sys_user_role` (
</span></span><span style="display:flex;"><span>  `user_id` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">200</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;ç”¨æˆ·id&#39;</span>,
</span></span><span style="display:flex;"><span>  `role_id` <span style="color:#fff;font-weight:bold">bigint</span>(<span style="color:#ff0;font-weight:bold">200</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#0ff;font-weight:bold">&#39;0&#39;</span> <span style="color:#fff;font-weight:bold">COMMENT</span> <span style="color:#0ff;font-weight:bold">&#39;è§’è‰²id&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`user_id`,`role_id`)
</span></span><span style="display:flex;"><span>) ENGINE=InnoDB <span style="color:#fff;font-weight:bold">DEFAULT</span> CHARSET=utf8mb4;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> sys_user_role <span style="color:#fff;font-weight:bold">values</span> (<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> sys_role <span style="color:#fff;font-weight:bold">values</span>
</span></span><span style="display:flex;"><span>(<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#0ff;font-weight:bold">&#39;ç»ç†&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;ceo&#39;</span>,<span style="color:#ff0;font-weight:bold">0</span>,<span style="color:#ff0;font-weight:bold">0</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#0ff;font-weight:bold">&#39;ç¨‹åºå‘˜&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;coder&#39;</span>,<span style="color:#ff0;font-weight:bold">0</span>,<span style="color:#ff0;font-weight:bold">0</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> sys_role_menu <span style="color:#fff;font-weight:bold">values</span> (<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">1</span>),(<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> sys_menu <span style="color:#fff;font-weight:bold">values</span>
</span></span><span style="display:flex;"><span>(<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#0ff;font-weight:bold">&#39;éƒ¨é—¨ç®¡ç†&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;dept&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;system/dept/index&#39;</span>,<span style="color:#ff0;font-weight:bold">0</span>,<span style="color:#ff0;font-weight:bold">0</span>,<span style="color:#0ff;font-weight:bold">&#39;system:dept:list&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;#&#39;</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>),
</span></span><span style="display:flex;"><span>(<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#0ff;font-weight:bold">&#39;æµ‹è¯•&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;test&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;system/test/index&#39;</span>,<span style="color:#ff0;font-weight:bold">0</span>,<span style="color:#ff0;font-weight:bold">0</span>,<span style="color:#0ff;font-weight:bold">&#39;system:test:list&#39;</span>,<span style="color:#0ff;font-weight:bold">&#39;#&#39;</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>,<span style="color:#fff;font-weight:bold">default</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥: æµ‹è¯•SQLè¯­å¥ï¼Œä¹Ÿå°±æ˜¯ç¡®è®¤ä¸€ä¸‹ä½ çš„å»ºè¡¨ã€æ’å…¥æ•°æ®æ˜¯å¦è¾¾åˆ°è¦æ±‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span># <span style="color:#f00">é€šè¿‡ç”¨æˆ·</span>idå»æŸ¥è¯¢è¿™ä¸ªç”¨æˆ·å…·æœ‰çš„æƒé™åˆ—è¡¨<span style="color:#f00">ã€‚ä¹Ÿå°±æ˜¯æ ¹æ®</span>useridæŸ¥è¯¢perms<span style="color:#f00">ï¼Œå¹¶ä¸”é™åˆ¶æ¡ä»¶ä¸º</span>roleå’Œmenuéƒ½å¿…é¡»æ­£å¸¸çŠ¶æ€ä¹ˆä¹Ÿå°±æ˜¯ç­‰äº0
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">DISTINCT</span> m.`perms`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">FROM</span>
</span></span><span style="display:flex;"><span>	sys_user_role ur
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">LEFT</span> <span style="color:#fff;font-weight:bold">JOIN</span> `sys_role` r <span style="color:#fff;font-weight:bold">ON</span> ur.`role_id` = r.`id`
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">LEFT</span> <span style="color:#fff;font-weight:bold">JOIN</span> `sys_role_menu` rm <span style="color:#fff;font-weight:bold">ON</span> ur.`role_id` = rm.`role_id`
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">LEFT</span> <span style="color:#fff;font-weight:bold">JOIN</span> `sys_menu` m <span style="color:#fff;font-weight:bold">ON</span> m.`id` = rm.`menu_id`
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">WHERE</span>
</span></span><span style="display:flex;"><span>	user_id = <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">AND</span> r.`status` = <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">AND</span> m.`status` = <span style="color:#ff0;font-weight:bold">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„: å¯ä»¥æŸ¥åˆ°ä¸¤æ¡æ•°æ®ï¼Œè¿™ä¸¤æ¡æ•°æ®å°±æ˜¯ç­‰ä¸‹æ•°æ®åº“è¿”å›ç»™æˆ‘ä»¬çš„æƒé™å­—ç¬¦ä¸²ã€‚</p>
<h1 id="æŸ¥è¯¢æ•°æ®åº“çš„æƒé™ä¿¡æ¯">æŸ¥è¯¢æ•°æ®åº“çš„æƒé™ä¿¡æ¯<a hidden class="anchor" aria-hidden="true" href="#æŸ¥è¯¢æ•°æ®åº“çš„æƒé™ä¿¡æ¯">#</a></h1>
<p>ç¬¬ä¸€æ­¥: åœ¨ domain ç›®å½•æ–°å»º Menu å®ä½“ç±»ï¼Œå†™å…¥å¦‚ä¸‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>package com.wjy.springsecurity.<span style="color:#fff;font-weight:bold">domain</span>;  
</span></span><span style="display:flex;"><span>import com.baomidou.mybatisplus.annotation.TableId;  
</span></span><span style="display:flex;"><span>import com.baomidou.mybatisplus.annotation.TableName;  
</span></span><span style="display:flex;"><span>import com.fasterxml.jackson.annotation.JsonInclude;  
</span></span><span style="display:flex;"><span>import lombok.AllArgsConstructor;  
</span></span><span style="display:flex;"><span>import lombok.<span style="color:#fff;font-weight:bold">Data</span>;  
</span></span><span style="display:flex;"><span>import lombok.NoArgsConstructor;  
</span></span><span style="display:flex;"><span>import java.io.<span style="color:#fff;font-weight:bold">Serializable</span>;  
</span></span><span style="display:flex;"><span>import java.util.<span style="color:#fff;font-weight:bold">Date</span>;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>//<span style="color:#f00">æƒé™è¡¨</span>(<span style="color:#f00">ä¹Ÿå«èœå•è¡¨</span>)<span style="color:#f00">çš„å®ä½“ç±»</span>  
</span></span><span style="display:flex;"><span>@TableName(value=<span style="color:#0ff;font-weight:bold">&#34;sys_menu&#34;</span>) //<span style="color:#f00">æŒ‡å®šè¡¨åï¼Œé¿å…ç­‰ä¸‹</span>mybatisplusçš„å½±å“  
</span></span><span style="display:flex;"><span>@<span style="color:#fff;font-weight:bold">Data</span>  
</span></span><span style="display:flex;"><span>@AllArgsConstructor  
</span></span><span style="display:flex;"><span>@NoArgsConstructor  
</span></span><span style="display:flex;"><span>@JsonInclude(JsonInclude.Include.NON_NULL)  
</span></span><span style="display:flex;"><span>//Serializableæ˜¯å®˜æ–¹æä¾›çš„<span style="color:#f00">ï¼Œä½œç”¨æ˜¯å°†å¯¹è±¡è½¬åŒ–ä¸ºå­—èŠ‚åºåˆ—</span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Menu implements <span style="color:#fff;font-weight:bold">Serializable</span> <span style="color:#f00">{</span>  
</span></span><span style="display:flex;"><span>    private <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> long serialVersionUID = -<span style="color:#ff0;font-weight:bold">54979041104113736</span>L;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @TableId  
</span></span><span style="display:flex;"><span>    private Long id;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * èœå•å  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    private String menuName;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è·¯ç”±åœ°å€  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    private String path;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ç»„ä»¶è·¯å¾„  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    private String component;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * èœå•çŠ¶æ€ï¼ˆ0æ˜¾ç¤º 1éšè—ï¼‰  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    private String visible;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * èœå•çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    private String status;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æƒé™æ ‡è¯†  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    private String perms;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * èœå•å›¾æ ‡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    private String icon;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    private Long createBy;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    private <span style="color:#fff;font-weight:bold">Date</span> createTime;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    private Long updateBy;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    private <span style="color:#fff;font-weight:bold">Date</span> updateTime;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æ˜¯å¦åˆ é™¤ï¼ˆ0æœªåˆ é™¤ 1å·²åˆ é™¤ï¼‰  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    private <span style="color:#fff;font-weight:bold">Integer</span> delFlag;  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * å¤‡æ³¨  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>  
</span></span><span style="display:flex;"><span>    private String remark;  
</span></span><span style="display:flex;"><span><span style="color:#f00">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥: åœ¨ mapper ç›®å½•æ–°å»º MenuMapper æ¥å£ã€‚ä½œç”¨æ˜¯å®šä¹‰mapperï¼Œå…¶ä¸­æä¾›ä¸€ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ®useridæŸ¥è¯¢æƒé™ä¿¡æ¯</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.springsecurity.mapper;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.List;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.domain.Menu;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.ibatis.annotations.Mapper;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@Mapper  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//BaseMapperæ˜¯mybatispluså®˜æ–¹æä¾›çš„æ¥å£ï¼Œé‡Œé¢æä¾›äº†å¾ˆå¤šå•è¡¨æŸ¥è¯¢çš„æ–¹æ³•  </span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> MenuMapper <span style="color:#fff;font-weight:bold">extends</span> BaseMapper&lt;Menu&gt; {  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//ç”±äºæ˜¯å¤šè¡¨è”æŸ¥ï¼Œmybatisplusçš„BaseMapperæ¥å£æ²¡æœ‰æä¾›ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºå¯¹åº”çš„mapperæ–‡ä»¶ï¼Œå®šä¹‰å¯¹åº”çš„sqlè¯­å¥  </span>
</span></span><span style="display:flex;"><span>    List&lt;String&gt; selectPermsByUserId(Long id);  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰æ­¥: åœ¨ resources ç›®å½•æ–°å»º mapperç›®å½•ï¼Œæ¥ç€åœ¨è¿™ä¸ªmapperç›®å½•æ–°å»ºFileï¼Œåå­—å« MenuMapper.xmlï¼Œå†™å…¥å¦‚ä¸‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34; &gt;</span>  
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;mapper</span> <span style="color:#007f7f">namespace=</span><span style="color:#0ff;font-weight:bold">&#34;com.wjy.springsecurity.mapper.MenuMapper&#34;</span><span style="font-weight:bold">&gt;</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;select</span> <span style="color:#007f7f">id=</span><span style="color:#0ff;font-weight:bold">&#34;selectPermsByUserId&#34;</span> <span style="color:#007f7f">resultType=</span><span style="color:#0ff;font-weight:bold">&#34;java.lang.String&#34;</span><span style="font-weight:bold">&gt;</span>  
</span></span><span style="display:flex;"><span>        SELECT  
</span></span><span style="display:flex;"><span>            DISTINCT m.`perms`  
</span></span><span style="display:flex;"><span>        FROM  
</span></span><span style="display:flex;"><span>            sys_user_role ur  
</span></span><span style="display:flex;"><span>                LEFT JOIN `sys_role` r ON ur.`role_id` = r.`id`  
</span></span><span style="display:flex;"><span>                LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id`  
</span></span><span style="display:flex;"><span>                LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id`  
</span></span><span style="display:flex;"><span>        WHERE  
</span></span><span style="display:flex;"><span>            user_id = #{userid}  
</span></span><span style="display:flex;"><span>          AND r.`status` = 0  
</span></span><span style="display:flex;"><span>          AND m.`status` = 0  
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/select&gt;</span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬å››æ­¥: æŠŠapplication.ymlä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼Œä½œç”¨æ˜¯å‘Šè¯‰mybatisplusï¼Œåˆšåˆšå†™çš„MenuMapper.xmlæ–‡ä»¶æ˜¯åœ¨å“ªä¸ªåœ°æ–¹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">mybatis-plus</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f"># é…ç½®MenuMapper.xmlæ–‡ä»¶çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f"># ä¹Ÿå¯ä»¥ä¸å†™ï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯åœ¨ç±»åŠ è½½è·¯å¾„(resouces)ä¸‹çš„mapperç›®å½•çš„ä»»æ„å±‚çº§çš„åç¼€ä¸ºxmlçš„æ–‡ä»¶ï¼Œéƒ½ä¼šè¢«æ‰«æåˆ°</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">mapper-locations</span>: classpath*:/mapper/**/*.xml
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äº”æ­¥: æµ‹è¯•ã€‚è¿™é‡Œåªæ˜¯æ£€æŸ¥mybatismlusèƒ½ä¸èƒ½æ‹¿åˆ°æ•°æ®åº“çš„æƒé™å­—ç¬¦ä¸²ã€‚åœ¨MapperTestç±»æ·»åŠ å¦‚ä¸‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Autowired
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> MenuMapper menuMapper;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testSelectPermsByUserId(){
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//Lè¡¨ç¤ºLongç±»å‹</span>
</span></span><span style="display:flex;"><span>	List&lt;String&gt; list = menuMapper.<span style="color:#007f7f">selectPermsByUserId</span>(2L);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(list);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="rbacæƒé™æ¨¡å‹çš„å®ç°">RBACæƒé™æ¨¡å‹çš„å®ç°<a hidden class="anchor" aria-hidden="true" href="#rbacæƒé™æ¨¡å‹çš„å®ç°">#</a></h1>
<p>ä¸è¦æŠŠRBACæ¨¡å‹æƒ³å¾—å¾ˆéš¾ï¼Œå…¶å®éš¾çš„è¯åªæ˜¯æ•°æ®åº“è¡¨çš„è®¾è®¡å’ŒSQLè¯­å¥çš„ç¼–å†™ï¼Œéœ€è¦5å¼ è¡¨ã€‚æ•°æ®åº“è®¾è®¡å¥½ä¹‹åå°±å¾ˆç®€å•äº†ï¼Œä½¿ç”¨mybatis-pluså»æŸ¥è¯¢æ•°æ®åº“è¡¨çš„æƒé™å­—ç¬¦ä¸²(ä¾‹å¦‚æˆ‘ä»¬çš„æƒé™å­—ç¬¦ä¸²æ˜¯æ”¾åœ¨sys_menuè¡¨)ï¼Œç„¶åæŠŠä½ æŸ¥åˆ°çš„æ•°æ®å»æ›¿æ¢æ­»æ•°æ®å°±å¥½äº†ã€‚æˆ‘ä»¬åªå‰©æœ€åä¸€æ­¥ï¼Œå°±æ˜¯æ›¿æ¢æ­»æ•°æ®ï¼Œå¦‚ä¸‹</p>
<p>ç¬¬ä¸€æ­¥: æŠŠMyUserDetailServiceImplç±»ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼Œæˆ‘ä»¬åªæ˜¯å¢åŠ äº†æŸ¥è¯¢æ¥è‡ªæ•°æ®åº“çš„æƒé™ä¿¡æ¯çš„ä»£ç </p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;String&gt; list = menuMapper.<span style="color:#007f7f">selectPermsByUserId</span>(user.<span style="color:#007f7f">getId</span>());
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥: æµ‹è¯•ã€‚ç”±äºæˆ‘ä»¬çŸ¥é“æ•°æ®åº“ä¼ è¿‡æ¥çš„æƒé™å­—ç¬¦ä¸²æ˜¯ system:dept:list å’Œ system:test:listï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠHelloControllerç±»çš„æƒé™å­—ç¬¦ä¸²ä¿®æ”¹ä¸ºå¦‚ä¸‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>system:test:list
</span></span><span style="display:flex;"><span>æˆ–
</span></span><span style="display:flex;"><span>system:dept:list
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•ã€‚</p>
<ol>
<li>é‡æ–°ç™»å½•ï¼Œè·å–tokenã€‚</li>
<li>è¯·æ±‚helloæ¥å£ï¼ŒæˆåŠŸã€‚</li>
<li>ä¿®æ”¹helloæ¥å£çš„æƒé™å€¼ä¸º<code>xxtest</code></li>
<li>å†æ¬¡è¯·æ±‚helloæ¥å£ï¼Œå¤±è´¥ï¼Œå› ä¸ºå½“å‰ç”¨æˆ·æ²¡æœ‰xxtestæƒé™ã€‚</li>
</ol>
<h1 id="-è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†"># è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#-è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†">#</a></h1>
<p>å½“è®¤è¯æˆ–æˆæƒå‡ºç°æŠ¥é”™æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å“åº”å›æ¥çš„jsonæ•°æ®æœ‰å®ä½“ç±»çš„codeã€msgã€dataè¿™ä¸‰ä¸ªå­—æ®µï¼Œæ€ä¹ˆå®ç°å‘¢ã€‚
æˆ‘ä»¬éœ€è¦å­¦ä¹ Spring Securityçš„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œå°±å¯ä»¥åœ¨è®¤è¯å¤±è´¥æˆ–è€…æ˜¯æˆæƒå¤±è´¥çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å’Œæˆ‘ä»¬çš„æ¥å£ä¸€æ ·è¿”å›ç›¸åŒç»“æ„çš„jsonï¼Œè¿™æ ·å¯ä»¥è®©å‰ç«¯èƒ½å¯¹å“åº”è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ã€‚</p>
<p>åœ¨SpringSecurityä¸­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è®¤è¯æˆ–è€…æˆæƒçš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ä¼šè¢«ExceptionTranslationFilteræ•è·åˆ°ï¼Œå¦‚ä¸Šå›¾ã€‚åœ¨ExceptionTranslationFilterä¸­ä¼šå»åˆ¤æ–­æ˜¯è®¤è¯å¤±è´¥è¿˜æ˜¯æˆæƒå¤±è´¥å‡ºç°çš„å¼‚å¸¸ï¼Œå…¶ä¸­æœ‰å¦‚ä¸‹ä¸¤ç§æƒ…å†µ</p>
<p>ä¸€ã€å¦‚æœæ˜¯è®¤è¯è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆAuthenticationExceptionç„¶åè°ƒç”¨AuthenticationEntryPointå¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</p>
<p>äºŒã€å¦‚æœæ˜¯æˆæƒè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆAccessDeniedExceptionç„¶åè°ƒç”¨AccessDeniedHandlerå¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</p>
<p>æ€»ç»“: å¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºAuthenticationEntryPointå’ŒAccessDeniedHandlerçš„å®ç°ç±»å¯¹è±¡ï¼Œç„¶åé…ç½®ç»™SpringSecurityå³å¯</p>
<p>ç¬¬ä¸€æ­¥: æ–°å»º CustomAuthorizationEntryPointç±»ï¼Œå†™å…¥å¦‚ä¸‹ï¼Œä½œç”¨æ˜¯è‡ªå®šä¹‰è®¤è¯çš„å®ç°ç±»</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.databind.ObjectMapper;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.util.R;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletRequest;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletResponse;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.extern.slf4j.Slf4j;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.http.HttpStatus;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.core.AuthenticationException;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.web.AuthenticationEntryPoint;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.PrintWriter;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@Slf4j  
</span></span><span style="display:flex;"><span>@Component  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> CustomAuthorizationEntryPoint <span style="color:#fff;font-weight:bold">implements</span> AuthenticationEntryPoint {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException e) <span style="color:#fff;font-weight:bold">throws</span> IOException {  
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;application/json;charset=utf-8&#34;</span>);  
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setStatus</span>(HttpStatus.<span style="color:#007f7f">UNAUTHORIZED</span>.<span style="color:#007f7f">value</span>());  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        PrintWriter out = response.<span style="color:#007f7f">getWriter</span>();        out.<span style="color:#007f7f">write</span>(<span style="color:#fff;font-weight:bold">new</span> ObjectMapper().<span style="color:#007f7f">writeValueAsString</span>(R.<span style="color:#007f7f">fail</span>(401, e.<span style="color:#007f7f">getMessage</span>())));  
</span></span><span style="display:flex;"><span>        out.<span style="color:#007f7f">flush</span>();        out.<span style="color:#007f7f">close</span>();    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥: æ–°å»º AccessDeniedHandlerImpl ç±»ï¼Œå†™å…¥å¦‚ä¸‹ï¼Œä½œç”¨æ˜¯è‡ªå®šä¹‰æˆæƒçš„å®ç°ç±»</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.databind.ObjectMapper;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.util.R;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.ServletException;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletRequest;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletResponse;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.extern.slf4j.Slf4j;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.http.HttpStatus;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.access.AccessDeniedException;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.web.access.AccessDeniedHandler;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.PrintWriter;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@Slf4j  
</span></span><span style="display:flex;"><span>@Component  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> CustomAccessDeniedHandler <span style="color:#fff;font-weight:bold">implements</span> AccessDeniedHandler {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    @Override  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException e) <span style="color:#fff;font-weight:bold">throws</span> IOException, ServletException {  
</span></span><span style="display:flex;"><span>        log.<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;è®¿é—®æ²¡æœ‰æƒé™çš„æ¥å£æ—¶ï¼Œè‡ªå®šä¹‰è¿”å›ç»“æœ&#34;</span>, e);  
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setContentType</span>(<span style="color:#0ff;font-weight:bold">&#34;application/json;charset=utf-8&#34;</span>);  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ç½®httpçŠ¶æ€ç ä¸º403  </span>
</span></span><span style="display:flex;"><span>        response.<span style="color:#007f7f">setStatus</span>(HttpStatus.<span style="color:#007f7f">FORBIDDEN</span>.<span style="color:#007f7f">value</span>());  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        PrintWriter out = response.<span style="color:#007f7f">getWriter</span>();        out.<span style="color:#007f7f">write</span>(<span style="color:#fff;font-weight:bold">new</span> ObjectMapper().<span style="color:#007f7f">writeValueAsString</span>(R.<span style="color:#007f7f">fail</span>(403, e.<span style="color:#007f7f">getMessage</span>())));  
</span></span><span style="display:flex;"><span>        out.<span style="color:#007f7f">flush</span>();        out.<span style="color:#007f7f">close</span>();    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰æ­¥: åœ¨ SecurityConfig ç±»ä¸­é…ç½®è¿™ä¸¤ä¸ªå¼‚å¸¸å¤„ç†ç±»</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> SecurityFilterChain securityFilterChain(  
</span></span><span style="display:flex;"><span>        HttpSecurity httpSecurity,        JwtAuthenticationFilter jwtAuthenticationFilter,        AuthenticationProvider authenticationProvider,        CustomAuthorizationEntryPoint customAuthorizationEntryPoint,        CustomAccessDeniedHandler customAccessDeniedHandler) <span style="color:#fff;font-weight:bold">throws</span> Exception {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> httpSecurity  
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">authorizeHttpRequests</span>(o -&gt; {  
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å¯¹äºé™æ€èµ„æºéœ€è¦é€šè¿‡ requestMatchers é…ç½®è®¿é—®æƒé™ï¼Œå¯¹äºæ–¹æ³•å¯é€šè¿‡æ³¨è§£æˆ–é…ç½®ç±»æ¥æ§åˆ¶æƒé™  </span>
</span></span><span style="display:flex;"><span>                o.<span style="color:#007f7f">requestMatchers</span>(<span style="color:#0ff;font-weight:bold">&#34;/login&#34;</span>).<span style="color:#007f7f">permitAll</span>();  
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å…è®¸æ‰€æœ‰è®¿é—®  </span>
</span></span><span style="display:flex;"><span>                o.<span style="color:#007f7f">anyRequest</span>().<span style="color:#007f7f">permitAll</span>();  
</span></span><span style="display:flex;"><span>            })            <span style="color:#007f7f">// åœ¨ UsernamePasswordAuthenticationFilter è¿‡æ»¤å™¨ä¹‹å‰æ‰§è¡ŒJWTè®¤è¯è¿‡æ»¤å™¨  </span>
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">addFilterBefore</span>(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.<span style="color:#007f7f">class</span>)  
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">authenticationProvider</span>(authenticationProvider)            .<span style="color:#007f7f">exceptionHandling</span>(o -&gt; {  
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å¤„ç†æœªè®¤è¯å¼‚å¸¸  </span>
</span></span><span style="display:flex;"><span>                o.<span style="color:#007f7f">authenticationEntryPoint</span>(customAuthorizationEntryPoint);  
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å¤„ç†æœªæˆæƒå¼‚å¸¸  </span>
</span></span><span style="display:flex;"><span>                o.<span style="color:#007f7f">accessDeniedHandler</span>(customAccessDeniedHandler);  
</span></span><span style="display:flex;"><span>            })            <span style="color:#007f7f">// å…³é—­csrfè¿‡æ»¤å™¨ï¼Œå› jwtä¸å­˜å‚¨åœ¨cookieï¼ˆjwtè¦å­˜å‚¨åœ¨localStorageä¸­ï¼Œå¦åˆ™ä»æœ‰csrfé£é™©ï¼‰  </span>
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">csrf</span>(AbstractHttpConfigurer::disable)  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// åŸºäºtokenï¼Œä¸éœ€è¦session  </span>
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">sessionManagement</span>(o -&gt; o.<span style="color:#007f7f">sessionCreationPolicy</span>(SessionCreationPolicy.<span style="color:#007f7f">STATELESS</span>))  
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">build</span>();}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬å››æ­¥ï¼šè‡ªè¡ŒéªŒè¯æœªæˆæƒå¼‚å¸¸å’Œæ— æƒé™å¼‚å¸¸ã€‚</p>
<h1 id="è·¨åŸŸ">è·¨åŸŸ<a hidden class="anchor" aria-hidden="true" href="#è·¨åŸŸ">#</a></h1>
<p>ç¬¬ä¸€æ­¥: å¼€å¯SpringBootçš„å…è®¸è·¨åŸŸè®¿é—®ã€‚åœ¨ config ç›®å½•æ–°å»º CorsConfig ç±»ï¼Œå†™å…¥å¦‚ä¸‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.huanf.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> CorsConfig <span style="color:#fff;font-weight:bold">implements</span> WebMvcConfigurer {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//é‡å†™springæä¾›çš„WebMvcConfigureræ¥å£çš„addCorsMappingsæ–¹æ³•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addCorsMappings(CorsRegistry registry) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>        registry.<span style="color:#007f7f">addMapping</span>(<span style="color:#0ff;font-weight:bold">&#34;/**&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// è®¾ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸå</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">allowedOriginPatterns</span>(<span style="color:#0ff;font-weight:bold">&#34;*&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// æ˜¯å¦å…è®¸cookie</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">allowCredentials</span>(<span style="color:#fff;font-weight:bold">true</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// è®¾ç½®å…è®¸çš„è¯·æ±‚æ–¹å¼</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">allowedMethods</span>(<span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;POST&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;DELETE&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;PUT&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// è®¾ç½®å…è®¸çš„headerå±æ€§</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">allowedHeaders</span>(<span style="color:#0ff;font-weight:bold">&#34;*&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// è·¨åŸŸå…è®¸æ—¶é—´</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">maxAge</span>(3600);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥: å¼€å¯SpringSecurityçš„å…è®¸è·¨åŸŸè®¿é—®ã€‚åœ¨æŠŠ SecurityConfig ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>.<span style="color:#007f7f">cors</span>(cors -&gt; cors.<span style="color:#007f7f">configurationSource</span>(corsConfigurationSource()))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Bean  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CorsConfigurationSource corsConfigurationSource() {  
</span></span><span style="display:flex;"><span>    CorsConfiguration corsConfig = <span style="color:#fff;font-weight:bold">new</span> CorsConfiguration();  
</span></span><span style="display:flex;"><span>    corsConfig.<span style="color:#007f7f">addAllowedOriginPattern</span>(<span style="color:#0ff;font-weight:bold">&#34;*&#34;</span>); <span style="color:#007f7f">// å…è®¸ä»»ä½•æº  </span>
</span></span><span style="display:flex;"><span>    corsConfig.<span style="color:#007f7f">addAllowedMethod</span>(<span style="color:#0ff;font-weight:bold">&#34;*&#34;</span>); <span style="color:#007f7f">// å…è®¸ä»»ä½•HTTPæ–¹æ³•  </span>
</span></span><span style="display:flex;"><span>    corsConfig.<span style="color:#007f7f">addAllowedHeader</span>(<span style="color:#0ff;font-weight:bold">&#34;*&#34;</span>); <span style="color:#007f7f">// å…è®¸ä»»ä½•HTTPå¤´  </span>
</span></span><span style="display:flex;"><span>    corsConfig.<span style="color:#007f7f">setAllowCredentials</span>(<span style="color:#fff;font-weight:bold">true</span>); <span style="color:#007f7f">// å…è®¸è¯ä¹¦ï¼ˆcookiesï¼‰  </span>
</span></span><span style="display:flex;"><span>    corsConfig.<span style="color:#007f7f">setMaxAge</span>(3600L); <span style="color:#007f7f">// é¢„æ£€è¯·æ±‚çš„ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰  </span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    UrlBasedCorsConfigurationSource source = <span style="color:#fff;font-weight:bold">new</span> UrlBasedCorsConfigurationSource();  
</span></span><span style="display:flex;"><span>    source.<span style="color:#007f7f">registerCorsConfiguration</span>(<span style="color:#0ff;font-weight:bold">&#34;/**&#34;</span>, corsConfig); <span style="color:#007f7f">// å¯¹æ‰€æœ‰è·¯å¾„åº”ç”¨è¿™ä¸ªé…ç½®  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> source;  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰æ­¥ï¼šè‡ªè¡Œæµ‹è¯•</p>
<h1 id="æƒé™æ ¡éªŒæ–¹æ³•">æƒé™æ ¡éªŒæ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#æƒé™æ ¡éªŒæ–¹æ³•">#</a></h1>
<p>hasAuthorityã€hasAnyAuthorityã€hasRoleã€hasAnyRoleã€‚</p>
<h2 id="hasauthorityhasanyauthority">hasAuthorityã€hasAnyAuthority<a hidden class="anchor" aria-hidden="true" href="#hasauthorityhasanyauthority">#</a></h2>
<p>åŸç†ï¼šæ‹¿ç”¨æˆ·çš„æƒé™æ¥å£éœ€è¦çš„æƒé™åšå¯¹æ¯”ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// ç¬¬ä¸€æ­¥</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">boolean</span> hasAuthority(String authority) {  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">hasAnyAuthority</span>(authority);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç¬¬äºŒæ­¥</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">boolean</span> hasAnyAuthority(String... authorities) {  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">hasAnyAuthorityName</span>((String)<span style="color:#fff;font-weight:bold">null</span>, authorities);  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç¬¬ä¸‰æ­¥</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">boolean</span> hasAnyAuthorityName(String prefix, String... roles) {
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// è·å–æƒé™</span>
</span></span><span style="display:flex;"><span>    Set&lt;String&gt; roleSet = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getAuthoritySet</span>();  
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// è·å–åˆ°æƒé™åï¼Œå’Œå‚æ•°çš„æƒé™è¿›è¡Œå¯¹æ¯”</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span>(String role : roles) {  
</span></span><span style="display:flex;"><span>        String defaultedRole = getRoleWithDefaultPrefix(prefix, role);  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (roleSet.<span style="color:#007f7f">contains</span>(defaultedRole)) {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>        }    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è·å–ç”¨æˆ·æƒé™</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> Set&lt;String&gt; getAuthoritySet() {  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">roles</span> == <span style="color:#fff;font-weight:bold">null</span>) {  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ ¸å¿ƒä»£ç ï¼Œå…¶å®å°±æ˜¯è·å–LoginUserçš„getAuthoritiesæ–¹æ³•ã€‚</span>
</span></span><span style="display:flex;"><span>        Collection&lt;? <span style="color:#fff;font-weight:bold">extends</span> GrantedAuthority&gt; userAuthorities = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getAuthentication</span>().<span style="color:#007f7f">getAuthorities</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">roleHierarchy</span> != <span style="color:#fff;font-weight:bold">null</span>) {  
</span></span><span style="display:flex;"><span>            userAuthorities = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">roleHierarchy</span>.<span style="color:#007f7f">getReachableGrantedAuthorities</span>(userAuthorities);  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">roles</span> = AuthorityUtils.<span style="color:#007f7f">authorityListToSet</span>(userAuthorities);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">roles</span>;  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hasrolehasanyrole">hasRoleã€hasAnyRole<a hidden class="anchor" aria-hidden="true" href="#hasrolehasanyrole">#</a></h2>
<p>åŸç†ï¼šæ‹¿ç”¨æˆ·çš„æƒé™æ¥å£éœ€è¦çš„æƒé™åšå¯¹æ¯”ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// é»˜è®¤å‰ç¼€å</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">defaultRolePrefix</span> = <span style="color:#0ff;font-weight:bold">&#34;ROLE_&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç¬¬ä¸€æ­¥</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">boolean</span> hasRole(String role) {  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">hasAnyRole</span>(role);  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç¬¬äºŒæ­¥</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">boolean</span> hasAnyRole(String... roles) {
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// æ³¨æ„è¿™é‡Œï¼Œä¼ å…¥äº†å‰ç¼€å</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">hasAnyAuthorityName</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">defaultRolePrefix</span>, roles);  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç¬¬ä¸‰æ­¥</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">boolean</span> hasAnyAuthorityName(String prefix, String... roles) {  
</span></span><span style="display:flex;"><span>    Set&lt;String&gt; roleSet = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getAuthoritySet</span>();  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span>(String role : roles) {
</span></span><span style="display:flex;"><span>	    <span style="color:#007f7f">// è¿™é‡Œæ‹¼æ¥äº†å‰ç¼€åROLE_ï¼Œå°±æ˜¯è¯´ä½ çš„è§’è‰²åå¿…é¡»å¸¦ROLE_å‰ç¼€ï¼Œè¿™é‡Œæ‰èƒ½é€šè¿‡æ ¡éªŒ</span>
</span></span><span style="display:flex;"><span>        String defaultedRole = getRoleWithDefaultPrefix(prefix, role);  
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (roleSet.<span style="color:#007f7f">contains</span>(defaultedRole)) {  
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;  
</span></span><span style="display:flex;"><span>        }    }  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="è‡ªå®šä¹‰æƒé™æ ¡éªŒçš„æ–¹æ³•">è‡ªå®šä¹‰æƒé™æ ¡éªŒçš„æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#è‡ªå®šä¹‰æƒé™æ ¡éªŒçš„æ–¹æ³•">#</a></h1>
<p>ç¬¬ä¸€æ­¥: æ–°å»º MyExpressionRoot ç±»ï¼Œå†™å…¥å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.springsecurity.domain.LoginUser;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.core.Authentication;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.security.core.context.SecurityContextHolder;  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.List;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>@Component(<span style="color:#0ff;font-weight:bold">&#34;myEX&#34;</span>)  
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//è‡ªå®šä¹‰æƒé™æ ¡éªŒçš„æ–¹æ³•  </span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MyExpressionRoot {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//è‡ªå®šä¹‰æƒé™æ ¡éªŒçš„æ–¹æ³•  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> myHasAuthority(String authority){  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//è·å–ç”¨æˆ·å…·æœ‰çš„æƒé™å­—ç¬¦ä¸²ï¼Œæœ‰å¯èƒ½ç”¨æˆ·å…·æœ‰å¤šä¸ªæƒé™å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è·å–åæ˜¯ä¸€ä¸ªé›†åˆ  </span>
</span></span><span style="display:flex;"><span>        Authentication authentication = SecurityContextHolder.<span style="color:#007f7f">getContext</span>().<span style="color:#007f7f">getAuthentication</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//LoginUseræ˜¯æˆ‘ä»¬åœ¨domainç›®å½•å†™å¥½çš„å®ä½“ç±»  </span>
</span></span><span style="display:flex;"><span>        LoginUser loginUser = (LoginUser) authentication.<span style="color:#007f7f">getPrincipal</span>();  
</span></span><span style="display:flex;"><span>        List&lt;String&gt; xxpermissions = loginUser.<span style="color:#007f7f">getXxpermissions</span>();  
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ¤æ–­ç”¨æˆ·æƒé™é›†åˆä¸­ï¼Œæ˜¯å¦å­˜åœ¨è·Ÿä¸šåŠ¡æ¥å£(ä¸šåŠ¡æ¥å£çš„æƒé™å­—ç¬¦ä¸²ä¼šä½œä¸ºauthorityå½¢å‚ä¼ è¿›æ¥)ä¸€æ ·çš„æƒé™  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> xxpermissions.<span style="color:#007f7f">contains</span>(authority);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒæ­¥ï¼šåœ¨SPELè¡¨è¾¾å¼æ¥è·å–å®¹å™¨ä¸­beançš„åå­—ã€‚ä¿®æ”¹HelloControllerç±»ä¸ºå¦‚ä¸‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@PreAuthorize(<span style="color:#0ff;font-weight:bold">&#34;@myEX.myHasAuthority(&#39;system:test:list&#39;)&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰æ­¥ï¼šè‡ªè¡Œæµ‹è¯•ã€‚</p>
<h1 id="åŸºäºé…ç½®çš„æƒé™æ§åˆ¶">åŸºäºé…ç½®çš„æƒé™æ§åˆ¶<a hidden class="anchor" aria-hidden="true" href="#åŸºäºé…ç½®çš„æƒé™æ§åˆ¶">#</a></h1>
<p>å‰é¢ä½¿ç”¨çš„æƒé™æ§åˆ¶æ˜¯åŸºäºæ³¨è§£æ¥å®Œæˆçš„ï¼Œä¾‹å¦‚@PreAuthorizeã€‚è¿˜å¯ä»¥åœ¨<code>SecurityConfig</code>é…ç½®ç±»ä¸­é…ç½®æƒé™æ§åˆ¶ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>.<span style="color:#007f7f">authorizeHttpRequests</span>(o -&gt; {  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ç™»å½•ã€å‘é€éªŒè¯ç ç­‰æ–¹æ³•ä¸éœ€è¦è®¤è¯  </span>
</span></span><span style="display:flex;"><span>    o.<span style="color:#007f7f">requestMatchers</span>(<span style="color:#0ff;font-weight:bold">&#34;/login&#34;</span>).<span style="color:#007f7f">permitAll</span>();  
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å…¶ä»–æ¥å£å…¨éƒ¨éœ€è¦è®¤è¯  </span>
</span></span><span style="display:flex;"><span>    o.<span style="color:#007f7f">anyRequest</span>().<span style="color:#007f7f">authenticated</span>();  
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡ªè¡Œæµ‹è¯•ã€‚</p>
<h1 id="csrfé˜²æŠ¤">CSRFé˜²æŠ¤<a hidden class="anchor" aria-hidden="true" href="#csrfé˜²æŠ¤">#</a></h1>
<p>é˜²æŠ¤: SpringSecurityå»é˜²æ­¢CSRFæ”»å‡»çš„æ–¹å¼å°±æ˜¯é€šè¿‡csrf_tokenã€‚åç«¯ä¼šç”Ÿæˆä¸€ä¸ªcsrf_tokenï¼Œå‰ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™éœ€è¦æºå¸¦è¿™ä¸ªcsrf_token,åç«¯ä¼šæœ‰è¿‡æ»¤å™¨è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ²¡æœ‰æºå¸¦æˆ–è€…æ˜¯ä¼ªé€ çš„å°±ä¸å…è®¸è®¿é—®
æˆ‘ä»¬å¯ä»¥å‘ç°CSRFæ”»å‡»ä¾é çš„æ˜¯cookieä¸­æ‰€æºå¸¦çš„è®¤è¯ä¿¡æ¯ã€‚ä½†æ˜¯åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­æˆ‘ä»¬çš„è®¤è¯ä¿¡æ¯å…¶å®æ˜¯tokenï¼Œè€Œtokenå¹¶ä¸æ˜¯å­˜å‚¨ä¸­cookieä¸­ï¼Œå¹¶ä¸”éœ€è¦å‰ç«¯ä»£ç å»æŠŠtokenè®¾ç½®åˆ°è¯·æ±‚å¤´ä¸­æ‰å¯ä»¥ï¼Œæ‰€ä»¥CSRFæ”»å‡»ä¹Ÿå°±ä¸ç”¨æ‹…å¿ƒäº†ï¼Œå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼Œåœ¨é…ç½®ç±»å…³é—­csrfå°±èƒ½é˜²èŒƒcsrfæ”»å‡»</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// å…³é—­csrfè¿‡æ»¤å™¨ï¼Œå› jwtä¸å­˜å‚¨åœ¨cookieï¼ˆjwtè¦å­˜å‚¨åœ¨localStorageä¸­ï¼Œå¦åˆ™ä»æœ‰csrfé£é™©ï¼‰  </span>
</span></span><span style="display:flex;"><span>.<span style="color:#007f7f">csrf</span>(AbstractHttpConfigurer::disable)
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/spring/">Spring</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
