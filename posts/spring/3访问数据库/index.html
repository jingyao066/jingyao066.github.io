<!DOCTYPE html>
<html lang="en" dir="auto">

<head>
    
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;Â»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      3ã€è®¿é—®æ•°æ®åº“
    </h1>
    <div class="post-meta"><span title='2020-01-03 09:25:58 +0000 UTC'>2020-01-03</span>&nbsp;Â·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%a6%82%e8%bf%b0" aria-label="æ¦‚è¿°">æ¦‚è¿°</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8jdbc" aria-label="ä½¿ç”¨JDBC">ä½¿ç”¨JDBC</a><ul>
                        
                <li>
                    <a href="#jdbctemplate%e7%94%a8%e6%b3%95" aria-label="JdbcTemplateç”¨æ³•">JdbcTemplateç”¨æ³•</a></li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93" aria-label="å°ç»“">å°ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e5%a3%b0%e6%98%8e%e5%bc%8f%e4%ba%8b%e5%8a%a1" aria-label="ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡">ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡</a><ul>
                        
                <li>
                    <a href="#%e5%9b%9e%e6%bb%9a%e4%ba%8b%e5%8a%a1" aria-label="å›æ»šäº‹åŠ¡">å›æ»šäº‹åŠ¡</a></li>
                <li>
                    <a href="#%e4%ba%8b%e5%8a%a1%e8%be%b9%e7%95%8c" aria-label="äº‹åŠ¡è¾¹ç•Œ">äº‹åŠ¡è¾¹ç•Œ</a></li>
                <li>
                    <a href="#%e4%ba%8b%e5%8a%a1%e4%bc%a0%e6%92%ad" aria-label="äº‹åŠ¡ä¼ æ’­">äº‹åŠ¡ä¼ æ’­</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8dao" aria-label="ä½¿ç”¨DAO">ä½¿ç”¨DAO</a></li>
                <li>
                    <a href="#%e9%9b%86%e6%88%90hibernate" aria-label="é›†æˆHibernate">é›†æˆHibernate</a><ul>
                        <ul>
                        
                <li>
                    <a href="#insert%e6%93%8d%e4%bd%9c" aria-label="Insertæ“ä½œ">Insertæ“ä½œ</a></li>
                <li>
                    <a href="#delete%e6%93%8d%e4%bd%9c" aria-label="Deleteæ“ä½œ">Deleteæ“ä½œ</a></li>
                <li>
                    <a href="#update%e6%93%8d%e4%bd%9c" aria-label="Updateæ“ä½œ">Updateæ“ä½œ</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8hql%e6%9f%a5%e8%af%a2" aria-label="ä½¿ç”¨HQLæŸ¥è¯¢">ä½¿ç”¨HQLæŸ¥è¯¢</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e9%9b%86%e6%88%90jpa" aria-label="é›†æˆJPA">é›†æˆJPA</a></li>
                <li>
                    <a href="#%e9%9b%86%e6%88%90mybatis" aria-label="é›†æˆMyBatis">é›†æˆMyBatis</a><ul>
                        <ul>
                        
                <li>
                    <a href="#xml%e9%85%8d%e7%bd%ae" aria-label="XMLé…ç½®">XMLé…ç½®</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e8%ae%be%e8%ae%a1orm" aria-label="è®¾è®¡ORM">è®¾è®¡ORM</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e8%ae%be%e8%ae%a1orm%e6%8e%a5%e5%8f%a3" aria-label="è®¾è®¡ORMæ¥å£">è®¾è®¡ORMæ¥å£</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0orm" aria-label="å®ç°ORM">å®ç°ORM</a>
                </li>
            </ul>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="æ¦‚è¿°">æ¦‚è¿°<a hidden class="anchor" aria-hidden="true" href="#æ¦‚è¿°">#</a></h1>
<p>æ•°æ®åº“åŸºæœ¬ä¸Šæ˜¯ç°ä»£åº”ç”¨ç¨‹åºçš„æ ‡å‡†å­˜å‚¨ï¼Œç»å¤§å¤šæ•°ç¨‹åºéƒ½æŠŠè‡ªå·±çš„ä¸šåŠ¡æ•°æ®å­˜å‚¨åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œå¯è§ï¼Œè®¿é—®æ•°æ®åº“å‡ ä¹æ˜¯æ‰€æœ‰åº”ç”¨ç¨‹åºå¿…å¤‡èƒ½åŠ›ã€‚</p>
<p>æˆ‘ä»¬åœ¨å‰é¢å·²ç»ä»‹ç»äº†Javaç¨‹åºè®¿é—®æ•°æ®åº“çš„æ ‡å‡†æ¥å£JDBCï¼Œå®ƒçš„å®ç°æ–¹å¼éå¸¸ç®€æ´ï¼Œå³ï¼šJavaæ ‡å‡†åº“å®šä¹‰æ¥å£ï¼Œå„æ•°æ®åº“å‚å•†ä»¥â€œé©±åŠ¨â€çš„å½¢å¼å®ç°æ¥å£ã€‚åº”ç”¨ç¨‹åºè¦ä½¿ç”¨å“ªä¸ªæ•°æ®åº“ï¼Œå°±æŠŠè¯¥æ•°æ®åº“å‚å•†çš„é©±åŠ¨ä»¥jaråŒ…å½¢å¼å¼•å…¥è¿›æ¥ï¼ŒåŒæ—¶è‡ªèº«ä»…ä½¿ç”¨JDBCæ¥å£ï¼Œç¼–è¯‘æœŸå¹¶ä¸éœ€è¦ç‰¹å®šå‚å•†çš„é©±åŠ¨ã€‚</p>
<p>ä½¿ç”¨JDBCè™½ç„¶ç®€å•ï¼Œä½†ä»£ç æ¯”è¾ƒç¹çã€‚Springä¸ºäº†ç®€åŒ–æ•°æ®åº“è®¿é—®ï¼Œä¸»è¦åšäº†ä»¥ä¸‹å‡ ç‚¹å·¥ä½œï¼š</p>
<ul>
<li>æä¾›äº†ç®€åŒ–çš„è®¿é—®JDBCçš„æ¨¡æ¿ç±»ï¼Œä¸å¿…æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼›</li>
<li>æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„DAOç±»ä»¥å®ç°Data Access Objectæ¨¡å¼ï¼›</li>
<li>æŠŠ<code>SQLException</code>å°è£…ä¸º<code>DataAccessException</code>ï¼Œè¿™ä¸ªå¼‚å¸¸æ˜¯ä¸€ä¸ª<code>RuntimeException</code>ï¼Œå¹¶ä¸”è®©æˆ‘ä»¬èƒ½åŒºåˆ†SQLå¼‚å¸¸çš„åŸå› ï¼Œä¾‹å¦‚ï¼Œ<code>DuplicateKeyException</code>è¡¨ç¤ºè¿åäº†ä¸€ä¸ªå”¯ä¸€çº¦æŸï¼›</li>
<li>èƒ½æ–¹ä¾¿åœ°é›†æˆHibernateã€JPAå’ŒMyBatisè¿™äº›æ•°æ®åº“è®¿é—®æ¡†æ¶ã€‚</li>
</ul>
<p>æœ¬ç« æˆ‘ä»¬å°†è¯¦ç»†è®²è§£åœ¨Springä¸­è®¿é—®æ•°æ®åº“çš„æœ€ä½³å®è·µã€‚</p>
<h1 id="ä½¿ç”¨jdbc">ä½¿ç”¨JDBC<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨jdbc">#</a></h1>
<p>æˆ‘ä»¬åœ¨å‰é¢ä»‹ç»<a href="https://liaoxuefeng.com/books/java/jdbc/index.html">JDBCç¼–ç¨‹</a>æ—¶å·²ç»è®²è¿‡ï¼ŒJavaç¨‹åºä½¿ç”¨JDBCæ¥å£è®¿é—®å…³ç³»æ•°æ®åº“çš„æ—¶å€™ï¼Œéœ€è¦ä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>åˆ›å»ºå…¨å±€<code>DataSource</code>å®ä¾‹ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥æ± ï¼›</li>
<li>åœ¨éœ€è¦è¯»å†™æ•°æ®åº“çš„æ–¹æ³•å†…éƒ¨ï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤è®¿é—®æ•°æ®åº“ï¼š
<ul>
<li>ä»å…¨å±€<code>DataSource</code>å®ä¾‹è·å–<code>Connection</code>å®ä¾‹ï¼›</li>
<li>é€šè¿‡<code>Connection</code>å®ä¾‹åˆ›å»º<code>PreparedStatement</code>å®ä¾‹ï¼›</li>
<li>æ‰§è¡ŒSQLè¯­å¥ï¼Œå¦‚æœæ˜¯æŸ¥è¯¢ï¼Œåˆ™é€šè¿‡<code>ResultSet</code>è¯»å–ç»“æœé›†ï¼Œå¦‚æœæ˜¯ä¿®æ”¹ï¼Œåˆ™è·å¾—<code>int</code>ç»“æœã€‚</li>
</ul>
</li>
</ul>
<p>æ­£ç¡®ç¼–å†™JDBCä»£ç çš„å…³é”®æ˜¯ä½¿ç”¨<code>try ... finally</code>é‡Šæ”¾èµ„æºï¼Œæ¶‰åŠåˆ°äº‹åŠ¡çš„ä»£ç éœ€è¦æ­£ç¡®æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚</p>
<p>åœ¨Springä½¿ç”¨JDBCï¼Œé¦–å…ˆæˆ‘ä»¬é€šè¿‡IoCå®¹å™¨åˆ›å»ºå¹¶ç®¡ç†ä¸€ä¸ª<code>DataSource</code>å®ä¾‹ï¼Œç„¶åï¼ŒSpringæä¾›äº†ä¸€ä¸ª<code>JdbcTemplate</code>ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è®©æˆ‘ä»¬æ“ä½œJDBCï¼Œå› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå®ä¾‹åŒ–ä¸€ä¸ª<code>JdbcTemplate</code>ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªç±»ä¸»è¦ä½¿ç”¨äº†<a href="https://liaoxuefeng.com/books/java/design-patterns/behavioral/template-method/index.html">Templateæ¨¡å¼</a>ã€‚</p>
<p>ç¼–å†™ç¤ºä¾‹ä»£ç æˆ–è€…æµ‹è¯•ä»£ç æ—¶ï¼Œæˆ‘ä»¬å¼ºçƒˆæ¨èä½¿ç”¨<a href="https://hsqldb.org/">HSQLDB</a>è¿™ä¸ªæ•°æ®åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨Javaç¼–å†™çš„å…³ç³»æ•°æ®åº“ï¼Œå¯ä»¥ä»¥å†…å­˜æ¨¡å¼æˆ–è€…æ–‡ä»¶æ¨¡å¼è¿è¡Œï¼Œæœ¬èº«åªæœ‰ä¸€ä¸ªjaråŒ…ï¼Œéå¸¸é€‚åˆæ¼”ç¤ºä»£ç æˆ–è€…æµ‹è¯•ä»£ç ã€‚</p>
<p>æˆ‘ä»¬ä»¥å®é™…å·¥ç¨‹ä¸ºä¾‹ï¼Œå…ˆåˆ›å»ºMavenå·¥ç¨‹<code>spring-data-jdbc</code>ï¼Œç„¶åå¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼š</p>
<ul>
<li>org.springframework:spring-context:6.0.0</li>
<li>org.springframework:spring-jdbc:6.0.0</li>
<li>jakarta.annotation:jakarta.annotation-api:2.1.1</li>
<li>com.zaxxer:HikariCP:5.0.1</li>
<li>org.hsqldb:hsqldb:2.7.1</li>
</ul>
<p>åœ¨<code>AppConfig</code>ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä»¥ä¸‹å‡ ä¸ªå¿…é¡»çš„Beanï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@PropertySource(<span style="color:#0ff;font-weight:bold">&#34;jdbc.properties&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${jdbc.url}&#34;</span>)
</span></span><span style="display:flex;"><span>    String jdbcUrl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${jdbc.username}&#34;</span>)
</span></span><span style="display:flex;"><span>    String jdbcUsername;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${jdbc.password}&#34;</span>)
</span></span><span style="display:flex;"><span>    String jdbcPassword;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    DataSource createDataSource() {
</span></span><span style="display:flex;"><span>        HikariConfig config = <span style="color:#fff;font-weight:bold">new</span> HikariConfig();
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">setJdbcUrl</span>(jdbcUrl);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">setUsername</span>(jdbcUsername);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">setPassword</span>(jdbcPassword);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">addDataSourceProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;autoCommit&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">addDataSourceProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;connectionTimeout&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;5&#34;</span>);
</span></span><span style="display:flex;"><span>        config.<span style="color:#007f7f">addDataSourceProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;idleTimeout&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;60&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> HikariDataSource(config);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    JdbcTemplate createJdbcTemplate(@Autowired DataSource dataSource) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> JdbcTemplate(dataSource);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼š</p>
<ol>
<li>é€šè¿‡<code>@PropertySource(&quot;jdbc.properties&quot;)</code>è¯»å–æ•°æ®åº“é…ç½®æ–‡ä»¶ï¼›</li>
<li>é€šè¿‡<code>@Value(&quot;${jdbc.url}&quot;)</code>æ³¨å…¥é…ç½®æ–‡ä»¶çš„ç›¸å…³é…ç½®ï¼›</li>
<li>åˆ›å»ºä¸€ä¸ªDataSourceå®ä¾‹ï¼Œå®ƒçš„å®é™…ç±»å‹æ˜¯<code>HikariDataSource</code>ï¼Œåˆ›å»ºæ—¶éœ€è¦ç”¨åˆ°æ³¨å…¥çš„é…ç½®ï¼›</li>
<li>åˆ›å»ºä¸€ä¸ªJdbcTemplateå®ä¾‹ï¼Œå®ƒéœ€è¦æ³¨å…¥<code>DataSource</code>ï¼Œè¿™æ˜¯é€šè¿‡æ–¹æ³•å‚æ•°å®Œæˆæ³¨å…¥çš„ã€‚</li>
</ol>
<p>æœ€åï¼Œé’ˆå¯¹HSQLDBå†™ä¸€ä¸ªé…ç½®æ–‡ä»¶<code>jdbc.properties</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f"># æ•°æ®åº“æ–‡ä»¶åä¸ºtestdb:</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">jdbc.url</span>=<span style="color:#0ff;font-weight:bold">jdbc:hsqldb:file:testdb</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Hsqldbé»˜è®¤çš„ç”¨æˆ·åæ˜¯saï¼Œå£ä»¤æ˜¯ç©ºå­—ç¬¦ä¸²:</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">jdbc.username</span>=<span style="color:#0ff;font-weight:bold">sa</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">jdbc.password</span>=
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥é€šè¿‡HSQLDBè‡ªå¸¦çš„å·¥å…·æ¥åˆå§‹åŒ–æ•°æ®åº“è¡¨ï¼Œè¿™é‡Œæˆ‘ä»¬å†™ä¸€ä¸ªBeanï¼Œåœ¨Springå®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>users</code>è¡¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DatabaseInitializer {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    JdbcTemplate jdbcTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PostConstruct
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> init() {
</span></span><span style="display:flex;"><span>        jdbcTemplate.<span style="color:#007f7f">update</span>(<span style="color:#0ff;font-weight:bold">&#34;CREATE TABLE IF NOT EXISTS users (&#34;</span> <span style="color:#007f7f">//</span>
</span></span><span style="display:flex;"><span>                + <span style="color:#0ff;font-weight:bold">&#34;id BIGINT IDENTITY NOT NULL PRIMARY KEY, &#34;</span> <span style="color:#007f7f">//</span>
</span></span><span style="display:flex;"><span>                + <span style="color:#0ff;font-weight:bold">&#34;email VARCHAR(100) NOT NULL, &#34;</span> <span style="color:#007f7f">//</span>
</span></span><span style="display:flex;"><span>                + <span style="color:#0ff;font-weight:bold">&#34;password VARCHAR(100) NOT NULL, &#34;</span> <span style="color:#007f7f">//</span>
</span></span><span style="display:flex;"><span>                + <span style="color:#0ff;font-weight:bold">&#34;name VARCHAR(100) NOT NULL, &#34;</span> <span style="color:#007f7f">//</span>
</span></span><span style="display:flex;"><span>                + <span style="color:#0ff;font-weight:bold">&#34;UNIQUE (email))&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œæ‰€æœ‰å‡†å¤‡å·¥ä½œéƒ½å·²å®Œæ¯•ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨éœ€è¦è®¿é—®æ•°æ®åº“çš„Beanä¸­ï¼Œæ³¨å…¥<code>JdbcTemplate</code>å³å¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    JdbcTemplate jdbcTemplate;
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="jdbctemplateç”¨æ³•">JdbcTemplateç”¨æ³•<a hidden class="anchor" aria-hidden="true" href="#jdbctemplateç”¨æ³•">#</a></h2>
<p>Springæä¾›çš„<code>JdbcTemplate</code>é‡‡ç”¨Templateæ¨¡å¼ï¼Œæä¾›äº†ä¸€ç³»åˆ—ä»¥å›è°ƒä¸ºç‰¹ç‚¹çš„å·¥å…·æ–¹æ³•ï¼Œç›®çš„æ˜¯é¿å…ç¹ççš„<code>try...catch</code>è¯­å¥ã€‚</p>
<p>æˆ‘ä»¬ä»¥å…·ä½“çš„ç¤ºä¾‹æ¥è¯´æ˜JdbcTemplateçš„ç”¨æ³•ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹<code>T execute(ConnectionCallback&lt;T&gt; action)</code>æ–¹æ³•ï¼Œå®ƒæä¾›äº†Jdbcçš„<code>Connection</code>ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User getUserById(<span style="color:#fff;font-weight:bold">long</span> id) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ³¨æ„ä¼ å…¥çš„æ˜¯ConnectionCallback:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> jdbcTemplate.<span style="color:#007f7f">execute</span>((Connection conn) -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¯ä»¥ç›´æ¥ä½¿ç”¨connå®ä¾‹ï¼Œä¸è¦é‡Šæ”¾å®ƒï¼Œå›è°ƒç»“æŸåJdbcTemplateè‡ªåŠ¨é‡Šæ”¾:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åœ¨å†…éƒ¨æ‰‹åŠ¨åˆ›å»ºçš„PreparedStatementã€ResultSetå¿…é¡»ç”¨try(...)é‡Šæ”¾:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> (<span style="color:#fff;font-weight:bold">var</span> ps = conn.<span style="color:#007f7f">prepareStatement</span>(<span style="color:#0ff;font-weight:bold">&#34;SELECT * FROM users WHERE id = ?&#34;</span>)) {
</span></span><span style="display:flex;"><span>            ps.<span style="color:#007f7f">setObject</span>(1, id);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> (<span style="color:#fff;font-weight:bold">var</span> rs = ps.<span style="color:#007f7f">executeQuery</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (rs.<span style="color:#007f7f">next</span>()) {
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> User( <span style="color:#007f7f">// new User object:</span>
</span></span><span style="display:flex;"><span>                            rs.<span style="color:#007f7f">getLong</span>(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>), <span style="color:#007f7f">// id</span>
</span></span><span style="display:flex;"><span>                            rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;email&#34;</span>), <span style="color:#007f7f">// email</span>
</span></span><span style="display:flex;"><span>                            rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>), <span style="color:#007f7f">// password</span>
</span></span><span style="display:flex;"><span>                            rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>)); <span style="color:#007f7f">// name</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;user not found by id.&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šè¿°å›è°ƒæ–¹æ³•å…è®¸è·å–Connectionï¼Œç„¶ååšä»»ä½•åŸºäºConnectionçš„æ“ä½œã€‚</p>
<p>æˆ‘ä»¬å†çœ‹<code>T execute(String sql, PreparedStatementCallback&lt;T&gt; action)</code>çš„ç”¨æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User getUserByName(String name) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// éœ€è¦ä¼ å…¥SQLè¯­å¥ï¼Œä»¥åŠPreparedStatementCallback:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> jdbcTemplate.<span style="color:#007f7f">execute</span>(<span style="color:#0ff;font-weight:bold">&#34;SELECT * FROM users WHERE name = ?&#34;</span>, (PreparedStatement ps) -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// PreparedStatementå®ä¾‹å·²ç»ç”±JdbcTemplateåˆ›å»ºï¼Œå¹¶åœ¨å›è°ƒåè‡ªåŠ¨é‡Šæ”¾:</span>
</span></span><span style="display:flex;"><span>        ps.<span style="color:#007f7f">setObject</span>(1, name);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> (<span style="color:#fff;font-weight:bold">var</span> rs = ps.<span style="color:#007f7f">executeQuery</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (rs.<span style="color:#007f7f">next</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> User( <span style="color:#007f7f">// new User object:</span>
</span></span><span style="display:flex;"><span>                        rs.<span style="color:#007f7f">getLong</span>(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>), <span style="color:#007f7f">// id</span>
</span></span><span style="display:flex;"><span>                        rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;email&#34;</span>), <span style="color:#007f7f">// email</span>
</span></span><span style="display:flex;"><span>                        rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>), <span style="color:#007f7f">// password</span>
</span></span><span style="display:flex;"><span>                        rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>)); <span style="color:#007f7f">// name</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;user not found by id.&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œæˆ‘ä»¬çœ‹<code>T queryForObject(String sql, RowMapper&lt;T&gt; rowMapper, Object... args)</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User getUserByEmail(String email) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä¼ å…¥SQLï¼Œå‚æ•°å’ŒRowMapperå®ä¾‹:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> jdbcTemplate.<span style="color:#007f7f">queryForObject</span>(<span style="color:#0ff;font-weight:bold">&#34;SELECT * FROM users WHERE email = ?&#34;</span>,
</span></span><span style="display:flex;"><span>            (ResultSet rs, <span style="color:#fff;font-weight:bold">int</span> rowNum) -&gt; {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å°†ResultSetçš„å½“å‰è¡Œæ˜ å°„ä¸ºä¸€ä¸ªJavaBean:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> User( <span style="color:#007f7f">// new User object:</span>
</span></span><span style="display:flex;"><span>                        rs.<span style="color:#007f7f">getLong</span>(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>), <span style="color:#007f7f">// id</span>
</span></span><span style="display:flex;"><span>                        rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;email&#34;</span>), <span style="color:#007f7f">// email</span>
</span></span><span style="display:flex;"><span>                        rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>), <span style="color:#007f7f">// password</span>
</span></span><span style="display:flex;"><span>                        rs.<span style="color:#007f7f">getString</span>(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>)); <span style="color:#007f7f">// name</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            email);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>queryForObject()</code>æ–¹æ³•ä¸­ï¼Œä¼ å…¥SQLä»¥åŠSQLå‚æ•°åï¼Œ<code>JdbcTemplate</code>ä¼šè‡ªåŠ¨åˆ›å»º<code>PreparedStatement</code>ï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸ¥è¯¢å¹¶è¿”å›<code>ResultSet</code>ï¼Œæˆ‘ä»¬æä¾›çš„<code>RowMapper</code>éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯æŠŠ<code>ResultSet</code>çš„å½“å‰è¡Œæ˜ å°„æˆä¸€ä¸ªJavaBeanå¹¶è¿”å›ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨<code>Connection</code>ã€<code>PreparedStatement</code>å’Œ<code>ResultSet</code>éƒ½ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç®¡ç†ã€‚</p>
<p><code>RowMapper</code>ä¸ä¸€å®šè¿”å›JavaBeanï¼Œå®é™…ä¸Šå®ƒå¯ä»¥è¿”å›ä»»ä½•Javaå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>SELECT COUNT(*)</code>æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥è¿”å›<code>Long</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> getUsers() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> jdbcTemplate.<span style="color:#007f7f">queryForObject</span>(<span style="color:#0ff;font-weight:bold">&#34;SELECT COUNT(*) FROM users&#34;</span>, (ResultSet rs, <span style="color:#fff;font-weight:bold">int</span> rowNum) -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// SELECT COUNT(*)æŸ¥è¯¢åªæœ‰ä¸€åˆ—ï¼Œå–ç¬¬ä¸€åˆ—æ•°æ®:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> rs.<span style="color:#007f7f">getLong</span>(1);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬æœŸæœ›è¿”å›å¤šè¡Œè®°å½•ï¼Œè€Œä¸æ˜¯ä¸€è¡Œï¼Œå¯ä»¥ç”¨<code>query()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> List&lt;User&gt; getUsers(<span style="color:#fff;font-weight:bold">int</span> pageIndex) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> limit = 100;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> offset = limit * (pageIndex - 1);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> jdbcTemplate.<span style="color:#007f7f">query</span>(<span style="color:#0ff;font-weight:bold">&#34;SELECT * FROM users LIMIT ? OFFSET ?&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">new</span> BeanPropertyRowMapper&lt;&gt;(User.<span style="color:#007f7f">class</span>),
</span></span><span style="display:flex;"><span>            limit, offset);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°<code>query()</code>æ–¹æ³•ä¼ å…¥çš„å‚æ•°ä»ç„¶æ˜¯SQLã€SQLå‚æ•°ä»¥åŠ<code>RowMapper</code>å®ä¾‹ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨Springæä¾›çš„<code>BeanPropertyRowMapper</code>ã€‚å¦‚æœæ•°æ®åº“è¡¨çš„ç»“æ„æ°å¥½å’ŒJavaBeançš„å±æ€§åç§°ä¸€è‡´ï¼Œé‚£ä¹ˆ<code>BeanPropertyRowMapper</code>å°±å¯ä»¥ç›´æ¥æŠŠä¸€è¡Œè®°å½•æŒ‰åˆ—åè½¬æ¢ä¸ºJavaBeanã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æ‰§è¡Œçš„ä¸æ˜¯æŸ¥è¯¢ï¼Œè€Œæ˜¯æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨<code>update()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> updateUser(User user) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä¼ å…¥SQLï¼ŒSQLå‚æ•°ï¼Œè¿”å›æ›´æ–°çš„è¡Œæ•°:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (1 != jdbcTemplate.<span style="color:#007f7f">update</span>(<span style="color:#0ff;font-weight:bold">&#34;UPDATE users SET name = ? WHERE id = ?&#34;</span>, user.<span style="color:#007f7f">getName</span>(), user.<span style="color:#007f7f">getId</span>())) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;User not found by id&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åªæœ‰ä¸€ç§<code>INSERT</code>æ“ä½œæ¯”è¾ƒç‰¹æ®Šï¼Œé‚£å°±æ˜¯å¦‚æœæŸä¸€åˆ—æ˜¯è‡ªå¢åˆ—ï¼ˆä¾‹å¦‚è‡ªå¢ä¸»é”®ï¼‰ï¼Œé€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦è·å–æ’å…¥åçš„è‡ªå¢å€¼ã€‚<code>JdbcTemplate</code>æä¾›äº†ä¸€ä¸ª<code>KeyHolder</code>æ¥ç®€åŒ–è¿™ä¸€æ“ä½œï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User register(String email, String password, String name) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªKeyHolder:</span>
</span></span><span style="display:flex;"><span>    KeyHolder holder = <span style="color:#fff;font-weight:bold">new</span> GeneratedKeyHolder();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (1 != jdbcTemplate.<span style="color:#007f7f">update</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å‚æ•°1:PreparedStatementCreator</span>
</span></span><span style="display:flex;"><span>        (conn) -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// åˆ›å»ºPreparedStatementæ—¶ï¼Œå¿…é¡»æŒ‡å®šRETURN_GENERATED_KEYS:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">var</span> ps = conn.<span style="color:#007f7f">prepareStatement</span>(<span style="color:#0ff;font-weight:bold">&#34;INSERT INTO users(email, password, name) VALUES(?, ?, ?)&#34;</span>,
</span></span><span style="display:flex;"><span>                    Statement.<span style="color:#007f7f">RETURN_GENERATED_KEYS</span>);
</span></span><span style="display:flex;"><span>            ps.<span style="color:#007f7f">setObject</span>(1, email);
</span></span><span style="display:flex;"><span>            ps.<span style="color:#007f7f">setObject</span>(2, password);
</span></span><span style="display:flex;"><span>            ps.<span style="color:#007f7f">setObject</span>(3, name);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> ps;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å‚æ•°2:KeyHolder</span>
</span></span><span style="display:flex;"><span>        holder)
</span></span><span style="display:flex;"><span>    ) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;Insert failed.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä»KeyHolderä¸­è·å–è¿”å›çš„è‡ªå¢å€¼:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> User(holder.<span style="color:#007f7f">getKey</span>().<span style="color:#007f7f">longValue</span>(), email, password, name);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>JdbcTemplate</code>è¿˜æœ‰è®¸å¤šé‡è½½æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ä¸€ä¸€ä»‹ç»ã€‚éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œ<code>JdbcTemplate</code>åªæ˜¯å¯¹JDBCæ“ä½œçš„ä¸€ä¸ªç®€å•å°è£…ï¼Œå®ƒçš„ç›®çš„æ˜¯å°½é‡å‡å°‘æ‰‹åŠ¨ç¼–å†™<code>try(resource) {...}</code>çš„ä»£ç ï¼Œå¯¹äºæŸ¥è¯¢ï¼Œä¸»è¦é€šè¿‡<code>RowMapper</code>å®ç°äº†JDBCç»“æœé›†åˆ°Javaå¯¹è±¡çš„è½¬æ¢ã€‚</p>
<p>æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹<code>JdbcTemplate</code>çš„ç”¨æ³•ï¼Œé‚£å°±æ˜¯ï¼š</p>
<ul>
<li>é’ˆå¯¹ç®€å•æŸ¥è¯¢ï¼Œä¼˜é€‰<code>query()</code>å’Œ<code>queryForObject()</code>ï¼Œå› ä¸ºåªéœ€æä¾›SQLè¯­å¥ã€å‚æ•°å’Œ<code>RowMapper</code>ï¼›</li>
<li>é’ˆå¯¹æ›´æ–°æ“ä½œï¼Œä¼˜é€‰<code>update()</code>ï¼Œå› ä¸ºåªéœ€æä¾›SQLè¯­å¥å’Œå‚æ•°ï¼›</li>
<li>ä»»ä½•å¤æ‚çš„æ“ä½œï¼Œæœ€ç»ˆä¹Ÿå¯ä»¥é€šè¿‡<code>execute(ConnectionCallback)</code>å®ç°ï¼Œå› ä¸ºæ‹¿åˆ°<code>Connection</code>å°±å¯ä»¥åšä»»ä½•JDBCæ“ä½œã€‚</li>
</ul>
<p>å®é™…ä¸Šæˆ‘ä»¬ä½¿ç”¨æœ€å¤šçš„ä»ç„¶æ˜¯å„ç§æŸ¥è¯¢ã€‚å¦‚æœåœ¨è®¾è®¡è¡¨ç»“æ„çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå’ŒJavaBeançš„å±æ€§ä¸€ä¸€å¯¹åº”ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨<code>BeanPropertyRowMapper</code>å°±å¾ˆæ–¹ä¾¿ã€‚å¦‚æœè¡¨ç»“æ„å’ŒJavaBeanä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿé‚£å°±éœ€è¦ç¨å¾®æ”¹å†™ä¸€ä¸‹æŸ¥è¯¢ï¼Œä½¿ç»“æœé›†çš„ç»“æ„å’ŒJavaBeanä¿æŒä¸€è‡´ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¡¨çš„åˆ—åæ˜¯<code>office_address</code>ï¼Œè€ŒJavaBeanå±æ€§æ˜¯<code>workAddress</code>ï¼Œå°±éœ€è¦æŒ‡å®šåˆ«åï¼Œæ”¹å†™æŸ¥è¯¢å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>SELECT id, email, office_address AS workAddress, name FROM users WHERE email = ?
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å°ç»“">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“">#</a></h2>
<p>Springæä¾›äº†<code>JdbcTemplate</code>æ¥ç®€åŒ–JDBCæ“ä½œï¼›</p>
<p>ä½¿ç”¨<code>JdbcTemplate</code>æ—¶ï¼Œæ ¹æ®éœ€è¦ä¼˜å…ˆé€‰æ‹©é«˜çº§æ–¹æ³•ï¼›</p>
<p>ä»»ä½•JDBCæ“ä½œéƒ½å¯ä»¥ä½¿ç”¨ä¿åº•çš„<code>execute(ConnectionCallback)</code>æ–¹æ³•ã€‚</p>
<h1 id="ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡">ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡">#</a></h1>
<p>ä½¿ç”¨Springæ“ä½œJDBCè™½ç„¶æ–¹ä¾¿ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å‰é¢è®¨è®ºJDBCçš„æ—¶å€™ï¼Œè®²åˆ°è¿‡<a href="https://liaoxuefeng.com/books/java/jdbc/tx/index.html">JDBCäº‹åŠ¡</a>ï¼Œå¦‚æœè¦åœ¨Springä¸­æ“ä½œäº‹åŠ¡ï¼Œæ²¡å¿…è¦æ‰‹å†™JDBCäº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨Springæä¾›çš„é«˜çº§æ¥å£æ¥æ“ä½œäº‹åŠ¡ã€‚</p>
<p>Springæä¾›äº†ä¸€ä¸ª<code>PlatformTransactionManager</code>æ¥è¡¨ç¤ºäº‹åŠ¡ç®¡ç†å™¨ï¼Œæ‰€æœ‰çš„äº‹åŠ¡éƒ½ç”±å®ƒè´Ÿè´£ç®¡ç†ã€‚è€Œäº‹åŠ¡ç”±<code>TransactionStatus</code>è¡¨ç¤ºã€‚å¦‚æœæ‰‹å†™äº‹åŠ¡ä»£ç ï¼Œä½¿ç”¨<code>try...catch</code>å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>TransactionStatus tx = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¼€å¯äº‹åŠ¡:</span>
</span></span><span style="display:flex;"><span>    tx = txManager.<span style="color:#007f7f">getTransaction</span>(<span style="color:#fff;font-weight:bold">new</span> DefaultTransactionDefinition());
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ç›¸å…³JDBCæ“ä½œ:</span>
</span></span><span style="display:flex;"><span>    jdbcTemplate.<span style="color:#007f7f">update</span>(<span style="color:#0ff;font-weight:bold">&#34;...&#34;</span>);
</span></span><span style="display:flex;"><span>    jdbcTemplate.<span style="color:#007f7f">update</span>(<span style="color:#0ff;font-weight:bold">&#34;...&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æäº¤äº‹åŠ¡:</span>
</span></span><span style="display:flex;"><span>    txManager.<span style="color:#007f7f">commit</span>(tx);
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (RuntimeException e) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å›æ»šäº‹åŠ¡:</span>
</span></span><span style="display:flex;"><span>    txManager.<span style="color:#007f7f">rollback</span>(tx);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">throw</span> e;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Springä¸ºå•¥è¦æŠ½è±¡å‡º<code>PlatformTransactionManager</code>å’Œ<code>TransactionStatus</code>ï¼ŸåŸå› æ˜¯JavaEEé™¤äº†æä¾›JDBCäº‹åŠ¡å¤–ï¼Œå®ƒè¿˜æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡JTAï¼ˆJava Transaction APIï¼‰ã€‚åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æŒ‡å¤šä¸ªæ•°æ®æºï¼ˆæ¯”å¦‚å¤šä¸ªæ•°æ®åº“ï¼Œå¤šä¸ªæ¶ˆæ¯ç³»ç»Ÿï¼‰è¦åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å®ç°äº‹åŠ¡çš„æ—¶å€™ï¼Œåº”è¯¥æ€ä¹ˆå®ç°ã€‚åˆ†å¸ƒå¼äº‹åŠ¡å®ç°èµ·æ¥éå¸¸å¤æ‚ï¼Œç®€å•åœ°è¯´å°±æ˜¯é€šè¿‡ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†å™¨å®ç°ä¸¤é˜¶æ®µæäº¤ï¼Œä½†æœ¬èº«æ•°æ®åº“äº‹åŠ¡å°±ä¸å¿«ï¼ŒåŸºäºæ•°æ®åº“äº‹åŠ¡å®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡å°±æ…¢å¾—éš¾ä»¥å¿å—ï¼Œæ‰€ä»¥ä½¿ç”¨ç‡ä¸é«˜ã€‚</p>
<p>Springä¸ºäº†åŒæ—¶æ”¯æŒJDBCå’ŒJTAä¸¤ç§äº‹åŠ¡æ¨¡å‹ï¼Œå°±æŠ½è±¡å‡º<code>PlatformTransactionManager</code>ã€‚å› ä¸ºæˆ‘ä»¬çš„ä»£ç åªéœ€è¦JDBCäº‹åŠ¡ï¼Œå› æ­¤ï¼Œåœ¨<code>AppConfig</code>ä¸­ï¼Œéœ€è¦å†å®šä¹‰ä¸€ä¸ª<code>PlatformTransactionManager</code>å¯¹åº”çš„Beanï¼Œå®ƒçš„å®é™…ç±»å‹æ˜¯<code>DataSourceTransactionManager</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@PropertySource(<span style="color:#0ff;font-weight:bold">&#34;jdbc.properties&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    PlatformTransactionManager createTxManager(@Autowired DataSource dataSource) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> DataSourceTransactionManager(dataSource);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ç¼–ç¨‹çš„æ–¹å¼ä½¿ç”¨Springäº‹åŠ¡ä»ç„¶æ¯”è¾ƒç¹çï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯é€šè¿‡å£°æ˜å¼äº‹åŠ¡æ¥å®ç°ã€‚ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡éå¸¸ç®€å•ï¼Œé™¤äº†åœ¨<code>AppConfig</code>ä¸­è¿½åŠ ä¸€ä¸ªä¸Šè¿°å®šä¹‰çš„<code>PlatformTransactionManager</code>å¤–ï¼Œå†åŠ ä¸€ä¸ª<code>@EnableTransactionManagement</code>å°±å¯ä»¥å¯ç”¨å£°æ˜å¼äº‹åŠ¡ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableTransactionManagement <span style="color:#007f7f">// å¯ç”¨å£°æ˜å¼</span>
</span></span><span style="display:flex;"><span>@PropertySource(<span style="color:#0ff;font-weight:bold">&#34;jdbc.properties&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œå¯¹éœ€è¦äº‹åŠ¡æ”¯æŒçš„æ–¹æ³•ï¼ŒåŠ ä¸€ä¸ª<code>@Transactional</code>æ³¨è§£ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ­¤publicæ–¹æ³•è‡ªåŠ¨å…·æœ‰äº‹åŠ¡æ”¯æŒ:</span>
</span></span><span style="display:flex;"><span>    @Transactional
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User register(String email, String password, String name) {
</span></span><span style="display:flex;"><span>       ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…æ›´ç®€å•ä¸€ç‚¹ï¼Œç›´æ¥åœ¨Beançš„<code>class</code>å¤„åŠ ä¸Šï¼Œè¡¨ç¤ºæ‰€æœ‰<code>public</code>æ–¹æ³•éƒ½å…·æœ‰äº‹åŠ¡æ”¯æŒï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Springå¯¹ä¸€ä¸ªå£°æ˜å¼äº‹åŠ¡çš„æ–¹æ³•ï¼Œå¦‚ä½•å¼€å¯äº‹åŠ¡æ”¯æŒï¼ŸåŸç†ä»ç„¶æ˜¯AOPä»£ç†ï¼Œå³é€šè¿‡è‡ªåŠ¨åˆ›å»ºBeançš„Proxyå®ç°ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService$$EnhancerBySpringCGLIB <span style="color:#fff;font-weight:bold">extends</span> UserService {
</span></span><span style="display:flex;"><span>    UserService target = ...
</span></span><span style="display:flex;"><span>    PlatformTransactionManager txManager = ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User register(String email, String password, String name) {
</span></span><span style="display:flex;"><span>        TransactionStatus tx = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            tx = txManager.<span style="color:#007f7f">getTransaction</span>(<span style="color:#fff;font-weight:bold">new</span> DefaultTransactionDefinition());
</span></span><span style="display:flex;"><span>            target.<span style="color:#007f7f">register</span>(email, password, name);
</span></span><span style="display:flex;"><span>            txManager.<span style="color:#007f7f">commit</span>(tx);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (RuntimeException e) {
</span></span><span style="display:flex;"><span>            txManager.<span style="color:#007f7f">rollback</span>(tx);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> e;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼šå£°æ˜äº†<code>@EnableTransactionManagement</code>åï¼Œä¸å¿…é¢å¤–æ·»åŠ <code>@EnableAspectJAutoProxy</code>ã€‚</p>
<h2 id="å›æ»šäº‹åŠ¡">å›æ»šäº‹åŠ¡<a hidden class="anchor" aria-hidden="true" href="#å›æ»šäº‹åŠ¡">#</a></h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå‘ç”Ÿäº†<code>RuntimeException</code>ï¼ŒSpringçš„å£°æ˜å¼äº‹åŠ¡å°†è‡ªåŠ¨å›æ»šã€‚åœ¨ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ä¸­ï¼Œå¦‚æœç¨‹åºåˆ¤æ–­éœ€è¦å›æ»šäº‹åŠ¡ï¼Œåªéœ€æŠ›å‡º<code>RuntimeException</code>ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> buyProducts(<span style="color:#fff;font-weight:bold">long</span> productId, <span style="color:#fff;font-weight:bold">int</span> num) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (store &lt; num) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åº“å­˜ä¸å¤Ÿï¼Œè´­ä¹°å¤±è´¥:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalArgumentException(<span style="color:#0ff;font-weight:bold">&#34;No enough products&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¦é’ˆå¯¹Checked Exceptionå›æ»šäº‹åŠ¡ï¼Œéœ€è¦åœ¨<code>@Transactional</code>æ³¨è§£ä¸­å†™å‡ºæ¥ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Transactional(rollbackFor = {RuntimeException.<span style="color:#007f7f">class</span>, IOException.<span style="color:#007f7f">class</span>})
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> buyProducts(<span style="color:#fff;font-weight:bold">long</span> productId, <span style="color:#fff;font-weight:bold">int</span> num) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç è¡¨ç¤ºåœ¨æŠ›å‡º<code>RuntimeException</code>æˆ–<code>IOException</code>æ—¶ï¼Œäº‹åŠ¡å°†å›æ»šã€‚</p>
<p>ä¸ºäº†ç®€åŒ–ä»£ç ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä¸šåŠ¡å¼‚å¸¸ä½“ç³»ä»<code>RuntimeException</code>æ´¾ç”Ÿï¼Œè¿™æ ·å°±ä¸å¿…å£°æ˜ä»»ä½•ç‰¹æ®Šå¼‚å¸¸å³å¯è®©Springçš„å£°æ˜å¼äº‹åŠ¡æ­£å¸¸å·¥ä½œï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> BusinessException <span style="color:#fff;font-weight:bold">extends</span> RuntimeException {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LoginException <span style="color:#fff;font-weight:bold">extends</span> BusinessException {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> PaymentException <span style="color:#fff;font-weight:bold">extends</span> BusinessException {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äº‹åŠ¡è¾¹ç•Œ">äº‹åŠ¡è¾¹ç•Œ<a hidden class="anchor" aria-hidden="true" href="#äº‹åŠ¡è¾¹ç•Œ">#</a></h2>
<p>åœ¨ä½¿ç”¨äº‹åŠ¡çš„æ—¶å€™ï¼Œæ˜ç¡®äº‹åŠ¡è¾¹ç•Œéå¸¸é‡è¦ã€‚å¯¹äºå£°æ˜å¼äº‹åŠ¡ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢çš„<code>register()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService {
</span></span><span style="display:flex;"><span>    @Transactional
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User register(String email, String password, String name) { <span style="color:#007f7f">// äº‹åŠ¡å¼€å§‹</span>
</span></span><span style="display:flex;"><span>       ...
</span></span><span style="display:flex;"><span>    } <span style="color:#007f7f">// äº‹åŠ¡ç»“æŸ</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒçš„äº‹åŠ¡è¾¹ç•Œå°±æ˜¯<code>register()</code>æ–¹æ³•å¼€å§‹å’Œç»“æŸã€‚</p>
<p>ç±»ä¼¼çš„ï¼Œä¸€ä¸ªè´Ÿè´£ç»™ç”¨æˆ·å¢åŠ ç§¯åˆ†çš„<code>addBonus()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> BonusService {
</span></span><span style="display:flex;"><span>    @Transactional
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addBonus(<span style="color:#fff;font-weight:bold">long</span> userId, <span style="color:#fff;font-weight:bold">int</span> bonus) { <span style="color:#007f7f">// äº‹åŠ¡å¼€å§‹</span>
</span></span><span style="display:flex;"><span>       ...
</span></span><span style="display:flex;"><span>    } <span style="color:#007f7f">// äº‹åŠ¡ç»“æŸ</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒçš„äº‹åŠ¡è¾¹ç•Œå°±æ˜¯<code>addBonus()</code>æ–¹æ³•å¼€å§‹å’Œç»“æŸã€‚</p>
<p>åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œé—®é¢˜æ€»æ˜¯è¦å¤æ‚ä¸€ç‚¹ç‚¹ã€‚ç”¨æˆ·æ³¨å†Œåï¼Œèƒ½è‡ªåŠ¨è·å¾—100ç§¯åˆ†ï¼Œå› æ­¤ï¼Œå®é™…ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    BonusService bonusService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Transactional
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User register(String email, String password, String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ’å…¥ç”¨æˆ·è®°å½•:</span>
</span></span><span style="display:flex;"><span>        User user = jdbcTemplate.<span style="color:#007f7f">insert</span>(<span style="color:#0ff;font-weight:bold">&#34;...&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¢åŠ 100ç§¯åˆ†:</span>
</span></span><span style="display:flex;"><span>        bonusService.<span style="color:#007f7f">addBonus</span>(user.<span style="color:#007f7f">id</span>, 100);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨é—®é¢˜æ¥äº†ï¼šè°ƒç”¨æ–¹ï¼ˆæ¯”å¦‚<code>RegisterController</code>ï¼‰è°ƒç”¨<code>UserService.register()</code>è¿™ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œå®ƒåœ¨å†…éƒ¨åˆè°ƒç”¨äº†<code>BonusService.addBonus()</code>è¿™ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œä¸€å…±æœ‰å‡ ä¸ªäº‹åŠ¡ï¼Ÿå¦‚æœ<code>addBonus()</code>æŠ›å‡ºäº†å¼‚å¸¸éœ€è¦å›æ»šäº‹åŠ¡ï¼Œ<code>register()</code>æ–¹æ³•çš„äº‹åŠ¡æ˜¯å¦ä¹Ÿè¦å›æ»šï¼Ÿ</p>
<p>é—®é¢˜çš„å¤æ‚åº¦æ˜¯ä¸æ˜¯ä¸€ä¸‹å­æé«˜äº†10å€ï¼Ÿ</p>
<h2 id="äº‹åŠ¡ä¼ æ’­">äº‹åŠ¡ä¼ æ’­<a hidden class="anchor" aria-hidden="true" href="#äº‹åŠ¡ä¼ æ’­">#</a></h2>
<p>è¦è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å®šä¹‰äº‹åŠ¡çš„ä¼ æ’­æ¨¡å‹ã€‚</p>
<p>å‡è®¾ç”¨æˆ·æ³¨å†Œçš„å…¥å£æ˜¯<code>RegisterController</code>ï¼Œå®ƒæœ¬èº«æ²¡æœ‰äº‹åŠ¡ï¼Œä»…ä»…æ˜¯è°ƒç”¨<code>UserService.register()</code>è¿™ä¸ªäº‹åŠ¡æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RegisterController {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PostMapping(<span style="color:#0ff;font-weight:bold">&#34;/register&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView doRegister(HttpServletRequest req) {
</span></span><span style="display:flex;"><span>        String email = req.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;email&#34;</span>);
</span></span><span style="display:flex;"><span>        String password = req.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>);
</span></span><span style="display:flex;"><span>        String name = req.<span style="color:#007f7f">getParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>);
</span></span><span style="display:flex;"><span>        User user = userService.<span style="color:#007f7f">register</span>(email, password, name);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› æ­¤ï¼Œ<code>UserService.register()</code>è¿™ä¸ªäº‹åŠ¡æ–¹æ³•çš„èµ·å§‹å’Œç»“æŸï¼Œå°±æ˜¯äº‹åŠ¡çš„èŒƒå›´ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦å…³å¿ƒçš„é—®é¢˜æ˜¯ï¼Œåœ¨<code>UserService.register()</code>è¿™ä¸ªäº‹åŠ¡æ–¹æ³•å†…ï¼Œè°ƒç”¨<code>BonusService.addBonus()</code>ï¼Œæˆ‘ä»¬æœŸå¾…çš„äº‹åŠ¡è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User register(String email, String password, String name) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// äº‹åŠ¡å·²å¼€å¯:</span>
</span></span><span style="display:flex;"><span>    User user = jdbcTemplate.<span style="color:#007f7f">insert</span>(<span style="color:#0ff;font-weight:bold">&#34;...&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ???:</span>
</span></span><span style="display:flex;"><span>    bonusService.<span style="color:#007f7f">addBonus</span>(user.<span style="color:#007f7f">id</span>, 100);
</span></span><span style="display:flex;"><span>} <span style="color:#007f7f">// äº‹åŠ¡ç»“æŸ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºå¤§å¤šæ•°ä¸šåŠ¡æ¥è¯´ï¼Œæˆ‘ä»¬æœŸå¾…<code>BonusService.addBonus()</code>çš„è°ƒç”¨ï¼Œå’Œ<code>UserService.register()</code>åº”å½“èåˆåœ¨ä¸€èµ·ï¼Œå®ƒçš„è¡Œä¸ºåº”è¯¥å¦‚ä¸‹ï¼š</p>
<p><code>UserService.register()</code>å·²ç»å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆåœ¨å†…éƒ¨è°ƒç”¨<code>BonusService.addBonus()</code>æ—¶ï¼Œ<code>BonusService.addBonus()</code>æ–¹æ³•å°±æ²¡å¿…è¦å†å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œç›´æ¥åŠ å…¥åˆ°<code>BonusService.register()</code>çš„äº‹åŠ¡é‡Œå°±å¥½äº†ã€‚</p>
<p>å…¶å®å°±ç›¸å½“äºï¼š</p>
<ol>
<li><code>UserService.register()</code>å…ˆæ‰§è¡Œäº†ä¸€æ¡INSERTè¯­å¥ï¼š<code>INSERT INTO users ...</code></li>
<li><code>BonusService.addBonus()</code>å†æ‰§è¡Œä¸€æ¡INSERTè¯­å¥ï¼š<code>INSERT INTO bonus ...</code></li>
</ol>
<p>å› æ­¤ï¼ŒSpringçš„å£°æ˜å¼äº‹åŠ¡ä¸ºäº‹åŠ¡ä¼ æ’­å®šä¹‰äº†å‡ ä¸ªçº§åˆ«ï¼Œé»˜è®¤ä¼ æ’­çº§åˆ«å°±æ˜¯REQUIREDï¼Œå®ƒçš„æ„æ€æ˜¯ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æœ‰äº‹åŠ¡ï¼Œå°±åŠ å…¥åˆ°å½“å‰äº‹åŠ¡ä¸­æ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬è§‚å¯Ÿ<code>UserService.register()</code>æ–¹æ³•ï¼Œå®ƒåœ¨<code>RegisterController</code>ä¸­æ‰§è¡Œï¼Œå› ä¸º<code>RegisterController</code>æ²¡æœ‰äº‹åŠ¡ï¼Œå› æ­¤ï¼Œ<code>UserService.register()</code>æ–¹æ³•ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚</p>
<p>åœ¨<code>UserService.register()</code>æ–¹æ³•å†…éƒ¨ï¼Œè°ƒç”¨<code>BonusService.addBonus()</code>æ–¹æ³•æ—¶ï¼Œå› ä¸º<code>BonusService.addBonus()</code>æ£€æµ‹åˆ°å½“å‰å·²ç»æœ‰äº‹åŠ¡äº†ï¼Œå› æ­¤ï¼Œå®ƒä¼šåŠ å…¥åˆ°å½“å‰äº‹åŠ¡ä¸­æ‰§è¡Œã€‚</p>
<p>å› æ­¤ï¼Œæ•´ä¸ªä¸šåŠ¡æµç¨‹çš„äº‹åŠ¡è¾¹ç•Œå°±æ¸…æ™°äº†ï¼šå®ƒåªæœ‰ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶ä¸”èŒƒå›´å°±æ˜¯<code>UserService.register()</code>æ–¹æ³•ã€‚</p>
<p>æœ‰çš„ç«¥é‹ä¼šé—®ï¼šæŠŠ<code>BonusService.addBonus()</code>æ–¹æ³•çš„<code>@Transactional</code>å»æ‰ï¼Œå˜æˆä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œé‚£ä¸å°±è§„é¿äº†å¤æ‚çš„ä¼ æ’­æ¨¡å‹å—ï¼Ÿ</p>
<p>å»æ‰<code>BonusService.addBonus()</code>æ–¹æ³•çš„<code>@Transactional</code>ï¼Œä¼šå¼•æ¥å¦ä¸€ä¸ªé—®é¢˜ï¼Œå³å…¶ä»–åœ°æ–¹å¦‚æœè°ƒç”¨<code>BonusService.addBonus()</code>æ–¹æ³•ï¼Œé‚£å°±æ²¡æ³•ä¿è¯äº‹åŠ¡äº†ã€‚ä¾‹å¦‚ï¼Œè§„å®šç”¨æˆ·ç™»å½•æ—¶ç§¯åˆ†+5ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LoginController {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    BonusService bonusService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PostMapping(<span style="color:#0ff;font-weight:bold">&#34;/login&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ModelAndView doLogin(HttpServletRequest req) {
</span></span><span style="display:flex;"><span>        User user = ...
</span></span><span style="display:flex;"><span>        bonusService.<span style="color:#007f7f">addBonus</span>(user.<span style="color:#007f7f">id</span>, 5);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼Œ<code>BonusService.addBonus()</code>æ–¹æ³•å¿…é¡»è¦æœ‰<code>@Transactional</code>ï¼Œå¦åˆ™ï¼Œç™»å½•åç§¯åˆ†å°±æ— æ³•æ·»åŠ äº†ã€‚</p>
<p>é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­çº§åˆ«æ˜¯<code>REQUIRED</code>ï¼Œå®ƒæ»¡è¶³ç»å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä¼ æ’­çº§åˆ«ï¼š</p>
<p><code>SUPPORTS</code>ï¼šè¡¨ç¤ºå¦‚æœæœ‰äº‹åŠ¡ï¼Œå°±åŠ å…¥åˆ°å½“å‰äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹Ÿä¸å¼€å¯äº‹åŠ¡æ‰§è¡Œã€‚è¿™ç§ä¼ æ’­çº§åˆ«å¯ç”¨äºæŸ¥è¯¢æ–¹æ³•ï¼Œå› ä¸ºSELECTè¯­å¥æ—¢å¯ä»¥åœ¨äº‹åŠ¡å†…æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä¸éœ€è¦äº‹åŠ¡ï¼›</p>
<p><code>MANDATORY</code>ï¼šè¡¨ç¤ºå¿…é¡»è¦å­˜åœ¨å½“å‰äº‹åŠ¡å¹¶åŠ å…¥æ‰§è¡Œï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ç§ä¼ æ’­çº§åˆ«å¯ç”¨äºæ ¸å¿ƒæ›´æ–°é€»è¾‘ï¼Œæ¯”å¦‚ç”¨æˆ·ä½™é¢å˜æ›´ï¼Œå®ƒæ€»æ˜¯è¢«å…¶ä»–äº‹åŠ¡æ–¹æ³•è°ƒç”¨ï¼Œä¸èƒ½ç›´æ¥ç”±éäº‹åŠ¡æ–¹æ³•è°ƒç”¨ï¼›</p>
<p><code>REQUIRES_NEW</code>ï¼šè¡¨ç¤ºä¸ç®¡å½“å‰æœ‰æ²¡æœ‰äº‹åŠ¡ï¼Œéƒ½å¿…é¡»å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡æ‰§è¡Œã€‚å¦‚æœå½“å‰å·²ç»æœ‰äº‹åŠ¡ï¼Œé‚£ä¹ˆå½“å‰äº‹åŠ¡ä¼šæŒ‚èµ·ï¼Œç­‰æ–°äº‹åŠ¡å®Œæˆåï¼Œå†æ¢å¤æ‰§è¡Œï¼›</p>
<p><code>NOT_SUPPORTED</code>ï¼šè¡¨ç¤ºä¸æ”¯æŒäº‹åŠ¡ï¼Œå¦‚æœå½“å‰æœ‰äº‹åŠ¡ï¼Œé‚£ä¹ˆå½“å‰äº‹åŠ¡ä¼šæŒ‚èµ·ï¼Œç­‰è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œå†æ¢å¤æ‰§è¡Œï¼›</p>
<p><code>NEVER</code>ï¼šå’Œ<code>NOT_SUPPORTED</code>ç›¸æ¯”ï¼Œå®ƒä¸ä½†ä¸æ”¯æŒäº‹åŠ¡ï¼Œè€Œä¸”åœ¨ç›‘æµ‹åˆ°å½“å‰æœ‰äº‹åŠ¡æ—¶ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸æ‹’ç»æ‰§è¡Œï¼›</p>
<p><code>NESTED</code>ï¼šè¡¨ç¤ºå¦‚æœå½“å‰æœ‰äº‹åŠ¡ï¼Œåˆ™å¼€å¯ä¸€ä¸ªåµŒå¥—çº§åˆ«äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ã€‚</p>
<p>ä¸Šé¢è¿™ä¹ˆå¤šç§äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«ï¼Œå…¶å®é»˜è®¤çš„<code>REQUIRED</code>å·²ç»æ»¡è¶³ç»å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œ<code>SUPPORTS</code>å’Œ<code>REQUIRES_NEW</code>åœ¨å°‘æ•°æƒ…å†µä¸‹ä¼šç”¨åˆ°ï¼Œå…¶ä»–åŸºæœ¬ä¸ä¼šç”¨åˆ°ï¼Œå› ä¸ºæŠŠäº‹åŠ¡æå¾—è¶Šå¤æ‚ï¼Œä¸ä»…é€»è¾‘è·Ÿç€å¤æ‚ï¼Œè€Œä¸”é€Ÿåº¦ä¹Ÿä¼šè¶Šæ…¢ã€‚</p>
<p>å®šä¹‰äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«ä¹Ÿæ˜¯å†™åœ¨<code>@Transactional</code>æ³¨è§£é‡Œçš„ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Transactional(propagation = Propagation.<span style="color:#007f7f">REQUIRES_NEW</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> Product createProduct() {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨åªå‰©æœ€åä¸€ä¸ªé—®é¢˜äº†ï¼šSpringæ˜¯å¦‚ä½•ä¼ æ’­äº‹åŠ¡çš„ï¼Ÿ</p>
<p>æˆ‘ä»¬<a href="https://liaoxuefeng.com/books/java/jdbc/tx/index.html">åœ¨JDBCä¸­ä½¿ç”¨äº‹åŠ¡</a>çš„æ—¶å€™ï¼Œæ˜¯è¿™ä¹ˆä¸ªå†™æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Connection conn = openConnection();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å…³é—­è‡ªåŠ¨æäº¤:</span>
</span></span><span style="display:flex;"><span>    conn.<span style="color:#007f7f">setAutoCommit</span>(<span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ‰§è¡Œå¤šæ¡SQLè¯­å¥:</span>
</span></span><span style="display:flex;"><span>    insert(); update(); delete();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æäº¤äº‹åŠ¡:</span>
</span></span><span style="display:flex;"><span>    conn.<span style="color:#007f7f">commit</span>();
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (SQLException e) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å›æ»šäº‹åŠ¡:</span>
</span></span><span style="display:flex;"><span>    conn.<span style="color:#007f7f">rollback</span>();
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>    conn.<span style="color:#007f7f">setAutoCommit</span>(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>    conn.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Springä½¿ç”¨å£°æ˜å¼äº‹åŠ¡ï¼Œæœ€ç»ˆä¹Ÿæ˜¯é€šè¿‡æ‰§è¡ŒJDBCäº‹åŠ¡æ¥å®ç°åŠŸèƒ½çš„ï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œå¦‚ä½•è·çŸ¥å½“å‰æ˜¯å¦å­˜åœ¨äº‹åŠ¡ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯<a href="https://liaoxuefeng.com/books/java/threading/thread-local/index.html">ä½¿ç”¨ThreadLocal</a>ã€‚Springæ€»æ˜¯æŠŠJDBCç›¸å…³çš„<code>Connection</code>å’Œ<code>TransactionStatus</code>å®ä¾‹ç»‘å®šåˆ°<code>ThreadLocal</code>ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ä»<code>ThreadLocal</code>æœªå–åˆ°äº‹åŠ¡ï¼Œé‚£ä¹ˆå®ƒä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„JDBCè¿æ¥ï¼ŒåŒæ—¶å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦åˆ™ï¼Œå®ƒå°±ç›´æ¥ä½¿ç”¨ä»<code>ThreadLocal</code>è·å–çš„JDBCè¿æ¥ä»¥åŠ<code>TransactionStatus</code>ã€‚</p>
<p>å› æ­¤ï¼Œäº‹åŠ¡èƒ½æ­£ç¡®ä¼ æ’­çš„å‰ææ˜¯ï¼Œæ–¹æ³•è°ƒç”¨æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹å†…æ‰è¡Œã€‚å¦‚æœåƒä¸‹é¢è¿™æ ·å†™ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User register(String email, String password, String name) { <span style="color:#007f7f">// BEGIN TX-A</span>
</span></span><span style="display:flex;"><span>    User user = jdbcTemplate.<span style="color:#007f7f">insert</span>(<span style="color:#0ff;font-weight:bold">&#34;...&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">new</span> Thread(() -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// BEGIN TX-B:</span>
</span></span><span style="display:flex;"><span>        bonusService.<span style="color:#007f7f">addBonus</span>(user.<span style="color:#007f7f">id</span>, 100);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// END TX-B</span>
</span></span><span style="display:flex;"><span>    }).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>} <span style="color:#007f7f">// END TX-A</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨<code>BonusService.addBonus()</code>ï¼Œå®ƒæ ¹æœ¬è·å–ä¸åˆ°å½“å‰äº‹åŠ¡ï¼Œå› æ­¤ï¼Œ<code>UserService.register()</code>å’Œ<code>BonusService.addBonus()</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œå°†åˆ†åˆ«å¼€å¯ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„äº‹åŠ¡ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œäº‹åŠ¡åªèƒ½åœ¨å½“å‰çº¿ç¨‹ä¼ æ’­ï¼Œæ— æ³•è·¨çº¿ç¨‹ä¼ æ’­ã€‚</p>
<p>é‚£å¦‚æœæˆ‘ä»¬æƒ³å®ç°è·¨çº¿ç¨‹ä¼ æ’­äº‹åŠ¡å‘¢ï¼ŸåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯è¦æƒ³åŠæ³•æŠŠå½“å‰çº¿ç¨‹ç»‘å®šåˆ°<code>ThreadLocal</code>çš„<code>Connection</code>å’Œ<code>TransactionStatus</code>å®ä¾‹ä¼ é€’ç»™æ–°çº¿ç¨‹ï¼Œä½†å®ç°èµ·æ¥éå¸¸å¤æ‚ï¼Œæ ¹æ®å¼‚å¸¸å›æ»šæ›´åŠ å¤æ‚ï¼Œä¸æ¨èè‡ªå·±å»å®ç°ã€‚</p>
<h1 id="ä½¿ç”¨dao">ä½¿ç”¨DAO<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨dao">#</a></h1>
<p>åœ¨ä¼ ç»Ÿçš„å¤šå±‚åº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸æ˜¯Webå±‚è°ƒç”¨ä¸šåŠ¡å±‚ï¼Œä¸šåŠ¡å±‚è°ƒç”¨æ•°æ®è®¿é—®å±‚ã€‚ä¸šåŠ¡å±‚è´Ÿè´£å¤„ç†å„ç§ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ•°æ®è®¿é—®å±‚åªè´Ÿè´£å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚å› æ­¤ï¼Œå®ç°æ•°æ®è®¿é—®å±‚å°±æ˜¯ç”¨<code>JdbcTemplate</code>å®ç°å¯¹æ•°æ®åº“çš„æ“ä½œã€‚</p>
<p>ç¼–å†™æ•°æ®è®¿é—®å±‚çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨DAOæ¨¡å¼ã€‚DAOå³Data Access Objectçš„ç¼©å†™ï¼Œå®ƒæ²¡æœ‰ä»€ä¹ˆç¥ç§˜ä¹‹å¤„ï¼Œå®ç°èµ·æ¥åŸºæœ¬å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserDao {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    JdbcTemplate jdbcTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    User getById(<span style="color:#fff;font-weight:bold">long</span> id) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    List&lt;User&gt; getUsers(<span style="color:#fff;font-weight:bold">int</span> page) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    User createUser(User user) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    User updateUser(User user) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> deleteUser(User user) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Springæä¾›äº†ä¸€ä¸ª<code>JdbcDaoSupport</code>ç±»ï¼Œç”¨äºç®€åŒ–DAOçš„å®ç°ã€‚è¿™ä¸ª<code>JdbcDaoSupport</code>æ²¡ä»€ä¹ˆå¤æ‚çš„ï¼Œæ ¸å¿ƒä»£ç å°±æ˜¯æŒæœ‰ä¸€ä¸ª<code>JdbcTemplate</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">abstract</span> <span style="color:#fff;font-weight:bold">class</span> JdbcDaoSupport <span style="color:#fff;font-weight:bold">extends</span> DaoSupport {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> JdbcTemplate jdbcTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">void</span> setJdbcTemplate(JdbcTemplate jdbcTemplate) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">jdbcTemplate</span> = jdbcTemplate;
</span></span><span style="display:flex;"><span>        initTemplateConfig();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> JdbcTemplate getJdbcTemplate() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">jdbcTemplate</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒçš„æ„å›¾æ˜¯å­ç±»ç›´æ¥ä»<code>JdbcDaoSupport</code>ç»§æ‰¿åï¼Œå¯ä»¥éšæ—¶è°ƒç”¨<code>getJdbcTemplate()</code>è·å¾—<code>JdbcTemplate</code>çš„å®ä¾‹ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå› ä¸º<code>JdbcDaoSupport</code>çš„<code>jdbcTemplate</code>å­—æ®µæ²¡æœ‰æ ‡è®°<code>@Autowired</code>ï¼Œæ‰€ä»¥ï¼Œå­ç±»æƒ³è¦æ³¨å…¥<code>JdbcTemplate</code>ï¼Œè¿˜å¾—è‡ªå·±æƒ³ä¸ªåŠæ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserDao <span style="color:#fff;font-weight:bold">extends</span> JdbcDaoSupport {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    JdbcTemplate jdbcTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PostConstruct
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> init() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>.<span style="color:#007f7f">setJdbcTemplate</span>(jdbcTemplate);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰çš„ç«¥é‹å¯èƒ½çœ‹å‡ºæ¥äº†ï¼šæ—¢ç„¶<code>UserDao</code>éƒ½å·²ç»æ³¨å…¥äº†<code>JdbcTemplate</code>ï¼Œé‚£å†æŠŠå®ƒæ”¾åˆ°çˆ¶ç±»é‡Œï¼Œé€šè¿‡<code>getJdbcTemplate()</code>è®¿é—®å²‚ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Ÿ</p>
<p>å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„XMLé…ç½®ï¼Œå¹¶ä¸éœ€è¦ç¼–å†™<code>@Autowired JdbcTemplate jdbcTemplate</code>ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ç°åœ¨åŸºæœ¬ä¸Šæ˜¯ä½¿ç”¨æ³¨è§£çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ª<code>AbstractDao</code>ï¼Œä¸“é—¨è´Ÿè´£æ³¨å…¥<code>JdbcTemplate</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">abstract</span> <span style="color:#fff;font-weight:bold">class</span> AbstractDao <span style="color:#fff;font-weight:bold">extends</span> JdbcDaoSupport {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> JdbcTemplate jdbcTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PostConstruct
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> init() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>.<span style="color:#007f7f">setJdbcTemplate</span>(jdbcTemplate);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œå­ç±»çš„ä»£ç å°±éå¸¸å¹²å‡€ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨<code>getJdbcTemplate()</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserDao <span style="color:#fff;font-weight:bold">extends</span> AbstractDao {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User getById(<span style="color:#fff;font-weight:bold">long</span> id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> getJdbcTemplate().<span style="color:#007f7f">queryForObject</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;SELECT * FROM users WHERE id = ?&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> BeanPropertyRowMapper&lt;&gt;(User.<span style="color:#007f7f">class</span>),
</span></span><span style="display:flex;"><span>                id
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å€˜è‹¥è‚¯å†å¤šå†™ä¸€ç‚¹æ ·æ¿ä»£ç ï¼Œå°±å¯ä»¥æŠŠ<code>AbstractDao</code>æ”¹æˆæ³›å‹ï¼Œå¹¶å®ç°<code>getById()</code>ï¼Œ<code>getAll()</code>ï¼Œ<code>deleteById()</code>è¿™æ ·çš„é€šç”¨æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">abstract</span> <span style="color:#fff;font-weight:bold">class</span> AbstractDao&lt;T&gt; <span style="color:#fff;font-weight:bold">extends</span> JdbcDaoSupport {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String table;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Class&lt;T&gt; entityClass;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> RowMapper&lt;T&gt; rowMapper;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> AbstractDao() {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–å½“å‰ç±»å‹çš„æ³›å‹ç±»å‹:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">entityClass</span> = getParameterizedType();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">table</span> = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">entityClass</span>.<span style="color:#007f7f">getSimpleName</span>().<span style="color:#007f7f">toLowerCase</span>() + <span style="color:#0ff;font-weight:bold">&#34;s&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">rowMapper</span> = <span style="color:#fff;font-weight:bold">new</span> BeanPropertyRowMapper&lt;&gt;(entityClass);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> T getById(<span style="color:#fff;font-weight:bold">long</span> id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> getJdbcTemplate().<span style="color:#007f7f">queryForObject</span>(<span style="color:#0ff;font-weight:bold">&#34;SELECT * FROM &#34;</span> + table + <span style="color:#0ff;font-weight:bold">&#34; WHERE id = ?&#34;</span>, <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">rowMapper</span>, id);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> List&lt;T&gt; getAll(<span style="color:#fff;font-weight:bold">int</span> pageIndex) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> limit = 100;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> offset = limit * (pageIndex - 1);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> getJdbcTemplate().<span style="color:#007f7f">query</span>(<span style="color:#0ff;font-weight:bold">&#34;SELECT * FROM &#34;</span> + table + <span style="color:#0ff;font-weight:bold">&#34; LIMIT ? OFFSET ?&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> Object[] { limit, offset },
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">rowMapper</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> deleteById(<span style="color:#fff;font-weight:bold">long</span> id) {
</span></span><span style="display:flex;"><span>        getJdbcTemplate().<span style="color:#007f7f">update</span>(<span style="color:#0ff;font-weight:bold">&#34;DELETE FROM &#34;</span> + table + <span style="color:#0ff;font-weight:bold">&#34; WHERE id = ?&#34;</span>, id);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œæ¯ä¸ªå­ç±»å°±è‡ªåŠ¨è·å¾—äº†è¿™äº›é€šç”¨æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserDao <span style="color:#fff;font-weight:bold">extends</span> AbstractDao&lt;User&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å·²ç»æœ‰äº†:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// User getById(long)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// List&lt;User&gt; getAll(int)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// void deleteById(long)</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> BookDao <span style="color:#fff;font-weight:bold">extends</span> AbstractDao&lt;Book&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å·²ç»æœ‰äº†:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Book getById(long)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// List&lt;Book&gt; getAll(int)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// void deleteById(long)</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼ŒDAOæ¨¡å¼å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ•°æ®è®¿é—®æ¨¡å¼ï¼Œæ˜¯å¦ä½¿ç”¨DAOï¼Œæ ¹æ®å®é™…æƒ…å†µå†³å®šï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™ï¼Œç›´æ¥åœ¨Serviceå±‚æ“ä½œæ•°æ®åº“ä¹Ÿæ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p>
<h1 id="é›†æˆhibernate">é›†æˆHibernate<a hidden class="anchor" aria-hidden="true" href="#é›†æˆhibernate">#</a></h1>
<p>ä½¿ç”¨<code>JdbcTemplate</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”¨å¾—æœ€å¤šçš„æ–¹æ³•å°±æ˜¯<code>List&lt;T&gt; query(String, RowMapper, Object...)</code>ã€‚è¿™ä¸ª<code>RowMapper</code>çš„ä½œç”¨å°±æ˜¯æŠŠ<code>ResultSet</code>çš„ä¸€è¡Œè®°å½•æ˜ å°„ä¸ºJava Beanã€‚</p>
<p>è¿™ç§æŠŠå…³ç³»æ•°æ®åº“çš„è¡¨è®°å½•æ˜ å°„ä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹å°±æ˜¯ORMï¼šObject-Relational Mappingã€‚ORMæ—¢å¯ä»¥æŠŠè®°å½•è½¬æ¢æˆJavaå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æŠŠJavaå¯¹è±¡è½¬æ¢ä¸ºè¡Œè®°å½•ã€‚</p>
<p>ä½¿ç”¨<code>JdbcTemplate</code>é…åˆ<code>RowMapper</code>å¯ä»¥çœ‹ä½œæ˜¯æœ€åŸå§‹çš„ORMã€‚å¦‚æœè¦å®ç°æ›´è‡ªåŠ¨åŒ–çš„ORMï¼Œå¯ä»¥é€‰æ‹©æˆç†Ÿçš„ORMæ¡†æ¶ï¼Œä¾‹å¦‚<a href="https://hibernate.org/">Hibernate</a>ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨Springä¸­é›†æˆHibernateã€‚</p>
<p>Hibernateä½œä¸ºORMæ¡†æ¶ï¼Œå®ƒå¯ä»¥æ›¿ä»£<code>JdbcTemplate</code>ï¼Œä½†Hibernateä»ç„¶éœ€è¦JDBCé©±åŠ¨ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥JDBCé©±åŠ¨ã€è¿æ¥æ± ï¼Œä»¥åŠHibernateæœ¬èº«ã€‚åœ¨Mavenä¸­ï¼Œæˆ‘ä»¬åŠ å…¥ä»¥ä¸‹ä¾èµ–é¡¹ï¼š</p>
<ul>
<li>org.springframework:spring-context:6.0.0</li>
<li>org.springframework:spring-orm:6.0.0</li>
<li>jakarta.annotation:jakarta.annotation-api:2.1.1</li>
<li>jakarta.persistence:jakarta.persistence-api:3.1.0</li>
<li>org.hibernate:hibernate-core:6.1.4.Final</li>
<li>com.zaxxer:HikariCP:5.0.1</li>
<li>org.hsqldb:hsqldb:2.7.1</li>
</ul>
<p>åœ¨<code>AppConfig</code>ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦åˆ›å»º<code>DataSource</code>ã€å¼•å…¥JDBCé…ç½®æ–‡ä»¶ï¼Œä»¥åŠå¯ç”¨å£°æ˜å¼äº‹åŠ¡ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableTransactionManagement
</span></span><span style="display:flex;"><span>@PropertySource(<span style="color:#0ff;font-weight:bold">&#34;jdbc.properties&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    DataSource createDataSource() {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†å¯ç”¨Hibernateï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<code>LocalSessionFactoryBean</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    LocalSessionFactoryBean createSessionFactory(@Autowired DataSource dataSource) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">var</span> props = <span style="color:#fff;font-weight:bold">new</span> Properties();
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">setProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;hibernate.hbm2ddl.auto&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;update&#34;</span>); <span style="color:#007f7f">// ç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">setProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;hibernate.dialect&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;org.hibernate.dialect.HSQLDialect&#34;</span>);
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">setProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;hibernate.show_sql&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">var</span> sessionFactoryBean = <span style="color:#fff;font-weight:bold">new</span> LocalSessionFactoryBean();
</span></span><span style="display:flex;"><span>        sessionFactoryBean.<span style="color:#007f7f">setDataSource</span>(dataSource);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ‰«ææŒ‡å®šçš„packageè·å–æ‰€æœ‰entity class:</span>
</span></span><span style="display:flex;"><span>        sessionFactoryBean.<span style="color:#007f7f">setPackagesToScan</span>(<span style="color:#0ff;font-weight:bold">&#34;com.itranswarp.learnjava.entity&#34;</span>);
</span></span><span style="display:flex;"><span>        sessionFactoryBean.<span style="color:#007f7f">setHibernateProperties</span>(props);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> sessionFactoryBean;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„æˆ‘ä»¬åœ¨<a href="https://liaoxuefeng.com/books/java/spring/ioc/customize/index.html">å®šåˆ¶Bean</a>ä¸­è®²åˆ°è¿‡<code>FactoryBean</code>ï¼Œ<code>LocalSessionFactoryBean</code>æ˜¯ä¸€ä¸ª<code>FactoryBean</code>ï¼Œå®ƒä¼šå†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>SessionFactory</code>ï¼Œåœ¨Hibernateä¸­ï¼Œ<code>Session</code>æ˜¯å°è£…äº†ä¸€ä¸ªJDBC <code>Connection</code>çš„å®ä¾‹ï¼Œè€Œ<code>SessionFactory</code>æ˜¯å°è£…äº†JDBC <code>DataSource</code>çš„å®ä¾‹ï¼Œå³<code>SessionFactory</code>æŒæœ‰è¿æ¥æ± ï¼Œæ¯æ¬¡éœ€è¦æ“ä½œæ•°æ®åº“çš„æ—¶å€™ï¼Œ<code>SessionFactory</code>åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Session</code>ï¼Œç›¸å½“äºä»è¿æ¥æ± è·å–åˆ°ä¸€ä¸ªæ–°çš„<code>Connection</code>ã€‚<code>SessionFactory</code>å°±æ˜¯Hibernateæä¾›çš„æœ€æ ¸å¿ƒçš„ä¸€ä¸ªå¯¹è±¡ï¼Œä½†<code>LocalSessionFactoryBean</code>æ˜¯Springæä¾›çš„ä¸ºäº†è®©æˆ‘ä»¬æ–¹ä¾¿åˆ›å»º<code>SessionFactory</code>çš„ç±»ã€‚</p>
<p>æ³¨æ„åˆ°ä¸Šé¢åˆ›å»º<code>LocalSessionFactoryBean</code>çš„ä»£ç ï¼Œé¦–å…ˆç”¨<code>Properties</code>æŒæœ‰Hibernateåˆå§‹åŒ–<code>SessionFactory</code>æ—¶ç”¨åˆ°çš„æ‰€æœ‰è®¾ç½®ï¼Œå¸¸ç”¨çš„è®¾ç½®è¯·å‚è€ƒ<a href="https://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/Hibernate_User_Guide.html#configurations">Hibernateæ–‡æ¡£</a>ï¼Œè¿™é‡Œæˆ‘ä»¬åªå®šä¹‰äº†3ä¸ªè®¾ç½®ï¼š</p>
<ul>
<li><code>hibernate.hbm2ddl.auto=update</code>ï¼šè¡¨ç¤ºè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“çš„è¡¨ç»“æ„ï¼Œæ³¨æ„ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨ï¼›</li>
<li><code>hibernate.dialect=org.hibernate.dialect.HSQLDialect</code>ï¼šæŒ‡ç¤ºHibernateä½¿ç”¨çš„æ•°æ®åº“æ˜¯HSQLDBã€‚Hibernateä½¿ç”¨ä¸€ç§HQLçš„æŸ¥è¯¢è¯­å¥ï¼Œå®ƒå’ŒSQLç±»ä¼¼ï¼Œä½†çœŸæ­£åœ¨â€œç¿»è¯‘â€æˆSQLæ—¶ï¼Œä¼šæ ¹æ®è®¾å®šçš„æ•°æ®åº“â€œæ–¹è¨€â€æ¥ç”Ÿæˆé’ˆå¯¹æ•°æ®åº“ä¼˜åŒ–çš„SQLï¼›</li>
<li><code>hibernate.show_sql=true</code>ï¼šè®©Hibernateæ‰“å°æ‰§è¡Œçš„SQLï¼Œè¿™å¯¹äºè°ƒè¯•éå¸¸æœ‰ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°çœ‹åˆ°Hibernateç”Ÿæˆçš„SQLè¯­å¥æ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚</li>
</ul>
<p>é™¤äº†è®¾ç½®<code>DataSource</code>å’Œ<code>Properties</code>ä¹‹å¤–ï¼Œæ³¨æ„åˆ°<code>setPackagesToScan()</code>æˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ª<code>package</code>åç§°ï¼Œå®ƒæŒ‡ç¤ºHibernateæ‰«æè¿™ä¸ªåŒ…ä¸‹é¢çš„æ‰€æœ‰Javaç±»ï¼Œè‡ªåŠ¨æ‰¾å‡ºèƒ½æ˜ å°„ä¸ºæ•°æ®åº“è¡¨è®°å½•çš„JavaBeanã€‚åé¢æˆ‘ä»¬ä¼šä»”ç»†è®¨è®ºå¦‚ä½•ç¼–å†™ç¬¦åˆHibernateè¦æ±‚çš„JavaBeanã€‚</p>
<p>ç´§æ¥ç€ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»º<code>HibernateTransactionManager</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    PlatformTransactionManager createTxManager(@Autowired SessionFactory sessionFactory) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> HibernateTransactionManager(sessionFactory);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>HibernateTransactionManager</code>æ˜¯é…åˆHibernateä½¿ç”¨å£°æ˜å¼äº‹åŠ¡æ‰€å¿…é¡»çš„ã€‚åˆ°æ­¤ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„é…ç½®éƒ½å®šä¹‰å®Œæ¯•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å°†æ•°æ®åº“è¡¨ç»“æ„æ˜ å°„ä¸ºJavaå¯¹è±¡ã€‚</p>
<p>è€ƒå¯Ÿå¦‚ä¸‹çš„æ•°æ®åº“è¡¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> <span style="color:#fff;font-weight:bold">user</span>
</span></span><span style="display:flex;"><span>    id <span style="color:#fff;font-weight:bold">BIGINT</span> <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span> AUTO_INCREMENT,
</span></span><span style="display:flex;"><span>    email <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>    password <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>    name <span style="color:#fff;font-weight:bold">VARCHAR</span>(<span style="color:#ff0;font-weight:bold">100</span>) <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>    createdAt <span style="color:#fff;font-weight:bold">BIGINT</span> <span style="color:#fff;font-weight:bold">NOT</span> <span style="color:#fff;font-weight:bold">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`),
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">UNIQUE</span> <span style="color:#fff;font-weight:bold">KEY</span> `email` (`email`)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œ<code>id</code>æ˜¯è‡ªå¢ä¸»é”®ï¼Œ<code>email</code>ã€<code>password</code>ã€<code>name</code>æ˜¯<code>VARCHAR</code>ç±»å‹ï¼Œ<code>email</code>å¸¦å”¯ä¸€ç´¢å¼•ä»¥ç¡®ä¿å”¯ä¸€æ€§ï¼Œ<code>createdAt</code>å­˜å‚¨æ•´å‹ç±»å‹çš„æ—¶é—´æˆ³ã€‚ç”¨JavaBeanè¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Long id;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String email;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String password;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Long createdAt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// getters and setters</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ˜ å°„å…³ç³»ååˆ†æ˜“æ‡‚ï¼Œä½†æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£æ¥å‘Šè¯‰Hibernateå¦‚ä½•æŠŠ<code>User</code>ç±»æ˜ å°„åˆ°è¡¨è®°å½•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Entity
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>    @Id
</span></span><span style="display:flex;"><span>    @GeneratedValue(strategy = GenerationType.<span style="color:#007f7f">IDENTITY</span>)
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, updatable = <span style="color:#fff;font-weight:bold">false</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Long getId() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, unique = <span style="color:#fff;font-weight:bold">true</span>, length = 100)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getEmail() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, length = 100)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getPassword() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, length = 100)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getName() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, updatable = <span style="color:#fff;font-weight:bold">false</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Long getCreatedAt() { ... }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä¸€ä¸ªJavaBeanè¢«ç”¨äºæ˜ å°„ï¼Œæˆ‘ä»¬å°±æ ‡è®°ä¸€ä¸ª<code>@Entity</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜ å°„çš„è¡¨åæ˜¯<code>user</code>ï¼Œå¦‚æœå®é™…çš„è¡¨åä¸åŒï¼Œä¾‹å¦‚å®é™…è¡¨åæ˜¯<code>users</code>ï¼Œå¯ä»¥è¿½åŠ ä¸€ä¸ª<code>@Table(name=&quot;users&quot;)</code>è¡¨ç¤ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Entity
</span></span><span style="display:flex;"><span>@Table(name=<span style="color:#0ff;font-weight:bold">&#34;users&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¯ä¸ªå±æ€§åˆ°æ•°æ®åº“åˆ—çš„æ˜ å°„ç”¨<code>@Column()</code>æ ‡è¯†ï¼Œ<code>nullable</code>æŒ‡ç¤ºåˆ—æ˜¯å¦å…è®¸ä¸º<code>NULL</code>ï¼Œ<code>updatable</code>æŒ‡ç¤ºè¯¥åˆ—æ˜¯å¦å…è®¸è¢«ç”¨åœ¨<code>UPDATE</code>è¯­å¥ï¼Œ<code>length</code>æŒ‡ç¤º<code>String</code>ç±»å‹çš„åˆ—çš„é•¿åº¦ï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æ˜¯<code>255</code>ï¼‰ã€‚</p>
<p>å¯¹äºä¸»é”®ï¼Œè¿˜éœ€è¦ç”¨<code>@Id</code>æ ‡è¯†ï¼Œè‡ªå¢ä¸»é”®å†è¿½åŠ ä¸€ä¸ª<code>@GeneratedValue</code>ï¼Œä»¥ä¾¿Hibernateèƒ½è¯»å–åˆ°è‡ªå¢ä¸»é”®çš„å€¼ã€‚</p>
<p>ç»†å¿ƒçš„ç«¥é‹å¯èƒ½è¿˜æ³¨æ„åˆ°ï¼Œä¸»é”®<code>id</code>å®šä¹‰çš„ç±»å‹ä¸æ˜¯<code>long</code>ï¼Œè€Œæ˜¯<code>Long</code>ã€‚è¿™æ˜¯å› ä¸ºHibernateå¦‚æœæ£€æµ‹åˆ°ä¸»é”®ä¸º<code>null</code>ï¼Œå°±ä¸ä¼šåœ¨<code>INSERT</code>è¯­å¥ä¸­æŒ‡å®šä¸»é”®çš„å€¼ï¼Œè€Œæ˜¯è¿”å›ç”±æ•°æ®åº“ç”Ÿæˆçš„è‡ªå¢å€¼ï¼Œå¦åˆ™ï¼ŒHibernateè®¤ä¸ºæˆ‘ä»¬çš„ç¨‹åºæŒ‡å®šäº†ä¸»é”®çš„å€¼ï¼Œä¼šåœ¨<code>INSERT</code>è¯­å¥ä¸­ç›´æ¥åˆ—å‡ºã€‚<code>long</code>å‹å­—æ®µæ€»æ˜¯å…·æœ‰é»˜è®¤å€¼<code>0</code>ï¼Œå› æ­¤ï¼Œæ¯æ¬¡æ’å…¥çš„ä¸»é”®å€¼æ€»æ˜¯0ï¼Œå¯¼è‡´é™¤ç¬¬ä¸€æ¬¡å¤–åç»­æ’å…¥éƒ½å°†å¤±è´¥ã€‚</p>
<p><code>createdAt</code>è™½ç„¶æ˜¯æ•´å‹ï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨<code>long</code>ï¼Œè€Œæ˜¯<code>Long</code>ï¼Œè¿™æ˜¯å› ä¸ºä½¿ç”¨åŸºæœ¬ç±»å‹ä¼šå¯¼è‡´findByExampleæŸ¥è¯¢ä¼šæ·»åŠ æ„å¤–çš„æ¡ä»¶ï¼Œè¿™é‡Œåªéœ€ç‰¢è®°ï¼Œä½œä¸ºæ˜ å°„ä½¿ç”¨çš„JavaBeanï¼Œæ‰€æœ‰å±æ€§éƒ½ä½¿ç”¨åŒ…è£…ç±»å‹è€Œä¸æ˜¯åŸºæœ¬ç±»å‹ã€‚</p>
<p>æ³¨æ„ï¼šä½¿ç”¨Hibernateæ—¶ï¼Œä¸è¦ä½¿ç”¨åŸºæœ¬ç±»å‹çš„å±æ€§ï¼Œæ€»æ˜¯ä½¿ç”¨åŒ…è£…ç±»å‹ï¼Œå¦‚Longæˆ–Integerã€‚</p>
<p>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ª<code>Book</code>ç±»ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Entity
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Book {
</span></span><span style="display:flex;"><span>    @Id
</span></span><span style="display:flex;"><span>    @GeneratedValue(strategy = GenerationType.<span style="color:#007f7f">IDENTITY</span>)
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, updatable = <span style="color:#fff;font-weight:bold">false</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Long getId() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, length = 100)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getTitle() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, updatable = <span style="color:#fff;font-weight:bold">false</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Long getCreatedAt() { ... }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä»”ç»†è§‚å¯Ÿ<code>User</code>å’Œ<code>Book</code>ï¼Œä¼šå‘ç°å®ƒä»¬å®šä¹‰çš„<code>id</code>ã€<code>createdAt</code>å±æ€§æ˜¯ä¸€æ ·çš„ï¼Œè¿™åœ¨æ•°æ®åº“è¡¨ç»“æ„çš„è®¾è®¡ä¸­å¾ˆå¸¸è§ï¼šå¯¹äºæ¯ä¸ªè¡¨ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šç»Ÿä¸€ä½¿ç”¨ä¸€ç§ä¸»é”®ç”Ÿæˆæœºåˆ¶ï¼Œå¹¶æ·»åŠ <code>createdAt</code>è¡¨ç¤ºåˆ›å»ºæ—¶é—´ï¼Œ<code>updatedAt</code>è¡¨ç¤ºä¿®æ”¹æ—¶é—´ç­‰é€šç”¨å­—æ®µã€‚</p>
<p>ä¸å¿…åœ¨<code>User</code>å’Œ<code>Book</code>ä¸­é‡å¤å®šä¹‰è¿™äº›é€šç”¨å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æåˆ°ä¸€ä¸ªæŠ½è±¡ç±»ä¸­ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@MappedSuperclass
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">abstract</span> <span style="color:#fff;font-weight:bold">class</span> AbstractEntity {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Long id;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Long createdAt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Id
</span></span><span style="display:flex;"><span>    @GeneratedValue(strategy = GenerationType.<span style="color:#007f7f">IDENTITY</span>)
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, updatable = <span style="color:#fff;font-weight:bold">false</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Long getId() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, updatable = <span style="color:#fff;font-weight:bold">false</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Long getCreatedAt() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Transient
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ZonedDateTime getCreatedDateTime() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Instant.<span style="color:#007f7f">ofEpochMilli</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">createdAt</span>).<span style="color:#007f7f">atZone</span>(ZoneId.<span style="color:#007f7f">systemDefault</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PrePersist
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> preInsert() {
</span></span><span style="display:flex;"><span>        setCreatedAt(System.<span style="color:#007f7f">currentTimeMillis</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äº<code>AbstractEntity</code>æ¥è¯´ï¼Œæˆ‘ä»¬è¦æ ‡æ³¨ä¸€ä¸ª<code>@MappedSuperclass</code>è¡¨ç¤ºå®ƒç”¨äºç»§æ‰¿ã€‚æ­¤å¤–ï¼Œæ³¨æ„åˆ°æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>@Transient</code>æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ªâ€œè™šæ‹Ÿâ€çš„å±æ€§ã€‚å› ä¸º<code>getCreatedDateTime()</code>æ˜¯è®¡ç®—å¾—å‡ºçš„å±æ€§ï¼Œè€Œä¸æ˜¯ä»æ•°æ®åº“è¡¨è¯»å‡ºçš„å€¼ï¼Œå› æ­¤å¿…é¡»è¦æ ‡æ³¨<code>@Transient</code>ï¼Œå¦åˆ™Hibernateä¼šå°è¯•ä»æ•°æ®åº“è¯»å–åä¸º<code>createdDateTime</code>è¿™ä¸ªä¸å­˜åœ¨çš„å­—æ®µä»è€Œå‡ºé”™ã€‚</p>
<p>å†æ³¨æ„åˆ°<code>@PrePersist</code>æ ‡è¯†çš„æ–¹æ³•ï¼Œå®ƒè¡¨ç¤ºåœ¨æˆ‘ä»¬å°†ä¸€ä¸ªJavaBeanæŒä¹…åŒ–åˆ°æ•°æ®åº“ä¹‹å‰ï¼ˆå³æ‰§è¡ŒINSERTè¯­å¥ï¼‰ï¼ŒHibernateä¼šå…ˆæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è‡ªåŠ¨è®¾ç½®å¥½<code>createdAt</code>å±æ€§ã€‚</p>
<p>æœ‰äº†<code>AbstractEntity</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤§å¹…ç®€åŒ–<code>User</code>å’Œ<code>Book</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Entity
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User <span style="color:#fff;font-weight:bold">extends</span> AbstractEntity {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, unique = <span style="color:#fff;font-weight:bold">true</span>, length = 100)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getEmail() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, length = 100)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getPassword() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Column(nullable = <span style="color:#fff;font-weight:bold">false</span>, length = 100)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getName() { ... }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°ä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£å‡æ¥è‡ª<code>jakarta.persistence</code>ï¼Œå®ƒæ˜¯JPAè§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚è¿™é‡Œæˆ‘ä»¬åªä»‹ç»ä½¿ç”¨æ³¨è§£çš„æ–¹å¼é…ç½®Hibernateæ˜ å°„å…³ç³»ï¼Œä¸å†ä»‹ç»ä¼ ç»Ÿçš„æ¯”è¾ƒç¹ççš„XMLé…ç½®ã€‚é€šè¿‡Springé›†æˆHibernateæ—¶ï¼Œä¹Ÿä¸å†éœ€è¦<code>hibernate.cfg.xml</code>é…ç½®æ–‡ä»¶ï¼Œç”¨ä¸€å¥è¯æ€»ç»“ï¼š</p>
<p>æç¤ºï¼šä½¿ç”¨Springé›†æˆHibernateï¼Œé…åˆJPAæ³¨è§£ï¼Œæ— éœ€ä»»ä½•é¢å¤–çš„XMLé…ç½®ã€‚</p>
<p>ç±»ä¼¼<code>User</code>ã€<code>Book</code>è¿™æ ·çš„ç”¨äºORMçš„Java Beanï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸ºEntity Beanã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœå¯¹<code>user</code>è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚å› ä¸ºä½¿ç”¨äº†Hibernateï¼Œå› æ­¤ï¼Œæˆ‘ä»¬è¦åšçš„ï¼Œå®é™…ä¸Šæ˜¯å¯¹<code>User</code>è¿™ä¸ªJavaBeanè¿›è¡Œâ€œå¢åˆ æ”¹æŸ¥â€ã€‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ª<code>UserService</code>ï¼Œæ³¨å…¥<code>SessionFactory</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    SessionFactory sessionFactory;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="insertæ“ä½œ">Insertæ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#insertæ“ä½œ">#</a></h3>
<p>è¦æŒä¹…åŒ–ä¸€ä¸ª<code>User</code>å®ä¾‹ï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨<code>persist()</code>æ–¹æ³•ã€‚ä»¥<code>register()</code>æ–¹æ³•ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User register(String email, String password, String name) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªUserå¯¹è±¡:</span>
</span></span><span style="display:flex;"><span>    User user = <span style="color:#fff;font-weight:bold">new</span> User();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®¾ç½®å¥½å„ä¸ªå±æ€§:</span>
</span></span><span style="display:flex;"><span>    user.<span style="color:#007f7f">setEmail</span>(email);
</span></span><span style="display:flex;"><span>    user.<span style="color:#007f7f">setPassword</span>(password);
</span></span><span style="display:flex;"><span>    user.<span style="color:#007f7f">setName</span>(name);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä¸è¦è®¾ç½®idï¼Œå› ä¸ºä½¿ç”¨äº†è‡ªå¢ä¸»é”®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä¿å­˜åˆ°æ•°æ®åº“:</span>
</span></span><span style="display:flex;"><span>    sessionFactory.<span style="color:#007f7f">getCurrentSession</span>().<span style="color:#007f7f">persist</span>(user);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ç°åœ¨å·²ç»è‡ªåŠ¨è·å¾—äº†id:</span>
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(user.<span style="color:#007f7f">getId</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> user;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="deleteæ“ä½œ">Deleteæ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#deleteæ“ä½œ">#</a></h3>
<p>åˆ é™¤ä¸€ä¸ª<code>User</code>ç›¸å½“äºä»è¡¨ä¸­åˆ é™¤å¯¹åº”çš„è®°å½•ã€‚æ³¨æ„Hibernateæ€»æ˜¯ç”¨<code>id</code>æ¥åˆ é™¤è®°å½•ï¼Œå› æ­¤ï¼Œè¦æ­£ç¡®è®¾ç½®<code>User</code>çš„<code>id</code>å±æ€§æ‰èƒ½æ­£å¸¸åˆ é™¤è®°å½•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> deleteUser(Long id) {
</span></span><span style="display:flex;"><span>    User user = sessionFactory.<span style="color:#007f7f">getCurrentSession</span>().<span style="color:#007f7f">byId</span>(User.<span style="color:#007f7f">class</span>).<span style="color:#007f7f">load</span>(id);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (user != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        sessionFactory.<span style="color:#007f7f">getCurrentSession</span>().<span style="color:#007f7f">remove</span>(user);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ä¸»é”®åˆ é™¤è®°å½•æ—¶ï¼Œä¸€ä¸ªå¸¸è§çš„ç”¨æ³•æ˜¯å…ˆæ ¹æ®ä¸»é”®åŠ è½½è¯¥è®°å½•ï¼Œå†åˆ é™¤ã€‚æ³¨æ„åˆ°å½“è®°å½•ä¸å­˜åœ¨æ—¶ï¼Œ<code>load()</code>è¿”å›<code>null</code>ã€‚</p>
<h3 id="updateæ“ä½œ">Updateæ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#updateæ“ä½œ">#</a></h3>
<p>æ›´æ–°è®°å½•ç›¸å½“äºå…ˆæ›´æ–°<code>User</code>çš„æŒ‡å®šå±æ€§ï¼Œç„¶åè°ƒç”¨<code>merge()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> updateUser(Long id, String name) {
</span></span><span style="display:flex;"><span>    User user = sessionFactory.<span style="color:#007f7f">getCurrentSession</span>().<span style="color:#007f7f">byId</span>(User.<span style="color:#007f7f">class</span>).<span style="color:#007f7f">load</span>(id);
</span></span><span style="display:flex;"><span>    user.<span style="color:#007f7f">setName</span>(name);
</span></span><span style="display:flex;"><span>    sessionFactory.<span style="color:#007f7f">getCurrentSession</span>().<span style="color:#007f7f">merge</span>(user);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‰é¢æˆ‘ä»¬åœ¨å®šä¹‰<code>User</code>æ—¶ï¼Œå¯¹æœ‰çš„å±æ€§æ ‡æ³¨äº†<code>@Column(updatable=false)</code>ã€‚Hibernateåœ¨æ›´æ–°è®°å½•æ—¶ï¼Œå®ƒåªä¼šæŠŠ<code>@Column(updatable=true)</code>çš„å±æ€§åŠ å…¥åˆ°<code>UPDATE</code>è¯­å¥ä¸­ï¼Œè¿™æ ·å¯ä»¥æä¾›ä¸€å±‚é¢å¤–çš„å®‰å…¨æ€§ï¼Œå³å¦‚æœä¸å°å¿ƒä¿®æ”¹äº†<code>User</code>çš„<code>email</code>ã€<code>createdAt</code>ç­‰å±æ€§ï¼Œæ‰§è¡Œ<code>update()</code>æ—¶å¹¶ä¸ä¼šæ›´æ–°å¯¹åº”çš„æ•°æ®åº“åˆ—ã€‚ä½†ä¹Ÿå¿…é¡»ç‰¢è®°ï¼šè¿™ä¸ªåŠŸèƒ½æ˜¯Hibernateæä¾›çš„ï¼Œå¦‚æœç»•è¿‡Hibernateç›´æ¥é€šè¿‡JDBCæ‰§è¡Œ<code>UPDATE</code>è¯­å¥ä»ç„¶å¯ä»¥æ›´æ–°æ•°æ®åº“çš„ä»»æ„åˆ—çš„å€¼ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬ç¼–å†™çš„å¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯å„ç§å„æ ·çš„æŸ¥è¯¢ã€‚æ ¹æ®<code>id</code>æŸ¥è¯¢æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨<code>load()</code>ï¼Œå¦‚æœè¦ä½¿ç”¨æ¡ä»¶æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">SELECT</span> * <span style="color:#fff;font-weight:bold">FROM</span> <span style="color:#fff;font-weight:bold">user</span> <span style="color:#fff;font-weight:bold">WHERE</span> email = ? <span style="color:#fff;font-weight:bold">AND</span> password = ?
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æ¥çœ‹çœ‹å¯ä»¥ä½¿ç”¨ä»€ä¹ˆæŸ¥è¯¢ã€‚</p>
<h3 id="ä½¿ç”¨hqlæŸ¥è¯¢">ä½¿ç”¨HQLæŸ¥è¯¢<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨hqlæŸ¥è¯¢">#</a></h3>
<p>ä¸€ç§å¸¸ç”¨çš„æŸ¥è¯¢æ˜¯ç›´æ¥ç¼–å†™Hibernateå†…ç½®çš„HQLæŸ¥è¯¢ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List&lt;User&gt; list = sessionFactory.<span style="color:#007f7f">getCurrentSession</span>()
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">createQuery</span>(<span style="color:#0ff;font-weight:bold">&#34;from User u where u.email = ?1 and u.password = ?2&#34;</span>, User.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">setParameter</span>(1, email).<span style="color:#007f7f">setParameter</span>(2, password)
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">list</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>å’ŒSQLç›¸æ¯”ï¼ŒHQLä½¿ç”¨ç±»åå’Œå±æ€§åï¼Œç”±Hibernateè‡ªåŠ¨è½¬æ¢ä¸ºå®é™…çš„è¡¨åå’Œåˆ—åã€‚è¯¦ç»†çš„HQLè¯­æ³•å¯ä»¥å‚è€ƒ<a href="https://docs.jboss.org/hibernate/orm/6.1/userguide/html_single/Hibernate_User_Guide.html#query-language">Hibernateæ–‡æ¡£</a>ã€‚</p>
<p>é™¤äº†å¯ä»¥ç›´æ¥ä¼ å…¥HQLå­—ç¬¦ä¸²å¤–ï¼ŒHibernateè¿˜å¯ä»¥ä½¿ç”¨ä¸€ç§<code>NamedQuery</code>ï¼Œå®ƒç»™æŸ¥è¯¢èµ·ä¸ªåå­—ï¼Œç„¶åä¿å­˜åœ¨æ³¨è§£ä¸­ã€‚ä½¿ç”¨<code>NamedQuery</code>æ—¶ï¼Œæˆ‘ä»¬è¦å…ˆåœ¨<code>User</code>ç±»æ ‡æ³¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@NamedQueries(
</span></span><span style="display:flex;"><span>    @NamedQuery(
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æŸ¥è¯¢åç§°:</span>
</span></span><span style="display:flex;"><span>        name = <span style="color:#0ff;font-weight:bold">&#34;login&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æŸ¥è¯¢è¯­å¥:</span>
</span></span><span style="display:flex;"><span>        query = <span style="color:#0ff;font-weight:bold">&#34;SELECT u FROM User u WHERE u.email = :e AND u.password = :pwd&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>@Entity
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User <span style="color:#fff;font-weight:bold">extends</span> AbstractEntity {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°å¼•å…¥çš„<code>NamedQuery</code>æ˜¯<code>jakarta.persistence.NamedQuery</code>ï¼Œå®ƒå’Œç›´æ¥ä¼ å…¥HQLæœ‰ç‚¹ä¸åŒçš„æ˜¯ï¼Œå ä½ç¬¦ä½¿ç”¨<code>:e</code>å’Œ<code>:pwd</code>ã€‚</p>
<p>ä½¿ç”¨<code>NamedQuery</code>åªéœ€è¦å¼•å…¥æŸ¥è¯¢åå’Œå‚æ•°ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User login(String email, String password) {
</span></span><span style="display:flex;"><span>    List&lt;User&gt; list = sessionFactory.<span style="color:#007f7f">getCurrentSession</span>()
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">createNamedQuery</span>(<span style="color:#0ff;font-weight:bold">&#34;login&#34;</span>, User.<span style="color:#007f7f">class</span>) <span style="color:#007f7f">// åˆ›å»ºNamedQuery</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">setParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;e&#34;</span>, email) <span style="color:#007f7f">// ç»‘å®šeå‚æ•°</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">setParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;pwd&#34;</span>, password) <span style="color:#007f7f">// ç»‘å®špwdå‚æ•°</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">list</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> list.<span style="color:#007f7f">isEmpty</span>() ? <span style="color:#fff;font-weight:bold">null</span> : list.<span style="color:#007f7f">get</span>(0);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›´æ¥å†™HQLå’Œä½¿ç”¨<code>NamedQuery</code>å„æœ‰ä¼˜åŠ£ã€‚å‰è€…å¯ä»¥åœ¨ä»£ç ä¸­ç›´è§‚åœ°çœ‹åˆ°æŸ¥è¯¢è¯­å¥ï¼Œåè€…å¯ä»¥åœ¨<code>User</code>ç±»ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç›¸å…³æŸ¥è¯¢ã€‚</p>
<h1 id="é›†æˆjpa">é›†æˆJPA<a hidden class="anchor" aria-hidden="true" href="#é›†æˆjpa">#</a></h1>
<p>ä¸Šä¸€èŠ‚æˆ‘ä»¬è®²äº†åœ¨Springä¸­é›†æˆHibernateã€‚Hibernateæ˜¯ç¬¬ä¸€ä¸ªè¢«å¹¿æ³›ä½¿ç”¨çš„ORMæ¡†æ¶ï¼Œä½†æ˜¯å¾ˆå¤šå°ä¼™ä¼´è¿˜å¬è¯´è¿‡JPAï¼šJava Persistence APIï¼Œè¿™åˆæ˜¯å•¥ï¼Ÿ</p>
<p>åœ¨è®¨è®ºJPAä¹‹å‰ï¼Œæˆ‘ä»¬è¦æ³¨æ„åˆ°JavaEEæ—©åœ¨1999å¹´å°±å‘å¸ƒäº†ï¼Œå¹¶ä¸”æœ‰Servletã€JMSç­‰è¯¸å¤šæ ‡å‡†ã€‚å’Œå…¶ä»–å¹³å°ä¸åŒï¼ŒJavaä¸–ç•Œæ—©æœŸéå¸¸çƒ­è¡·äºæ ‡å‡†å…ˆè¡Œï¼Œå„å®¶è·Ÿè¿›ï¼šå¤§å®¶å…ˆåä¸‹æ¥æŠŠæ¥å£å®šäº†ï¼Œç„¶åï¼Œå„è‡ªå›å®¶å¹²æ´»å»å®ç°æ¥å£ï¼Œè¿™æ ·ï¼Œç”¨æˆ·å°±å¯ä»¥åœ¨ä¸åŒçš„å‚å®¶æä¾›çš„äº§å“è¿›è¡Œé€‰æ‹©ï¼Œè¿˜å¯ä»¥éšæ„åˆ‡æ¢ï¼Œå› ä¸ºç”¨æˆ·ç¼–å†™ä»£ç çš„æ—¶å€™åªéœ€è¦å¼•ç”¨æ¥å£ï¼Œå¹¶ä¸éœ€è¦å¼•ç”¨å…·ä½“çš„åº•å±‚å®ç°ï¼ˆæƒ³æƒ³JDBCï¼‰ã€‚</p>
<p>JPAå°±æ˜¯JavaEEçš„ä¸€ä¸ªORMæ ‡å‡†ï¼Œå®ƒçš„å®ç°å…¶å®å’ŒHibernateæ²¡å•¥æœ¬è´¨åŒºåˆ«ï¼Œä½†æ˜¯ç”¨æˆ·å¦‚æœä½¿ç”¨JPAï¼Œé‚£ä¹ˆå¼•ç”¨çš„å°±æ˜¯<code>jakarta.persistence</code>è¿™ä¸ªâ€œæ ‡å‡†â€åŒ…ï¼Œè€Œä¸æ˜¯<code>org.hibernate</code>è¿™æ ·çš„ç¬¬ä¸‰æ–¹åŒ…ã€‚å› ä¸ºJPAåªæ˜¯æ¥å£ï¼Œæ‰€ä»¥ï¼Œè¿˜éœ€è¦é€‰æ‹©ä¸€ä¸ªå®ç°äº§å“ï¼Œè·ŸJDBCæ¥å£å’ŒMySQLé©±åŠ¨ä¸€ä¸ªé“ç†ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨JPAæ—¶ä¹Ÿå®Œå…¨å¯ä»¥é€‰æ‹©Hibernateä½œä¸ºåº•å±‚å®ç°ï¼Œä½†ä¹Ÿå¯ä»¥é€‰æ‹©å…¶å®ƒçš„JPAæä¾›æ–¹ï¼Œæ¯”å¦‚<a href="https://www.eclipse.org/eclipselink/">EclipseLink</a>ã€‚Springå†…ç½®äº†JPAçš„é›†æˆï¼Œå¹¶æ”¯æŒé€‰æ‹©Hibernateæˆ–EclipseLinkä½œä¸ºå®ç°ã€‚è¿™é‡Œæˆ‘ä»¬ä»ç„¶ä»¥ä¸»æµçš„Hibernateä½œä¸ºJPAå®ç°ä¸ºä¾‹å­ï¼Œæ¼”ç¤ºJPAçš„åŸºæœ¬ç”¨æ³•ã€‚</p>
<p>å’Œä½¿ç”¨Hibernateä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦å¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š</p>
<ul>
<li>org.springframework:spring-context:6.0.0</li>
<li>org.springframework:spring-orm:6.0.0</li>
<li>jakarta.annotation:jakarta.annotation-api:2.1.1</li>
<li>jakarta.persistence:jakarta.persistence-api:3.1.0</li>
<li>org.hibernate:hibernate-core:6.1.4.Final</li>
<li>com.zaxxer:HikariCP:5.0.1</li>
<li>org.hsqldb:hsqldb:2.7.1</li>
</ul>
<p>å®é™…ä¸Šæˆ‘ä»¬è¿™é‡Œå¼•å…¥çš„ä¾èµ–å’Œä¸Šä¸€èŠ‚é›†æˆHibernateå¼•å…¥çš„ä¾èµ–å®Œå…¨ä¸€æ ·ï¼Œå› ä¸ºHibernateæ—¢æä¾›äº†å®ƒè‡ªå·±çš„æ¥å£ï¼Œä¹Ÿæä¾›äº†JPAæ¥å£ï¼Œæˆ‘ä»¬ç”¨JPAæ¥å£å°±ç›¸å½“äºé€šè¿‡JPAæ“ä½œHibernateã€‚</p>
<p>ç„¶åï¼Œåœ¨<code>AppConfig</code>ä¸­å¯ç”¨å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œåˆ›å»º<code>DataSource</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableTransactionManagement
</span></span><span style="display:flex;"><span>@PropertySource(<span style="color:#0ff;font-weight:bold">&#34;jdbc.properties&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    DataSource createDataSource() { ... }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨Hibernateæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<code>LocalSessionFactoryBean</code>ï¼Œå¹¶è®©å®ƒå†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>SessionFactory</code>ã€‚ä½¿ç”¨JPAä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿåˆ›å»ºä¸€ä¸ª<code>LocalContainerEntityManagerFactoryBean</code>ï¼Œå¹¶è®©å®ƒå†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>EntityManagerFactory</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> LocalContainerEntityManagerFactoryBean createEntityManagerFactory(@Autowired DataSource dataSource) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">var</span> emFactory = <span style="color:#fff;font-weight:bold">new</span> LocalContainerEntityManagerFactoryBean();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ³¨å…¥DataSource:</span>
</span></span><span style="display:flex;"><span>    emFactory.<span style="color:#007f7f">setDataSource</span>(dataSource);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ‰«ææŒ‡å®šçš„packageè·å–æ‰€æœ‰entity class:</span>
</span></span><span style="display:flex;"><span>    emFactory.<span style="color:#007f7f">setPackagesToScan</span>(AbstractEntity.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">getPackageName</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä½¿ç”¨Hibernateä½œä¸ºJPAå®ç°:</span>
</span></span><span style="display:flex;"><span>    emFactory.<span style="color:#007f7f">setJpaVendorAdapter</span>(<span style="color:#fff;font-weight:bold">new</span> HibernateJpaVendorAdapter());
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å…¶ä»–é…ç½®é¡¹:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">var</span> props = <span style="color:#fff;font-weight:bold">new</span> Properties();
</span></span><span style="display:flex;"><span>    props.<span style="color:#007f7f">setProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;hibernate.hbm2ddl.auto&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;update&#34;</span>); <span style="color:#007f7f">// ç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>    props.<span style="color:#007f7f">setProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;hibernate.dialect&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;org.hibernate.dialect.HSQLDialect&#34;</span>);
</span></span><span style="display:flex;"><span>    props.<span style="color:#007f7f">setProperty</span>(<span style="color:#0ff;font-weight:bold">&#34;hibernate.show_sql&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>);
</span></span><span style="display:flex;"><span>    emFactory.<span style="color:#007f7f">setJpaProperties</span>(props);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> emFactory;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§‚å¯Ÿä¸Šè¿°ä»£ç ï¼Œé™¤äº†éœ€è¦æ³¨å…¥<code>DataSource</code>å’Œè®¾å®šè‡ªåŠ¨æ‰«æçš„<code>package</code>å¤–ï¼Œè¿˜éœ€è¦æŒ‡å®šJPAçš„æä¾›å•†ï¼Œè¿™é‡Œä½¿ç”¨Springæä¾›çš„ä¸€ä¸ª<code>HibernateJpaVendorAdapter</code>ï¼Œæœ€åï¼Œé’ˆå¯¹Hibernateè‡ªå·±éœ€è¦çš„é…ç½®ï¼Œä»¥<code>Properties</code>çš„å½¢å¼æ³¨å…¥ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª<code>JpaTransactionManager</code>ï¼Œä»¥å®ç°å£°æ˜å¼äº‹åŠ¡ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>PlatformTransactionManager createTxManager(@Autowired EntityManagerFactory entityManagerFactory) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> JpaTransactionManager(entityManagerFactory);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†JPAçš„å…¨éƒ¨åˆå§‹åŒ–å·¥ä½œã€‚æœ‰äº›ç«¥é‹å¯èƒ½ä»ç½‘ä¸Šæœç´¢å¾—çŸ¥JPAéœ€è¦<code>persistence.xml</code>é…ç½®æ–‡ä»¶ï¼Œä»¥åŠå¤æ‚çš„<code>orm.xml</code>æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬è´Ÿè´£åœ°å‘Šè¯‰å¤§å®¶ï¼Œä½¿ç”¨Spring+Hibernateä½œä¸ºJPAå®ç°ï¼Œæ— éœ€ä»»ä½•é…ç½®æ–‡ä»¶ã€‚</p>
<p>æ‰€æœ‰Entity Beançš„é…ç½®å’Œä¸Šä¸€èŠ‚å®Œå…¨ç›¸åŒï¼Œå…¨éƒ¨é‡‡ç”¨Annotationæ ‡æ³¨ã€‚æˆ‘ä»¬ç°åœ¨åªéœ€å…³å¿ƒå…·ä½“çš„ä¸šåŠ¡ç±»å¦‚ä½•é€šè¿‡JPAæ¥å£æ“ä½œæ•°æ®åº“ã€‚</p>
<p>è¿˜æ˜¯ä»¥<code>UserService</code>ä¸ºä¾‹ï¼Œé™¤äº†æ ‡æ³¨<code>@Component</code>å’Œ<code>@Transactional</code>å¤–ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å…¥ä¸€ä¸ª<code>EntityManager</code>ï¼Œä½†æ˜¯ä¸è¦ä½¿ç”¨<code>Autowired</code>ï¼Œè€Œæ˜¯<code>@PersistenceContext</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService {
</span></span><span style="display:flex;"><span>    @PersistenceContext
</span></span><span style="display:flex;"><span>    EntityManager em;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å›é¡¾ä¸€ä¸‹JDBCã€Hibernateå’ŒJPAæä¾›çš„æ¥å£ï¼Œå®é™…ä¸Šï¼Œå®ƒä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>JDBC</th>
<th>Hibernate</th>
<th>JPA</th>
</tr>
</thead>
<tbody>
<tr>
<td>DataSource</td>
<td>SessionFactory</td>
<td>EntityManagerFactory</td>
</tr>
<tr>
<td>Connection</td>
<td>Session</td>
<td>EntityManager</td>
</tr>
</tbody>
</table>
<p><code>SessionFactory</code>å’Œ<code>EntityManagerFactory</code>ç›¸å½“äº<code>DataSource</code>ï¼Œ<code>Session</code>å’Œ<code>EntityManager</code>ç›¸å½“äº<code>Connection</code>ã€‚æ¯æ¬¡éœ€è¦è®¿é—®æ•°æ®åº“çš„æ—¶å€™ï¼Œéœ€è¦è·å–æ–°çš„<code>Session</code>å’Œ<code>EntityManager</code>ï¼Œç”¨å®Œåå†å…³é—­ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ³¨æ„åˆ°<code>UserService</code>æ³¨å…¥çš„ä¸æ˜¯<code>EntityManagerFactory</code>ï¼Œè€Œæ˜¯<code>EntityManager</code>ï¼Œå¹¶ä¸”æ ‡æ³¨äº†<code>@PersistenceContext</code>ã€‚éš¾é“ä½¿ç”¨JPAå¯ä»¥å…è®¸å¤šçº¿ç¨‹æ“ä½œåŒä¸€ä¸ª<code>EntityManager</code>ï¼Ÿ</p>
<p>å®é™…ä¸Šè¿™é‡Œæ³¨å…¥çš„å¹¶ä¸æ˜¯çœŸæ­£çš„<code>EntityManager</code>ï¼Œè€Œæ˜¯ä¸€ä¸ª<code>EntityManager</code>çš„ä»£ç†ç±»ï¼Œç›¸å½“äºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> EntityManagerProxy <span style="color:#fff;font-weight:bold">implements</span> EntityManager {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> EntityManagerFactory emf;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Springé‡åˆ°æ ‡æ³¨äº†<code>@PersistenceContext</code>çš„<code>EntityManager</code>ä¼šè‡ªåŠ¨æ³¨å…¥ä»£ç†ï¼Œè¯¥ä»£ç†ä¼šåœ¨å¿…è¦çš„æ—¶å€™è‡ªåŠ¨æ‰“å¼€<code>EntityManager</code>ã€‚æ¢å¥è¯è¯´ï¼Œå¤šçº¿ç¨‹å¼•ç”¨çš„<code>EntityManager</code>è™½ç„¶æ˜¯åŒä¸€ä¸ªä»£ç†ç±»ï¼Œä½†è¯¥ä»£ç†ç±»å†…éƒ¨é’ˆå¯¹ä¸åŒçº¿ç¨‹ä¼šåˆ›å»ºä¸åŒçš„<code>EntityManager</code>å®ä¾‹ã€‚</p>
<p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œæ ‡æ³¨äº†<code>@PersistenceContext</code>çš„<code>EntityManager</code>å¯ä»¥è¢«å¤šçº¿ç¨‹å®‰å…¨åœ°å…±äº«ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨<code>UserService</code>çš„æ¯ä¸ªä¸šåŠ¡æ–¹æ³•é‡Œï¼Œç›´æ¥ä½¿ç”¨<code>EntityManager</code>å°±å¾ˆæ–¹ä¾¿ã€‚ä»¥ä¸»é”®æŸ¥è¯¢ä¸ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User getUserById(<span style="color:#fff;font-weight:bold">long</span> id) {
</span></span><span style="display:flex;"><span>    User user = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">em</span>.<span style="color:#007f7f">find</span>(User.<span style="color:#007f7f">class</span>, id);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (user == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;User not found by id: &#34;</span> + id);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> user;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸HQLæŸ¥è¯¢ç±»ä¼¼ï¼ŒJPAä½¿ç”¨JPQLæŸ¥è¯¢ï¼Œå®ƒçš„è¯­æ³•å’ŒHQLåŸºæœ¬å·®ä¸å¤šï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User fetchUserByEmail(String email) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// JPQLæŸ¥è¯¢:</span>
</span></span><span style="display:flex;"><span>    TypedQuery&lt;User&gt; query = em.<span style="color:#007f7f">createQuery</span>(<span style="color:#0ff;font-weight:bold">&#34;SELECT u FROM User u WHERE u.email = :e&#34;</span>, User.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>    query.<span style="color:#007f7f">setParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;e&#34;</span>, email);
</span></span><span style="display:flex;"><span>    List&lt;User&gt; list = query.<span style="color:#007f7f">getResultList</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (list.<span style="color:#007f7f">isEmpty</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> list.<span style="color:#007f7f">get</span>(0);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŒæ ·çš„ï¼ŒJPAä¹Ÿæ”¯æŒ<code>NamedQuery</code>ï¼Œå³å…ˆç»™æŸ¥è¯¢èµ·ä¸ªåå­—ï¼Œå†æŒ‰åå­—åˆ›å»ºæŸ¥è¯¢ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> User login(String email, String password) {
</span></span><span style="display:flex;"><span>    TypedQuery&lt;User&gt; query = em.<span style="color:#007f7f">createNamedQuery</span>(<span style="color:#0ff;font-weight:bold">&#34;login&#34;</span>, User.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>    query.<span style="color:#007f7f">setParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;e&#34;</span>, email);
</span></span><span style="display:flex;"><span>    query.<span style="color:#007f7f">setParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;pwd&#34;</span>, password);
</span></span><span style="display:flex;"><span>    List&lt;User&gt; list = query.<span style="color:#007f7f">getResultList</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> list.<span style="color:#007f7f">isEmpty</span>() ? <span style="color:#fff;font-weight:bold">null</span> : list.<span style="color:#007f7f">get</span>(0);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>NamedQuery</code>é€šè¿‡æ³¨è§£æ ‡æ³¨åœ¨<code>User</code>ç±»ä¸Šï¼Œå®ƒçš„å®šä¹‰å’Œä¸Šä¸€èŠ‚çš„<code>User</code>ç±»ä¸€æ ·ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@NamedQueries(
</span></span><span style="display:flex;"><span>    @NamedQuery(
</span></span><span style="display:flex;"><span>        name = <span style="color:#0ff;font-weight:bold">&#34;login&#34;</span>,
</span></span><span style="display:flex;"><span>        query = <span style="color:#0ff;font-weight:bold">&#34;SELECT u FROM User u WHERE u.email=:e AND u.password=:pwd&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>@Entity
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹çš„æ“ä½œï¼Œå¯ä»¥åˆ†åˆ«ä½¿ç”¨<code>persist()</code>ã€<code>remove()</code>å’Œ<code>merge()</code>æ–¹æ³•ï¼Œå‚æ•°å‡ä¸ºEntity Beanæœ¬èº«ï¼Œä½¿ç”¨éå¸¸ç®€å•ï¼Œè¿™é‡Œä¸å†å¤šè¿°ã€‚</p>
<h1 id="é›†æˆmybatis">é›†æˆMyBatis<a hidden class="anchor" aria-hidden="true" href="#é›†æˆmybatis">#</a></h1>
<p>ä½¿ç”¨Hibernateæˆ–JPAæ“ä½œæ•°æ®åº“æ—¶ï¼Œè¿™ç±»ORMå¹²çš„ä¸»è¦å·¥ä½œå°±æ˜¯æŠŠResultSetçš„æ¯ä¸€è¡Œå˜æˆJava Beanï¼Œæˆ–è€…æŠŠJava Beanè‡ªåŠ¨è½¬æ¢åˆ°INSERTæˆ–UPDATEè¯­å¥çš„å‚æ•°ä¸­ï¼Œä»è€Œå®ç°ORMã€‚</p>
<p>è€ŒORMæ¡†æ¶ä¹‹æ‰€ä»¥çŸ¥é“å¦‚ä½•æŠŠè¡Œæ•°æ®æ˜ å°„åˆ°Java Beanï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨Java Beançš„å±æ€§ä¸Šç»™äº†è¶³å¤Ÿçš„æ³¨è§£ä½œä¸ºå…ƒæ•°æ®ï¼ŒORMæ¡†æ¶è·å–Java Beançš„æ³¨è§£åï¼Œå°±çŸ¥é“å¦‚ä½•è¿›è¡ŒåŒå‘æ˜ å°„ã€‚</p>
<p>é‚£ä¹ˆï¼ŒORMæ¡†æ¶æ˜¯å¦‚ä½•è·Ÿè¸ªJava Beançš„ä¿®æ”¹ï¼Œä»¥ä¾¿åœ¨<code>update()</code>æ“ä½œä¸­æ›´æ–°å¿…è¦çš„å±æ€§ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ä½¿ç”¨<a href="https://liaoxuefeng.com/books/java/design-patterns/structural/proxy/index.html">Proxyæ¨¡å¼</a>ï¼Œä»ORMæ¡†æ¶è¯»å–çš„Userå®ä¾‹å®é™…ä¸Šå¹¶ä¸æ˜¯Userç±»ï¼Œè€Œæ˜¯ä»£ç†ç±»ï¼Œä»£ç†ç±»ç»§æ‰¿è‡ªUserç±»ï¼Œä½†é’ˆå¯¹æ¯ä¸ªsetteræ–¹æ³•åšäº†è¦†å†™ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserProxy <span style="color:#fff;font-weight:bold">extends</span> User {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> _isNameChanged;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setName(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>.<span style="color:#007f7f">setName</span>(name);
</span></span><span style="display:flex;"><span>        _isNameChanged = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œä»£ç†ç±»å¯ä»¥è·Ÿè¸ªåˆ°æ¯ä¸ªå±æ€§çš„å˜åŒ–ã€‚</p>
<p>é’ˆå¯¹ä¸€å¯¹å¤šæˆ–å¤šå¯¹ä¸€å…³ç³»æ—¶ï¼Œä»£ç†ç±»å¯ä»¥ç›´æ¥é€šè¿‡getteræ–¹æ³•æŸ¥è¯¢æ•°æ®åº“ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserProxy <span style="color:#fff;font-weight:bold">extends</span> User {
</span></span><span style="display:flex;"><span>    Session _session;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> _isNameChanged;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setName(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>.<span style="color:#007f7f">setName</span>(name);
</span></span><span style="display:flex;"><span>        _isNameChanged = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * è·å–Userå¯¹è±¡å…³è”çš„Addresså¯¹è±¡:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Address getAddress() {
</span></span><span style="display:flex;"><span>        Query q = _session.<span style="color:#007f7f">createQuery</span>(<span style="color:#0ff;font-weight:bold">&#34;from Address where userId = :userId&#34;</span>);
</span></span><span style="display:flex;"><span>        q.<span style="color:#007f7f">setParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;userId&#34;</span>, <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getId</span>());
</span></span><span style="display:flex;"><span>        List&lt;Address&gt; list = query.<span style="color:#007f7f">list</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> list.<span style="color:#007f7f">isEmpty</span>() ? <span style="color:#fff;font-weight:bold">null</span> : list(0);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†å®ç°è¿™æ ·çš„æŸ¥è¯¢ï¼ŒUserProxyå¿…é¡»ä¿å­˜Hibernateçš„å½“å‰Sessionã€‚ä½†æ˜¯ï¼Œå½“äº‹åŠ¡æäº¤åï¼ŒSessionè‡ªåŠ¨å…³é—­ï¼Œæ­¤æ—¶å†è·å–<code>getAddress()</code>å°†æ— æ³•è®¿é—®æ•°æ®åº“ï¼Œæˆ–è€…è·å–çš„ä¸æ˜¯äº‹åŠ¡ä¸€è‡´çš„æ•°æ®ã€‚å› æ­¤ï¼ŒORMæ¡†æ¶æ€»æ˜¯å¼•å…¥äº†Attached/DetachedçŠ¶æ€ï¼Œè¡¨ç¤ºå½“å‰æ­¤Java Beanåˆ°åº•æ˜¯åœ¨Sessionçš„èŒƒå›´å†…ï¼Œè¿˜æ˜¯è„±ç¦»äº†Sessionå˜æˆäº†ä¸€ä¸ªâ€œæ¸¸ç¦»â€å¯¹è±¡ã€‚å¾ˆå¤šåˆå­¦è€…æ— æ³•æ­£ç¡®ç†è§£çŠ¶æ€å˜åŒ–å’Œäº‹åŠ¡è¾¹ç•Œï¼Œå°±ä¼šé€ æˆå¤§é‡çš„<code>PersistentObjectException</code>å¼‚å¸¸ã€‚è¿™ç§éšå¼çŠ¶æ€ä½¿å¾—æ™®é€šJava Beançš„ç”Ÿå‘½å‘¨æœŸå˜å¾—å¤æ‚ã€‚</p>
<p>æ­¤å¤–ï¼ŒHibernateå’ŒJPAä¸ºäº†å®ç°å…¼å®¹å¤šç§æ•°æ®åº“ï¼Œå®ƒä½¿ç”¨HQLæˆ–JPQLæŸ¥è¯¢ï¼Œç»è¿‡ä¸€é“è½¬æ¢ï¼Œå˜æˆç‰¹å®šæ•°æ®åº“çš„SQLï¼Œç†è®ºä¸Šè¿™æ ·å¯ä»¥åšåˆ°æ— ç¼åˆ‡æ¢æ•°æ®åº“ï¼Œä½†è¿™ä¸€å±‚è‡ªåŠ¨è½¬æ¢é™¤äº†å°‘è®¸çš„æ€§èƒ½å¼€é”€å¤–ï¼Œç»™SQLçº§åˆ«çš„ä¼˜åŒ–å¸¦æ¥äº†éº»çƒ¦ã€‚</p>
<p>æœ€åï¼ŒORMæ¡†æ¶é€šå¸¸æä¾›äº†ç¼“å­˜ï¼Œå¹¶ä¸”è¿˜åˆ†ä¸ºä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ã€‚ä¸€çº§ç¼“å­˜æ˜¯æŒ‡åœ¨ä¸€ä¸ªSessionèŒƒå›´å†…çš„ç¼“å­˜ï¼Œå¸¸è§çš„æƒ…æ™¯æ˜¯æ ¹æ®ä¸»é”®æŸ¥è¯¢æ—¶ï¼Œä¸¤æ¬¡æŸ¥è¯¢å¯ä»¥è¿”å›åŒä¸€å®ä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>User user1 = session.<span style="color:#007f7f">load</span>(User.<span style="color:#007f7f">class</span>, 123);
</span></span><span style="display:flex;"><span>User user2 = session.<span style="color:#007f7f">load</span>(User.<span style="color:#007f7f">class</span>, 123);
</span></span></code></pre></td></tr></table>
</div>
</div><p>äºŒçº§ç¼“å­˜æ˜¯æŒ‡è·¨Sessionçš„ç¼“å­˜ï¼Œä¸€èˆ¬é»˜è®¤å…³é—­ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚äºŒçº§ç¼“å­˜æå¤§çš„å¢åŠ äº†æ•°æ®çš„ä¸ä¸€è‡´æ€§ï¼ŒåŸå› åœ¨äºSQLéå¸¸çµæ´»ï¼Œå¸¸å¸¸ä¼šå¯¼è‡´æ„å¤–çš„æ›´æ–°ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// çº¿ç¨‹1è¯»å–:</span>
</span></span><span style="display:flex;"><span>User user1 = session1.<span style="color:#007f7f">load</span>(User.<span style="color:#007f7f">class</span>, 123);
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä¸€æ®µæ—¶é—´åï¼Œçº¿ç¨‹2è¯»å–:</span>
</span></span><span style="display:flex;"><span>User user2 = session2.<span style="color:#007f7f">load</span>(User.<span style="color:#007f7f">class</span>, 123);
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“äºŒçº§ç¼“å­˜ç”Ÿæ•ˆçš„æ—¶å€™ï¼Œä¸¤ä¸ªçº¿ç¨‹è¯»å–çš„Userå®ä¾‹æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ï¼Œæ•°æ®åº“å¯¹åº”çš„è¡Œè®°å½•å®Œå…¨å¯èƒ½è¢«ä¿®æ”¹ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#007f7f">-- ç»™è€ç”¨æˆ·å¢åŠ 100ç§¯åˆ†:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">UPDATE</span> users <span style="color:#fff;font-weight:bold">SET</span> bonus = bonus + <span style="color:#ff0;font-weight:bold">100</span> <span style="color:#fff;font-weight:bold">WHERE</span> createdAt &lt;= ?
</span></span></code></pre></td></tr></table>
</div>
</div><p>ORMæ— æ³•åˆ¤æ–­<code>id=123</code>çš„ç”¨æˆ·æ˜¯å¦å—è¯¥<code>UPDATE</code>è¯­å¥å½±å“ã€‚è€ƒè™‘åˆ°æ•°æ®åº“é€šå¸¸ä¼šæ”¯æŒå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œæ­¤UPDATEè¯­å¥å¯èƒ½ç”±å…¶ä»–è¿›ç¨‹æ‰§è¡Œï¼ŒORMæ¡†æ¶å°±æ›´ä¸çŸ¥é“äº†ã€‚</p>
<p>æˆ‘ä»¬æŠŠè¿™ç§ORMæ¡†æ¶ç§°ä¹‹ä¸ºå…¨è‡ªåŠ¨ORMæ¡†æ¶ã€‚</p>
<p>å¯¹æ¯”Springæä¾›çš„JdbcTemplateï¼Œå®ƒå’ŒORMæ¡†æ¶ç›¸æ¯”ï¼Œä¸»è¦æœ‰å‡ ç‚¹å·®åˆ«ï¼š</p>
<ol>
<li>æŸ¥è¯¢åéœ€è¦æ‰‹åŠ¨æä¾›Mapperå®ä¾‹ä»¥ä¾¿æŠŠResultSetçš„æ¯ä¸€è¡Œå˜ä¸ºJavaå¯¹è±¡ï¼›</li>
<li>å¢åˆ æ”¹æ“ä½œæ‰€éœ€çš„å‚æ•°åˆ—è¡¨ï¼Œéœ€è¦æ‰‹åŠ¨ä¼ å…¥ï¼Œå³æŠŠUserå®ä¾‹å˜ä¸º[user.id, user.name, user.email]è¿™æ ·çš„åˆ—è¡¨ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚</li>
</ol>
<p>ä½†æ˜¯JdbcTemplateçš„ä¼˜åŠ¿åœ¨äºå®ƒçš„ç¡®å®šæ€§ï¼šå³æ¯æ¬¡è¯»å–æ“ä½œä¸€å®šæ˜¯æ•°æ®åº“æ“ä½œè€Œä¸æ˜¯ç¼“å­˜ï¼Œæ‰€æ‰§è¡Œçš„SQLæ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œç¼ºç‚¹å°±æ˜¯ä»£ç æ¯”è¾ƒç¹çï¼Œæ„é€ <code>INSERT INTO users VALUES (?,?,?)</code>æ›´æ˜¯å¤æ‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œä»‹äºå…¨è‡ªåŠ¨ORMå¦‚Hibernateå’Œæ‰‹å†™å…¨éƒ¨å¦‚JdbcTemplateä¹‹é—´ï¼Œè¿˜æœ‰ä¸€ç§åŠè‡ªåŠ¨çš„ORMï¼Œå®ƒåªè´Ÿè´£æŠŠResultSetè‡ªåŠ¨æ˜ å°„åˆ°Java Beanï¼Œæˆ–è€…è‡ªåŠ¨å¡«å……Java Beanå‚æ•°ï¼Œä½†ä»éœ€è‡ªå·±å†™å‡ºSQLã€‚<a href="https://mybatis.org/">MyBatis</a>å°±æ˜¯è¿™æ ·ä¸€ç§åŠè‡ªåŠ¨åŒ–ORMæ¡†æ¶ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨Springä¸­é›†æˆMyBatisã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å¼•å…¥MyBatisæœ¬èº«ï¼Œå…¶æ¬¡ï¼Œç”±äºSpringå¹¶æ²¡æœ‰åƒHibernateé‚£æ ·å†…ç½®å¯¹MyBatisçš„é›†æˆï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å†å¼•å…¥MyBatiså®˜æ–¹è‡ªå·±å¼€å‘çš„ä¸€ä¸ªä¸Springé›†æˆçš„åº“ï¼š</p>
<ul>
<li>org.mybatis:mybatis:3.5.11</li>
<li>org.mybatis:mybatis-spring:3.0.0</li>
</ul>
<p>å’Œå‰é¢ä¸€æ ·ï¼Œå…ˆåˆ›å»º<code>DataSource</code>æ˜¯å¿…ä¸å¯å°‘çš„ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableTransactionManagement
</span></span><span style="display:flex;"><span>@PropertySource(<span style="color:#0ff;font-weight:bold">&#34;jdbc.properties&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    DataSource createDataSource() { ... }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†å›é¡¾ä¸€ä¸‹Hibernateå’ŒJPAçš„<code>SessionFactory</code>ä¸<code>EntityManagerFactory</code>ï¼ŒMyBatisä¸ä¹‹å¯¹åº”çš„æ˜¯<code>SqlSessionFactory</code>å’Œ<code>SqlSession</code>ï¼š</p>
<table>
<thead>
<tr>
<th>JDBC</th>
<th>Hibernate</th>
<th>JPA</th>
<th>MyBatis</th>
</tr>
</thead>
<tbody>
<tr>
<td>DataSource</td>
<td>SessionFactory</td>
<td>EntityManagerFactory</td>
<td>SqlSessionFactory</td>
</tr>
<tr>
<td>Connection</td>
<td>Session</td>
<td>EntityManager</td>
<td>SqlSession</td>
</tr>
</tbody>
</table>
<p>å¯è§ï¼ŒORMçš„è®¾è®¡å¥—è·¯éƒ½æ˜¯ç±»ä¼¼çš„ã€‚ä½¿ç”¨MyBatisçš„æ ¸å¿ƒå°±æ˜¯åˆ›å»º<code>SqlSessionFactory</code>ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ›å»ºçš„æ˜¯<code>SqlSessionFactoryBean</code>ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>SqlSessionFactoryBean createSqlSessionFactoryBean(@Autowired DataSource dataSource) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">var</span> sqlSessionFactoryBean = <span style="color:#fff;font-weight:bold">new</span> SqlSessionFactoryBean();
</span></span><span style="display:flex;"><span>    sqlSessionFactoryBean.<span style="color:#007f7f">setDataSource</span>(dataSource);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> sqlSessionFactoryBean;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºMyBatiså¯ä»¥ç›´æ¥ä½¿ç”¨Springç®¡ç†çš„å£°æ˜å¼äº‹åŠ¡ï¼Œå› æ­¤ï¼Œåˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨å’Œä½¿ç”¨JDBCæ˜¯ä¸€æ ·çš„ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>PlatformTransactionManager createTxManager(@Autowired DataSource dataSource) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> DataSourceTransactionManager(dataSource);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å’ŒHibernateä¸åŒçš„æ˜¯ï¼ŒMyBatisä½¿ç”¨Mapperæ¥å®ç°æ˜ å°„ï¼Œè€Œä¸”Mapperå¿…é¡»æ˜¯æ¥å£ã€‚æˆ‘ä»¬ä»¥<code>User</code>ç±»ä¸ºä¾‹ï¼Œåœ¨<code>User</code>ç±»å’Œ<code>users</code>è¡¨ä¹‹é—´æ˜ å°„çš„<code>UserMapper</code>ç¼–å†™å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> UserMapper {
</span></span><span style="display:flex;"><span>	@Select(<span style="color:#0ff;font-weight:bold">&#34;SELECT * FROM users WHERE id = #{id}&#34;</span>)
</span></span><span style="display:flex;"><span>	User getById(@Param(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>) <span style="color:#fff;font-weight:bold">long</span> id);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼šè¿™é‡Œçš„Mapperä¸æ˜¯<code>JdbcTemplate</code>çš„<code>RowMapper</code>çš„æ¦‚å¿µï¼Œå®ƒæ˜¯å®šä¹‰è®¿é—®<code>users</code>è¡¨çš„æ¥å£æ–¹æ³•ã€‚æ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>User getById(long)</code>çš„ä¸»é”®æŸ¥è¯¢æ–¹æ³•ï¼Œä¸ä»…è¦å®šä¹‰æ¥å£æ–¹æ³•æœ¬èº«ï¼Œè¿˜è¦æ˜ç¡®å†™å‡ºæŸ¥è¯¢çš„SQLï¼Œè¿™é‡Œç”¨æ³¨è§£<code>@Select</code>æ ‡è®°ã€‚SQLè¯­å¥çš„ä»»ä½•å‚æ•°ï¼Œéƒ½ä¸æ–¹æ³•å‚æ•°æŒ‰åç§°å¯¹åº”ã€‚ä¾‹å¦‚ï¼Œæ–¹æ³•å‚æ•°idçš„åå­—é€šè¿‡æ³¨è§£<code>@Param()</code>æ ‡è®°ä¸º<code>id</code>ï¼Œåˆ™SQLè¯­å¥é‡Œå°†æ¥æ›¿æ¢çš„å ä½ç¬¦å°±æ˜¯<code>#{id}</code>ã€‚</p>
<p>å¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ¯ä¸ªå‚æ•°å‘½ååç›´æ¥åœ¨SQLä¸­å†™å‡ºå¯¹åº”çš„å ä½ç¬¦å³å¯ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Select(<span style="color:#0ff;font-weight:bold">&#34;SELECT * FROM users LIMIT #{offset}, #{maxResults}&#34;</span>)
</span></span><span style="display:flex;"><span>List&lt;User&gt; getAll(@Param(<span style="color:#0ff;font-weight:bold">&#34;offset&#34;</span>) <span style="color:#fff;font-weight:bold">int</span> offset, @Param(<span style="color:#0ff;font-weight:bold">&#34;maxResults&#34;</span>) <span style="color:#fff;font-weight:bold">int</span> maxResults);
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼šMyBatisæ‰§è¡ŒæŸ¥è¯¢åï¼Œå°†æ ¹æ®æ–¹æ³•çš„è¿”å›ç±»å‹è‡ªåŠ¨æŠŠResultSetçš„æ¯ä¸€è¡Œè½¬æ¢ä¸ºUserå®ä¾‹ï¼Œè½¬æ¢è§„åˆ™å½“ç„¶æ˜¯æŒ‰åˆ—åå’Œå±æ€§åå¯¹åº”ã€‚å¦‚æœåˆ—åå’Œå±æ€§åä¸åŒï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ç¼–å†™SELECTè¯­å¥çš„åˆ«åï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#007f7f">-- åˆ—åæ˜¯created_timeï¼Œå±æ€§åæ˜¯createdAt:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">SELECT</span> id, name, email, created_time <span style="color:#fff;font-weight:bold">AS</span> createdAt <span style="color:#fff;font-weight:bold">FROM</span> users
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡ŒINSERTè¯­å¥å°±ç¨å¾®éº»çƒ¦ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›ä¼ å…¥Userå®ä¾‹ï¼Œå› æ­¤ï¼Œå®šä¹‰çš„æ–¹æ³•æ¥å£ä¸<code>@Insert</code>æ³¨è§£å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Insert(<span style="color:#0ff;font-weight:bold">&#34;INSERT INTO users (email, password, name, createdAt) VALUES (#{user.email}, #{user.password}, #{user.name}, #{user.createdAt})&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> insert(@Param(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>) User user);
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°æ–¹æ³•ä¼ å…¥çš„å‚æ•°åç§°æ˜¯<code>user</code>ï¼Œå‚æ•°ç±»å‹æ˜¯Userç±»ï¼Œåœ¨SQLä¸­å¼•ç”¨çš„æ—¶å€™ï¼Œä»¥<code>#{obj.property}</code>çš„æ–¹å¼å†™å ä½ç¬¦ã€‚å’ŒHibernateè¿™æ ·çš„å…¨è‡ªåŠ¨åŒ–ORMç›¸æ¯”ï¼ŒMyBatiså¿…é¡»å†™å‡ºå®Œæ•´çš„INSERTè¯­å¥ã€‚</p>
<p>å¦‚æœ<code>users</code>è¡¨çš„<code>id</code>æ˜¯è‡ªå¢ä¸»é”®ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬åœ¨SQLä¸­ä¸ä¼ å…¥<code>id</code>ï¼Œä½†å¸Œæœ›è·å–æ’å…¥åçš„ä¸»é”®ï¼Œéœ€è¦å†åŠ ä¸€ä¸ª<code>@Options</code>æ³¨è§£ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Options(useGeneratedKeys = <span style="color:#fff;font-weight:bold">true</span>, keyProperty = <span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>, keyColumn = <span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span>@Insert(<span style="color:#0ff;font-weight:bold">&#34;INSERT INTO users (email, password, name, createdAt) VALUES (#{user.email}, #{user.password}, #{user.name}, #{user.createdAt})&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> insert(@Param(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>) User user);
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>keyProperty</code>å’Œ<code>keyColumn</code>åˆ†åˆ«æŒ‡å‡ºJavaBeançš„å±æ€§å’Œæ•°æ®åº“çš„ä¸»é”®åˆ—åã€‚</p>
<p>æ‰§è¡Œ<code>UPDATE</code>å’Œ<code>DELETE</code>è¯­å¥ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å®šä¹‰æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Update(<span style="color:#0ff;font-weight:bold">&#34;UPDATE users SET name = #{user.name}, createdAt = #{user.createdAt} WHERE id = #{user.id}&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> update(@Param(<span style="color:#0ff;font-weight:bold">&#34;user&#34;</span>) User user);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Delete(<span style="color:#0ff;font-weight:bold">&#34;DELETE FROM users WHERE id = #{id}&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> deleteById(@Param(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>) <span style="color:#fff;font-weight:bold">long</span> id);
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†<code>UserMapper</code>æ¥å£ï¼Œè¿˜éœ€è¦å¯¹åº”çš„å®ç°ç±»æ‰èƒ½çœŸæ­£æ‰§è¡Œè¿™äº›æ•°æ®åº“æ“ä½œçš„æ–¹æ³•ã€‚è™½ç„¶å¯ä»¥è‡ªå·±å†™å®ç°ç±»ï¼Œä½†æˆ‘ä»¬é™¤äº†ç¼–å†™<code>UserMapper</code>æ¥å£å¤–ï¼Œè¿˜æœ‰<code>BookMapper</code>ã€<code>BonusMapper</code>â€¦â€¦ä¸€ä¸ªä¸€ä¸ªå†™å¤ªéº»çƒ¦ï¼Œå› æ­¤ï¼ŒMyBatisæä¾›äº†ä¸€ä¸ª<code>MapperFactoryBean</code>æ¥è‡ªåŠ¨åˆ›å»ºæ‰€æœ‰Mapperçš„å®ç°ç±»ã€‚å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„æ³¨è§£æ¥å¯ç”¨å®ƒï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@MapperScan(<span style="color:#0ff;font-weight:bold">&#34;com.itranswarp.learnjava.mapper&#34;</span>)
</span></span><span style="display:flex;"><span>...<span style="color:#007f7f">å…¶ä»–æ³¨è§£</span>...
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†<code>@MapperScan</code>ï¼Œå°±å¯ä»¥è®©MyBatisè‡ªåŠ¨æ‰«ææŒ‡å®šåŒ…çš„æ‰€æœ‰Mapperå¹¶åˆ›å»ºå®ç°ç±»ã€‚åœ¨çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³¨å…¥ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ³¨å…¥UserMapper:</span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    UserMapper userMapper;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User getUserById(<span style="color:#fff;font-weight:bold">long</span> id) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è°ƒç”¨Mapperæ–¹æ³•:</span>
</span></span><span style="display:flex;"><span>        User user = userMapper.<span style="color:#007f7f">getById</span>(id);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (user == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;User not found by id.&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> user;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯è§ï¼Œä¸šåŠ¡é€»è¾‘ä¸»è¦å°±æ˜¯é€šè¿‡<code>XxxMapper</code>å®šä¹‰çš„æ•°æ®åº“æ–¹æ³•æ¥è®¿é—®æ•°æ®åº“ã€‚</p>
<h3 id="xmlé…ç½®">XMLé…ç½®<a hidden class="anchor" aria-hidden="true" href="#xmlé…ç½®">#</a></h3>
<p>ä¸Šè¿°åœ¨Springä¸­é›†æˆMyBatisçš„æ–¹å¼ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨åˆ°æ³¨è§£ï¼Œå¹¶æ²¡æœ‰ä»»ä½•XMLé…ç½®æ–‡ä»¶ã€‚MyBatisä¹Ÿå…è®¸ä½¿ç”¨XMLé…ç½®æ˜ å°„å…³ç³»å’ŒSQLè¯­å¥ï¼Œä¾‹å¦‚ï¼Œæ›´æ–°<code>User</code>æ—¶æ ¹æ®å±æ€§å€¼æ„é€ åŠ¨æ€SQLï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;update</span> <span style="color:#007f7f">id=</span><span style="color:#0ff;font-weight:bold">&#34;updateUser&#34;</span><span style="font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  UPDATE users SET
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;set&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;if</span> <span style="color:#007f7f">test=</span><span style="color:#0ff;font-weight:bold">&#34;user.name != null&#34;</span><span style="font-weight:bold">&gt;</span> name = #{user.name} <span style="font-weight:bold">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;if</span> <span style="color:#007f7f">test=</span><span style="color:#0ff;font-weight:bold">&#34;user.hobby != null&#34;</span><span style="font-weight:bold">&gt;</span> hobby = #{user.hobby} <span style="font-weight:bold">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;if</span> <span style="color:#007f7f">test=</span><span style="color:#0ff;font-weight:bold">&#34;user.summary != null&#34;</span><span style="font-weight:bold">&gt;</span> summary = #{user.summary} <span style="font-weight:bold">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;/set&gt;</span>
</span></span><span style="display:flex;"><span>  WHERE id = #{user.id}
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/update&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–å†™XMLé…ç½®çš„ä¼˜ç‚¹æ˜¯å¯ä»¥ç»„è£…å‡ºåŠ¨æ€SQLï¼Œå¹¶ä¸”æŠŠæ‰€æœ‰SQLæ“ä½œé›†ä¸­åœ¨ä¸€èµ·ã€‚ç¼ºç‚¹æ˜¯é…ç½®èµ·æ¥å¤ªç¹çï¼Œè°ƒç”¨æ–¹æ³•æ—¶å¦‚æœæƒ³æŸ¥çœ‹SQLè¿˜éœ€è¦å®šä½åˆ°XMLé…ç½®ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬ä¸ä»‹ç»XMLçš„é…ç½®æ–¹å¼ï¼Œéœ€è¦äº†è§£çš„ç«¥é‹è¯·è‡ªè¡Œé˜…è¯»<a href="https://mybatis.org/mybatis-3/zh/configuration.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>ä½¿ç”¨MyBatisæœ€å¤§çš„é—®é¢˜æ˜¯æ‰€æœ‰SQLéƒ½éœ€è¦å…¨éƒ¨æ‰‹å†™ï¼Œä¼˜ç‚¹æ˜¯æ‰§è¡Œçš„SQLå°±æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„SQLï¼Œå¯¹SQLè¿›è¡Œä¼˜åŒ–éå¸¸ç®€å•ï¼Œä¹Ÿå¯ä»¥ç¼–å†™ä»»æ„å¤æ‚çš„SQLï¼Œæˆ–è€…ä½¿ç”¨æ•°æ®åº“çš„ç‰¹å®šè¯­æ³•ï¼Œä½†åˆ‡æ¢æ•°æ®åº“å¯èƒ½å°±ä¸å¤ªå®¹æ˜“ã€‚å¥½æ¶ˆæ¯æ˜¯å¤§éƒ¨åˆ†é¡¹ç›®å¹¶æ²¡æœ‰åˆ‡æ¢æ•°æ®åº“çš„éœ€æ±‚ï¼Œå®Œå…¨å¯ä»¥é’ˆå¯¹æŸä¸ªæ•°æ®åº“ç¼–å†™å°½å¯èƒ½ä¼˜åŒ–çš„SQLã€‚</p>
<h1 id="è®¾è®¡orm">è®¾è®¡ORM<a hidden class="anchor" aria-hidden="true" href="#è®¾è®¡orm">#</a></h1>
<p>æˆ‘ä»¬ä»å‰å‡ èŠ‚å¯ä»¥çœ‹åˆ°ï¼Œæ‰€è°“ORMï¼Œä¹Ÿæ˜¯å»ºç«‹åœ¨JDBCçš„åŸºç¡€ä¸Šï¼Œé€šè¿‡ResultSetåˆ°JavaBeançš„æ˜ å°„ï¼Œå®ç°å„ç§æŸ¥è¯¢ã€‚æœ‰è‡ªåŠ¨è·Ÿè¸ªEntityä¿®æ”¹çš„å…¨è‡ªåŠ¨åŒ–ORMå¦‚Hibernateå’ŒJPAï¼Œéœ€è¦ä¸ºæ¯ä¸ªEntityåˆ›å»ºä»£ç†ï¼Œä¹Ÿæœ‰å®Œå…¨è‡ªå·±æ˜ å°„ï¼Œè¿INSERTå’ŒUPDATEè¯­å¥éƒ½éœ€è¦æ‰‹åŠ¨ç¼–å†™çš„MyBatisï¼Œä½†æ²¡æœ‰ä»»ä½•é€æ˜çš„Proxyã€‚</p>
<p>è€ŒæŸ¥è¯¢æ˜¯æ¶‰åŠåˆ°æ•°æ®åº“ä½¿ç”¨æœ€å¹¿æ³›çš„æ“ä½œï¼Œéœ€è¦æœ€å¤§çš„çµæ´»æ€§ã€‚å„ç§ORMè§£å†³æ–¹æ¡ˆå„ä¸ç›¸åŒï¼ŒHibernateå’ŒJPAè‡ªå·±å®ç°äº†HQLå’ŒJPQLæŸ¥è¯¢è¯­æ³•ï¼Œç”¨ä»¥ç”Ÿæˆæœ€ç»ˆçš„SQLï¼Œè€ŒMyBatisåˆ™å®Œå…¨æ‰‹å†™ï¼Œæ¯å¢åŠ ä¸€ä¸ªæŸ¥è¯¢éƒ½éœ€è¦å…ˆç¼–å†™SQLå¹¶å¢åŠ æ¥å£æ–¹æ³•ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§Hibernateå’ŒJPAæ”¯æŒçš„CriteriaæŸ¥è¯¢ï¼Œç”¨Hibernateå†™å‡ºæ¥ç±»ä¼¼ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>DetachedCriteria criteria = DetachedCriteria.<span style="color:#007f7f">forClass</span>(User.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>criteria.<span style="color:#007f7f">add</span>(Restrictions.<span style="color:#007f7f">eq</span>(<span style="color:#0ff;font-weight:bold">&#34;email&#34;</span>, email))
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">add</span>(Restrictions.<span style="color:#007f7f">eq</span>(<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span>, password));
</span></span><span style="display:flex;"><span>List&lt;User&gt; list = (List&lt;User&gt;) hibernateTemplate.<span style="color:#007f7f">findByCriteria</span>(criteria);
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°CriteriaæŸ¥è¯¢å†™æ³•å¤æ‚ï¼Œä½†å’ŒJPAç›¸æ¯”ï¼Œè¿˜æ˜¯å°å·«è§å¤§å·«äº†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">var</span> cb = em.<span style="color:#007f7f">getCriteriaBuilder</span>();
</span></span><span style="display:flex;"><span>CriteriaQuery&lt;User&gt; q = cb.<span style="color:#007f7f">createQuery</span>(User.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>Root&lt;User&gt; r = q.<span style="color:#007f7f">from</span>(User.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>q.<span style="color:#007f7f">where</span>(cb.<span style="color:#007f7f">equal</span>(r.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;email&#34;</span>), cb.<span style="color:#007f7f">parameter</span>(String.<span style="color:#007f7f">class</span>, <span style="color:#0ff;font-weight:bold">&#34;e&#34;</span>)));
</span></span><span style="display:flex;"><span>TypedQuery&lt;User&gt; query = em.<span style="color:#007f7f">createQuery</span>(q);
</span></span><span style="display:flex;"><span>query.<span style="color:#007f7f">setParameter</span>(<span style="color:#0ff;font-weight:bold">&#34;e&#34;</span>, email);
</span></span><span style="display:flex;"><span>List&lt;User&gt; list = query.<span style="color:#007f7f">getResultList</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤–ï¼Œæ˜¯å¦æ”¯æŒè‡ªåŠ¨è¯»å–ä¸€å¯¹å¤šå’Œå¤šå¯¹ä¸€å…³ç³»ä¹Ÿæ˜¯å…¨è‡ªåŠ¨åŒ–ORMæ¡†æ¶çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è‡ªå·±æ¥è®¾è®¡å¹¶å®ç°ä¸€ä¸ªORMï¼Œåº”è¯¥å¸å–è¿™äº›ORMçš„å“ªäº›ç‰¹è‰²ï¼Œç„¶åé«˜æ•ˆå®ç°å‘¢ï¼Ÿ</p>
<h3 id="è®¾è®¡ormæ¥å£">è®¾è®¡ORMæ¥å£<a hidden class="anchor" aria-hidden="true" href="#è®¾è®¡ormæ¥å£">#</a></h3>
<p>ä»»ä½•è®¾è®¡ï¼Œéƒ½å¿…é¡»æ˜ç¡®è®¾è®¡ç›®æ ‡ã€‚è¿™é‡Œæˆ‘ä»¬å‡†å¤‡å®ç°çš„ORMå¹¶ä¸æƒ³è¦å…¨è‡ªåŠ¨ORMé‚£ç§è‡ªåŠ¨è¯»å–ä¸€å¯¹å¤šå’Œå¤šå¯¹ä¸€å…³ç³»çš„åŠŸèƒ½ï¼Œä¹Ÿä¸æƒ³ç»™EntityåŠ ä¸Šå¤æ‚çš„çŠ¶æ€ï¼Œå› æ­¤ï¼Œå¯¹äºEntityæ¥è¯´ï¼Œå®ƒå°±æ˜¯çº¯ç²¹çš„JavaBeanï¼Œæ²¡æœ‰ä»»ä½•Proxyã€‚</p>
<p>æ­¤å¤–ï¼ŒORMè¦å…¼é¡¾æ˜“ç”¨æ€§å’Œé€‚ç”¨æ€§ã€‚æ˜“ç”¨æ€§æ˜¯æŒ‡èƒ½è¦†ç›–95%çš„åº”ç”¨åœºæ™¯ï¼Œä½†æ€»æœ‰ä¸€äº›å¤æ‚çš„SQLï¼Œå¾ˆéš¾ç”¨ORMå»è‡ªåŠ¨ç”Ÿæˆï¼Œå› æ­¤ï¼Œä¹Ÿè¦ç»™å‡ºåŸç”Ÿçš„JDBCæ¥å£ï¼Œèƒ½æ”¯æŒ5%çš„ç‰¹æ®Šéœ€æ±‚ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å¸Œæœ›è®¾è®¡çš„æ¥å£è¦æ˜“äºç¼–å†™ï¼Œå¹¶ä½¿ç”¨æµå¼APIä¾¿äºé˜…è¯»ã€‚ä¸ºäº†é…åˆç¼–è¯‘å™¨æ£€æŸ¥ï¼Œè¿˜åº”è¯¥æ”¯æŒæ³›å‹ï¼Œé¿å…å¼ºåˆ¶è½¬å‹ã€‚</p>
<p>ä»¥Userç±»ä¸ºä¾‹ï¼Œæˆ‘ä»¬è®¾è®¡çš„æŸ¥è¯¢æ¥å£å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// æŒ‰ä¸»é”®æŸ¥è¯¢: SELECT * FROM users WHERE id = ?</span>
</span></span><span style="display:flex;"><span>User u = db.<span style="color:#007f7f">get</span>(User.<span style="color:#007f7f">class</span>, 123);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ¡ä»¶æŸ¥è¯¢å”¯ä¸€è®°å½•: SELECT * FROM users WHERE email = ? AND password = ?</span>
</span></span><span style="display:flex;"><span>User u = db.<span style="color:#007f7f">from</span>(User.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>           .<span style="color:#007f7f">where</span>(<span style="color:#0ff;font-weight:bold">&#34;email=? AND password=?&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;bob@example.com&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;bob123&#34;</span>)
</span></span><span style="display:flex;"><span>           .<span style="color:#007f7f">unique</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ¡ä»¶æŸ¥è¯¢å¤šæ¡è®°å½•: SELECT * FROM users WHERE id &lt; ? ORDER BY email LIMIT ?, ?</span>
</span></span><span style="display:flex;"><span>List&lt;User&gt; us = db.<span style="color:#007f7f">from</span>(User.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>                  .<span style="color:#007f7f">where</span>(<span style="color:#0ff;font-weight:bold">&#34;id &lt; ?&#34;</span>, 1000)
</span></span><span style="display:flex;"><span>                  .<span style="color:#007f7f">orderBy</span>(<span style="color:#0ff;font-weight:bold">&#34;email&#34;</span>)
</span></span><span style="display:flex;"><span>                  .<span style="color:#007f7f">limit</span>(0, 10)
</span></span><span style="display:flex;"><span>                  .<span style="color:#007f7f">list</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æŸ¥è¯¢ç‰¹å®šåˆ—: SELECT id, name FROM users WHERE email = ?</span>
</span></span><span style="display:flex;"><span>User u = db.<span style="color:#007f7f">select</span>(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>)
</span></span><span style="display:flex;"><span>           .<span style="color:#007f7f">from</span>(User.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>           .<span style="color:#007f7f">where</span>(<span style="color:#0ff;font-weight:bold">&#34;email = ?&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;bob@example.com&#34;</span>)
</span></span><span style="display:flex;"><span>           .<span style="color:#007f7f">unique</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·çš„æµå¼APIä¾¿äºé˜…è¯»ï¼Œä¹Ÿéå¸¸å®¹æ˜“æ¨å¯¼å‡ºæœ€ç»ˆç”Ÿæˆçš„SQLã€‚</p>
<p>å¯¹äºæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œå°±ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// æ’å…¥User:</span>
</span></span><span style="display:flex;"><span>db.<span style="color:#007f7f">insert</span>(user);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æŒ‰ä¸»é”®æ›´æ–°æ›´æ–°User:</span>
</span></span><span style="display:flex;"><span>db.<span style="color:#007f7f">update</span>(user);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æŒ‰ä¸»é”®åˆ é™¤User:</span>
</span></span><span style="display:flex;"><span>db.<span style="color:#007f7f">delete</span>(User.<span style="color:#007f7f">class</span>, 123);
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºEntityæ¥è¯´ï¼Œé€šå¸¸ä¸€ä¸ªè¡¨å¯¹åº”ä¸€ä¸ªã€‚æ‰‹åŠ¨åˆ—å‡ºæ‰€æœ‰Entityæ˜¯éå¸¸éº»çƒ¦çš„ï¼Œä¸€å®šè¦ä¼ å…¥packageè‡ªåŠ¨æ‰«æã€‚</p>
<p>æœ€åï¼ŒORMæ€»æ˜¯éœ€è¦å…ƒæ•°æ®æ‰èƒ½çŸ¥é“å¦‚ä½•æ˜ å°„ã€‚æˆ‘ä»¬ä¸æƒ³ç¼–å†™å¤æ‚çš„XMLé…ç½®ï¼Œä¹Ÿæ²¡å¿…è¦è‡ªå·±å»å®šä¹‰ä¸€å¥—è§„åˆ™ï¼Œç›´æ¥ä½¿ç”¨JPAçš„æ³¨è§£å°±è¡Œã€‚</p>
<h3 id="å®ç°orm">å®ç°ORM<a hidden class="anchor" aria-hidden="true" href="#å®ç°orm">#</a></h3>
<p>æˆ‘ä»¬å¹¶ä¸éœ€è¦ä»JDBCåº•å±‚å¼€å§‹ç¼–å†™ï¼Œå¹¶ä¸”ï¼Œè¿˜è¦è€ƒè™‘åˆ°äº‹åŠ¡ï¼Œæœ€å¥½èƒ½ç›´æ¥ä½¿ç”¨Springçš„å£°æ˜å¼äº‹åŠ¡ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªå…¨å±€<code>DbTemplate</code>ï¼Œå®ƒæ³¨å…¥äº†Springçš„<code>JdbcTemplate</code>ï¼Œæ¶‰åŠåˆ°æ•°æ®åº“æ“ä½œæ—¶ï¼Œå…¨éƒ¨é€šè¿‡<code>JdbcTemplate</code>å®Œæˆï¼Œè‡ªç„¶å¤©ç”Ÿæ”¯æŒSpringçš„å£°æ˜å¼äº‹åŠ¡ï¼Œå› ä¸ºè¿™ä¸ªORMåªæ˜¯åœ¨<code>JdbcTemplate</code>çš„åŸºç¡€ä¸Šåšäº†ä¸€å±‚å°è£…ã€‚</p>
<p>åœ¨<code>AppConfig</code>ä¸­ï¼Œæˆ‘ä»¬åˆå§‹åŒ–æ‰€æœ‰Beanå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableTransactionManagement
</span></span><span style="display:flex;"><span>@PropertySource(<span style="color:#0ff;font-weight:bold">&#34;jdbc.properties&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AppConfig {
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    DataSource createDataSource() { ... }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    JdbcTemplate createJdbcTemplate(@Autowired DataSource dataSource) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> JdbcTemplate(dataSource);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    DbTemplate createDbTemplate(@Autowired JdbcTemplate jdbcTemplate) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> DbTemplate(jdbcTemplate, <span style="color:#0ff;font-weight:bold">&#34;com.itranswarp.learnjava.entity&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    PlatformTransactionManager createTxManager(@Autowired DataSource dataSource) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> DataSourceTransactionManager(dataSource);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬æ‰€éœ€çš„æ‰€æœ‰é…ç½®ã€‚</p>
<p>ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚<code>UserService</code>ï¼Œå†™å‡ºæ¥åƒè¿™æ ·ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span>@Transactional
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserService {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    DbTemplate db;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User getUserById(<span style="color:#fff;font-weight:bold">long</span> id) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> db.<span style="color:#007f7f">get</span>(User.<span style="color:#007f7f">class</span>, id);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User getUserByEmail(String email) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> db.<span style="color:#007f7f">from</span>(User.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">where</span>(<span style="color:#0ff;font-weight:bold">&#34;email = ?&#34;</span>, email)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">unique</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> List&lt;User&gt; getUsers(<span style="color:#fff;font-weight:bold">int</span> pageIndex) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> pageSize = 100;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> db.<span style="color:#007f7f">from</span>(User.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">orderBy</span>(<span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">limit</span>((pageIndex - 1) * pageSize, pageSize)
</span></span><span style="display:flex;"><span>                 .<span style="color:#007f7f">list</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User register(String email, String password, String name) {
</span></span><span style="display:flex;"><span>        User user = <span style="color:#fff;font-weight:bold">new</span> User();
</span></span><span style="display:flex;"><span>        user.<span style="color:#007f7f">setEmail</span>(email);
</span></span><span style="display:flex;"><span>        user.<span style="color:#007f7f">setPassword</span>(password);
</span></span><span style="display:flex;"><span>        user.<span style="color:#007f7f">setName</span>(name);
</span></span><span style="display:flex;"><span>        user.<span style="color:#007f7f">setCreatedAt</span>(System.<span style="color:#007f7f">currentTimeMillis</span>());
</span></span><span style="display:flex;"><span>        db.<span style="color:#007f7f">insert</span>(user);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> user;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç ç»™å‡ºäº†ORMçš„æ¥å£ï¼Œä»¥åŠå¦‚ä½•åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ä½¿ç”¨ORMã€‚ä¸‹ä¸€æ­¥ï¼Œå°±æ˜¯å¦‚ä½•å®ç°è¿™ä¸ª<code>DbTemplate</code>ã€‚è¿™é‡Œæˆ‘ä»¬åªç»™å‡ºæ¡†æ¶ä»£ç ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥è‡ªå·±å®ç°æ ¸å¿ƒä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DbTemplate {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> JdbcTemplate jdbcTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä¿å­˜Entity Classåˆ°Mapperçš„æ˜ å°„:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Map&lt;Class&lt;?&gt;, Mapper&lt;?&gt;&gt; classMapping;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; T fetch(Class&lt;T&gt; clazz, Object id) {
</span></span><span style="display:flex;"><span>        Mapper&lt;T&gt; mapper = getMapper(clazz);
</span></span><span style="display:flex;"><span>        List&lt;T&gt; list = (List&lt;T&gt;) jdbcTemplate.<span style="color:#007f7f">query</span>(mapper.<span style="color:#007f7f">selectSQL</span>, <span style="color:#fff;font-weight:bold">new</span> Object[] { id }, mapper.<span style="color:#007f7f">rowMapper</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (list.<span style="color:#007f7f">isEmpty</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> list.<span style="color:#007f7f">get</span>(0);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; T get(Class&lt;T&gt; clazz, Object id) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; <span style="color:#fff;font-weight:bold">void</span> insert(T bean) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; <span style="color:#fff;font-weight:bold">void</span> update(T bean) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; <span style="color:#fff;font-weight:bold">void</span> delete(Class&lt;T&gt; clazz, Object id) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ç°é“¾å¼APIçš„æ ¸å¿ƒä»£ç æ˜¯ç¬¬ä¸€æ­¥ä»<code>DbTemplate</code>è°ƒç”¨<code>select()</code>æˆ–<code>from()</code>æ—¶å®ä¾‹åŒ–ä¸€ä¸ª<code>CriteriaQuery</code>å®ä¾‹ï¼Œå¹¶åœ¨åç»­çš„é“¾å¼è°ƒç”¨ä¸­è®¾ç½®å®ƒçš„å­—æ®µï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DbTemplate {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Select select(String... selectFields) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Select(<span style="color:#fff;font-weight:bold">new</span> Criteria(<span style="color:#fff;font-weight:bold">this</span>), selectFields);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; From&lt;T&gt; from(Class&lt;T&gt; entityClass) {
</span></span><span style="display:flex;"><span>        Mapper&lt;T&gt; mapper = getMapper(entityClass);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> From&lt;&gt;(<span style="color:#fff;font-weight:bold">new</span> Criteria&lt;&gt;(<span style="color:#fff;font-weight:bold">this</span>), mapper);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åä»¥æ­¤å®šä¹‰<code>Select</code>ã€<code>From</code>ã€<code>Where</code>ã€<code>OrderBy</code>ã€<code>Limit</code>ç­‰ã€‚åœ¨<code>From</code>ä¸­å¯ä»¥è®¾ç½®Classç±»å‹ã€è¡¨åç­‰ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">class</span> From&lt;T&gt; <span style="color:#fff;font-weight:bold">extends</span> CriteriaQuery&lt;T&gt; {
</span></span><span style="display:flex;"><span>    From(Criteria&lt;T&gt; criteria, Mapper&lt;T&gt; mapper) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(criteria);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// fromå¯ä»¥è®¾ç½®classã€tableName:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">criteria</span>.<span style="color:#007f7f">mapper</span> = mapper;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">criteria</span>.<span style="color:#007f7f">clazz</span> = mapper.<span style="color:#007f7f">entityClass</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">criteria</span>.<span style="color:#007f7f">table</span> = mapper.<span style="color:#007f7f">tableName</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Where&lt;T&gt; where(String clause, Object... args) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Where&lt;&gt;(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">criteria</span>, clause, args);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>Where</code>ä¸­å¯ä»¥è®¾ç½®æ¡ä»¶å‚æ•°ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">class</span> Where&lt;T&gt; <span style="color:#fff;font-weight:bold">extends</span> CriteriaQuery&lt;T&gt; {
</span></span><span style="display:flex;"><span>    Where(Criteria&lt;T&gt; criteria, String clause, Object... params) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(criteria);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">criteria</span>.<span style="color:#007f7f">where</span> = clause;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">criteria</span>.<span style="color:#007f7f">whereParams</span> = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// add:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (Object param : params) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">criteria</span>.<span style="color:#007f7f">whereParams</span>.<span style="color:#007f7f">add</span>(param);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œé“¾å¼è°ƒç”¨çš„å°½å¤´æ˜¯è°ƒç”¨<code>list()</code>è¿”å›ä¸€ç»„ç»“æœï¼Œè°ƒç”¨<code>unique()</code>è¿”å›å”¯ä¸€ç»“æœï¼Œè°ƒç”¨<code>first()</code>è¿”å›é¦–ä¸ªç»“æœã€‚</p>
<p>åœ¨IDEä¸­ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å®ç°é“¾å¼è°ƒç”¨ï¼š
<img alt="db" loading="lazy" src="https://liaoxuefeng.com/books/java/spring/database/orm/db.gif"></p>
<p>éœ€è¦å¤æ‚æŸ¥è¯¢çš„æ—¶å€™ï¼Œæ€»æ˜¯å¯ä»¥ä½¿ç”¨<code>JdbcTemplate</code>æ‰§è¡Œä»»æ„å¤æ‚çš„SQLã€‚</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/spring/">Spring</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>