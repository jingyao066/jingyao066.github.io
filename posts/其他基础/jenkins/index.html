<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Jenkins | Wjy&#39;s Blog</title>
<meta name="keywords" content="å…¶ä»–åŸºç¡€">
<meta name="description" content="ç®€ä»‹
Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨éƒ¨ç½²æœåŠ¡å™¨ï¼Œæä¾›äº†ä¸Šç™¾ä¸ªæ’ä»¶ç”¨äºè‡ªåŠ¨æ„å»ºã€éƒ¨ç½²ã€å‘å¸ƒä»»æ„é¡¹ç›®ã€‚æœ¬æ–‡æè¿°çš„æ˜¯Jenkinsæœ¬åœ°éƒ¨ç½²ä»¥åŠè¿œç¨‹éƒ¨ç½²ç­‰åŠŸèƒ½çš„å®ç°ã€‚
è¿™æ˜¯jenkinsä¸­æ–‡ç½‘">
<meta name="author" content="">
<link rel="canonical" href="https://funny-toffee-4aa7c3.netlify.app/posts/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/jenkins/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://funny-toffee-4aa7c3.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://funny-toffee-4aa7c3.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://funny-toffee-4aa7c3.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://funny-toffee-4aa7c3.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://funny-toffee-4aa7c3.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Jenkins" />
<meta property="og:description" content="ç®€ä»‹
Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨éƒ¨ç½²æœåŠ¡å™¨ï¼Œæä¾›äº†ä¸Šç™¾ä¸ªæ’ä»¶ç”¨äºè‡ªåŠ¨æ„å»ºã€éƒ¨ç½²ã€å‘å¸ƒä»»æ„é¡¹ç›®ã€‚æœ¬æ–‡æè¿°çš„æ˜¯Jenkinsæœ¬åœ°éƒ¨ç½²ä»¥åŠè¿œç¨‹éƒ¨ç½²ç­‰åŠŸèƒ½çš„å®ç°ã€‚
è¿™æ˜¯jenkinsä¸­æ–‡ç½‘" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://funny-toffee-4aa7c3.netlify.app/posts/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/jenkins/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-11-09T16:54:53+00:00" />
<meta property="article:modified_time" content="2018-11-09T16:54:53+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Jenkins"/>
<meta name="twitter:description" content="ç®€ä»‹
Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨éƒ¨ç½²æœåŠ¡å™¨ï¼Œæä¾›äº†ä¸Šç™¾ä¸ªæ’ä»¶ç”¨äºè‡ªåŠ¨æ„å»ºã€éƒ¨ç½²ã€å‘å¸ƒä»»æ„é¡¹ç›®ã€‚æœ¬æ–‡æè¿°çš„æ˜¯Jenkinsæœ¬åœ°éƒ¨ç½²ä»¥åŠè¿œç¨‹éƒ¨ç½²ç­‰åŠŸèƒ½çš„å®ç°ã€‚
è¿™æ˜¯jenkinsä¸­æ–‡ç½‘"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Jenkins",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/jenkins/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Jenkins",
  "name": "Jenkins",
  "description": "ç®€ä»‹ Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨éƒ¨ç½²æœåŠ¡å™¨ï¼Œæä¾›äº†ä¸Šç™¾ä¸ªæ’ä»¶ç”¨äºè‡ªåŠ¨æ„å»ºã€éƒ¨ç½²ã€å‘å¸ƒä»»æ„é¡¹ç›®ã€‚æœ¬æ–‡æè¿°çš„æ˜¯Jenkinsæœ¬åœ°éƒ¨ç½²ä»¥åŠè¿œç¨‹éƒ¨ç½²ç­‰åŠŸèƒ½çš„å®ç°ã€‚ è¿™æ˜¯jenkinsä¸­æ–‡ç½‘\n",
  "keywords": [
    "å…¶ä»–åŸºç¡€"
  ],
  "articleBody": "ç®€ä»‹ Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨éƒ¨ç½²æœåŠ¡å™¨ï¼Œæä¾›äº†ä¸Šç™¾ä¸ªæ’ä»¶ç”¨äºè‡ªåŠ¨æ„å»ºã€éƒ¨ç½²ã€å‘å¸ƒä»»æ„é¡¹ç›®ã€‚æœ¬æ–‡æè¿°çš„æ˜¯Jenkinsæœ¬åœ°éƒ¨ç½²ä»¥åŠè¿œç¨‹éƒ¨ç½²ç­‰åŠŸèƒ½çš„å®ç°ã€‚ è¿™æ˜¯jenkinsä¸­æ–‡ç½‘\nå®‰è£…éƒ¨ç½² Jenkinsä¸»è¦æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼Œyumå®‰è£…ã€ä½¿ç”¨å®˜æ–¹dockeré•œåƒå’Œå®˜æ–¹waråŒ…ï¼Œæ”¾åˆ°tomcatä¸­ç›´æ¥è¿è¡Œã€‚æˆ‘ä»¬é‡‡ç”¨æ¯”è¾ƒç†Ÿæ‚‰çš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œå³å°†Jenkinséƒ¨ç½²åœ¨Tomcatå®¹å™¨ä¸­ï¼Œæ— éœ€ä»»ä½•é…ç½®ï¼Œç›´æ¥å¯åŠ¨tomcatå³å¯ã€‚\nå®‰è£…tomcatå’Œjdkè¿™é‡Œä¸å†èµ˜è¿°ã€‚ å®˜ç½‘ä¸‹è½½ å·¦ä¾§åˆ—è¡¨æ˜¯ç¨³å®šç‰ˆï¼Œå³ä¾§æ˜¯å¼€å‘ç‰ˆï¼Œè¿™é‡Œæˆ‘ä»¬ä¸‹è½½å·¦ä¾§åˆ—è¡¨çš„ç¨³å®šç‰ˆã€‚æ‰¾åˆ°é€‚åˆè‡ªå·±ç³»ç»Ÿçš„ç‰ˆæœ¬ä¸‹è½½ï¼Œè¿™é‡Œæˆ‘ä¸‹è½½Generic Java package (.war)ï¼Œé€šç”¨çš„java-waråŒ…ã€‚ ä¸‹è½½å¹¶ä¸Šä¼ åˆ°tomcatçš„webappsç›®å½•ä¸‹ï¼Œå°†waråŒ…æ›´åä¸ºROOT.warï¼Œç„¶åå¯åŠ¨tomcatï¼Œ./startup.sh\næˆ–è€…é€šè¿‡wgetç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½ï¼š\n1 sudo wget https://get.jenkins.io/war-stable/2.319.3/jenkins.war æ³¨æ„æ›´æ¢æœ€æ–°ç‰ˆæœ¬ã€‚\ndockerç‰ˆçš„Jenkins è¦ä½¿ç”¨dockeré•œåƒï¼Œé¦–å…ˆå®‰è£…dockerï¼Œæœ¬æ–‡é»˜è®¤å·²ç»å®‰è£…dockerã€‚æˆ‘ä»¬å¯ä»¥åˆ°Jenkinså®˜ç½‘å¯»æ‰¾dockeré•œåƒåœ°å€ã€‚ æ³¨æ„ï¼šå®˜æ–¹jenkinsé•œåƒæœ¬èº«è‡ªå¸¦openjdkã€‚ æ‰¾åˆ°Download jenkins xxx forä¸‹è¾¹çš„dockerï¼Œç‚¹å‡»åä¼šè·³è½¬åˆ°docker hubï¼Œè¯¥ç½‘ç«™æ˜¯dockerçš„å®˜æ–¹é•œåƒä»“åº“ï¼Œå°±åƒgithubæ˜¯ä»£ç ä»“åº“ä¸€ä¸ªé“ç†ã€‚\nç½‘é¡µå³ä¾§å¯ä»¥çœ‹åˆ°Jenkinsçš„dockerä¸‹è½½å‘½ä»¤ï¼š docker pull jenkins/jenkins\nç­‰å¾…ä¸‹è½½å®Œæˆï¼Œè¾“å…¥å‘½ä»¤æŸ¥çœ‹ä¸‹è½½å®Œæˆçš„é•œåƒï¼š docker images\nå¯ä»¥çœ‹åˆ°jenkinså·²ç»è¢«ä¸‹è½½åˆ°æœåŠ¡å™¨ã€‚é•œåƒä¸‹è½½å®Œæˆï¼Œä¸‹é¢å°±è¦å¼€å§‹å¯åŠ¨å®¹å™¨äº†ã€‚ å¯åŠ¨å®¹å™¨å‰ï¼Œå»ºè®®å¤§å®¶ä»”ç»†é˜…è¯»å‰é¢å¯»æ‰¾é•œåƒæ—¶Docker Hubä¸Šå…³äºjenkinsé•œåƒçš„è¯¦ç»†è¯´æ˜ã€‚ å¯åŠ¨ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨å®¿ä¸»æœºåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä¸€ä¼šæ–¹ä¾¿é•œåƒæŒ‚è½½ã€‚ mkdir /home/jenkins è¿˜è¦ç»™åˆ›å»ºçš„ç›®å½•èµ‹äºˆæƒé™ï¼Œè¿™ä¸€æ­¥æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™å¯åŠ¨é•œåƒä¼šæŠ¥é”™ï¼š chmod 777 /home/jenkins åœ¨é•œåƒæ–‡æ¡£é‡Œï¼Œæˆ‘ä»¬çŸ¥é“Jenkinsè®¿é—®çš„é»˜è®¤ç«¯å£å·æ˜¯8080ï¼Œè¿™é‡Œæˆ‘æ”¹æˆ9999ï¼Œå¦å¤–è¿˜éœ€è¦æš´éœ²ä¸€ä¸ªtcpçš„ç«¯å£å·50000ã€‚æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨Jenkinsé•œåƒã€‚\n1 2 3 4 5 6 docker run --name jenkins -d \\ -v /usr/local/src:/share \\ -v /home/jenkins:/var/jenkins_home \\ -v /etc/localtime:/etc/localtime \\ -p 9999:8080 -p 50000:50000 \\ jenkins è¿™é‡Œé€æ¡è§£é‡Šä¸‹å„å‚æ•°çš„æ„ä¹‰ã€‚\n-dåå°è¿è¡Œé•œåƒ -p 9999:8080 å°†é•œåƒçš„8080ç«¯å£æ˜ å°„åˆ°æœåŠ¡å™¨çš„9999ç«¯å£ -p 50000:50000 å°†é•œåƒçš„50000ç«¯å£æ˜ å°„åˆ°æœåŠ¡å™¨çš„50000ç«¯å£ -v /usr/local/src:/share å°†/usr/local/srcç›®å½•ä½œä¸ºå…±äº«æ–‡ä»¶å¤¹ï¼Œæ–¹ä¾¿å‘dockerå®¹å™¨ä¸­ä¼ è¾“å®‰è£…åŒ…ç­‰ã€‚ -v /home/jenkins:/var/jenkins_home /var/jenkins_homeç›®å½•ä¸ºjenkinså·¥ä½œç›®å½•ï¼Œæˆ‘ä»¬å°†ç¡¬ç›˜ä¸Šçš„ä¸€ä¸ªç›®å½•æŒ‚è½½åˆ°è¿™ä¸ªä½ç½®ï¼Œæ–¹ä¾¿åç»­æ›´æ–°é•œåƒåç»§ç»­ä½¿ç”¨åŸæ¥çš„å·¥ä½œç›®å½•ã€‚ -v /etc/localtime:/etc/localtime è®©å®¹å™¨ä½¿ç”¨å’ŒæœåŠ¡å™¨åŒæ ·çš„æ—¶é—´è®¾ç½®ã€‚ --name jenkins ç»™å®¹å™¨èµ·ä¸€ä¸ªåˆ«å jenkins æŒ‡å®šä¸€ä¸ªé•œåƒï¼Œè¿™ä¸ªå¿…é¡»ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå»ºè®®ç›´æ¥å¡«å†™IMAGEï¼Œå°±æ˜¯ç±»ä¼¼f32b4bb22e4dï¼Œè€Œä¸æ˜¯åå­—ï¼Œå¦åˆ™ä¼šå»é‡æ–°ä¸‹è½½é•œåƒã€‚ æ³¨æ„ï¼šå¦‚æœä½ éœ€è¦æ˜ å°„å¤šä¸ªç«¯å£æˆ–æŒ‚è½½å¤šä¸ªç›®å½•ï¼Œæœ€å¥½åœ¨å¯åŠ¨æ—¶éƒ½æŒ‡å®šå¥½ï¼Œä¸ç„¶å®¹å™¨å¯åŠ¨åï¼Œä¿®æ”¹æ˜ å°„ç«¯å£æˆ–æŒ‚è½½ç›®å½•ä¸å¤ªæ–¹ä¾¿ï¼Œä¿®æ”¹å¯ä»¥å‚è€ƒæˆ‘çš„dockeræ–‡ç« ã€‚\nå¯åŠ¨åè¾“å…¥å‘½ä»¤docker ps -aæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼Œå¯ä»¥çœ‹åˆ°jenkinså·²æˆåŠŸå¯åŠ¨ã€‚ åœ¨æµè§ˆå™¨è¾“å…¥ip+ç«¯å£è¿›å…¥Jenkinsç™»å½•é¡µé¢ã€‚é¡µé¢ä¼šæç¤ºä½ åˆ°æœåŠ¡å™¨çš„æŒ‡å®šä½ç½®è·å–åˆå§‹åŒ–å¯†ç ã€‚ è¿›å…¥jenkinså®¹å™¨ï¼šdocker exec -it jenkins /bin/bash æŸ¥çœ‹å¯†ç ï¼šcat /var/jenkins_home/secrets/initialAdminPassword æŠŠå¯†ç å¤åˆ¶åˆ°æµè§ˆå™¨ï¼Œç„¶åå’Œæ­£å¸¸å®‰è£…æ­¥éª¤ä¸€è‡´ã€‚\næ³¨æ„ï¼Œdockerå®¹å™¨ä½¿ç”¨çš„ç¯å¢ƒï¼Œå¦‚jdkï¼Œmavenç­‰ç­‰ï¼Œéƒ½åº”è¯¥åœ¨å®¹å™¨ä¸­å•ç‹¬å®‰è£…ã€‚ä¸è¦æƒ³ç€å’Œå®¿ä¸»æœºå…±ç”¨ä¸€å¥—ç¯å¢ƒã€‚\nç”ŸæˆSSHKey è¿™é‡Œå†è¡¥å……ä¸€ç« è¯´æ˜å¦‚ä½•ç”ŸæˆSSHKeyã€‚å®¹å™¨ä»githubä¸Šé¢ä¸‹è½½ä»£ç çš„æ—¶å€™éœ€è¦ç”¨åˆ°ã€‚å› ä¸ºå’±ä»¬è¿™ä¸ªJenkinsæ˜¯åŸºäºdockerçš„ï¼Œä¸æ˜¯ç›´æ¥å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿™é‡Œæœ‰å¾ˆå¤§çš„ä¸åŒã€‚ è¦ç”Ÿæˆå®¹å™¨çš„SSHKeyï¼Œé¦–å…ˆè¦å…ˆè¿›å…¥å®¹å™¨ docker exec -it jenkins /bin/bash è¿›å…¥å®¹å™¨åç”Ÿæˆsshkey ssh-keygen -t rsa -C \"123@qq.com\" åœ¨å®¹å™¨å†…è¾“å…¥exitç¦»å¼€å®¹å™¨ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–å…¬é’¥ tail /var/lib/docker/volumes/jenkins/_data/.ssh/id_rsa.pub å‚è€ƒåœ°å€\nåç»­æ­¥éª¤ æƒ³éƒ¨ç½²javaé¡¹ç›®ï¼Œè¿˜éœ€è¦å®‰è£…Mavenå’Œjdkç¯å¢ƒã€‚ Manage Jenkins -\u003e Global Tool Configuration\né€‰æ‹©è‡ªåŠ¨å®‰è£…jdk1.8ï¼Œéœ€è¦ä½ å¡«å…¥oracleçš„è´¦å·å¯†ç ã€‚ é€‰æ‹©è‡ªåŠ¨å®‰è£…Maven é€‰æ‹©è‡ªåŠ¨å®‰è£…git å…¶ä»–å¯é€‰æ“ä½œ å·²rootæ–¹å¼è¿›å…¥å®¹å™¨ docker exec -it --user root /bin/bash\nä¹Ÿå¯ä»¥æ™®é€šè¿›å…¥ï¼Œå†åˆ‡æ¢rootï¼Œä¸è¿‡ä¹Ÿéœ€è¦æå‰å†rootç”¨æˆ·ä¸‹è®¾ç½®å¥½å¯†ç ã€‚ rootç”¨æˆ·è¿›å…¥å®¹å™¨ä¹‹åï¼Œè®¾ç½®å¯†ç ï¼š sudo passwd è¿ç»­è¾“å…¥ä¸¤æ¬¡å¯†ç å°±å¯ä»¥äº†ã€‚\nå…ˆæŸ¥çœ‹å®¹å™¨æ˜¯ä»€ä¹ˆæ“ä½œç³»ç»Ÿï¼Œç›´æ¥è¯•æŒ‡ä»¤ï¼Œyumæˆ–apt-getï¼Œå“ªä¸ªè¯´command not foundï¼Œå°±ä¸ç”¨å“ªä¸ªã€‚ å‘ç°apt-getå¯ç”¨ï¼Œé‚£ä¹ˆå¿…é¡»å…ˆå‡çº§apt-getï¼šapt-get updateï¼Œåä¹‹è¦å‡çº§yumï¼šyum update\nå®‰è£…vim apt-get install vim\nå®‰è£…sudo apt-get install sudo\nå¯é€‰æ˜¯å¦å¸è½½è‡ªå¸¦çš„openjdkï¼Œä¸å¸è½½Openjdkä¹Ÿå¯ä»¥ç›´æ¥å®‰è£…oracleçš„jdkï¼Œç„¶åä¿®æ”¹/etc/profileçš„ç¯å¢ƒå˜é‡ã€‚\nJenkinsé…ç½® è®¿é—®Jenkinsåœ°å€ï¼Œåˆæ¬¡è¿›å…¥ä¼šè¦æ±‚è¾“å…¥å¯†ç ï¼Œå¯†ç å·²ç»æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒLinuxä¸Šå­˜å‚¨å¯†ç çš„ä½ç½®ï¼š /root/.jenkins/secrets/initialAdminPassword windowsä¸‹å¯†ç çš„ä½ç½®ï¼š C:\\Users\\59923\\.jenkins\\secrets\\initialAdminPassword\næ‰¾åˆ°è¯¥æ–‡ä»¶å¤åˆ¶é‡Œé¢çš„å†…å®¹ï¼Œè¿›å…¥åˆ°åˆå§‹åŒ–é¡µé¢ï¼Œä¼šæç¤ºå®‰è£…æ’ä»¶ã€‚æˆ‘ä»¬ä¸åœ¨è¿™é‡Œå®‰è£…æ’ä»¶ï¼Œä¸è¦é€‰Install suggested plugins(å®‰è£…æ¨èæ’ä»¶)ï¼Œå› ä¸ºä¼šå®‰è£…å¾ˆå¤šæˆ‘ä»¬ç”¨ä¸åˆ°çš„æ’ä»¶ï¼Œè€Œä¸”å·¨æ…¢ã€‚ é€‰æ‹©è‡ªå®šä¹‰ï¼Œç„¶åå°†å‹¾å…¨éƒ¨å»æ‰ï¼Œç„¶åç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚æŒ‰ç…§æç¤ºè¾“å…¥å†…å®¹ï¼Œç®¡ç†å‘˜çš„ç”¨æˆ·åå¯†ç ç­‰è¦ç‰¢è®°ã€‚æœ€åç‚¹å‡»å®Œæˆï¼Œå°±è¿›å…¥åˆ°äº†jenkinsçš„æ§åˆ¶å°ã€‚é•¿æ—¶é—´æ²¡ååº”ï¼Œè¯·é‡å¯jenkinsã€‚\nå®‰è£…æ’ä»¶ è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å®‰è£…æˆ‘ä»¬éœ€è¦çš„æ’ä»¶å³å¯ã€‚\né€‰æ‹©å·¦ä¾§åˆ—è¡¨çš„Manage Jenkins ç„¶ååœ¨å³ä¾§åˆ—è¡¨æ‰¾åˆ°Manage Plugins åœ¨å³ä¾§å¯ä»¥çœ‹åˆ°ä¸Šè¾¹æœ‰å››ä¸ªé€‰é¡¹å¡ï¼Œæˆ‘ä»¬é€‰æ‹©Avaliable è¿™é‡Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸‰ä¸ªæ’ä»¶ï¼š git mavené›†æˆæ’ä»¶ï¼šMaven Integration Jenkinsè¯­è¨€æ’ä»¶ï¼ˆå¯é€‰ï¼‰ï¼šLocale è¿œç¨‹éƒ¨ç½²æ’ä»¶ï¼šPublish Over SSH ç„¶åé€‰æ‹©install without restartã€‚ å¦‚æœå®‰è£…äº†è¯­è¨€æ’ä»¶ï¼Œè¿˜é…ç½®æˆä¸­æ–‡æ‰å¯ä»¥ï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„Jenkinså›¾æ ‡è¿”å›ä¸»é¡µï¼Œå†æ¬¡è¿›å…¥Jenkinsé…ç½®é¡µé¢ï¼Œé€‰æ‹©ç³»ç»Ÿè®¾ç½®Configure Systemï¼Œæ‰¾åˆ°localé…ç½®ï¼Œè¾“å…¥ï¼šZH_cn ç®€ä½“ä¸­æ–‡ä¸ºZH_cnï¼Œè‹±æ–‡ä¸ºEN_usï¼Œç„¶åå‹¾é€‰Ignore brower preference and force this language to all usersã€‚\nå®‰è£…æ’ä»¶æé€Ÿ çœ‹åˆ°å¥½å¤šåŠ é€ŸJenkinså®‰è£…æ’ä»¶é€Ÿåº¦çš„æ–‡ç« ï¼Œå¤§å¤šæ•°æ•™ç¨‹ä¸­éƒ½æ˜¯åœ¨æ’ä»¶é…ç½®é‡Œä½¿ç”¨ https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json æ›¿æ¢åŸæ¥çš„å®˜æ–¹çš„jsonï¼Œæ›¿æ¢ä¹‹åé€šè¿‡urlå…¨å±€æœç´¢ï¼Œå‘ç°æ¯ä¸ªæ’ä»¶ä¸‹è½½è·¯å¾„ä¾æ—§æ²¡æœ‰æ”¹å˜ï¼Œé…ç½®å†…å†™æ­»çš„æ’ä»¶ä¸‹è½½åœ°å€æ˜¯æ²¡æœ‰å˜çš„ï¼Œè¿˜æ˜¯ä»å®˜ç½‘ä¸‹è½½ï¼è¿™çœŸæ˜¯ä»¤äººå¿ƒç—›ï¼ğŸ’”â€‹ ä»¥ä¸Šçš„é…ç½®Jsonå…¶å®åœ¨Jenkinsçš„å·¥ä½œç›®å½•ä¸­ã€‚ è¿›å…¥æ›´æ–°é…ç½®ä½ç½® cd /root/.jenkins/updates\nvim default.json è¿™ä¸ªJsonæ–‡ä»¶ä¸ä¸Šè¾¹çš„é…ç½®æ–‡ä»¶æ˜¯ç›¸åŒçš„ã€‚\nä½¿ç”¨vimçš„å‘½ä»¤ï¼Œå¦‚ä¸‹ï¼Œæ›¿æ¢æ‰€æœ‰æ’ä»¶ä¸‹è½½çš„url :1,$s/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g æ›¿æ¢è¿æ¥æµ‹è¯•url :1,$s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g è¿›å…¥vimå…ˆè¾“å…¥ï¼šç„¶åå†ç²˜è´´ä¸Šè¾¹çš„ï¼šåè¾¹çš„å‘½ä»¤ï¼Œæ³¨æ„ä¸è¦å†™ä¸¤ä¸ªå†’å·ï¼ ä¿å­˜é€€å‡ºï¼Œå¹¶é‡å¯jenkinsã€‚\næ–¹å¼äºŒï¼šä½¿ç”¨sed $ sed -i 's/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g' default.json \u0026\u0026 sed -i 's/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g' default.json è¿™æ˜¯ç›´æ¥ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœå‰è¾¹Jenkinsç”¨sudoå¯åŠ¨çš„è¯ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ä¸¤ä¸ªsedå‰å‡éœ€è¦åŠ ä¸Šsudoã€‚ é‡å¯Jenkinsï¼Œå®‰è£…æ’ä»¶è¯•è¯•ï¼Œç®€ç›´å…‰é€Ÿã€‚\nå®‰è£…æ’ä»¶æé€Ÿå‚è€ƒ\nJenkinså‡çº§ ä»Šå¤©å‘ç°æ—§ç‰ˆæœ¬çš„jenkinså·²ç»æ— æ³•å®‰è£…æ’ä»¶äº†ï¼Œå¿…é¡»å‡çº§æˆæ–°ç‰ˆæœ¬ã€‚ å¦‚æœæ˜¯é€šè¿‡tomcatè¿è¡Œçš„waråŒ…ï¼Œåªéœ€åœ¨å®˜ç½‘ä¸‹è½½æœ€æ–°çš„waråŒ…ï¼Œç„¶åæ›¿æ¢åˆ°tomcatçš„webappsé‡Œçš„root.warï¼Œé‡å¯tomcatå³å¯ã€‚\næŒç»­é›†æˆé…ç½® æœåŠ¡å™¨éœ€è¦å®‰è£…ï¼šjdkã€gitã€mavenï¼Œå®‰è£…å¥½ä¹‹åï¼Œéœ€è¦åœ¨jenkinsä¸­è¿›è¡Œé…ç½®ã€‚\nç³»ç»Ÿç®¡ç† -\u003eå…¨å±€å·¥å…·é…ç½® Manage Jenkins -\u003e Global Tool Configuration\nç„¶åå¡«å…¥æœ¬æœºgit/maven/jdkçš„å®‰è£…è·¯å¾„ã€‚ jdkï¼š ä¸è¦å‹¾é€‰è‡ªåŠ¨å®‰è£…ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æ‰‹åŠ¨å®‰è£…å¥½ï¼Œè¿™é‡Œåªéœ€è¦å¡«å†™JAVA_HOMEå³å¯ï¼Œåˆ«åå¯ä¸å¡«ã€‚ /usr/local/jdk1.8.0_211\ngitï¼š ä¸å‹¾é€‰è‡ªåŠ¨å®‰è£…ï¼Œåªå¡«å†™Path to Git executable /usr/local/git/bin/git\næŸ¥æ‰¾gitå®‰è£…è·¯å¾„ whereis git git: /usr/local/git /usr/local/git/bin/git\nå¦‚ä¸Šé¢whereis gitçš„åœ°å€ä¸º/usr/local/gitï¼Œåˆ™åº”è¯¥å¡«å…¥/usr/local/git/bin/git\nmavenï¼š ä¸å‹¾é€‰è‡ªåŠ¨å®‰è£…ï¼Œåªå¡«å†™MAVEN_HOME /usr/local/maven\næœ¬åœ°éƒ¨ç½² æœ¬åœ°éƒ¨ç½²æ˜¯æŒ‡ï¼šéƒ¨ç½²è¿è¡Œåœ¨æœ¬æœºçš„æœåŠ¡ï¼Œè‹¥é¡¹ç›®éƒ¨ç½²åœ¨å…¶ä»–æœåŠ¡å™¨ï¼Œåˆ™éœ€è¦è¿œç¨‹éƒ¨ç½²ã€‚\nåœ¨ä¸»é¡µé€‰æ‹©æ–°å»ºä»»åŠ¡ï¼Œé€‰æ‹©æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œç”±äºå…¬å¸é¡¹ç›®ç»“æ„ä¸ºçˆ¶å­é¡¹ç›® æ‰€æœ‰çš„å­é¡¹ç›®éƒ½åœ¨tubitu_projectä¸€ä¸ªä»£ç ä»“åº“é‡Œï¼Œå¦‚æœé…ç½®äº†webhook(ä½œç”¨æ˜¯æ¥æ”¶è¿œç¨‹ä»“åº“pushçš„æäº¤ä¿¡æ¯)çš„è¯ï¼Œä»»ä½•ä¸€ä¸ªå­é¡¹ç›®çš„ä»£ç æ¨é€ï¼Œéƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡çš„è‡ªåŠ¨é‡å¯ï¼Œè€Œç”±äºå…¬å¸æ²¡æœ‰æ­£è§„çš„ä»£ç æäº¤å®¡æŸ¥æµç¨‹ï¼Œæ‰€ä»¥å¦‚æœæäº¤é”™è¯¯ä»£ç ï¼Œä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡ä¸€åŒå´©æºƒï¼Œå› æ­¤ï¼Œæ¨èæ¯ä¸€ä¸ªæœåŠ¡éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„éƒ¨ç½²ä»»åŠ¡ï¼Œæäº¤ä»£ç ååªéœ€è¦æ›´æ–°æäº¤ä»£ç çš„æœåŠ¡å³å¯ã€‚æœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š é…ç½®æµç¨‹ï¼š é¦–å…ˆæ–°å»ºä¸€ä¸ªä»»åŠ¡ï¼Œé€‰æ‹©æ„å»ºmavené¡¹ç›®ï¼Œè¾“å…¥åç§°ï¼Œç„¶åè¿›å…¥é…ç½®é¡µé¢ã€‚ æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ä¸Šè¾¹æåˆ°çš„mavenæ’ä»¶ï¼Œè¿™é‡Œæ˜¯çœ‹ä¸åˆ°æ„å»ºmavené¡¹ç›®é€‰é¡¹çš„ã€‚\nä¹Ÿå¯ä»¥é€‰ä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶\nGeneralé€‰é¡¹å¡ï¼š å‹¾é€‰ä¸¢å¼ƒæ—§çš„æ„å»ºï¼Œç­–ç•¥åªèƒ½é»˜è®¤ã€‚\nä¿æŒæ„å»ºå¤©æ•° ä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•° Jenkinsä¼šè‡ªåŠ¨åˆ é™¤ç¬¬ä¸€é¡¹ä¹‹å‰çš„å®‰è£…åŒ…ï¼ŒèŠ‚çº¦æœåŠ¡å™¨ç©ºé—´ã€‚ æºç ç®¡ç†ï¼š å‹¾é€‰gitï¼ŒRepository URLè¾“å…¥è¿œç¨‹ä»“åº“åœ°å€ï¼ŒCredentialsæ·»åŠ ä¸ªäººè¿œç¨‹ä»“åº“çš„è´¦æˆ·å¯†ç ã€‚ (æ³¨ï¼šè¿™é‡Œå»ºè®®ä½¿ç”¨å…¬å¸å…¬ç”¨çš„è´¦æˆ·å¯†ç ï¼Œé¿å…å‘˜å·¥ç¦»èŒæˆ–æ›´æ”¹å¯†ç å¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦)\næ„å»ºè§¦å‘å™¨ å‹¾é€‰ï¼šBuild whenever a SNAPSHOT dependency is builtï¼ˆè§¦å‘è¿œç¨‹æ„å»º (ä¾‹å¦‚,ä½¿ç”¨è„šæœ¬)ï¼‰\næ„å»ºç¯å¢ƒ å‹¾é€‰ï¼šAdd timestamps to the Console Outputï¼ˆéå¿…é€‰ï¼‰\næ³¨æ„ï¼šæ„å»ºmavené¡¹ç›®å’Œæ„å»ºè‡ªç”±é£æ ¼çš„è½¯ä»¶ï¼Œè¿™é‡Œçš„é€‰é¡¹æ˜¯ä¸ä¸€æ ·çš„ã€‚ 5. Pre Steps ä¸ç”¨é€‰\nBuild(æ„å»º) Root POMï¼šé»˜è®¤ Goals and optionsï¼šclean install -pl tubitu_service_api -am æ³¨æ„æ›´æ”¹æ¨¡å—çš„åç§°ã€‚å…¶ä¸­-pl ä»£è¡¨æ‰“åŒ…æŒ‡å®šmoduleï¼Œå¯ä»¥-pl module_name -pl module_nameæŒ‡å®šæ‰“åŒ…å¤šä¸ªé¡¹ç›®ï¼Œ-am ä»£è¡¨è‡ªåŠ¨æ‰“åŒ…æŒ‡å®šmoduleæ‰€ä¾èµ–çš„æ¨¡å—ã€‚\næ³¨æ„ï¼š-pl xxx(æ¨¡å—å)ï¼Œå¿…é¡»åœ¨é¡¹ç›®çš„æ ¹ç›®å½•æ‰§è¡Œã€‚\nPost Steps å‹¾é€‰Run only if build succeeds\nç‚¹å‡»Add post-build stepï¼Œç„¶åé€‰æ‹©æ‰§è¡Œshellï¼Œè¿™é‡Œä¸€æ­¥æ˜¯é‡ä¸­ä¹‹é‡ã€‚ å¯ä»¥å…ˆéšä¾¿ç”¨ä¸ªæŒ‡ä»¤å®éªŒä¸€ä¸‹ï¼š ifconfig\nç„¶åç‚¹å‡»ä¿å­˜ï¼Œç‚¹å‡»æ„å»ºï¼Œçœ‹jenkinsæ§åˆ¶å°æ˜¯å¦è¾“å…¥äº†æœåŠ¡å™¨çš„ipåœ°å€ã€‚\nå®Œæ•´çš„æ›´æ–°é¡¹ç›®shellè„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #é¦–å…ˆåœæ­¢é¡¹ç›® pid=`ps -ef | grep zjx_admin-1.0.0.jar | grep -v grep | awk '{print $2}'` if [ -n \"$pid\" ] then kill -9 $pid fi #åˆ é™¤æ—§çš„é¡¹ç›®ï¼Œæ³¨æ„æ›´æ”¹æ­¤å¤„çš„jaråŒ…åç§° rm -rf /usr/local/zjx/admin/zjx_admin-0.0.1-SNAPSHOT.jar #æ¸…é™¤å¹¶æ‰“åŒ…æŒ‡å®šé¡¹ç›®ï¼Œ-amè¡¨ç¤ºè¿åŒä¾èµ–æ¨¡å—ä¸€åŒæ‰“åŒ… cd $WORKSPACE mvn clean package -pl zjx_admin -am #å¤åˆ¶Jenkinså·¥ä½œç©ºé—´é‡Œçš„é¡¹ç›®(æ‰“åŒ…å¥½)åˆ°æŒ‡å®šç›®å½•ä¸‹ cp $WORKSPACE/zjx_admin/target/zjx_admin-0.0.1-SNAPSHOT.jar /usr/local/zjx/admin/ #æˆæƒï¼Œè¯¥æ­¥éª¤å¯ä»¥çœç•¥ chmod u+x /usr/local/zjx/admin/zjx_admin-0.0.1-SNAPSHOT.jar #æŒ‡å®šlogæ—¥å¿—ä½ç½®ï¼Œå¹¶é€šè¿‡java -jarå¯åŠ¨é¡¹ç›® BUILD_ID=donKillme nohup java -jar -Dspring.profiles.active=dev \u003e/usr/local/zjx/service/logs/zjx.log /usr/local/zjx/admin/zjx_admin-0.0.1-SNAPSHOT.jar \u0026 ä¸¤ç§æ‰“å°æ—¥å¿—çš„è®¾ç½® \u003e/usr/local/zjx/service/logs/zjx.log ä¸‹è¾¹è¿™ç§æ­»æ´»æ‰“ä¸å‡ºæ—¥å¿—ï¼Œä¸çŸ¥é“ä¸ºå•¥ã€‚ -Dlogging.file=/usr/local/zjx/admin/logs/zjx.log\n2019/12/13æ›´æ–°ï¼š ç»ˆäºçŸ¥é“ä¸ºå•¥ä¸èƒ½æ‰“å°æ—¥å¿—äº†ã€‚å…¶å®ä¸Šè¿°ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥æ‰“å°æ—¥å¿—ï¼Œåªä¸è¿‡æˆ‘æ˜¯åˆ†å¸ƒå¼åº”ç”¨ï¼Œæä¾›è€…æœ‰å¤šä¸ªï¼Œä½†æ˜¯åŒæ—¶å‘ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­å†™æ—¥å¿—ã€‚ æ‰€ä»¥é€ æˆäº†æ­»é”é—®é¢˜ï¼Œå¤šä¸ªç¨‹åºéƒ½åœ¨äº‰æŠ¢æ—¥å¿—æ–‡ä»¶çš„é”ï¼Œç„¶åå¯¼è‡´è°éƒ½æ— æ³•å†™å…¥ã€‚ è§£å†³åŠæ³•ï¼š æ¯ä¸ªæœåŠ¡ï¼Œå•ç‹¬é…ç½®æ—¥å¿—æ–‡ä»¶ã€‚\nè¿™ä¸ª-Dæ˜¯ javaå‘½ä»¤çš„å‚æ•°-Dã€‚æ„æŒ‡åŠ å…¥å…¨å±€å±æ€§ï¼Œæ¯”å¦‚-Djdbc.driver=è¡¨ç¤ºåœ¨ç¨‹åºé‡Œå¯ç”¨System.getProperty(â€œjdbc.driverâ€)è·å¾—ï¼Œä»¥æ­¤ç±»æ¨ã€‚ -Dspring.profiles.active=devï¼šæŒ‡å®šå¯åŠ¨é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥åŒºåˆ†æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚\nBUILD_ID=dontKillmeï¼šæŒ‡çš„æ˜¯ä¸è¦æ€æ­»æœ€åä¸€æ­¥å¯åŠ¨é¡¹ç›®äº§ç”Ÿçš„å­è¿›ç¨‹ã€‚ å®˜ç½‘è¯´æ˜\n1 2 3 To reliably kill processes spawned by a job during a build, Jenkins contains a bit of native code to list up such processes and kill them. This is tested on several platforms and architectures, but if you find a show-stopper problem because of this, you can disable this feature by setting a Java property named \"hudson.util.ProcessTree.disable\" to the value \"true\". è¯‘ï¼šä¸ºäº†å¯é åœ°ç»ˆæ­¢æ„å»ºè¿‡ç¨‹ä¸­æ»‹ç”Ÿå‡ºæ¥çš„è¿›ç¨‹ï¼ŒJenkinsåŒ…å«äº†ä¸€ç³»åˆ—çš„æœ¬åœ°ä»£ç å»æŸ¥å‡ºè¿™äº›å­è¿›ç¨‹å¹¶ä¸”æ€æ­»å®ƒä»¬ã€‚è¿™ä¸ªå·²ç»åœ¨ä¸€äº›å¹³å°ä¸Šè¿›è¡Œäº†æµ‹è¯•ï¼Œå¦‚æœä½ å‘ç°ç”±æ­¤å¼•å‘çš„åœæ­¢æ˜¾ç¤ºçš„é—®é¢˜ï¼Œä½ å¯ä»¥è®¾ç½®åä¸ºâ€œhudson.util.ProcessTree.disable\" çš„java propertyä¸ºtrueæ¥ç¦æ­¢ä½¿ç”¨ProcessTreeKillerè‡ªåŠ¨æ€æ­»ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¿æŒå®˜æ–¹é»˜è®¤é…ç½®ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨BUILD_ID=dontKillme è¡¨ç¤ºè¯¥è¿›ç¨‹ä¸æ˜¯ç”±Jenkinsæ¥ç”Ÿæˆï¼Œä¹Ÿå°±ä¸ä¼šè¢«ProcessTreeKilleræ€æ­»ã€‚\nç„¶åå›åˆ°é¦–é¡µï¼Œç‚¹å‡»ä»»åŠ¡åˆ—è¡¨é¡¹å³ä¾§çš„å›¾æ ‡ï¼šè¡¨ç›˜ä¸Šæœ‰ä¸ªç»¿è‰²å°ç®­å¤´ï¼Œæˆ–è€…ç‚¹å‡»æ¨¡å—åæ—çš„å°ç®­å¤´ï¼Œç‚¹å‡»ç«‹å³æ„å»ºã€‚ç‚¹å‡»#1ï¼Œ1è¿™ä¸ªæ•°å­—æ¯æ¬¡æ„å»ºéƒ½ä¼š+1ï¼Œä»£è¡¨è¯¥æ¨¡å—çš„æ„å»ºæ¬¡æ•°ã€‚ é¼ æ ‡æ‚¬æµ®åœ¨è¯¥é¡¹ä¸Šï¼Œç‚¹å‡»å‘ä¸‹çš„å°ç®­å¤´ï¼Œç‚¹å‡»æ§åˆ¶å°è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ­£åœ¨æ„å»ºæˆ–å·²ç»å®Œæˆæ„å»ºçš„linuxæ§åˆ¶å°ä¿¡æ¯ã€‚\næ„å»ºè¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°æ„å»ºè¿›åº¦ï¼š #10ä»£è¡¨ç¬¬åæ¬¡æ„å»ºï¼Œé¼ æ ‡ç§»åˆ°10æ—è¾¹ï¼Œå³å¯æŸ¥çœ‹æ§åˆ¶å°è¾“å…¥çš„æ„å»ºå’Œå¯åŠ¨ä¿¡æ¯ã€‚çœ‹åˆ°Finshedï¼šSUCCESSï¼Œè¡¨ç¤ºæ„å»ºå®Œæˆã€‚\næ­¤æ—¶è¿”å›åˆ°Jenkinsä¸»é¡µï¼Œå¯ä»¥çœ‹åˆ°Sä¸‹çš„ä¸€åˆ—åœ†å½¢å›¾æ ‡ï¼Œ è“è‰²ï¼šæˆåŠŸ ç°è‰²ï¼šå°šæœªæ„å»º çº¢è‰²ï¼šæ„å»ºå¤±è´¥ é»„è‰²ï¼šä¸ç¨³å®šæ„å»º(Jenkinsä¸ç¡®å®šçŠ¶æ€)\nWä¸‹æœ‰å¤©æ°”å›¾æ ‡ï¼Œä»£è¡¨è¿‘æœŸæ„å»ºçŠ¶æ€ï¼š å°å¤ªé˜³ï¼šè¿‘æœŸæˆåŠŸ å¤šäº‘ï¼šå°‘æ•°å¤±è´¥ï¼Œä»¥æ­¤ç±»æ¨\nè¿œç¨‹éƒ¨ç½² è¿œç¨‹éƒ¨ç½²æ˜¯ç”±äºé¡¹ç›®æ‰€æœ‰çš„æœåŠ¡å¹¶ä¸éƒ½éƒ¨ç½²åœ¨æœ¬æœºï¼Œæœ‰å¯èƒ½éƒ¨ç½²åœ¨å…¶ä»–æœåŠ¡å™¨ï¼Œæ‰€ä»¥éœ€è¦è¿œç¨‹éƒ¨ç½²ã€‚ è¯´ç™½äº†ï¼Œå°±æ˜¯æŠŠjaråŒ…ä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡è„šæœ¬æ¥å¯åŠ¨jaråŒ…ã€‚\nè¿œç¨‹éƒ¨ç½²éœ€è¦é…ç½®è¿œç¨‹æœåŠ¡å™¨çš„ipåœ°å€å’Œç”¨æˆ·å‡­è¯ã€‚ è¿”å›ä¸»é¡µï¼Œç‚¹å‡»ç³»ç»Ÿç®¡ç†ï¼Œç„¶åç‚¹å‡»ç³»ç»Ÿè®¾ç½®ï¼Œåœ¨Publish over SSHä¸‹æ‰¾åˆ°SSH Serversï¼Œç‚¹å‡»æ–°å¢ï¼Œåˆ†åˆ«é…ç½®å¥½IPåœ°å€å’Œç”¨æˆ·åå¯†ç ï¼š è¿™é‡ŒRemote Directoryä¸ºJenkinsé»˜è®¤è¿œç¨‹æ ¹ç›®å½•ï¼Œç‚¹å‡»é«˜çº§ï¼Œå‹¾é€‰ä½¿ç”¨ç”¨æˆ·å¯†ç ï¼Œå¹¶è¾“å…¥å¯†ç ï¼Œç„¶åç‚¹å‡»Test Configurationæµ‹è¯•æ˜¯å¦è¿æ¥æˆåŠŸï¼š æ–°å»ºä¸€ä¸ªä»»åŠ¡tubitu_service_mallï¼Œå‰é¢åŸºæœ¬ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯åœ¨Post Stepsæ—¶ï¼Œä¸å†é€‰æ‹©æ‰§è¡Œè„šæœ¬ï¼Œè€Œæ˜¯é€‰æ‹© send files or execute commands over SSH nameé€‰æ‹©ä¸Šä¸€æ­¥é…ç½®å¥½çš„è¿œç¨‹æœåŠ¡å™¨ï¼Œä¸€èˆ¬æ¥è¯´ä¼šè‡ªåŠ¨å¡«å……ä¸Šã€‚ Source filesé»˜è®¤ä¼šä»¥æœ¬åœ°å½“å‰ä»»åŠ¡çš„Jenkinså·¥ä½œç©ºé—´+ä»»åŠ¡åä¸ºæ ¹è·¯å¾„ã€‚æ‰€ä»¥Source filesåªèƒ½é…ç½®ç›¸å¯¹è·¯å¾„ï¼Œè€ŒJenkinsæ¯ä¸€ä¸ªä»»åŠ¡é»˜è®¤çš„å·¥ä½œç©ºé—´ä¸º/root/.jenkins/workspace/ä»»åŠ¡åï¼Œ æ‰€ä»¥é«˜çº§ä»»åŠ¡åœ¨æœ¬æ–‡ä¸­çš„å·¥ä½œç©ºé—´å…¨è·¯å¾„å³ä¸ºï¼š /root/.jenkins/workspace/tubitu_service_mall è€Œç”±äºæ„å»ºä¾èµ–çš„pomæ–‡ä»¶åˆæ˜¯çˆ¶é¡¹ç›®çš„pomæ–‡ä»¶ï¼Œæ‰€ä»¥Source filesä¸º tubitu_service_mall/target/*.jar *ä»£è¡¨æ‰€æœ‰çš„jaråŒ…ã€‚\nRemove prefixï¼š ä»£è¡¨ä¼ è¾“åˆ°è¿œç¨‹æ—¶éœ€è¦ç§»é™¤çš„å‰ç¼€ï¼Œå³åˆ°è¿œç¨‹æ—¶ä¼šè‡ªåŠ¨ç§»é™¤tubitu_service_mall/target/ï¼Œåªä¿ç•™æ–‡ä»¶åã€‚ Remote directoryï¼š è¿œç¨‹æœåŠ¡å™¨è·¯å¾„ã€‚æ³¨æ„ï¼šè¿™ä¸ªç›®æ ‡è·¯å¾„ä¹Ÿæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹çš„æ˜¯ä½ åœ¨ä¸€å¼€å§‹é…ç½®SSH serveræ—¶ Remote Directoryçš„ç›®å½•ï¼Œç”±äºæœ¬æ–‡é…ç½®çš„æ˜¯/ï¼Œæ‰€ä»¥å®é™…ä¼ è¾“çš„è¿œç¨‹ç›®ä¸º/usr/local/meilong/mallï¼Œ å¦‚æœä¸€å¼€å§‹é…ç½®çš„æ˜¯/usr/local/meilongï¼Œé‚£ä¹ˆè¿™é‡Œåªéœ€è¦é…ç½®Remote directoryä¸ºmallã€‚\nExec commandæ‰§è¡Œçš„è„šæœ¬å†…å®¹ä¸ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #restart.sh #!/bin/bash APP_PATH=/usr/local/meilong/mall APP_NAME=tubitu_service_mall-1.0.jar LOG_FILE=$APP_PATH/logs/tubitu.log echo \"Restarting $APP_NAME SpringBoot Application\" pid=`ps -ef | grep $APP_NAME | grep -v grep | awk '{print $2}'` source /etc/profile if [ -n \"$pid\" ] then kill -9 $pid echo \"å…³é—­è¿›ç¨‹ï¼š\"$pid fi echo \"æˆäºˆå½“å‰ç”¨æˆ·æƒé™\" chmod u+x $APP_PATH/$APP_NAME echo \"æ‰§è¡Œ.....\" nohup java -jar -Dlogging.file=$LOG_FILE $APP_PATH/$APP_NAME \u003e\u003e /dev/null \u0026 respid=`ps -ef | grep $APP_NAME | grep -v grep | awk '{print $2}'` if [ -n \"$respid\" ] then echo \"å¯åŠ¨æˆåŠŸï¼Œè¿›ç¨‹å·ï¼š$respid\" exit 0 else echo \"å¯åŠ¨å¤±è´¥\" exit 1 fi done éœ€è¦æ³¨æ„çš„æ˜¯ç¬¬8è¡Œï¼Œä¹‹æ‰€ä»¥è¦æ‰§è¡Œç¬¬8è¡Œï¼Œæ˜¯å› ä¸ºJenkinsåœ¨æ‰§è¡Œè¿œç¨‹è„šæœ¬æ—¶ï¼Œå®ƒæ˜¯ä¸ä¼šæºå¸¦æœ¬æœºç¯å¢ƒå˜é‡çš„ï¼Œæ‰€ä»¥æ‰§è¡Œjavaä¼šæŠ¥command not foundçš„é”™å¯¼è‡´æ„å»ºå¤±è´¥ï¼Œè§£å†³åŠæ³•æœ‰ä¸¤ä¸ªï¼š\næ‰§è¡Œjavaå‘½ä»¤æ—¶è¾“å…¥javaçš„å…¨è·¯å¾„ï¼Œæœ¬æ–‡ä¸º/usr/local/jdk1.8.0_161/bin/java; æ‰§è¡Œè¯¥è„šæœ¬æ—¶ï¼Œè„šæœ¬å†…è°ƒç”¨source /etc/profileï¼Œå½“ç„¶å‰ææ˜¯åœ¨profileé‡Œé…ç½®javaçš„ç¯å¢ƒå˜é‡ã€‚ å¦‚æœæ²¡æœ‰é‡åˆ°command not foundçš„é”™ï¼Œé‚£ä¹ˆå¯ä»¥ä¸åŠ ç¬¬8è¡Œã€‚\næ¨èåœ¨Transfersé‡Œçš„é«˜çº§é€‰é¡¹é‡Œå‹¾é€‰[Flatten files]ï¼Œä»£è¡¨æ‰å¹³åŒ–ä¼ è¾“æ–‡ä»¶ï¼Œå³åªä¼ è¾“æ–‡ä»¶è€Œä¸å»ºç«‹è¿œç¨‹ç›®å½•ï¼Œé¿å…åˆ›å»ºä¸€å †æ‚ä¹±ç›®å½•ï¼Œå‰ææ˜¯è¿œç¨‹ç›®å½•è‡ªå·±å·²ç»æ‰‹åŠ¨åˆ›å»ºã€‚\n3.ç»¼åˆéƒ¨ç½² ç»¼åˆéƒ¨ç½²ï¼šå»ºç«‹ä¸€ä¸ªå…¬å…±æœåŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬é¡¹ç›®ä¸­æ‰€æœ‰çš„æ¨¡å—ï¼Œå®ç°ä¸€é”®éƒ¨ç½²ã€å¯åŠ¨æ‰€æœ‰æ¨¡å—ã€‚ æœ¬åœ°éƒ¨ç½²+è¿œç¨‹éƒ¨ç½²ï¼ŒåŸºæœ¬æ­¥éª¤ä¸å‰é¢ä¸¤ç§åº”ç”¨ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ï¼Œåªè´´å‡ºé…ç½®ã€‚ æƒé™åˆ†é… è€ƒè™‘åˆ°Jenkinsä¸­çš„æ¨¡å—å¯èƒ½éœ€è¦äº¤ç»™ä¸åŒçš„äººå»ç»´æŠ¤ï¼Œä¾‹å¦‚h5ã€åå°ç³»ç»Ÿã€apiç­‰ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä¸åŒçš„è´¦å·åˆ†é…ä¸åŒçš„è§’è‰²ï¼Œå®ç°æƒé™åˆ†é…ã€‚\nå®‰è£…æ’ä»¶ï¼šRole-based Authorization Strategy è¿›å…¥åˆ°å…¨å±€å®‰å…¨é…ç½®ï¼Œå¯ç”¨è¯¥æ’ä»¶ï¼š ç„¶åè¿›å…¥åˆ°ç³»ç»Ÿç®¡ç†ï¼Œæ­¤æ—¶å‡ºç°äº†Manage And Assign Rolesçš„é€‰é¡¹ï¼Œé¦–å…ˆé€‰æ‹©manage rolesã€‚æ¯”å¦‚æˆ‘æƒ³æ–°å¢ä¸€ä¸ªå‰ç«¯çš„è§’è‰²ï¼Œè¿™ä¸ªå‰ç«¯è§’è‰²åªèƒ½çœ‹åˆ°å‰ç«¯çš„æ„å»ºä»»åŠ¡ï¼Œè¾“å…¥h5ï¼Œç‚¹å‡»æ–°å¢ï¼Œç„¶åå‹¾é€‰å…¨éƒ¨/overallé‡Œçš„Readé€‰é¡¹ï¼Œè¯¥é€‰é¡¹å¿…é€‰ï¼Œå¦åˆ™ä¼šæç¤ºè¯¥è§’è‰²æ²¡æœ‰æ‰€æœ‰çš„è¯»å–æƒé™ã€‚\nç„¶åæ–°å¢ä¸€ä¸ªé¡¹ç›®æƒé™ï¼Œä¹Ÿå‘½åä¸ºh5ï¼ŒPatterné‡Œå†™æ­£åˆ™ï¼Œh5_.*ä»£è¡¨æ˜¾ç¤ºæ‰€æœ‰ä»¥h5_å¼€å¤´çš„æ„å»ºé¡¹ç›®ï¼Œé€‰æ‹©ä»»åŠ¡é‡Œçš„Buildï¼ŒConfigureï¼ŒReadï¼Œå¯ç”¨è¯¥è§’è‰²å¯¹äºä»»åŠ¡çš„æ„å»ºï¼Œé…ç½®å’Œè¯»æƒé™ï¼Œç‚¹å‡»saveã€‚\nç„¶ååœ¨Jenkinsçš„ç”¨æˆ·ç®¡ç†é‡Œæ–°å»ºä¸€ä¸ªç”¨æˆ·ï¼Œå‘½åä¸ºh5ï¼Œæˆ‘è¿™é‡Œçš„å…¨åä¸ºtubitu_h5ï¼š æœ€åè¿”å›åˆ°Manage And Assign Rolesä¸»ç•Œé¢ï¼Œé€‰æ‹©Assign rolesåˆ†é…è§’è‰²ã€‚ User/group to addæ¡†é‡Œè¾“å…¥h5ï¼ˆä¸éœ€è¦è¾“å…¥å…¨åï¼ŒJenkinsä¼šæ ¹æ®userIdæ¥æ‰¾ï¼ŒuserId=h5ï¼‰ï¼Œç„¶åç‚¹å‡»Addï¼Œå¹¶å‹¾é€‰åˆšåˆšæ–°å»ºçš„h5çš„è§’è‰²ã€‚\næ³¨é”€å½“å‰ç”¨æˆ·ï¼Œä½¿ç”¨h5ç”¨æˆ·ç™»å½•ï¼Œåªèƒ½çœ‹åˆ°h5_çš„ä»»åŠ¡ã€‚\nå¦‚æœä¸å°å¿ƒåˆ†é…é”™äº†æƒé™ï¼Œå¯ä»¥åˆ°jenkinsçš„ä¸»ç›®å½•ä¸‹ï¼Œä¾‹å¦‚Linuxä¸Šçš„/root/.jenkins/ç›®å½•ä¸‹æœ‰ä¸€ä¸ªconfig.xmlæ–‡ä»¶ï¼Œä¿®æ”¹authorizationStrategyä¸ºhudson.security.FullControlOnceLoggedInAuthorizationStrategyï¼Œå³å¯ç¦ç”¨åŸºäºè§’è‰²çš„æƒé™ç­–ç•¥ï¼š\n1 2 3 4 5 6 7 8 true true true false é—®é¢˜ temp/jenkins138035565033548290.sh: line 5: mvn: command not found åŸå› ï¼š javaæˆ–mavençš„è·¯å¾„çš„ç¯å¢ƒå˜é‡æ˜¯æ”¾åœ¨/etc/profileä¸­çš„ï¼Œè€Œ/etc/profileåªæœ‰åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™æ‰ä¼šè¢«loadï¼ŒJenkinsåœ¨è¿è¡Œå‘½ä»¤æ—¶ï¼Œä½¿ç”¨çš„æ˜¯Non-loginçš„æ–¹å¼ï¼Œè€Œè¿™ç§æ–¹å¼åœ¨è¿è¡Œå‘½ä»¤æ—¶ï¼Œ/etc/profileæ˜¯ä¸ä¼šè¢«loadè¿›æ¥çš„ï¼Œæ‰€ä»¥jenkinsåªèƒ½åœ¨å½“å‰è·¯å¾„ä¸‹å¯»æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ã€‚\nè§£å†³æ–¹æ³•1ï¼š åœ¨è„šæœ¬å¤´éƒ¨æ·»åŠ ï¼š #!/bin/bash -il\nè§£å†³æ–¹æ³•2ï¼š æŸ¥è¯¢ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼š echo $PATH\n1 /root/jenkins_home/downloads/apache-maven-3.6.3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin jenkinsä¸»é¡µé¢-\u003eManage Jenkins-\u003eConfigure System-\u003eGlobal Properties nameï¼šPATH vlaueï¼šåˆšæ‰æŸ¥å‡ºæ¥çš„ã€‚\njenkinså¸è½½ å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯tomcatè¿è¡Œjenkins.warçš„æ–¹å¼ï¼Œæ‰€ä»¥ï¼š\nåœæ­¢tomcat ./shutdown.sh\nåˆ é™¤ROOT rm -rf ROOT\nåˆ é™¤jenkinså·¥ä½œç©ºé—´ cd /root\næŸ¥çœ‹jenkinsæ˜¯å¦åœ¨rootä¸‹é¢ ls\nå‘ç°æœ‰ï¼Œç›´æ¥åˆ é™¤ rm -rf .jenkins\næ¸…é™¤ç¼“å­˜ jenkinså ç”¨æœåŠ¡å™¨ç¡¬ç›˜è¿‡å¤§ jenkinsåœ¨æœåŠ¡å™¨è·‘äº†ä¸€ä¸ªæœˆäº†ï¼Œ8ä¸ªæœåŠ¡ï¼Œæ¯å¤©éƒ½è¦æ„å»ºå‡ æ¬¡ï¼Œä»Šå¤©å‘ç°mysqlä¸èƒ½æ’å…¥æ•°æ®äº†ï¼ŒæŠ¥ç£ç›˜ç©ºé—´ä¸è¶³ã€‚ç¬¬ä¸€ååº”å°±æ˜¯jenkinsçš„é—®é¢˜ã€‚ å…ˆæŸ¥çœ‹linuxæœåŠ¡å™¨çš„ç£ç›˜ä½¿ç”¨çŠ¶å†µï¼šdf -h\njenkinsçš„æ–‡ä»¶éƒ½å­˜å‚¨åœ¨/root/.jenkinsï¼Œä½¿ç”¨æŒ‡ä»¤æŸ¥çœ‹æ–‡ä»¶å¤¹å¤§å°du -shï¼Œå‘ç°å äº†86Gï¼Œå¤©å“ªâ€¦æˆ‘ç¡¬ç›˜ä¸€å…±æ‰95Gï¼Œå†åŠ ä¸Šå…¶ä»–ç¨‹åºå ç”¨çš„å†…å­˜ï¼Œç›´æ¥å°±100%ä½¿ç”¨äº†ã€‚\nè§£å†³ï¼š æ‰¾åˆ°.jenkins/jobsï¼Œè¿›åˆ°jobsç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°jenkinsçš„å„ä¸ªæ¨¡å—ã€‚æ‰¾åˆ°buildsï¼Œé‡Œé¢æ”¾ç€å„ä¸ªç‰ˆæœ¬çš„ æ„å»ºï¼Œåˆ é™¤ä¸éœ€è¦çš„ã€‚èƒ½å¦ç›´æ¥åˆ æ‰buildsæ–‡ä»¶å¤¹ï¼Œå­˜ç–‘ã€‚ ç„¶ååˆ æ‰.jenkins/workspaceåˆ æ‰ï¼Œmkdirä¸€ä¸ªï¼Œè¿™ä¸ªä¹Ÿå äº†1Gå¤šã€‚ åœ¨é…ç½®æ—¶ï¼Œä¸€å®šè¦é€‰æ‹©ä¸¢å¼ƒæ—§çš„æ„å»ºï¼Œå¹¶ä¸”ä¿æŒæ„å»ºçš„å¤©æ•°å’Œä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°ä¸€å®šè¦å†™ï¼Œåæ­£æˆ‘éƒ½å†™1ã€‚\nè‡ªåŠ¨åŒ–è„šæœ¬é”™è¯¯ cannot create regular file xxxï¼ŒPermission denied\næŸ¥çœ‹è‡ªå·±æ˜¯è°whoami å¦‚æœä¸æ˜¯rootç”¨æˆ·ï¼Œéœ€è¦åœ¨cpå‰åŠ ä¸Šsudoï¼Œæ³¨æ„è¿™é‡Œæˆ‘å·²ç»æå‰å®‰è£…äº†suduã€‚ We trust you have received the usual lecture from the local System ä¸æ˜¯rootç”¨æˆ·ï¼Œä½¿ç”¨sudoæ—¶ï¼Œå‡ºç°è¯¥é—®é¢˜ã€‚ ç¼–è¾‘/etc/sudoersæ–‡ä»¶ vim /etc/sudoers æ‰¾åˆ°è¿™è¡Œï¼š root ALL=(ALL) ALL åœ¨èµ·ä¸‹é¢æ·»åŠ xxx ALL=(ALL) ALL(è¿™é‡Œçš„xxxæ˜¯ä½ çš„ç”¨æˆ·å)ï¼Œç„¶åå¼ºåˆ¶ä¿å­˜é€€å‡ºï¼Œå› ä¸ºè¯¥æ–‡ä»¶æ˜¯åªè¯»æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ä¿®æ”¹ä¹‹å‰æ›´æ”¹è¯¥æ–‡ä»¶çš„è¯»å†™æƒé™ã€‚\nç„¶è€Œè¿˜æ˜¯ä¸è¡Œï¼Œè¿·ä¹‹é”™è¯¯ï¼Œæ”¹å˜æ€è·¯ï¼Œç»™jenkins-workspaceä¸‹çš„jaråŒ…èµ‹äºˆæƒé™ï¼š chmod u+x $WORKSPACE/target/archive-1.0.jar ç„¶åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨cpæŒ‡ä»¤ï¼Œç„¶è€Œåªæ˜¯Terminalå¯ä»¥ä½¿ç”¨ï¼Œjenkinsçš„è„šæœ¬è¿˜æ˜¯æ— æ³•ä½¿ç”¨ï¼Œæˆ‘æ—¥â€¦ æš‚æ—¶æ”¾å¼ƒï¼Œä½¿ç”¨tomcatå®‰è£…jenkinsâ€¦\né‡è£…jenkins åˆ é™¤å®‰è£…jenkinsç”¨æˆ·çš„ä¸»ç›®å½•ï¼ˆ~ï¼‰ä¸‹çš„ï¼ˆ.jenkinsï¼‰æ–‡ä»¶å¤¹ï¼Œç„¶åé‡å¯ï¼Œå°±å¯ä»¥é‡æ–°é…ç½®jenkins\njenkinsæŒ‡å®šspring bootçš„é…ç½®æ–‡ä»¶ åœ¨å¯åŠ¨è„šæœ¬åŠ å¦‚ä¸‹ä»£ç ï¼š -Dspring.profiles.active=dev\njenkinsé…ç½®åˆ†å¸ƒå¼åº”ç”¨æ—¶æ—¥å¿—æ–‡ä»¶é—®é¢˜ã€‚ å› ä¸ºåˆ†å¸ƒå¼æ˜¯å¤šä¸ªæœåŠ¡åˆ†å¼€éƒ¨ç½²ï¼Œæ‰€ä»¥å¦‚æœå¤šä¸ªæœåŠ¡å‘åŒæ—¶å‘ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å†™å†…å®¹ï¼Œä¼šé€ æˆæ­»é”é—®é¢˜ï¼Œå¯¼è‡´è°éƒ½æ— æ³•å†™å…¥æ—¥å¿—ã€‚ æ‰€ä»¥ï¼Œåˆ†å¸ƒå¼æœåŠ¡ï¼Œä¸€å®šè¦æ¯ä¸ªæœåŠ¡å•ç‹¬å†™è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶ã€‚\néƒ¨ç½²æ™®é€šspring boot é¡¹ç›® General å‹¾é€‰Discard old builds(ä¸¢å¼ƒæ—§çš„æ„å»º)ï¼Œåè¾¹ä¸¤ä¸ªç©ºå¡«1ã€‚\nå¤šåˆ†æ”¯æ„å»ºã€‚ jenkinsåœ¨éƒ¨ç½²æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©åˆ†æ”¯æ„å»ºã€‚\nä¸‹è½½æ’ä»¶Git Parameter ä¸‹è½½å®Œï¼Œåœ¨é¡¹ç›®æ„å»ºæ—¶ï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸ªé€‰é¡¹å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ å‹¾é€‰å‚æ•°åŒ–æ„å»ºï¼Œç„¶åé€‰æ‹©git å‚æ•° åç§°ï¼šgitBranchï¼Œæè¿°ï¼šgitå¤šåˆ†æ”¯é€‰æ‹©ï¼Œå‚æ•°ç±»å‹ï¼šbranch or tagï¼ˆåˆ†æ”¯æˆ–æ ‡ç­¾ï¼‰ Branches to buildï¼š$gitBranch ç„¶åæ„å»ºæ—¶ï¼Œä¼šè®©ä½ é€‰æ‹©åˆ†æ”¯ï¼Œç„¶åæ„å»ºå³å¯ã€‚\nSource Code Management é€‰æ‹©git åˆ†åˆ«å¡«å…¥ä»“åº“åœ°å€å’Œä¿å­˜è´¦å·å¯†ç \nBuild Triggers å‹¾é€‰Build whenever a SNAPSHOT dependency is built\nPre Steps(ä¹‹å‰çš„æ­¥éª¤) ä¸åŠ¨\nBuild Root POMï¼š pom.xml æ³¨æ„ï¼šé»˜è®¤éƒ¨ç½²é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„pom.xml\nGoals and optionsï¼š clean install -Dmaven.test.skip=true -am\nPost Stepsï¼ˆå‘å¸ƒæ­¥éª¤ï¼‰ å‹¾é€‰Run only if build succeeds\nAdd post-build stepä¸‹æ‹‰é€‰ï¼Œé€‰æ‹©Execute shell ç„¶åè¾“å…¥\n1 sh /usr/local/xxx.sh è¡¨ç¤ºæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„shè„šæœ¬ã€‚ç„¶ååœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºshè„šæœ¬ï¼Œè„šæœ¬çš„å†…å®¹ä¸ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 #!/bin/bash -il # å¯é€‰å‚æ•°ï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶ config=-Dspring.profiles.active=prod # å¯é€‰å‚æ•°ï¼ŒæŒ‡å®šæ—¥å¿—æ–‡ä»¶ # 1\u003e$project_path/logs/`date + %Y-%m-%d`.log\\ # 2\u003e$project_path/logs/log.error\\ log_path=1\u003ea.log 2\u003e\u00261 # jdkå…·ä½“è·¯å¾„ã€‚å¯èƒ½éœ€è¦å…·ä½“è·¯å¾„ï¼Œçœ‹æƒ…å†µï¼Œä¸æ˜¯å…·ä½“è·¯å¾„å‡ºç°è¿‡æ— æ³•ä½¿ç”¨java -jarçš„æƒ…å†µ jdk_path=/usr/lib/jvm/java-1.8.0-openjdk/bin/java # é¡¹ç›®åç§° project_name=zw-search # é¡¹ç›®åœ°å€ project_path=/data/matrix/search # jaråŒ…åç§° jar_name=zw-search-1.0-SNAPSHOT.jar # å¯åŠ¨å‚æ•° JAVA_OPTS='-server -Xms512m -Xmx512m' # å¯åŠ¨jaråŒ…å‘½ä»¤ï¼Œæ—¥å¿—ä½ç½®è¦å†™ç»å¯¹è·¯å¾„ï¼Œå¦åˆ™ä¼šæ²¡æœ‰æ—¥å¿—ã€‚ runjar=\"BUILD_ID=dontKillMe sudo nohup $jdk_path -jar ${JAVA_OPTS} $project_path/${jar_name} 1\u003e${project_path}a.log 2\u003e\u00261 \u0026\" # jenkinsæ ¹ç›®å½• WORKSPACE=/root/.jenkins/workspace # æŸ¥çœ‹è¿™ä¸ªjaræ˜¯å¦å·²ç»å¯åŠ¨ pid=`ps -ef | grep $jar_name | grep -v grep | awk '{print $2}'` if [ -n \"$pid\" ] then kill -9 $pid fi # åˆ é™¤æ—§çš„jaråŒ… rm -f $project_path/$jar_name echo \"åˆ é™¤æ—§çš„jaråŒ…\" $project_path/$jar_name # å¤åˆ¶jaråŒ… sudo cp $WORKSPACE/zw-search/zw-search/target/$jar_name $project_path echo \"å¤åˆ¶jaråŒ…\" $WORKSPACE/zw-search/zw-search/target/$jar_name # æˆæƒ # sudo chmod 777 $project_path/$jar_name # sudo chmod u+x /data/matrix/search/zw-search-1.0-SNAPSHOT.jar #å¯åŠ¨jar eval $runjar echo \"å¯åŠ¨jarå®Œæˆ\" éœ€è¦æ³¨æ„ï¼šè„šæœ¬ä¸­çš„è·¯å¾„ï¼Œéƒ½éœ€è¦ç”¨ç»å¯¹è·¯å¾„ã€‚\nå¦‚æœæ²¡æœ‰æ—¥å¿—ï¼Œå¤šåŠæ˜¯å› ä¸ºæ—¥å¿—æ–‡ä»¶è·¯å¾„å†™é”™äº†ã€‚ å¯ä»¥å…ˆæ‰¾åˆ°è¿›ç¨‹idï¼Œps -efã€‚ç„¶åæŸ¥çœ‹ç¨‹åºçš„æ ‡å‡†è¾“å‡ºï¼š/proc//fd ç›®å½•ä¸­æœ‰å¾ˆå¤šæ•°å­—ï¼Œæ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ•°å­—åˆ™ä»£è¡¨æ–‡ä»¶æè¿°ç¬¦ã€‚å…¶ä¸­1 = stdout, 2 = stderrï¼Œç”¨catæˆ–tailæŸ¥çœ‹å³å¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 /dev/null è¡¨ç¤ºç©ºè®¾å¤‡æ–‡ä»¶ 0 è¡¨ç¤ºstdinæ ‡å‡†è¾“å…¥ 1 è¡¨ç¤ºstdoutæ ‡å‡†è¾“å‡º 2 è¡¨ç¤ºstderræ ‡å‡†é”™è¯¯ \u003e file è¡¨ç¤ºå°†æ ‡å‡†è¾“å‡ºè¾“å‡ºåˆ°fileä¸­ï¼Œä¹Ÿå°±ç›¸å½“äº 1\u003efile 2\u003e error è¡¨ç¤ºå°†é”™è¯¯è¾“å‡ºåˆ°erroræ–‡ä»¶ä¸­ 2\u003e\u00261 ä¹Ÿå°±è¡¨ç¤ºå°†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºä¸Š 2\u003e\u00261 \u003efile ï¼šé”™è¯¯è¾“å‡ºåˆ°ç»ˆç«¯ï¼Œæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶fileï¼Œç­‰äº \u003e file 2\u003e\u00261(æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ï¼Œé”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º)ã€‚ \u0026 æ”¾åœ¨å‘½ä»¤åˆ°ç»“å°¾ï¼Œè¡¨ç¤ºåå°è¿è¡Œï¼Œé˜²æ­¢ç»ˆç«¯ä¸€ç›´è¢«æŸä¸ªè¿›ç¨‹å ç”¨ï¼Œè¿™æ ·ç»ˆç«¯å¯ä»¥æ‰§è¡Œåˆ«åˆ°ä»»åŠ¡ï¼Œé…åˆ \u003efile 2\u003e\u00261å¯ä»¥å°†logä¿å­˜åˆ°æŸä¸ªæ–‡ä»¶ä¸­ï¼Œä½†å¦‚æœç»ˆç«¯å…³é—­ï¼Œåˆ™è¿›ç¨‹ä¹Ÿåœæ­¢è¿è¡Œã€‚å¦‚ command \u003e file.log 2\u003e\u00261 \u0026 ã€‚ nohupæ”¾åœ¨å‘½ä»¤çš„å¼€å¤´ï¼Œè¡¨ç¤ºä¸æŒ‚èµ·ï¼ˆno hang upï¼‰ï¼Œä¹Ÿå³ï¼Œå…³é—­ç»ˆç«¯æˆ–è€…é€€å‡ºæŸä¸ªè´¦å·ï¼Œè¿›ç¨‹ä¹Ÿç»§ç»­ä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œä¸€èˆ¬é…åˆ\u0026ç¬¦å·ä¸€èµ·ä½¿ç”¨ã€‚å¦‚nohup command \u0026ã€‚ éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨ publish over ssh æ’ä»¶æ— æ³•åœ¨jenkinsæ’ä»¶ä¸­å¿ƒæœç´¢åˆ°çš„è§£å†³åŠæ³•ï¼š https://juejin.cn/post/7063299349572222983/\nå‚è€ƒï¼šhttps://www.jianshu.com/p/3ec12f561a9c\nManage Jenkins-\u003eConfigure System æŠŠè¦éƒ¨ç½²çš„è¿œç¨‹æœåŠ¡å™¨ä¿¡æ¯å¡«å¥½ã€‚ Hostnameï¼šè¿œç¨‹æœåŠ¡å™¨çš„ip Portï¼š22 Credentialsï¼šæœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç \næœ€åç‚¹Check connectionï¼Œæµ‹è¯•æ˜¯å¦è¿æ¥æˆåŠŸã€‚\næˆ‘ä»¬ä¸ä½¿ç”¨Publish Over SSHæ’ä»¶ï¼Œå› ä¸ºjenkinsæ’ä»¶ä¸­å¿ƒå·²ç»æœç´¢ä¸åˆ°è¿™ä¸ªæ’ä»¶äº†ã€‚ æ‰€ä»¥è¦åœ¨å®‰è£…jenkinsæœºå™¨ä¸Šå®‰è£…expectï¼Œç”¨shellè„šæœ¬å®ç°æŠŠæ–‡ä»¶å‘é€åˆ°æœåŠ¡å™¨ã€‚\nå®‰è£…expect yum -y install expect\nåœ¨jenkinsæœåŠ¡å™¨çš„åˆ›å»ºè„šæœ¬æ–‡ä»¶ï¼šexpect_scp.sh\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/usr/bin/expect set timeout 100 set host [lindex $argv 0] set username [lindex $argv 1] set password [lindex $argv 2] set src_file [lindex $argv 3] set dest_file [lindex $argv 4] spawn scp $src_file $username@$host:$dest_file expect { \"(yes/no)?\" { send \"yes\\n\" expect \"*assword:\" { send \"$password\\n\"} } \"*assword:\" { send \"$password\\n\" } } expect \"100%\" expect eof ç»™æ­¤æ–‡ä»¶æ‰§è¡Œæƒé™ chmod +x expect_scp\nå¦‚ä¸Šæ‰€ç¤ºï¼Œé€šè¿‡è„šæœ¬ä¾æ¬¡ä¼ å…¥ä¸»æœº ç”¨æˆ·å å¯†ç  æºæ–‡ä»¶è·¯å¾„ ç›®æ ‡æ–‡ä»¶è·¯å¾„å°±å¯ä»¥è‡ªåŠ¨å¡«å……å¯†ç é€šè¿‡scpå‘½ä»¤æŠŠæ–‡ä»¶å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨è·¯å¾„ã€‚\næ–°å»ºexpect_sshè„šæœ¬æ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #!/usr/bin/expect set timeout 100 set host [lindex $argv 0] set username [lindex $argv 1] set password [lindex $argv 2] set shellinfo [lindex $argv 3] spawn ssh $username@$host expect { \"(yes/no)?\" { send \"yes\\n\" expect \"*assword:\" { send \"$password\\n\"} } \"*assword:\" { send \"$password\\n\" } } expect \"*]#\" send \"$shellinfo\\r\" expect \"*]#\" send \"exit\\r\" expect eof ç»™expect_sshæ‰§è¡Œæƒé™ chmod +x expect_ssh\nå¦‚ä¸Šæ‰€ç¤ºï¼Œè„šæœ¬ä¸­ä¾æ¬¡ä¼ å…¥ä¸»æœº ç”¨æˆ·å å¯†ç  è¿œç¨‹å‘½ä»¤ å°±å¯ä»¥åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤äº†ã€‚\nåœ¨jenkinsä¸Šåˆ›å»ºä¸€ä¸ªitemï¼Œé€‰æ‹©Freestyle projectã€‚\nGeneral è¿™é‡Œæœ‰ä¸€ä¸ªThis project is parameterizedé€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥æ„å»ºkey valueå‚æ•°ï¼Œåœ¨è¿™é‡Œæ·»åŠ çš„å‚æ•°åœ¨åç»­æ­¥éª¤ä¸­éƒ½å¯ä»¥ç”¨$å‚æ•°åçš„æ–¹å¼ç›´æ¥å¼•ç”¨å‚æ•°çš„å€¼ï¼Œå°±æ˜¯ä¸ªè‡ªå·±å£°æ˜çš„å˜é‡ã€‚ æœ‰booleanã€stringã€textã€passwordç­‰å¸¸ç”¨ç±»å‹çš„å‚æ•°ã€‚ç‚¹å‡»This project is parameterizedæ·»åŠ å‡ ä¸ªå‚æ•°ï¼Œå¯æ ¹æ®è‡ªèº«éœ€è¦çµæ´»å£°æ˜ã€‚\nstringç±»å‹çš„jarNameï¼Œé»˜è®¤å€¼æ˜¯mavenæ‰“åŒ…åjaråŒ…çš„åå­—ï¼Œä¾‹å¦‚ï¼š zw-zzw-1.0-SNAPSHOT.jar stringç±»å‹çš„projectNameï¼Œå³é¡¹ç›®åã€‚ stringç±»å‹çš„expectScpPathï¼Œä¸Šé¢æ–°å»ºçš„expect_scpå¯è¿è¡Œè„šæœ¬çš„è·¯å¾„ã€‚ stringç±»å‹çš„scpHostï¼Œscpå‘é€æ–‡ä»¶çš„æœåŠ¡å™¨åœ°å€ã€‚ stringç±»å‹çš„scpUserNameï¼Œscpå‘é€æœåŠ¡å™¨çš„ç”¨æˆ·åã€‚ passwordç±»å‹çš„scpPwdï¼Œscpå‘é€æœåŠ¡å™¨çš„å¯†ç ã€‚ stringç±»å‹çš„scpTargetPathï¼Œscpè¿œç¨‹æœåŠ¡å™¨ç›®æ ‡è·¯å¾„åœ°å€ã€‚\nSource Code Managementï¼šå¡«å†™gitä»“åº“çš„åœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚\nBuild Triggersï¼šå•¥éƒ½ä¸é€‰ã€‚ Build Environmentï¼š è¿™é‡Œå¯ä»¥é…ç½®è¿œç¨‹æœåŠ¡å™¨æ„å»ºä¹‹å‰æˆ–ä¹‹åçš„æ“ä½œï¼Œè¿™é‡ŒæŠŠæ„å»ºå®Œæˆä¹‹åå¯¹æœåŠ¡å™¨jaråŒ…çš„å¤‡ä»½å’Œé‡å¯shellå‘½ä»¤é…ç½®åœ¨è¿™é‡Œã€‚ å‹¾é€‰Execute shell script on remote host using ssh\nå¡«å†™Post build scriptï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 cd $scpTargetPath cp $jarName backup/$projectName_$(date +%F-%T).jar pid=$(ps -ef|grep $jarName |egrep -v grep|awk '{print $2}') kill -9 $pid nohup java -jar $jarName \u003e/dev/null 2\u003e\u00261 \u0026 buildï¼š æŠŠmavenæ‰“åŒ…å‘½ä»¤å’Œæ‰“åŒ…å®Œæ¯•ä¹‹åæŠŠåŒ…å‘å¸ƒåˆ°æœåŠ¡å™¨çš„shellå‘½ä»¤é…ç½®åœ¨è¿™ã€‚\n1 2 3 4 5 #!/bin/bash -il pwd cd $projectName/ mvn clean package -Dmaven.test.skip=true $expectScpPath $scpHost $scpUserName $scpPwd target/*.jar $scpTargetPath Post-build Actionsï¼ˆæ„å»ºåæ“ä½œï¼‰ï¼š æ„å»ºå®Œæˆååˆ é™¤workspaceä¸‹æœ¬ä»»åŠ¡ä¸‹è½½çš„ä»£ç æ–‡ä»¶ï¼Œè§†éœ€è¦è€Œå®šï¼Œä¹Ÿå¯ä»¥ä¸åˆ é™¤ã€‚\n",
  "wordCount" : "11528",
  "inLanguage": "en",
  "datePublished": "2018-11-09T16:54:53Z",
  "dateModified": "2018-11-09T16:54:53Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://funny-toffee-4aa7c3.netlify.app/posts/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/jenkins/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://funny-toffee-4aa7c3.netlify.app/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://funny-toffee-4aa7c3.netlify.app/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/links" title="ğŸ¤å‹é“¾">
                    <span>ğŸ¤å‹é“¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://funny-toffee-4aa7c3.netlify.app/">Home</a>&nbsp;Â»&nbsp;<a href="https://funny-toffee-4aa7c3.netlify.app/posts/">Posts</a></div>
    <h1 class="post-title">
      Jenkins
    </h1>
    <div class="post-meta"><span title='2018-11-09 16:54:53 +0000 UTC'>2018-11-09</span>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%ae%80%e4%bb%8b" aria-label="ç®€ä»‹">ç®€ä»‹</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e9%83%a8%e7%bd%b2" aria-label="å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²</a></li>
                <li>
                    <a href="#docker%e7%89%88%e7%9a%84jenkins" aria-label="dockerç‰ˆçš„Jenkins">dockerç‰ˆçš„Jenkins</a><ul>
                        
                <li>
                    <a href="#%e7%94%9f%e6%88%90sshkey" aria-label="ç”ŸæˆSSHKey">ç”ŸæˆSSHKey</a></li>
                <li>
                    <a href="#%e5%90%8e%e7%bb%ad%e6%ad%a5%e9%aa%a4" aria-label="åç»­æ­¥éª¤">åç»­æ­¥éª¤</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96%e5%8f%af%e9%80%89%e6%93%8d%e4%bd%9c" aria-label="å…¶ä»–å¯é€‰æ“ä½œ">å…¶ä»–å¯é€‰æ“ä½œ</a></li></ul>
                </li>
                <li>
                    <a href="#jenkins%e9%85%8d%e7%bd%ae" aria-label="Jenkinsé…ç½®">Jenkinsé…ç½®</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b6" aria-label="å®‰è£…æ’ä»¶">å®‰è£…æ’ä»¶</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b6%e6%8f%90%e9%80%9f" aria-label="å®‰è£…æ’ä»¶æé€Ÿ">å®‰è£…æ’ä»¶æé€Ÿ</a></li>
                <li>
                    <a href="#jenkins%e5%8d%87%e7%ba%a7" aria-label="Jenkinså‡çº§">Jenkinså‡çº§</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%8c%81%e7%bb%ad%e9%9b%86%e6%88%90%e9%85%8d%e7%bd%ae" aria-label="æŒç»­é›†æˆé…ç½®">æŒç»­é›†æˆé…ç½®</a><ul>
                        
                <li>
                    <a href="#%e6%9c%ac%e5%9c%b0%e9%83%a8%e7%bd%b2" aria-label="æœ¬åœ°éƒ¨ç½²">æœ¬åœ°éƒ¨ç½²</a></li>
                <li>
                    <a href="#%e8%bf%9c%e7%a8%8b%e9%83%a8%e7%bd%b2" aria-label="è¿œç¨‹éƒ¨ç½²">è¿œç¨‹éƒ¨ç½²</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%9d%83%e9%99%90%e5%88%86%e9%85%8d" aria-label="æƒé™åˆ†é…">æƒé™åˆ†é…</a></li>
                <li>
                    <a href="#%e9%97%ae%e9%a2%98" aria-label="é—®é¢˜">é—®é¢˜</a><ul>
                        
                <li>
                    <a href="#tempjenkins138035565033548290sh-line-5-mvn-command-not-found" aria-label="temp/jenkins138035565033548290.sh: line 5: mvn: command not found">temp/jenkins138035565033548290.sh: line 5: mvn: command not found</a></li>
                <li>
                    <a href="#jenkins%e5%8d%b8%e8%bd%bd" aria-label="jenkinså¸è½½">jenkinså¸è½½</a></li>
                <li>
                    <a href="#jenkins%e5%8d%a0%e7%94%a8%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%a1%ac%e7%9b%98%e8%bf%87%e5%a4%a7" aria-label="jenkinså ç”¨æœåŠ¡å™¨ç¡¬ç›˜è¿‡å¤§">jenkinså ç”¨æœåŠ¡å™¨ç¡¬ç›˜è¿‡å¤§</a></li>
                <li>
                    <a href="#%e8%87%aa%e5%8a%a8%e5%8c%96%e8%84%9a%e6%9c%ac%e9%94%99%e8%af%af" aria-label="è‡ªåŠ¨åŒ–è„šæœ¬é”™è¯¯">è‡ªåŠ¨åŒ–è„šæœ¬é”™è¯¯</a></li>
                <li>
                    <a href="#we-trust-you-have-received-the-usual-lecture-from-the-local-system" aria-label="We trust you have received the usual lecture from the local System">We trust you have received the usual lecture from the local System</a></li>
                <li>
                    <a href="#%e9%87%8d%e8%a3%85jenkins" aria-label="é‡è£…jenkins">é‡è£…jenkins</a></li></ul>
                </li>
                <li>
                    <a href="#jenkins%e6%8c%87%e5%ae%9aspring-boot%e7%9a%84%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="jenkinsæŒ‡å®šspring bootçš„é…ç½®æ–‡ä»¶">jenkinsæŒ‡å®šspring bootçš„é…ç½®æ–‡ä»¶</a></li>
                <li>
                    <a href="#jenkins%e9%85%8d%e7%bd%ae%e5%88%86%e5%b8%83%e5%bc%8f%e5%ba%94%e7%94%a8%e6%97%b6%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6%e9%97%ae%e9%a2%98" aria-label="jenkinsé…ç½®åˆ†å¸ƒå¼åº”ç”¨æ—¶æ—¥å¿—æ–‡ä»¶é—®é¢˜ã€‚">jenkinsé…ç½®åˆ†å¸ƒå¼åº”ç”¨æ—¶æ—¥å¿—æ–‡ä»¶é—®é¢˜ã€‚</a></li>
                <li>
                    <a href="#%e9%83%a8%e7%bd%b2%e6%99%ae%e9%80%9aspring-boot-%e9%a1%b9%e7%9b%ae" aria-label="éƒ¨ç½²æ™®é€šspring boot é¡¹ç›®">éƒ¨ç½²æ™®é€šspring boot é¡¹ç›®</a><ul>
                        
                <li>
                    <a href="#general" aria-label="General">General</a></li>
                <li>
                    <a href="#source-code-management" aria-label="Source Code Management">Source Code Management</a></li>
                <li>
                    <a href="#build-triggers" aria-label="Build Triggers">Build Triggers</a></li>
                <li>
                    <a href="#pre-steps%e4%b9%8b%e5%89%8d%e7%9a%84%e6%ad%a5%e9%aa%a4" aria-label="Pre Steps(ä¹‹å‰çš„æ­¥éª¤)">Pre Steps(ä¹‹å‰çš„æ­¥éª¤)</a></li>
                <li>
                    <a href="#build" aria-label="Build">Build</a></li>
                <li>
                    <a href="#post-steps%e5%8f%91%e5%b8%83%e6%ad%a5%e9%aa%a4" aria-label="Post Stepsï¼ˆå‘å¸ƒæ­¥éª¤ï¼‰">Post Stepsï¼ˆå‘å¸ƒæ­¥éª¤ï¼‰</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%83%a8%e7%bd%b2%e5%88%b0%e8%bf%9c%e7%a8%8b%e6%9c%8d%e5%8a%a1%e5%99%a8" aria-label="éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨">éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="ç®€ä»‹">ç®€ä»‹<a hidden class="anchor" aria-hidden="true" href="#ç®€ä»‹">#</a></h1>
<p>Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨éƒ¨ç½²æœåŠ¡å™¨ï¼Œæä¾›äº†ä¸Šç™¾ä¸ªæ’ä»¶ç”¨äºè‡ªåŠ¨æ„å»ºã€éƒ¨ç½²ã€å‘å¸ƒä»»æ„é¡¹ç›®ã€‚æœ¬æ–‡æè¿°çš„æ˜¯Jenkinsæœ¬åœ°éƒ¨ç½²ä»¥åŠè¿œç¨‹éƒ¨ç½²ç­‰åŠŸèƒ½çš„å®ç°ã€‚
<a href="https://jenkins.io/zh/">è¿™æ˜¯jenkinsä¸­æ–‡ç½‘</a></p>
<h1 id="å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²<a hidden class="anchor" aria-hidden="true" href="#å®‰è£…éƒ¨ç½²">#</a></h1>
<p>Jenkinsä¸»è¦æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼Œyumå®‰è£…ã€ä½¿ç”¨å®˜æ–¹dockeré•œåƒå’Œå®˜æ–¹waråŒ…ï¼Œæ”¾åˆ°tomcatä¸­ç›´æ¥è¿è¡Œã€‚æˆ‘ä»¬é‡‡ç”¨æ¯”è¾ƒç†Ÿæ‚‰çš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œå³å°†Jenkinséƒ¨ç½²åœ¨Tomcatå®¹å™¨ä¸­ï¼Œæ— éœ€ä»»ä½•é…ç½®ï¼Œç›´æ¥å¯åŠ¨tomcatå³å¯ã€‚</p>
<p>å®‰è£…tomcatå’Œjdkè¿™é‡Œä¸å†èµ˜è¿°ã€‚
<a href="https://jenkins.io/download/">å®˜ç½‘ä¸‹è½½</a>
å·¦ä¾§åˆ—è¡¨æ˜¯ç¨³å®šç‰ˆï¼Œå³ä¾§æ˜¯å¼€å‘ç‰ˆï¼Œè¿™é‡Œæˆ‘ä»¬ä¸‹è½½å·¦ä¾§åˆ—è¡¨çš„ç¨³å®šç‰ˆã€‚æ‰¾åˆ°é€‚åˆè‡ªå·±ç³»ç»Ÿçš„ç‰ˆæœ¬ä¸‹è½½ï¼Œè¿™é‡Œæˆ‘ä¸‹è½½<code>Generic Java package (.war)</code>ï¼Œé€šç”¨çš„java-waråŒ…ã€‚
ä¸‹è½½å¹¶ä¸Šä¼ åˆ°tomcatçš„webappsç›®å½•ä¸‹ï¼Œå°†waråŒ…æ›´åä¸º<code>ROOT.war</code>ï¼Œç„¶åå¯åŠ¨tomcatï¼Œ<code>./startup.sh</code></p>
<p>æˆ–è€…é€šè¿‡wgetç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo wget https://get.jenkins.io/war-stable/2.319.3/jenkins.war
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„æ›´æ¢æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<h1 id="dockerç‰ˆçš„jenkins">dockerç‰ˆçš„Jenkins<a hidden class="anchor" aria-hidden="true" href="#dockerç‰ˆçš„jenkins">#</a></h1>
<p>è¦ä½¿ç”¨dockeré•œåƒï¼Œé¦–å…ˆå®‰è£…dockerï¼Œæœ¬æ–‡é»˜è®¤å·²ç»å®‰è£…dockerã€‚æˆ‘ä»¬å¯ä»¥åˆ°<a href="https://jenkins.io/download/">Jenkinså®˜ç½‘</a>å¯»æ‰¾dockeré•œåƒåœ°å€ã€‚
æ³¨æ„ï¼šå®˜æ–¹jenkinsé•œåƒæœ¬èº«è‡ªå¸¦openjdkã€‚
æ‰¾åˆ°<code>Download jenkins xxx for</code>ä¸‹è¾¹çš„<code>docker</code>ï¼Œç‚¹å‡»åä¼šè·³è½¬åˆ°docker hubï¼Œè¯¥ç½‘ç«™æ˜¯dockerçš„å®˜æ–¹é•œåƒä»“åº“ï¼Œå°±åƒgithubæ˜¯ä»£ç ä»“åº“ä¸€ä¸ªé“ç†ã€‚</p>
<p>ç½‘é¡µå³ä¾§å¯ä»¥çœ‹åˆ°Jenkinsçš„dockerä¸‹è½½å‘½ä»¤ï¼š
<code>docker pull jenkins/jenkins</code></p>
<p>ç­‰å¾…ä¸‹è½½å®Œæˆï¼Œè¾“å…¥å‘½ä»¤æŸ¥çœ‹ä¸‹è½½å®Œæˆçš„é•œåƒï¼š
<code>docker images</code></p>
<p>å¯ä»¥çœ‹åˆ°jenkinså·²ç»è¢«ä¸‹è½½åˆ°æœåŠ¡å™¨ã€‚é•œåƒä¸‹è½½å®Œæˆï¼Œä¸‹é¢å°±è¦å¼€å§‹å¯åŠ¨å®¹å™¨äº†ã€‚
å¯åŠ¨å®¹å™¨å‰ï¼Œå»ºè®®å¤§å®¶ä»”ç»†é˜…è¯»å‰é¢å¯»æ‰¾é•œåƒæ—¶<a href="https://github.com/jenkinsci/docker/blob/master/README.md">Docker Hubä¸Šå…³äºjenkinsé•œåƒçš„è¯¦ç»†è¯´æ˜</a>ã€‚
å¯åŠ¨ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨å®¿ä¸»æœºåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä¸€ä¼šæ–¹ä¾¿é•œåƒæŒ‚è½½ã€‚
<code>mkdir /home/jenkins</code>
è¿˜è¦ç»™åˆ›å»ºçš„ç›®å½•èµ‹äºˆæƒé™ï¼Œè¿™ä¸€æ­¥æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™å¯åŠ¨é•œåƒä¼šæŠ¥é”™ï¼š
<code>chmod 777 /home/jenkins</code>
åœ¨é•œåƒæ–‡æ¡£é‡Œï¼Œæˆ‘ä»¬çŸ¥é“Jenkinsè®¿é—®çš„é»˜è®¤ç«¯å£å·æ˜¯8080ï¼Œè¿™é‡Œæˆ‘æ”¹æˆ9999ï¼Œå¦å¤–è¿˜éœ€è¦æš´éœ²ä¸€ä¸ªtcpçš„ç«¯å£å·50000ã€‚æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨Jenkinsé•œåƒã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>docker run --name jenkins -d \
</span></span><span style="display:flex;"><span>-v /usr/local/src:/share \
</span></span><span style="display:flex;"><span>-v /home/jenkins:/var/jenkins_home \
</span></span><span style="display:flex;"><span>-v /etc/localtime:/etc/localtime \
</span></span><span style="display:flex;"><span>-p 9999:8080 -p 50000:50000 \
</span></span><span style="display:flex;"><span>jenkins
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œé€æ¡è§£é‡Šä¸‹å„å‚æ•°çš„æ„ä¹‰ã€‚</p>
<ul>
<li><code>-d</code>åå°è¿è¡Œé•œåƒ</li>
<li><code>-p 9999:8080</code> å°†é•œåƒçš„8080ç«¯å£æ˜ å°„åˆ°æœåŠ¡å™¨çš„9999ç«¯å£</li>
<li><code>-p 50000:50000</code> å°†é•œåƒçš„50000ç«¯å£æ˜ å°„åˆ°æœåŠ¡å™¨çš„50000ç«¯å£</li>
<li><code>-v /usr/local/src:/share</code> å°†<code>/usr/local/src</code>ç›®å½•ä½œä¸ºå…±äº«æ–‡ä»¶å¤¹ï¼Œæ–¹ä¾¿å‘dockerå®¹å™¨ä¸­ä¼ è¾“å®‰è£…åŒ…ç­‰ã€‚</li>
<li><code>-v /home/jenkins:/var/jenkins_home</code> /var/jenkins_homeç›®å½•ä¸ºjenkinså·¥ä½œç›®å½•ï¼Œæˆ‘ä»¬å°†ç¡¬ç›˜ä¸Šçš„ä¸€ä¸ªç›®å½•æŒ‚è½½åˆ°è¿™ä¸ªä½ç½®ï¼Œæ–¹ä¾¿åç»­æ›´æ–°é•œåƒåç»§ç»­ä½¿ç”¨åŸæ¥çš„å·¥ä½œç›®å½•ã€‚</li>
<li><code>-v /etc/localtime:/etc/localtime</code> è®©å®¹å™¨ä½¿ç”¨å’ŒæœåŠ¡å™¨åŒæ ·çš„æ—¶é—´è®¾ç½®ã€‚</li>
<li><code>--name jenkins</code> ç»™å®¹å™¨èµ·ä¸€ä¸ªåˆ«å</li>
<li><code>jenkins</code> æŒ‡å®šä¸€ä¸ªé•œåƒï¼Œè¿™ä¸ªå¿…é¡»ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå»ºè®®ç›´æ¥å¡«å†™<code>IMAGE</code>ï¼Œå°±æ˜¯ç±»ä¼¼<code>f32b4bb22e4d</code>ï¼Œè€Œä¸æ˜¯åå­—ï¼Œå¦åˆ™ä¼šå»é‡æ–°ä¸‹è½½é•œåƒã€‚</li>
</ul>
<p>æ³¨æ„ï¼šå¦‚æœä½ éœ€è¦æ˜ å°„å¤šä¸ªç«¯å£æˆ–æŒ‚è½½å¤šä¸ªç›®å½•ï¼Œæœ€å¥½åœ¨å¯åŠ¨æ—¶éƒ½æŒ‡å®šå¥½ï¼Œä¸ç„¶å®¹å™¨å¯åŠ¨åï¼Œä¿®æ”¹æ˜ å°„ç«¯å£æˆ–æŒ‚è½½ç›®å½•ä¸å¤ªæ–¹ä¾¿ï¼Œä¿®æ”¹å¯ä»¥å‚è€ƒæˆ‘çš„dockeræ–‡ç« ã€‚</p>
<p>å¯åŠ¨åè¾“å…¥å‘½ä»¤docker ps -aæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼Œå¯ä»¥çœ‹åˆ°jenkinså·²æˆåŠŸå¯åŠ¨ã€‚
åœ¨æµè§ˆå™¨è¾“å…¥ip+ç«¯å£è¿›å…¥Jenkinsç™»å½•é¡µé¢ã€‚é¡µé¢ä¼šæç¤ºä½ åˆ°æœåŠ¡å™¨çš„æŒ‡å®šä½ç½®è·å–åˆå§‹åŒ–å¯†ç ã€‚
è¿›å…¥jenkinså®¹å™¨ï¼š<code>docker exec -it jenkins /bin/bash</code>
æŸ¥çœ‹å¯†ç ï¼š<code>cat /var/jenkins_home/secrets/initialAdminPassword</code>
æŠŠå¯†ç å¤åˆ¶åˆ°æµè§ˆå™¨ï¼Œç„¶åå’Œæ­£å¸¸å®‰è£…æ­¥éª¤ä¸€è‡´ã€‚</p>
<p>æ³¨æ„ï¼Œdockerå®¹å™¨ä½¿ç”¨çš„ç¯å¢ƒï¼Œå¦‚jdkï¼Œmavenç­‰ç­‰ï¼Œéƒ½åº”è¯¥åœ¨å®¹å™¨ä¸­å•ç‹¬å®‰è£…ã€‚ä¸è¦æƒ³ç€å’Œå®¿ä¸»æœºå…±ç”¨ä¸€å¥—ç¯å¢ƒã€‚</p>
<h2 id="ç”Ÿæˆsshkey">ç”ŸæˆSSHKey<a hidden class="anchor" aria-hidden="true" href="#ç”Ÿæˆsshkey">#</a></h2>
<p>è¿™é‡Œå†è¡¥å……ä¸€ç« è¯´æ˜å¦‚ä½•ç”ŸæˆSSHKeyã€‚å®¹å™¨ä»githubä¸Šé¢ä¸‹è½½ä»£ç çš„æ—¶å€™éœ€è¦ç”¨åˆ°ã€‚å› ä¸ºå’±ä»¬è¿™ä¸ªJenkinsæ˜¯åŸºäºdockerçš„ï¼Œä¸æ˜¯ç›´æ¥å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿™é‡Œæœ‰å¾ˆå¤§çš„ä¸åŒã€‚
è¦ç”Ÿæˆå®¹å™¨çš„SSHKeyï¼Œé¦–å…ˆè¦å…ˆè¿›å…¥å®¹å™¨
<code>docker exec -it jenkins /bin/bash</code>
è¿›å…¥å®¹å™¨åç”Ÿæˆsshkey
<code>ssh-keygen -t rsa -C &quot;123@qq.com&quot;</code>
åœ¨å®¹å™¨å†…è¾“å…¥exitç¦»å¼€å®¹å™¨ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–å…¬é’¥
<code>tail /var/lib/docker/volumes/jenkins/_data/.ssh/id_rsa.pub</code>
<a href="https://www.jianshu.com/p/0391e225e4a6">å‚è€ƒåœ°å€</a></p>
<h2 id="åç»­æ­¥éª¤">åç»­æ­¥éª¤<a hidden class="anchor" aria-hidden="true" href="#åç»­æ­¥éª¤">#</a></h2>
<p>æƒ³éƒ¨ç½²javaé¡¹ç›®ï¼Œè¿˜éœ€è¦å®‰è£…Mavenå’Œjdkç¯å¢ƒã€‚
Manage Jenkins -&gt; Global Tool Configuration</p>
<ul>
<li>é€‰æ‹©è‡ªåŠ¨å®‰è£…jdk1.8ï¼Œéœ€è¦ä½ å¡«å…¥oracleçš„è´¦å·å¯†ç ã€‚</li>
<li>é€‰æ‹©è‡ªåŠ¨å®‰è£…Maven</li>
<li>é€‰æ‹©è‡ªåŠ¨å®‰è£…git</li>
</ul>
<h2 id="å…¶ä»–å¯é€‰æ“ä½œ">å…¶ä»–å¯é€‰æ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#å…¶ä»–å¯é€‰æ“ä½œ">#</a></h2>
<ul>
<li>
<p>å·²rootæ–¹å¼è¿›å…¥å®¹å™¨
<code>docker exec -it --user root &lt;container id&gt; /bin/bash</code></p>
</li>
<li>
<p>ä¹Ÿå¯ä»¥æ™®é€šè¿›å…¥ï¼Œå†åˆ‡æ¢rootï¼Œä¸è¿‡ä¹Ÿéœ€è¦æå‰å†rootç”¨æˆ·ä¸‹è®¾ç½®å¥½å¯†ç ã€‚
rootç”¨æˆ·è¿›å…¥å®¹å™¨ä¹‹åï¼Œè®¾ç½®å¯†ç ï¼š
<code>sudo passwd</code>
è¿ç»­è¾“å…¥ä¸¤æ¬¡å¯†ç å°±å¯ä»¥äº†ã€‚</p>
</li>
<li>
<p>å…ˆæŸ¥çœ‹å®¹å™¨æ˜¯ä»€ä¹ˆæ“ä½œç³»ç»Ÿï¼Œç›´æ¥è¯•æŒ‡ä»¤ï¼Œ<code>yum</code>æˆ–<code>apt-get</code>ï¼Œå“ªä¸ªè¯´<code>command not found</code>ï¼Œå°±ä¸ç”¨å“ªä¸ªã€‚
å‘ç°<code>apt-getå¯ç”¨</code>ï¼Œé‚£ä¹ˆå¿…é¡»å…ˆå‡çº§<code>apt-get</code>ï¼š<code>apt-get update</code>ï¼Œåä¹‹è¦å‡çº§<code>yum</code>ï¼š<code>yum update</code></p>
</li>
<li>
<p>å®‰è£…vim
<code>apt-get install vim</code></p>
</li>
<li>
<p>å®‰è£…sudo
<code>apt-get install sudo</code></p>
</li>
<li>
<p>å¯é€‰æ˜¯å¦å¸è½½è‡ªå¸¦çš„openjdkï¼Œä¸å¸è½½Openjdkä¹Ÿå¯ä»¥ç›´æ¥å®‰è£…oracleçš„jdkï¼Œç„¶åä¿®æ”¹<code>/etc/profile</code>çš„ç¯å¢ƒå˜é‡ã€‚</p>
</li>
</ul>
<h1 id="jenkinsé…ç½®">Jenkinsé…ç½®<a hidden class="anchor" aria-hidden="true" href="#jenkinsé…ç½®">#</a></h1>
<p>è®¿é—®Jenkinsåœ°å€ï¼Œåˆæ¬¡è¿›å…¥ä¼šè¦æ±‚è¾“å…¥å¯†ç ï¼Œå¯†ç å·²ç»æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ã€‚
ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒLinuxä¸Šå­˜å‚¨å¯†ç çš„ä½ç½®ï¼š
<code>/root/.jenkins/secrets/initialAdminPassword</code>
windowsä¸‹å¯†ç çš„ä½ç½®ï¼š
<code>C:\Users\59923\.jenkins\secrets\initialAdminPassword</code></p>
<p>æ‰¾åˆ°è¯¥æ–‡ä»¶å¤åˆ¶é‡Œé¢çš„å†…å®¹ï¼Œè¿›å…¥åˆ°åˆå§‹åŒ–é¡µé¢ï¼Œä¼šæç¤ºå®‰è£…æ’ä»¶ã€‚æˆ‘ä»¬ä¸åœ¨è¿™é‡Œå®‰è£…æ’ä»¶ï¼Œä¸è¦é€‰<code>Install suggested plugins(å®‰è£…æ¨èæ’ä»¶)</code>ï¼Œå› ä¸ºä¼šå®‰è£…å¾ˆå¤šæˆ‘ä»¬ç”¨ä¸åˆ°çš„æ’ä»¶ï¼Œè€Œä¸”å·¨æ…¢ã€‚
é€‰æ‹©è‡ªå®šä¹‰ï¼Œç„¶åå°†å‹¾å…¨éƒ¨å»æ‰ï¼Œç„¶åç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚æŒ‰ç…§æç¤ºè¾“å…¥å†…å®¹ï¼Œç®¡ç†å‘˜çš„ç”¨æˆ·åå¯†ç ç­‰è¦ç‰¢è®°ã€‚æœ€åç‚¹å‡»å®Œæˆï¼Œå°±è¿›å…¥åˆ°äº†jenkinsçš„æ§åˆ¶å°ã€‚é•¿æ—¶é—´æ²¡ååº”ï¼Œè¯·é‡å¯jenkinsã€‚</p>
<h1 id="å®‰è£…æ’ä»¶">å®‰è£…æ’ä»¶<a hidden class="anchor" aria-hidden="true" href="#å®‰è£…æ’ä»¶">#</a></h1>
<p>è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å®‰è£…æˆ‘ä»¬éœ€è¦çš„æ’ä»¶å³å¯ã€‚</p>
<ul>
<li>é€‰æ‹©å·¦ä¾§åˆ—è¡¨çš„<code>Manage Jenkins</code></li>
<li>ç„¶ååœ¨å³ä¾§åˆ—è¡¨æ‰¾åˆ°<code>Manage Plugins</code></li>
<li>åœ¨å³ä¾§å¯ä»¥çœ‹åˆ°ä¸Šè¾¹æœ‰å››ä¸ªé€‰é¡¹å¡ï¼Œæˆ‘ä»¬é€‰æ‹©<code>Avaliable</code>
è¿™é‡Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸‰ä¸ªæ’ä»¶ï¼š
<ul>
<li>git</li>
<li>mavené›†æˆæ’ä»¶ï¼šMaven Integration</li>
<li>Jenkinsè¯­è¨€æ’ä»¶ï¼ˆå¯é€‰ï¼‰ï¼šLocale</li>
<li>è¿œç¨‹éƒ¨ç½²æ’ä»¶ï¼šPublish Over SSH</li>
</ul>
</li>
</ul>
<p>ç„¶åé€‰æ‹©<code>install without restart</code>ã€‚
å¦‚æœå®‰è£…äº†è¯­è¨€æ’ä»¶ï¼Œè¿˜é…ç½®æˆä¸­æ–‡æ‰å¯ä»¥ï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„Jenkinså›¾æ ‡è¿”å›ä¸»é¡µï¼Œå†æ¬¡è¿›å…¥Jenkinsé…ç½®é¡µé¢ï¼Œé€‰æ‹©ç³»ç»Ÿè®¾ç½®Configure Systemï¼Œæ‰¾åˆ°localé…ç½®ï¼Œè¾“å…¥ï¼šZH_cn
ç®€ä½“ä¸­æ–‡ä¸ºZH_cnï¼Œè‹±æ–‡ä¸ºEN_usï¼Œç„¶åå‹¾é€‰Ignore brower preference and force this language to all usersã€‚</p>
<h2 id="å®‰è£…æ’ä»¶æé€Ÿ">å®‰è£…æ’ä»¶æé€Ÿ<a hidden class="anchor" aria-hidden="true" href="#å®‰è£…æ’ä»¶æé€Ÿ">#</a></h2>
<p>çœ‹åˆ°å¥½å¤šåŠ é€ŸJenkinså®‰è£…æ’ä»¶é€Ÿåº¦çš„æ–‡ç« ï¼Œå¤§å¤šæ•°æ•™ç¨‹ä¸­éƒ½æ˜¯åœ¨æ’ä»¶é…ç½®é‡Œä½¿ç”¨
<code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code>
æ›¿æ¢åŸæ¥çš„å®˜æ–¹çš„jsonï¼Œæ›¿æ¢ä¹‹åé€šè¿‡urlå…¨å±€æœç´¢ï¼Œå‘ç°æ¯ä¸ªæ’ä»¶ä¸‹è½½è·¯å¾„ä¾æ—§æ²¡æœ‰æ”¹å˜ï¼Œé…ç½®å†…å†™æ­»çš„æ’ä»¶ä¸‹è½½åœ°å€æ˜¯æ²¡æœ‰å˜çš„ï¼Œè¿˜æ˜¯ä»å®˜ç½‘ä¸‹è½½ï¼è¿™çœŸæ˜¯ä»¤äººå¿ƒç—›ï¼ğŸ’”â€‹
ä»¥ä¸Šçš„é…ç½®Jsonå…¶å®åœ¨Jenkinsçš„å·¥ä½œç›®å½•ä¸­ã€‚
è¿›å…¥æ›´æ–°é…ç½®ä½ç½®
<code>cd /root/.jenkins/updates</code></p>
<p><code>vim default.json</code>
è¿™ä¸ªJsonæ–‡ä»¶ä¸ä¸Šè¾¹çš„é…ç½®æ–‡ä»¶æ˜¯ç›¸åŒçš„ã€‚</p>
<p>ä½¿ç”¨vimçš„å‘½ä»¤ï¼Œå¦‚ä¸‹ï¼Œæ›¿æ¢æ‰€æœ‰æ’ä»¶ä¸‹è½½çš„url
<code>:1,$s/http:\/\/updates.jenkins-ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g</code>
æ›¿æ¢è¿æ¥æµ‹è¯•url
<code>:1,$s/http:\/\/www.google.com/https:\/\/www.baidu.com/g</code>
è¿›å…¥vimå…ˆè¾“å…¥ï¼šç„¶åå†ç²˜è´´ä¸Šè¾¹çš„ï¼šåè¾¹çš„å‘½ä»¤ï¼Œæ³¨æ„ä¸è¦å†™ä¸¤ä¸ªå†’å·ï¼
ä¿å­˜é€€å‡ºï¼Œå¹¶é‡å¯jenkinsã€‚</p>
<p>æ–¹å¼äºŒï¼šä½¿ç”¨sed
<code>$ sed -i 's/http:\/\/updates.jenkins-ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g' default.json &amp;&amp; sed -i 's/http:\/\/www.google.com/https:\/\/www.baidu.com/g' default.json</code>
è¿™æ˜¯ç›´æ¥ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœå‰è¾¹Jenkinsç”¨sudoå¯åŠ¨çš„è¯ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ä¸¤ä¸ªsedå‰å‡éœ€è¦åŠ ä¸Šsudoã€‚
é‡å¯Jenkinsï¼Œå®‰è£…æ’ä»¶è¯•è¯•ï¼Œç®€ç›´å…‰é€Ÿã€‚</p>
<p><a href="https://www.cnblogs.com/hellxz/p/jenkins_install_plugins_faster.html">å®‰è£…æ’ä»¶æé€Ÿå‚è€ƒ</a></p>
<h2 id="jenkinså‡çº§">Jenkinså‡çº§<a hidden class="anchor" aria-hidden="true" href="#jenkinså‡çº§">#</a></h2>
<p>ä»Šå¤©å‘ç°æ—§ç‰ˆæœ¬çš„jenkinså·²ç»æ— æ³•å®‰è£…æ’ä»¶äº†ï¼Œå¿…é¡»å‡çº§æˆæ–°ç‰ˆæœ¬ã€‚
å¦‚æœæ˜¯é€šè¿‡tomcatè¿è¡Œçš„waråŒ…ï¼Œåªéœ€åœ¨å®˜ç½‘ä¸‹è½½æœ€æ–°çš„waråŒ…ï¼Œç„¶åæ›¿æ¢åˆ°tomcatçš„webappsé‡Œçš„root.warï¼Œé‡å¯tomcatå³å¯ã€‚</p>
<h1 id="æŒç»­é›†æˆé…ç½®">æŒç»­é›†æˆé…ç½®<a hidden class="anchor" aria-hidden="true" href="#æŒç»­é›†æˆé…ç½®">#</a></h1>
<p>æœåŠ¡å™¨éœ€è¦å®‰è£…ï¼šjdkã€gitã€mavenï¼Œå®‰è£…å¥½ä¹‹åï¼Œéœ€è¦åœ¨jenkinsä¸­è¿›è¡Œé…ç½®ã€‚</p>
<p>ç³»ç»Ÿç®¡ç† -&gt;å…¨å±€å·¥å…·é…ç½®
Manage Jenkins -&gt; Global Tool Configuration</p>
<p>ç„¶åå¡«å…¥æœ¬æœºgit/maven/jdkçš„å®‰è£…è·¯å¾„ã€‚
jdkï¼š
ä¸è¦å‹¾é€‰è‡ªåŠ¨å®‰è£…ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æ‰‹åŠ¨å®‰è£…å¥½ï¼Œè¿™é‡Œåªéœ€è¦å¡«å†™<code>JAVA_HOME</code>å³å¯ï¼Œåˆ«åå¯ä¸å¡«ã€‚
<code>/usr/local/jdk1.8.0_211</code></p>
<p>gitï¼š
ä¸å‹¾é€‰è‡ªåŠ¨å®‰è£…ï¼Œåªå¡«å†™<code>Path to Git executable</code>
<code>/usr/local/git/bin/git</code></p>
<p>æŸ¥æ‰¾gitå®‰è£…è·¯å¾„
<code>whereis git</code>
<code>git: /usr/local/git /usr/local/git/bin/git</code></p>
<p>å¦‚ä¸Šé¢<code>whereis git</code>çš„åœ°å€ä¸º<code>/usr/local/git</code>ï¼Œåˆ™åº”è¯¥å¡«å…¥<code>/usr/local/git/bin/git</code></p>
<p>mavenï¼š
ä¸å‹¾é€‰è‡ªåŠ¨å®‰è£…ï¼Œåªå¡«å†™<code>MAVEN_HOME</code>
<code>/usr/local/maven</code></p>
<h2 id="æœ¬åœ°éƒ¨ç½²">æœ¬åœ°éƒ¨ç½²<a hidden class="anchor" aria-hidden="true" href="#æœ¬åœ°éƒ¨ç½²">#</a></h2>
<p>æœ¬åœ°éƒ¨ç½²æ˜¯æŒ‡ï¼šéƒ¨ç½²è¿è¡Œåœ¨æœ¬æœºçš„æœåŠ¡ï¼Œè‹¥é¡¹ç›®éƒ¨ç½²åœ¨å…¶ä»–æœåŠ¡å™¨ï¼Œåˆ™éœ€è¦è¿œç¨‹éƒ¨ç½²ã€‚</p>
<p>åœ¨ä¸»é¡µé€‰æ‹©æ–°å»ºä»»åŠ¡ï¼Œé€‰æ‹©æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œç”±äºå…¬å¸é¡¹ç›®ç»“æ„ä¸ºçˆ¶å­é¡¹ç›®
<img loading="lazy" src="1.png" alt=""  />

æ‰€æœ‰çš„å­é¡¹ç›®éƒ½åœ¨tubitu_projectä¸€ä¸ªä»£ç ä»“åº“é‡Œï¼Œå¦‚æœé…ç½®äº†webhook(ä½œç”¨æ˜¯æ¥æ”¶è¿œç¨‹ä»“åº“pushçš„æäº¤ä¿¡æ¯)çš„è¯ï¼Œä»»ä½•ä¸€ä¸ªå­é¡¹ç›®çš„ä»£ç æ¨é€ï¼Œéƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡çš„è‡ªåŠ¨é‡å¯ï¼Œè€Œç”±äºå…¬å¸æ²¡æœ‰æ­£è§„çš„ä»£ç æäº¤å®¡æŸ¥æµç¨‹ï¼Œæ‰€ä»¥å¦‚æœæäº¤é”™è¯¯ä»£ç ï¼Œä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡ä¸€åŒå´©æºƒï¼Œå› æ­¤ï¼Œæ¨èæ¯ä¸€ä¸ªæœåŠ¡éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„éƒ¨ç½²ä»»åŠ¡ï¼Œæäº¤ä»£ç ååªéœ€è¦æ›´æ–°æäº¤ä»£ç çš„æœåŠ¡å³å¯ã€‚æœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š
<img loading="lazy" src="2.png" alt=""  />
</p>
<p>é…ç½®æµç¨‹ï¼š
é¦–å…ˆæ–°å»ºä¸€ä¸ªä»»åŠ¡ï¼Œé€‰æ‹©<code>æ„å»ºmavené¡¹ç›®</code>ï¼Œè¾“å…¥åç§°ï¼Œç„¶åè¿›å…¥é…ç½®é¡µé¢ã€‚
æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ä¸Šè¾¹æåˆ°çš„mavenæ’ä»¶ï¼Œè¿™é‡Œæ˜¯çœ‹ä¸åˆ°<code>æ„å»ºmavené¡¹ç›®</code>é€‰é¡¹çš„ã€‚</p>
<p>ä¹Ÿå¯ä»¥é€‰<code>ä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶</code></p>
<ol>
<li>
<p>Generalé€‰é¡¹å¡ï¼š
å‹¾é€‰<code>ä¸¢å¼ƒæ—§çš„æ„å»º</code>ï¼Œç­–ç•¥åªèƒ½é»˜è®¤ã€‚</p>
<ul>
<li>ä¿æŒæ„å»ºå¤©æ•°</li>
<li>ä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°
Jenkinsä¼šè‡ªåŠ¨åˆ é™¤ç¬¬ä¸€é¡¹ä¹‹å‰çš„å®‰è£…åŒ…ï¼ŒèŠ‚çº¦æœåŠ¡å™¨ç©ºé—´ã€‚</li>
</ul>
</li>
<li>
<p>æºç ç®¡ç†ï¼š
å‹¾é€‰gitï¼Œ<code>Repository URL</code>è¾“å…¥è¿œç¨‹ä»“åº“åœ°å€ï¼Œ<code>Credentials</code>æ·»åŠ ä¸ªäººè¿œç¨‹ä»“åº“çš„è´¦æˆ·å¯†ç ã€‚
(æ³¨ï¼šè¿™é‡Œå»ºè®®ä½¿ç”¨å…¬å¸å…¬ç”¨çš„è´¦æˆ·å¯†ç ï¼Œé¿å…å‘˜å·¥ç¦»èŒæˆ–æ›´æ”¹å¯†ç å¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦)</p>
</li>
<li>
<p>æ„å»ºè§¦å‘å™¨
å‹¾é€‰ï¼šBuild whenever a SNAPSHOT dependency is builtï¼ˆè§¦å‘è¿œç¨‹æ„å»º (ä¾‹å¦‚,ä½¿ç”¨è„šæœ¬)ï¼‰</p>
</li>
<li>
<p>æ„å»ºç¯å¢ƒ
å‹¾é€‰ï¼šAdd timestamps to the Console Outputï¼ˆéå¿…é€‰ï¼‰</p>
</li>
</ol>
<p>æ³¨æ„ï¼š<code>æ„å»ºmavené¡¹ç›®</code>å’Œ<code>æ„å»ºè‡ªç”±é£æ ¼çš„è½¯ä»¶</code>ï¼Œè¿™é‡Œçš„é€‰é¡¹æ˜¯ä¸ä¸€æ ·çš„ã€‚
5. Pre Steps
ä¸ç”¨é€‰</p>
<ol start="6">
<li>Build(æ„å»º)
Root POMï¼šé»˜è®¤</li>
</ol>
<p>Goals and optionsï¼š<code>clean install -pl tubitu_service_api -am</code>
æ³¨æ„æ›´æ”¹æ¨¡å—çš„åç§°ã€‚å…¶ä¸­-pl ä»£è¡¨æ‰“åŒ…æŒ‡å®šmoduleï¼Œå¯ä»¥<code>-pl module_name -pl module_name</code>æŒ‡å®šæ‰“åŒ…å¤šä¸ªé¡¹ç›®ï¼Œ-am ä»£è¡¨è‡ªåŠ¨æ‰“åŒ…æŒ‡å®šmoduleæ‰€ä¾èµ–çš„æ¨¡å—ã€‚</p>
<p>æ³¨æ„ï¼š-pl xxx(æ¨¡å—å)ï¼Œå¿…é¡»åœ¨é¡¹ç›®çš„æ ¹ç›®å½•æ‰§è¡Œã€‚</p>
<ol start="7">
<li>
<p>Post Steps
å‹¾é€‰Run only if build succeeds</p>
</li>
<li>
<p>ç‚¹å‡»Add post-build stepï¼Œç„¶åé€‰æ‹©æ‰§è¡Œshellï¼Œè¿™é‡Œä¸€æ­¥æ˜¯é‡ä¸­ä¹‹é‡ã€‚
å¯ä»¥å…ˆéšä¾¿ç”¨ä¸ªæŒ‡ä»¤å®éªŒä¸€ä¸‹ï¼š
<code>ifconfig</code></p>
</li>
</ol>
<p>ç„¶åç‚¹å‡»ä¿å­˜ï¼Œç‚¹å‡»æ„å»ºï¼Œçœ‹jenkinsæ§åˆ¶å°æ˜¯å¦è¾“å…¥äº†æœåŠ¡å™¨çš„ipåœ°å€ã€‚</p>
<p>å®Œæ•´çš„æ›´æ–°é¡¹ç›®shellè„šæœ¬ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#007f7f">#é¦–å…ˆåœæ­¢é¡¹ç›®</span>
</span></span><span style="display:flex;"><span>pid=<span style="color:#0ff;font-weight:bold">`</span>ps -ef | grep zjx_admin-1.0.0.jar | grep -v grep | awk <span style="color:#0ff;font-weight:bold">&#39;{print $2}&#39;</span><span style="color:#0ff;font-weight:bold">`</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> [ -n <span style="color:#0ff;font-weight:bold">&#34;</span>$pid<span style="color:#0ff;font-weight:bold">&#34;</span> ]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>   <span style="color:#fff;font-weight:bold">kill</span> -9 $pid
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#åˆ é™¤æ—§çš„é¡¹ç›®ï¼Œæ³¨æ„æ›´æ”¹æ­¤å¤„çš„jaråŒ…åç§°</span>
</span></span><span style="display:flex;"><span>rm -rf /usr/local/zjx/admin/zjx_admin-0.0.1-SNAPSHOT.jar
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#æ¸…é™¤å¹¶æ‰“åŒ…æŒ‡å®šé¡¹ç›®ï¼Œ-amè¡¨ç¤ºè¿åŒä¾èµ–æ¨¡å—ä¸€åŒæ‰“åŒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">cd</span> $WORKSPACE
</span></span><span style="display:flex;"><span>mvn clean package -pl zjx_admin -am
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#å¤åˆ¶Jenkinså·¥ä½œç©ºé—´é‡Œçš„é¡¹ç›®(æ‰“åŒ…å¥½)åˆ°æŒ‡å®šç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span>cp $WORKSPACE/zjx_admin/target/zjx_admin-0.0.1-SNAPSHOT.jar /usr/local/zjx/admin/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#æˆæƒï¼Œè¯¥æ­¥éª¤å¯ä»¥çœç•¥</span>
</span></span><span style="display:flex;"><span>chmod u+x /usr/local/zjx/admin/zjx_admin-0.0.1-SNAPSHOT.jar
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#æŒ‡å®šlogæ—¥å¿—ä½ç½®ï¼Œå¹¶é€šè¿‡java -jarå¯åŠ¨é¡¹ç›®</span>
</span></span><span style="display:flex;"><span>BUILD_ID=donKillme nohup java -jar -Dspring.profiles.active=dev &gt;/usr/local/zjx/service/logs/zjx.log /usr/local/zjx/admin/zjx_admin-0.0.1-SNAPSHOT.jar &amp;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸¤ç§æ‰“å°æ—¥å¿—çš„è®¾ç½®
<code>&gt;/usr/local/zjx/service/logs/zjx.log</code>
ä¸‹è¾¹è¿™ç§æ­»æ´»æ‰“ä¸å‡ºæ—¥å¿—ï¼Œä¸çŸ¥é“ä¸ºå•¥ã€‚
<code>-Dlogging.file=/usr/local/zjx/admin/logs/zjx.log</code></p>
<p>2019/12/13æ›´æ–°ï¼š
ç»ˆäºçŸ¥é“ä¸ºå•¥ä¸èƒ½æ‰“å°æ—¥å¿—äº†ã€‚å…¶å®ä¸Šè¿°ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥æ‰“å°æ—¥å¿—ï¼Œåªä¸è¿‡æˆ‘æ˜¯åˆ†å¸ƒå¼åº”ç”¨ï¼Œæä¾›è€…æœ‰å¤šä¸ªï¼Œä½†æ˜¯åŒæ—¶å‘ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­å†™æ—¥å¿—ã€‚
æ‰€ä»¥é€ æˆäº†æ­»é”é—®é¢˜ï¼Œå¤šä¸ªç¨‹åºéƒ½åœ¨äº‰æŠ¢æ—¥å¿—æ–‡ä»¶çš„é”ï¼Œç„¶åå¯¼è‡´è°éƒ½æ— æ³•å†™å…¥ã€‚
è§£å†³åŠæ³•ï¼š
æ¯ä¸ªæœåŠ¡ï¼Œå•ç‹¬é…ç½®æ—¥å¿—æ–‡ä»¶ã€‚</p>
<p>è¿™ä¸ª-Dæ˜¯ javaå‘½ä»¤çš„å‚æ•°-Dã€‚æ„æŒ‡åŠ å…¥å…¨å±€å±æ€§ï¼Œæ¯”å¦‚<code>-Djdbc.driver=&lt;jdbc driver classpath&gt;</code>è¡¨ç¤ºåœ¨ç¨‹åºé‡Œå¯ç”¨System.getProperty(&ldquo;jdbc.driver&rdquo;)è·å¾—<code>&lt;jdbc driver classpath&gt;</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚
<code>-Dspring.profiles.active=dev</code>ï¼šæŒ‡å®šå¯åŠ¨é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥åŒºåˆ†æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚</p>
<p><code>BUILD_ID=dontKillme</code>ï¼šæŒ‡çš„æ˜¯ä¸è¦æ€æ­»æœ€åä¸€æ­¥å¯åŠ¨é¡¹ç›®äº§ç”Ÿçš„å­è¿›ç¨‹ã€‚
<a href="https://wiki.jenkins.io/display/JENKINS/ProcessTreeKiller">å®˜ç½‘è¯´æ˜</a></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>To reliably kill processes spawned by a job during a build, Jenkins contains a bit of native code to list up such processes and kill them. 
</span></span><span style="display:flex;"><span>This is tested on several platforms and architectures, but if you find a show-stopper problem because of this, 
</span></span><span style="display:flex;"><span>you can disable this feature by setting a Java property named &#34;hudson.util.ProcessTree.disable&#34; to the value &#34;true&#34;.
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯‘ï¼šä¸ºäº†å¯é åœ°ç»ˆæ­¢æ„å»ºè¿‡ç¨‹ä¸­æ»‹ç”Ÿå‡ºæ¥çš„è¿›ç¨‹ï¼ŒJenkinsåŒ…å«äº†ä¸€ç³»åˆ—çš„æœ¬åœ°ä»£ç å»æŸ¥å‡ºè¿™äº›å­è¿›ç¨‹å¹¶ä¸”æ€æ­»å®ƒä»¬ã€‚è¿™ä¸ªå·²ç»åœ¨ä¸€äº›å¹³å°ä¸Šè¿›è¡Œäº†æµ‹è¯•ï¼Œå¦‚æœä½ å‘ç°ç”±æ­¤å¼•å‘çš„åœæ­¢æ˜¾ç¤ºçš„é—®é¢˜ï¼Œä½ å¯ä»¥è®¾ç½®åä¸ºâ€œhudson.util.ProcessTree.disable&quot; çš„java propertyä¸ºtrueæ¥ç¦æ­¢ä½¿ç”¨ProcessTreeKillerè‡ªåŠ¨æ€æ­»ã€‚
é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¿æŒå®˜æ–¹é»˜è®¤é…ç½®ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨BUILD_ID=dontKillme è¡¨ç¤ºè¯¥è¿›ç¨‹ä¸æ˜¯ç”±Jenkinsæ¥ç”Ÿæˆï¼Œä¹Ÿå°±ä¸ä¼šè¢«ProcessTreeKilleræ€æ­»ã€‚</p>
<p>ç„¶åå›åˆ°é¦–é¡µï¼Œç‚¹å‡»ä»»åŠ¡åˆ—è¡¨é¡¹å³ä¾§çš„å›¾æ ‡ï¼šè¡¨ç›˜ä¸Šæœ‰ä¸ªç»¿è‰²å°ç®­å¤´ï¼Œæˆ–è€…ç‚¹å‡»æ¨¡å—åæ—çš„å°ç®­å¤´ï¼Œç‚¹å‡»ç«‹å³æ„å»ºã€‚ç‚¹å‡»<code>#1</code>ï¼Œ1è¿™ä¸ªæ•°å­—æ¯æ¬¡æ„å»ºéƒ½ä¼š+1ï¼Œä»£è¡¨è¯¥æ¨¡å—çš„æ„å»ºæ¬¡æ•°ã€‚
é¼ æ ‡æ‚¬æµ®åœ¨è¯¥é¡¹ä¸Šï¼Œç‚¹å‡»å‘ä¸‹çš„å°ç®­å¤´ï¼Œç‚¹å‡»æ§åˆ¶å°è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ­£åœ¨æ„å»ºæˆ–å·²ç»å®Œæˆæ„å»ºçš„linuxæ§åˆ¶å°ä¿¡æ¯ã€‚</p>
<p>æ„å»ºè¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°æ„å»ºè¿›åº¦ï¼š
<img loading="lazy" src="3.png" alt=""  />

<code>#10</code>ä»£è¡¨ç¬¬åæ¬¡æ„å»ºï¼Œé¼ æ ‡ç§»åˆ°10æ—è¾¹ï¼Œå³å¯æŸ¥çœ‹æ§åˆ¶å°è¾“å…¥çš„æ„å»ºå’Œå¯åŠ¨ä¿¡æ¯ã€‚çœ‹åˆ°<code>Finshedï¼šSUCCESS</code>ï¼Œè¡¨ç¤ºæ„å»ºå®Œæˆã€‚</p>
<p>æ­¤æ—¶è¿”å›åˆ°Jenkinsä¸»é¡µï¼Œå¯ä»¥çœ‹åˆ°Sä¸‹çš„ä¸€åˆ—åœ†å½¢å›¾æ ‡ï¼Œ
è“è‰²ï¼šæˆåŠŸ
ç°è‰²ï¼šå°šæœªæ„å»º
çº¢è‰²ï¼šæ„å»ºå¤±è´¥
é»„è‰²ï¼šä¸ç¨³å®šæ„å»º(Jenkinsä¸ç¡®å®šçŠ¶æ€)</p>
<p>Wä¸‹æœ‰å¤©æ°”å›¾æ ‡ï¼Œä»£è¡¨è¿‘æœŸæ„å»ºçŠ¶æ€ï¼š
å°å¤ªé˜³ï¼šè¿‘æœŸæˆåŠŸ
å¤šäº‘ï¼šå°‘æ•°å¤±è´¥ï¼Œä»¥æ­¤ç±»æ¨</p>
<h2 id="è¿œç¨‹éƒ¨ç½²">è¿œç¨‹éƒ¨ç½²<a hidden class="anchor" aria-hidden="true" href="#è¿œç¨‹éƒ¨ç½²">#</a></h2>
<p>è¿œç¨‹éƒ¨ç½²æ˜¯ç”±äºé¡¹ç›®æ‰€æœ‰çš„æœåŠ¡å¹¶ä¸éƒ½éƒ¨ç½²åœ¨æœ¬æœºï¼Œæœ‰å¯èƒ½éƒ¨ç½²åœ¨å…¶ä»–æœåŠ¡å™¨ï¼Œæ‰€ä»¥éœ€è¦è¿œç¨‹éƒ¨ç½²ã€‚
è¯´ç™½äº†ï¼Œå°±æ˜¯æŠŠjaråŒ…ä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡è„šæœ¬æ¥å¯åŠ¨jaråŒ…ã€‚</p>
<p>è¿œç¨‹éƒ¨ç½²éœ€è¦é…ç½®è¿œç¨‹æœåŠ¡å™¨çš„ipåœ°å€å’Œç”¨æˆ·å‡­è¯ã€‚
è¿”å›ä¸»é¡µï¼Œç‚¹å‡»ç³»ç»Ÿç®¡ç†ï¼Œç„¶åç‚¹å‡»ç³»ç»Ÿè®¾ç½®ï¼Œåœ¨Publish over SSHä¸‹æ‰¾åˆ°SSH Serversï¼Œç‚¹å‡»æ–°å¢ï¼Œåˆ†åˆ«é…ç½®å¥½IPåœ°å€å’Œç”¨æˆ·åå¯†ç ï¼š
<img loading="lazy" src="4.png" alt=""  />
</p>
<p>è¿™é‡ŒRemote Directoryä¸ºJenkinsé»˜è®¤è¿œç¨‹æ ¹ç›®å½•ï¼Œç‚¹å‡»é«˜çº§ï¼Œå‹¾é€‰ä½¿ç”¨ç”¨æˆ·å¯†ç ï¼Œå¹¶è¾“å…¥å¯†ç ï¼Œç„¶åç‚¹å‡»Test Configurationæµ‹è¯•æ˜¯å¦è¿æ¥æˆåŠŸï¼š
<img loading="lazy" src="5.png" alt=""  />
</p>
<p>æ–°å»ºä¸€ä¸ªä»»åŠ¡tubitu_service_mallï¼Œå‰é¢åŸºæœ¬ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯åœ¨Post Stepsæ—¶ï¼Œä¸å†é€‰æ‹©æ‰§è¡Œè„šæœ¬ï¼Œè€Œæ˜¯é€‰æ‹©
<code>send files or execute commands over SSH</code>
<img loading="lazy" src="6.png" alt=""  />

nameé€‰æ‹©ä¸Šä¸€æ­¥é…ç½®å¥½çš„è¿œç¨‹æœåŠ¡å™¨ï¼Œä¸€èˆ¬æ¥è¯´ä¼šè‡ªåŠ¨å¡«å……ä¸Šã€‚
Source filesé»˜è®¤ä¼šä»¥æœ¬åœ°å½“å‰ä»»åŠ¡çš„Jenkinså·¥ä½œç©ºé—´+ä»»åŠ¡åä¸ºæ ¹è·¯å¾„ã€‚æ‰€ä»¥Source filesåªèƒ½é…ç½®ç›¸å¯¹è·¯å¾„ï¼Œè€ŒJenkinsæ¯ä¸€ä¸ªä»»åŠ¡é»˜è®¤çš„å·¥ä½œç©ºé—´ä¸º<code>/root/.jenkins/workspace/ä»»åŠ¡å</code>ï¼Œ
æ‰€ä»¥é«˜çº§ä»»åŠ¡åœ¨æœ¬æ–‡ä¸­çš„å·¥ä½œç©ºé—´å…¨è·¯å¾„å³ä¸ºï¼š
<code>/root/.jenkins/workspace/tubitu_service_mall</code>
è€Œç”±äºæ„å»ºä¾èµ–çš„pomæ–‡ä»¶åˆæ˜¯çˆ¶é¡¹ç›®çš„pomæ–‡ä»¶ï¼Œæ‰€ä»¥Source filesä¸º
<code>tubitu_service_mall/target/*.jar</code>
<code>*</code>ä»£è¡¨æ‰€æœ‰çš„jaråŒ…ã€‚</p>
<p>Remove prefixï¼š
ä»£è¡¨ä¼ è¾“åˆ°è¿œç¨‹æ—¶éœ€è¦ç§»é™¤çš„å‰ç¼€ï¼Œå³åˆ°è¿œç¨‹æ—¶ä¼šè‡ªåŠ¨ç§»é™¤<code>tubitu_service_mall/target/</code>ï¼Œåªä¿ç•™æ–‡ä»¶åã€‚
Remote directoryï¼š
è¿œç¨‹æœåŠ¡å™¨è·¯å¾„ã€‚æ³¨æ„ï¼šè¿™ä¸ªç›®æ ‡è·¯å¾„ä¹Ÿæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹çš„æ˜¯ä½ åœ¨ä¸€å¼€å§‹é…ç½®SSH serveræ—¶
Remote Directoryçš„ç›®å½•ï¼Œç”±äºæœ¬æ–‡é…ç½®çš„æ˜¯/ï¼Œæ‰€ä»¥å®é™…ä¼ è¾“çš„è¿œç¨‹ç›®ä¸º/usr/local/meilong/mallï¼Œ
å¦‚æœä¸€å¼€å§‹é…ç½®çš„æ˜¯/usr/local/meilongï¼Œé‚£ä¹ˆè¿™é‡Œåªéœ€è¦é…ç½®Remote directoryä¸ºmallã€‚</p>
<p>Exec commandæ‰§è¡Œçš„è„šæœ¬å†…å®¹ä¸ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#007f7f">#restart.sh</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#!/bin/bash</span>
</span></span><span style="display:flex;"><span>APP_PATH=/usr/local/meilong/mall
</span></span><span style="display:flex;"><span>APP_NAME=tubitu_service_mall-1.0.jar
</span></span><span style="display:flex;"><span>LOG_FILE=$APP_PATH/logs/tubitu.log
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;Restarting </span>$APP_NAME<span style="color:#0ff;font-weight:bold"> SpringBoot Application&#34;</span>
</span></span><span style="display:flex;"><span>pid=<span style="color:#0ff;font-weight:bold">`</span>ps -ef | grep $APP_NAME | grep -v grep | awk <span style="color:#0ff;font-weight:bold">&#39;{print $2}&#39;</span><span style="color:#0ff;font-weight:bold">`</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">source</span> /etc/profile
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> [ -n <span style="color:#0ff;font-weight:bold">&#34;</span>$pid<span style="color:#0ff;font-weight:bold">&#34;</span> ]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>   <span style="color:#fff;font-weight:bold">kill</span> -9 $pid
</span></span><span style="display:flex;"><span>   <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;å…³é—­è¿›ç¨‹ï¼š&#34;</span>$pid
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;æˆäºˆå½“å‰ç”¨æˆ·æƒé™&#34;</span>
</span></span><span style="display:flex;"><span>chmod u+x $APP_PATH/$APP_NAME
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;æ‰§è¡Œ.....&#34;</span>
</span></span><span style="display:flex;"><span>nohup java -jar -Dlogging.file=$LOG_FILE $APP_PATH/$APP_NAME &gt;&gt; /dev/null &amp;
</span></span><span style="display:flex;"><span>respid=<span style="color:#0ff;font-weight:bold">`</span>ps -ef | grep $APP_NAME | grep -v grep | awk <span style="color:#0ff;font-weight:bold">&#39;{print $2}&#39;</span><span style="color:#0ff;font-weight:bold">`</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> [ -n <span style="color:#0ff;font-weight:bold">&#34;</span>$respid<span style="color:#0ff;font-weight:bold">&#34;</span> ]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;å¯åŠ¨æˆåŠŸï¼Œè¿›ç¨‹å·ï¼š</span>$respid<span style="color:#0ff;font-weight:bold">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">exit</span> <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;å¯åŠ¨å¤±è´¥&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">exit</span> <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">done</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦æ³¨æ„çš„æ˜¯ç¬¬8è¡Œï¼Œä¹‹æ‰€ä»¥è¦æ‰§è¡Œç¬¬8è¡Œï¼Œæ˜¯å› ä¸ºJenkinsåœ¨æ‰§è¡Œè¿œç¨‹è„šæœ¬æ—¶ï¼Œå®ƒæ˜¯ä¸ä¼šæºå¸¦æœ¬æœºç¯å¢ƒå˜é‡çš„ï¼Œæ‰€ä»¥æ‰§è¡Œjavaä¼šæŠ¥command not foundçš„é”™å¯¼è‡´æ„å»ºå¤±è´¥ï¼Œè§£å†³åŠæ³•æœ‰ä¸¤ä¸ªï¼š</p>
<p>æ‰§è¡Œjavaå‘½ä»¤æ—¶è¾“å…¥javaçš„å…¨è·¯å¾„ï¼Œæœ¬æ–‡ä¸º/usr/local/jdk1.8.0_161/bin/java;
æ‰§è¡Œè¯¥è„šæœ¬æ—¶ï¼Œè„šæœ¬å†…è°ƒç”¨source /etc/profileï¼Œå½“ç„¶å‰ææ˜¯åœ¨profileé‡Œé…ç½®javaçš„ç¯å¢ƒå˜é‡ã€‚
å¦‚æœæ²¡æœ‰é‡åˆ°command not foundçš„é”™ï¼Œé‚£ä¹ˆå¯ä»¥ä¸åŠ ç¬¬8è¡Œã€‚</p>
<p>æ¨èåœ¨Transfersé‡Œçš„é«˜çº§é€‰é¡¹é‡Œå‹¾é€‰[Flatten files]ï¼Œä»£è¡¨æ‰å¹³åŒ–ä¼ è¾“æ–‡ä»¶ï¼Œå³åªä¼ è¾“æ–‡ä»¶è€Œä¸å»ºç«‹è¿œç¨‹ç›®å½•ï¼Œé¿å…åˆ›å»ºä¸€å †æ‚ä¹±ç›®å½•ï¼Œå‰ææ˜¯è¿œç¨‹ç›®å½•è‡ªå·±å·²ç»æ‰‹åŠ¨åˆ›å»ºã€‚</p>
<p>3.ç»¼åˆéƒ¨ç½²
ç»¼åˆéƒ¨ç½²ï¼šå»ºç«‹ä¸€ä¸ªå…¬å…±æœåŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬é¡¹ç›®ä¸­æ‰€æœ‰çš„æ¨¡å—ï¼Œå®ç°ä¸€é”®éƒ¨ç½²ã€å¯åŠ¨æ‰€æœ‰æ¨¡å—ã€‚
æœ¬åœ°éƒ¨ç½²+è¿œç¨‹éƒ¨ç½²ï¼ŒåŸºæœ¬æ­¥éª¤ä¸å‰é¢ä¸¤ç§åº”ç”¨ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ï¼Œåªè´´å‡ºé…ç½®ã€‚
<img loading="lazy" src="7.png" alt=""  />

<img loading="lazy" src="8.png" alt=""  />
</p>
<h1 id="æƒé™åˆ†é…">æƒé™åˆ†é…<a hidden class="anchor" aria-hidden="true" href="#æƒé™åˆ†é…">#</a></h1>
<p>è€ƒè™‘åˆ°Jenkinsä¸­çš„æ¨¡å—å¯èƒ½éœ€è¦äº¤ç»™ä¸åŒçš„äººå»ç»´æŠ¤ï¼Œä¾‹å¦‚h5ã€åå°ç³»ç»Ÿã€apiç­‰ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä¸åŒçš„è´¦å·åˆ†é…ä¸åŒçš„è§’è‰²ï¼Œå®ç°æƒé™åˆ†é…ã€‚</p>
<p>å®‰è£…æ’ä»¶ï¼šRole-based Authorization Strategy
è¿›å…¥åˆ°å…¨å±€å®‰å…¨é…ç½®ï¼Œå¯ç”¨è¯¥æ’ä»¶ï¼š
<img loading="lazy" src="9.png" alt=""  />
</p>
<p>ç„¶åè¿›å…¥åˆ°ç³»ç»Ÿç®¡ç†ï¼Œæ­¤æ—¶å‡ºç°äº†Manage And Assign Rolesçš„é€‰é¡¹ï¼Œé¦–å…ˆé€‰æ‹©manage rolesã€‚æ¯”å¦‚æˆ‘æƒ³æ–°å¢ä¸€ä¸ªå‰ç«¯çš„è§’è‰²ï¼Œè¿™ä¸ªå‰ç«¯è§’è‰²åªèƒ½çœ‹åˆ°å‰ç«¯çš„æ„å»ºä»»åŠ¡ï¼Œè¾“å…¥h5ï¼Œç‚¹å‡»æ–°å¢ï¼Œç„¶åå‹¾é€‰å…¨éƒ¨/overallé‡Œçš„Readé€‰é¡¹ï¼Œè¯¥é€‰é¡¹å¿…é€‰ï¼Œå¦åˆ™ä¼šæç¤ºè¯¥è§’è‰²æ²¡æœ‰æ‰€æœ‰çš„è¯»å–æƒé™ã€‚</p>
<p>ç„¶åæ–°å¢ä¸€ä¸ªé¡¹ç›®æƒé™ï¼Œä¹Ÿå‘½åä¸ºh5ï¼ŒPatterné‡Œå†™æ­£åˆ™ï¼Œh5_.*ä»£è¡¨æ˜¾ç¤ºæ‰€æœ‰ä»¥h5_å¼€å¤´çš„æ„å»ºé¡¹ç›®ï¼Œé€‰æ‹©ä»»åŠ¡é‡Œçš„Buildï¼ŒConfigureï¼ŒReadï¼Œå¯ç”¨è¯¥è§’è‰²å¯¹äºä»»åŠ¡çš„æ„å»ºï¼Œé…ç½®å’Œè¯»æƒé™ï¼Œç‚¹å‡»saveã€‚</p>
<p>ç„¶ååœ¨Jenkinsçš„ç”¨æˆ·ç®¡ç†é‡Œæ–°å»ºä¸€ä¸ªç”¨æˆ·ï¼Œå‘½åä¸ºh5ï¼Œæˆ‘è¿™é‡Œçš„å…¨åä¸ºtubitu_h5ï¼š
<img loading="lazy" src="10.png" alt=""  />
</p>
<p>æœ€åè¿”å›åˆ°Manage And Assign Rolesä¸»ç•Œé¢ï¼Œé€‰æ‹©Assign rolesåˆ†é…è§’è‰²ã€‚
<img loading="lazy" src="11.png" alt=""  />
</p>
<p>User/group to addæ¡†é‡Œè¾“å…¥h5ï¼ˆä¸éœ€è¦è¾“å…¥å…¨åï¼ŒJenkinsä¼šæ ¹æ®userIdæ¥æ‰¾ï¼ŒuserId=h5ï¼‰ï¼Œç„¶åç‚¹å‡»Addï¼Œå¹¶å‹¾é€‰åˆšåˆšæ–°å»ºçš„h5çš„è§’è‰²ã€‚</p>
<p>æ³¨é”€å½“å‰ç”¨æˆ·ï¼Œä½¿ç”¨h5ç”¨æˆ·ç™»å½•ï¼Œåªèƒ½çœ‹åˆ°h5_çš„ä»»åŠ¡ã€‚</p>
<p>å¦‚æœä¸å°å¿ƒåˆ†é…é”™äº†æƒé™ï¼Œå¯ä»¥åˆ°jenkinsçš„ä¸»ç›®å½•ä¸‹ï¼Œä¾‹å¦‚Linuxä¸Šçš„/root/.jenkins/ç›®å½•ä¸‹æœ‰ä¸€ä¸ªconfig.xmlæ–‡ä»¶ï¼Œä¿®æ”¹authorizationStrategyä¸ºhudson.security.FullControlOnceLoggedInAuthorizationStrategyï¼Œå³å¯ç¦ç”¨åŸºäºè§’è‰²çš„æƒé™ç­–ç•¥ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;useSecurity&gt;true&lt;/useSecurity&gt;
</span></span><span style="display:flex;"><span>  &lt;authorizationStrategy class=&#34;hudson.security.FullControlOnceLoggedInAuthorizationStrategy&#34;&gt;
</span></span><span style="display:flex;"><span>    &lt;denyAnonymousReadAccess&gt;true&lt;/denyAnonymousReadAccess&gt;
</span></span><span style="display:flex;"><span>  &lt;/authorizationStrategy&gt;
</span></span><span style="display:flex;"><span>  &lt;securityRealm class=&#34;hudson.security.HudsonPrivateSecurityRealm&#34;&gt;
</span></span><span style="display:flex;"><span>    &lt;disableSignup&gt;true&lt;/disableSignup&gt;
</span></span><span style="display:flex;"><span>    &lt;enableCaptcha&gt;false&lt;/enableCaptcha&gt;
</span></span><span style="display:flex;"><span>  &lt;/securityRealm&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="é—®é¢˜">é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#é—®é¢˜">#</a></h1>
<h2 id="tempjenkins138035565033548290sh-line-5-mvn-command-not-found">temp/jenkins138035565033548290.sh: line 5: mvn: command not found<a hidden class="anchor" aria-hidden="true" href="#tempjenkins138035565033548290sh-line-5-mvn-command-not-found">#</a></h2>
<p>åŸå› ï¼š
javaæˆ–mavençš„è·¯å¾„çš„ç¯å¢ƒå˜é‡æ˜¯æ”¾åœ¨/etc/profileä¸­çš„ï¼Œè€Œ/etc/profileåªæœ‰åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™æ‰ä¼šè¢«loadï¼ŒJenkinsåœ¨è¿è¡Œå‘½ä»¤æ—¶ï¼Œä½¿ç”¨çš„æ˜¯Non-loginçš„æ–¹å¼ï¼Œè€Œè¿™ç§æ–¹å¼åœ¨è¿è¡Œå‘½ä»¤æ—¶ï¼Œ/etc/profileæ˜¯ä¸ä¼šè¢«loadè¿›æ¥çš„ï¼Œæ‰€ä»¥jenkinsåªèƒ½åœ¨å½“å‰è·¯å¾„ä¸‹å¯»æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<p>è§£å†³æ–¹æ³•1ï¼š
åœ¨è„šæœ¬å¤´éƒ¨æ·»åŠ ï¼š
<code>#!/bin/bash -il</code></p>
<p>è§£å†³æ–¹æ³•2ï¼š
æŸ¥è¯¢ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼š
<code>echo $PATH</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/root/jenkins_home/downloads/apache-maven-3.6.3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
</span></span></code></pre></td></tr></table>
</div>
</div><p>jenkinsä¸»é¡µé¢-&gt;Manage Jenkins-&gt;Configure System-&gt;Global Properties
nameï¼šPATH
vlaueï¼šåˆšæ‰æŸ¥å‡ºæ¥çš„ã€‚</p>
<h2 id="jenkinså¸è½½">jenkinså¸è½½<a hidden class="anchor" aria-hidden="true" href="#jenkinså¸è½½">#</a></h2>
<p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯tomcatè¿è¡Œjenkins.warçš„æ–¹å¼ï¼Œæ‰€ä»¥ï¼š</p>
<ol>
<li>
<p>åœæ­¢tomcat
<code>./shutdown.sh</code></p>
</li>
<li>
<p>åˆ é™¤ROOT
<code>rm -rf ROOT</code></p>
</li>
<li>
<p>åˆ é™¤jenkinså·¥ä½œç©ºé—´
<code>cd /root</code></p>
</li>
</ol>
<p>æŸ¥çœ‹jenkinsæ˜¯å¦åœ¨rootä¸‹é¢
<code>ls</code></p>
<p>å‘ç°æœ‰ï¼Œç›´æ¥åˆ é™¤
<code>rm -rf .jenkins</code></p>
<ol start="4">
<li>æ¸…é™¤ç¼“å­˜</li>
</ol>
<h2 id="jenkinså ç”¨æœåŠ¡å™¨ç¡¬ç›˜è¿‡å¤§">jenkinså ç”¨æœåŠ¡å™¨ç¡¬ç›˜è¿‡å¤§<a hidden class="anchor" aria-hidden="true" href="#jenkinså ç”¨æœåŠ¡å™¨ç¡¬ç›˜è¿‡å¤§">#</a></h2>
<p>jenkinsåœ¨æœåŠ¡å™¨è·‘äº†ä¸€ä¸ªæœˆäº†ï¼Œ8ä¸ªæœåŠ¡ï¼Œæ¯å¤©éƒ½è¦æ„å»ºå‡ æ¬¡ï¼Œä»Šå¤©å‘ç°mysqlä¸èƒ½æ’å…¥æ•°æ®äº†ï¼ŒæŠ¥ç£ç›˜ç©ºé—´ä¸è¶³ã€‚ç¬¬ä¸€ååº”å°±æ˜¯jenkinsçš„é—®é¢˜ã€‚
å…ˆæŸ¥çœ‹linuxæœåŠ¡å™¨çš„ç£ç›˜ä½¿ç”¨çŠ¶å†µï¼š<code>df -h</code></p>
<p>jenkinsçš„æ–‡ä»¶éƒ½å­˜å‚¨åœ¨<code>/root/.jenkins</code>ï¼Œä½¿ç”¨æŒ‡ä»¤æŸ¥çœ‹æ–‡ä»¶å¤¹å¤§å°<code>du -sh</code>ï¼Œå‘ç°å äº†86Gï¼Œå¤©å“ª&hellip;æˆ‘ç¡¬ç›˜ä¸€å…±æ‰95Gï¼Œå†åŠ ä¸Šå…¶ä»–ç¨‹åºå ç”¨çš„å†…å­˜ï¼Œç›´æ¥å°±100%ä½¿ç”¨äº†ã€‚</p>
<p>è§£å†³ï¼š
æ‰¾åˆ°<code>.jenkins/jobs</code>ï¼Œè¿›åˆ°jobsç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°jenkinsçš„å„ä¸ªæ¨¡å—ã€‚æ‰¾åˆ°<code>builds</code>ï¼Œé‡Œé¢æ”¾ç€å„ä¸ªç‰ˆæœ¬çš„
æ„å»ºï¼Œåˆ é™¤ä¸éœ€è¦çš„ã€‚èƒ½å¦ç›´æ¥åˆ æ‰<code>builds</code>æ–‡ä»¶å¤¹ï¼Œå­˜ç–‘ã€‚
ç„¶ååˆ æ‰<code>.jenkins/workspace</code>åˆ æ‰ï¼Œmkdirä¸€ä¸ªï¼Œè¿™ä¸ªä¹Ÿå äº†1Gå¤šã€‚
åœ¨é…ç½®æ—¶ï¼Œä¸€å®šè¦é€‰æ‹©<code>ä¸¢å¼ƒæ—§çš„æ„å»º</code>ï¼Œå¹¶ä¸”<code>ä¿æŒæ„å»ºçš„å¤©æ•°</code>å’Œ<code>ä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°</code>ä¸€å®šè¦å†™ï¼Œåæ­£æˆ‘éƒ½å†™1ã€‚</p>
<h2 id="è‡ªåŠ¨åŒ–è„šæœ¬é”™è¯¯">è‡ªåŠ¨åŒ–è„šæœ¬é”™è¯¯<a hidden class="anchor" aria-hidden="true" href="#è‡ªåŠ¨åŒ–è„šæœ¬é”™è¯¯">#</a></h2>
<p><code>cannot create regular file xxxï¼ŒPermission denied</code></p>
<ul>
<li>æŸ¥çœ‹è‡ªå·±æ˜¯è°<code>whoami</code></li>
<li>å¦‚æœä¸æ˜¯rootç”¨æˆ·ï¼Œéœ€è¦åœ¨cpå‰åŠ ä¸Š<code>sudo</code>ï¼Œæ³¨æ„è¿™é‡Œæˆ‘å·²ç»æå‰å®‰è£…äº†suduã€‚</li>
</ul>
<h2 id="we-trust-you-have-received-the-usual-lecture-from-the-local-system">We trust you have received the usual lecture from the local System<a hidden class="anchor" aria-hidden="true" href="#we-trust-you-have-received-the-usual-lecture-from-the-local-system">#</a></h2>
<p>ä¸æ˜¯rootç”¨æˆ·ï¼Œä½¿ç”¨<code>sudo</code>æ—¶ï¼Œå‡ºç°è¯¥é—®é¢˜ã€‚
ç¼–è¾‘/etc/sudoersæ–‡ä»¶
<code>vim /etc/sudoers</code>
æ‰¾åˆ°è¿™è¡Œï¼š
<code>root ALL=(ALL) ALL</code>
åœ¨èµ·ä¸‹é¢æ·»åŠ <code>xxx ALL=(ALL) ALL</code>(è¿™é‡Œçš„xxxæ˜¯ä½ çš„ç”¨æˆ·å)ï¼Œç„¶åå¼ºåˆ¶ä¿å­˜é€€å‡ºï¼Œå› ä¸ºè¯¥æ–‡ä»¶æ˜¯åªè¯»æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ä¿®æ”¹ä¹‹å‰æ›´æ”¹è¯¥æ–‡ä»¶çš„è¯»å†™æƒé™ã€‚</p>
<p>ç„¶è€Œè¿˜æ˜¯ä¸è¡Œï¼Œè¿·ä¹‹é”™è¯¯ï¼Œæ”¹å˜æ€è·¯ï¼Œç»™jenkins-workspaceä¸‹çš„jaråŒ…èµ‹äºˆæƒé™ï¼š
<code>chmod u+x $WORKSPACE/target/archive-1.0.jar</code>
ç„¶åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨<code>cp</code>æŒ‡ä»¤ï¼Œç„¶è€Œåªæ˜¯Terminalå¯ä»¥ä½¿ç”¨ï¼Œjenkinsçš„è„šæœ¬è¿˜æ˜¯æ— æ³•ä½¿ç”¨ï¼Œæˆ‘æ—¥&hellip;
æš‚æ—¶æ”¾å¼ƒï¼Œä½¿ç”¨tomcatå®‰è£…jenkins&hellip;</p>
<h2 id="é‡è£…jenkins">é‡è£…jenkins<a hidden class="anchor" aria-hidden="true" href="#é‡è£…jenkins">#</a></h2>
<p>åˆ é™¤å®‰è£…jenkinsç”¨æˆ·çš„ä¸»ç›®å½•ï¼ˆ~ï¼‰ä¸‹çš„ï¼ˆ.jenkinsï¼‰æ–‡ä»¶å¤¹ï¼Œç„¶åé‡å¯ï¼Œå°±å¯ä»¥é‡æ–°é…ç½®jenkins</p>
<h1 id="jenkinsæŒ‡å®šspring-bootçš„é…ç½®æ–‡ä»¶">jenkinsæŒ‡å®šspring bootçš„é…ç½®æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#jenkinsæŒ‡å®šspring-bootçš„é…ç½®æ–‡ä»¶">#</a></h1>
<p>åœ¨å¯åŠ¨è„šæœ¬åŠ å¦‚ä¸‹ä»£ç ï¼š
<code>-Dspring.profiles.active=dev</code></p>
<h1 id="jenkinsé…ç½®åˆ†å¸ƒå¼åº”ç”¨æ—¶æ—¥å¿—æ–‡ä»¶é—®é¢˜">jenkinsé…ç½®åˆ†å¸ƒå¼åº”ç”¨æ—¶æ—¥å¿—æ–‡ä»¶é—®é¢˜ã€‚<a hidden class="anchor" aria-hidden="true" href="#jenkinsé…ç½®åˆ†å¸ƒå¼åº”ç”¨æ—¶æ—¥å¿—æ–‡ä»¶é—®é¢˜">#</a></h1>
<p>å› ä¸ºåˆ†å¸ƒå¼æ˜¯å¤šä¸ªæœåŠ¡åˆ†å¼€éƒ¨ç½²ï¼Œæ‰€ä»¥å¦‚æœå¤šä¸ªæœåŠ¡å‘åŒæ—¶å‘ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å†™å†…å®¹ï¼Œä¼šé€ æˆæ­»é”é—®é¢˜ï¼Œå¯¼è‡´è°éƒ½æ— æ³•å†™å…¥æ—¥å¿—ã€‚
æ‰€ä»¥ï¼Œåˆ†å¸ƒå¼æœåŠ¡ï¼Œä¸€å®šè¦æ¯ä¸ªæœåŠ¡å•ç‹¬å†™è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶ã€‚</p>
<h1 id="éƒ¨ç½²æ™®é€šspring-boot-é¡¹ç›®">éƒ¨ç½²æ™®é€šspring boot é¡¹ç›®<a hidden class="anchor" aria-hidden="true" href="#éƒ¨ç½²æ™®é€šspring-boot-é¡¹ç›®">#</a></h1>
<h2 id="general">General<a hidden class="anchor" aria-hidden="true" href="#general">#</a></h2>
<p>å‹¾é€‰Discard old builds(ä¸¢å¼ƒæ—§çš„æ„å»º)ï¼Œåè¾¹ä¸¤ä¸ªç©ºå¡«1ã€‚</p>
<p>å¤šåˆ†æ”¯æ„å»ºã€‚
jenkinsåœ¨éƒ¨ç½²æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©åˆ†æ”¯æ„å»ºã€‚</p>
<ol>
<li>ä¸‹è½½æ’ä»¶<code>Git Parameter</code></li>
<li>ä¸‹è½½å®Œï¼Œåœ¨é¡¹ç›®æ„å»ºæ—¶ï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸ªé€‰é¡¹<code>å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹</code></li>
<li>å‹¾é€‰å‚æ•°åŒ–æ„å»ºï¼Œç„¶åé€‰æ‹©<code>git å‚æ•°</code></li>
<li>åç§°ï¼šgitBranchï¼Œæè¿°ï¼šgitå¤šåˆ†æ”¯é€‰æ‹©ï¼Œå‚æ•°ç±»å‹ï¼šbranch or tagï¼ˆåˆ†æ”¯æˆ–æ ‡ç­¾ï¼‰</li>
<li>Branches to buildï¼š<code>$gitBranch</code></li>
</ol>
<p>ç„¶åæ„å»ºæ—¶ï¼Œä¼šè®©ä½ é€‰æ‹©åˆ†æ”¯ï¼Œç„¶åæ„å»ºå³å¯ã€‚</p>
<h2 id="source-code-management">Source Code Management<a hidden class="anchor" aria-hidden="true" href="#source-code-management">#</a></h2>
<p>é€‰æ‹©git
åˆ†åˆ«å¡«å…¥ä»“åº“åœ°å€å’Œä¿å­˜è´¦å·å¯†ç </p>
<h2 id="build-triggers">Build Triggers<a hidden class="anchor" aria-hidden="true" href="#build-triggers">#</a></h2>
<p>å‹¾é€‰<code>Build whenever a SNAPSHOT dependency is built</code></p>
<h2 id="pre-stepsä¹‹å‰çš„æ­¥éª¤">Pre Steps(ä¹‹å‰çš„æ­¥éª¤)<a hidden class="anchor" aria-hidden="true" href="#pre-stepsä¹‹å‰çš„æ­¥éª¤">#</a></h2>
<p>ä¸åŠ¨</p>
<h2 id="build">Build<a hidden class="anchor" aria-hidden="true" href="#build">#</a></h2>
<p>Root POMï¼š
<code>pom.xml</code>
æ³¨æ„ï¼šé»˜è®¤éƒ¨ç½²é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„pom.xml</p>
<p>Goals and optionsï¼š
<code>clean install -Dmaven.test.skip=true -am</code></p>
<h2 id="post-stepså‘å¸ƒæ­¥éª¤">Post Stepsï¼ˆå‘å¸ƒæ­¥éª¤ï¼‰<a hidden class="anchor" aria-hidden="true" href="#post-stepså‘å¸ƒæ­¥éª¤">#</a></h2>
<p>å‹¾é€‰Run only if build succeeds</p>
<p>Add post-build stepä¸‹æ‹‰é€‰ï¼Œé€‰æ‹©<code>Execute shell</code>
ç„¶åè¾“å…¥</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sh /usr/local/xxx.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¡¨ç¤ºæ‰§è¡ŒæœåŠ¡å™¨ä¸Šçš„shè„šæœ¬ã€‚ç„¶ååœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºshè„šæœ¬ï¼Œè„šæœ¬çš„å†…å®¹ä¸ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#!/bin/bash -il
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¯é€‰å‚æ•°ï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>config=-Dspring.profiles.active=prod
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¯é€‰å‚æ•°ï¼ŒæŒ‡å®šæ—¥å¿—æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 1&gt;$project_path/logs/`date + %Y-%m-%d`.log\</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 2&gt;$project_path/logs/log.error\</span>
</span></span><span style="display:flex;"><span>log_path=1&gt;a.log 2&gt;&amp;<span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># jdkå…·ä½“è·¯å¾„ã€‚å¯èƒ½éœ€è¦å…·ä½“è·¯å¾„ï¼Œçœ‹æƒ…å†µï¼Œä¸æ˜¯å…·ä½“è·¯å¾„å‡ºç°è¿‡æ— æ³•ä½¿ç”¨java -jarçš„æƒ…å†µ</span>
</span></span><span style="display:flex;"><span>jdk_path=/usr/lib/jvm/java-1.8.0-openjdk/bin/java
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># é¡¹ç›®åç§°</span>
</span></span><span style="display:flex;"><span>project_name=zw-search
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># é¡¹ç›®åœ°å€</span>
</span></span><span style="display:flex;"><span>project_path=/data/matrix/search
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># jaråŒ…åç§°</span>
</span></span><span style="display:flex;"><span>jar_name=zw-search-1.0-SNAPSHOT.jar
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¯åŠ¨å‚æ•°</span>
</span></span><span style="display:flex;"><span>JAVA_OPTS=<span style="color:#0ff;font-weight:bold">&#39;-server -Xms512m -Xmx512m&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¯åŠ¨jaråŒ…å‘½ä»¤ï¼Œæ—¥å¿—ä½ç½®è¦å†™ç»å¯¹è·¯å¾„ï¼Œå¦åˆ™ä¼šæ²¡æœ‰æ—¥å¿—ã€‚</span>
</span></span><span style="display:flex;"><span>runjar=<span style="color:#0ff;font-weight:bold">&#34;BUILD_ID=dontKillMe sudo nohup </span>$jdk_path<span style="color:#0ff;font-weight:bold"> -jar </span><span style="color:#0ff;font-weight:bold">${</span>JAVA_OPTS<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold"> </span>$project_path<span style="color:#0ff;font-weight:bold">/</span><span style="color:#0ff;font-weight:bold">${</span>jar_name<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold"> 1&gt;</span><span style="color:#0ff;font-weight:bold">${</span>project_path<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">a.log 2&gt;&amp;1 &amp;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># jenkinsæ ¹ç›®å½•</span>
</span></span><span style="display:flex;"><span>WORKSPACE=/root/.jenkins/workspace
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹è¿™ä¸ªjaræ˜¯å¦å·²ç»å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>pid=<span style="color:#0ff;font-weight:bold">`</span>ps -ef | grep $jar_name | grep -v grep | awk <span style="color:#0ff;font-weight:bold">&#39;{print $2}&#39;</span><span style="color:#0ff;font-weight:bold">`</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> [ -n <span style="color:#0ff;font-weight:bold">&#34;</span>$pid<span style="color:#0ff;font-weight:bold">&#34;</span> ]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>   <span style="color:#fff;font-weight:bold">kill</span> -9 $pid
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ é™¤æ—§çš„jaråŒ…</span>
</span></span><span style="display:flex;"><span>rm -f $project_path/$jar_name
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;åˆ é™¤æ—§çš„jaråŒ…&#34;</span> $project_path/$jar_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¤åˆ¶jaråŒ…</span>
</span></span><span style="display:flex;"><span>sudo cp $WORKSPACE/zw-search/zw-search/target/$jar_name $project_path
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;å¤åˆ¶jaråŒ…&#34;</span> $WORKSPACE/zw-search/zw-search/target/$jar_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æˆæƒ</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># sudo chmod 777 $project_path/$jar_name</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># sudo chmod u+x /data/matrix/search/zw-search-1.0-SNAPSHOT.jar</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#å¯åŠ¨jar</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">eval</span> $runjar
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;å¯åŠ¨jarå®Œæˆ&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦æ³¨æ„ï¼šè„šæœ¬ä¸­çš„è·¯å¾„ï¼Œéƒ½éœ€è¦ç”¨<strong>ç»å¯¹è·¯å¾„</strong>ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æ—¥å¿—ï¼Œå¤šåŠæ˜¯å› ä¸ºæ—¥å¿—æ–‡ä»¶è·¯å¾„å†™é”™äº†ã€‚
å¯ä»¥å…ˆæ‰¾åˆ°è¿›ç¨‹idï¼Œ<code>ps -ef</code>ã€‚ç„¶åæŸ¥çœ‹ç¨‹åºçš„æ ‡å‡†è¾“å‡ºï¼š<code>/proc/&lt;pid&gt;/fd</code>
ç›®å½•ä¸­æœ‰å¾ˆå¤šæ•°å­—ï¼Œæ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ•°å­—åˆ™ä»£è¡¨æ–‡ä»¶æè¿°ç¬¦ã€‚å…¶ä¸­1 = stdout, 2 = stderrï¼Œç”¨catæˆ–tailæŸ¥çœ‹å³å¯ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/dev/null è¡¨ç¤ºç©ºè®¾å¤‡æ–‡ä»¶
</span></span><span style="display:flex;"><span>0 è¡¨ç¤ºstdinæ ‡å‡†è¾“å…¥
</span></span><span style="display:flex;"><span>1 è¡¨ç¤ºstdoutæ ‡å‡†è¾“å‡º
</span></span><span style="display:flex;"><span>2 è¡¨ç¤ºstderræ ‡å‡†é”™è¯¯
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; file è¡¨ç¤ºå°†æ ‡å‡†è¾“å‡ºè¾“å‡ºåˆ°fileä¸­ï¼Œä¹Ÿå°±ç›¸å½“äº 1&gt;file
</span></span><span style="display:flex;"><span>2&gt; error è¡¨ç¤ºå°†é”™è¯¯è¾“å‡ºåˆ°erroræ–‡ä»¶ä¸­
</span></span><span style="display:flex;"><span>2&gt;&amp;1 ä¹Ÿå°±è¡¨ç¤ºå°†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºä¸Š
</span></span><span style="display:flex;"><span>2&gt;&amp;1 &gt;file ï¼šé”™è¯¯è¾“å‡ºåˆ°ç»ˆç«¯ï¼Œæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶fileï¼Œç­‰äº &gt; file 2&gt;&amp;1(æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ï¼Œé”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º)ã€‚
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&amp; æ”¾åœ¨å‘½ä»¤åˆ°ç»“å°¾ï¼Œè¡¨ç¤ºåå°è¿è¡Œï¼Œé˜²æ­¢ç»ˆç«¯ä¸€ç›´è¢«æŸä¸ªè¿›ç¨‹å ç”¨ï¼Œè¿™æ ·ç»ˆç«¯å¯ä»¥æ‰§è¡Œåˆ«åˆ°ä»»åŠ¡ï¼Œé…åˆ &gt;file 2&gt;&amp;1å¯ä»¥å°†logä¿å­˜åˆ°æŸä¸ªæ–‡ä»¶ä¸­ï¼Œä½†å¦‚æœç»ˆç«¯å…³é—­ï¼Œåˆ™è¿›ç¨‹ä¹Ÿåœæ­¢è¿è¡Œã€‚å¦‚ command &gt; file.log 2&gt;&amp;1 &amp; ã€‚
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nohupæ”¾åœ¨å‘½ä»¤çš„å¼€å¤´ï¼Œè¡¨ç¤ºä¸æŒ‚èµ·ï¼ˆno hang upï¼‰ï¼Œä¹Ÿå³ï¼Œå…³é—­ç»ˆç«¯æˆ–è€…é€€å‡ºæŸä¸ªè´¦å·ï¼Œè¿›ç¨‹ä¹Ÿç»§ç»­ä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œä¸€èˆ¬é…åˆ&amp;ç¬¦å·ä¸€èµ·ä½¿ç”¨ã€‚å¦‚nohup command &amp;ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨">éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨<a hidden class="anchor" aria-hidden="true" href="#éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨">#</a></h1>
<p>publish over ssh æ’ä»¶æ— æ³•åœ¨jenkinsæ’ä»¶ä¸­å¿ƒæœç´¢åˆ°çš„è§£å†³åŠæ³•ï¼š
<a href="https://juejin.cn/post/7063299349572222983/">https://juejin.cn/post/7063299349572222983/</a></p>
<p>å‚è€ƒï¼šhttps://www.jianshu.com/p/3ec12f561a9c</p>
<p><code>Manage Jenkins-&gt;Configure System</code>
æŠŠè¦éƒ¨ç½²çš„è¿œç¨‹æœåŠ¡å™¨ä¿¡æ¯å¡«å¥½ã€‚
Hostnameï¼šè¿œç¨‹æœåŠ¡å™¨çš„ip
Portï¼š22
Credentialsï¼šæœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç </p>
<p>æœ€åç‚¹<code>Check connection</code>ï¼Œæµ‹è¯•æ˜¯å¦è¿æ¥æˆåŠŸã€‚</p>
<p>æˆ‘ä»¬ä¸ä½¿ç”¨Publish Over SSHæ’ä»¶ï¼Œå› ä¸ºjenkinsæ’ä»¶ä¸­å¿ƒå·²ç»æœç´¢ä¸åˆ°è¿™ä¸ªæ’ä»¶äº†ã€‚
æ‰€ä»¥è¦åœ¨å®‰è£…jenkinsæœºå™¨ä¸Šå®‰è£…expectï¼Œç”¨shellè„šæœ¬å®ç°æŠŠæ–‡ä»¶å‘é€åˆ°æœåŠ¡å™¨ã€‚</p>
<p>å®‰è£…expect
<code>yum -y install expect</code></p>
<p>åœ¨jenkinsæœåŠ¡å™¨çš„åˆ›å»ºè„šæœ¬æ–‡ä»¶ï¼šexpect_scp.sh</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#!/usr/bin/expect
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> timeout <span style="color:#ff0;font-weight:bold">100</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> host [lindex $argv 0]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> username [lindex $argv 1]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> password [lindex $argv 2]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> src_file [lindex $argv 3]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> dest_file [lindex $argv 4]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>spawn scp $src_file $username@$host:$dest_file  
</span></span><span style="display:flex;"><span> expect {  
</span></span><span style="display:flex;"><span> <span style="color:#0ff;font-weight:bold">&#34;(yes/no)?&#34;</span>  
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>   send <span style="color:#0ff;font-weight:bold">&#34;yes\n&#34;</span>
</span></span><span style="display:flex;"><span>  expect <span style="color:#0ff;font-weight:bold">&#34;*assword:&#34;</span> { send <span style="color:#0ff;font-weight:bold">&#34;</span>$password<span style="color:#0ff;font-weight:bold">\n&#34;</span>}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#0ff;font-weight:bold">&#34;*assword:&#34;</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    send <span style="color:#0ff;font-weight:bold">&#34;</span>$password<span style="color:#0ff;font-weight:bold">\n&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>expect <span style="color:#0ff;font-weight:bold">&#34;100%&#34;</span>  
</span></span><span style="display:flex;"><span>expect eof
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»™æ­¤æ–‡ä»¶æ‰§è¡Œæƒé™
<code>chmod +x expect_scp</code></p>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œé€šè¿‡è„šæœ¬ä¾æ¬¡ä¼ å…¥ä¸»æœº ç”¨æˆ·å å¯†ç  æºæ–‡ä»¶è·¯å¾„ ç›®æ ‡æ–‡ä»¶è·¯å¾„å°±å¯ä»¥è‡ªåŠ¨å¡«å……å¯†ç é€šè¿‡scpå‘½ä»¤æŠŠæ–‡ä»¶å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨è·¯å¾„ã€‚</p>
<p>æ–°å»ºexpect_sshè„šæœ¬æ–‡ä»¶</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#!/usr/bin/expect
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> timeout <span style="color:#ff0;font-weight:bold">100</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> host [lindex $argv 0]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> username [lindex $argv 1]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> password [lindex $argv 2]
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> shellinfo [lindex $argv 3]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>spawn ssh $username@$host
</span></span><span style="display:flex;"><span> expect {
</span></span><span style="display:flex;"><span> <span style="color:#0ff;font-weight:bold">&#34;(yes/no)?&#34;</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>   send <span style="color:#0ff;font-weight:bold">&#34;yes\n&#34;</span>
</span></span><span style="display:flex;"><span>  expect <span style="color:#0ff;font-weight:bold">&#34;*assword:&#34;</span> { send <span style="color:#0ff;font-weight:bold">&#34;</span>$password<span style="color:#0ff;font-weight:bold">\n&#34;</span>}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#0ff;font-weight:bold">&#34;*assword:&#34;</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    send <span style="color:#0ff;font-weight:bold">&#34;</span>$password<span style="color:#0ff;font-weight:bold">\n&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>expect <span style="color:#0ff;font-weight:bold">&#34;*]#&#34;</span>
</span></span><span style="display:flex;"><span>send <span style="color:#0ff;font-weight:bold">&#34;</span>$shellinfo<span style="color:#0ff;font-weight:bold">\r&#34;</span>
</span></span><span style="display:flex;"><span>expect <span style="color:#0ff;font-weight:bold">&#34;*]#&#34;</span>
</span></span><span style="display:flex;"><span>send <span style="color:#0ff;font-weight:bold">&#34;exit\r&#34;</span>
</span></span><span style="display:flex;"><span>expect eof
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»™expect_sshæ‰§è¡Œæƒé™
<code>chmod +x expect_ssh</code></p>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œè„šæœ¬ä¸­ä¾æ¬¡ä¼ å…¥ä¸»æœº ç”¨æˆ·å å¯†ç  è¿œç¨‹å‘½ä»¤ å°±å¯ä»¥åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤äº†ã€‚</p>
<p>åœ¨jenkinsä¸Šåˆ›å»ºä¸€ä¸ªitemï¼Œé€‰æ‹©<code>Freestyle project</code>ã€‚</p>
<p>General
è¿™é‡Œæœ‰ä¸€ä¸ªThis project is parameterizedé€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥æ„å»ºkey valueå‚æ•°ï¼Œåœ¨è¿™é‡Œæ·»åŠ çš„å‚æ•°åœ¨åç»­æ­¥éª¤ä¸­éƒ½å¯ä»¥ç”¨<code>$å‚æ•°å</code>çš„æ–¹å¼ç›´æ¥å¼•ç”¨å‚æ•°çš„å€¼ï¼Œå°±æ˜¯ä¸ªè‡ªå·±å£°æ˜çš„å˜é‡ã€‚
æœ‰booleanã€stringã€textã€passwordç­‰å¸¸ç”¨ç±»å‹çš„å‚æ•°ã€‚ç‚¹å‡»This project is parameterizedæ·»åŠ å‡ ä¸ªå‚æ•°ï¼Œå¯æ ¹æ®è‡ªèº«éœ€è¦çµæ´»å£°æ˜ã€‚</p>
<p>stringç±»å‹çš„jarNameï¼Œé»˜è®¤å€¼æ˜¯mavenæ‰“åŒ…åjaråŒ…çš„åå­—ï¼Œä¾‹å¦‚ï¼š
<code>zw-zzw-1.0-SNAPSHOT.jar</code>
stringç±»å‹çš„projectNameï¼Œå³é¡¹ç›®åã€‚
stringç±»å‹çš„expectScpPathï¼Œä¸Šé¢æ–°å»ºçš„expect_scpå¯è¿è¡Œè„šæœ¬çš„è·¯å¾„ã€‚
stringç±»å‹çš„scpHostï¼Œscpå‘é€æ–‡ä»¶çš„æœåŠ¡å™¨åœ°å€ã€‚
stringç±»å‹çš„scpUserNameï¼Œscpå‘é€æœåŠ¡å™¨çš„ç”¨æˆ·åã€‚
passwordç±»å‹çš„scpPwdï¼Œscpå‘é€æœåŠ¡å™¨çš„å¯†ç ã€‚
stringç±»å‹çš„scpTargetPathï¼Œscpè¿œç¨‹æœåŠ¡å™¨ç›®æ ‡è·¯å¾„åœ°å€ã€‚</p>
<p>Source Code Managementï¼šå¡«å†™gitä»“åº“çš„åœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<p>Build Triggersï¼šå•¥éƒ½ä¸é€‰ã€‚
Build Environmentï¼š
è¿™é‡Œå¯ä»¥é…ç½®è¿œç¨‹æœåŠ¡å™¨æ„å»ºä¹‹å‰æˆ–ä¹‹åçš„æ“ä½œï¼Œè¿™é‡ŒæŠŠæ„å»ºå®Œæˆä¹‹åå¯¹æœåŠ¡å™¨jaråŒ…çš„å¤‡ä»½å’Œé‡å¯shellå‘½ä»¤é…ç½®åœ¨è¿™é‡Œã€‚
å‹¾é€‰<code>Execute shell script on remote host using ssh</code></p>
<p>å¡«å†™<code>Post build script</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">cd</span> $scpTargetPath
</span></span><span style="display:flex;"><span>cp $jarName backup/$projectName_<span style="color:#fff;font-weight:bold">$(</span>date +%F-%T<span style="color:#fff;font-weight:bold">)</span>.jar
</span></span><span style="display:flex;"><span>pid=<span style="color:#fff;font-weight:bold">$(</span>ps -ef|grep $jarName |egrep -v grep|awk <span style="color:#0ff;font-weight:bold">&#39;{print $2}&#39;</span><span style="color:#fff;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">kill</span> -9 $pid
</span></span><span style="display:flex;"><span>nohup java -jar $jarName &gt;/dev/null 2&gt;&amp;<span style="color:#ff0;font-weight:bold">1</span> &amp;
</span></span></code></pre></td></tr></table>
</div>
</div><p>buildï¼š
æŠŠmavenæ‰“åŒ…å‘½ä»¤å’Œæ‰“åŒ…å®Œæ¯•ä¹‹åæŠŠåŒ…å‘å¸ƒåˆ°æœåŠ¡å™¨çš„shellå‘½ä»¤é…ç½®åœ¨è¿™ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">#!/bin/bash -il
</span></span></span><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold"></span><span style="color:#fff;font-weight:bold">pwd</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">cd</span> $projectName/
</span></span><span style="display:flex;"><span>mvn clean package -Dmaven.test.skip=<span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>$expectScpPath $scpHost $scpUserName $scpPwd target/*.jar $scpTargetPath
</span></span></code></pre></td></tr></table>
</div>
</div><p>Post-build Actionsï¼ˆæ„å»ºåæ“ä½œï¼‰ï¼š
æ„å»ºå®Œæˆååˆ é™¤workspaceä¸‹æœ¬ä»»åŠ¡ä¸‹è½½çš„ä»£ç æ–‡ä»¶ï¼Œè§†éœ€è¦è€Œå®šï¼Œä¹Ÿå¯ä»¥ä¸åˆ é™¤ã€‚</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://funny-toffee-4aa7c3.netlify.app/tags/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/">å…¶ä»–åŸºç¡€</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://funny-toffee-4aa7c3.netlify.app/">Wjy&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
