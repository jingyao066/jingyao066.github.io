<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>dubbo | Wjy&#39;s Blog</title>
<meta name="keywords" content="其他基础">
<meta name="description" content="dubbo是什么
是一个Jar包，一个分布式框架，一个远程服务调用的分布式框架。
为什么要分布式？为什么要远程调用？

">
<meta name="author" content="">
<link rel="canonical" href="https://funny-toffee-4aa7c3.netlify.app/posts/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/dubbo/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://funny-toffee-4aa7c3.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://funny-toffee-4aa7c3.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://funny-toffee-4aa7c3.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://funny-toffee-4aa7c3.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://funny-toffee-4aa7c3.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="dubbo" />
<meta property="og:description" content="dubbo是什么
是一个Jar包，一个分布式框架，一个远程服务调用的分布式框架。
为什么要分布式？为什么要远程调用？

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://funny-toffee-4aa7c3.netlify.app/posts/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/dubbo/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-17T11:05:53+00:00" />
<meta property="article:modified_time" content="2019-04-17T11:05:53+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="dubbo"/>
<meta name="twitter:description" content="dubbo是什么
是一个Jar包，一个分布式框架，一个远程服务调用的分布式框架。
为什么要分布式？为什么要远程调用？

"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "dubbo",
      "item": "https://funny-toffee-4aa7c3.netlify.app/posts/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/dubbo/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "dubbo",
  "name": "dubbo",
  "description": "dubbo是什么 是一个Jar包，一个分布式框架，一个远程服务调用的分布式框架。 为什么要分布式？为什么要远程调用？ ",
  "keywords": [
    "其他基础"
  ],
  "articleBody": "dubbo是什么 是一个Jar包，一个分布式框架，一个远程服务调用的分布式框架。 为什么要分布式？为什么要远程调用？ 以前是单服务应用，调用方法在服务内直接调用即可。 现在拆分成多个服务，controller和service不在一个服务里了，controller不能直接调用service的方法了。那只能远程调用了，dubbo就可以解决这个问题。\n使用Dubbo的好处\n透明化的远程方法调用，就像调用本地方法一样调用远程方法，只需简单配置，没有任何API侵入。 负载均衡及容错机制，可在内网替代F5等硬件负载均衡器，降低成本，减少单点。 服务自动注册与发现，不再需要写死服务提供方地址，注册中心基于接口名查询服务提供者的IP地址，并且能够平滑添加或删除服务提供者。 Dubbo采用全Spring配置方式，透明化接入应用，对应用没有任何API侵入，只需用Spring加载Dubbo的配置即可，Dubbo基于Spring的Schema扩展进行加载。 角色说明： Provider（生产者）: 暴露服务的服务提供方。 Consumer（消费者）: 调用远程服务的服务消费方。 如图，我们可以简单理解为web1234需要调用service1234的服务，所以web1234是消费者，service1234是生产者。 如果按照上面的逻辑，消费者调用生产者的服务，那是否像下面这样调用： 太乱了， 肯定不是这样。\n此时引出注册中心的概念： 服务注册与发现的注册中心。 注册中心有很多，现在只简单说zookeeper。 zookeeper是用于分布式中一致性处理的框架。 简单的讲，zookeeper就是个中介，卖楼的（生产者）把楼盘信息放在中介（注册中心）那里，想买楼的（消费者）去中介那里获得楼盘资源清单。于是，我们的图变成了这样： Monitor：统计服务的调用次调和调用时间的监控中心。 Container：服务运行的容器。\n总体结构如下（官方的图）： 上图的运行流程如下： 0. 服务容器负责启动，加载，运行服务提供者。\n服务提供者（生产者）在启动时，向注册中心注册自己提供的服务。 服务消费者在启动时，向注册中心订阅自己所需的服务。 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。 dubbo官网\ndubbo控制台 dubbo admin官网介绍 github地址\n下载代码:git clone https://github.com/apache/dubbo-admin.git 在dubbo-admin-server/src/main/resources/application.properties中指定注册中心地址 构建mvn clean package 启动 mvn --projects dubbo-admin-server spring-boot:run 或 cd dubbo-admin-distribution/target; java -jar dubbo-admin-0.1.jar 访问 http://localhost:8080 修改访问端口： vim dubbo-admin\\dubbo-admin-server\\src\\main\\resources\\application.properties 在任意位置添加： server.port=9000\n目前新版buddo-admin还没有用户名密码访问功能。\\\n老版控制台 github 将项目整体下载，解压并进入到dubbo-admin 打包mvn package -Dmaven.skip.test=true 进入target，找到打好的war包，复制到tomcat的webapps下，并更名为ROOT.war 启动tomcat，启动完了再停止(这一步是要通过tomcat将war包解开。) 进入到webapps\\dubbo-admin-2.6.0\\WEB-INF，修改dubbo.properties\n1 2 3 dubbo.registry.address=zookeeper://127.0.0.1:2181 dubbo.admin.root.password=root dubbo.admin.guest.password=guest 修改你的zookeeper地址。 修改你的用户名和密码，需要注意用户名在=号前边，等号后边的是密码。 然后再启动tomcat，访问即可。\n参考\n超时与重试 在provider和consumer端，都提供了超时(timeout)和重试(retries)的参数配置。 timeout默认值为1000，单位毫秒，表示超时时间是1秒； retries默认值为2，表示重试2次，加上本身调用1次，一共有3次调用。 在org.apache.dubbo.common.Constants类可以找到： public static final int DEFAULT_TIMEOUT = 1000; public static final int DEFAULT_RETRIES = 2;\nconsumer端配置优先于provider端配置。\n总结： case 1： 默认情况，provider和consumer端的timeout和retires均不设置，使用默认值 在不设置timeout和retries的时候，如果provider端接口一直出现超时，provider端会调用3次，而日志中没有任何警告或错误信息； consumer端虽然重试了2次，加本身调用的1次，一共发起3次调用，如果provider3次全部超时，consumer端会打印超时异常信息； provider端日志中没有任何警告或错误信息不利于发现问题；前面的调用并未终止，如果是非查询类接口且接口没有实现幂等性时，可能产生重复数据。\ncase 2： provider端retries=0，consumer端不设置 在provider端设置retries=0已经生效，接口仅调用了1次。\ncase 3： provider端retries=0，consumer端retries=1 consumer的retries优先级较高，两端都设置的情况下，以consumer端的retries为准。\ncase 4： provider端timeout=3000, retries=0，consumer端retries=0 provider端设置timeout已生效。\ncase 5： provider端timeout=1000, retries=0，consumer端retries=0 provider端设置了timeout，如果接口调用超时，provider会打印WRAN信息。\ncase 6： provider端timeout=1000, retries=0，consumer端timeout=3000, retries=0 consumer的timeout优先级较高，两端都设置的情况下，以consumer端的timeout为准。\n参考dubbo官网的文档，并结合工作中项目实践，对超时和重试这2个参数做个总结：\n超时(timeout)默认1000毫秒，重试(retries)默认2次(即一共调用3次)； provider端在dubbo:service中配置，consumer端在dubbo:reference中配置，consumer端的配置会覆盖provider配置； 超时(timeout)建议在provider端配置，因为作为提供方，它更清楚自己接口的耗时情况，并且provider端设置了timeout，在日志中有TimeoutFilter的WARN信息； 在provider端一般接口timeout设置为5秒或者10秒，如果是复杂查询、导出报表、调用第三方接口、本身是最上游的接口等，根据情况考虑设置大一点； 在consumer端配置设置timeout会覆盖provider设置，但有时设置timeout能够让consumer快速失败，而不因为下游provider服务接口的问题拖垮consumer本身； retries建议在provider端设置为0，consumer根据情况也可以设置为0，因为重试可能因非幂等性原因导致重复数据，并且超时情况即便重试成功consumer端可能也收不到成功响应； 参考 参考2\ndubbo报错 com.alibaba.com.caucho.hessian.io.HessianProtocolException: ‘xxx’ could not be instantiated Hessian反序列化时，使用反射调用构造函数生成对象时，传入的参数不合法，造成了上面的异常。 知道了原因，解决的方法也很简单，就是添加了一个无参的构造器给CountObject，于是上面的问题就解决了。\n1 2 3 public ResponseUtil() { } https://hittyt.iteye.com/blog/1691772\nTried 3 times of the providers 意思是服务端被重复调用三次，然而provider并没有报错。 我觉得是provider的响应时间问题，就是说consumer等待provider默认是有时间限制的(默认1000ms)，即如果1秒内provider没有响应，就会再次调用。 如果三次调用都在1秒内没有响应，就是调用失败，会报上边的错误。这时加上timeout配置即可：\n1 2 @Reference(version = \"1.0.0\",timeout = 60000) private GrowthService growthService; ",
  "wordCount" : "3229",
  "inLanguage": "en",
  "datePublished": "2019-04-17T11:05:53Z",
  "dateModified": "2019-04-17T11:05:53Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://funny-toffee-4aa7c3.netlify.app/posts/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/dubbo/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://funny-toffee-4aa7c3.netlify.app/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://funny-toffee-4aa7c3.netlify.app/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/links" title="🤝友链">
                    <span>🤝友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://funny-toffee-4aa7c3.netlify.app/">Home</a>&nbsp;»&nbsp;<a href="https://funny-toffee-4aa7c3.netlify.app/posts/">Posts</a></div>
    <h1 class="post-title">
      dubbo
    </h1>
    <div class="post-meta"><span title='2019-04-17 11:05:53 +0000 UTC'>2019-04-17</span>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#dubbo%e6%98%af%e4%bb%80%e4%b9%88" aria-label="dubbo是什么">dubbo是什么</a></li>
                <li>
                    <a href="#dubbo%e6%8e%a7%e5%88%b6%e5%8f%b0" aria-label="dubbo控制台">dubbo控制台</a><ul>
                        
                <li>
                    <a href="#%e8%80%81%e7%89%88%e6%8e%a7%e5%88%b6%e5%8f%b0" aria-label="老版控制台">老版控制台</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%b6%85%e6%97%b6%e4%b8%8e%e9%87%8d%e8%af%95" aria-label="超时与重试">超时与重试</a></li>
                <li>
                    <a href="#dubbo%e6%8a%a5%e9%94%99" aria-label="dubbo报错">dubbo报错</a><ul>
                        
                <li>
                    <a href="#comalibabacomcauchohessianiohessianprotocolexception-xxx-could-not-be-instantiated" aria-label="com.alibaba.com.caucho.hessian.io.HessianProtocolException: &amp;lsquo;xxx&amp;rsquo; could not be instantiated">com.alibaba.com.caucho.hessian.io.HessianProtocolException: &lsquo;xxx&rsquo; could not be instantiated</a></li>
                <li>
                    <a href="#tried-3-times-of-the-providers" aria-label="Tried 3 times of the providers">Tried 3 times of the providers</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="dubbo是什么">dubbo是什么<a hidden class="anchor" aria-hidden="true" href="#dubbo是什么">#</a></h1>
<p>是一个Jar包，一个分布式框架，一个远程服务调用的分布式框架。
为什么要分布式？为什么要远程调用？
<img loading="lazy" src="1.jpg" alt=""  />
</p>
<p>以前是单服务应用，调用方法在服务内直接调用即可。
现在拆分成多个服务，controller和service不在一个服务里了，controller不能直接调用service的方法了。那只能远程调用了，dubbo就可以解决这个问题。</p>
<p>使用Dubbo的好处</p>
<ul>
<li>透明化的远程方法调用，就像调用本地方法一样调用远程方法，只需简单配置，没有任何API侵入。</li>
<li>负载均衡及容错机制，可在内网替代F5等硬件负载均衡器，降低成本，减少单点。</li>
<li>服务自动注册与发现，不再需要写死服务提供方地址，注册中心基于接口名查询服务提供者的IP地址，并且能够平滑添加或删除服务提供者。</li>
<li>Dubbo采用全Spring配置方式，透明化接入应用，对应用没有任何API侵入，只需用Spring加载Dubbo的配置即可，Dubbo基于Spring的Schema扩展进行加载。</li>
</ul>
<p>角色说明：
Provider（生产者）: 暴露服务的服务提供方。
Consumer（消费者）: 调用远程服务的服务消费方。
如图，我们可以简单理解为web1234需要调用service1234的服务，所以web1234是消费者，service1234是生产者。
<img loading="lazy" src="2.jpg" alt=""  />
</p>
<p>如果按照上面的逻辑，消费者调用生产者的服务，那是否像下面这样调用：
<img loading="lazy" src="3.jpg" alt=""  />

太乱了， 肯定不是这样。</p>
<p>此时引出注册中心的概念： 服务注册与发现的注册中心。
注册中心有很多，现在只简单说zookeeper。
zookeeper是用于分布式中一致性处理的框架。
简单的讲，zookeeper就是个中介，卖楼的（生产者）把楼盘信息放在中介（注册中心）那里，想买楼的（消费者）去中介那里获得楼盘资源清单。于是，我们的图变成了这样：
<img loading="lazy" src="4.jpg" alt=""  />
</p>
<p>Monitor：统计服务的调用次调和调用时间的监控中心。
Container：服务运行的容器。</p>
<p>总体结构如下（官方的图）：
<img loading="lazy" src="5.png" alt=""  />
</p>
<p>上图的运行流程如下：
0. 服务容器负责启动，加载，运行服务提供者。</p>
<ol>
<li>服务提供者（生产者）在启动时，向注册中心注册自己提供的服务。</li>
<li>服务消费者在启动时，向注册中心订阅自己所需的服务。</li>
<li>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</li>
<li>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</li>
<li>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</li>
</ol>
<p><a href="http://dubbo.apache.org/zh-cn/index.html">dubbo官网</a></p>
<h1 id="dubbo控制台">dubbo控制台<a hidden class="anchor" aria-hidden="true" href="#dubbo控制台">#</a></h1>
<p><a href="http://dubbo.apache.org/zh-cn/blog/dubbo-admin.html">dubbo admin官网介绍</a>
<a href="https://github.com/apache/dubbo-admin">github地址</a></p>
<ul>
<li>下载代码:<code>git clone https://github.com/apache/dubbo-admin.git</code></li>
<li>在dubbo-admin-server/src/main/resources/application.properties中指定注册中心地址</li>
<li>构建<code>mvn clean package</code></li>
<li>启动
<code>mvn --projects dubbo-admin-server spring-boot:run</code>
或
<code>cd dubbo-admin-distribution/target; java -jar dubbo-admin-0.1.jar</code></li>
<li>访问
<code>http://localhost:8080</code></li>
</ul>
<p>修改访问端口：
<code>vim dubbo-admin\dubbo-admin-server\src\main\resources\application.properties</code>
在任意位置添加：
<code>server.port=9000</code></p>
<p>目前新版buddo-admin还没有用户名密码访问功能。\</p>
<h2 id="老版控制台">老版控制台<a hidden class="anchor" aria-hidden="true" href="#老版控制台">#</a></h2>
<p><a href="https://github.com/apache/dubbo/tree/dubbo-2.6.0">github</a>
将项目整体下载，解压并进入到<code>dubbo-admin</code>
打包<code>mvn  package -Dmaven.skip.test=true</code>
进入target，找到打好的war包，复制到tomcat的webapps下，并更名为<code>ROOT.war</code>
启动tomcat，启动完了再停止(这一步是要通过tomcat将war包解开。)
进入到<code>webapps\dubbo-admin-2.6.0\WEB-INF</code>，修改<code>dubbo.properties</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>dubbo.registry.address=zookeeper://127.0.0.1:2181
</span></span><span style="display:flex;"><span>dubbo.admin.root.password=root
</span></span><span style="display:flex;"><span>dubbo.admin.guest.password=guest
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改你的zookeeper地址。
修改你的用户名和密码，需要注意用户名在=号前边，等号后边的是密码。
然后再启动tomcat，访问即可。</p>
<p><a href="https://blog.csdn.net/qq_28988969/article/details/79866111">参考</a></p>
<h1 id="超时与重试">超时与重试<a hidden class="anchor" aria-hidden="true" href="#超时与重试">#</a></h1>
<p>在provider和consumer端，都提供了超时(timeout)和重试(retries)的参数配置。
timeout默认值为1000，单位毫秒，表示超时时间是1秒；
retries默认值为2，表示重试2次，加上本身调用1次，一共有3次调用。
在org.apache.dubbo.common.Constants类可以找到：
<code>public static final int DEFAULT_TIMEOUT = 1000;</code>
<code>public static final int DEFAULT_RETRIES = 2;</code></p>
<p>consumer端配置优先于provider端配置。</p>
<p>总结：
case 1： 默认情况，provider和consumer端的timeout和retires均不设置，使用默认值
在不设置timeout和retries的时候，如果provider端接口一直出现超时，provider端会调用3次，而日志中没有任何警告或错误信息；
consumer端虽然重试了2次，加本身调用的1次，一共发起3次调用，如果provider3次全部超时，consumer端会打印超时异常信息；
provider端日志中没有任何警告或错误信息不利于发现问题；前面的调用并未终止，如果是非查询类接口且接口没有实现幂等性时，可能产生重复数据。</p>
<p>case 2： provider端retries=0，consumer端不设置
在provider端设置retries=0已经生效，接口仅调用了1次。</p>
<p>case 3： provider端retries=0，consumer端retries=1
consumer的retries优先级较高，两端都设置的情况下，以consumer端的retries为准。</p>
<p>case 4： provider端timeout=3000, retries=0，consumer端retries=0
provider端设置timeout已生效。</p>
<p>case 5： provider端timeout=1000, retries=0，consumer端retries=0
provider端设置了timeout，如果接口调用超时，provider会打印WRAN信息。</p>
<p>case 6： provider端timeout=1000, retries=0，consumer端timeout=3000, retries=0
consumer的timeout优先级较高，两端都设置的情况下，以consumer端的timeout为准。</p>
<p>参考dubbo官网的文档，并结合工作中项目实践，对超时和重试这2个参数做个总结：</p>
<ul>
<li>超时(timeout)默认1000毫秒，重试(retries)默认2次(即一共调用3次)；</li>
<li>provider端在<a href="dubbo:service">dubbo:service</a>中配置，consumer端在<a href="dubbo:reference">dubbo:reference</a>中配置，consumer端的配置会覆盖provider配置；</li>
<li>超时(timeout)建议在provider端配置，因为作为提供方，它更清楚自己接口的耗时情况，并且provider端设置了timeout，在日志中有TimeoutFilter的WARN信息；</li>
<li>在provider端一般接口timeout设置为5秒或者10秒，如果是复杂查询、导出报表、调用第三方接口、本身是最上游的接口等，根据情况考虑设置大一点；</li>
<li>在consumer端配置设置timeout会覆盖provider设置，但有时设置timeout能够让consumer快速失败，而不因为下游provider服务接口的问题拖垮consumer本身；</li>
<li>retries建议在provider端设置为0，consumer根据情况也可以设置为0，因为重试可能因非幂等性原因导致重复数据，并且超时情况即便重试成功consumer端可能也收不到成功响应；</li>
</ul>
<p><a href="https://www.cnblogs.com/cdfive2018/p/10204720.html">参考</a>
<a href="https://blog.csdn.net/u013940812/article/details/80041669">参考2</a></p>
<h1 id="dubbo报错">dubbo报错<a hidden class="anchor" aria-hidden="true" href="#dubbo报错">#</a></h1>
<h2 id="comalibabacomcauchohessianiohessianprotocolexception-xxx-could-not-be-instantiated">com.alibaba.com.caucho.hessian.io.HessianProtocolException: &lsquo;xxx&rsquo; could not be instantiated<a hidden class="anchor" aria-hidden="true" href="#comalibabacomcauchohessianiohessianprotocolexception-xxx-could-not-be-instantiated">#</a></h2>
<p>Hessian反序列化时，使用反射调用构造函数生成对象时，传入的参数不合法，造成了上面的异常。
知道了原因，解决的方法也很简单，就是添加了一个无参的构造器给CountObject，于是上面的问题就解决了。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>public ResponseUtil() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://hittyt.iteye.com/blog/1691772">https://hittyt.iteye.com/blog/1691772</a></p>
<h2 id="tried-3-times-of-the-providers">Tried 3 times of the providers<a hidden class="anchor" aria-hidden="true" href="#tried-3-times-of-the-providers">#</a></h2>
<p>意思是服务端被重复调用三次，然而provider并没有报错。
我觉得是provider的响应时间问题，就是说consumer等待provider默认是有时间限制的(默认1000ms)，即如果1秒内provider没有响应，就会再次调用。
如果三次调用都在1秒内没有响应，就是调用失败，会报上边的错误。这时加上timeout配置即可：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@Reference(version = &#34;1.0.0&#34;,timeout = 60000)
</span></span><span style="display:flex;"><span>private GrowthService growthService;
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://funny-toffee-4aa7c3.netlify.app/tags/%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80/">其他基础</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://funny-toffee-4aa7c3.netlify.app/">Wjy&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
