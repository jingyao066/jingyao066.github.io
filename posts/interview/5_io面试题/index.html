<!DOCTYPE html>
<html lang="en" dir="auto">

<head>
    
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;Â»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      5_IOé¢è¯•é¢˜
    </h1>
    <div class="post-meta"><span title='2023-07-10 05:00:00 +0000 UTC'>2023-07-10</span>&nbsp;Â·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%a6%82%e8%bf%b0" aria-label="æ¦‚è¿°">æ¦‚è¿°</a></li>
                <li>
                    <a href="#%e5%ad%97%e8%8a%82%e6%b5%81" aria-label="å­—èŠ‚æµ">å­—èŠ‚æµ</a><ul>
                        
                <li>
                    <a href="#inputstream%e5%ad%97%e8%8a%82%e8%be%93%e5%85%a5%e6%b5%81" aria-label="InputStreamï¼ˆå­—èŠ‚è¾“å…¥æµï¼‰">InputStreamï¼ˆå­—èŠ‚è¾“å…¥æµï¼‰</a></li>
                <li>
                    <a href="#outputstream%e5%ad%97%e8%8a%82%e8%be%93%e5%87%ba%e6%b5%81" aria-label="OutputStreamï¼ˆå­—èŠ‚è¾“å‡ºæµï¼‰">OutputStreamï¼ˆå­—èŠ‚è¾“å‡ºæµï¼‰</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e6%b5%81" aria-label="å­—ç¬¦æµ">å­—ç¬¦æµ</a><ul>
                        
                <li>
                    <a href="#reader%e5%ad%97%e7%ac%a6%e8%be%93%e5%85%a5%e6%b5%81" aria-label="Readerï¼ˆå­—ç¬¦è¾“å…¥æµï¼‰">Readerï¼ˆå­—ç¬¦è¾“å…¥æµï¼‰</a></li>
                <li>
                    <a href="#writer%e5%ad%97%e7%ac%a6%e8%be%93%e5%87%ba%e6%b5%81" aria-label="Writerï¼ˆå­—ç¬¦è¾“å‡ºæµï¼‰">Writerï¼ˆå­—ç¬¦è¾“å‡ºæµï¼‰</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ad%97%e8%8a%82%e7%bc%93%e5%86%b2%e6%b5%81" aria-label="å­—èŠ‚ç¼“å†²æµ">å­—èŠ‚ç¼“å†²æµ</a><ul>
                        
                <li>
                    <a href="#bufferedinputstream%e5%ad%97%e8%8a%82%e7%bc%93%e5%86%b2%e8%be%93%e5%85%a5%e6%b5%81" aria-label="BufferedInputStreamï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰">BufferedInputStreamï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰</a></li>
                <li>
                    <a href="#bufferedoutputstream%e5%ad%97%e8%8a%82%e7%bc%93%e5%86%b2%e8%be%93%e5%87%ba%e6%b5%81" aria-label="BufferedOutputStreamï¼ˆå­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼‰">BufferedOutputStreamï¼ˆå­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼‰</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e7%bc%93%e5%86%b2%e6%b5%81" aria-label="å­—ç¬¦ç¼“å†²æµ">å­—ç¬¦ç¼“å†²æµ</a></li>
                <li>
                    <a href="#%e6%89%93%e5%8d%b0%e6%b5%81" aria-label="æ‰“å°æµ">æ‰“å°æµ</a></li>
                <li>
                    <a href="#%e9%9a%8f%e6%9c%ba%e8%ae%bf%e9%97%ae%e6%b5%81" aria-label="éšæœºè®¿é—®æµ">éšæœºè®¿é—®æµ</a></li>
                <li>
                    <a href="#io%e4%b8%ad%e7%9a%84%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f" aria-label="IOä¸­çš„è®¾è®¡æ¨¡å¼">IOä¸­çš„è®¾è®¡æ¨¡å¼</a><ul>
                        
                <li>
                    <a href="#%e8%a3%85%e9%a5%b0%e5%99%a8%e6%a8%a1%e5%bc%8f" aria-label="è£…é¥°å™¨æ¨¡å¼">è£…é¥°å™¨æ¨¡å¼</a></li>
                <li>
                    <a href="#%e9%80%82%e9%85%8d%e5%99%a8%e6%a8%a1%e5%bc%8f" aria-label="é€‚é…å™¨æ¨¡å¼">é€‚é…å™¨æ¨¡å¼</a></li>
                <li>
                    <a href="#%e9%80%82%e9%85%8d%e5%99%a8%e6%a8%a1%e5%bc%8f-1" aria-label="é€‚é…å™¨æ¨¡å¼">é€‚é…å™¨æ¨¡å¼</a></li>
                <li>
                    <a href="#%e5%b7%a5%e5%8e%82%e6%a8%a1%e5%bc%8f" aria-label="å·¥å‚æ¨¡å¼">å·¥å‚æ¨¡å¼</a></li>
                <li>
                    <a href="#%e8%a7%82%e5%af%9f%e8%80%85%e6%a8%a1%e5%bc%8f" aria-label="è§‚å¯Ÿè€…æ¨¡å¼">è§‚å¯Ÿè€…æ¨¡å¼</a></li></ul>
                </li>
                <li>
                    <a href="#java-io%e6%a8%a1%e5%9e%8b%e7%b2%97%e8%a7%a3" aria-label="Java IOæ¨¡å‹ç²—è§£">Java IOæ¨¡å‹ç²—è§£</a><ul>
                        
                <li>
                    <a href="#%e6%9c%89%e5%93%aa%e4%ba%9b%e5%b8%b8%e8%a7%81%e7%9a%84-io-%e6%a8%a1%e5%9e%8b" aria-label="æœ‰å“ªäº›å¸¸è§çš„ IO æ¨¡å‹?">æœ‰å“ªäº›å¸¸è§çš„ IO æ¨¡å‹?</a></li>
                <li>
                    <a href="#java-%e4%b8%ad-3-%e7%a7%8d%e5%b8%b8%e8%a7%81-io-%e6%a8%a1%e5%9e%8b" aria-label="Java ä¸­ 3 ç§å¸¸è§ IO æ¨¡å‹">Java ä¸­ 3 ç§å¸¸è§ IO æ¨¡å‹</a><ul>
                        
                <li>
                    <a href="#bio-blocking-io" aria-label="BIO (Blocking I/O)">BIO (Blocking I/O)</a></li></ul>
                </li>
                <li>
                    <a href="#nio-non-blockingnew-io" aria-label="NIO (Non-blocking/New I/O)">NIO (Non-blocking/New I/O)</a></li>
                <li>
                    <a href="#aio-asynchronous-io" aria-label="AIO (Asynchronous I/O)">AIO (Asynchronous I/O)</a></li></ul>
                </li>
                <li>
                    <a href="#nio-%e6%a0%b8%e5%bf%83%e7%9f%a5%e8%af%86%e6%80%bb%e7%bb%93" aria-label="NIO æ ¸å¿ƒçŸ¥è¯†æ€»ç»“">NIO æ ¸å¿ƒçŸ¥è¯†æ€»ç»“</a><ul>
                        
                <li>
                    <a href="#nio%e6%a0%b8%e5%bf%83%e7%bb%84%e4%bb%b6" aria-label="NIOæ ¸å¿ƒç»„ä»¶">NIOæ ¸å¿ƒç»„ä»¶</a><ul>
                        
                <li>
                    <a href="#buffer%e7%bc%93%e5%86%b2%e5%8c%ba" aria-label="Bufferï¼ˆç¼“å†²åŒºï¼‰">Bufferï¼ˆç¼“å†²åŒºï¼‰</a></li>
                <li>
                    <a href="#channel%e9%80%9a%e9%81%93" aria-label="Channelï¼ˆé€šé“ï¼‰">Channelï¼ˆé€šé“ï¼‰</a></li>
                <li>
                    <a href="#selector%e9%80%89%e6%8b%a9%e5%99%a8" aria-label="Selectorï¼ˆé€‰æ‹©å™¨ï¼‰">Selectorï¼ˆé€‰æ‹©å™¨ï¼‰</a></li></ul>
                </li>
                <li>
                    <a href="#nio-%e9%9b%b6%e6%8b%b7%e8%b4%9d" aria-label="NIO é›¶æ‹·è´">NIO é›¶æ‹·è´</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="æ¦‚è¿°">æ¦‚è¿°<a hidden class="anchor" aria-hidden="true" href="#æ¦‚è¿°">#</a></h1>
<p>IO å³ <code>Input/Output</code>ï¼Œè¾“å…¥å’Œè¾“å‡ºã€‚æ•°æ®è¾“å…¥åˆ°è®¡ç®—æœºå†…å­˜çš„è¿‡ç¨‹å³è¾“å…¥ï¼Œåä¹‹è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ï¼ˆæ¯”å¦‚æ•°æ®åº“ï¼Œæ–‡ä»¶ï¼Œè¿œç¨‹ä¸»æœºï¼‰çš„è¿‡ç¨‹å³è¾“å‡ºã€‚æ•°æ®ä¼ è¾“è¿‡ç¨‹ç±»ä¼¼äºæ°´æµï¼Œå› æ­¤ç§°ä¸º IO æµã€‚IO æµåœ¨ Java ä¸­åˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµï¼Œè€Œæ ¹æ®æ•°æ®çš„å¤„ç†æ–¹å¼åˆåˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚</p>
<p>Java IO æµçš„ 40 å¤šä¸ªç±»éƒ½æ˜¯ä»å¦‚ä¸‹ 4 ä¸ªæŠ½è±¡ç±»åŸºç±»ä¸­æ´¾ç”Ÿå‡ºæ¥çš„ã€‚</p>
<ul>
<li><code>InputStream</code>/<code>Reader</code>: æ‰€æœ‰çš„è¾“å…¥æµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å…¥æµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å…¥æµã€‚</li>
<li><code>OutputStream</code>/<code>Writer</code>: æ‰€æœ‰è¾“å‡ºæµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å‡ºæµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å‡ºæµã€‚</li>
</ul>
<h1 id="å­—èŠ‚æµ">å­—èŠ‚æµ<a hidden class="anchor" aria-hidden="true" href="#å­—èŠ‚æµ">#</a></h1>
<h2 id="inputstreamå­—èŠ‚è¾“å…¥æµ">InputStreamï¼ˆå­—èŠ‚è¾“å…¥æµï¼‰<a hidden class="anchor" aria-hidden="true" href="#inputstreamå­—èŠ‚è¾“å…¥æµ">#</a></h2>
<p><code>InputStream</code>ç”¨äºä»æºå¤´ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰è¯»å–æ•°æ®ï¼ˆå­—èŠ‚ä¿¡æ¯ï¼‰åˆ°å†…å­˜ä¸­ï¼Œ<code>java.io.InputStream</code>æŠ½è±¡ç±»æ˜¯æ‰€æœ‰å­—èŠ‚è¾“å…¥æµçš„çˆ¶ç±»ã€‚</p>
<p><code>InputStream</code> å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li><code>read()</code>ï¼šè¿”å›è¾“å…¥æµä¸­ä¸‹ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚è¿”å›çš„å€¼ä»‹äº 0 åˆ° 255 ä¹‹é—´ã€‚å¦‚æœæœªè¯»å–ä»»ä½•å­—èŠ‚ï¼Œåˆ™ä»£ç è¿”å› <code>-1</code> ï¼Œè¡¨ç¤ºæ–‡ä»¶ç»“æŸã€‚</li>
<li><code>read(byte b[ ])</code> : ä»è¾“å…¥æµä¸­è¯»å–ä¸€äº›å­—èŠ‚å­˜å‚¨åˆ°æ•°ç»„ <code>b</code> ä¸­ã€‚å¦‚æœæ•°ç»„ <code>b</code> çš„é•¿åº¦ä¸ºé›¶ï¼Œåˆ™ä¸è¯»å–ã€‚å¦‚æœæ²¡æœ‰å¯ç”¨å­—èŠ‚è¯»å–ï¼Œè¿”å› <code>-1</code>ã€‚å¦‚æœæœ‰å¯ç”¨å­—èŠ‚è¯»å–ï¼Œåˆ™æœ€å¤šè¯»å–çš„å­—èŠ‚æ•°æœ€å¤šç­‰äº <code>b.length</code> ï¼Œ è¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚è¿™ä¸ªæ–¹æ³•ç­‰ä»·äº <code>read(b, 0, b.length)</code>ã€‚</li>
<li><code>read(byte b[], int off, int len)</code>ï¼šåœ¨<code>read(byte b[ ])</code> æ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº† <code>off</code> å‚æ•°ï¼ˆåç§»é‡ï¼‰å’Œ <code>len</code> å‚æ•°ï¼ˆè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ï¼‰ã€‚</li>
<li><code>skip(long n)</code>ï¼šå¿½ç•¥è¾“å…¥æµä¸­çš„ n ä¸ªå­—èŠ‚ï¼Œè¿”å›å®é™…å¿½ç•¥çš„å­—èŠ‚æ•°ã€‚</li>
<li><code>available()</code>ï¼šè¿”å›è¾“å…¥æµä¸­å¯ä»¥è¯»å–çš„å­—èŠ‚æ•°ã€‚</li>
<li><code>close()</code>ï¼šå…³é—­è¾“å…¥æµé‡Šæ”¾ç›¸å…³çš„ç³»ç»Ÿèµ„æºã€‚</li>
</ul>
<p>ä» Java 9 å¼€å§‹ï¼Œ<code>InputStream</code> æ–°å¢åŠ äº†å¤šä¸ªå®ç”¨çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>readAllBytes()</code>ï¼šè¯»å–è¾“å…¥æµä¸­çš„æ‰€æœ‰å­—èŠ‚ï¼Œè¿”å›å­—èŠ‚æ•°ç»„ã€‚</li>
<li><code>readNBytes(byte[] b, int off, int len)</code>ï¼šé˜»å¡ç›´åˆ°è¯»å– <code>len</code> ä¸ªå­—èŠ‚ã€‚</li>
<li><code>transferTo(OutputStream out)</code>ï¼šå°†æ‰€æœ‰å­—èŠ‚ä»ä¸€ä¸ªè¾“å…¥æµä¼ é€’åˆ°ä¸€ä¸ªè¾“å‡ºæµã€‚</li>
</ul>
<p><code>FileInputStream</code> æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„å­—èŠ‚è¾“å…¥æµå¯¹è±¡ï¼Œå¯ç›´æ¥æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥ç›´æ¥è¯»å–å•å­—èŠ‚æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¯»å–è‡³å­—èŠ‚æ•°ç»„ä¸­ã€‚</p>
<p><code>FileInputStream</code> ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> (InputStream fis = <span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;input.txt&#34;</span>)) {
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Number of remaining bytes:&#34;</span> + fis.<span style="color:#007f7f">available</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> content;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> skip = fis.<span style="color:#007f7f">skip</span>(2);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;The actual number of bytes skipped:&#34;</span> + skip);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>(<span style="color:#0ff;font-weight:bold">&#34;The content read from file:&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> ((content = fis.<span style="color:#007f7f">read</span>()) != -1) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>((<span style="color:#fff;font-weight:bold">char</span>) content);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¾“å‡º</span>
</span></span><span style="display:flex;"><span>Number of remaining bytes:11
</span></span><span style="display:flex;"><span>The actual number of bytes skipped:2
</span></span><span style="display:flex;"><span>The content read from file: WJY
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸è¿‡ï¼Œä¸€èˆ¬æˆ‘ä»¬æ˜¯ä¸ä¼šç›´æ¥å•ç‹¬ä½¿ç”¨ <code>FileInputStream</code> ï¼Œé€šå¸¸ä¼šé…åˆ <code>BufferedInputStream</code>ï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼Œåæ–‡ä¼šè®²åˆ°ï¼‰æ¥ä½¿ç”¨ã€‚</p>
<p>åƒä¸‹é¢è¿™æ®µä»£ç åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­å°±æ¯”è¾ƒå¸¸è§ï¼Œæˆ‘ä»¬é€šè¿‡ <code>readAllBytes()</code> è¯»å–è¾“å…¥æµæ‰€æœ‰å­—èŠ‚å¹¶å°†å…¶ç›´æ¥èµ‹å€¼ç»™ä¸€ä¸ª <code>String</code> å¯¹è±¡ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// æ–°å»ºä¸€ä¸ª BufferedInputStream å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>BufferedInputStream bufferedInputStream = <span style="color:#fff;font-weight:bold">new</span> BufferedInputStream(<span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;input.txt&#34;</span>));
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¯»å–æ–‡ä»¶çš„å†…å®¹å¹¶å¤åˆ¶åˆ° String å¯¹è±¡ä¸­</span>
</span></span><span style="display:flex;"><span>String result = <span style="color:#fff;font-weight:bold">new</span> String(bufferedInputStream.<span style="color:#007f7f">readAllBytes</span>());
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result);
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>DataInputStream</code> ç”¨äºè¯»å–æŒ‡å®šç±»å‹æ•°æ®ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»ç»“åˆå…¶å®ƒæµï¼Œæ¯”å¦‚ <code>FileInputStream</code> ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>FileInputStream fileInputStream = <span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;input.txt&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//å¿…é¡»å°†fileInputStreamä½œä¸ºæ„é€ å‚æ•°æ‰èƒ½ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>DataInputStream dataInputStream = <span style="color:#fff;font-weight:bold">new</span> DataInputStream(fileInputStream);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//å¯ä»¥è¯»å–ä»»æ„å…·ä½“çš„ç±»å‹æ•°æ®</span>
</span></span><span style="display:flex;"><span>dataInputStream.<span style="color:#007f7f">readBoolean</span>();
</span></span><span style="display:flex;"><span>dataInputStream.<span style="color:#007f7f">readInt</span>();
</span></span><span style="display:flex;"><span>dataInputStream.<span style="color:#007f7f">readUTF</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ObjectInputStream</code> ç”¨äºä»è¾“å…¥æµä¸­è¯»å– Java å¯¹è±¡ï¼ˆååºåˆ—åŒ–ï¼‰ï¼Œ<code>ObjectOutputStream</code> ç”¨äºå°†å¯¹è±¡å†™å…¥åˆ°è¾“å‡ºæµ(åºåˆ—åŒ–)ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ObjectInputStream input = <span style="color:#fff;font-weight:bold">new</span> ObjectInputStream(<span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;object.data&#34;</span>));
</span></span><span style="display:flex;"><span>MyClass object = (MyClass) input.<span style="color:#007f7f">readObject</span>();
</span></span><span style="display:flex;"><span>input.<span style="color:#007f7f">close</span>();
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦å¤–ï¼Œç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ç±»å¿…é¡»å®ç° <code>Serializable</code> æ¥å£ï¼Œå¯¹è±¡ä¸­å¦‚æœæœ‰å±æ€§ä¸æƒ³è¢«åºåˆ—åŒ–ï¼Œä½¿ç”¨ <code>transient</code> ä¿®é¥°ã€‚</p>
<h2 id="outputstreamå­—èŠ‚è¾“å‡ºæµ">OutputStreamï¼ˆå­—èŠ‚è¾“å‡ºæµï¼‰<a hidden class="anchor" aria-hidden="true" href="#outputstreamå­—èŠ‚è¾“å‡ºæµ">#</a></h2>
<p><code>OutputStream</code>ç”¨äºå°†æ•°æ®ï¼ˆå­—èŠ‚ä¿¡æ¯ï¼‰å†™å…¥åˆ°ç›®çš„åœ°ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰ï¼Œ<code>java.io.OutputStream</code>æŠ½è±¡ç±»æ˜¯æ‰€æœ‰å­—èŠ‚è¾“å‡ºæµçš„çˆ¶ç±»ã€‚</p>
<p><code>OutputStream</code> å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li><code>write(int b)</code>ï¼šå°†ç‰¹å®šå­—èŠ‚å†™å…¥è¾“å‡ºæµã€‚</li>
<li><code>write(byte b[ ])</code> : å°†æ•°ç»„<code>b</code> å†™å…¥åˆ°è¾“å‡ºæµï¼Œç­‰ä»·äº <code>write(b, 0, b.length)</code> ã€‚</li>
<li><code>write(byte[] b, int off, int len)</code> : åœ¨<code>write(byte b[ ])</code> æ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº† <code>off</code> å‚æ•°ï¼ˆåç§»é‡ï¼‰å’Œ <code>len</code> å‚æ•°ï¼ˆè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ï¼‰ã€‚</li>
<li><code>flush()</code>ï¼šåˆ·æ–°æ­¤è¾“å‡ºæµå¹¶å¼ºåˆ¶å†™å‡ºæ‰€æœ‰ç¼“å†²çš„è¾“å‡ºå­—èŠ‚ã€‚</li>
<li><code>close()</code>ï¼šå…³é—­è¾“å‡ºæµé‡Šæ”¾ç›¸å…³çš„ç³»ç»Ÿèµ„æºã€‚</li>
</ul>
<p><code>FileOutputStream</code> æ˜¯æœ€å¸¸ç”¨çš„å­—èŠ‚è¾“å‡ºæµå¯¹è±¡ï¼Œå¯ç›´æ¥æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥ç›´æ¥è¾“å‡ºå•å­—èŠ‚æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¾“å‡ºæŒ‡å®šçš„å­—èŠ‚æ•°ç»„ã€‚</p>
<p><code>FileOutputStream</code> ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> (FileOutputStream output = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;output.txt&#34;</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">byte</span>[] array = <span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>.<span style="color:#007f7f">getBytes</span>();
</span></span><span style="display:flex;"><span>    output.<span style="color:#007f7f">write</span>(array);
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç±»ä¼¼äº <code>FileInputStream</code>ï¼Œ<code>FileOutputStream</code> é€šå¸¸ä¹Ÿä¼šé…åˆ <code>BufferedOutputStream</code>ï¼ˆå­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼Œåæ–‡ä¼šè®²åˆ°ï¼‰æ¥ä½¿ç”¨ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>FileOutputStream fileOutputStream = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;output.txt&#34;</span>);
</span></span><span style="display:flex;"><span>BufferedOutputStream bos = <span style="color:#fff;font-weight:bold">new</span> BufferedOutputStream(fileOutputStream)
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><code>DataOutputStream</code></strong> ç”¨äºå†™å…¥æŒ‡å®šç±»å‹æ•°æ®ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»ç»“åˆå…¶å®ƒæµï¼Œæ¯”å¦‚ <code>FileOutputStream</code> ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// è¾“å‡ºæµ</span>
</span></span><span style="display:flex;"><span>FileOutputStream fileOutputStream = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;out.txt&#34;</span>);
</span></span><span style="display:flex;"><span>DataOutputStream dataOutputStream = <span style="color:#fff;font-weight:bold">new</span> DataOutputStream(fileOutputStream);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¾“å‡ºä»»æ„æ•°æ®ç±»å‹</span>
</span></span><span style="display:flex;"><span>dataOutputStream.<span style="color:#007f7f">writeBoolean</span>(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>dataOutputStream.<span style="color:#007f7f">writeByte</span>(1);
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ObjectInputStream</code> ç”¨äºä»è¾“å…¥æµä¸­è¯»å– Java å¯¹è±¡ï¼ˆ<code>ObjectInputStream</code>,ååºåˆ—åŒ–ï¼‰ï¼Œ<code>ObjectOutputStream</code>å°†å¯¹è±¡å†™å…¥åˆ°è¾“å‡ºæµ(<code>ObjectOutputStream</code>ï¼Œåºåˆ—åŒ–)ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ObjectOutputStream output = <span style="color:#fff;font-weight:bold">new</span> ObjectOutputStream(<span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;file.txt&#34;</span>)
</span></span><span style="display:flex;"><span>Person person = <span style="color:#fff;font-weight:bold">new</span> Person(<span style="color:#0ff;font-weight:bold">&#34;wjy&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;ç‹é–å°§&#34;</span>);
</span></span><span style="display:flex;"><span>output.<span style="color:#007f7f">writeObject</span>(person);
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="å­—ç¬¦æµ">å­—ç¬¦æµ<a hidden class="anchor" aria-hidden="true" href="#å­—ç¬¦æµ">#</a></h1>
<p>ä¸ç®¡æ˜¯æ–‡ä»¶è¯»å†™è¿˜æ˜¯ç½‘ç»œå‘é€æ¥æ”¶ï¼Œä¿¡æ¯çš„æœ€å°å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ã€‚ <strong>é‚£ä¸ºä»€ä¹ˆ I/O æµæ“ä½œè¦åˆ†ä¸ºå­—èŠ‚æµæ“ä½œå’Œå­—ç¬¦æµæ“ä½œå‘¢ï¼Ÿ</strong></p>
<p>ä¸ªäººè®¤ä¸ºä¸»è¦æœ‰ä¸¤ç‚¹åŸå› ï¼š</p>
<ul>
<li>å­—ç¬¦æµæ˜¯ç”± Java è™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹è¿˜ç®—æ˜¯æ¯”è¾ƒè€—æ—¶ã€‚</li>
<li>å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ç¼–ç ç±»å‹å°±å¾ˆå®¹æ˜“å‡ºç°ä¹±ç é—®é¢˜ã€‚</li>
</ul>
<p>ä¹±ç é—®é¢˜è¿™ä¸ªå¾ˆå®¹æ˜“å°±å¯ä»¥å¤ç°ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ä¸Šé¢æåˆ°çš„ <code>FileInputStream</code> ä»£ç ç¤ºä¾‹ä¸­çš„ <code>input.txt</code> æ–‡ä»¶å†…å®¹æ”¹ä¸ºä¸­æ–‡å³å¯ï¼ŒåŸä»£ç ä¸éœ€è¦æ”¹åŠ¨ã€‚</p>
<p>è¾“å‡ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Number of remaining bytes:9
</span></span><span style="display:flex;"><span>The actual number of bytes skipped:2
</span></span><span style="display:flex;"><span>The content read from file:Â§Ã¥Â®Â¶Ã¥Â¥Â½
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥å¾ˆæ˜æ˜¾åœ°çœ‹åˆ°è¯»å–å‡ºæ¥çš„å†…å®¹å·²ç»å˜æˆäº†ä¹±ç ã€‚</p>
<p>å› æ­¤ï¼ŒI/O æµå°±å¹²è„†æä¾›äº†ä¸€ä¸ªç›´æ¥æ“ä½œå­—ç¬¦çš„æ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¹³æ—¶å¯¹å­—ç¬¦è¿›è¡Œæµæ“ä½œã€‚å¦‚æœéŸ³é¢‘æ–‡ä»¶ã€å›¾ç‰‡ç­‰åª’ä½“æ–‡ä»¶ç”¨å­—èŠ‚æµæ¯”è¾ƒå¥½ï¼Œå¦‚æœæ¶‰åŠåˆ°å­—ç¬¦çš„è¯ä½¿ç”¨å­—ç¬¦æµæ¯”è¾ƒå¥½ã€‚</p>
<p>å­—ç¬¦æµé»˜è®¤é‡‡ç”¨çš„æ˜¯ <code>Unicode</code> ç¼–ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•è‡ªå®šä¹‰ç¼–ç ã€‚é¡ºä¾¿åˆ†äº«ä¸€ä¸‹ä¹‹å‰é‡åˆ°çš„ç¬”è¯•é¢˜ï¼šå¸¸ç”¨å­—ç¬¦ç¼–ç æ‰€å å­—èŠ‚æ•°ï¼Ÿ<code>utf8</code> :è‹±æ–‡å  1 å­—èŠ‚ï¼Œä¸­æ–‡å  3 å­—èŠ‚ï¼Œ<code>unicode</code>ï¼šä»»ä½•å­—ç¬¦éƒ½å  2 ä¸ªå­—èŠ‚ï¼Œ<code>gbk</code>ï¼šè‹±æ–‡å  1 å­—èŠ‚ï¼Œä¸­æ–‡å  2 å­—èŠ‚ã€‚</p>
<h2 id="readerå­—ç¬¦è¾“å…¥æµ">Readerï¼ˆå­—ç¬¦è¾“å…¥æµï¼‰<a hidden class="anchor" aria-hidden="true" href="#readerå­—ç¬¦è¾“å…¥æµ">#</a></h2>
<p><code>Reader</code>ç”¨äºä»æºå¤´ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰è¯»å–æ•°æ®ï¼ˆå­—ç¬¦ä¿¡æ¯ï¼‰åˆ°å†…å­˜ä¸­ï¼Œ<code>java.io.Reader</code>æŠ½è±¡ç±»æ˜¯æ‰€æœ‰å­—ç¬¦è¾“å…¥æµçš„çˆ¶ç±»ã€‚</p>
<p><code>Reader</code> ç”¨äºè¯»å–æ–‡æœ¬ï¼Œ <code>InputStream</code> ç”¨äºè¯»å–åŸå§‹å­—èŠ‚ã€‚</p>
<p><code>Reader</code> å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li><code>read()</code> : ä»è¾“å…¥æµè¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚</li>
<li><code>read(char[] cbuf)</code> : ä»è¾“å…¥æµä¸­è¯»å–ä¸€äº›å­—ç¬¦ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åˆ°å­—ç¬¦æ•°ç»„ <code>cbuf</code>ä¸­ï¼Œç­‰ä»·äº <code>read(cbuf, 0, cbuf.length)</code> ã€‚</li>
<li><code>read(char[] cbuf, int off, int len)</code>ï¼šåœ¨<code>read(char[] cbuf)</code> æ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº† <code>off</code> å‚æ•°ï¼ˆåç§»é‡ï¼‰å’Œ <code>len</code> å‚æ•°ï¼ˆè¦è¯»å–çš„æœ€å¤§å­—ç¬¦æ•°ï¼‰ã€‚</li>
<li><code>skip(long n)</code>ï¼šå¿½ç•¥è¾“å…¥æµä¸­çš„ n ä¸ªå­—ç¬¦ ,è¿”å›å®é™…å¿½ç•¥çš„å­—ç¬¦æ•°ã€‚</li>
<li><code>close()</code> : å…³é—­è¾“å…¥æµå¹¶é‡Šæ”¾ç›¸å…³çš„ç³»ç»Ÿèµ„æºã€‚</li>
</ul>
<p><code>InputStreamReader</code> æ˜¯å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµçš„æ¡¥æ¢ï¼Œå…¶å­ç±» <code>FileReader</code> æ˜¯åŸºäºè¯¥åŸºç¡€ä¸Šçš„å°è£…ï¼Œå¯ä»¥ç›´æ¥æ“ä½œå­—ç¬¦æ–‡ä»¶ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµçš„æ¡¥æ¢</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> InputStreamReader <span style="color:#fff;font-weight:bold">extends</span> Reader {
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç”¨äºè¯»å–å­—ç¬¦æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> FileReader <span style="color:#fff;font-weight:bold">extends</span> InputStreamReader {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>FileReader</code> ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> (FileReader fileReader = <span style="color:#fff;font-weight:bold">new</span> FileReader(<span style="color:#0ff;font-weight:bold">&#34;input.txt&#34;</span>);) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> content;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> skip = fileReader.<span style="color:#007f7f">skip</span>(3);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;The actual number of bytes skipped:&#34;</span> + skip);
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>(<span style="color:#0ff;font-weight:bold">&#34;The content read from file:&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> ((content = fileReader.<span style="color:#007f7f">read</span>()) != -1) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>((<span style="color:#fff;font-weight:bold">char</span>) content);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¾“å‡º</span>
</span></span><span style="display:flex;"><span>The actual number of bytes skipped:3
</span></span><span style="display:flex;"><span>The content read from file: WJY
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="writerå­—ç¬¦è¾“å‡ºæµ">Writerï¼ˆå­—ç¬¦è¾“å‡ºæµï¼‰<a hidden class="anchor" aria-hidden="true" href="#writerå­—ç¬¦è¾“å‡ºæµ">#</a></h2>
<p><code>Writer</code>ç”¨äºå°†æ•°æ®ï¼ˆå­—ç¬¦ä¿¡æ¯ï¼‰å†™å…¥åˆ°ç›®çš„åœ°ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰ï¼Œ<code>java.io.Writer</code>æŠ½è±¡ç±»æ˜¯æ‰€æœ‰å­—ç¬¦è¾“å‡ºæµçš„çˆ¶ç±»ã€‚</p>
<p><code>Writer</code> å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li><code>write(int c)</code> : å†™å…¥å•ä¸ªå­—ç¬¦ã€‚</li>
<li><code>write(char[] cbuf)</code>ï¼šå†™å…¥å­—ç¬¦æ•°ç»„ <code>cbuf</code>ï¼Œç­‰ä»·äº<code>write(cbuf, 0, cbuf.length)</code>ã€‚</li>
<li><code>write(char[] cbuf, int off, int len)</code>ï¼šåœ¨<code>write(char[] cbuf)</code> æ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº† <code>off</code> å‚æ•°ï¼ˆåç§»é‡ï¼‰å’Œ <code>len</code> å‚æ•°ï¼ˆè¦è¯»å–çš„æœ€å¤§å­—ç¬¦æ•°ï¼‰ã€‚</li>
<li><code>write(String str)</code>ï¼šå†™å…¥å­—ç¬¦ä¸²ï¼Œç­‰ä»·äº <code>write(str, 0, str.length())</code> ã€‚</li>
<li><code>write(String str, int off, int len)</code>ï¼šåœ¨<code>write(String str)</code> æ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº† <code>off</code> å‚æ•°ï¼ˆåç§»é‡ï¼‰å’Œ <code>len</code> å‚æ•°ï¼ˆè¦è¯»å–çš„æœ€å¤§å­—ç¬¦æ•°ï¼‰ã€‚</li>
<li><code>append(CharSequence csq)</code>ï¼šå°†æŒ‡å®šçš„å­—ç¬¦åºåˆ—é™„åŠ åˆ°æŒ‡å®šçš„ <code>Writer</code> å¯¹è±¡å¹¶è¿”å›è¯¥ <code>Writer</code> å¯¹è±¡ã€‚</li>
<li><code>append(char c)</code>ï¼šå°†æŒ‡å®šçš„å­—ç¬¦é™„åŠ åˆ°æŒ‡å®šçš„ <code>Writer</code> å¯¹è±¡å¹¶è¿”å›è¯¥ <code>Writer</code> å¯¹è±¡ã€‚</li>
<li><code>flush()</code>ï¼šåˆ·æ–°æ­¤è¾“å‡ºæµå¹¶å¼ºåˆ¶å†™å‡ºæ‰€æœ‰ç¼“å†²çš„è¾“å‡ºå­—ç¬¦ã€‚</li>
<li><code>close()</code>:å…³é—­è¾“å‡ºæµé‡Šæ”¾ç›¸å…³çš„ç³»ç»Ÿèµ„æºã€‚</li>
</ul>
<p><code>OutputStreamWriter</code> æ˜¯å­—ç¬¦æµè½¬æ¢ä¸ºå­—èŠ‚æµçš„æ¡¥æ¢ï¼Œå…¶å­ç±» <code>FileWriter</code> æ˜¯åŸºäºè¯¥åŸºç¡€ä¸Šçš„å°è£…ï¼Œå¯ä»¥ç›´æ¥å°†å­—ç¬¦å†™å…¥åˆ°æ–‡ä»¶ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// å­—ç¬¦æµè½¬æ¢ä¸ºå­—èŠ‚æµçš„æ¡¥æ¢</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> OutputStreamWriter <span style="color:#fff;font-weight:bold">extends</span> Writer {
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç”¨äºå†™å…¥å­—ç¬¦åˆ°æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> FileWriter <span style="color:#fff;font-weight:bold">extends</span> OutputStreamWriter {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>FileWriter</code> ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> (Writer output = <span style="color:#fff;font-weight:bold">new</span> FileWriter(<span style="color:#0ff;font-weight:bold">&#34;output.txt&#34;</span>)) {
</span></span><span style="display:flex;"><span>    output.<span style="color:#007f7f">write</span>(<span style="color:#0ff;font-weight:bold">&#34;WJY&#34;</span>);
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="å­—èŠ‚ç¼“å†²æµ">å­—èŠ‚ç¼“å†²æµ<a hidden class="anchor" aria-hidden="true" href="#å­—èŠ‚ç¼“å†²æµ">#</a></h1>
<p>IO æ“ä½œæ˜¯å¾ˆæ¶ˆè€—æ€§èƒ½çš„ï¼Œç¼“å†²æµå°†æ•°æ®åŠ è½½è‡³ç¼“å†²åŒºï¼Œä¸€æ¬¡æ€§è¯»å–/å†™å…¥å¤šä¸ªå­—èŠ‚ï¼Œä»è€Œé¿å…é¢‘ç¹çš„ IO æ“ä½œï¼Œæé«˜æµçš„ä¼ è¾“æ•ˆç‡ã€‚</p>
<p>å­—èŠ‚ç¼“å†²æµè¿™é‡Œé‡‡ç”¨äº†è£…é¥°å™¨æ¨¡å¼æ¥å¢å¼º <code>InputStream</code> å’Œ<code>OutputStream</code>å­ç±»å¯¹è±¡çš„åŠŸèƒ½ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>BufferedInputStream</code>ï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰æ¥å¢å¼º <code>FileInputStream</code> çš„åŠŸèƒ½ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// æ–°å»ºä¸€ä¸ª BufferedInputStream å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>BufferedInputStream bufferedInputStream = <span style="color:#fff;font-weight:bold">new</span> BufferedInputStream(<span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;input.txt&#34;</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><p>å­—èŠ‚æµå’Œå­—èŠ‚ç¼“å†²æµçš„æ€§èƒ½å·®åˆ«ä¸»è¦ä½“ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ä¸¤è€…çš„æ—¶å€™éƒ½æ˜¯è°ƒç”¨ <code>write(int b)</code> å’Œ <code>read()</code> è¿™ä¸¤ä¸ªä¸€æ¬¡åªè¯»å–ä¸€ä¸ªå­—èŠ‚çš„æ–¹æ³•çš„æ—¶å€™ã€‚ç”±äºå­—èŠ‚ç¼“å†²æµå†…éƒ¨æœ‰ç¼“å†²åŒºï¼ˆå­—èŠ‚æ•°ç»„ï¼‰ï¼Œå› æ­¤ï¼Œå­—èŠ‚ç¼“å†²æµä¼šå…ˆå°†è¯»å–åˆ°çš„å­—èŠ‚å­˜æ”¾åœ¨ç¼“å­˜åŒºï¼Œå¤§å¹…å‡å°‘ IO æ¬¡æ•°ï¼Œæé«˜è¯»å–æ•ˆç‡ã€‚</p>
<p>æˆ‘ä½¿ç”¨ <code>write(int b)</code> å’Œ <code>read()</code> æ–¹æ³•ï¼Œåˆ†åˆ«é€šè¿‡å­—èŠ‚æµå’Œå­—èŠ‚ç¼“å†²æµå¤åˆ¶ä¸€ä¸ª <code>524.9 mb</code> çš„ PDF æ–‡ä»¶è€—æ—¶å¯¹æ¯”å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>ä½¿ç”¨ç¼“å†²æµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:15428 æ¯«ç§’
</span></span><span style="display:flex;"><span>ä½¿ç”¨æ™®é€šå­—èŠ‚æµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:2555062 æ¯«ç§’
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸¤è€…è€—æ—¶å·®åˆ«éå¸¸å¤§ï¼Œç¼“å†²æµè€—è´¹çš„æ—¶é—´æ˜¯å­—èŠ‚æµçš„ 1/165ã€‚</p>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> copy_pdf_to_another_pdf_buffer_stream() {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®°å½•å¼€å§‹æ—¶é—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> start = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> (BufferedInputStream bis = <span style="color:#fff;font-weight:bold">new</span> BufferedInputStream(<span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ.pdf&#34;</span>));
</span></span><span style="display:flex;"><span>         BufferedOutputStream bos = <span style="color:#fff;font-weight:bold">new</span> BufferedOutputStream(<span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ-å‰¯æœ¬.pdf&#34;</span>))) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> content;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> ((content = bis.<span style="color:#007f7f">read</span>()) != -1) {
</span></span><span style="display:flex;"><span>            bos.<span style="color:#007f7f">write</span>(content);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®°å½•ç»“æŸæ—¶é—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> end = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ä½¿ç”¨ç¼“å†²æµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:&#34;</span> + (end - start) + <span style="color:#0ff;font-weight:bold">&#34; æ¯«ç§’&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> copy_pdf_to_another_pdf_stream() {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®°å½•å¼€å§‹æ—¶é—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> start = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> (FileInputStream fis = <span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ.pdf&#34;</span>);
</span></span><span style="display:flex;"><span>         FileOutputStream fos = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ-å‰¯æœ¬.pdf&#34;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> content;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> ((content = fis.<span style="color:#007f7f">read</span>()) != -1) {
</span></span><span style="display:flex;"><span>            fos.<span style="color:#007f7f">write</span>(content);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®°å½•ç»“æŸæ—¶é—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> end = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ä½¿ç”¨æ™®é€šæµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:&#34;</span> + (end - start) + <span style="color:#0ff;font-weight:bold">&#34; æ¯«ç§’&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ˜¯è°ƒç”¨ <code>read(byte b[])</code> å’Œ <code>write(byte b[], int off, int len)</code> è¿™ä¸¤ä¸ªå†™å…¥ä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„æ–¹æ³•çš„è¯ï¼Œåªè¦å­—èŠ‚æ•°ç»„çš„å¤§å°åˆé€‚ï¼Œä¸¤è€…çš„æ€§èƒ½å·®è·å…¶å®ä¸å¤§ï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥ã€‚</p>
<p>è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ <code>read(byte b[])</code> å’Œ <code>write(byte b[], int off, int len)</code> æ–¹æ³•ï¼Œåˆ†åˆ«é€šè¿‡å­—èŠ‚æµå’Œå­—èŠ‚ç¼“å†²æµå¤åˆ¶ä¸€ä¸ª 524.9 mb çš„ PDF æ–‡ä»¶è€—æ—¶å¯¹æ¯”å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>ä½¿ç”¨ç¼“å†²æµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:695 æ¯«ç§’
</span></span><span style="display:flex;"><span>ä½¿ç”¨æ™®é€šå­—èŠ‚æµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:989 æ¯«ç§’
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸¤è€…è€—æ—¶å·®åˆ«ä¸æ˜¯å¾ˆå¤§ï¼Œç¼“å†²æµçš„æ€§èƒ½è¦ç•¥å¾®å¥½ä¸€ç‚¹ç‚¹ã€‚</p>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> copy_pdf_to_another_pdf_with_byte_array_buffer_stream() {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®°å½•å¼€å§‹æ—¶é—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> start = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> (BufferedInputStream bis = <span style="color:#fff;font-weight:bold">new</span> BufferedInputStream(<span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ.pdf&#34;</span>));
</span></span><span style="display:flex;"><span>         BufferedOutputStream bos = <span style="color:#fff;font-weight:bold">new</span> BufferedOutputStream(<span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ-å‰¯æœ¬.pdf&#34;</span>))) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> len;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">byte</span>[] bytes = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[4 * 1024];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> ((len = bis.<span style="color:#007f7f">read</span>(bytes)) != -1) {
</span></span><span style="display:flex;"><span>            bos.<span style="color:#007f7f">write</span>(bytes, 0, len);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®°å½•ç»“æŸæ—¶é—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> end = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ä½¿ç”¨ç¼“å†²æµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:&#34;</span> + (end - start) + <span style="color:#0ff;font-weight:bold">&#34; æ¯«ç§’&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">void</span> copy_pdf_to_another_pdf_with_byte_array_stream() {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®°å½•å¼€å§‹æ—¶é—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> start = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> (FileInputStream fis = <span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ.pdf&#34;</span>);
</span></span><span style="display:flex;"><span>         FileOutputStream fos = <span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ-å‰¯æœ¬.pdf&#34;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> len;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">byte</span>[] bytes = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[4 * 1024];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> ((len = fis.<span style="color:#007f7f">read</span>(bytes)) != -1) {
</span></span><span style="display:flex;"><span>            fos.<span style="color:#007f7f">write</span>(bytes, 0, len);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®°å½•ç»“æŸæ—¶é—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> end = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ä½¿ç”¨æ™®é€šæµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:&#34;</span> + (end - start) + <span style="color:#0ff;font-weight:bold">&#34; æ¯«ç§’&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="bufferedinputstreamå­—èŠ‚ç¼“å†²è¾“å…¥æµ">BufferedInputStreamï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰<a hidden class="anchor" aria-hidden="true" href="#bufferedinputstreamå­—èŠ‚ç¼“å†²è¾“å…¥æµ">#</a></h2>
<p><code>BufferedInputStream</code> ä»æºå¤´ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰è¯»å–æ•°æ®ï¼ˆå­—èŠ‚ä¿¡æ¯ï¼‰åˆ°å†…å­˜çš„è¿‡ç¨‹ä¸­ä¸ä¼šä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„è¯»å–ï¼Œè€Œæ˜¯ä¼šå…ˆå°†è¯»å–åˆ°çš„å­—èŠ‚å­˜æ”¾åœ¨ç¼“å­˜åŒºï¼Œå¹¶ä»å†…éƒ¨ç¼“å†²åŒºä¸­å•ç‹¬è¯»å–å­—èŠ‚ã€‚è¿™æ ·å¤§å¹…å‡å°‘äº† IO æ¬¡æ•°ï¼Œæé«˜äº†è¯»å–æ•ˆç‡ã€‚</p>
<p><code>BufferedInputStream</code> å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºå®é™…å°±æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œé€šè¿‡é˜…è¯» <code>BufferedInputStream</code> æºç å³å¯å¾—åˆ°è¿™ä¸ªç»“è®ºã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> BufferedInputStream <span style="color:#fff;font-weight:bold">extends</span> FilterInputStream {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å†…éƒ¨ç¼“å†²åŒºæ•°ç»„</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">volatile</span> <span style="color:#fff;font-weight:bold">byte</span> buf[];
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ç¼“å†²åŒºçš„é»˜è®¤å¤§å°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">int</span> DEFAULT_BUFFER_SIZE = 8192;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä½¿ç”¨é»˜è®¤çš„ç¼“å†²åŒºå¤§å°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> BufferedInputStream(InputStream in) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>(in, DEFAULT_BUFFER_SIZE);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è‡ªå®šä¹‰ç¼“å†²åŒºå¤§å°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> BufferedInputStream(InputStream in, <span style="color:#fff;font-weight:bold">int</span> size) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(in);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (size &lt;= 0) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalArgumentException(<span style="color:#0ff;font-weight:bold">&#34;Buffer size &lt;= 0&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        buf = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[size];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼“å†²åŒºçš„å¤§å°é»˜è®¤ä¸º <strong>8192</strong> å­—èŠ‚ï¼Œå½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ <code>BufferedInputStream(InputStream in, int size)</code> è¿™ä¸ªæ„é€ æ–¹æ³•æ¥æŒ‡å®šç¼“å†²åŒºçš„å¤§å°ã€‚</p>
<h2 id="bufferedoutputstreamå­—èŠ‚ç¼“å†²è¾“å‡ºæµ">BufferedOutputStreamï¼ˆå­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼‰<a hidden class="anchor" aria-hidden="true" href="#bufferedoutputstreamå­—èŠ‚ç¼“å†²è¾“å‡ºæµ">#</a></h2>
<p><code>BufferedOutputStream</code> å°†æ•°æ®ï¼ˆå­—èŠ‚ä¿¡æ¯ï¼‰å†™å…¥åˆ°ç›®çš„åœ°ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰çš„è¿‡ç¨‹ä¸­ä¸ä¼šä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„å†™å…¥ï¼Œè€Œæ˜¯ä¼šå…ˆå°†è¦å†™å…¥çš„å­—èŠ‚å­˜æ”¾åœ¨ç¼“å­˜åŒºï¼Œå¹¶ä»å†…éƒ¨ç¼“å†²åŒºä¸­å•ç‹¬å†™å…¥å­—èŠ‚ã€‚è¿™æ ·å¤§å¹…å‡å°‘äº† IO æ¬¡æ•°ï¼Œæé«˜äº†è¯»å–æ•ˆç‡</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> (BufferedOutputStream bos = <span style="color:#fff;font-weight:bold">new</span> BufferedOutputStream(<span style="color:#fff;font-weight:bold">new</span> FileOutputStream(<span style="color:#0ff;font-weight:bold">&#34;output.txt&#34;</span>))) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">byte</span>[] array = <span style="color:#0ff;font-weight:bold">&#34;JavaGuide&#34;</span>.<span style="color:#007f7f">getBytes</span>();
</span></span><span style="display:flex;"><span>    bos.<span style="color:#007f7f">write</span>(array);
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç±»ä¼¼äº <code>BufferedInputStream</code> ï¼Œ<code>BufferedOutputStream</code> å†…éƒ¨ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œå¹¶ä¸”ï¼Œè¿™ä¸ªç¼“å­˜åŒºçš„å¤§å°ä¹Ÿæ˜¯ <strong>8192</strong> å­—èŠ‚ã€‚</p>
<h1 id="å­—ç¬¦ç¼“å†²æµ">å­—ç¬¦ç¼“å†²æµ<a hidden class="anchor" aria-hidden="true" href="#å­—ç¬¦ç¼“å†²æµ">#</a></h1>
<p><code>BufferedReader</code> ï¼ˆå­—ç¬¦ç¼“å†²è¾“å…¥æµï¼‰å’Œ <code>BufferedWriter</code>ï¼ˆå­—ç¬¦ç¼“å†²è¾“å‡ºæµï¼‰ç±»ä¼¼äº <code>BufferedInputStream</code>ï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰å’Œ<code>BufferedOutputStream</code>ï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰ï¼Œå†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå­—èŠ‚æ•°ç»„ä½œä¸ºç¼“å†²åŒºã€‚ä¸è¿‡ï¼Œå‰è€…ä¸»è¦æ˜¯ç”¨æ¥æ“ä½œå­—ç¬¦ä¿¡æ¯ã€‚</p>
<h1 id="æ‰“å°æµ">æ‰“å°æµ<a hidden class="anchor" aria-hidden="true" href="#æ‰“å°æµ">#</a></h1>
<p>ä¸‹é¢è¿™æ®µä»£ç å¤§å®¶ç»å¸¸ä½¿ç”¨å§ï¼Ÿ</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>(<span style="color:#0ff;font-weight:bold">&#34;Helloï¼&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Helloï¼&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>System.out</code> å®é™…æ˜¯ç”¨äºè·å–ä¸€ä¸ª <code>PrintStream</code> å¯¹è±¡ï¼Œ<code>print</code>æ–¹æ³•å®é™…è°ƒç”¨çš„æ˜¯ <code>PrintStream</code> å¯¹è±¡çš„ <code>write</code> æ–¹æ³•ã€‚</p>
<p><code>PrintStream</code> å±äºå­—èŠ‚æ‰“å°æµï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯ <code>PrintWriter</code> ï¼ˆå­—ç¬¦æ‰“å°æµï¼‰ã€‚<code>PrintStream</code> æ˜¯ <code>OutputStream</code> çš„å­ç±»ï¼Œ<code>PrintWriter</code> æ˜¯ <code>Writer</code> çš„å­ç±»ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> PrintStream <span style="color:#fff;font-weight:bold">extends</span> FilterOutputStream
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">implements</span> Appendable, Closeable {
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> PrintWriter <span style="color:#fff;font-weight:bold">extends</span> Writer {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="éšæœºè®¿é—®æµ">éšæœºè®¿é—®æµ<a hidden class="anchor" aria-hidden="true" href="#éšæœºè®¿é—®æµ">#</a></h1>
<p>è¿™é‡Œè¦ä»‹ç»çš„éšæœºè®¿é—®æµæŒ‡çš„æ˜¯æ”¯æŒéšæ„è·³è½¬åˆ°æ–‡ä»¶çš„ä»»æ„ä½ç½®è¿›è¡Œè¯»å†™çš„ <code>RandomAccessFile</code> ã€‚</p>
<p><code>RandomAccessFile</code> çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š <code>mode</code>ï¼ˆè¯»å†™æ¨¡å¼ï¼‰ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// openAndDelete å‚æ•°é»˜è®¤ä¸º false è¡¨ç¤ºæ‰“å¼€æ–‡ä»¶å¹¶ä¸”è¿™ä¸ªæ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> RandomAccessFile(File file, String mode)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">throws</span> FileNotFoundException {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>(file, mode, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç§æœ‰æ–¹æ³•</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> RandomAccessFile(File file, String mode, <span style="color:#fff;font-weight:bold">boolean</span> openAndDelete)  <span style="color:#fff;font-weight:bold">throws</span> FileNotFoundException{
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">// çœç•¥å¤§éƒ¨åˆ†ä»£ç </span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯»å†™æ¨¡å¼ä¸»è¦æœ‰ä¸‹é¢å››ç§ï¼š</p>
<ul>
<li><code>r</code> : åªè¯»æ¨¡å¼ã€‚</li>
<li><code>rw</code>: è¯»å†™æ¨¡å¼</li>
<li><code>rws</code>: ç›¸å¯¹äº <code>rw</code>ï¼Œ<code>rws</code> åŒæ­¥æ›´æ–°å¯¹â€œæ–‡ä»¶çš„å†…å®¹â€æˆ–â€œå…ƒæ•°æ®â€çš„ä¿®æ”¹åˆ°å¤–éƒ¨å­˜å‚¨è®¾å¤‡ã€‚</li>
<li><code>rwd</code> : ç›¸å¯¹äº <code>rw</code>ï¼Œ<code>rwd</code> åŒæ­¥æ›´æ–°å¯¹â€œæ–‡ä»¶çš„å†…å®¹â€çš„ä¿®æ”¹åˆ°å¤–éƒ¨å­˜å‚¨è®¾å¤‡ã€‚</li>
</ul>
<p>æ–‡ä»¶å†…å®¹æŒ‡çš„æ˜¯æ–‡ä»¶ä¸­å®é™…ä¿å­˜çš„æ•°æ®ï¼Œå…ƒæ•°æ®åˆ™æ˜¯ç”¨æ¥æè¿°æ–‡ä»¶å±æ€§æ¯”å¦‚æ–‡ä»¶çš„å¤§å°ä¿¡æ¯ã€åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´ã€‚</p>
<p><code>RandomAccessFile</code> ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆç”¨æ¥è¡¨ç¤ºä¸‹ä¸€ä¸ªå°†è¦è¢«å†™å…¥æˆ–è€…è¯»å–çš„å­—èŠ‚æ‰€å¤„çš„ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>RandomAccessFile</code> çš„ <code>seek(long pos)</code> æ–¹æ³•æ¥è®¾ç½®æ–‡ä»¶æŒ‡é’ˆçš„åç§»é‡ï¼ˆè·æ–‡ä»¶å¼€å¤´ <code>pos</code> ä¸ªå­—èŠ‚å¤„ï¼‰ã€‚å¦‚æœæƒ³è¦è·å–æ–‡ä»¶æŒ‡é’ˆå½“å‰çš„ä½ç½®çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>getFilePointer()</code> æ–¹æ³•ã€‚</p>
<p><code>RandomAccessFile</code> ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>RandomAccessFile randomAccessFile = <span style="color:#fff;font-weight:bold">new</span> RandomAccessFile(<span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;input.txt&#34;</span>), <span style="color:#0ff;font-weight:bold">&#34;rw&#34;</span>);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š&#34;</span> + randomAccessFile.<span style="color:#007f7f">getFilePointer</span>() + <span style="color:#0ff;font-weight:bold">&#34;,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦&#34;</span> + (<span style="color:#fff;font-weight:bold">char</span>) randomAccessFile.<span style="color:#007f7f">read</span>() + <span style="color:#0ff;font-weight:bold">&#34;ï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š&#34;</span> + randomAccessFile.<span style="color:#007f7f">getFilePointer</span>());
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æŒ‡é’ˆå½“å‰åç§»é‡ä¸º 6</span>
</span></span><span style="display:flex;"><span>randomAccessFile.<span style="color:#007f7f">seek</span>(6);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š&#34;</span> + randomAccessFile.<span style="color:#007f7f">getFilePointer</span>() + <span style="color:#0ff;font-weight:bold">&#34;,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦&#34;</span> + (<span style="color:#fff;font-weight:bold">char</span>) randomAccessFile.<span style="color:#007f7f">read</span>() + <span style="color:#0ff;font-weight:bold">&#34;ï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š&#34;</span> + randomAccessFile.<span style="color:#007f7f">getFilePointer</span>());
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä»åç§»é‡ 7 çš„ä½ç½®å¼€å§‹å¾€åå†™å…¥å­—èŠ‚æ•°æ®</span>
</span></span><span style="display:flex;"><span>randomAccessFile.<span style="color:#007f7f">write</span>(<span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[]{<span style="color:#0ff;font-weight:bold">&#39;H&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;I&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;J&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;K&#39;</span>});
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æŒ‡é’ˆå½“å‰åç§»é‡ä¸º 0ï¼Œå›åˆ°èµ·å§‹ä½ç½®</span>
</span></span><span style="display:flex;"><span>randomAccessFile.<span style="color:#007f7f">seek</span>(0);
</span></span><span style="display:flex;"><span>System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š&#34;</span> + randomAccessFile.<span style="color:#007f7f">getFilePointer</span>() + <span style="color:#0ff;font-weight:bold">&#34;,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦&#34;</span> + (<span style="color:#fff;font-weight:bold">char</span>) randomAccessFile.<span style="color:#007f7f">read</span>() + <span style="color:#0ff;font-weight:bold">&#34;ï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š&#34;</span> + randomAccessFile.<span style="color:#007f7f">getFilePointer</span>());
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>input.txt</code> æ–‡ä»¶å†…å®¹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ABCDEFG
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š0,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦Aï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š1
</span></span><span style="display:flex;"><span>è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š6,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦Gï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š7
</span></span><span style="display:flex;"><span>è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š0,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦Aï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š1
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>input.txt</code> æ–‡ä»¶å†…å®¹å˜ä¸º <code>ABCDEFGHIJK</code> ã€‚</p>
<p><code>RandomAccessFile</code> çš„ <code>write</code> æ–¹æ³•åœ¨å†™å…¥å¯¹è±¡çš„æ—¶å€™å¦‚æœå¯¹åº”çš„ä½ç½®å·²ç»æœ‰æ•°æ®çš„è¯ï¼Œä¼šå°†å…¶è¦†ç›–æ‰ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>RandomAccessFile randomAccessFile = <span style="color:#fff;font-weight:bold">new</span> RandomAccessFile(<span style="color:#fff;font-weight:bold">new</span> File(<span style="color:#0ff;font-weight:bold">&#34;input.txt&#34;</span>), <span style="color:#0ff;font-weight:bold">&#34;rw&#34;</span>);
</span></span><span style="display:flex;"><span>randomAccessFile.<span style="color:#007f7f">write</span>(<span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[]{<span style="color:#0ff;font-weight:bold">&#39;H&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;I&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;J&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;K&#39;</span>});
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‡è®¾è¿è¡Œä¸Šé¢è¿™æ®µç¨‹åºä¹‹å‰ <code>input.txt</code> æ–‡ä»¶å†…å®¹å˜ä¸º <code>ABCD</code> ï¼Œè¿è¡Œä¹‹ååˆ™å˜ä¸º <code>HIJK</code> ã€‚</p>
<p><code>RandomAccessFile</code> æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªåº”ç”¨å°±æ˜¯å®ç°å¤§æ–‡ä»¶çš„ <strong>æ–­ç‚¹ç»­ä¼ </strong> ã€‚ä½•è°“æ–­ç‚¹ç»­ä¼ ï¼Ÿç®€å•æ¥è¯´å°±æ˜¯ä¸Šä¼ æ–‡ä»¶ä¸­é€”æš‚åœæˆ–å¤±è´¥ï¼ˆæ¯”å¦‚é‡åˆ°ç½‘ç»œé—®é¢˜ï¼‰ä¹‹åï¼Œä¸éœ€è¦é‡æ–°ä¸Šä¼ ï¼Œåªéœ€è¦ä¸Šä¼ é‚£äº›æœªæˆåŠŸä¸Šä¼ çš„æ–‡ä»¶åˆ†ç‰‡å³å¯ã€‚åˆ†ç‰‡ï¼ˆå…ˆå°†æ–‡ä»¶åˆ‡åˆ†æˆå¤šä¸ªæ–‡ä»¶åˆ†ç‰‡ï¼‰ä¸Šä¼ æ˜¯æ–­ç‚¹ç»­ä¼ çš„åŸºç¡€ã€‚</p>
<p><code>RandomAccessFile</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆå¹¶æ–‡ä»¶åˆ†ç‰‡ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> merge(String fileName) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">byte</span>[] buffer <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[1024 10];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> len = -1;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> (RandomAccessFile oSavedFile <span style="color:#fff;font-weight:bold">new</span> RandomAccessFile(fileName,<span style="color:#0ff;font-weight:bold">&#34;rw&#34;</span>)){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; DOWNLOAD_THREAD_NUM; ++) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> (BufferedInputstream bis <span style="color:#fff;font-weight:bold">new</span> BufferedInputstream(
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> FileInputstream(fileName FILE_TEMP_SUFFIX+i))){
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">while</span> ((Len = bis.<span style="color:#007f7f">read</span>(buffer)) != -1) {<span style="color:#007f7f">//è¯»åˆ°æ–‡ä»¶æœ«å°¾åˆ™è¿”å›-l</span>
</span></span><span style="display:flex;"><span>                    oSavedFile.<span style="color:#007f7f">write</span>(buffer, 0, len);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        LogUtils.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;æ–‡ä»¶åˆå¹¶å®Œæ¯•{}&#34;</span>, fileName);
</span></span><span style="display:flex;"><span>    }<span style="color:#fff;font-weight:bold">catch</span>(Exception e){
</span></span><span style="display:flex;"><span>        e.<span style="color:#007f7f">printstackTrace</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="ioä¸­çš„è®¾è®¡æ¨¡å¼">IOä¸­çš„è®¾è®¡æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#ioä¸­çš„è®¾è®¡æ¨¡å¼">#</a></h1>
<h2 id="è£…é¥°å™¨æ¨¡å¼">è£…é¥°å™¨æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#è£…é¥°å™¨æ¨¡å¼">#</a></h2>
<p><strong>è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ¨¡å¼</strong> å¯ä»¥åœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹æ‹“å±•å…¶åŠŸèƒ½ã€‚</p>
<p>è£…é¥°å™¨æ¨¡å¼é€šè¿‡ç»„åˆæ›¿ä»£ç»§æ‰¿æ¥æ‰©å±•åŸå§‹ç±»çš„åŠŸèƒ½ï¼Œåœ¨ä¸€äº›ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚çš„åœºæ™¯ï¼ˆIO è¿™ä¸€åœºæ™¯å„ç§ç±»çš„ç»§æ‰¿å…³ç³»å°±æ¯”è¾ƒå¤æ‚ï¼‰æ›´åŠ å®ç”¨ã€‚</p>
<p>å¯¹äºå­—èŠ‚æµæ¥è¯´ï¼Œ <code>FilterInputStream</code> ï¼ˆå¯¹åº”è¾“å…¥æµï¼‰å’Œ<code>FilterOutputStream</code>ï¼ˆå¯¹åº”è¾“å‡ºæµï¼‰æ˜¯è£…é¥°å™¨æ¨¡å¼çš„æ ¸å¿ƒï¼Œåˆ†åˆ«ç”¨äºå¢å¼º <code>InputStream</code> å’Œ<code>OutputStream</code>å­ç±»å¯¹è±¡çš„åŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬å¸¸è§çš„<code>BufferedInputStream</code>(å­—èŠ‚ç¼“å†²è¾“å…¥æµ)ã€<code>DataInputStream</code> ç­‰ç­‰éƒ½æ˜¯<code>FilterInputStream</code> çš„å­ç±»ï¼Œ<code>BufferedOutputStream</code>ï¼ˆå­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼‰ã€<code>DataOutputStream</code>ç­‰ç­‰éƒ½æ˜¯<code>FilterOutputStream</code>çš„å­ç±»ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>BufferedInputStream</code>ï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰æ¥å¢å¼º <code>FileInputStream</code> çš„åŠŸèƒ½ã€‚</p>
<p><code>BufferedInputStream</code> æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> BufferedInputStream(InputStream in) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>(in, DEFAULT_BUFFER_SIZE);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> BufferedInputStream(InputStream in, <span style="color:#fff;font-weight:bold">int</span> size) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">super</span>(in);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (size &lt;= 0) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalArgumentException(<span style="color:#0ff;font-weight:bold">&#34;Buffer size &lt;= 0&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    buf = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[size];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹å‡ºï¼Œ<code>BufferedInputStream</code> çš„æ„é€ å‡½æ•°å…¶ä¸­çš„ä¸€ä¸ªå‚æ•°å°±æ˜¯ <code>InputStream</code> ã€‚</p>
<p><code>BufferedInputStream</code> ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> (BufferedInputStream bis = <span style="color:#fff;font-weight:bold">new</span> BufferedInputStream(<span style="color:#fff;font-weight:bold">new</span> FileInputStream(<span style="color:#0ff;font-weight:bold">&#34;input.txt&#34;</span>))) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> content;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> skip = bis.<span style="color:#007f7f">skip</span>(2);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> ((content = bis.<span style="color:#007f7f">read</span>()) != -1) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>((<span style="color:#fff;font-weight:bold">char</span>) content);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªæ—¶å€™ï¼Œä½ å¯ä»¥ä¼šæƒ³äº†ï¼š<strong>ä¸ºå•¥æˆ‘ä»¬ç›´æ¥ä¸å¼„ä¸€ä¸ª<code>BufferedFileInputStream</code>ï¼ˆå­—ç¬¦ç¼“å†²æ–‡ä»¶è¾“å…¥æµï¼‰å‘¢ï¼Ÿ</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>BufferedFileInputStream bfis = <span style="color:#fff;font-weight:bold">new</span> BufferedFileInputStream(<span style="color:#0ff;font-weight:bold">&#34;input.txt&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœ <code>InputStream</code>çš„å­ç±»æ¯”è¾ƒå°‘çš„è¯ï¼Œè¿™æ ·åšæ˜¯æ²¡é—®é¢˜çš„ã€‚ä¸è¿‡ï¼Œ <code>InputStream</code>çš„å­ç±»å®åœ¨å¤ªå¤šï¼Œç»§æ‰¿å…³ç³»ä¹Ÿå¤ªå¤æ‚äº†ã€‚å¦‚æœæˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªå­ç±»éƒ½å®šåˆ¶ä¸€ä¸ªå¯¹åº”çš„ç¼“å†²è¾“å…¥æµï¼Œé‚£å²‚ä¸æ˜¯å¤ªéº»çƒ¦äº†ã€‚</p>
<p>å¦‚æœä½ å¯¹ IO æµæ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼Œä½ ä¼šå‘ç°<code>ZipInputStream</code> å’Œ<code>ZipOutputStream</code> è¿˜å¯ä»¥åˆ†åˆ«å¢å¼º <code>BufferedInputStream</code> å’Œ <code>BufferedOutputStream</code> çš„èƒ½åŠ›ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>BufferedInputStream bis = <span style="color:#fff;font-weight:bold">new</span> BufferedInputStream(<span style="color:#fff;font-weight:bold">new</span> FileInputStream(fileName));
</span></span><span style="display:flex;"><span>ZipInputStream zis = <span style="color:#fff;font-weight:bold">new</span> ZipInputStream(bis);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>BufferedOutputStream bos = <span style="color:#fff;font-weight:bold">new</span> BufferedOutputStream(<span style="color:#fff;font-weight:bold">new</span> FileOutputStream(fileName));
</span></span><span style="display:flex;"><span>ZipOutputStream zipOut = <span style="color:#fff;font-weight:bold">new</span> ZipOutputStream(bos);
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ZipInputStream</code> å’Œ<code>ZipOutputStream</code> åˆ†åˆ«ç»§æ‰¿è‡ª<code>InflaterInputStream</code> å’Œ<code>DeflaterOutputStream</code>ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> InflaterInputStream <span style="color:#fff;font-weight:bold">extends</span> FilterInputStream {
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> DeflaterOutputStream <span style="color:#fff;font-weight:bold">extends</span> FilterOutputStream {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¹Ÿæ˜¯è£…é¥°å™¨æ¨¡å¼å¾ˆé‡è¦çš„ä¸€ä¸ªç‰¹å¾ï¼Œé‚£å°±æ˜¯å¯ä»¥å¯¹åŸå§‹ç±»åµŒå¥—ä½¿ç”¨å¤šä¸ªè£…é¥°å™¨ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€æ•ˆæœï¼Œè£…é¥°å™¨ç±»éœ€è¦è·ŸåŸå§‹ç±»ç»§æ‰¿ç›¸åŒçš„æŠ½è±¡ç±»æˆ–è€…å®ç°ç›¸åŒçš„æ¥å£ã€‚ä¸Šé¢ä»‹ç»åˆ°çš„è¿™äº› IO ç›¸å…³çš„è£…é¥°ç±»å’ŒåŸå§‹ç±»å…±åŒçš„çˆ¶ç±»æ˜¯ <code>InputStream</code> å’Œ<code>OutputStream</code>ã€‚</p>
<p>å¯¹äºå­—ç¬¦æµæ¥è¯´ï¼Œ<code>BufferedReader</code> å¯ä»¥ç”¨æ¥å¢åŠ  <code>Reader</code> ï¼ˆå­—ç¬¦è¾“å…¥æµï¼‰å­ç±»çš„åŠŸèƒ½ï¼Œ<code>BufferedWriter</code> å¯ä»¥ç”¨æ¥å¢åŠ  <code>Writer</code> ï¼ˆå­—ç¬¦è¾“å‡ºæµï¼‰å­ç±»çš„åŠŸèƒ½ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>BufferedWriter bw = <span style="color:#fff;font-weight:bold">new</span> BufferedWriter(<span style="color:#fff;font-weight:bold">new</span> OutputStreamWriter(<span style="color:#fff;font-weight:bold">new</span> FileOutputStream(fileName), <span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><p>IO æµä¸­çš„è£…é¥°å™¨æ¨¡å¼åº”ç”¨çš„ä¾‹å­å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œä¸éœ€è¦ç‰¹æ„è®°å¿†ï¼Œå®Œå…¨æ²¡å¿…è¦å“ˆï¼ææ¸…äº†è£…é¥°å™¨æ¨¡å¼çš„æ ¸å¿ƒä¹‹åï¼Œä½ åœ¨ä½¿ç”¨çš„æ—¶å€™è‡ªç„¶å°±ä¼šçŸ¥é“å“ªäº›åœ°æ–¹è¿ç”¨åˆ°äº†è£…é¥°å™¨æ¨¡å¼ã€‚</p>
<h2 id="é€‚é…å™¨æ¨¡å¼">é€‚é…å™¨æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#é€‚é…å™¨æ¨¡å¼">#</a></h2>
<h2 id="é€‚é…å™¨æ¨¡å¼-1">é€‚é…å™¨æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#é€‚é…å™¨æ¨¡å¼-1">#</a></h2>
<p><strong>é€‚é…å™¨ï¼ˆAdapter Patternï¼‰æ¨¡å¼</strong> ä¸»è¦ç”¨äºæ¥å£äº’ä¸å…¼å®¹çš„ç±»çš„åè°ƒå·¥ä½œï¼Œä½ å¯ä»¥å°†å…¶è”æƒ³åˆ°æˆ‘ä»¬æ—¥å¸¸ç»å¸¸ä½¿ç”¨çš„ç”µæºé€‚é…å™¨ã€‚</p>
<p>é€‚é…å™¨æ¨¡å¼ä¸­å­˜åœ¨è¢«é€‚é…çš„å¯¹è±¡æˆ–è€…ç±»ç§°ä¸º <strong>é€‚é…è€…(Adaptee)</strong> ï¼Œä½œç”¨äºé€‚é…è€…çš„å¯¹è±¡æˆ–è€…ç±»ç§°ä¸º<strong>é€‚é…å™¨(Adapter)</strong> ã€‚é€‚é…å™¨åˆ†ä¸ºå¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨ã€‚ç±»é€‚é…å™¨ä½¿ç”¨ç»§æ‰¿å…³ç³»æ¥å®ç°ï¼Œå¯¹è±¡é€‚é…å™¨ä½¿ç”¨ç»„åˆå…³ç³»æ¥å®ç°ã€‚</p>
<p>IO æµä¸­çš„å­—ç¬¦æµå’Œå­—èŠ‚æµçš„æ¥å£ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´å¯ä»¥åè°ƒå·¥ä½œå°±æ˜¯åŸºäºé€‚é…å™¨æ¨¡å¼æ¥åšçš„ï¼Œæ›´å‡†ç¡®ç‚¹æ¥è¯´æ˜¯å¯¹è±¡é€‚é…å™¨ã€‚é€šè¿‡é€‚é…å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†å­—èŠ‚æµå¯¹è±¡é€‚é…æˆä¸€ä¸ªå­—ç¬¦æµå¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡å­—èŠ‚æµå¯¹è±¡æ¥è¯»å–æˆ–è€…å†™å…¥å­—ç¬¦æ•°æ®ã€‚</p>
<p><code>InputStreamReader</code> å’Œ <code>OutputStreamWriter</code> å°±æ˜¯ä¸¤ä¸ªé€‚é…å™¨(Adapter)ï¼Œ åŒæ—¶ï¼Œå®ƒä»¬ä¸¤ä¸ªä¹Ÿæ˜¯å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´çš„æ¡¥æ¢ã€‚<code>InputStreamReader</code> ä½¿ç”¨ <code>StreamDecoder</code> ï¼ˆæµè§£ç å™¨ï¼‰å¯¹å­—èŠ‚è¿›è¡Œè§£ç ï¼Œ<strong>å®ç°å­—èŠ‚æµåˆ°å­—ç¬¦æµçš„è½¬æ¢ï¼Œ</strong> <code>OutputStreamWriter</code> ä½¿ç”¨<code>StreamEncoder</code>ï¼ˆæµç¼–ç å™¨ï¼‰å¯¹å­—ç¬¦è¿›è¡Œç¼–ç ï¼Œå®ç°å­—ç¬¦æµåˆ°å­—èŠ‚æµçš„è½¬æ¢ã€‚</p>
<p><code>InputStream</code> å’Œ <code>OutputStream</code> çš„å­ç±»æ˜¯è¢«é€‚é…è€…ï¼Œ <code>InputStreamReader</code> å’Œ <code>OutputStreamWriter</code>æ˜¯é€‚é…å™¨ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// InputStreamReader æ˜¯é€‚é…å™¨ï¼ŒFileInputStream æ˜¯è¢«é€‚é…çš„ç±»</span>
</span></span><span style="display:flex;"><span>InputStreamReader isr = <span style="color:#fff;font-weight:bold">new</span> InputStreamReader(<span style="color:#fff;font-weight:bold">new</span> FileInputStream(fileName), <span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// BufferedReader å¢å¼º InputStreamReader çš„åŠŸèƒ½ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼‰</span>
</span></span><span style="display:flex;"><span>BufferedReader bufferedReader = <span style="color:#fff;font-weight:bold">new</span> BufferedReader(isr);
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>java.io.InputStreamReader</code> éƒ¨åˆ†æºç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> InputStreamReader <span style="color:#fff;font-weight:bold">extends</span> Reader {
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//ç”¨äºè§£ç çš„å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> StreamDecoder sd;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> InputStreamReader(InputStream in) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(in);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è·å– StreamDecoder å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>            sd = StreamDecoder.<span style="color:#007f7f">forInputStreamReader</span>(in, <span style="color:#fff;font-weight:bold">this</span>, (String)<span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (UnsupportedEncodingException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> Error(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä½¿ç”¨ StreamDecoder å¯¹è±¡åšå…·ä½“çš„è¯»å–å·¥ä½œ</span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> read() <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> sd.<span style="color:#007f7f">read</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>java.io.OutputStreamWriter</code> éƒ¨åˆ†æºç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> OutputStreamWriter <span style="color:#fff;font-weight:bold">extends</span> Writer {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ç”¨äºç¼–ç çš„å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> StreamEncoder se;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> OutputStreamWriter(OutputStream out) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(out);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>           <span style="color:#007f7f">// è·å– StreamEncoder å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>            se = StreamEncoder.<span style="color:#007f7f">forOutputStreamWriter</span>(out, <span style="color:#fff;font-weight:bold">this</span>, (String)<span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (UnsupportedEncodingException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> Error(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä½¿ç”¨ StreamEncoder å¯¹è±¡åšå…·ä½“çš„å†™å…¥å·¥ä½œ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> write(<span style="color:#fff;font-weight:bold">int</span> c) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        se.<span style="color:#007f7f">write</span>(c);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</strong></p>
<p><strong>è£…é¥°å™¨æ¨¡å¼</strong> æ›´ä¾§é‡äºåŠ¨æ€åœ°å¢å¼ºåŸå§‹ç±»çš„åŠŸèƒ½ï¼Œè£…é¥°å™¨ç±»éœ€è¦è·ŸåŸå§‹ç±»ç»§æ‰¿ç›¸åŒçš„æŠ½è±¡ç±»æˆ–è€…å®ç°ç›¸åŒçš„æ¥å£ã€‚å¹¶ä¸”ï¼Œè£…é¥°å™¨æ¨¡å¼æ”¯æŒå¯¹åŸå§‹ç±»åµŒå¥—ä½¿ç”¨å¤šä¸ªè£…é¥°å™¨ã€‚</p>
<p><strong>é€‚é…å™¨æ¨¡å¼</strong> æ›´ä¾§é‡äºè®©æ¥å£ä¸å…¼å®¹è€Œä¸èƒ½äº¤äº’çš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œï¼Œå½“æˆ‘ä»¬è°ƒç”¨é€‚é…å™¨å¯¹åº”çš„æ–¹æ³•æ—¶ï¼Œé€‚é…å™¨å†…éƒ¨ä¼šè°ƒç”¨é€‚é…è€…ç±»æˆ–è€…å’Œé€‚é…ç±»ç›¸å…³çš„ç±»çš„æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹é€æ˜çš„ã€‚å°±æ¯”å¦‚è¯´ <code>StreamDecoder</code> ï¼ˆæµè§£ç å™¨ï¼‰å’Œ<code>StreamEncoder</code>ï¼ˆæµç¼–ç å™¨ï¼‰å°±æ˜¯åˆ†åˆ«åŸºäº <code>InputStream</code> å’Œ <code>OutputStream</code> æ¥è·å– <code>FileChannel</code>å¯¹è±¡å¹¶è°ƒç”¨å¯¹åº”çš„ <code>read</code> æ–¹æ³•å’Œ <code>write</code> æ–¹æ³•è¿›è¡Œå­—èŠ‚æ•°æ®çš„è¯»å–å’Œå†™å…¥ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>StreamDecoder(InputStream in, Object lock, CharsetDecoder dec) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// çœç•¥å¤§éƒ¨åˆ†ä»£ç </span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ ¹æ® InputStream å¯¹è±¡è·å– FileChannel å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>    ch = getChannel((FileInputStream)in);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€‚é…å™¨å’Œé€‚é…è€…ä¸¤è€…ä¸éœ€è¦ç»§æ‰¿ç›¸åŒçš„æŠ½è±¡ç±»æˆ–è€…å®ç°ç›¸åŒçš„æ¥å£ã€‚</p>
<p>å¦å¤–ï¼Œ<code>FutureTask</code> ç±»ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ï¼Œ<code>Executors</code> çš„å†…éƒ¨ç±» <code>RunnableAdapter</code> å®ç°å±äºé€‚é…å™¨ï¼Œç”¨äºå°† <code>Runnable</code> é€‚é…æˆ <code>Callable</code>ã€‚</p>
<p><code>FutureTask</code>å‚æ•°åŒ…å« <code>Runnable</code> çš„ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> FutureTask(Runnable runnable, V result) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è°ƒç”¨ Executors ç±»çš„ callable æ–¹æ³•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">callable</span> = Executors.<span style="color:#007f7f">callable</span>(runnable, result);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">state</span> = NEW;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Executors</code>ä¸­å¯¹åº”çš„æ–¹æ³•å’Œé€‚é…å™¨ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// å®é™…è°ƒç”¨çš„æ˜¯ Executors çš„å†…éƒ¨ç±» RunnableAdapter çš„æ„é€ æ–¹æ³•</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> &lt;T&gt; Callable&lt;T&gt; callable(Runnable task, T result) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (task == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> NullPointerException();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> RunnableAdapter&lt;T&gt;(task, result);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// é€‚é…å™¨</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">class</span> RunnableAdapter&lt;T&gt; <span style="color:#fff;font-weight:bold">implements</span> Callable&lt;T&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> Runnable task;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> T result;
</span></span><span style="display:flex;"><span>    RunnableAdapter(Runnable task, T result) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">task</span> = task;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">result</span> = result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> T call() {
</span></span><span style="display:flex;"><span>        task.<span style="color:#007f7f">run</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å·¥å‚æ¨¡å¼">å·¥å‚æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#å·¥å‚æ¨¡å¼">#</a></h2>
<p>å·¥å‚æ¨¡å¼ç”¨äºåˆ›å»ºå¯¹è±¡ï¼ŒNIO ä¸­å¤§é‡ç”¨åˆ°äº†å·¥å‚æ¨¡å¼ï¼Œæ¯”å¦‚ <code>Files</code> ç±»çš„ <code>newInputStream</code> æ–¹æ³•ç”¨äºåˆ›å»º <code>InputStream</code> å¯¹è±¡ï¼ˆé™æ€å·¥å‚ï¼‰ã€ <code>Paths</code> ç±»çš„ <code>get</code> æ–¹æ³•åˆ›å»º <code>Path</code> å¯¹è±¡ï¼ˆé™æ€å·¥å‚ï¼‰ã€<code>ZipFileSystem</code> ç±»ï¼ˆ<code>sun.nio</code>åŒ…ä¸‹çš„ç±»ï¼Œå±äº <code>java.nio</code> ç›¸å…³çš„ä¸€äº›å†…éƒ¨å®ç°ï¼‰çš„ <code>getPath</code> çš„æ–¹æ³•åˆ›å»º <code>Path</code> å¯¹è±¡ï¼ˆç®€å•å·¥å‚ï¼‰ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>InputStream is Files.<span style="color:#007f7f">newInputStream</span>(Paths.<span style="color:#007f7f">get</span>(generatorLogoPath))
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è§‚å¯Ÿè€…æ¨¡å¼">è§‚å¯Ÿè€…æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#è§‚å¯Ÿè€…æ¨¡å¼">#</a></h2>
<p>NIO ä¸­çš„æ–‡ä»¶ç›®å½•ç›‘å¬æœåŠ¡ä½¿ç”¨åˆ°äº†è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p>
<p>NIO ä¸­çš„æ–‡ä»¶ç›®å½•ç›‘å¬æœåŠ¡åŸºäº <code>WatchService</code> æ¥å£å’Œ <code>Watchable</code> æ¥å£ã€‚<code>WatchService</code> å±äºè§‚å¯Ÿè€…ï¼Œ<code>Watchable</code> å±äºè¢«è§‚å¯Ÿè€…ã€‚</p>
<p><code>Watchable</code> æ¥å£å®šä¹‰äº†ä¸€ä¸ªç”¨äºå°†å¯¹è±¡æ³¨å†Œåˆ° <code>WatchService</code>ï¼ˆç›‘æ§æœåŠ¡ï¼‰ å¹¶ç»‘å®šç›‘å¬äº‹ä»¶çš„æ–¹æ³• <code>register</code> ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Path
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">extends</span> Comparable&lt;Path&gt;, Iterable&lt;Path&gt;, Watchable{
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Watchable {
</span></span><span style="display:flex;"><span>    WatchKey register(WatchService watcher,
</span></span><span style="display:flex;"><span>                      WatchEvent.<span style="color:#007f7f">Kind</span>&lt;?&gt;[] events,
</span></span><span style="display:flex;"><span>                      WatchEvent.<span style="color:#007f7f">Modifier</span>... modifiers)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throws</span> IOException;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>WatchService</code> ç”¨äºç›‘å¬æ–‡ä»¶ç›®å½•çš„å˜åŒ–ï¼ŒåŒä¸€ä¸ª <code>WatchService</code> å¯¹è±¡èƒ½å¤Ÿç›‘å¬å¤šä¸ªæ–‡ä»¶ç›®å½•ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»º WatchService å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>WatchService watchService = FileSystems.<span style="color:#007f7f">getDefault</span>().<span style="color:#007f7f">newWatchService</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆå§‹åŒ–ä¸€ä¸ªè¢«ç›‘æ§æ–‡ä»¶å¤¹çš„ Path ç±»:</span>
</span></span><span style="display:flex;"><span>Path path = Paths.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;workingDirectory&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å°†è¿™ä¸ª path å¯¹è±¡æ³¨å†Œåˆ° WatchServiceï¼ˆç›‘æ§æœåŠ¡ï¼‰ ä¸­å»</span>
</span></span><span style="display:flex;"><span>WatchKey watchKey = path.<span style="color:#007f7f">register</span>(
</span></span><span style="display:flex;"><span>watchService, StandardWatchEventKinds...);
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Path</code> ç±» <code>register</code> æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•° <code>events</code> ï¼ˆéœ€è¦ç›‘å¬çš„äº‹ä»¶ï¼‰ä¸ºå¯å˜é•¿å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åŒæ—¶ç›‘å¬å¤šç§äº‹ä»¶ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>WatchKey register(WatchService watcher,
</span></span><span style="display:flex;"><span>                  WatchEvent.<span style="color:#007f7f">Kind</span>&lt;?&gt;... events)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">throws</span> IOException;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¸¸ç”¨çš„ç›‘å¬äº‹ä»¶æœ‰ 3 ç§ï¼š</p>
<ul>
<li><code>StandardWatchEventKinds.ENTRY_CREATE</code>ï¼šæ–‡ä»¶åˆ›å»ºã€‚</li>
<li><code>StandardWatchEventKinds.ENTRY_DELETE</code> : æ–‡ä»¶åˆ é™¤ã€‚</li>
<li><code>StandardWatchEventKinds.ENTRY_MODIFY</code> : æ–‡ä»¶ä¿®æ”¹ã€‚</li>
</ul>
<p><code>register</code> æ–¹æ³•è¿”å› <code>WatchKey</code> å¯¹è±¡ï¼Œé€šè¿‡<code>WatchKey</code> å¯¹è±¡å¯ä»¥è·å–äº‹ä»¶çš„å…·ä½“ä¿¡æ¯æ¯”å¦‚æ–‡ä»¶ç›®å½•ä¸‹æ˜¯åˆ›å»ºã€åˆ é™¤è¿˜æ˜¯ä¿®æ”¹äº†æ–‡ä»¶ã€åˆ›å»ºã€åˆ é™¤æˆ–è€…ä¿®æ”¹çš„æ–‡ä»¶çš„å…·ä½“åç§°æ˜¯ä»€ä¹ˆã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>WatchKey key;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">while</span> ((key = watchService.<span style="color:#007f7f">take</span>()) != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (WatchEvent&lt;?&gt; event : key.<span style="color:#007f7f">pollEvents</span>()) {
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// å¯ä»¥è°ƒç”¨ WatchEvent å¯¹è±¡çš„æ–¹æ³•åšä¸€äº›äº‹æƒ…æ¯”å¦‚è¾“å‡ºäº‹ä»¶çš„å…·ä½“ä¸Šä¸‹æ–‡ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    key.<span style="color:#007f7f">reset</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>WatchService</code> å†…éƒ¨æ˜¯é€šè¿‡ä¸€ä¸ª daemon threadï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰é‡‡ç”¨å®šæœŸè½®è¯¢çš„æ–¹å¼æ¥æ£€æµ‹æ–‡ä»¶çš„å˜åŒ–ï¼Œç®€åŒ–åçš„æºç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> PollingWatchService
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">extends</span> AbstractWatchService
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å®šä¹‰ä¸€ä¸ª daemon threadï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰è½®è¯¢æ£€æµ‹æ–‡ä»¶å˜åŒ–</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> ScheduledExecutorService scheduledExecutor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    PollingWatchService() {
</span></span><span style="display:flex;"><span>        scheduledExecutor = Executors
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">newSingleThreadScheduledExecutor</span>(<span style="color:#fff;font-weight:bold">new</span> ThreadFactory() {
</span></span><span style="display:flex;"><span>                 @Override
</span></span><span style="display:flex;"><span>                 <span style="color:#fff;font-weight:bold">public</span> Thread newThread(Runnable r) {
</span></span><span style="display:flex;"><span>                     Thread t = <span style="color:#fff;font-weight:bold">new</span> Thread(r);
</span></span><span style="display:flex;"><span>                     t.<span style="color:#007f7f">setDaemon</span>(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>                     <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>                 }});
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">void</span> enable(Set&lt;? <span style="color:#fff;font-weight:bold">extends</span> WatchEvent.<span style="color:#007f7f">Kind</span>&lt;?&gt;&gt; events, <span style="color:#fff;font-weight:bold">long</span> period) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">synchronized</span> (<span style="color:#fff;font-weight:bold">this</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// æ›´æ–°ç›‘å¬äº‹ä»¶</span>
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">events</span> = events;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¼€å¯å®šæœŸè½®è¯¢</span>
</span></span><span style="display:flex;"><span>      Runnable thunk = <span style="color:#fff;font-weight:bold">new</span> Runnable() { <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() { poll(); }};
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">poller</span> = scheduledExecutor
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">scheduleAtFixedRate</span>(thunk, period, period, TimeUnit.<span style="color:#007f7f">SECONDS</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="java-ioæ¨¡å‹ç²—è§£">Java IOæ¨¡å‹ç²—è§£<a hidden class="anchor" aria-hidden="true" href="#java-ioæ¨¡å‹ç²—è§£">#</a></h1>
<p>I/Oï¼ˆ<strong>I</strong>nput/<strong>O</strong>utpuï¼‰ å³<strong>è¾“å…¥ï¼è¾“å‡º</strong> ã€‚</p>
<p><strong>æˆ‘ä»¬å…ˆä»è®¡ç®—æœºç»“æ„çš„è§’åº¦æ¥è§£è¯»ä¸€ä¸‹ I/Oã€‚</strong></p>
<p>æ ¹æ®å†¯.è¯ºä¾æ›¼ç»“æ„ï¼Œè®¡ç®—æœºç»“æ„åˆ†ä¸º 5 å¤§éƒ¨åˆ†ï¼šè¿ç®—å™¨ã€æ§åˆ¶å™¨ã€å­˜å‚¨å™¨ã€è¾“å…¥è®¾å¤‡ã€è¾“å‡ºè®¾å¤‡ã€‚</p>
<p><img alt="å†¯è¯ºä¾æ›¼ä½“ç³»" loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/1.png"></p>
<p>è¾“å…¥è®¾å¤‡ï¼ˆæ¯”å¦‚é”®ç›˜ï¼‰å’Œè¾“å‡ºè®¾å¤‡ï¼ˆæ¯”å¦‚æ˜¾ç¤ºå™¨ï¼‰éƒ½å±äºå¤–éƒ¨è®¾å¤‡ã€‚ç½‘å¡ã€ç¡¬ç›˜è¿™ç§æ—¢å¯ä»¥å±äºè¾“å…¥è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥å±äºè¾“å‡ºè®¾å¤‡ã€‚</p>
<p>è¾“å…¥è®¾å¤‡å‘è®¡ç®—æœºè¾“å…¥æ•°æ®ï¼Œè¾“å‡ºè®¾å¤‡æ¥æ”¶è®¡ç®—æœºè¾“å‡ºçš„æ•°æ®ã€‚</p>
<p><strong>ä»è®¡ç®—æœºç»“æ„çš„è§†è§’æ¥çœ‹çš„è¯ï¼Œ I/O æè¿°äº†è®¡ç®—æœºç³»ç»Ÿä¸å¤–éƒ¨è®¾å¤‡ä¹‹é—´é€šä¿¡çš„è¿‡ç¨‹ã€‚</strong></p>
<p><strong>æˆ‘ä»¬å†å…ˆä»åº”ç”¨ç¨‹åºçš„è§’åº¦æ¥è§£è¯»ä¸€ä¸‹ I/Oã€‚</strong></p>
<p>æ ¹æ®å¤§å­¦é‡Œå­¦åˆ°çš„æ“ä½œç³»ç»Ÿç›¸å…³çš„çŸ¥è¯†ï¼šä¸ºäº†ä¿è¯æ“ä½œç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼Œä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´åˆ’åˆ†ä¸º <strong>ç”¨æˆ·ç©ºé—´ï¼ˆUser spaceï¼‰</strong> å’Œ <strong>å†…æ ¸ç©ºé—´ï¼ˆKernel space ï¼‰</strong> ã€‚</p>
<p>åƒæˆ‘ä»¬å¹³å¸¸è¿è¡Œçš„åº”ç”¨ç¨‹åºéƒ½æ˜¯è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ï¼Œåªæœ‰å†…æ ¸ç©ºé—´æ‰èƒ½è¿›è¡Œç³»ç»Ÿæ€çº§åˆ«çš„èµ„æºæœ‰å…³çš„æ“ä½œï¼Œæ¯”å¦‚æ–‡ä»¶ç®¡ç†ã€è¿›ç¨‹é€šä¿¡ã€å†…å­˜ç®¡ç†ç­‰ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æƒ³è¦è¿›è¡Œ IO æ“ä½œï¼Œä¸€å®šæ˜¯è¦ä¾èµ–å†…æ ¸ç©ºé—´çš„èƒ½åŠ›ã€‚</p>
<p>å¹¶ä¸”ï¼Œç”¨æˆ·ç©ºé—´çš„ç¨‹åºä¸èƒ½ç›´æ¥è®¿é—®å†…æ ¸ç©ºé—´ã€‚</p>
<p>å½“æƒ³è¦æ‰§è¡Œ IO æ“ä½œæ—¶ï¼Œç”±äºæ²¡æœ‰æ‰§è¡Œè¿™äº›æ“ä½œçš„æƒé™ï¼Œåªèƒ½å‘èµ·ç³»ç»Ÿè°ƒç”¨è¯·æ±‚æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆã€‚</p>
<p>å› æ­¤ï¼Œç”¨æˆ·è¿›ç¨‹æƒ³è¦æ‰§è¡Œ IO æ“ä½œçš„è¯ï¼Œå¿…é¡»é€šè¿‡ <strong>ç³»ç»Ÿè°ƒç”¨</strong> æ¥é—´æ¥è®¿é—®å†…æ ¸ç©ºé—´</p>
<p>æˆ‘ä»¬åœ¨å¹³å¸¸å¼€å‘è¿‡ç¨‹ä¸­æ¥è§¦æœ€å¤šçš„å°±æ˜¯ <strong>ç£ç›˜ IOï¼ˆè¯»å†™æ–‡ä»¶ï¼‰</strong> å’Œ <strong>ç½‘ç»œ IOï¼ˆç½‘ç»œè¯·æ±‚å’Œå“åº”ï¼‰</strong>ã€‚</p>
<p><strong>ä»åº”ç”¨ç¨‹åºçš„è§†è§’æ¥çœ‹çš„è¯ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯¹æ“ä½œç³»ç»Ÿçš„å†…æ ¸å‘èµ· IO è°ƒç”¨ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£çš„å†…æ ¸æ‰§è¡Œå…·ä½“çš„ IO æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå®é™…ä¸Šåªæ˜¯å‘èµ·äº† IO æ“ä½œçš„è°ƒç”¨è€Œå·²ï¼Œå…·ä½“ IO çš„æ‰§è¡Œæ˜¯ç”±æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ¥å®Œæˆçš„ã€‚</strong></p>
<p>å½“åº”ç”¨ç¨‹åºå‘èµ· I/O è°ƒç”¨åï¼Œä¼šç»å†ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>å†…æ ¸ç­‰å¾… I/O è®¾å¤‡å‡†å¤‡å¥½æ•°æ®</li>
<li>å†…æ ¸å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</li>
</ol>
<h2 id="æœ‰å“ªäº›å¸¸è§çš„-io-æ¨¡å‹">æœ‰å“ªäº›å¸¸è§çš„ IO æ¨¡å‹?<a hidden class="anchor" aria-hidden="true" href="#æœ‰å“ªäº›å¸¸è§çš„-io-æ¨¡å‹">#</a></h2>
<p>UNIX ç³»ç»Ÿä¸‹ï¼Œ IO æ¨¡å‹ä¸€å…±æœ‰ 5 ç§ï¼š<strong>åŒæ­¥é˜»å¡ I/O</strong>ã€<strong>åŒæ­¥éé˜»å¡ I/O</strong>ã€<strong>I/O å¤šè·¯å¤ç”¨</strong>ã€<strong>ä¿¡å·é©±åŠ¨ I/O</strong> å’Œ<strong>å¼‚æ­¥ I/O</strong>ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸æåˆ°çš„ 5 ç§ IO æ¨¡å‹ã€‚</p>
<h2 id="java-ä¸­-3-ç§å¸¸è§-io-æ¨¡å‹">Java ä¸­ 3 ç§å¸¸è§ IO æ¨¡å‹<a hidden class="anchor" aria-hidden="true" href="#java-ä¸­-3-ç§å¸¸è§-io-æ¨¡å‹">#</a></h2>
<h3 id="bio-blocking-io">BIO (Blocking I/O)<a hidden class="anchor" aria-hidden="true" href="#bio-blocking-io">#</a></h3>
<p><strong>BIO å±äºåŒæ­¥é˜»å¡ IO æ¨¡å‹</strong> ã€‚</p>
<p>åŒæ­¥é˜»å¡ IO æ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºå‘èµ· read è°ƒç”¨åï¼Œä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°å†…æ ¸æŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚
<img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/2.png"></p>
<p>åœ¨å®¢æˆ·ç«¯è¿æ¥æ•°é‡ä¸é«˜çš„æƒ…å†µä¸‹ï¼Œæ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯ï¼Œå½“é¢å¯¹åä¸‡ç”šè‡³ç™¾ä¸‡çº§è¿æ¥çš„æ—¶å€™ï¼Œä¼ ç»Ÿçš„ BIO æ¨¡å‹æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´é«˜æ•ˆçš„ I/O å¤„ç†æ¨¡å‹æ¥åº”å¯¹æ›´é«˜çš„å¹¶å‘é‡ã€‚</p>
<h2 id="nio-non-blockingnew-io">NIO (Non-blocking/New I/O)<a hidden class="anchor" aria-hidden="true" href="#nio-non-blockingnew-io">#</a></h2>
<p>Java ä¸­çš„ NIO äº Java 1.4 ä¸­å¼•å…¥ï¼Œå¯¹åº” <code>java.nio</code> åŒ…ï¼Œæä¾›äº† <code>Channel</code> , <code>Selector</code>ï¼Œ<code>Buffer</code> ç­‰æŠ½è±¡ã€‚NIO ä¸­çš„ N å¯ä»¥ç†è§£ä¸º Non-blockingï¼Œä¸å•çº¯æ˜¯ Newã€‚å®ƒæ˜¯æ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„ I/O æ“ä½œæ–¹æ³•ã€‚ å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO ã€‚</p>
<p>Java ä¸­çš„ NIO å¯ä»¥çœ‹ä½œæ˜¯ <strong>I/O å¤šè·¯å¤ç”¨æ¨¡å‹</strong>ã€‚ä¹Ÿæœ‰å¾ˆå¤šäººè®¤ä¸ºï¼ŒJava ä¸­çš„ NIO å±äºåŒæ­¥éé˜»å¡ IO æ¨¡å‹ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ <strong>åŒæ­¥éé˜»å¡ IO æ¨¡å‹</strong>ã€‚</p>
<p><img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/3.png"></p>
<p>åŒæ­¥éé˜»å¡ IO æ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºä¼šä¸€ç›´å‘èµ· read è°ƒç”¨ï¼Œç­‰å¾…æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„è¿™æ®µæ—¶é—´é‡Œï¼Œçº¿ç¨‹ä¾ç„¶æ˜¯é˜»å¡çš„ï¼Œç›´åˆ°åœ¨å†…æ ¸æŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p>
<p>ç›¸æ¯”äºåŒæ­¥é˜»å¡ IO æ¨¡å‹ï¼ŒåŒæ­¥éé˜»å¡ IO æ¨¡å‹ç¡®å®æœ‰äº†å¾ˆå¤§æ”¹è¿›ã€‚é€šè¿‡è½®è¯¢æ“ä½œï¼Œé¿å…äº†ä¸€ç›´é˜»å¡ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™ç§ IO æ¨¡å‹åŒæ ·å­˜åœ¨é—®é¢˜ï¼š<strong>åº”ç”¨ç¨‹åºä¸æ–­è¿›è¡Œ I/O ç³»ç»Ÿè°ƒç”¨è½®è¯¢æ•°æ®æ˜¯å¦å·²ç»å‡†å¤‡å¥½çš„è¿‡ç¨‹æ˜¯ååˆ†æ¶ˆè€— CPU èµ„æºçš„ã€‚</strong></p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œ<strong>I/O å¤šè·¯å¤ç”¨æ¨¡å‹</strong> å°±ä¸Šåœºäº†ã€‚</p>
<p><img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/4.png"></p>
<p>IO å¤šè·¯å¤ç”¨æ¨¡å‹ä¸­ï¼Œçº¿ç¨‹é¦–å…ˆå‘èµ· select è°ƒç”¨ï¼Œè¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å°±ç»ªï¼Œç­‰å†…æ ¸æŠŠæ•°æ®å‡†å¤‡å¥½äº†ï¼Œç”¨æˆ·çº¿ç¨‹å†å‘èµ· read è°ƒç”¨ã€‚read è°ƒç”¨çš„è¿‡ç¨‹ï¼ˆæ•°æ®ä»å†…æ ¸ç©ºé—´ -&gt; ç”¨æˆ·ç©ºé—´ï¼‰è¿˜æ˜¯é˜»å¡çš„ã€‚</p>
<blockquote>
<p>ç›®å‰æ”¯æŒ IO å¤šè·¯å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæœ‰ selectï¼Œepoll ç­‰ç­‰ã€‚select ç³»ç»Ÿè°ƒç”¨ï¼Œç›®å‰å‡ ä¹åœ¨æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿä¸Šéƒ½æœ‰æ”¯æŒã€‚</p>
<ul>
<li><strong>select è°ƒç”¨</strong>ï¼šå†…æ ¸æä¾›çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæ”¯æŒä¸€æ¬¡æŸ¥è¯¢å¤šä¸ªç³»ç»Ÿè°ƒç”¨çš„å¯ç”¨çŠ¶æ€ã€‚å‡ ä¹æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒã€‚</li>
<li><strong>epoll è°ƒç”¨</strong>ï¼šlinux 2.6 å†…æ ¸ï¼Œå±äº select è°ƒç”¨çš„å¢å¼ºç‰ˆæœ¬ï¼Œä¼˜åŒ–äº† IO çš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
</ul>
</blockquote>
<p><strong>IO å¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œé€šè¿‡å‡å°‘æ— æ•ˆçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‡å°‘äº†å¯¹ CPU èµ„æºçš„æ¶ˆè€—ã€‚</strong></p>
<p>Java ä¸­çš„ NIO ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„<strong>é€‰æ‹©å™¨ ( Selector )</strong> çš„æ¦‚å¿µï¼Œä¹Ÿå¯ä»¥è¢«ç§°ä¸º <strong>å¤šè·¯å¤ç”¨å™¨</strong>ã€‚é€šè¿‡å®ƒï¼Œåªéœ€è¦ä¸€ä¸ªçº¿ç¨‹ä¾¿å¯ä»¥ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚å½“å®¢æˆ·ç«¯æ•°æ®åˆ°äº†ä¹‹åï¼Œæ‰ä¼šä¸ºå…¶æœåŠ¡ã€‚</p>
<p><img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/5.png"></p>
<h2 id="aio-asynchronous-io">AIO (Asynchronous I/O)<a hidden class="anchor" aria-hidden="true" href="#aio-asynchronous-io">#</a></h2>
<p>AIO ä¹Ÿå°±æ˜¯ NIO 2ã€‚Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥ IO æ¨¡å‹ã€‚</p>
<p>å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚
<img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/6.png"></p>
<p>ç›®å‰æ¥è¯´ AIO çš„åº”ç”¨è¿˜ä¸æ˜¯å¾ˆå¹¿æ³›ã€‚Netty ä¹‹å‰ä¹Ÿå°è¯•ä½¿ç”¨è¿‡ AIOï¼Œä¸è¿‡åˆæ”¾å¼ƒäº†ã€‚è¿™æ˜¯å› ä¸ºï¼ŒNetty ä½¿ç”¨äº† AIO ä¹‹åï¼Œåœ¨ Linux ç³»ç»Ÿä¸Šçš„æ€§èƒ½å¹¶æ²¡æœ‰å¤šå°‘æå‡ã€‚</p>
<p>æœ€åï¼Œæ¥ä¸€å¼ å›¾ï¼Œç®€å•æ€»ç»“ä¸€ä¸‹ Java ä¸­çš„ BIOã€NIOã€AIOã€‚</p>
<p><img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/7.png"></p>
<h1 id="nio-æ ¸å¿ƒçŸ¥è¯†æ€»ç»“">NIO æ ¸å¿ƒçŸ¥è¯†æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#nio-æ ¸å¿ƒçŸ¥è¯†æ€»ç»“">#</a></h1>
<p>åœ¨ä¼ ç»Ÿçš„ Java I/O æ¨¡å‹ï¼ˆBIOï¼‰ä¸­ï¼ŒI/O æ“ä½œæ˜¯ä»¥é˜»å¡çš„æ–¹å¼è¿›è¡Œçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ª I/O æ“ä½œæ—¶ï¼Œå®ƒä¼šè¢«é˜»å¡ç›´åˆ°æ“ä½œå®Œæˆã€‚è¿™ç§é˜»å¡æ¨¡å‹åœ¨å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥æ—¶å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ç“¶é¢ˆï¼Œå› ä¸ºéœ€è¦ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œçº¿ç¨‹çš„åˆ›å»ºå’Œåˆ‡æ¢éƒ½æ˜¯æœ‰å¼€é”€çš„ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨Java1.4 ç‰ˆæœ¬å¼•å…¥äº†ä¸€ç§æ–°çš„ I/O æ¨¡å‹ â€” <strong>NIO</strong> ï¼ˆNew IOï¼Œä¹Ÿç§°ä¸º Non-blocking IOï¼‰ ã€‚NIO å¼¥è¡¥äº†åŒæ­¥é˜»å¡I/Oçš„ä¸è¶³ï¼Œå®ƒåœ¨æ ‡å‡† Java ä»£ç ä¸­æä¾›äº†éé˜»å¡ã€é¢å‘ç¼“å†²ã€åŸºäºé€šé“çš„ I/Oï¼Œå¯ä»¥ä½¿ç”¨å°‘é‡çš„çº¿ç¨‹æ¥å¤„ç†å¤šä¸ªè¿æ¥ï¼Œå¤§å¤§æé«˜äº† I/O æ•ˆç‡å’Œå¹¶å‘ã€‚</p>
<p>ä¸‹å›¾æ˜¯ BIOã€NIO å’Œ AIO å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„ç®€å•å¯¹æ¯”å›¾</p>
<p><img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/7.png"></p>
<p>éœ€è¦æ³¨æ„ï¼šä½¿ç”¨ NIO å¹¶ä¸ä¸€å®šæ„å‘³ç€é«˜æ€§èƒ½ï¼Œå®ƒçš„æ€§èƒ½ä¼˜åŠ¿ä¸»è¦ä½“ç°åœ¨é«˜å¹¶å‘å’Œé«˜å»¶è¿Ÿçš„ç½‘ç»œç¯å¢ƒä¸‹ã€‚å½“è¿æ¥æ•°è¾ƒå°‘ã€å¹¶å‘ç¨‹åº¦è¾ƒä½æˆ–è€…ç½‘ç»œä¼ è¾“é€Ÿåº¦è¾ƒå¿«æ—¶ï¼ŒNIO çš„æ€§èƒ½å¹¶ä¸ä¸€å®šä¼˜äºä¼ ç»Ÿçš„ BIO ã€‚</p>
<h2 id="nioæ ¸å¿ƒç»„ä»¶">NIOæ ¸å¿ƒç»„ä»¶<a hidden class="anchor" aria-hidden="true" href="#nioæ ¸å¿ƒç»„ä»¶">#</a></h2>
<p>NIO ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li><strong>Bufferï¼ˆç¼“å†²åŒºï¼‰</strong>ï¼šNIO è¯»å†™æ•°æ®éƒ½æ˜¯é€šè¿‡ç¼“å†²åŒºè¿›è¡Œæ“ä½œçš„ã€‚è¯»æ“ä½œçš„æ—¶å€™å°† Channel ä¸­çš„æ•°æ®å¡«å……åˆ° Bufferä¸­ï¼Œè€Œå†™æ“ä½œæ—¶å°† Bufferä¸­çš„æ•°æ®å†™å…¥åˆ° Channel ä¸­ã€‚</li>
<li><strong>Channelï¼ˆé€šé“ï¼‰</strong>ï¼šChannel æ˜¯ä¸€ä¸ªåŒå‘çš„ã€å¯è¯»å¯å†™çš„æ•°æ®ä¼ è¾“é€šé“ï¼ŒNIO é€šè¿‡Channelæ¥å®ç°æ•°æ®çš„è¾“å…¥è¾“å‡ºã€‚é€šé“æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥ä»£è¡¨æ–‡ä»¶ã€å¥—æ¥å­—æˆ–è€…å…¶ä»–æ•°æ®æºä¹‹é—´çš„è¿æ¥ã€‚</li>
<li><strong>Selectorï¼ˆé€‰æ‹©å™¨ï¼‰</strong>ï¼šå…è®¸ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª Channelï¼ŒåŸºäºäº‹ä»¶é©±åŠ¨çš„ I/O å¤šè·¯å¤ç”¨æ¨¡å‹ã€‚æ‰€æœ‰çš„ Channel éƒ½å¯ä»¥æ³¨å†Œåˆ°Selectorä¸Šï¼Œç”±Selectoræ¥åˆ†é…çº¿ç¨‹æ¥å¤„ç†äº‹ä»¶ã€‚</li>
</ul>
<p>ä¸‰è€…çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆæš‚æ—¶ä¸ç†è§£æ²¡å…³ç³»ï¼Œåæ–‡ä¼šè¯¦ç»†ä»‹ç»ï¼‰ï¼š</p>
<p><img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/8.png"></p>
<h3 id="bufferç¼“å†²åŒº">Bufferï¼ˆç¼“å†²åŒºï¼‰<a hidden class="anchor" aria-hidden="true" href="#bufferç¼“å†²åŒº">#</a></h3>
<p>åœ¨ä¼ ç»Ÿçš„ BIO ä¸­ï¼Œæ•°æ®çš„è¯»å†™æ˜¯é¢å‘æµçš„ï¼Œ åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚</p>
<p>åœ¨Java 1.4 çš„ NIOåº“ä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†çš„ï¼Œè¿™æ˜¯æ–°åº“å’Œä¹‹å‰çš„ BIO çš„ä¸€ä¸ªé‡è¦åŒºåˆ«ï¼Œæœ‰ç‚¹ç±»ä¼¼äº BIO ä¸­çš„ç¼“å†²æµã€‚NIO åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ˜¯ç›´æ¥è¯»åˆ°ç¼“å†²åŒºä¸­çš„ã€‚åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå†™å…¥åˆ°ç¼“å†²åŒºä¸­ã€‚ ä½¿ç”¨ NIOåœ¨è¯»å†™æ•°æ®æ—¶ï¼Œéƒ½æ˜¯é€šè¿‡ç¼“å†²åŒºè¿›è¡Œæ“ä½œã€‚</p>
<p><code>Buffer</code> çš„å­ç±»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…¶ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ <code>ByteBuffer</code>ï¼Œå®ƒå¯ä»¥ç”¨æ¥å­˜å‚¨å’Œæ“ä½œå­—èŠ‚æ•°æ®ã€‚</p>
<p><img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/9.png"></p>
<p>ä½ å¯ä»¥å°† Buffer ç†è§£ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œ<code>IntBuffer</code>ã€<code>FloatBuffer</code>ã€<code>CharBuffer</code> ç­‰åˆ†åˆ«å¯¹åº” <code>int[]</code>ã€<code>float[]</code>ã€<code>char[]</code> ç­‰ã€‚</p>
<p>ä¸ºäº†æ›´æ¸…æ™°åœ°è®¤è¯†ç¼“å†²åŒºï¼Œæˆ‘ä»¬æ¥ç®€å•çœ‹çœ‹<code>Buffer</code> ç±»ä¸­å®šä¹‰çš„å››ä¸ªæˆå‘˜å˜é‡ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">abstract</span> <span style="color:#fff;font-weight:bold">class</span> Buffer {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Invariants: mark &lt;= position &lt;= limit &lt;= capacity</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> mark = -1;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> position = 0;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> limit;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> capacity;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™å››ä¸ªæˆå‘˜å˜é‡çš„å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ol>
<li>å®¹é‡ï¼ˆ<code>capacity</code>ï¼‰ï¼š<code>Buffer</code>å¯ä»¥å­˜å‚¨çš„æœ€å¤§æ•°æ®é‡ï¼Œ<code>Buffer</code>åˆ›å»ºæ—¶è®¾ç½®ä¸”ä¸å¯æ”¹å˜ï¼›</li>
<li>ç•Œé™ï¼ˆ<code>limit</code>ï¼‰ï¼š<code>Buffer</code> ä¸­å¯ä»¥è¯»/å†™æ•°æ®çš„è¾¹ç•Œã€‚å†™æ¨¡å¼ä¸‹ï¼Œ<code>limit</code> ä»£è¡¨æœ€å¤šèƒ½å†™å…¥çš„æ•°æ®ï¼Œä¸€èˆ¬ç­‰äº <code>capacity</code>ï¼ˆå¯ä»¥é€šè¿‡<code>limit(int newLimit) </code>æ–¹æ³•è®¾ç½®ï¼‰ï¼›è¯»æ¨¡å¼ä¸‹ï¼Œ<code>limit</code> ç­‰äº Buffer ä¸­å®é™…å†™å…¥çš„æ•°æ®å¤§å°ã€‚</li>
<li>ä½ç½®ï¼ˆ<code>position</code>ï¼‰ï¼šä¸‹ä¸€ä¸ªå¯ä»¥è¢«è¯»å†™çš„æ•°æ®çš„ä½ç½®ï¼ˆç´¢å¼•ï¼‰ã€‚ä»å†™æ“ä½œæ¨¡å¼åˆ°è¯»æ“ä½œæ¨¡å¼åˆ‡æ¢çš„æ—¶å€™ï¼ˆflipï¼‰ï¼Œ<code>position</code> éƒ½ä¼šå½’é›¶ï¼Œè¿™æ ·å°±å¯ä»¥ä»å¤´å¼€å§‹è¯»å†™äº†ã€‚</li>
<li>æ ‡è®°ï¼ˆ<code>mark</code>ï¼‰ï¼š<code>Buffer</code>å…è®¸å°†ä½ç½®ç›´æ¥å®šä½åˆ°è¯¥æ ‡è®°å¤„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰å±æ€§ï¼›</li>
</ol>
<p>å¹¶ä¸”ï¼Œä¸Šè¿°å˜é‡æ»¡è¶³å¦‚ä¸‹çš„å…³ç³»ï¼š<strong>0 &lt;= mark &lt;= position &lt;= limit &lt;= capacity</strong> ã€‚</p>
<p>å¦å¤–ï¼ŒBuffer æœ‰è¯»æ¨¡å¼å’Œå†™æ¨¡å¼è¿™ä¸¤ç§æ¨¡å¼ï¼Œåˆ†åˆ«ç”¨äºä» Buffer ä¸­è¯»å–æ•°æ®æˆ–è€…å‘ Buffer ä¸­å†™å…¥æ•°æ®ã€‚Buffer è¢«åˆ›å»ºä¹‹åé»˜è®¤æ˜¯å†™æ¨¡å¼ï¼Œè°ƒç”¨ <code>flip()</code> å¯ä»¥åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚å¦‚æœè¦å†æ¬¡åˆ‡æ¢å›å†™æ¨¡å¼ï¼Œå¯ä»¥è°ƒç”¨ <code>clear()</code> æˆ–è€… <code>compact()</code> æ–¹æ³•ã€‚</p>
<p><img alt="position ã€limit å’Œ capacity ä¹‹é—´çš„å…³ç³»" loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/10.png"></p>
<p><img alt="position ã€limit å’Œ capacity ä¹‹é—´çš„å…³ç³»" loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/11.png"></p>
<p><code>Buffer</code> å¯¹è±¡ä¸èƒ½é€šè¿‡ <code>new</code> è°ƒç”¨æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ ï¼Œåªèƒ½é€šè¿‡é™æ€æ–¹æ³•å®ä¾‹åŒ– <code>Buffer</code>ã€‚</p>
<p>è¿™é‡Œä»¥ <code>ByteBuffer </code>ä¸ºä¾‹è¿›è¡Œä»‹ç»ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// åˆ†é…å †å†…å­˜</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ByteBuffer allocate(<span style="color:#fff;font-weight:bold">int</span> capacity); 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ†é…ç›´æ¥å†…å­˜</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ByteBuffer allocateDirect(<span style="color:#fff;font-weight:bold">int</span> capacity); 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Buffer æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ol>
<li><code>get</code> : è¯»å–ç¼“å†²åŒºçš„æ•°æ®</li>
<li><code>put</code> ï¼šå‘ç¼“å†²åŒºå†™å…¥æ•°æ®</li>
</ol>
<p>é™¤ä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•ä¹‹å¤–ï¼Œå…¶ä»–çš„é‡è¦æ–¹æ³•ï¼š</p>
<ul>
<li><code>flip</code> ï¼šå°†ç¼“å†²åŒºä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œå®ƒä¼šå°† <code>limit</code> çš„å€¼è®¾ç½®ä¸ºå½“å‰ <code>position</code> çš„å€¼ï¼Œå°† <code>position</code> çš„å€¼è®¾ç½®ä¸º 0ã€‚</li>
<li><code>clear</code>: æ¸…ç©ºç¼“å†²åŒºï¼Œå°†ç¼“å†²åŒºä»è¯»æ¨¡å¼åˆ‡æ¢åˆ°å†™æ¨¡å¼ï¼Œå¹¶å°† <code>position</code> çš„å€¼è®¾ç½®ä¸º 0ï¼Œå°† <code>limit</code> çš„å€¼è®¾ç½®ä¸º <code>capacity</code> çš„å€¼ã€‚</li>
<li>&hellip;&hellip;</li>
</ul>
<p>Buffer ä¸­æ•°æ®å˜åŒ–çš„è¿‡ç¨‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.nio.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> CharBufferDemo {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ†é…ä¸€ä¸ªå®¹é‡ä¸º8çš„CharBuffer</span>
</span></span><span style="display:flex;"><span>        CharBuffer buffer = CharBuffer.<span style="color:#007f7f">allocate</span>(8);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;åˆå§‹çŠ¶æ€ï¼š&#34;</span>); 
</span></span><span style="display:flex;"><span>        printState(buffer); 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å‘bufferå†™å…¥3ä¸ªå­—ç¬¦</span>
</span></span><span style="display:flex;"><span>        buffer.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#39;a&#39;</span>).<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#39;b&#39;</span>).<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#39;c&#39;</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;å†™å…¥3ä¸ªå­—ç¬¦åçš„çŠ¶æ€ï¼š&#34;</span>);
</span></span><span style="display:flex;"><span>        printState(buffer);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è°ƒç”¨flip()æ–¹æ³•ï¼Œå‡†å¤‡è¯»å–bufferä¸­çš„æ•°æ®ï¼Œå°† position ç½® 0,limit çš„ç½® 3</span>
</span></span><span style="display:flex;"><span>        buffer.<span style="color:#007f7f">flip</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;è°ƒç”¨flip()æ–¹æ³•åçš„çŠ¶æ€ï¼š&#34;</span>);
</span></span><span style="display:flex;"><span>        printState(buffer);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¯»å–å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> (buffer.<span style="color:#007f7f">hasRemaining</span>()) { 
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>(buffer.<span style="color:#007f7f">get</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è°ƒç”¨clear()æ–¹æ³•ï¼Œæ¸…ç©ºç¼“å†²åŒºï¼Œå°† position çš„å€¼ç½®ä¸º 0ï¼Œå°† limit çš„å€¼ç½®ä¸º capacity çš„å€¼</span>
</span></span><span style="display:flex;"><span>        buffer.<span style="color:#007f7f">clear</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;è°ƒç”¨clear()æ–¹æ³•åçš„çŠ¶æ€ï¼š&#34;</span>);
</span></span><span style="display:flex;"><span>        printState(buffer);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ‰“å°bufferçš„capacityã€limitã€positionã€markçš„ä½ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> printState(CharBuffer buffer) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>(<span style="color:#0ff;font-weight:bold">&#34;capacity: &#34;</span> + buffer.<span style="color:#007f7f">capacity</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>(<span style="color:#0ff;font-weight:bold">&#34;, limit: &#34;</span> + buffer.<span style="color:#007f7f">limit</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>(<span style="color:#0ff;font-weight:bold">&#34;, position: &#34;</span> + buffer.<span style="color:#007f7f">position</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">print</span>(<span style="color:#0ff;font-weight:bold">&#34;, mark å¼€å§‹è¯»å–çš„å­—ç¬¦: &#34;</span> + buffer.<span style="color:#007f7f">mark</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å‡º:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>åˆå§‹çŠ¶æ€ï¼š
</span></span><span style="display:flex;"><span>capacity: 8, limit: 8, position: <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>å†™å…¥3ä¸ªå­—ç¬¦åçš„çŠ¶æ€ï¼š
</span></span><span style="display:flex;"><span>capacity: 8, limit: 8, position: <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>å‡†å¤‡è¯»å–bufferä¸­çš„æ•°æ®ï¼
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>è°ƒç”¨flip()æ–¹æ³•åçš„çŠ¶æ€ï¼š
</span></span><span style="display:flex;"><span>capacity: 8, limit: 3, position: <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>è¯»å–åˆ°çš„æ•°æ®ï¼šabc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>è°ƒç”¨clear()æ–¹æ³•åçš„çŠ¶æ€ï¼š
</span></span><span style="display:flex;"><span>capacity: 8, limit: 8, position: <span style="color:#ff0;font-weight:bold">0</span>   
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†å¸®åŠ©ç†è§£ï¼Œæˆ‘ç»˜åˆ¶äº†ä¸€å¼ å›¾ç‰‡å±•ç¤º <code>capacity</code>ã€<code>limit</code>å’Œ<code>position</code>æ¯ä¸€é˜¶æ®µçš„å˜åŒ–ã€‚</p>
<p><img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/12.png"></p>
<h3 id="channelé€šé“">Channelï¼ˆé€šé“ï¼‰<a hidden class="anchor" aria-hidden="true" href="#channelé€šé“">#</a></h3>
<p>Channel æ˜¯ä¸€ä¸ªé€šé“ï¼Œå®ƒå»ºç«‹äº†ä¸æ•°æ®æºï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œå¥—æ¥å­—ç­‰ï¼‰ä¹‹é—´çš„è¿æ¥ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥è¯»å–å’Œå†™å…¥æ•°æ®ï¼Œå°±åƒæ‰“å¼€äº†ä¸€æ¡è‡ªæ¥æ°´ç®¡ï¼Œè®©æ•°æ®åœ¨ Channel ä¸­è‡ªç”±æµåŠ¨ã€‚</p>
<p>BIO ä¸­çš„æµæ˜¯å•å‘çš„ï¼Œåˆ†ä¸ºå„ç§ <code>InputStream</code>ï¼ˆè¾“å…¥æµï¼‰å’Œ <code>OutputStream</code>ï¼ˆè¾“å‡ºæµï¼‰ï¼Œæ•°æ®åªæ˜¯åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šä¼ è¾“ã€‚é€šé“ä¸æµçš„ä¸åŒä¹‹å¤„åœ¨äºé€šé“æ˜¯åŒå‘çš„ï¼Œå®ƒå¯ä»¥ç”¨äºè¯»ã€å†™æˆ–è€…åŒæ—¶ç”¨äºè¯»å†™ã€‚</p>
<p>Channel ä¸å‰é¢ä»‹ç»çš„ Buffer æ‰“äº¤é“ï¼Œè¯»æ“ä½œçš„æ—¶å€™å°† Channel ä¸­çš„æ•°æ®å¡«å……åˆ° Bufferä¸­ï¼Œè€Œå†™æ“ä½œæ—¶å°† Bufferä¸­çš„æ•°æ®å†™å…¥åˆ° Channel ä¸­ã€‚</p>
<p><img alt="Channel å’Œ Bufferä¹‹é—´çš„å…³ç³»" loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/13.png"></p>
<p>å¦å¤–ï¼Œå› ä¸º Channel æ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ¯”æµæ›´å¥½åœ°æ˜ å°„åº•å±‚æ“ä½œç³»ç»Ÿçš„ APIã€‚ç‰¹åˆ«æ˜¯åœ¨ UNIX ç½‘ç»œç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œåº•å±‚æ“ä½œç³»ç»Ÿçš„é€šé“éƒ½æ˜¯å…¨åŒå·¥çš„ï¼ŒåŒæ—¶æ”¯æŒè¯»å†™æ“ä½œã€‚</p>
<p><code>Channel</code> çš„å­ç±»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img alt="Channel çš„å­ç±»" loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/14.png"></p>
<p>å…¶ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹çš„é€šé“ï¼š</p>
<ul>
<li><code>FileChannel</code>ï¼šæ–‡ä»¶è®¿é—®é€šé“ï¼›</li>
<li><code>SocketChannel</code>ã€<code>ServerSocketChannel</code>ï¼šTCPé€šä¿¡é€šé“ï¼›</li>
<li><code>DatagramChannel</code>ï¼šUDP é€šä¿¡é€šé“ï¼›</li>
</ul>
<p><img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/15.png"></p>
<p>Channel æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ol>
<li><code>read</code> ï¼šç”¨äºä» Buffer ä¸­è¯»å–æ•°æ®ï¼›</li>
<li><code>write</code> ï¼šå‘ Buffer ä¸­å†™å…¥æ•°æ®ã€‚</li>
</ol>
<p>è¿™é‡Œæˆ‘ä»¬ä»¥ <code>FileChannel</code> ä¸ºä¾‹æ¼”ç¤ºä¸€ä¸‹æ˜¯è¯»å–æ–‡ä»¶æ•°æ®çš„ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>RandomAccessFile reader = <span style="color:#fff;font-weight:bold">new</span> RandomAccessFile(<span style="color:#0ff;font-weight:bold">&#34;/Users/guide/Documents/test_read.in&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;r&#34;</span>)) 
</span></span><span style="display:flex;"><span>FileChannel channel = reader.<span style="color:#007f7f">getChannel</span>();
</span></span><span style="display:flex;"><span>ByteBuffer buffer = ByteBuffer.<span style="color:#007f7f">allocate</span>(1024);
</span></span><span style="display:flex;"><span>channel.<span style="color:#007f7f">read</span>(buffer);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="selectoré€‰æ‹©å™¨">Selectorï¼ˆé€‰æ‹©å™¨ï¼‰<a hidden class="anchor" aria-hidden="true" href="#selectoré€‰æ‹©å™¨">#</a></h3>
<p>Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ æ˜¯ NIOä¸­çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œå®ƒå…è®¸ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª Channelã€‚Selector æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„ I/O å¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œä¸»è¦è¿ä½œåŸç†æ˜¯ï¼šé€šè¿‡ Selector æ³¨å†Œé€šé“çš„äº‹ä»¶ï¼ŒSelector ä¼šä¸æ–­åœ°è½®è¯¢æ³¨å†Œåœ¨å…¶ä¸Šçš„ Channelã€‚å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ¯”å¦‚ï¼šæŸä¸ª Channelä¸Šé¢æœ‰æ–°çš„ TCP è¿æ¥æ¥å…¥ã€è¯»å’Œå†™äº‹ä»¶ï¼Œè¿™ä¸ª Channelå°±å¤„äºå°±ç»ªçŠ¶æ€ï¼Œä¼šè¢« Selector è½®è¯¢å‡ºæ¥ã€‚Selector ä¼šå°†ç›¸å…³çš„ ChannelåŠ å…¥åˆ°å°±ç»ªé›†åˆä¸­ã€‚é€šè¿‡ SelectionKeyå¯ä»¥è·å–å°±ç»ª Channelçš„é›†åˆï¼Œç„¶åå¯¹è¿™äº›å°±ç»ªçš„ Channelè¿›è¡Œå“åº”çš„ I/O æ“ä½œã€‚</p>
<p><img loading="lazy" src="/posts/interview/5_io%E9%9D%A2%E8%AF%95%E9%A2%98/16.png"></p>
<p>ä¸€ä¸ªå¤šè·¯å¤ç”¨å™¨ Selector å¯ä»¥åŒæ—¶è½®è¯¢å¤šä¸ª Channelï¼Œç”±äº JDKä½¿ç”¨äº† <code>epoll()</code> ä»£æ›¿ä¼ ç»Ÿçš„ <code>select</code> å®ç°ï¼Œæ‰€ä»¥å®ƒå¹¶æ²¡æœ‰æœ€å¤§è¿æ¥å¥æŸ„ <code>1024/2048</code> çš„é™åˆ¶ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€åªéœ€è¦ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ Selector çš„è½®è¯¢ï¼Œå°±å¯ä»¥æ¥å…¥æˆåƒä¸Šä¸‡çš„å®¢æˆ·ç«¯ã€‚</p>
<p>Selector å¯ä»¥ç›‘å¬ä»¥ä¸‹å››ç§äº‹ä»¶ç±»å‹ï¼š</p>
<ol>
<li><code>SelectionKey.OP_ACCEPT</code>ï¼šè¡¨ç¤ºé€šé“æ¥å—è¿æ¥çš„äº‹ä»¶ï¼Œè¿™é€šå¸¸ç”¨äº <code>ServerSocketChannel</code>ã€‚</li>
<li><code>SelectionKey.OP_CONNECT</code>ï¼šè¡¨ç¤ºé€šé“å®Œæˆè¿æ¥çš„äº‹ä»¶ï¼Œè¿™é€šå¸¸ç”¨äº <code>SocketChannel</code>ã€‚</li>
<li><code>SelectionKey.OP_READ</code>ï¼šè¡¨ç¤ºé€šé“å‡†å¤‡å¥½è¿›è¡Œè¯»å–çš„äº‹ä»¶ï¼Œå³æœ‰æ•°æ®å¯è¯»ã€‚</li>
<li><code>SelectionKey.OP_WRITE</code>ï¼šè¡¨ç¤ºé€šé“å‡†å¤‡å¥½è¿›è¡Œå†™å…¥çš„äº‹ä»¶ï¼Œå³å¯ä»¥å†™å…¥æ•°æ®ã€‚</li>
</ol>
<p><code>Selector </code>æ˜¯æŠ½è±¡ç±»ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨æ­¤ç±»çš„ <code>open()</code> é™æ€æ–¹æ³•æ¥åˆ›å»º Selector å®ä¾‹ã€‚Selector å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ª <code>SelectableChannel</code> çš„ <code>IO</code> çŠ¶å†µï¼Œæ˜¯éé˜»å¡ <code>IO</code> çš„æ ¸å¿ƒã€‚</p>
<p>ä¸€ä¸ªSelector å®ä¾‹æœ‰ä¸‰ä¸ª <code>SelectionKey</code> é›†åˆï¼š</p>
<ol>
<li>æ‰€æœ‰çš„ <code>SelectionKey</code> é›†åˆï¼šä»£è¡¨äº†æ³¨å†Œåœ¨è¯¥ Selector ä¸Šçš„ <code>Channel</code>ï¼Œè¿™ä¸ªé›†åˆå¯ä»¥é€šè¿‡ <code>keys()</code> æ–¹æ³•è¿”å›ã€‚</li>
<li>è¢«é€‰æ‹©çš„ <code>SelectionKey</code> é›†åˆï¼šä»£è¡¨äº†æ‰€æœ‰å¯é€šè¿‡ <code>select()</code> æ–¹æ³•è·å–çš„ã€éœ€è¦è¿›è¡Œ <code>IO</code> å¤„ç†çš„ Channelï¼Œè¿™ä¸ªé›†åˆå¯ä»¥é€šè¿‡ <code>selectedKeys()</code> è¿”å›ã€‚</li>
<li>è¢«å–æ¶ˆçš„ <code>SelectionKey</code> é›†åˆï¼šä»£è¡¨äº†æ‰€æœ‰è¢«å–æ¶ˆæ³¨å†Œå…³ç³»çš„ <code>Channel</code>ï¼Œåœ¨ä¸‹ä¸€æ¬¡æ‰§è¡Œ <code>select()</code> æ–¹æ³•æ—¶ï¼Œè¿™äº› <code>Channel</code> å¯¹åº”çš„ <code>SelectionKey</code> ä¼šè¢«å½»åº•åˆ é™¤ï¼Œç¨‹åºé€šå¸¸æ— é¡»ç›´æ¥è®¿é—®è¯¥é›†åˆï¼Œä¹Ÿæ²¡æœ‰æš´éœ²è®¿é—®çš„æ–¹æ³•ã€‚</li>
</ol>
<p>ç®€å•æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•éå†è¢«é€‰æ‹©çš„ <code>SelectionKey</code> é›†åˆå¹¶è¿›è¡Œå¤„ç†ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Set&lt;SelectionKey&gt; selectedKeys = selector.<span style="color:#007f7f">selectedKeys</span>();
</span></span><span style="display:flex;"><span>Iterator&lt;SelectionKey&gt; keyIterator = selectedKeys.<span style="color:#007f7f">iterator</span>();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">while</span> (keyIterator.<span style="color:#007f7f">hasNext</span>()) {
</span></span><span style="display:flex;"><span>    SelectionKey key = keyIterator.<span style="color:#007f7f">next</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (key != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (key.<span style="color:#007f7f">isAcceptable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// ServerSocketChannel æ¥æ”¶äº†ä¸€ä¸ªæ–°è¿æ¥</span>
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (key.<span style="color:#007f7f">isConnectable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è¡¨ç¤ºä¸€ä¸ªæ–°è¿æ¥å»ºç«‹</span>
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (key.<span style="color:#007f7f">isReadable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Channel æœ‰å‡†å¤‡å¥½çš„æ•°æ®ï¼Œå¯ä»¥è¯»å–</span>
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (key.<span style="color:#007f7f">isWritable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Channel æœ‰ç©ºé—²çš„ Bufferï¼Œå¯ä»¥å†™å…¥æ•°æ®</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    keyIterator.<span style="color:#007f7f">remove</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Selector è¿˜æä¾›äº†ä¸€ç³»åˆ—å’Œ <code>select()</code> ç›¸å…³çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>int select()</code>ï¼šç›‘æ§æ‰€æœ‰æ³¨å†Œçš„ <code>Channel</code>ï¼Œå½“å®ƒä»¬ä¸­é—´æœ‰éœ€è¦å¤„ç†çš„ <code>IO</code> æ“ä½œæ—¶ï¼Œè¯¥æ–¹æ³•è¿”å›ï¼Œå¹¶å°†å¯¹åº”çš„ <code>SelectionKey</code> åŠ å…¥è¢«é€‰æ‹©çš„ <code>SelectionKey</code> é›†åˆä¸­ï¼Œè¯¥æ–¹æ³•è¿”å›è¿™äº› <code>Channel</code> çš„æ•°é‡ã€‚</li>
<li><code>int select(long timeout)</code>ï¼šå¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é•¿çš„ <code>select()</code> æ“ä½œã€‚</li>
<li><code>int selectNow()</code>ï¼šæ‰§è¡Œä¸€ä¸ªç«‹å³è¿”å›çš„ <code>select()</code> æ“ä½œï¼Œç›¸å¯¹äºæ— å‚æ•°çš„ <code>select()</code> æ–¹æ³•è€Œè¨€ï¼Œè¯¥æ–¹æ³•ä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚</li>
<li><code>Selector wakeup()</code>ï¼šä½¿ä¸€ä¸ªè¿˜æœªè¿”å›çš„ <code>select()</code> æ–¹æ³•ç«‹åˆ»è¿”å›ã€‚</li>
<li>&hellip;&hellip;</li>
</ul>
<p>ä½¿ç”¨ Selector å®ç°ç½‘ç»œè¯»å†™çš„ç®€å•ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.net.InetSocketAddress;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.nio.ByteBuffer;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.nio.channels.SelectionKey;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.nio.channels.Selector;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.nio.channels.ServerSocketChannel;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.nio.channels.SocketChannel;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Iterator;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Set;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> NioSelectorExample {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>      ServerSocketChannel serverSocketChannel = ServerSocketChannel.<span style="color:#007f7f">open</span>();
</span></span><span style="display:flex;"><span>      serverSocketChannel.<span style="color:#007f7f">configureBlocking</span>(<span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>      serverSocketChannel.<span style="color:#007f7f">socket</span>().<span style="color:#007f7f">bind</span>(<span style="color:#fff;font-weight:bold">new</span> InetSocketAddress(8080));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      Selector selector = Selector.<span style="color:#007f7f">open</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// å°† ServerSocketChannel æ³¨å†Œåˆ° Selector å¹¶ç›‘å¬ OP_ACCEPT äº‹ä»¶</span>
</span></span><span style="display:flex;"><span>      serverSocketChannel.<span style="color:#007f7f">register</span>(selector, SelectionKey.<span style="color:#007f7f">OP_ACCEPT</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">while</span> (<span style="color:#fff;font-weight:bold">true</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> readyChannels = selector.<span style="color:#007f7f">select</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (readyChannels == 0) {
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">continue</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Set&lt;SelectionKey&gt; selectedKeys = selector.<span style="color:#007f7f">selectedKeys</span>();
</span></span><span style="display:flex;"><span>        Iterator&lt;SelectionKey&gt; keyIterator = selectedKeys.<span style="color:#007f7f">iterator</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> (keyIterator.<span style="color:#007f7f">hasNext</span>()) {
</span></span><span style="display:flex;"><span>          SelectionKey key = keyIterator.<span style="color:#007f7f">next</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">if</span> (key.<span style="color:#007f7f">isAcceptable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¤„ç†è¿æ¥äº‹ä»¶</span>
</span></span><span style="display:flex;"><span>            ServerSocketChannel server = (ServerSocketChannel) key.<span style="color:#007f7f">channel</span>();
</span></span><span style="display:flex;"><span>            SocketChannel client = server.<span style="color:#007f7f">accept</span>();
</span></span><span style="display:flex;"><span>            client.<span style="color:#007f7f">configureBlocking</span>(<span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å°†å®¢æˆ·ç«¯é€šé“æ³¨å†Œåˆ° Selector å¹¶ç›‘å¬ OP_READ äº‹ä»¶</span>
</span></span><span style="display:flex;"><span>            client.<span style="color:#007f7f">register</span>(selector, SelectionKey.<span style="color:#007f7f">OP_READ</span>);
</span></span><span style="display:flex;"><span>          } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (key.<span style="color:#007f7f">isReadable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¤„ç†è¯»äº‹ä»¶</span>
</span></span><span style="display:flex;"><span>            SocketChannel client = (SocketChannel) key.<span style="color:#007f7f">channel</span>();
</span></span><span style="display:flex;"><span>            ByteBuffer buffer = ByteBuffer.<span style="color:#007f7f">allocate</span>(1024);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> bytesRead = client.<span style="color:#007f7f">read</span>(buffer);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (bytesRead &gt; 0) {
</span></span><span style="display:flex;"><span>              buffer.<span style="color:#007f7f">flip</span>();
</span></span><span style="display:flex;"><span>              System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ”¶åˆ°æ•°æ®ï¼š&#34;</span> +<span style="color:#fff;font-weight:bold">new</span> String(buffer.<span style="color:#007f7f">array</span>(), 0, bytesRead));
</span></span><span style="display:flex;"><span>              <span style="color:#007f7f">// å°†å®¢æˆ·ç«¯é€šé“æ³¨å†Œåˆ° Selector å¹¶ç›‘å¬ OP_WRITE äº‹ä»¶</span>
</span></span><span style="display:flex;"><span>              client.<span style="color:#007f7f">register</span>(selector, SelectionKey.<span style="color:#007f7f">OP_WRITE</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (bytesRead &lt; 0) {
</span></span><span style="display:flex;"><span>              <span style="color:#007f7f">// å®¢æˆ·ç«¯æ–­å¼€è¿æ¥</span>
</span></span><span style="display:flex;"><span>              client.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (key.<span style="color:#007f7f">isWritable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¤„ç†å†™äº‹ä»¶</span>
</span></span><span style="display:flex;"><span>            SocketChannel client = (SocketChannel) key.<span style="color:#007f7f">channel</span>();
</span></span><span style="display:flex;"><span>            ByteBuffer buffer = ByteBuffer.<span style="color:#007f7f">wrap</span>(<span style="color:#0ff;font-weight:bold">&#34;Hello, Client!&#34;</span>.<span style="color:#007f7f">getBytes</span>());
</span></span><span style="display:flex;"><span>            client.<span style="color:#007f7f">write</span>(buffer);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å°†å®¢æˆ·ç«¯é€šé“æ³¨å†Œåˆ° Selector å¹¶ç›‘å¬ OP_READ äº‹ä»¶</span>
</span></span><span style="display:flex;"><span>            client.<span style="color:#007f7f">register</span>(selector, SelectionKey.<span style="color:#007f7f">OP_READ</span>);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          keyIterator.<span style="color:#007f7f">remove</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>      e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œç›‘å¬8080ç«¯å£ï¼Œä½¿ç”¨ Selector å¤„ç†è¿æ¥ã€è¯»å–å’Œå†™å…¥äº‹ä»¶ã€‚å½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨å°†è¯»å–æ•°æ®å¹¶å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ï¼Œç„¶åå‘å®¢æˆ·ç«¯å›å¤ &ldquo;Hello, Client!&quot;ã€‚</p>
<h2 id="nio-é›¶æ‹·è´">NIO é›¶æ‹·è´<a hidden class="anchor" aria-hidden="true" href="#nio-é›¶æ‹·è´">#</a></h2>
<p>é›¶æ‹·è´æ˜¯æå‡ IO æ“ä½œæ€§èƒ½çš„ä¸€ä¸ªå¸¸ç”¨æ‰‹æ®µï¼Œåƒ ActiveMQã€Kafka ã€RocketMQã€QMQã€Netty ç­‰é¡¶çº§å¼€æºé¡¹ç›®éƒ½ç”¨åˆ°äº†é›¶æ‹·è´ã€‚</p>
<p>é›¶æ‹·è´æ˜¯æŒ‡è®¡ç®—æœºæ‰§è¡Œ IO æ“ä½œæ—¶ï¼ŒCPU ä¸éœ€è¦å°†æ•°æ®ä»ä¸€ä¸ªå­˜å‚¨åŒºåŸŸå¤åˆ¶åˆ°å¦ä¸€ä¸ªå­˜å‚¨åŒºåŸŸï¼Œä»è€Œå¯ä»¥å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ä»¥åŠ CPU çš„æ‹·è´æ—¶é—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé›¶æ‹·è´ä¸»ä¸»è¦è§£å†³æ“ä½œç³»ç»Ÿåœ¨å¤„ç† I/O æ“ä½œæ—¶é¢‘ç¹å¤åˆ¶æ•°æ®çš„é—®é¢˜ã€‚é›¶æ‹·è´çš„å¸¸è§å®ç°æŠ€æœ¯æœ‰ï¼š <code>mmap+write</code>ã€<code>sendfile</code>å’Œ <code>sendfile + DMA gather copy</code> ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº†å„ç§é›¶æ‹·è´æŠ€æœ¯çš„å¯¹æ¯”å›¾ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>CPU æ‹·è´</th>
<th>DMA æ‹·è´</th>
<th>ç³»ç»Ÿè°ƒç”¨</th>
<th>ä¸Šä¸‹æ–‡åˆ‡æ¢</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¼ ç»Ÿæ–¹æ³•</td>
<td>2</td>
<td>2</td>
<td>read+write</td>
<td>4</td>
</tr>
<tr>
<td>mmap+write</td>
<td>1</td>
<td>2</td>
<td>mmap+write</td>
<td>4</td>
</tr>
<tr>
<td>sendfile</td>
<td>1</td>
<td>2</td>
<td>sendfile</td>
<td>2</td>
</tr>
<tr>
<td>sendfile + DMA gather copy</td>
<td>0</td>
<td>2</td>
<td>sendfile</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºæ˜¯ä¼ ç»Ÿçš„ I/O æ–¹å¼ï¼Œè¿˜æ˜¯å¼•å…¥äº†é›¶æ‹·è´ä¹‹åï¼Œ2 æ¬¡ DMA(Direct Memory Access) æ‹·è´æ˜¯éƒ½å°‘ä¸äº†çš„ã€‚å› ä¸ºä¸¤æ¬¡ DMA éƒ½æ˜¯ä¾èµ–ç¡¬ä»¶å®Œæˆçš„ã€‚é›¶æ‹·è´ä¸»è¦æ˜¯å‡å°‘äº† CPU æ‹·è´åŠä¸Šä¸‹æ–‡çš„åˆ‡æ¢ã€‚</p>
<p>Java å¯¹é›¶æ‹·è´çš„æ”¯æŒï¼š</p>
<ul>
<li><code>MappedByteBuffer</code> æ˜¯ NIO åŸºäºå†…å­˜æ˜ å°„ï¼ˆ<code>mmap</code>ï¼‰è¿™ç§é›¶æ‹·â»‰â½…å¼çš„æä¾›çš„â¼€ç§å®ç°ï¼Œåº•å±‚å®é™…æ˜¯è°ƒç”¨äº† Linux å†…æ ¸çš„ <code>mmap</code> ç³»ç»Ÿè°ƒç”¨ã€‚å®ƒå¯ä»¥å°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œå½¢æˆä¸€ä¸ªè™šæ‹Ÿå†…å­˜æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥æ“ä½œå†…å­˜ä¸­çš„æ•°æ®ï¼Œè€Œä¸éœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥è¯»å†™æ–‡ä»¶ã€‚</li>
<li><code>FileChannel</code> çš„<code>transferTo()/transferFrom()</code>æ˜¯ NIO åŸºäºå‘é€æ–‡ä»¶ï¼ˆ<code>sendfile</code>ï¼‰è¿™ç§é›¶æ‹·è´æ–¹å¼çš„æä¾›çš„ä¸€ç§å®ç°ï¼Œåº•å±‚å®é™…æ˜¯è°ƒç”¨äº† Linux å†…æ ¸çš„ <code>sendfile</code>ç³»ç»Ÿè°ƒç”¨ã€‚å®ƒå¯ä»¥ç›´æ¥å°†æ–‡ä»¶æ•°æ®ä»ç£ç›˜å‘é€åˆ°ç½‘ç»œï¼Œè€Œä¸éœ€è¦ç»è¿‡ç”¨æˆ·ç©ºé—´çš„ç¼“å†²åŒºã€‚å…³äº<code>FileChannel</code>çš„ç”¨æ³•å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.cnblogs.com/robothy/p/14235598.html">Java NIO æ–‡ä»¶é€šé“ FileChannel ç”¨æ³•</a>ã€‚</li>
</ul>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> loadFileIntoMemory(File xmlFile) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    FileInputStream fis = <span style="color:#fff;font-weight:bold">new</span> FileInputStream(xmlFile);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ›å»º FileChannel å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>    FileChannel fc = fis.<span style="color:#007f7f">getChannel</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// FileChannle.map() å°†æ–‡ä»¶æ˜ å°„åˆ°ç›´æ¥å†…å­˜å¹¶è¿”å› MappedByteBuffer å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>    MappedByteBuffer mmb = fc.<span style="color:#007f7f">map</span>(FileChannel.<span style="color:#007f7f">MapMode</span>.<span style="color:#007f7f">READ_ONLY</span>, 0, fc.<span style="color:#007f7f">size</span>());
</span></span><span style="display:flex;"><span>    xmlFileBuffer = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[(<span style="color:#fff;font-weight:bold">int</span>)fc.<span style="color:#007f7f">size</span>()];
</span></span><span style="display:flex;"><span>    mmb.<span style="color:#007f7f">get</span>(xmlFileBuffer);
</span></span><span style="display:flex;"><span>    fis.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/interview/">Interview</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>