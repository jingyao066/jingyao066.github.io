<!DOCTYPE html>
<html lang="en" dir="auto">

<head>
    
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;Â»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      3_multithreading-wait&#43;notify
    </h1>
    <div class="post-meta"><span title='2019-03-25 15:04:27 +0000 UTC'>2019-03-25</span>&nbsp;Â·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#wait-notify-notifyall%e7%ad%89%e6%96%b9%e6%b3%95%e4%bb%8b%e7%bb%8d" aria-label="wait(), notify(), notifyAll()ç­‰æ–¹æ³•ä»‹ç»">wait(), notify(), notifyAll()ç­‰æ–¹æ³•ä»‹ç»</a></li>
                <li>
                    <a href="#wait%e5%92%8cnotify%e7%a4%ba%e4%be%8b" aria-label="wait()å’Œnotify()ç¤ºä¾‹">wait()å’Œnotify()ç¤ºä¾‹</a></li>
                <li>
                    <a href="#waitlong-timeout%e5%92%8cnotify" aria-label="wait(long timeout)å’Œnotify()">wait(long timeout)å’Œnotify()</a></li>
                <li>
                    <a href="#wait%e5%92%8cnotifyall" aria-label="wait()å’ŒnotifyAll()">wait()å’ŒnotifyAll()</a></li>
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88notify-wait%e7%ad%89%e5%87%bd%e6%95%b0%e5%ae%9a%e4%b9%89%e5%9c%a8object%e4%b8%ad%e8%80%8c%e4%b8%8d%e6%98%afthread%e4%b8%ad" aria-label="ä¸ºä»€ä¹ˆnotify(), wait()ç­‰å‡½æ•°å®šä¹‰åœ¨Objectä¸­ï¼Œè€Œä¸æ˜¯Threadä¸­">ä¸ºä»€ä¹ˆnotify(), wait()ç­‰å‡½æ•°å®šä¹‰åœ¨Objectä¸­ï¼Œè€Œä¸æ˜¯Threadä¸­</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>æœ¬ç« å¯¹çº¿ç¨‹çš„ç­‰å¾…/å”¤é†’æ–¹æ³•è¿›è¡Œä»‹ç»ã€‚</p>
<h1 id="wait-notify-notifyallç­‰æ–¹æ³•ä»‹ç»">wait(), notify(), notifyAll()ç­‰æ–¹æ³•ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#wait-notify-notifyallç­‰æ–¹æ³•ä»‹ç»">#</a></h1>
<p>åœ¨Objectç±»ä¸­ï¼Œå®šä¹‰äº†wait()ï¼Œnotify()å’ŒnotifyAll()ç­‰æ¥å£ã€‚wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒåŒæ—¶wait()ä¹Ÿä¼šè®©å½“å‰çº¿ç¨‹é‡Šæ”¾å®ƒæŒæœ‰çš„é”ã€‚è€Œnotify()å’ŒnotifyAll()çš„ä½œç”¨ï¼Œåˆ™æ˜¯å”¤é†’å½“å‰å¯¹è±¡ä¸Šçš„ç­‰å¾…çº¿ç¨‹ï¼Œnotify()æ˜¯å”¤é†’å•ä¸ªçº¿ç¨‹ï¼ŒnotifyAll()æ˜¯å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚</p>
<p>wait()ï¼Œnotify()å¿…é¡»å’Œ synchronized é…åˆä½¿ç”¨ã€‚</p>
<p>Objectç±»ä¸­å…³äºç­‰å¾…/å”¤é†’çš„APIè¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>notify()ï¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚</li>
<li>notifyAll()ï¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚</li>
<li>wait()ï¼šè®©å½“å‰çº¿ç¨‹å¤„äº<code>ç­‰å¾…(é˜»å¡)çŠ¶æ€</code>ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„notify()æ–¹æ³•æˆ–notifyAll() æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥<code>å°±ç»ªçŠ¶æ€</code>)ã€‚</li>
<li>wait(long timeout)ï¼šè®©å½“å‰çº¿ç¨‹å¤„äº<code>ç­‰å¾…(é˜»å¡)çŠ¶æ€</code>ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•ï¼Œæˆ–è€…è¶…è¿‡æŒ‡å®šçš„æ—¶é—´é‡ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥<code>å°±ç»ªçŠ¶æ€</code>)ã€‚</li>
<li>wait(long timeout, int nanos)ï¼šè®©å½“å‰çº¿ç¨‹å¤„äº<code>ç­‰å¾…(é˜»å¡)çŠ¶æ€</code>ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•ï¼Œæˆ–è€…å…¶ä»–æŸä¸ªçº¿ç¨‹ä¸­æ–­å½“å‰çº¿ç¨‹ï¼Œæˆ–è€…å·²è¶…è¿‡æŸä¸ªå®é™…æ—¶é—´é‡ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥<code>å°±ç»ªçŠ¶æ€</code>)ã€‚</li>
</ul>
<h1 id="waitå’Œnotifyç¤ºä¾‹">wait()å’Œnotify()ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#waitå’Œnotifyç¤ºä¾‹">#</a></h1>
<p>ä¸‹é¢é€šè¿‡ç¤ºä¾‹æ¼”ç¤ºwait()å’Œnotify()é…åˆä½¿ç”¨çš„æƒ…å½¢</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// WaitTest.javaçš„æºç </span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> ThreadA <span style="color:#fff;font-weight:bold">extends</span> Thread{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ThreadA(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(name);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">synchronized</span> (<span style="color:#fff;font-weight:bold">this</span>) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34; call notify()&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å”¤é†’å½“å‰çš„waitçº¿ç¨‹</span>
</span></span><span style="display:flex;"><span>            notify();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WaitTest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        ThreadA t1 = <span style="color:#fff;font-weight:bold">new</span> ThreadA(<span style="color:#0ff;font-weight:bold">&#34;t1&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">synchronized</span>(t1) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å¯åŠ¨â€œçº¿ç¨‹t1â€</span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34; start t1&#34;</span>);
</span></span><span style="display:flex;"><span>                t1.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// ä¸»çº¿ç¨‹ç­‰å¾…t1é€šè¿‡notify()å”¤é†’ã€‚</span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34; wait()&#34;</span>);
</span></span><span style="display:flex;"><span>                t1.<span style="color:#007f7f">wait</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34; continue&#34;</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>main start t1
</span></span><span style="display:flex;"><span>main wait()
</span></span><span style="display:flex;"><span>t1 call notify()
</span></span><span style="display:flex;"><span>main continue
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœè¯´æ˜ï¼š
å¦‚ä¸‹å›¾ï¼Œè¯´æ˜äº†<code>ä¸»çº¿ç¨‹å’Œçº¿ç¨‹t1</code>çš„æµç¨‹ã€‚</p>
<ul>
<li>å›¾ä¸­ä¸»çº¿ç¨‹ä»£è¡¨<code>ä¸»çº¿ç¨‹main</code>ã€‚<code>çº¿ç¨‹t1</code>ä»£è¡¨WaitTestä¸­å¯åŠ¨çš„<code>çº¿ç¨‹t1</code>ã€‚ è€Œ<code>é”</code>ä»£è¡¨<code>t1è¿™ä¸ªå¯¹è±¡çš„åŒæ­¥é”</code>ã€‚</li>
<li><code>ä¸»çº¿ç¨‹</code>é€šè¿‡<code>new ThreadA(&quot;t1&quot;)</code>æ–°å»º<code>çº¿ç¨‹t1</code>ã€‚éšåé€šè¿‡<code>synchronized(t1)</code>è·å–<code>t1å¯¹è±¡çš„åŒæ­¥é”</code>ã€‚ç„¶åè°ƒç”¨<code>t1.start()</code>å¯åŠ¨<code>çº¿ç¨‹t1</code>ã€‚</li>
<li><code>ä¸»çº¿ç¨‹</code>æ‰§è¡Œ<code>t1.wait()</code>é‡Šæ”¾<code>t1å¯¹è±¡çš„é”</code>å¹¶ä¸”è¿›å…¥<code>ç­‰å¾…(é˜»å¡)çŠ¶æ€</code>ã€‚ç­‰å¾…t1å¯¹è±¡ä¸Šçš„çº¿ç¨‹é€šè¿‡notify() æˆ– notifyAll()å°†å…¶å”¤é†’ã€‚</li>
<li><code>çº¿ç¨‹t1</code>è¿è¡Œä¹‹åï¼Œé€šè¿‡<code>synchronized(this)</code>è·å–<code>å½“å‰å¯¹è±¡çš„é”</code>ï¼›æ¥ç€è°ƒç”¨notify()å”¤é†’<code>å½“å‰å¯¹è±¡ä¸Šçš„ç­‰å¾…çº¿ç¨‹</code>ï¼Œä¹Ÿå°±æ˜¯å”¤é†’<code>ä¸»çº¿ç¨‹</code>ã€‚</li>
<li><code>çº¿ç¨‹t1</code>è¿è¡Œå®Œæ¯•ä¹‹åï¼Œé‡Šæ”¾<code>å½“å‰å¯¹è±¡çš„é”</code>ã€‚ç´§æ¥ç€ï¼Œ<code>ä¸»çº¿ç¨‹</code>è·å–<code>t1å¯¹è±¡çš„é”</code>ï¼Œç„¶åæ¥ç€è¿è¡Œã€‚</li>
</ul>
<p><img loading="lazy" src="/posts/%E5%A4%9A%E7%BA%BF%E7%A8%8B/3_multithreading-wait+notify/1.png"></p>
<p><code>t1.wait()</code>åº”è¯¥æ˜¯è®©<code>çº¿ç¨‹t1</code>ç­‰å¾…ï¼Œä¸ºä»€ä¹ˆå´æ˜¯è®©<code>ä¸»çº¿ç¨‹main</code>ç­‰å¾…äº†å‘¢ï¼Ÿè¯·çœ‹jdkæ–‡æ¡£ä¸­å…³äºwaitçš„ä¸€æ®µä»‹ç»ï¼š
Causes the current thread to wait until another thread invokes the notify() method or the notifyAll() method for this object.
In other words, this method behaves exactly as if it simply performs the call wait(0).
The current thread must own this object&rsquo;s monitor. The thread releases ownership of this monitor and waits until another thread notifies threads waiting on this object&rsquo;s monitor to wake up either through a call to the notify method or the notifyAll method. The thread then waits until it can re-obtain ownership of the monitor and resumes execution.</p>
<p>waitæ–¹æ³•ä¼šå¼•èµ·<code>å½“å‰çº¿ç¨‹</code>ç­‰å¾…ï¼Œç›´åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨notify()æˆ–notifyAll()å”¤é†’è¯¥çº¿ç¨‹ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å’Œwait(0)çš„æ•ˆæœä¸€æ ·ï¼(è¡¥å……ï¼Œå¯¹äºwait(long millis)æ–¹æ³•ï¼Œå½“millisä¸º0æ—¶ï¼Œè¡¨ç¤ºæ— é™ç­‰å¾…ï¼Œç›´åˆ°è¢«notify()æˆ–notifyAll()å”¤é†’)ã€‚
<code>å½“å‰çº¿ç¨‹</code>åœ¨è°ƒç”¨<code>wait()</code>æ—¶ï¼Œå¿…é¡»æ‹¥æœ‰è¯¥å¯¹è±¡çš„åŒæ­¥é”ã€‚è¯¥çº¿ç¨‹è°ƒç”¨<code>wait()</code>ä¹‹åï¼Œä¼šé‡Šæ”¾è¯¥é”ï¼›ç„¶åä¸€ç›´ç­‰å¾…ç›´åˆ°<code>å…¶å®ƒçº¿ç¨‹</code>è°ƒç”¨å¯¹è±¡çš„åŒæ­¥é”çš„notify()æˆ–notifyAll()æ–¹æ³•ã€‚ç„¶åï¼Œè¯¥çº¿ç¨‹ç»§ç»­ç­‰å¾…ç›´åˆ°å®ƒé‡æ–°è·å–<code>è¯¥å¯¹è±¡çš„åŒæ­¥é”</code>ï¼Œç„¶åå°±å¯ä»¥æ¥ç€è¿è¡Œã€‚
æ³¨æ„ï¼š<strong>jdkçš„è§£é‡Šä¸­ï¼Œè¯´wait()çš„ä½œç”¨æ˜¯è®©<code>å½“å‰çº¿ç¨‹</code>ç­‰å¾…ï¼Œè€Œ<code>å½“å‰çº¿ç¨‹</code>æ˜¯æŒ‡æ­£åœ¨cpuä¸Šè¿è¡Œçš„çº¿ç¨‹ã€‚</strong>
è¿™ä¹Ÿæ„å‘³ç€ï¼Œè™½ç„¶<code>t1.wait()</code>æ˜¯é€šè¿‡<code>çº¿ç¨‹t1</code>è°ƒç”¨çš„<code>wait()</code>æ–¹æ³•ï¼Œä½†æ˜¯è°ƒç”¨<code>t1.wait()</code>çš„åœ°æ–¹æ˜¯åœ¨<code>ä¸»çº¿ç¨‹main</code>ä¸­ã€‚è€Œä¸»çº¿ç¨‹å¿…é¡»æ˜¯<code>å½“å‰çº¿ç¨‹</code>ï¼Œä¹Ÿå°±æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œæ‰å¯ä»¥æ‰§è¡Œ<code>t1.wait()</code>ã€‚æ‰€ä»¥ï¼Œæ­¤æ—¶çš„<code>å½“å‰çº¿ç¨‹</code>æ˜¯<code>ä¸»çº¿ç¨‹main</code>ï¼å› æ­¤ï¼Œ<code>t1.wait()</code>æ˜¯è®©<code>ä¸»çº¿ç¨‹</code>ç­‰å¾…ï¼Œè€Œä¸æ˜¯<code>çº¿ç¨‹t1</code>ã€‚</p>
<h1 id="waitlong-timeoutå’Œnotify">wait(long timeout)å’Œnotify()<a hidden class="anchor" aria-hidden="true" href="#waitlong-timeoutå’Œnotify">#</a></h1>
<p><code>wait(long timeout)</code>ä¼šè®©å½“å‰çº¿ç¨‹å¤„äº<code>ç­‰å¾…(é˜»å¡)çŠ¶æ€</code>ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•ï¼Œæˆ–è€…è¶…è¿‡æŒ‡å®šçš„æ—¶é—´é‡ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥<code>å°±ç»ªçŠ¶æ€</code>)ã€‚
ä¸‹é¢çš„ç¤ºä¾‹å°±æ˜¯æ¼”ç¤º<code>wait(long timeout)</code>åœ¨è¶…æ—¶æƒ…å†µä¸‹ï¼Œçº¿ç¨‹è¢«å”¤é†’çš„æƒ…å†µã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// WaitTimeoutTest.javaçš„æºç </span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadA <span style="color:#fff;font-weight:bold">extends</span> Thread{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ThreadA(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(name);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34; run &#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ­»å¾ªç¯ï¼Œä¸æ–­è¿è¡Œã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span>(<span style="color:#fff;font-weight:bold">true</span>)
</span></span><span style="display:flex;"><span>            ;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WaitTimeoutTest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        ThreadA t1 = <span style="color:#fff;font-weight:bold">new</span> ThreadA(<span style="color:#0ff;font-weight:bold">&#34;t1&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">synchronized</span>(t1) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å¯åŠ¨â€œçº¿ç¨‹t1â€</span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34; start t1&#34;</span>);
</span></span><span style="display:flex;"><span>                t1.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// ä¸»çº¿ç¨‹ç­‰å¾…t1é€šè¿‡notify()å”¤é†’ æˆ– notifyAll()å”¤é†’ï¼Œæˆ–è¶…è¿‡3000mså»¶æ—¶ï¼›ç„¶åæ‰è¢«å”¤é†’ã€‚</span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34; call wait &#34;</span>);
</span></span><span style="display:flex;"><span>                t1.<span style="color:#007f7f">wait</span>(3000);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34; continue&#34;</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>main start t1
</span></span><span style="display:flex;"><span>main call wait 
</span></span><span style="display:flex;"><span>t1 run                  // å¤§çº¦3ç§’ä¹‹å...è¾“å‡ºâ€œmain continueâ€
</span></span><span style="display:flex;"><span>main continue
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœè¯´æ˜ï¼š
å¦‚ä¸‹å›¾ï¼Œè¯´æ˜äº†<code>ä¸»çº¿ç¨‹å’Œçº¿ç¨‹t1</code>çš„æµç¨‹ã€‚</p>
<ul>
<li>å›¾ä¸­<code>ä¸»çº¿ç¨‹</code>ä»£è¡¨WaitTimeoutTestä¸»çº¿ç¨‹(å³ï¼Œçº¿ç¨‹main)ã€‚<code>çº¿ç¨‹t1</code>ä»£è¡¨WaitTestä¸­å¯åŠ¨çš„çº¿ç¨‹t1ã€‚ è€Œ<code>é”</code>ä»£è¡¨<code>t1è¿™ä¸ªå¯¹è±¡çš„åŒæ­¥é”</code>ã€‚</li>
<li>ä¸»çº¿ç¨‹mainæ‰§è¡Œ<code>t1.start()</code>å¯åŠ¨<code>çº¿ç¨‹t1</code>ã€‚</li>
<li>ä¸»çº¿ç¨‹mainæ‰§è¡Œ<code>t1.wait(3000)</code>ï¼Œæ­¤æ—¶ï¼Œä¸»çº¿ç¨‹è¿›å…¥<code>é˜»å¡çŠ¶æ€</code>ã€‚éœ€è¦ç”¨äºt1å¯¹è±¡é”çš„çº¿ç¨‹é€šè¿‡notify() æˆ–è€… notifyAll()å°†å…¶å”¤é†’æˆ–è€…è¶…æ—¶3000msä¹‹åï¼Œä¸»çº¿ç¨‹mainæ‰è¿›å…¥åˆ°<code>å°±ç»ªçŠ¶æ€</code>ï¼Œç„¶åæ‰å¯ä»¥è¿è¡Œã€‚</li>
<li><code>çº¿ç¨‹t1</code>è¿è¡Œä¹‹åï¼Œè¿›å…¥äº†æ­»å¾ªç¯ï¼Œä¸€ç›´ä¸æ–­çš„è¿è¡Œã€‚</li>
<li>è¶…æ—¶3000msä¹‹åï¼Œä¸»çº¿ç¨‹mainä¼šè¿›å…¥åˆ°<code>å°±ç»ªçŠ¶æ€</code>ï¼Œç„¶åæ¥ç€è¿›å…¥<code>è¿è¡ŒçŠ¶æ€</code>ã€‚</li>
</ul>
<p><img loading="lazy" src="/posts/%E5%A4%9A%E7%BA%BF%E7%A8%8B/3_multithreading-wait+notify/2.png"></p>
<h1 id="waitå’Œnotifyall">wait()å’ŒnotifyAll()<a hidden class="anchor" aria-hidden="true" href="#waitå’Œnotifyall">#</a></h1>
<p>é€šè¿‡å‰é¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“<code>notify()</code>å¯ä»¥å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚
ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡ç¤ºä¾‹æ¼”ç¤º<code>notifyAll()</code>çš„ç”¨æ³•ï¼›å®ƒçš„ä½œç”¨æ˜¯å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> NotifyAllTest {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> Object obj = <span style="color:#fff;font-weight:bold">new</span> Object();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ThreadA t1 = <span style="color:#fff;font-weight:bold">new</span> ThreadA(<span style="color:#0ff;font-weight:bold">&#34;t1&#34;</span>);
</span></span><span style="display:flex;"><span>        ThreadA t2 = <span style="color:#fff;font-weight:bold">new</span> ThreadA(<span style="color:#0ff;font-weight:bold">&#34;t2&#34;</span>);
</span></span><span style="display:flex;"><span>        ThreadA t3 = <span style="color:#fff;font-weight:bold">new</span> ThreadA(<span style="color:#0ff;font-weight:bold">&#34;t3&#34;</span>);
</span></span><span style="display:flex;"><span>        t1.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        t2.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        t3.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34; sleep(3000)&#34;</span>);
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#007f7f">sleep</span>(3000);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">synchronized</span>(obj) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// ä¸»çº¿ç¨‹ç­‰å¾…å”¤é†’ã€‚</span>
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34; notifyAll()&#34;</span>);
</span></span><span style="display:flex;"><span>            obj.<span style="color:#007f7f">notifyAll</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> ThreadA <span style="color:#fff;font-weight:bold">extends</span> Thread{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> ThreadA(String name){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">super</span>(name);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">synchronized</span> (obj) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// æ‰“å°è¾“å‡ºç»“æœ</span>
</span></span><span style="display:flex;"><span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34; wait&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// å”¤é†’å½“å‰çš„waitçº¿ç¨‹</span>
</span></span><span style="display:flex;"><span>                    obj.<span style="color:#007f7f">wait</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// æ‰“å°è¾“å‡ºç»“æœ</span>
</span></span><span style="display:flex;"><span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34; continue&#34;</span>);
</span></span><span style="display:flex;"><span>                } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>t1 wait
</span></span><span style="display:flex;"><span>main sleep(3000)
</span></span><span style="display:flex;"><span>t3 wait
</span></span><span style="display:flex;"><span>t2 wait
</span></span><span style="display:flex;"><span>main notifyAll()
</span></span><span style="display:flex;"><span>t2 continue
</span></span><span style="display:flex;"><span>t3 continue
</span></span><span style="display:flex;"><span>t1 continue
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœè¯´æ˜ï¼š
å‚è€ƒä¸‹é¢çš„æµç¨‹å›¾ã€‚</p>
<ul>
<li>ä¸»çº¿ç¨‹ä¸­æ–°å»ºå¹¶ä¸”å¯åŠ¨äº†3ä¸ªçº¿ç¨‹t1ã€t2å’Œt3</li>
<li>ä¸»çº¿ç¨‹é€šè¿‡sleep(3000)ä¼‘çœ 3ç§’ã€‚åœ¨ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‡è®¾t1ã€t2å’Œt3è¿™3ä¸ªçº¿ç¨‹éƒ½å¼€å§‹è¿è¡Œäº†ã€‚ä»¥t1ä¸ºä¾‹ï¼Œå½“å®ƒè¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šæ‰§è¡Œ<code>obj.wait()</code>ç­‰å¾…å…¶å®ƒçº¿ç¨‹é€šè¿‡notify()æˆ–é¢nofityAll()æ¥å”¤é†’å®ƒï¼›ç›¸åŒçš„é“ç†ï¼Œt2å’Œt3ä¹Ÿä¼šç­‰å¾…å…¶å®ƒçº¿ç¨‹é€šè¿‡nofity()æˆ–nofityAll()æ¥å”¤é†’å®ƒä»¬ã€‚</li>
<li>ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’ä¹‹åï¼Œæ¥ç€è¿è¡Œã€‚æ‰§è¡Œ<code>obj.notifyAll()</code>å”¤é†’objä¸Šçš„ç­‰å¾…çº¿ç¨‹ï¼Œå³å”¤é†’t1ã€t2å’Œt3è¿™3ä¸ªçº¿ç¨‹ã€‚ ç´§æ¥ç€ï¼Œä¸»çº¿ç¨‹çš„<code>synchronized(obj)</code>è¿è¡Œå®Œæ¯•ä¹‹åï¼Œä¸»çº¿ç¨‹é‡Šæ”¾<code>objé”</code>ã€‚è¿™æ ·ï¼Œt1ã€t2å’Œt3å°±å¯ä»¥ç›¸ç»§è·å–<code>objé”</code>è€Œç»§ç»­è¿è¡Œäº†ã€‚</li>
</ul>
<p><img loading="lazy" src="/posts/%E5%A4%9A%E7%BA%BF%E7%A8%8B/3_multithreading-wait+notify/3.png"></p>
<h1 id="ä¸ºä»€ä¹ˆnotify-waitç­‰å‡½æ•°å®šä¹‰åœ¨objectä¸­è€Œä¸æ˜¯threadä¸­">ä¸ºä»€ä¹ˆnotify(), wait()ç­‰å‡½æ•°å®šä¹‰åœ¨Objectä¸­ï¼Œè€Œä¸æ˜¯Threadä¸­<a hidden class="anchor" aria-hidden="true" href="#ä¸ºä»€ä¹ˆnotify-waitç­‰å‡½æ•°å®šä¹‰åœ¨objectä¸­è€Œä¸æ˜¯threadä¸­">#</a></h1>
<p>Objectä¸­çš„wait()å’Œnotify()ç­‰å‡½æ•°ï¼Œå’Œsynchronizedä¸€æ ·ï¼Œä¼šå¯¹ &ldquo;å¯¹è±¡çš„åŒæ­¥é”&rdquo; è¿›è¡Œæ“ä½œã€‚
wait()ä¼šä½¿ &ldquo;å½“å‰çº¿ç¨‹&rdquo; ç­‰å¾…ï¼Œå› ä¸ºçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œæ‰€ä»¥çº¿ç¨‹åº”è¯¥é‡Šæ”¾å®ƒæ‰€æŒæœ‰çš„ &ldquo;åŒæ­¥é”&rdquo;ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹ä¼šå› ä¸ºè·å–ä¸åˆ°è¯¥ &ldquo;åŒæ­¥é”&rdquo; è€Œæ— æ³•è¿è¡Œã€‚
okï¼Œçº¿ç¨‹è°ƒç”¨wait()ä¹‹åï¼Œä¼šé‡Šæ”¾å®ƒé”æŒæœ‰çš„<code>åŒæ­¥é”</code>ï¼›è€Œä¸”ï¼Œæ ¹æ®å‰é¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ï¼šç­‰å¾…çº¿ç¨‹å¯ä»¥è¢«notify()æˆ–notifyAll()å”¤é†’ã€‚
é‚£ä¹ˆ notify() æ˜¯ä¾æ®ä»€ä¹ˆå”¤é†’ç­‰å¾…çº¿ç¨‹çš„ï¼Ÿæˆ–è€…è¯´ï¼Œwait()ç­‰å¾…çº¿ç¨‹å’Œnotify()ä¹‹é—´æ˜¯é€šè¿‡ä»€ä¹ˆå…³è”èµ·æ¥çš„ï¼Ÿç­”æ¡ˆæ˜¯ï¼šä¾æ®<code>å¯¹è±¡çš„åŒæ­¥é”</code>ã€‚
è´Ÿè´£å”¤é†’ç­‰å¾…çº¿ç¨‹çš„é‚£ä¸ªçº¿ç¨‹(æˆ‘ä»¬ç§°ä¸º &ldquo;å”¤é†’çº¿ç¨‹&rdquo;)ï¼Œå®ƒåªæœ‰åœ¨è·å–<code>è¯¥å¯¹è±¡çš„åŒæ­¥é”</code>(è¿™é‡Œçš„åŒæ­¥é”å¿…é¡»å’Œç­‰å¾…çº¿ç¨‹çš„åŒæ­¥é”æ˜¯åŒä¸€ä¸ª)ï¼Œå¹¶ä¸”è°ƒç”¨notify()æˆ–notifyAll()æ–¹æ³•ä¹‹åï¼Œæ‰èƒ½å”¤é†’ç­‰å¾…çº¿ç¨‹ã€‚è™½ç„¶ï¼Œç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ï¼›ä½†æ˜¯ï¼Œå®ƒä¸èƒ½ç«‹åˆ»æ‰§è¡Œï¼Œå› ä¸ºå”¤é†’çº¿ç¨‹è¿˜æŒæœ‰<code>è¯¥å¯¹è±¡çš„åŒæ­¥é”</code>ã€‚å¿…é¡»ç­‰åˆ°å”¤é†’çº¿ç¨‹é‡Šæ”¾äº†<code>è¯¥å¯¹è±¡çš„åŒæ­¥é”</code>ä¹‹åï¼Œç­‰å¾…çº¿ç¨‹æ‰èƒ½è·å–åˆ°<code>è¯¥å¯¹è±¡çš„åŒæ­¥é”</code>è¿›è€Œç»§ç»­è¿è¡Œã€‚</p>
<p>æ€»ä¹‹ï¼Œnotify(), wait()ä¾èµ–äº<code>åŒæ­¥é”</code>ï¼Œè€Œ<code>åŒæ­¥é”</code>æ˜¯å¯¹è±¡é”æŒæœ‰ï¼Œå¹¶ä¸”æ¯ä¸ªå¯¹è±¡æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆnotify(), wait()ç­‰å‡½æ•°å®šä¹‰åœ¨Objectç±»ï¼Œè€Œä¸æ˜¯Threadç±»ä¸­çš„åŸå› ã€‚</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/multithreading/">Multithreading</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>