<!DOCTYPE html>
<html lang="en" dir="auto">

<head>
    
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;Â»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      HashMap
    </h1>
    <div class="post-meta"><span title='2016-12-12 14:49:20 +0000 UTC'>2016-12-12</span>&nbsp;Â·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%a6%82%e8%bf%b0" aria-label="æ¦‚è¿°">æ¦‚è¿°</a></li>
                <li>
                    <a href="#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0" aria-label="æ„é€ å‡½æ•°">æ„é€ å‡½æ•°</a></li>
                <li>
                    <a href="#api" aria-label="API">API</a></li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" aria-label="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</a></li>
                <li>
                    <a href="#hashmap%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0" aria-label="HashMapæ„é€ å‡½æ•°">HashMapæ„é€ å‡½æ•°</a></li>
                <li>
                    <a href="#hashmap%e7%9a%84%e5%9f%ba%e6%9c%ac%e5%b1%9e%e6%80%a7" aria-label="HashMapçš„åŸºæœ¬å±æ€§">HashMapçš„åŸºæœ¬å±æ€§</a></li>
                <li>
                    <a href="#%e5%ae%9a%e4%bd%8d%e5%93%88%e5%b8%8c%e6%a1%b6%e6%95%b0%e7%bb%84%e7%b4%a2%e5%bc%95%e4%bd%8d%e7%bd%ae" aria-label="å®šä½å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®">å®šä½å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®</a></li>
                <li>
                    <a href="#get-%e6%96%b9%e6%b3%95" aria-label="get æ–¹æ³•">get æ–¹æ³•</a><ul>
                        
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%971gettreenode" aria-label="ä»£ç å—1ï¼šgetTreeNode">ä»£ç å—1ï¼šgetTreeNode</a></li>
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%972find" aria-label="ä»£ç å—2ï¼šfind">ä»£ç å—2ï¼šfind</a></li>
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%973comparableclassfor" aria-label="ä»£ç å—3ï¼šcomparableClassFor">ä»£ç å—3ï¼šcomparableClassFor</a></li></ul>
                </li>
                <li>
                    <a href="#put%e6%96%b9%e6%b3%95" aria-label="putæ–¹æ³•">putæ–¹æ³•</a><ul>
                        
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%974puttreeval" aria-label="ä»£ç å—4ï¼šputTreeVal">ä»£ç å—4ï¼šputTreeVal</a></li>
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%975tiebreakorder" aria-label="ä»£ç å—5ï¼štieBreakOrder">ä»£ç å—5ï¼štieBreakOrder</a></li>
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%976treeifybin" aria-label="ä»£ç å—6ï¼štreeifyBin">ä»£ç å—6ï¼štreeifyBin</a></li>
                <li>
                    <a href="#xxxxxxxxxximport-javautil--desc-hashtable%e7%9a%84%e6%b5%8b%e8%af%95%e7%a8%8b%e5%ba%8f---author-skywang-public-class-hashtabletest---public-static-void-mainstring-args-----testhashtableapis-----private-static-void-testhashtableapis------%e5%88%9d%e5%a7%8b%e5%8c%96%e9%9a%8f%e6%9c%ba%e7%a7%8d%e5%ad%90----random-r--new-random-----%e6%96%b0%e5%bb%bahashtable----hashtable-table--new-hashtable-----%e6%b7%bb%e5%8a%a0%e6%93%8d%e4%bd%9c----tableputone-rnextint10----tableputtwo-rnextint10----tableputthree-rnextint10-----%e6%89%93%e5%8d%b0%e5%87%batable----systemoutprintlntabletable------%e9%80%9a%e8%bf%87iterator%e9%81%8d%e5%8e%86key-value----iterator-iter--tableentrysetiterator----whileiterhasnext-------mapentry-entry--mapentryiternext------systemoutprintlnnext---entrygetkey----entrygetvalue----------hashtable%e7%9a%84%e9%94%ae%e5%80%bc%e5%af%b9%e4%b8%aa%e6%95%b0--------systemoutprintlnsizetablesize-----containskeyobject-key-%e6%98%af%e5%90%a6%e5%8c%85%e5%90%ab%e9%94%aekey----systemoutprintlncontains-key-two--tablecontainskeytwo----systemoutprintlncontains-key-five--tablecontainskeyfive-----containsvalueobject-value-%e6%98%af%e5%90%a6%e5%8c%85%e5%90%ab%e5%80%bcvalue----systemoutprintlncontains-value-0--tablecontainsvaluenew-integer0-----removeobject-key--%e5%88%a0%e9%99%a4%e9%94%aekey%e5%af%b9%e5%ba%94%e7%9a%84%e9%94%ae%e5%80%bc%e5%af%b9----tableremovethree----systemoutprintlntabletable------clear--%e6%b8%85%e7%a9%bahashtable----tableclear-----isempty--hashtable%e6%98%af%e5%90%a6%e4%b8%ba%e7%a9%ba----systemoutprintlntableisemptytable-is-emptytable-is-not-empty----java" aria-label="xxxxxxxxxxÂ import java.util.;â€‹/ * @desc Hashtableçš„æµ‹è¯•ç¨‹åºã€‚ * * @author skywang */public class HashtableTest { public static void main(String[] args) { testHashtableAPIs(); }â€‹ private static void testHashtableAPIs() { // åˆå§‹åŒ–éšæœºç§å­ Random r = new Random(); // æ–°å»ºHashtable Hashtable table = new Hashtable(); // æ·»åŠ æ“ä½œ table.put(&ldquo;one&rdquo;, r.nextInt(10)); table.put(&ldquo;two&rdquo;, r.nextInt(10)); table.put(&ldquo;three&rdquo;, r.nextInt(10));â€‹ // æ‰“å°å‡ºtable System.out.println(&ldquo;table:&quot;&#43;table );â€‹ // é€šè¿‡Iteratoréå†key-value Iterator iter = table.entrySet().iterator(); while(iter.hasNext()) { Map.Entry entry = (Map.Entry)iter.next(); System.out.println(&ldquo;next : &ldquo;&#43; entry.getKey() &#43;&rdquo; - &ldquo;&#43;entry.getValue()); }â€‹ // Hashtableçš„é”®å€¼å¯¹ä¸ªæ•° System.out.println(&ldquo;size:&quot;&#43;table.size());â€‹ // containsKey(Object key) :æ˜¯å¦åŒ…å«é”®key System.out.println(&ldquo;contains key two : &ldquo;&#43;table.containsKey(&ldquo;two&rdquo;)); System.out.println(&ldquo;contains key five : &ldquo;&#43;table.containsKey(&ldquo;five&rdquo;));â€‹ // containsValue(Object value) :æ˜¯å¦åŒ…å«å€¼value System.out.println(&ldquo;contains value 0 : &ldquo;&#43;table.containsValue(new Integer(0)));â€‹ // remove(Object key) ï¼š åˆ é™¤é”®keyå¯¹åº”çš„é”®å€¼å¯¹ table.remove(&ldquo;three&rdquo;);â€‹ System.out.println(&ldquo;table:&quot;&#43;table );â€‹ // clear() ï¼š æ¸…ç©ºHashtable table.clear();â€‹ // isEmpty() : Hashtableæ˜¯å¦ä¸ºç©º System.out.println((table.isEmpty()?&ldquo;table is empty&rdquo;:&ldquo;table is not empty&rdquo;) ); }â€‹}java">xxxxxxxxxxÂ import java.util.;â€‹/ * @desc Hashtableçš„æµ‹è¯•ç¨‹åºã€‚ * * @author skywang */public class HashtableTest { public static void main(String[] args) { testHashtableAPIs(); }â€‹ private static void testHashtableAPIs() { // åˆå§‹åŒ–éšæœºç§å­ Random r = new Random(); // æ–°å»ºHashtable Hashtable table = new Hashtable(); // æ·»åŠ æ“ä½œ table.put(&ldquo;one&rdquo;, r.nextInt(10)); table.put(&ldquo;two&rdquo;, r.nextInt(10)); table.put(&ldquo;three&rdquo;, r.nextInt(10));â€‹ // æ‰“å°å‡ºtable System.out.println(&ldquo;table:&quot;+table );â€‹ // é€šè¿‡Iteratoréå†key-value Iterator iter = table.entrySet().iterator(); while(iter.hasNext()) { Map.Entry entry = (Map.Entry)iter.next(); System.out.println(&ldquo;next : &ldquo;+ entry.getKey() +&rdquo; - &ldquo;+entry.getValue()); }â€‹ // Hashtableçš„é”®å€¼å¯¹ä¸ªæ•° System.out.println(&ldquo;size:&quot;+table.size());â€‹ // containsKey(Object key) :æ˜¯å¦åŒ…å«é”®key System.out.println(&ldquo;contains key two : &ldquo;+table.containsKey(&ldquo;two&rdquo;)); System.out.println(&ldquo;contains key five : &ldquo;+table.containsKey(&ldquo;five&rdquo;));â€‹ // containsValue(Object value) :æ˜¯å¦åŒ…å«å€¼value System.out.println(&ldquo;contains value 0 : &ldquo;+table.containsValue(new Integer(0)));â€‹ // remove(Object key) ï¼š åˆ é™¤é”®keyå¯¹åº”çš„é”®å€¼å¯¹ table.remove(&ldquo;three&rdquo;);â€‹ System.out.println(&ldquo;table:&quot;+table );â€‹ // clear() ï¼š æ¸…ç©ºHashtable table.clear();â€‹ // isEmpty() : Hashtableæ˜¯å¦ä¸ºç©º System.out.println((table.isEmpty()?&ldquo;table is empty&rdquo;:&ldquo;table is not empty&rdquo;) ); }â€‹}java</a></li>
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%978moveroottofront" aria-label="ä»£ç å—8ï¼šmoveRootToFront">ä»£ç å—8ï¼šmoveRootToFront</a></li>
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%979checkinvariants" aria-label="ä»£ç å—9ï¼šcheckInvariants">ä»£ç å—9ï¼šcheckInvariants</a></li></ul>
                </li>
                <li>
                    <a href="#resize-%e6%96%b9%e6%b3%95" aria-label="resize æ–¹æ³•">resize æ–¹æ³•</a><ul>
                        
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%9710split" aria-label="ä»£ç å—10ï¼šsplit">ä»£ç å—10ï¼šsplit</a></li>
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%9711untreeify" aria-label="ä»£ç å—11ï¼šuntreeify">ä»£ç å—11ï¼šuntreeify</a></li>
                <li>
                    <a href="#%e4%be%8b%e5%ad%901%e6%89%a9%e5%ae%b9%e5%90%8e%e8%8a%82%e7%82%b9%e9%87%8d-hash-%e4%b8%ba%e4%bb%80%e4%b9%88%e5%8f%aa%e5%8f%af%e8%83%bd%e5%88%86%e5%b8%83%e5%9c%a8-%e5%8e%9f%e7%b4%a2%e5%bc%95%e4%bd%8d%e7%bd%ae-%e4%b8%8e-%e5%8e%9f%e7%b4%a2%e5%bc%95--oldcap-%e4%bd%8d%e7%bd%ae-" aria-label="ä¾‹å­1ï¼šæ‰©å®¹åï¼ŒèŠ‚ç‚¹é‡ hash ä¸ºä»€ä¹ˆåªå¯èƒ½åˆ†å¸ƒåœ¨ â€œåŸç´¢å¼•ä½ç½®â€ ä¸ â€œåŸç´¢å¼• &#43; oldCap ä½ç½®â€ ï¼Ÿ">ä¾‹å­1ï¼šæ‰©å®¹åï¼ŒèŠ‚ç‚¹é‡ hash ä¸ºä»€ä¹ˆåªå¯èƒ½åˆ†å¸ƒåœ¨ â€œåŸç´¢å¼•ä½ç½®â€ ä¸ â€œåŸç´¢å¼• + oldCap ä½ç½®â€ ï¼Ÿ</a></li></ul>
                </li>
                <li>
                    <a href="#remove-%e6%96%b9%e6%b3%95" aria-label="remove æ–¹æ³•">remove æ–¹æ³•</a><ul>
                        
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%9d%9712removetreenode" aria-label="ä»£ç å—12ï¼šremoveTreeNode">ä»£ç å—12ï¼šremoveTreeNode</a></li>
                <li>
                    <a href="#%e8%a7%a3%e9%87%8a2%e5%85%b3%e4%ba%8e%e7%ba%a2%e9%bb%91%e6%a0%91%e7%9a%84%e5%b9%b3%e8%a1%a1%e8%b0%83%e6%95%b4" aria-label="è§£é‡Š2ï¼šå…³äºçº¢é»‘æ ‘çš„å¹³è¡¡è°ƒæ•´ï¼Ÿ">è§£é‡Š2ï¼šå…³äºçº¢é»‘æ ‘çš„å¹³è¡¡è°ƒæ•´ï¼Ÿ</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%ad%bb%e5%be%aa%e7%8e%af%e9%97%ae%e9%a2%98" aria-label="æ­»å¾ªç¯é—®é¢˜">æ­»å¾ªç¯é—®é¢˜</a></li>
                <li>
                    <a href="#jdk-18%e6%89%a9%e5%ae%b9%e8%bf%87%e7%a8%8b" aria-label="JDK 1.8æ‰©å®¹è¿‡ç¨‹">JDK 1.8æ‰©å®¹è¿‡ç¨‹</a><ul>
                        
                <li>
                    <a href="#%e5%85%b7%e4%bd%93%e6%89%a9%e5%ae%b9%e8%bf%87%e7%a8%8b" aria-label="å…·ä½“æ‰©å®¹è¿‡ç¨‹ï¼š">å…·ä½“æ‰©å®¹è¿‡ç¨‹ï¼š</a></li></ul>
                </li>
                <li>
                    <a href="#hashmap%e5%ae%9e%e7%8e%b0%e7%9a%84cloneable%e6%8e%a5%e5%8f%a3" aria-label="HashMapå®ç°çš„Cloneableæ¥å£">HashMapå®ç°çš„Cloneableæ¥å£</a></li>
                <li>
                    <a href="#hashmap%e9%81%8d%e5%8e%86%e6%96%b9%e5%bc%8f" aria-label="HashMapéå†æ–¹å¼">HashMapéå†æ–¹å¼</a><ul>
                        
                <li>
                    <a href="#%e9%81%8d%e5%8e%86%e9%94%ae%e5%80%bc%e5%af%b9" aria-label="éå†é”®å€¼å¯¹">éå†é”®å€¼å¯¹</a></li>
                <li>
                    <a href="#%e9%81%8d%e5%8e%86%e9%94%ae" aria-label="éå†é”®">éå†é”®</a></li>
                <li>
                    <a href="#%e9%81%8d%e5%8e%86%e5%80%bc" aria-label="éå†å€¼">éå†å€¼</a></li>
                <li>
                    <a href="#jdk18" aria-label="JDK1.8">JDK1.8</a></li></ul>
                </li>
                <li>
                    <a href="#hashmap%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b" aria-label="HashMapä»£ç ç¤ºä¾‹">HashMapä»£ç ç¤ºä¾‹</a></li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="æ€»ç»“">æ€»ç»“</a></li>
                <li>
                    <a href="#concurrenthashmap" aria-label="ConcurrentHashMap">ConcurrentHashMap</a><ul>
                        
                <li>
                    <a href="#jdk17%e4%b8%ad%e7%9a%84-concurrenthashmap" aria-label="jdk1.7ä¸­çš„ ConcurrentHashMap">jdk1.7ä¸­çš„ ConcurrentHashMap</a></li>
                <li>
                    <a href="#jdk18%e4%b8%ad%e7%9a%84-concurrenthashmap" aria-label="jdk1.8ä¸­çš„ ConcurrentHashMap">jdk1.8ä¸­çš„ ConcurrentHashMap</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%a2%98" aria-label="é¢˜">é¢˜</a><ul>
                        
                <li>
                    <a href="#hashmap-%e7%9a%84%e5%ba%95%e5%b1%82%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" aria-label="HashMap çš„åº•å±‚æ•°æ®ç»“æ„">HashMap çš„åº•å±‚æ•°æ®ç»“æ„</a></li>
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e6%94%b9%e6%88%90%e6%95%b0%e7%bb%84%e9%93%be%e8%a1%a8%e7%ba%a2%e9%bb%91%e6%a0%91" aria-label="ä¸ºä»€ä¹ˆè¦æ”¹æˆâ€œæ•°ç»„&#43;é“¾è¡¨&#43;çº¢é»‘æ ‘â€ï¼Ÿ">ä¸ºä»€ä¹ˆè¦æ”¹æˆâ€œæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘â€ï¼Ÿ</a></li>
                <li>
                    <a href="#%e9%82%a3%e5%9c%a8%e4%bb%80%e4%b9%88%e6%97%b6%e5%80%99%e7%94%a8%e9%93%be%e8%a1%a8%e4%bb%80%e4%b9%88%e6%97%b6%e5%80%99%e7%94%a8%e7%ba%a2%e9%bb%91%e6%a0%91" aria-label="é‚£åœ¨ä»€ä¹ˆæ—¶å€™ç”¨é“¾è¡¨ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨çº¢é»‘æ ‘ï¼Ÿ">é‚£åœ¨ä»€ä¹ˆæ—¶å€™ç”¨é“¾è¡¨ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨çº¢é»‘æ ‘ï¼Ÿ</a></li>
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%93%be%e8%a1%a8%e8%bd%ac%e7%ba%a2%e9%bb%91%e6%a0%91%e7%9a%84%e9%98%88%e5%80%bc%e6%98%af8" aria-label="ä¸ºä»€ä¹ˆé“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼æ˜¯8ï¼Ÿ">ä¸ºä»€ä¹ˆé“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼æ˜¯8ï¼Ÿ</a></li>
                <li>
                    <a href="#%e9%82%a3%e4%b8%ba%e4%bb%80%e4%b9%88%e8%bd%ac%e5%9b%9e%e9%93%be%e8%a1%a8%e8%8a%82%e7%82%b9%e6%98%af%e7%94%a8%e7%9a%846%e8%80%8c%e4%b8%8d%e6%98%af%e5%a4%8d%e7%94%a88" aria-label="é‚£ä¸ºä»€ä¹ˆè½¬å›é“¾è¡¨èŠ‚ç‚¹æ˜¯ç”¨çš„6è€Œä¸æ˜¯å¤ç”¨8ï¼Ÿ">é‚£ä¸ºä»€ä¹ˆè½¬å›é“¾è¡¨èŠ‚ç‚¹æ˜¯ç”¨çš„6è€Œä¸æ˜¯å¤ç”¨8ï¼Ÿ</a></li>
                <li>
                    <a href="#%e9%82%a3-hashmap-%e6%9c%89%e5%93%aa%e4%ba%9b%e9%87%8d%e8%a6%81%e5%b1%9e%e6%80%a7%e5%88%86%e5%88%ab%e7%94%a8%e4%ba%8e%e5%81%9a%e4%bb%80%e4%b9%88%e7%9a%84" aria-label="é‚£ HashMap æœ‰å“ªäº›é‡è¦å±æ€§ï¼Ÿåˆ†åˆ«ç”¨äºåšä»€ä¹ˆçš„ï¼Ÿ">é‚£ HashMap æœ‰å“ªäº›é‡è¦å±æ€§ï¼Ÿåˆ†åˆ«ç”¨äºåšä»€ä¹ˆçš„ï¼Ÿ</a></li>
                <li>
                    <a href="#threshold-%e9%99%a4%e4%ba%86%e7%94%a8%e4%ba%8e%e5%ad%98%e6%94%be%e6%89%a9%e5%ae%b9%e9%98%88%e5%80%bc%e8%bf%98%e6%9c%89%e5%85%b6%e4%bb%96%e4%bd%9c%e7%94%a8%e5%90%97" aria-label="threshold é™¤äº†ç”¨äºå­˜æ”¾æ‰©å®¹é˜ˆå€¼è¿˜æœ‰å…¶ä»–ä½œç”¨å—ï¼Ÿ">threshold é™¤äº†ç”¨äºå­˜æ”¾æ‰©å®¹é˜ˆå€¼è¿˜æœ‰å…¶ä»–ä½œç”¨å—ï¼Ÿ</a></li>
                <li>
                    <a href="#hashmap-%e7%9a%84%e9%bb%98%e8%ae%a4%e5%88%9d%e5%a7%8b%e5%ae%b9%e9%87%8f%e6%98%af%e5%a4%9a%e5%b0%91hashmap-%e7%9a%84%e5%ae%b9%e9%87%8f%e6%9c%89%e4%bb%80%e4%b9%88%e9%99%90%e5%88%b6%e5%90%97" aria-label="HashMap çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯å¤šå°‘ï¼ŸHashMap çš„å®¹é‡æœ‰ä»€ä¹ˆé™åˆ¶å—ï¼Ÿ">HashMap çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯å¤šå°‘ï¼ŸHashMap çš„å®¹é‡æœ‰ä»€ä¹ˆé™åˆ¶å—ï¼Ÿ</a></li>
                <li>
                    <a href="#%e4%bd%a0%e8%af%b4-hashmap-%e7%9a%84%e5%ae%b9%e9%87%8f%e5%bf%85%e9%a1%bb%e6%98%af-2-%e7%9a%84-n-%e6%ac%a1%e6%96%b9%e8%bf%99%e6%98%af%e4%b8%ba%e4%bb%80%e4%b9%88" aria-label="ä½ è¯´ HashMap çš„å®¹é‡å¿…é¡»æ˜¯ 2 çš„ N æ¬¡æ–¹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ">ä½ è¯´ HashMap çš„å®¹é‡å¿…é¡»æ˜¯ 2 çš„ N æ¬¡æ–¹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</a></li>
                <li>
                    <a href="#hashmap-%e7%9a%84%e9%bb%98%e8%ae%a4%e5%88%9d%e5%a7%8b%e5%ae%b9%e9%87%8f%e6%98%af-16%e4%b8%ba%e4%bb%80%e4%b9%88%e6%98%af16%e8%80%8c%e4%b8%8d%e6%98%af%e5%85%b6%e4%bb%96%e7%9a%84" aria-label="HashMap çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯ 16ï¼Œä¸ºä»€ä¹ˆæ˜¯16è€Œä¸æ˜¯å…¶ä»–çš„ï¼Ÿ">HashMap çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯ 16ï¼Œä¸ºä»€ä¹ˆæ˜¯16è€Œä¸æ˜¯å…¶ä»–çš„ï¼Ÿ</a></li>
                <li>
                    <a href="#hashmap-%e7%9a%84%e8%b4%9f%e8%bd%bd%e5%9b%a0%e5%ad%90%e9%bb%98%e8%ae%a4%e5%88%9d%e5%a7%8b%e5%80%bc%e5%8f%88%e6%98%af%e5%a4%9a%e5%b0%91%e4%b8%ba%e4%bb%80%e4%b9%88%e6%98%af%e8%bf%99%e4%b8%aa%e6%95%b0" aria-label="HashMap çš„è´Ÿè½½å› å­é»˜è®¤åˆå§‹å€¼åˆæ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªæ•°ï¼Ÿ">HashMap çš„è´Ÿè½½å› å­é»˜è®¤åˆå§‹å€¼åˆæ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªæ•°ï¼Ÿ</a></li>
                <li>
                    <a href="#hashmap-%e7%9a%84%e6%8f%92%e5%85%a5%e6%b5%81%e7%a8%8b%e6%98%af%e6%80%8e%e4%b9%88%e6%a0%b7%e7%9a%84" aria-label="HashMap çš„æ’å…¥æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ">HashMap çš„æ’å…¥æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</a></li>
                <li>
                    <a href="#%e4%bb%8b%e7%bb%8d%e6%89%a9%e5%ae%b9resize%e7%9a%84%e6%b5%81%e7%a8%8b" aria-label="ä»‹ç»æ‰©å®¹ï¼ˆresizeï¼‰çš„æµç¨‹">ä»‹ç»æ‰©å®¹ï¼ˆresizeï¼‰çš„æµç¨‹</a></li>
                <li>
                    <a href="#hashmap-%e6%98%af%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8%e7%9a%84%e5%90%97" aria-label="HashMap æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ">HashMap æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</a></li>
                <li>
                    <a href="#%e4%bb%8b%e7%bb%8d%e4%b8%80%e4%b8%8b%e6%ad%bb%e5%be%aa%e7%8e%af%e9%97%ae%e9%a2%98" aria-label="ä»‹ç»ä¸€ä¸‹æ­»å¾ªç¯é—®é¢˜ï¼Ÿ">ä»‹ç»ä¸€ä¸‹æ­»å¾ªç¯é—®é¢˜ï¼Ÿ</a></li>
                <li>
                    <a href="#jdk-18-%e5%af%b9-hashmap-%e4%b8%bb%e8%a6%81%e8%bf%9b%e8%a1%8c%e4%ba%86%e5%93%aa%e4%ba%9b%e4%bc%98%e5%8c%96" aria-label="JDK 1.8 å¯¹ HashMap ä¸»è¦è¿›è¡Œäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ">JDK 1.8 å¯¹ HashMap ä¸»è¦è¿›è¡Œäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ</a></li>
                <li>
                    <a href="#%e4%bb%8b%e7%bb%8d%e4%b8%8b-concurrenhashmap%e8%a6%81%e8%ae%b2%e5%87%ba-17-%e5%92%8c-18-%e7%9a%84%e5%8c%ba%e5%88%ab" aria-label="ä»‹ç»ä¸‹ ConcurrenHashMapï¼Œè¦è®²å‡º 1.7 å’Œ 1.8 çš„åŒºåˆ«ï¼Ÿ">ä»‹ç»ä¸‹ ConcurrenHashMapï¼Œè¦è®²å‡º 1.7 å’Œ 1.8 çš„åŒºåˆ«ï¼Ÿ</a></li>
                <li>
                    <a href="#concurrenthashmap-%e7%9a%84%e5%b9%b6%e5%8f%91%e6%89%a9%e5%ae%b9" aria-label="ConcurrentHashMap çš„å¹¶å‘æ‰©å®¹">ConcurrentHashMap çš„å¹¶å‘æ‰©å®¹</a></li>
                <li>
                    <a href="#hashset-%e6%98%af%e5%a6%82%e4%bd%95%e4%bf%9d%e8%af%81%e4%b8%8d%e9%87%8d%e5%a4%8d%e7%9a%84" aria-label="HashSet æ˜¯å¦‚ä½•ä¿è¯ä¸é‡å¤çš„ï¼Ÿ">HashSet æ˜¯å¦‚ä½•ä¿è¯ä¸é‡å¤çš„ï¼Ÿ</a></li>
                <li>
                    <a href="#arraylist-%e5%92%8c-linkedlist-%e7%9a%84%e5%8c%ba%e5%88%ab" aria-label="ArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ">ArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="æ¦‚è¿°">æ¦‚è¿°<a hidden class="anchor" aria-hidden="true" href="#æ¦‚è¿°">#</a></h1>
<p>HashMapæ˜¯ä¸€ä¸ªæ•£åˆ—è¡¨ï¼ˆå°±æ˜¯å“ˆå¸Œè¡¨ï¼‰ï¼Œå“ˆå¸Œè¡¨å°±æ˜¯ä¸€ç§ä»¥<code>é”®-å€¼(key-indexed)</code>å­˜å‚¨æ•°æ®çš„ç»“æ„ã€‚
HashMap ç»§æ‰¿äºAbstractMapï¼Œå®ç°äº†Mapã€Cloneableã€java.io.Serializableæ¥å£ã€‚
HashMap çš„å®ç°ä¸æ˜¯åŒæ­¥çš„ï¼Œè¿™æ„å‘³ç€å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å®ƒçš„keyã€valueéƒ½å¯ä»¥ä¸ºnullã€‚æ­¤å¤–ï¼ŒHashMapä¸­çš„æ˜ å°„ä¸æ˜¯æœ‰åºçš„ã€‚</p>
<p>HashMapçš„å®ä¾‹æœ‰ä¸¤ä¸ªå‚æ•°å½±å“å…¶æ€§èƒ½ï¼š<code>åˆå§‹å®¹é‡</code>å’Œ<code>åŠ è½½å› å­</code>
å®¹é‡æ˜¯å“ˆå¸Œè¡¨ä¸­æ¡¶çš„æ•°é‡ï¼Œåˆå§‹å®¹é‡åªæ˜¯å“ˆå¸Œè¡¨åœ¨åˆ›å»ºæ—¶çš„å®¹é‡ã€‚
åŠ è½½å› å­æ˜¯å“ˆå¸Œè¡¨åœ¨å…¶å®¹é‡è‡ªåŠ¨å¢é•¿ä¹‹å‰ï¼Œå¯ä»¥è¾¾åˆ°å¤šæ»¡çš„ä¸€ç§å°ºåº¦ã€‚
å½“å“ˆå¸Œè¡¨ä¸­çš„æ¡ç›®æ•°è¶…å‡ºäº†åŠ è½½å› å­ä¸å½“å‰å®¹é‡çš„ä¹˜ç§¯æ—¶ï¼Œåˆ™è¦å¯¹è¯¥å“ˆå¸Œè¡¨è¿›è¡Œrehashæ“ä½œ(å³é‡å»ºå†…éƒ¨ç»“æ„)ï¼Œä»è€Œå“ˆå¸Œè¡¨å°†å…·æœ‰ä¸¤å€çš„æ¡¶æ•°ã€‚
é€šå¸¸ï¼Œ<strong>é»˜è®¤åŠ è½½å› å­æ˜¯0.75</strong>ï¼Œ è¿™æ˜¯åœ¨æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¸Šå¯»æ±‚ä¸€ç§æŠ˜ä¸­ã€‚åŠ è½½å› å­è¿‡é«˜è™½ç„¶å‡å°‘äº†ç©ºé—´å¼€é”€ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†æŸ¥è¯¢æˆæœ¬ï¼ˆåœ¨å¤§å¤šæ•° HashMap ç±»çš„æ“ä½œä¸­ï¼ŒåŒ…æ‹¬ get å’Œ put æ“ä½œï¼Œéƒ½åæ˜ äº†è¿™ä¸€ç‚¹ï¼‰ã€‚
åœ¨è®¾ç½®åˆå§‹å®¹é‡æ—¶åº”è¯¥è€ƒè™‘åˆ°æ˜ å°„ä¸­æ‰€éœ€çš„æ¡ç›®æ•°åŠå…¶åŠ è½½å› å­ï¼Œä»¥ä¾¿æœ€å¤§é™åº¦åœ°å‡å°‘ rehash æ“ä½œæ¬¡æ•°ã€‚å¦‚æœåˆå§‹å®¹é‡å¤§äºæœ€å¤§æ¡ç›®æ•°é™¤ä»¥åŠ è½½å› å­ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿ rehash æ“ä½œã€‚</p>
<p>é“¾å¼å“ˆå¸Œè¡¨
é“¾å¼å“ˆå¸Œè¡¨ä»æ ¹æœ¬ä¸Šè¯´æ˜¯ç”±ä¸€ç»„é“¾è¡¨æ„æˆã€‚
æ¯ä¸ªé“¾è¡¨éƒ½å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªâ€œæ¡¶â€ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„å…ƒç´ é€šè¿‡æ•£åˆ—çš„æ–¹å¼æ”¾åˆ°å…·ä½“çš„ä¸åŒçš„æ¡¶ä¸­ã€‚
æ’å…¥å…ƒç´ æ—¶ï¼Œé¦–å…ˆå°†å…¶é”®ä¼ å…¥ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼ˆè¯¥è¿‡ç¨‹ç§°ä¸ºå“ˆå¸Œé”®ï¼‰ï¼Œå‡½æ•°é€šè¿‡æ•£åˆ—çš„æ–¹å¼å‘ŠçŸ¥å…ƒç´ å±äºå“ªä¸ªâ€œæ¡¶â€ï¼Œç„¶ååœ¨ç›¸åº”çš„é“¾è¡¨å¤´æ’å…¥å…ƒç´ ã€‚
æŸ¥æ‰¾æˆ–åˆ é™¤å…ƒç´ æ—¶ï¼Œç”¨åŒæ ·çš„æ–¹å¼å…ˆæ‰¾åˆ°å…ƒç´ çš„â€œæ¡¶â€ï¼Œç„¶åéå†ç›¸åº”çš„é“¾è¡¨ï¼Œç›´åˆ°å‘ç°æˆ‘ä»¬æƒ³è¦çš„å…ƒç´ ã€‚
å› ä¸ºæ¯ä¸ªâ€œæ¡¶â€éƒ½æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ‰€ä»¥é“¾å¼å“ˆå¸Œè¡¨å¹¶ä¸é™åˆ¶åŒ…å«å…ƒç´ çš„ä¸ªæ•°ã€‚ç„¶è€Œï¼Œå¦‚æœè¡¨å˜å¾—å¤ªå¤§ï¼Œå®ƒçš„æ€§èƒ½å°†ä¼šé™ä½ã€‚</p>
<p><img loading="lazy" src="1.png"></p>
<p>JDK 1.8 å¯¹ HashMap è¿›è¡Œäº†æ¯”è¾ƒå¤§çš„ä¼˜åŒ–ï¼Œåº•å±‚å®ç°ç”±ä¹‹å‰çš„ â€œæ•°ç»„+é“¾è¡¨â€ æ”¹ä¸º â€œæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘â€ã€‚JDK 1.8 çš„ HashMap çš„æ•°æ®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“é“¾è¡¨èŠ‚ç‚¹è¾ƒå°‘æ—¶ä»ç„¶æ˜¯ä»¥é“¾è¡¨å­˜åœ¨ï¼Œå½“é“¾è¡¨èŠ‚ç‚¹è¾ƒå¤šæ—¶ï¼ˆå¤§äº8ï¼‰ä¼šè½¬ä¸ºçº¢é»‘æ ‘ã€‚</p>
<p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/0.png"></p>
<p>1ã€æœ¬æ–‡ä¸­å¤´èŠ‚ç‚¹æŒ‡çš„æ˜¯ table è¡¨ä¸Šç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚</p>
<p>2ã€æ ¹èŠ‚ç‚¹ï¼ˆroot èŠ‚ç‚¹ï¼‰æŒ‡çš„æ˜¯çº¢é»‘æ ‘æœ€ä¸Šé¢çš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p>
<p>3ã€çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ä¸ä¸€å®šæ˜¯ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼‰ï¼ŒHashMap é€šè¿‡ moveRootToFront æ–¹æ³•æ¥ç»´æŒçº¢é»‘æ ‘çš„æ ¹ç»“ç‚¹å°±æ˜¯ç´¢å¼•ä½ç½®çš„å¤´ç»“ç‚¹ï¼Œä½†æ˜¯åœ¨ removeTreeNode æ–¹æ³•ä¸­ï¼Œå½“ movable ä¸º false æ—¶ï¼Œä¸ä¼šè°ƒç”¨ moveRootToFront æ–¹æ³•ï¼Œæ­¤æ—¶çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ä¸ä¸€å®šæ˜¯ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹ï¼Œè¯¥åœºæ™¯å‘ç”Ÿåœ¨ HashIterator çš„ remove æ–¹æ³•ä¸­ã€‚</p>
<p>4ã€è½¬ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹åï¼Œé“¾è¡¨çš„ç»“æ„è¿˜å­˜åœ¨ï¼Œé€šè¿‡ next å±æ€§ç»´æŒï¼Œçº¢é»‘æ ‘èŠ‚ç‚¹åœ¨è¿›è¡Œæ“ä½œæ—¶éƒ½ä¼šç»´æŠ¤é“¾è¡¨çš„ç»“æ„ï¼Œå¹¶ä¸æ˜¯è½¬ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œé“¾è¡¨ç»“æ„å°±ä¸å­˜åœ¨äº†ã€‚</p>
<p>5ã€åœ¨çº¢é»‘æ ‘ä¸Šï¼Œå¶å­èŠ‚ç‚¹ä¹Ÿå¯èƒ½æœ‰ next èŠ‚ç‚¹ï¼Œå› ä¸ºçº¢é»‘æ ‘çš„ç»“æ„è·Ÿé“¾è¡¨çš„ç»“æ„æ˜¯äº’ä¸å½±å“çš„ï¼Œä¸ä¼šå› ä¸ºæ˜¯å¶å­èŠ‚ç‚¹å°±è¯´è¯¥èŠ‚ç‚¹å·²ç»æ²¡æœ‰ next èŠ‚ç‚¹ã€‚</p>
<p>6ã€æºç ä¸­ä¸€äº›å˜é‡å®šä¹‰ï¼šå¦‚æœå®šä¹‰äº†ä¸€ä¸ªèŠ‚ç‚¹ pï¼Œåˆ™ plï¼ˆp leftï¼‰ä¸º p çš„å·¦èŠ‚ç‚¹ï¼Œprï¼ˆp rightï¼‰ä¸º p çš„å³èŠ‚ç‚¹ï¼Œppï¼ˆp parentï¼‰ä¸º p çš„çˆ¶èŠ‚ç‚¹ï¼Œphï¼ˆp hashï¼‰ä¸º p çš„ hash å€¼ï¼Œpkï¼ˆp keyï¼‰ä¸º p çš„ key å€¼ï¼Œkcï¼ˆkey classï¼‰ä¸º key çš„ç±»ç­‰ç­‰ã€‚æºç ä¸­å¾ˆå–œæ¬¢åœ¨ if/for ç­‰è¯­å¥ä¸­è¿›è¡Œèµ‹å€¼å¹¶åˆ¤æ–­ï¼Œè¯·æ³¨æ„ã€‚</p>
<p>7ã€é“¾è¡¨ä¸­ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹åªéœ€å¦‚ä¸‹å›¾æ“ä½œï¼Œå…¶ä»–æ“ä½œåŒç†ã€‚</p>
<p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/01.png"></p>
<p>8ã€çº¢é»‘æ ‘åœ¨ç»´æŠ¤é“¾è¡¨ç»“æ„æ—¶ï¼Œç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹åªéœ€å¦‚ä¸‹å›¾æ“ä½œï¼ˆçº¢é»‘æ ‘ä¸­å¢åŠ äº†ä¸€ä¸ª prev å±æ€§ï¼‰ï¼Œå…¶ä»–æ“ä½œåŒç†ã€‚æ³¨ï¼šæ­¤å¤„åªæ˜¯çº¢é»‘æ ‘ç»´æŠ¤é“¾è¡¨ç»“æ„çš„æ“ä½œï¼Œçº¢é»‘æ ‘è¿˜éœ€è¦å•ç‹¬è¿›è¡Œçº¢é»‘æ ‘çš„ç§»é™¤æˆ–è€…å…¶ä»–æ“ä½œã€‚</p>
<p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/02.png"></p>
<p>9ã€æºç ä¸­è¿›è¡Œçº¢é»‘æ ‘çš„æŸ¥æ‰¾æ—¶ï¼Œä¼šåå¤ç”¨åˆ°ä»¥ä¸‹ä¸¤æ¡è§„åˆ™ï¼š1ï¼‰å¦‚æœç›®æ ‡èŠ‚ç‚¹çš„ hash å€¼å°äº p èŠ‚ç‚¹çš„ hash å€¼ï¼Œåˆ™å‘ p èŠ‚ç‚¹çš„å·¦è¾¹éå†ï¼›å¦åˆ™å‘ p èŠ‚ç‚¹çš„å³è¾¹éå†ã€‚2ï¼‰å¦‚æœç›®æ ‡èŠ‚ç‚¹çš„ key å€¼å°äº p èŠ‚ç‚¹çš„ key å€¼ï¼Œåˆ™å‘ p èŠ‚ç‚¹çš„å·¦è¾¹éå†ï¼›å¦åˆ™å‘ p èŠ‚ç‚¹çš„å³è¾¹éå†ã€‚è¿™ä¸¤æ¡è§„åˆ™æ˜¯åˆ©ç”¨äº†çº¢é»‘æ ‘çš„ç‰¹æ€§ï¼ˆå·¦èŠ‚ç‚¹ &lt; æ ¹èŠ‚ç‚¹ &lt; å³èŠ‚ç‚¹ï¼‰ã€‚</p>
<p>10ã€æºç ä¸­è¿›è¡Œçº¢é»‘æ ‘çš„æŸ¥æ‰¾æ—¶ï¼Œä¼šç”¨ dirï¼ˆdirectionï¼‰æ¥è¡¨ç¤ºå‘å·¦è¿˜æ˜¯å‘å³æŸ¥æ‰¾ï¼Œdir å­˜å‚¨çš„å€¼æ˜¯ç›®æ ‡èŠ‚ç‚¹çš„ hash/key ä¸ p èŠ‚ç‚¹çš„ hash/key çš„æ¯”è¾ƒç»“æœã€‚</p>
<h1 id="æ„é€ å‡½æ•°">æ„é€ å‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#æ„é€ å‡½æ•°">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>// <span style="color:#f00">é»˜è®¤æ„é€ å‡½æ•°ã€‚</span>
</span></span><span style="display:flex;"><span>HashMap()
</span></span><span style="display:flex;"><span>// <span style="color:#f00">æŒ‡å®šâ€œå®¹é‡å¤§å°â€çš„æ„é€ å‡½æ•°</span>
</span></span><span style="display:flex;"><span>HashMap(int capacity)
</span></span><span style="display:flex;"><span>// <span style="color:#f00">æŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æ„é€ å‡½æ•°</span>
</span></span><span style="display:flex;"><span>HashMap(int capacity, float loadFactor)
</span></span><span style="display:flex;"><span>// <span style="color:#f00">åŒ…å«â€œå­</span>Map<span style="color:#f00">â€çš„æ„é€ å‡½æ•°</span>
</span></span><span style="display:flex;"><span>HashMap(Map&lt;<span style="color:#f00">?</span> <span style="color:#fff;font-weight:bold">extends</span> K, <span style="color:#f00">?</span> <span style="color:#fff;font-weight:bold">extends</span> V&gt; map)
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="api">API<a hidden class="anchor" aria-hidden="true" href="#api">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>void                 clear()
</span></span><span style="display:flex;"><span>Object               clone()
</span></span><span style="display:flex;"><span>boolean              containsKey(Object key)
</span></span><span style="display:flex;"><span>boolean              containsValue(Object value)
</span></span><span style="display:flex;"><span>Set&lt;Entry&lt;K, V&gt;&gt;     entrySet()
</span></span><span style="display:flex;"><span>V                    get(Object key)
</span></span><span style="display:flex;"><span>boolean              isEmpty()
</span></span><span style="display:flex;"><span>Set&lt;K&gt;               keySet()
</span></span><span style="display:flex;"><span>V                    put(K key, V value)
</span></span><span style="display:flex;"><span>void                 putAll(Map&lt;<span style="color:#f00">?</span> <span style="color:#fff;font-weight:bold">extends</span> K, <span style="color:#f00">?</span> <span style="color:#fff;font-weight:bold">extends</span> V&gt; map)
</span></span><span style="display:flex;"><span>V                    remove(Object key)
</span></span><span style="display:flex;"><span>int                  size()
</span></span><span style="display:flex;"><span>Collection&lt;V&gt;        values()
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„<a hidden class="anchor" aria-hidden="true" href="#æ•°æ®ç»“æ„">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>java.lang.Object
</span></span><span style="display:flex;"><span>   <span style="color:#f00">â†³</span>     java.util.AbstractMap&lt;K, V&gt;
</span></span><span style="display:flex;"><span>         <span style="color:#f00">â†³</span>     java.util.HashMap&lt;K, V&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>public <span style="color:#fff;font-weight:bold">class</span> HashMap&lt;K,V&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">extends</span> AbstractMap&lt;K,V&gt;
</span></span><span style="display:flex;"><span>    implements Map&lt;K,V&gt;, Cloneable, Serializable { }
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/1.jpg">
ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li>HashMapç»§æ‰¿äºAbstractMapç±»ï¼Œå®ç°äº†Mapæ¥å£ã€‚Mapæ˜¯&quot;key-valueé”®å€¼å¯¹&quot;æ¥å£ï¼ŒAbstractMapå®ç°äº†&quot;é”®å€¼å¯¹&quot;çš„é€šç”¨å‡½æ•°æ¥å£ã€‚</li>
<li>HashMapæ˜¯é€šè¿‡&quot;æ‹‰é“¾æ³•&quot;å®ç°çš„å“ˆå¸Œè¡¨ã€‚å®ƒåŒ…æ‹¬å‡ ä¸ªé‡è¦çš„æˆå‘˜å˜é‡ï¼štable, size, threshold, loadFactor, modCountã€‚
tableæ˜¯ä¸€ä¸ªEntry[]æ•°ç»„ç±»å‹ï¼Œè€ŒEntryå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ã€‚å“ˆå¸Œè¡¨çš„&quot;key-valueé”®å€¼å¯¹&quot;éƒ½æ˜¯å­˜å‚¨åœ¨Entryæ•°ç»„ä¸­çš„ã€‚
sizeæ˜¯HashMapçš„å¤§å°ï¼Œå®ƒæ˜¯HashMapä¿å­˜çš„é”®å€¼å¯¹çš„æ•°é‡ã€‚
thresholdæ˜¯HashMapçš„é˜ˆå€¼ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒæ•´HashMapçš„å®¹é‡ã€‚thresholdçš„å€¼=<code>å®¹é‡*åŠ è½½å› å­</code>ï¼Œå½“HashMapä¸­å­˜å‚¨æ•°æ®çš„æ•°é‡è¾¾åˆ°thresholdæ—¶ï¼Œå°±éœ€è¦å°†HashMapçš„å®¹é‡åŠ å€ã€‚
loadFactorå°±æ˜¯åŠ è½½å› å­ã€‚
modCountæ˜¯ç”¨æ¥å®ç°fail-fastæœºåˆ¶çš„ã€‚</li>
</ul>
<h1 id="hashmapæ„é€ å‡½æ•°">HashMapæ„é€ å‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#hashmapæ„é€ å‡½æ•°">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// é»˜è®¤æ„é€ å‡½æ•°ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> HashMap() {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®¾ç½®â€œåŠ è½½å› å­â€</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">loadFactor</span> = DEFAULT_LOAD_FACTOR;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®¾ç½®â€œHashMapé˜ˆå€¼â€ï¼Œå½“HashMapä¸­å­˜å‚¨æ•°æ®çš„æ•°é‡è¾¾åˆ°thresholdæ—¶ï¼Œå°±éœ€è¦å°†HashMapçš„å®¹é‡åŠ å€ã€‚</span>
</span></span><span style="display:flex;"><span>    threshold = (<span style="color:#fff;font-weight:bold">int</span>)(DEFAULT_INITIAL_CAPACITY * DEFAULT_LOAD_FACTOR);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ›å»ºEntryæ•°ç»„ï¼Œç”¨æ¥ä¿å­˜æ•°æ®</span>
</span></span><span style="display:flex;"><span>    table = <span style="color:#fff;font-weight:bold">new</span> Entry[DEFAULT_INITIAL_CAPACITY];
</span></span><span style="display:flex;"><span>    init();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æ„é€ å‡½æ•°</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> HashMap(<span style="color:#fff;font-weight:bold">int</span> initialCapacity, <span style="color:#fff;font-weight:bold">float</span> loadFactor) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (initialCapacity &lt; 0)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalArgumentException(<span style="color:#0ff;font-weight:bold">&#34;Illegal initial capacity: &#34;</span> +
</span></span><span style="display:flex;"><span>                                           initialCapacity);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// HashMapçš„æœ€å¤§å®¹é‡åªèƒ½æ˜¯MAXIMUM_CAPACITY</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)
</span></span><span style="display:flex;"><span>        initialCapacity = MAXIMUM_CAPACITY;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (loadFactor &lt;= 0 || Float.<span style="color:#007f7f">isNaN</span>(loadFactor))
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalArgumentException(<span style="color:#0ff;font-weight:bold">&#34;Illegal load factor: &#34;</span> +
</span></span><span style="display:flex;"><span>                                           loadFactor);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Find a power of 2 &gt;= initialCapacity</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> capacity = 1;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> (capacity &lt; initialCapacity)
</span></span><span style="display:flex;"><span>        capacity &lt;&lt;= 1;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®¾ç½®â€œåŠ è½½å› å­â€</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">loadFactor</span> = loadFactor;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®¾ç½®â€œHashMapé˜ˆå€¼â€ï¼Œå½“HashMapä¸­å­˜å‚¨æ•°æ®çš„æ•°é‡è¾¾åˆ°thresholdæ—¶ï¼Œå°±éœ€è¦å°†HashMapçš„å®¹é‡åŠ å€ã€‚</span>
</span></span><span style="display:flex;"><span>    threshold = (<span style="color:#fff;font-weight:bold">int</span>)(capacity * loadFactor);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ›å»ºEntryæ•°ç»„ï¼Œç”¨æ¥ä¿å­˜æ•°æ®</span>
</span></span><span style="display:flex;"><span>    table = <span style="color:#fff;font-weight:bold">new</span> Entry[capacity];
</span></span><span style="display:flex;"><span>    init();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æŒ‡å®šâ€œå®¹é‡å¤§å°â€çš„æ„é€ å‡½æ•°</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> HashMap(<span style="color:#fff;font-weight:bold">int</span> initialCapacity) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åŒ…å«â€œå­Mapâ€çš„æ„é€ å‡½æ•°</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> HashMap(Map&lt;? <span style="color:#fff;font-weight:bold">extends</span> K, ? <span style="color:#fff;font-weight:bold">extends</span> V&gt; m) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>(Math.<span style="color:#007f7f">max</span>((<span style="color:#fff;font-weight:bold">int</span>) (m.<span style="color:#007f7f">size</span>() / DEFAULT_LOAD_FACTOR) + 1,
</span></span><span style="display:flex;"><span>                  DEFAULT_INITIAL_CAPACITY), DEFAULT_LOAD_FACTOR);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å°†mä¸­çš„å…¨éƒ¨å…ƒç´ é€ä¸ªæ·»åŠ åˆ°HashMapä¸­</span>
</span></span><span style="display:flex;"><span>    putAllForCreate(m);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="hashmapçš„åŸºæœ¬å±æ€§">HashMapçš„åŸºæœ¬å±æ€§<a hidden class="anchor" aria-hidden="true" href="#hashmapçš„åŸºæœ¬å±æ€§">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// é»˜è®¤å®¹é‡16ï¼Œå¿…é¡»æ˜¯2çš„å¹‚</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æœ€å¤§å®¹é‡ï¼ˆå¿…é¡»æ˜¯2çš„å¹‚ä¸”å°äº2çš„30æ¬¡æ–¹ï¼Œä¼ å…¥å®¹é‡è¿‡å¤§å°†è¢«è¿™ä¸ªå€¼æ›¿æ¢ï¼‰</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> MAXIMUM_CAPACITY = 1 &lt;&lt; 30;    
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// é»˜è®¤è´Ÿè½½å› å­0.75</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">float</span> DEFAULT_LOAD_FACTOR = 0.<span style="color:#007f7f">75f</span>; 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// é“¾è¡¨èŠ‚ç‚¹è½¬æ¢çº¢é»‘æ ‘èŠ‚ç‚¹çš„é˜ˆå€¼, 9ä¸ªèŠ‚ç‚¹è½¬</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> TREEIFY_THRESHOLD = 8; 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// çº¢é»‘æ ‘èŠ‚ç‚¹è½¬æ¢é“¾è¡¨èŠ‚ç‚¹çš„é˜ˆå€¼, 6ä¸ªèŠ‚ç‚¹è½¬</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> UNTREEIFY_THRESHOLD = 6;   
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è½¬çº¢é»‘æ ‘æ—¶, tableçš„æœ€å°é•¿åº¦</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> MIN_TREEIFY_CAPACITY = 64; 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// é“¾è¡¨èŠ‚ç‚¹, ç»§æ‰¿è‡ªEntry</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> Node&lt;K,V&gt; <span style="color:#fff;font-weight:bold">implements</span> Map.<span style="color:#007f7f">Entry</span>&lt;K,V&gt; {  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> hash;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> K key;
</span></span><span style="display:flex;"><span>    V value;
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt; next;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ... ...</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// çº¢é»‘æ ‘èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">class</span> TreeNode&lt;K,V&gt; <span style="color:#fff;font-weight:bold">extends</span> LinkedHashMap.<span style="color:#007f7f">Entry</span>&lt;K,V&gt; {
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; parent;  <span style="color:#007f7f">// red-black tree links</span>
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; left;
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; right;
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; prev;    <span style="color:#007f7f">// needed to unlink next upon deletion</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> red;
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ...</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="å®šä½å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®">å®šä½å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®<a hidden class="anchor" aria-hidden="true" href="#å®šä½å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®">#</a></h1>
<p>ä¸ç®¡å¢åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾é”®å€¼å¯¹ï¼Œå®šä½åˆ°å“ˆå¸Œæ¡¶æ•°ç»„çš„ä½ç½®éƒ½æ˜¯å¾ˆå…³é”®çš„ç¬¬ä¸€æ­¥ã€‚å‰é¢è¯´è¿‡ HashMap çš„æ•°æ®ç»“æ„æ˜¯â€œæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘â€çš„ç»“åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å¸Œæœ›è¿™ä¸ª HashMap é‡Œé¢çš„å…ƒç´ ä½ç½®å°½é‡åˆ†å¸ƒå‡åŒ€äº›ï¼Œå°½é‡ä½¿å¾—æ¯ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ•°é‡åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç”¨ hash ç®—æ³•æ±‚å¾—è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œé©¬ä¸Šå°±å¯ä»¥çŸ¥é“å¯¹åº”ä½ç½®çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œä¸ç”¨éå†é“¾è¡¨/çº¢é»‘æ ‘ï¼Œå¤§å¤§ä¼˜åŒ–äº†æŸ¥è¯¢çš„æ•ˆç‡ã€‚HashMap å®šä½æ•°ç»„ç´¢å¼•ä½ç½®ï¼Œç›´æ¥å†³å®šäº† hash æ–¹æ³•çš„ç¦»æ•£æ€§èƒ½ã€‚ä¸‹é¢æ˜¯å®šä½å“ˆå¸Œæ¡¶æ•°ç»„çš„æºç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// ä»£ç 1</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> hash(Object key) { <span style="color:#007f7f">// è®¡ç®—keyçš„hashå€¼</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> h;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.å…ˆæ‹¿åˆ°keyçš„hashCodeå€¼; 2.å°†hashCodeçš„é«˜16ä½å‚ä¸è¿ç®—</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> (key == <span style="color:#fff;font-weight:bold">null</span>) ? 0 : (h = key.<span style="color:#007f7f">hashCode</span>()) ^ (h &gt;&gt;&gt; 16);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä»£ç 2</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> n = tab.<span style="color:#007f7f">length</span>;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å°†(tab.length - 1) ä¸ hashå€¼è¿›è¡Œ&amp;è¿ç®—</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">int</span> index = (n - 1) &amp; hash;
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•´ä¸ªè¿‡ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯ä¸‰æ­¥ï¼š</p>
<ol>
<li>æ‹¿åˆ° key çš„ hashCode å€¼</li>
<li>å°† hashCode çš„é«˜ä½å‚ä¸è¿ç®—ï¼Œé‡æ–°è®¡ç®— hash å€¼</li>
<li>å°†è®¡ç®—å‡ºæ¥çš„ hash å€¼ä¸ (table.length - 1) è¿›è¡Œ &amp; è¿ç®—</li>
</ol>
<p>å¯¹äºä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„ hashCode() è¿”å›å€¼ç›¸åŒï¼Œé‚£ä¹ˆè®¡ç®—å¾—åˆ°çš„ hash å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠ hash å€¼å¯¹ table é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚</p>
<p>ä½†æ˜¯æ¨¡è¿ç®—æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæˆ‘ä»¬çŸ¥é“è®¡ç®—æœºæ¯”è¾ƒå¿«çš„è¿ç®—ä¸ºä½è¿ç®—ï¼Œå› æ­¤ JDK å›¢é˜Ÿå¯¹å–æ¨¡è¿ç®—è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½¿ç”¨ä¸Šé¢ä»£ç 2çš„ä½ä¸è¿ç®—æ¥ä»£æ›¿æ¨¡è¿ç®—ã€‚è¿™ä¸ªæ–¹æ³•éå¸¸å·§å¦™ï¼Œå®ƒé€šè¿‡ â€œ(table.length -1) &amp; hâ€ æ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ç´¢å¼•ä½ç½®ï¼Œè¿™ä¸ªä¼˜åŒ–æ˜¯åŸºäºä»¥ä¸‹å…¬å¼ï¼šx mod 2^n = x &amp; (2^n - 1)ã€‚æˆ‘ä»¬çŸ¥é“ HashMap åº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼Œå¹¶ä¸”å–æ¨¡è¿ç®—ä¸º â€œh mod table.lengthâ€ï¼Œå¯¹åº”ä¸Šé¢çš„å…¬å¼ï¼Œå¯ä»¥å¾—åˆ°è¯¥è¿ç®—ç­‰åŒäºâ€œh &amp; (table.length - 1)â€ã€‚è¿™æ˜¯ HashMap åœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ï¼Œå› ä¸º &amp; æ¯” % å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚</p>
<p>åœ¨ JDK1.8 çš„å®ç°ä¸­ï¼Œè¿˜ä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œå°† hashCode çš„é«˜ 16 ä½ä¸ hashCode è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨ table çš„ length è¾ƒå°çš„æ—¶å€™ï¼Œè®©é«˜ä½ä¹Ÿå‚ä¸è¿ç®—ï¼Œå¹¶ä¸”ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚</p>
<p>ä¸‹å›¾æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<p>å½“ table é•¿åº¦ä¸º 16 æ—¶ï¼Œtable.length - 1 = 15 ï¼Œç”¨äºŒè¿›åˆ¶æ¥çœ‹ï¼Œæ­¤æ—¶ä½ 4 ä½å…¨æ˜¯ 1ï¼Œé«˜ 28 ä½å…¨æ˜¯ 0ï¼Œä¸ 0 è¿›è¡Œ &amp; è¿ç®—å¿…ç„¶ä¸º 0ï¼Œå› æ­¤æ­¤æ—¶ hashCode ä¸ â€œtable.length - 1â€ çš„ &amp; è¿ç®—ç»“æœåªå–å†³äº hashCode çš„ä½ 4 ä½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒhashCode çš„é«˜ 28 ä½å°±æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œå¹¶ä¸”ç”±äº hash ç»“æœåªå–å†³äº hashCode çš„ä½ 4 ä½ï¼Œhash å†²çªçš„æ¦‚ç‡ä¹Ÿä¼šå¢åŠ ã€‚å› æ­¤ï¼Œåœ¨ JDK 1.8 ä¸­ï¼Œå°†é«˜ä½ä¹Ÿå‚ä¸è®¡ç®—ï¼Œç›®çš„æ˜¯ä¸ºäº†é™ä½ hash å†²çªçš„æ¦‚ç‡ã€‚</p>
<p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/2.png"></p>
<h1 id="get-æ–¹æ³•">get æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#get-æ–¹æ³•">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> V get(Object key) {
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt; e;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> (e = getNode(hash(key), key)) == <span style="color:#fff;font-weight:bold">null</span> ? <span style="color:#fff;font-weight:bold">null</span> : e.<span style="color:#007f7f">value</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> Node&lt;K,V&gt; getNode(<span style="color:#fff;font-weight:bold">int</span> hash, Object key) {
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span style="color:#fff;font-weight:bold">int</span> n; K k;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.å¯¹tableè¿›è¡Œæ ¡éªŒï¼štableä¸ä¸ºç©º &amp;&amp; tableé•¿åº¦å¤§äº0 &amp;&amp; </span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// tableç´¢å¼•ä½ç½®(ä½¿ç”¨table.length - 1å’Œhashå€¼è¿›è¡Œä½ä¸è¿ç®—)çš„èŠ‚ç‚¹ä¸ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> ((tab = table) != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; (n = tab.<span style="color:#007f7f">length</span>) &gt; 0 &amp;&amp;
</span></span><span style="display:flex;"><span>        (first = tab[(n - 1) &amp; hash]) != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.æ£€æŸ¥firstèŠ‚ç‚¹çš„hashå€¼å’Œkeyæ˜¯å¦å’Œå…¥å‚çš„ä¸€æ ·ï¼Œå¦‚æœä¸€æ ·åˆ™firstå³ä¸ºç›®æ ‡èŠ‚ç‚¹ï¼Œç›´æ¥è¿”å›firstèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (first.<span style="color:#007f7f">hash</span> == hash &amp;&amp; <span style="color:#007f7f">// always check first node</span>
</span></span><span style="display:flex;"><span>            ((k = first.<span style="color:#007f7f">key</span>) == key || (key != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; key.<span style="color:#007f7f">equals</span>(k))))
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> first;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 3.å¦‚æœfirstä¸æ˜¯ç›®æ ‡èŠ‚ç‚¹ï¼Œå¹¶ä¸”firstçš„nextèŠ‚ç‚¹ä¸ä¸ºç©ºåˆ™ç»§ç»­éå†</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((e = first.<span style="color:#007f7f">next</span>) != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (first <span style="color:#fff;font-weight:bold">instanceof</span> TreeNode)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 4.å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹æ–¹æ³•getTreeNode</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> ((TreeNode&lt;K,V&gt;)first).<span style="color:#007f7f">getTreeNode</span>(hash, key);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 5.æ‰§è¡Œé“¾è¡¨èŠ‚ç‚¹çš„æŸ¥æ‰¾ï¼Œå‘ä¸‹éå†é“¾è¡¨, ç›´è‡³æ‰¾åˆ°èŠ‚ç‚¹çš„keyå’Œå…¥å‚çš„keyç›¸ç­‰æ—¶,è¿”å›è¯¥èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (e.<span style="color:#007f7f">hash</span> == hash &amp;&amp;
</span></span><span style="display:flex;"><span>                    ((k = e.<span style="color:#007f7f">key</span>) == key || (key != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; key.<span style="color:#007f7f">equals</span>(k))))
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">return</span> e;
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">while</span> ((e = e.<span style="color:#007f7f">next</span>) != <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 6.æ‰¾ä¸åˆ°ç¬¦åˆçš„è¿”å›ç©º</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹æ–¹æ³• getTreeNodeï¼Œè§ä»£ç å—1è¯¦è§£</p>
<h2 id="ä»£ç å—1gettreenode">ä»£ç å—1ï¼šgetTreeNode<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—1gettreenode">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> TreeNode&lt;K,V&gt; getTreeNode(<span style="color:#fff;font-weight:bold">int</span> h, Object k) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.é¦–å…ˆæ‰¾åˆ°çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ï¼›2.ä½¿ç”¨æ ¹èŠ‚ç‚¹è°ƒç”¨findæ–¹æ³•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> ((parent != <span style="color:#fff;font-weight:bold">null</span>) ? root() : <span style="color:#fff;font-weight:bold">this</span>).<span style="color:#007f7f">find</span>(h, k, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ ¹èŠ‚ç‚¹è°ƒç”¨ find æ–¹æ³•ï¼Œè§ä»£ç å—2è¯¦è§£</p>
<h2 id="ä»£ç å—2find">ä»£ç å—2ï¼šfind<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—2find">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * ä»è°ƒç”¨æ­¤æ–¹æ³•çš„èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾, é€šè¿‡hashå€¼å’Œkeyæ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * æ­¤æ–¹æ³•æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹çš„æŸ¥æ‰¾, çº¢é»‘æ ‘æ˜¯ç‰¹æ®Šçš„è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„ç‰¹ç‚¹ï¼šå·¦èŠ‚ç‚¹&lt;æ ¹èŠ‚ç‚¹&lt;å³èŠ‚ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> TreeNode&lt;K,V&gt; find(<span style="color:#fff;font-weight:bold">int</span> h, Object k, Class&lt;?&gt; kc) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.å°†pèŠ‚ç‚¹èµ‹å€¼ä¸ºè°ƒç”¨æ­¤æ–¹æ³•çš„èŠ‚ç‚¹ï¼Œå³ä¸ºçº¢é»‘æ ‘æ ¹èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; p = <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 2.ä»pèŠ‚ç‚¹å¼€å§‹å‘ä¸‹éå†</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> ph, dir; K pk;
</span></span><span style="display:flex;"><span>        TreeNode&lt;K,V&gt; pl = p.<span style="color:#007f7f">left</span>, pr = p.<span style="color:#007f7f">right</span>, q;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 3.å¦‚æœä¼ å…¥çš„hashå€¼å°äºpèŠ‚ç‚¹çš„hashå€¼ï¼Œåˆ™å¾€pèŠ‚ç‚¹çš„å·¦è¾¹éå†</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((ph = p.<span style="color:#007f7f">hash</span>) &gt; h)
</span></span><span style="display:flex;"><span>            p = pl;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (ph &lt; h) <span style="color:#007f7f">// 4.å¦‚æœä¼ å…¥çš„hashå€¼å¤§äºpèŠ‚ç‚¹çš„hashå€¼ï¼Œåˆ™å¾€pèŠ‚ç‚¹çš„å³è¾¹éå†</span>
</span></span><span style="display:flex;"><span>            p = pr;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 5.å¦‚æœä¼ å…¥çš„hashå€¼å’Œkeyå€¼ç­‰äºpèŠ‚ç‚¹çš„hashå€¼å’Œkeyå€¼,åˆ™pèŠ‚ç‚¹ä¸ºç›®æ ‡èŠ‚ç‚¹,è¿”å›pèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> ((pk = p.<span style="color:#007f7f">key</span>) == k || (k != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; k.<span style="color:#007f7f">equals</span>(pk)))
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> p;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (pl == <span style="color:#fff;font-weight:bold">null</span>)    <span style="color:#007f7f">// 6.pèŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ä¸ºç©ºåˆ™å°†å‘å³éå†</span>
</span></span><span style="display:flex;"><span>            p = pr;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (pr == <span style="color:#fff;font-weight:bold">null</span>)    <span style="color:#007f7f">// 7.pèŠ‚ç‚¹çš„å³èŠ‚ç‚¹ä¸ºç©ºåˆ™å‘å·¦éå†</span>
</span></span><span style="display:flex;"><span>            p = pl;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 8.å°†pèŠ‚ç‚¹ä¸kè¿›è¡Œæ¯”è¾ƒ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> ((kc != <span style="color:#fff;font-weight:bold">null</span> ||
</span></span><span style="display:flex;"><span>                  (kc = comparableClassFor(k)) != <span style="color:#fff;font-weight:bold">null</span>) &amp;&amp; <span style="color:#007f7f">// 8.1 kcä¸ä¸ºç©ºä»£è¡¨kå®ç°äº†Comparable</span>
</span></span><span style="display:flex;"><span>                 (dir = compareComparables(kc, k, pk)) != 0)<span style="color:#007f7f">// 8.2 k&lt;pkåˆ™dir&lt;0, k&gt;pkåˆ™dir&gt;0</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 8.3 k&lt;pkåˆ™å‘å·¦éå†(pèµ‹å€¼ä¸ºpçš„å·¦èŠ‚ç‚¹), å¦åˆ™å‘å³éå†</span>
</span></span><span style="display:flex;"><span>            p = (dir &lt; 0) ? pl : pr;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 9.ä»£ç èµ°åˆ°æ­¤å¤„, ä»£è¡¨keyæ‰€å±ç±»æ²¡æœ‰å®ç°Comparable, ç›´æ¥æŒ‡å®šå‘pçš„å³è¾¹éå†</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> ((q = pr.<span style="color:#007f7f">find</span>(h, k, kc)) != <span style="color:#fff;font-weight:bold">null</span>) 
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> q;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 10.ä»£ç èµ°åˆ°æ­¤å¤„ä»£è¡¨â€œpr.find(h, k, kc)â€ä¸ºç©º, å› æ­¤ç›´æ¥å‘å·¦éå†</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            p = pl;
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">while</span> (p != <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°† p èŠ‚ç‚¹ä¸ k è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¼ å…¥çš„ keyï¼ˆå³ä»£ç ä¸­çš„å‚æ•° kï¼‰æ‰€å±çš„ç±»å®ç°äº† Comparable æ¥å£ï¼ˆkc ä¸ä¸ºç©ºï¼ŒcomparableClassFor æ–¹æ³•è§ä»£ç å—3è¯¦è§£ï¼‰ï¼Œåˆ™å°† k è·Ÿ p èŠ‚ç‚¹çš„ key è¿›è¡Œæ¯”è¾ƒï¼ˆkc å®ç°äº† Comparable æ¥å£ï¼Œå› æ­¤é€šè¿‡ kc çš„æ¯”è¾ƒæ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼‰ï¼Œå¹¶å°†æ¯”è¾ƒç»“æœèµ‹å€¼ç»™ dirï¼Œå¦‚æœ dir&lt;0 åˆ™ä»£è¡¨ k&lt;pkï¼Œåˆ™å‘ p èŠ‚ç‚¹çš„å·¦è¾¹éå†ï¼ˆplï¼‰ï¼›å¦åˆ™ï¼Œå‘ p èŠ‚ç‚¹çš„å³è¾¹éå†ï¼ˆprï¼‰ã€‚</p>
<h2 id="ä»£ç å—3comparableclassfor">ä»£ç å—3ï¼šcomparableClassFor<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—3comparableclassfor">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> Class&lt;?&gt; comparableClassFor(Object x) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.åˆ¤æ–­xæ˜¯å¦å®ç°äº†Comparableæ¥å£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (x <span style="color:#fff;font-weight:bold">instanceof</span> Comparable) {
</span></span><span style="display:flex;"><span>        Class&lt;?&gt; c; Type[] ts, as; Type t; ParameterizedType p;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.æ ¡éªŒxæ˜¯å¦ä¸ºStringç±»å‹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((c = x.<span style="color:#007f7f">getClass</span>()) == String.<span style="color:#007f7f">class</span>) <span style="color:#007f7f">// bypass checks</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> c;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((ts = c.<span style="color:#007f7f">getGenericInterfaces</span>()) != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.éå†xå®ç°çš„æ‰€æœ‰æ¥å£</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; ts.<span style="color:#007f7f">length</span>; ++i) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 4.å¦‚æœxå®ç°äº†Comparableæ¥å£ï¼Œåˆ™è¿”å›xçš„Class</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (((t = ts[i]) <span style="color:#fff;font-weight:bold">instanceof</span> ParameterizedType) &amp;&amp;
</span></span><span style="display:flex;"><span>                    ((p = (ParameterizedType)t).<span style="color:#007f7f">getRawType</span>() ==
</span></span><span style="display:flex;"><span>                     Comparable.<span style="color:#007f7f">class</span>) &amp;&amp;
</span></span><span style="display:flex;"><span>                    (as = p.<span style="color:#007f7f">getActualTypeArguments</span>()) != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp;
</span></span><span style="display:flex;"><span>                    as.<span style="color:#007f7f">length</span> == 1 &amp;&amp; as[0] == c) <span style="color:#007f7f">// type arg is c</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">return</span> c;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="putæ–¹æ³•">putæ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#putæ–¹æ³•">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> V put(K key, V value) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> putVal(hash(key), key, value, <span style="color:#fff;font-weight:bold">false</span>, <span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> V putVal(<span style="color:#fff;font-weight:bold">int</span> hash, K key, V value, <span style="color:#fff;font-weight:bold">boolean</span> onlyIfAbsent,
</span></span><span style="display:flex;"><span>               <span style="color:#fff;font-weight:bold">boolean</span> evict) {
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span style="color:#fff;font-weight:bold">int</span> n, i;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.æ ¡éªŒtableæ˜¯å¦ä¸ºç©ºæˆ–è€…lengthç­‰äº0ï¼Œå¦‚æœæ˜¯åˆ™è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> ((tab = table) == <span style="color:#fff;font-weight:bold">null</span> || (n = tab.<span style="color:#007f7f">length</span>) == 0)
</span></span><span style="display:flex;"><span>        n = (tab = resize()).<span style="color:#007f7f">length</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 2.é€šè¿‡hashå€¼è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå°†è¯¥ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹èµ‹å€¼ç»™pï¼Œå¦‚æœpä¸ºç©ºåˆ™ç›´æ¥åœ¨è¯¥ç´¢å¼•ä½ç½®æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹å³å¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> ((p = tab[i = (n - 1) &amp; hash]) == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        tab[i] = newNode(hash, key, value, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// tableè¡¨è¯¥ç´¢å¼•ä½ç½®ä¸ä¸ºç©ºï¼Œåˆ™è¿›è¡ŒæŸ¥æ‰¾</span>
</span></span><span style="display:flex;"><span>        Node&lt;K,V&gt; e; K k;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 3.åˆ¤æ–­pèŠ‚ç‚¹çš„keyå’Œhashå€¼æ˜¯å¦è·Ÿä¼ å…¥çš„ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰, åˆ™pèŠ‚ç‚¹å³ä¸ºè¦æŸ¥æ‰¾çš„ç›®æ ‡èŠ‚ç‚¹ï¼Œå°†pèŠ‚ç‚¹èµ‹å€¼ç»™eèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (p.<span style="color:#007f7f">hash</span> == hash &amp;&amp;
</span></span><span style="display:flex;"><span>            ((k = p.<span style="color:#007f7f">key</span>) == key || (key != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; key.<span style="color:#007f7f">equals</span>(k))))
</span></span><span style="display:flex;"><span>            e = p;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 4.åˆ¤æ–­pèŠ‚ç‚¹æ˜¯å¦ä¸ºTreeNode, å¦‚æœæ˜¯åˆ™è°ƒç”¨çº¢é»‘æ ‘çš„putTreeValæ–¹æ³•æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (p <span style="color:#fff;font-weight:bold">instanceof</span> TreeNode)
</span></span><span style="display:flex;"><span>            e = ((TreeNode&lt;K,V&gt;)p).<span style="color:#007f7f">putTreeVal</span>(<span style="color:#fff;font-weight:bold">this</span>, tab, hash, key, value);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 5.èµ°åˆ°è¿™ä»£è¡¨pèŠ‚ç‚¹ä¸ºæ™®é€šé“¾è¡¨èŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨æ™®é€šçš„é“¾è¡¨æ–¹æ³•è¿›è¡ŒæŸ¥æ‰¾ï¼Œä½¿ç”¨binCountç»Ÿè®¡é“¾è¡¨çš„èŠ‚ç‚¹æ•°</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> binCount = 0; ; ++binCount) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 6.å¦‚æœpçš„nextèŠ‚ç‚¹ä¸ºç©ºæ—¶ï¼Œåˆ™ä»£è¡¨æ‰¾ä¸åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œåˆ™æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹å¹¶æ’å…¥é“¾è¡¨å°¾éƒ¨</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> ((e = p.<span style="color:#007f7f">next</span>) == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                    p.<span style="color:#007f7f">next</span> = newNode(hash, key, value, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// 7.æ ¡éªŒèŠ‚ç‚¹æ•°æ˜¯å¦è¶…è¿‡8ä¸ªï¼Œå¦‚æœè¶…è¿‡åˆ™è°ƒç”¨treeifyBinæ–¹æ³•å°†é“¾è¡¨èŠ‚ç‚¹è½¬ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œ</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// å‡ä¸€æ˜¯å› ä¸ºå¾ªç¯æ˜¯ä»pèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹çš„</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">if</span> (binCount &gt;= TREEIFY_THRESHOLD - 1)
</span></span><span style="display:flex;"><span>                        treeifyBin(tab, hash);
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 8.å¦‚æœeèŠ‚ç‚¹å­˜åœ¨hashå€¼å’Œkeyå€¼éƒ½ä¸ä¼ å…¥çš„ç›¸åŒï¼Œåˆ™eèŠ‚ç‚¹å³ä¸ºç›®æ ‡èŠ‚ç‚¹ï¼Œè·³å‡ºå¾ªç¯</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (e.<span style="color:#007f7f">hash</span> == hash &amp;&amp;
</span></span><span style="display:flex;"><span>                    ((k = e.<span style="color:#007f7f">key</span>) == key || (key != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; key.<span style="color:#007f7f">equals</span>(k))))
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                p = e;  <span style="color:#007f7f">// å°†pæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 9.å¦‚æœeèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™ä»£è¡¨ç›®æ ‡èŠ‚ç‚¹å­˜åœ¨ï¼Œä½¿ç”¨ä¼ å…¥çš„valueè¦†ç›–è¯¥èŠ‚ç‚¹çš„valueï¼Œå¹¶è¿”å›oldValue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (e != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            V oldValue = e.<span style="color:#007f7f">value</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (!onlyIfAbsent || oldValue == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">value</span> = value;
</span></span><span style="display:flex;"><span>            afterNodeAccess(e); <span style="color:#007f7f">// ç”¨äºLinkedHashMap</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> oldValue;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ++modCount;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 10.å¦‚æœæ’å…¥èŠ‚ç‚¹åèŠ‚ç‚¹æ•°è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å®¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (++size &gt; threshold)
</span></span><span style="display:flex;"><span>        resize();
</span></span><span style="display:flex;"><span>    afterNodeInsertion(evict);  <span style="color:#007f7f">// ç”¨äºLinkedHashMap</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>æ ¡éªŒ table æ˜¯å¦ä¸ºç©ºæˆ–è€… length ç­‰äº0ï¼Œå¦‚æœæ˜¯åˆ™è°ƒç”¨ resize æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œ<strong>è§resizeæ–¹æ³•è¯¦è§£</strong></p>
</li>
<li>
<p>å¦‚æœ p èŠ‚ç‚¹ä¸æ˜¯ç›®æ ‡èŠ‚ç‚¹ï¼Œåˆ™åˆ¤æ–­ p èŠ‚ç‚¹æ˜¯å¦ä¸º TreeNodeï¼Œå¦‚æœæ˜¯åˆ™è°ƒç”¨çº¢é»‘æ ‘çš„ putTreeVal æ–¹æ³•æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹ï¼Œ<strong>è§ä»£ç å—4è¯¦è§£</strong></p>
</li>
<li>
<p>æ ¡éªŒèŠ‚ç‚¹æ•°æ˜¯å¦è¶…è¿‡ 8 ä¸ªï¼Œå¦‚æœè¶…è¿‡åˆ™è°ƒç”¨ treeifyBinæ–¹æ³• å°†é“¾è¡¨èŠ‚ç‚¹è½¬ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œ<strong>è§ä»£ç å—6è¯¦è§£</strong></p>
</li>
</ol>
<h2 id="ä»£ç å—4puttreeval">ä»£ç å—4ï¼šputTreeVal<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—4puttreeval">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * çº¢é»‘æ ‘çš„putæ“ä½œï¼Œçº¢é»‘æ ‘æ’å…¥ä¼šåŒæ—¶ç»´æŠ¤åŸæ¥çš„é“¾è¡¨å±æ€§, å³åŸæ¥çš„nextå±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> TreeNode&lt;K,V&gt; putTreeVal(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab,
</span></span><span style="display:flex;"><span>                               <span style="color:#fff;font-weight:bold">int</span> h, K k, V v) {
</span></span><span style="display:flex;"><span>    Class&lt;?&gt; kc = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> searched = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.æŸ¥æ‰¾æ ¹èŠ‚ç‚¹, ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹å¹¶ä¸ä¸€å®šä¸ºçº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; root = (parent != <span style="color:#fff;font-weight:bold">null</span>) ? root() : <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 2.å°†æ ¹èŠ‚ç‚¹èµ‹å€¼ç»™pèŠ‚ç‚¹ï¼Œå¼€å§‹è¿›è¡ŒæŸ¥æ‰¾</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (TreeNode&lt;K,V&gt; p = root;;) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> dir, ph; K pk;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 3.å¦‚æœä¼ å…¥çš„hashå€¼å°äºpèŠ‚ç‚¹çš„hashå€¼ï¼Œå°†dirèµ‹å€¼ä¸º-1ï¼Œä»£è¡¨å‘pçš„å·¦è¾¹æŸ¥æ‰¾æ ‘</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((ph = p.<span style="color:#007f7f">hash</span>) &gt; h)
</span></span><span style="display:flex;"><span>            dir = -1;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 4.å¦‚æœä¼ å…¥çš„hashå€¼å¤§äºpèŠ‚ç‚¹çš„hashå€¼ï¼Œ å°†dirèµ‹å€¼ä¸º1ï¼Œä»£è¡¨å‘pçš„å³è¾¹æŸ¥æ‰¾æ ‘</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (ph &lt; h)
</span></span><span style="display:flex;"><span>            dir = 1;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 5.å¦‚æœä¼ å…¥çš„hashå€¼å’Œkeyå€¼ç­‰äºpèŠ‚ç‚¹çš„hashå€¼å’Œkeyå€¼, åˆ™pèŠ‚ç‚¹å³ä¸ºç›®æ ‡èŠ‚ç‚¹, è¿”å›pèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> ((pk = p.<span style="color:#007f7f">key</span>) == k || (k != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; k.<span style="color:#007f7f">equals</span>(pk)))
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> p;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 6.å¦‚æœkæ‰€å±çš„ç±»æ²¡æœ‰å®ç°Comparableæ¥å£ æˆ–è€… kå’ŒpèŠ‚ç‚¹çš„keyç›¸ç­‰</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> ((kc == <span style="color:#fff;font-weight:bold">null</span> &amp;&amp;
</span></span><span style="display:flex;"><span>                  (kc = comparableClassFor(k)) == <span style="color:#fff;font-weight:bold">null</span>) ||
</span></span><span style="display:flex;"><span>                 (dir = compareComparables(kc, k, pk)) == 0) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 6.1 ç¬¬ä¸€æ¬¡ç¬¦åˆæ¡ä»¶, ä»pèŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹åˆ†åˆ«è°ƒç”¨findæ–¹æ³•è¿›è¡ŒæŸ¥æ‰¾, å¦‚æœæŸ¥æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹åˆ™è¿”å›</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (!searched) {
</span></span><span style="display:flex;"><span>                TreeNode&lt;K,V&gt; q, ch;
</span></span><span style="display:flex;"><span>                searched = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (((ch = p.<span style="color:#007f7f">left</span>) != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp;
</span></span><span style="display:flex;"><span>                     (q = ch.<span style="color:#007f7f">find</span>(h, k, kc)) != <span style="color:#fff;font-weight:bold">null</span>) ||
</span></span><span style="display:flex;"><span>                    ((ch = p.<span style="color:#007f7f">right</span>) != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp;
</span></span><span style="display:flex;"><span>                     (q = ch.<span style="color:#007f7f">find</span>(h, k, kc)) != <span style="color:#fff;font-weight:bold">null</span>))
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">return</span> q;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 6.2 å¦åˆ™ä½¿ç”¨å®šä¹‰çš„ä¸€å¥—è§„åˆ™æ¥æ¯”è¾ƒkå’ŒpèŠ‚ç‚¹çš„keyçš„å¤§å°, ç”¨æ¥å†³å®šå‘å·¦è¿˜æ˜¯å‘å³æŸ¥æ‰¾</span>
</span></span><span style="display:flex;"><span>            dir = tieBreakOrder(k, pk); <span style="color:#007f7f">// dir&lt;0åˆ™ä»£è¡¨k&lt;pkï¼Œåˆ™å‘på·¦è¾¹æŸ¥æ‰¾ï¼›åä¹‹äº¦ç„¶</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        TreeNode&lt;K,V&gt; xp = p;   <span style="color:#007f7f">// xpèµ‹å€¼ä¸ºxçš„çˆ¶èŠ‚ç‚¹,ä¸­é—´å˜é‡,ç”¨äºä¸‹é¢ç»™xçš„çˆ¶èŠ‚ç‚¹èµ‹å€¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 7.dir&lt;=0åˆ™å‘på·¦è¾¹æŸ¥æ‰¾,å¦åˆ™å‘på³è¾¹æŸ¥æ‰¾,å¦‚æœä¸ºnull,åˆ™ä»£è¡¨è¯¥ä½ç½®å³ä¸ºxçš„ç›®æ ‡ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((p = (dir &lt;= 0) ? p.<span style="color:#007f7f">left</span> : p.<span style="color:#007f7f">right</span>) == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// èµ°è¿›æ¥ä»£è¡¨å·²ç»æ‰¾åˆ°xçš„ä½ç½®ï¼Œåªéœ€å°†xæ”¾åˆ°è¯¥ä½ç½®å³å¯</span>
</span></span><span style="display:flex;"><span>            Node&lt;K,V&gt; xpn = xp.<span style="color:#007f7f">next</span>;    <span style="color:#007f7f">// xpçš„nextèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 8.åˆ›å»ºæ–°çš„èŠ‚ç‚¹, å…¶ä¸­xçš„nextèŠ‚ç‚¹ä¸ºxpn, å³å°†xèŠ‚ç‚¹æ’å…¥xpä¸xpnä¹‹é—´</span>
</span></span><span style="display:flex;"><span>            TreeNode&lt;K,V&gt; x = map.<span style="color:#007f7f">newTreeNode</span>(h, k, v, xpn);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 9.è°ƒæ•´xã€xpã€xpnä¹‹é—´çš„å±æ€§å…³ç³»</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (dir &lt;= 0)   <span style="color:#007f7f">// å¦‚æœæ—¶dir &lt;= 0, åˆ™ä»£è¡¨xèŠ‚ç‚¹ä¸ºxpçš„å·¦èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                xp.<span style="color:#007f7f">left</span> = x;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span>        <span style="color:#007f7f">// å¦‚æœæ—¶dir&gt; 0, åˆ™ä»£è¡¨xèŠ‚ç‚¹ä¸ºxpçš„å³èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                xp.<span style="color:#007f7f">right</span> = x;
</span></span><span style="display:flex;"><span>            xp.<span style="color:#007f7f">next</span> = x;    <span style="color:#007f7f">// å°†xpçš„nextèŠ‚ç‚¹è®¾ç½®ä¸ºx</span>
</span></span><span style="display:flex;"><span>            x.<span style="color:#007f7f">parent</span> = x.<span style="color:#007f7f">prev</span> = xp; <span style="color:#007f7f">// å°†xçš„parentå’ŒprevèŠ‚ç‚¹è®¾ç½®ä¸ºxp</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¦‚æœxpnä¸ä¸ºç©º,åˆ™å°†xpnçš„prevèŠ‚ç‚¹è®¾ç½®ä¸ºxèŠ‚ç‚¹,ä¸ä¸Šæ–‡çš„xèŠ‚ç‚¹çš„nextèŠ‚ç‚¹å¯¹åº”</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (xpn != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>                ((TreeNode&lt;K,V&gt;)xpn).<span style="color:#007f7f">prev</span> = x;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 10.è¿›è¡Œçº¢é»‘æ ‘çš„æ’å…¥å¹³è¡¡è°ƒæ•´</span>
</span></span><span style="display:flex;"><span>            moveRootToFront(tab, balanceInsertion(root, x));
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>ç¬¬ä¸€æ¬¡ç¬¦åˆæ¡ä»¶ï¼Œä» p èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹åˆ†åˆ«è°ƒç”¨ find æ–¹æ³•ï¼ˆ<strong>è§ä»£ç å—2è¯¦è§£</strong>ï¼‰è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæŸ¥æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹åˆ™è¿”å›</li>
<li>å¦åˆ™ä½¿ç”¨å®šä¹‰çš„ä¸€å¥—è§„åˆ™æ¥æ¯”è¾ƒ k å’Œ p èŠ‚ç‚¹çš„ key çš„å¤§å°ï¼Œç”¨æ¥å†³å®šå‘å·¦è¿˜æ˜¯å‘å³æŸ¥æ‰¾ï¼Œ<em><strong>*è§ä»£ç å—5è¯¦è§£*</strong></em>ã€‚</li>
<li>è¿›è¡Œçº¢é»‘æ ‘çš„æ’å…¥å¹³è¡¡è°ƒæ•´ï¼Œè§æ–‡æœ«çš„****è§£é‡Š2****ã€‚</li>
</ol>
<h2 id="ä»£ç å—5tiebreakorder">ä»£ç å—5ï¼štieBreakOrder<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—5tiebreakorder">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// ç”¨äºä¸å¯æ¯”è¾ƒæˆ–è€…hashCodeç›¸åŒæ—¶è¿›è¡Œæ¯”è¾ƒçš„æ–¹æ³•, åªæ˜¯ä¸€ä¸ªä¸€è‡´çš„æ’å…¥è§„åˆ™ï¼Œç”¨æ¥ç»´æŠ¤é‡å®šä½çš„ç­‰ä»·æ€§ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">int</span> tieBreakOrder(Object a, Object b) {  
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> d;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (a == <span style="color:#fff;font-weight:bold">null</span> || b == <span style="color:#fff;font-weight:bold">null</span> ||
</span></span><span style="display:flex;"><span>        (d = a.<span style="color:#007f7f">getClass</span>().<span style="color:#007f7f">getName</span>().
</span></span><span style="display:flex;"><span>         compareTo(b.<span style="color:#007f7f">getClass</span>().<span style="color:#007f7f">getName</span>())) == 0)
</span></span><span style="display:flex;"><span>        d = (System.<span style="color:#007f7f">identityHashCode</span>(a) &lt;= System.<span style="color:#007f7f">identityHashCode</span>(b) ?
</span></span><span style="display:flex;"><span>             -1 : 1);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> d;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®šä¹‰ä¸€å¥—è§„åˆ™ç”¨äºæç«¯æƒ…å†µä¸‹æ¯”è¾ƒä¸¤ä¸ªå‚æ•°çš„å¤§å°ã€‚</p>
<h2 id="ä»£ç å—6treeifybin">ä»£ç å—6ï¼štreeifyBin<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—6treeifybin">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å°†é“¾è¡¨èŠ‚ç‚¹è½¬ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">void</span> treeifyBin(Node&lt;K,V&gt;[] tab, <span style="color:#fff;font-weight:bold">int</span> hash) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> n, index; Node&lt;K,V&gt; e;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.å¦‚æœtableä¸ºç©ºæˆ–è€…tableçš„é•¿åº¦å°äº64, è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å®¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (tab == <span style="color:#fff;font-weight:bold">null</span> || (n = tab.<span style="color:#007f7f">length</span>) &lt; MIN_TREEIFY_CAPACITY)
</span></span><span style="display:flex;"><span>        resize();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 2.æ ¹æ®hashå€¼è®¡ç®—ç´¢å¼•å€¼ï¼Œå°†è¯¥ç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹èµ‹å€¼ç»™eï¼Œä»eå¼€å§‹éå†è¯¥ç´¢å¼•ä½ç½®çš„é“¾è¡¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> ((e = tab[index = (n - 1) &amp; hash]) != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        TreeNode&lt;K,V&gt; hd = <span style="color:#fff;font-weight:bold">null</span>, tl = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.å°†é“¾è¡¨èŠ‚ç‚¹è½¬çº¢é»‘æ ‘èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            TreeNode&lt;K,V&gt; p = replacementTreeNode(e, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 4.å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡éå†ï¼Œå°†å¤´èŠ‚ç‚¹èµ‹å€¼ç»™hd</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (tl == <span style="color:#fff;font-weight:bold">null</span>)	<span style="color:#007f7f">// tlä¸ºç©ºä»£è¡¨ä¸ºç¬¬ä¸€æ¬¡å¾ªç¯</span>
</span></span><span style="display:flex;"><span>                hd = p;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 5.å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡éå†ï¼Œåˆ™å¤„ç†å½“å‰èŠ‚ç‚¹çš„prevå±æ€§å’Œä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„nextå±æ€§</span>
</span></span><span style="display:flex;"><span>                p.<span style="color:#007f7f">prev</span> = tl;    <span style="color:#007f7f">// å½“å‰èŠ‚ç‚¹çš„prevå±æ€§è®¾ä¸ºä¸Šä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                tl.<span style="color:#007f7f">next</span> = p;    <span style="color:#007f7f">// ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„nextå±æ€§è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 6.å°†pèŠ‚ç‚¹èµ‹å€¼ç»™tlï¼Œç”¨äºåœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­ä½œä¸ºä¸Šä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œä¸€äº›é“¾è¡¨çš„å…³è”æ“ä½œï¼ˆp.prev = tl å’Œ tl.next = pï¼‰</span>
</span></span><span style="display:flex;"><span>            tl = p;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">while</span> ((e = e.<span style="color:#007f7f">next</span>) != <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 7.å°†tableè¯¥ç´¢å¼•ä½ç½®èµ‹å€¼ä¸ºæ–°è½¬çš„TreeNodeçš„å¤´èŠ‚ç‚¹ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™ä»¥ä»¥å¤´èŠ‚ç‚¹(hd)ä¸ºæ ¹èŠ‚ç‚¹, æ„å»ºçº¢é»‘æ ‘</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((tab[index] = hd) != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>            hd.<span style="color:#007f7f">treeify</span>(tab);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°† table è¯¥ç´¢å¼•ä½ç½®èµ‹å€¼ä¸ºæ–°è½¬çš„ TreeNode çš„å¤´èŠ‚ç‚¹ hdï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™ä»¥ hd ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ„å»ºçº¢é»‘æ ‘ï¼Œ<strong>è§ä»£ç å—7è¯¦è§£</strong>ã€‚</p>
<h2 id="xxxxxxxxxximport-javautil--desc-hashtableçš„æµ‹è¯•ç¨‹åº---author-skywang-public-class-hashtabletest---public-static-void-mainstring-args-----testhashtableapis-----private-static-void-testhashtableapis------åˆå§‹åŒ–éšæœºç§å­----random-r--new-random-----æ–°å»ºhashtable----hashtable-table--new-hashtable-----æ·»åŠ æ“ä½œ----tableputone-rnextint10----tableputtwo-rnextint10----tableputthree-rnextint10-----æ‰“å°å‡ºtable----systemoutprintlntabletable------é€šè¿‡iteratoréå†key-value----iterator-iter--tableentrysetiterator----whileiterhasnext-------mapentry-entry--mapentryiternext------systemoutprintlnnext---entrygetkey----entrygetvalue----------hashtableçš„é”®å€¼å¯¹ä¸ªæ•°--------systemoutprintlnsizetablesize-----containskeyobject-key-æ˜¯å¦åŒ…å«é”®key----systemoutprintlncontains-key-two--tablecontainskeytwo----systemoutprintlncontains-key-five--tablecontainskeyfive-----containsvalueobject-value-æ˜¯å¦åŒ…å«å€¼value----systemoutprintlncontains-value-0--tablecontainsvaluenew-integer0-----removeobject-key--åˆ é™¤é”®keyå¯¹åº”çš„é”®å€¼å¯¹----tableremovethree----systemoutprintlntabletable------clear--æ¸…ç©ºhashtable----tableclear-----isempty--hashtableæ˜¯å¦ä¸ºç©º----systemoutprintlntableisemptytable-is-emptytable-is-not-empty----java">xxxxxxxxxxÂ import java.util.<em>;â€‹/</em> * @desc Hashtableçš„æµ‹è¯•ç¨‹åºã€‚ * * @author skywang */public class HashtableTest { Â  Â public static void main(String[] args) { Â  Â  Â  Â testHashtableAPIs(); Â   }â€‹ Â  Â private static void testHashtableAPIs() { Â  Â  Â  Â // åˆå§‹åŒ–éšæœºç§å­ Â  Â  Â  Â Random r = new Random(); Â  Â  Â  Â // æ–°å»ºHashtable Â  Â  Â  Â Hashtable table = new Hashtable(); Â  Â  Â  Â // æ·»åŠ æ“ä½œ Â  Â  Â  Â table.put(&ldquo;one&rdquo;, r.nextInt(10)); Â  Â  Â  Â table.put(&ldquo;two&rdquo;, r.nextInt(10)); Â  Â  Â  Â table.put(&ldquo;three&rdquo;, r.nextInt(10));â€‹ Â  Â  Â  Â // æ‰“å°å‡ºtable Â  Â  Â  Â System.out.println(&ldquo;table:&quot;+table );â€‹ Â  Â  Â  Â // é€šè¿‡Iteratoréå†key-value Â  Â  Â  Â Iterator iter = table.entrySet().iterator(); Â  Â  Â  Â while(iter.hasNext()) { Â  Â  Â  Â  Â  Â Map.Entry entry = (Map.Entry)iter.next(); Â  Â  Â  Â  Â  Â System.out.println(&ldquo;next : &ldquo;+ entry.getKey() +&rdquo; - &ldquo;+entry.getValue()); Â  Â  Â   }â€‹ Â  Â  Â  Â // Hashtableçš„é”®å€¼å¯¹ä¸ªæ•° Â  Â  Â  Â  Â  Â  Â  Â System.out.println(&ldquo;size:&quot;+table.size());â€‹ Â  Â  Â  Â // containsKey(Object key) :æ˜¯å¦åŒ…å«é”®key Â  Â  Â  Â System.out.println(&ldquo;contains key two : &ldquo;+table.containsKey(&ldquo;two&rdquo;)); Â  Â  Â  Â System.out.println(&ldquo;contains key five : &ldquo;+table.containsKey(&ldquo;five&rdquo;));â€‹ Â  Â  Â  Â // containsValue(Object value) :æ˜¯å¦åŒ…å«å€¼value Â  Â  Â  Â System.out.println(&ldquo;contains value 0 : &ldquo;+table.containsValue(new Integer(0)));â€‹ Â  Â  Â  Â // remove(Object key) ï¼š åˆ é™¤é”®keyå¯¹åº”çš„é”®å€¼å¯¹ Â  Â  Â  Â table.remove(&ldquo;three&rdquo;);â€‹ Â  Â  Â  Â System.out.println(&ldquo;table:&quot;+table );â€‹ Â  Â  Â  Â // clear() ï¼š æ¸…ç©ºHashtable Â  Â  Â  Â table.clear();â€‹ Â  Â  Â  Â // isEmpty() : Hashtableæ˜¯å¦ä¸ºç©º Â  Â  Â  Â System.out.println((table.isEmpty()?&ldquo;table is empty&rdquo;:&ldquo;table is not empty&rdquo;) ); Â   }â€‹}java<a hidden class="anchor" aria-hidden="true" href="#xxxxxxxxxximport-javautil--desc-hashtableçš„æµ‹è¯•ç¨‹åº---author-skywang-public-class-hashtabletest---public-static-void-mainstring-args-----testhashtableapis-----private-static-void-testhashtableapis------åˆå§‹åŒ–éšæœºç§å­----random-r--new-random-----æ–°å»ºhashtable----hashtable-table--new-hashtable-----æ·»åŠ æ“ä½œ----tableputone-rnextint10----tableputtwo-rnextint10----tableputthree-rnextint10-----æ‰“å°å‡ºtable----systemoutprintlntabletable------é€šè¿‡iteratoréå†key-value----iterator-iter--tableentrysetiterator----whileiterhasnext-------mapentry-entry--mapentryiternext------systemoutprintlnnext---entrygetkey----entrygetvalue----------hashtableçš„é”®å€¼å¯¹ä¸ªæ•°--------systemoutprintlnsizetablesize-----containskeyobject-key-æ˜¯å¦åŒ…å«é”®key----systemoutprintlncontains-key-two--tablecontainskeytwo----systemoutprintlncontains-key-five--tablecontainskeyfive-----containsvalueobject-value-æ˜¯å¦åŒ…å«å€¼value----systemoutprintlncontains-value-0--tablecontainsvaluenew-integer0-----removeobject-key--åˆ é™¤é”®keyå¯¹åº”çš„é”®å€¼å¯¹----tableremovethree----systemoutprintlntabletable------clear--æ¸…ç©ºhashtable----tableclear-----isempty--hashtableæ˜¯å¦ä¸ºç©º----systemoutprintlntableisemptytable-is-emptytable-is-not-empty----java">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * æ„å»ºçº¢é»‘æ ‘
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">void</span> treeify(Node&lt;K,V&gt;[] tab) {
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; root = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.å°†è°ƒç”¨æ­¤æ–¹æ³•çš„èŠ‚ç‚¹èµ‹å€¼ç»™xï¼Œä»¥xä½œä¸ºèµ·ç‚¹ï¼Œå¼€å§‹è¿›è¡Œéå†</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (TreeNode&lt;K,V&gt; x = <span style="color:#fff;font-weight:bold">this</span>, next; x != <span style="color:#fff;font-weight:bold">null</span>; x = next) {
</span></span><span style="display:flex;"><span>        next = (TreeNode&lt;K,V&gt;)x.<span style="color:#007f7f">next</span>;   <span style="color:#007f7f">// nextèµ‹å€¼ä¸ºxçš„ä¸‹ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        x.<span style="color:#007f7f">left</span> = x.<span style="color:#007f7f">right</span> = <span style="color:#fff;font-weight:bold">null</span>;    <span style="color:#007f7f">// å°†xçš„å·¦å³èŠ‚ç‚¹è®¾ç½®ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.å¦‚æœè¿˜æ²¡æœ‰æ ¹èŠ‚ç‚¹, åˆ™å°†xè®¾ç½®ä¸ºæ ¹èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (root == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            x.<span style="color:#007f7f">parent</span> = <span style="color:#fff;font-weight:bold">null</span>;    <span style="color:#007f7f">// æ ¹èŠ‚ç‚¹æ²¡æœ‰çˆ¶èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            x.<span style="color:#007f7f">red</span> = <span style="color:#fff;font-weight:bold">false</span>;  <span style="color:#007f7f">// æ ¹èŠ‚ç‚¹å¿…é¡»ä¸ºé»‘è‰²</span>
</span></span><span style="display:flex;"><span>            root = x;   <span style="color:#007f7f">// å°†xè®¾ç½®ä¸ºæ ¹èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            K k = x.<span style="color:#007f7f">key</span>;	<span style="color:#007f7f">// kèµ‹å€¼ä¸ºxçš„key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> h = x.<span style="color:#007f7f">hash</span>;	<span style="color:#007f7f">// hèµ‹å€¼ä¸ºxçš„hashå€¼</span>
</span></span><span style="display:flex;"><span>            Class&lt;?&gt; kc = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.å¦‚æœå½“å‰èŠ‚ç‚¹xä¸æ˜¯æ ¹èŠ‚ç‚¹, åˆ™ä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾å±äºè¯¥èŠ‚ç‚¹çš„ä½ç½®</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (TreeNode&lt;K,V&gt; p = root;;) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">int</span> dir, ph;
</span></span><span style="display:flex;"><span>                K pk = p.<span style="color:#007f7f">key</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 4.å¦‚æœxèŠ‚ç‚¹çš„hashå€¼å°äºpèŠ‚ç‚¹çš„hashå€¼ï¼Œåˆ™å°†dirèµ‹å€¼ä¸º-1, ä»£è¡¨å‘pçš„å·¦è¾¹æŸ¥æ‰¾</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> ((ph = p.<span style="color:#007f7f">hash</span>) &gt; h)
</span></span><span style="display:flex;"><span>                    dir = -1;
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 5.å¦‚æœxèŠ‚ç‚¹çš„hashå€¼å¤§äºpèŠ‚ç‚¹çš„hashå€¼ï¼Œåˆ™å°†dirèµ‹å€¼ä¸º1, ä»£è¡¨å‘pçš„å³è¾¹æŸ¥æ‰¾</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (ph &lt; h)
</span></span><span style="display:flex;"><span>                    dir = 1;
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 6.èµ°åˆ°è¿™ä»£è¡¨xçš„hashå€¼å’Œpçš„hashå€¼ç›¸ç­‰ï¼Œåˆ™æ¯”è¾ƒkeyå€¼</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> ((kc == <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; <span style="color:#007f7f">// 6.1 å¦‚æœkæ²¡æœ‰å®ç°Comparableæ¥å£ æˆ–è€… xèŠ‚ç‚¹çš„keyå’ŒpèŠ‚ç‚¹çš„keyç›¸ç­‰</span>
</span></span><span style="display:flex;"><span>                          (kc = comparableClassFor(k)) == <span style="color:#fff;font-weight:bold">null</span>) ||
</span></span><span style="display:flex;"><span>                         (dir = compareComparables(kc, k, pk)) == 0)
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// 6.2 ä½¿ç”¨å®šä¹‰çš„ä¸€å¥—è§„åˆ™æ¥æ¯”è¾ƒxèŠ‚ç‚¹å’ŒpèŠ‚ç‚¹çš„å¤§å°ï¼Œç”¨æ¥å†³å®šå‘å·¦è¿˜æ˜¯å‘å³æŸ¥æ‰¾</span>
</span></span><span style="display:flex;"><span>                    dir = tieBreakOrder(k, pk);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>                TreeNode&lt;K,V&gt; xp = p;   <span style="color:#007f7f">// xpèµ‹å€¼ä¸ºxçš„çˆ¶èŠ‚ç‚¹,ä¸­é—´å˜é‡ç”¨äºä¸‹é¢ç»™xçš„çˆ¶èŠ‚ç‚¹èµ‹å€¼</span>
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 7.dir&lt;=0åˆ™å‘på·¦è¾¹æŸ¥æ‰¾,å¦åˆ™å‘på³è¾¹æŸ¥æ‰¾,å¦‚æœä¸ºnull,åˆ™ä»£è¡¨è¯¥ä½ç½®å³ä¸ºxçš„ç›®æ ‡ä½ç½®</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> ((p = (dir &lt;= 0) ? p.<span style="color:#007f7f">left</span> : p.<span style="color:#007f7f">right</span>) == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// 8.xå’ŒxpèŠ‚ç‚¹çš„å±æ€§è®¾ç½®</span>
</span></span><span style="display:flex;"><span>                    x.<span style="color:#007f7f">parent</span> = xp;  <span style="color:#007f7f">// xçš„çˆ¶èŠ‚ç‚¹å³ä¸ºæœ€åä¸€æ¬¡éå†çš„pèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">if</span> (dir &lt;= 0)   <span style="color:#007f7f">// å¦‚æœæ—¶dir &lt;= 0, åˆ™ä»£è¡¨xèŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                        xp.<span style="color:#007f7f">left</span> = x;
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">else</span>    <span style="color:#007f7f">// å¦‚æœæ—¶dir &gt; 0, åˆ™ä»£è¡¨xèŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                        xp.<span style="color:#007f7f">right</span> = x;
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// 9.è¿›è¡Œçº¢é»‘æ ‘çš„æ’å…¥å¹³è¡¡(é€šè¿‡å·¦æ—‹ã€å³æ—‹å’Œæ”¹å˜èŠ‚ç‚¹é¢œè‰²æ¥ä¿è¯å½“å‰æ ‘ç¬¦åˆçº¢é»‘æ ‘çš„è¦æ±‚)</span>
</span></span><span style="display:flex;"><span>                    root = balanceInsertion(root, x);
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 10.å¦‚æœrootèŠ‚ç‚¹ä¸åœ¨tableç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹, åˆ™å°†å…¶è°ƒæ•´ä¸ºå¤´èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    moveRootToFront(tab, root);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœå½“å‰èŠ‚ç‚¹ x ä¸æ˜¯æ ¹èŠ‚ç‚¹, åˆ™ä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾å±äºè¯¥èŠ‚ç‚¹çš„ä½ç½®ï¼Œè¯¥æ®µä»£ç è·Ÿ<strong>ä»£ç å—2</strong>å’Œ<strong>ä»£ç å—4</strong>çš„æŸ¥æ‰¾ä»£ç ç±»ä¼¼ã€‚
å¦‚æœ root èŠ‚ç‚¹ä¸åœ¨ table ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹, åˆ™å°†å…¶è°ƒæ•´ä¸ºå¤´èŠ‚ç‚¹ï¼Œ<strong>è§ä»£ç å—8è¯¦è§£</strong>ã€‚</p>
<h2 id="ä»£ç å—8moveroottofront">ä»£ç å—8ï¼šmoveRootToFront<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—8moveroottofront">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å°†rootæ”¾åˆ°å¤´èŠ‚ç‚¹çš„ä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å¦‚æœå½“å‰ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹ä¸æ˜¯rootèŠ‚ç‚¹, åˆ™å°†rootçš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œå…³è”,
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å°†rootæ”¾åˆ°å¤´èŠ‚ç‚¹çš„ä½ç½®, åŸå¤´èŠ‚ç‚¹æ”¾åœ¨rootçš„nextèŠ‚ç‚¹ä¸Š
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> &lt;K,V&gt; <span style="color:#fff;font-weight:bold">void</span> moveRootToFront(Node&lt;K,V&gt;[] tab, TreeNode&lt;K,V&gt; root) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> n;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.æ ¡éªŒrootæ˜¯å¦ä¸ºç©ºã€tableæ˜¯å¦ä¸ºç©ºã€tableçš„lengthæ˜¯å¦å¤§äº0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (root != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; tab != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; (n = tab.<span style="color:#007f7f">length</span>) &gt; 0) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.è®¡ç®—rootèŠ‚ç‚¹çš„ç´¢å¼•ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> index = (n - 1) &amp; root.<span style="color:#007f7f">hash</span>;
</span></span><span style="display:flex;"><span>        TreeNode&lt;K,V&gt; first = (TreeNode&lt;K,V&gt;)tab[index];
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 3.å¦‚æœè¯¥ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹ä¸æ˜¯rootèŠ‚ç‚¹ï¼Œåˆ™è¯¥ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹æ›¿æ¢ä¸ºrootèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (root != first) {
</span></span><span style="display:flex;"><span>            Node&lt;K,V&gt; rn;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.1 å°†è¯¥ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹èµ‹å€¼ä¸ºrootèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            tab[index] = root;
</span></span><span style="display:flex;"><span>            TreeNode&lt;K,V&gt; rp = root.<span style="color:#007f7f">prev</span>;   <span style="color:#007f7f">// rootèŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.2 å’Œ 3.3 ä¸¤ä¸ªæ“ä½œæ˜¯ç§»é™¤rootèŠ‚ç‚¹çš„è¿‡ç¨‹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.2 å¦‚æœrootèŠ‚ç‚¹çš„nextèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™å°†rootèŠ‚ç‚¹çš„nextèŠ‚ç‚¹çš„prevå±æ€§è®¾ç½®ä¸ºrootèŠ‚ç‚¹çš„prevèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> ((rn = root.<span style="color:#007f7f">next</span>) != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>                ((TreeNode&lt;K,V&gt;)rn).<span style="color:#007f7f">prev</span> = rp;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.3 å¦‚æœrootèŠ‚ç‚¹çš„prevèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™å°†rootèŠ‚ç‚¹çš„prevèŠ‚ç‚¹çš„nextå±æ€§è®¾ç½®ä¸ºrootèŠ‚ç‚¹çš„nextèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (rp != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>                rp.<span style="color:#007f7f">next</span> = rn;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.4 å’Œ 3.5 ä¸¤ä¸ªæ“ä½œå°†firstèŠ‚ç‚¹æ¥åˆ°rootèŠ‚ç‚¹åé¢</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.4 å¦‚æœåŸå¤´èŠ‚ç‚¹ä¸ä¸ºç©º, åˆ™å°†åŸå¤´èŠ‚ç‚¹çš„prevå±æ€§è®¾ç½®ä¸ºrootèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (first != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>                first.<span style="color:#007f7f">prev</span> = root;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.5 å°†rootèŠ‚ç‚¹çš„nextå±æ€§è®¾ç½®ä¸ºåŸå¤´èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            root.<span style="color:#007f7f">next</span> = first;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.6 rootæ­¤æ—¶å·²ç»è¢«æ”¾åˆ°è¯¥ä½ç½®çš„å¤´èŠ‚ç‚¹ä½ç½®ï¼Œå› æ­¤å°†prevå±æ€§è®¾ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>            root.<span style="color:#007f7f">prev</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 4.æ£€æŸ¥æ ‘æ˜¯å¦æ­£å¸¸</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">assert</span> checkInvariants(root);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ£€æŸ¥æ ‘æ˜¯å¦æ­£å¸¸ï¼Œ<strong>è§ä»£ç å—9è¯¦è§£</strong>ã€‚</p>
<h2 id="ä»£ç å—9checkinvariants">ä»£ç å—9ï¼šcheckInvariants<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—9checkinvariants">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * Recursive invariant check
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> &lt;K,V&gt; <span style="color:#fff;font-weight:bold">boolean</span> checkInvariants(TreeNode&lt;K,V&gt; t) { <span style="color:#007f7f">// ä¸€äº›åŸºæœ¬çš„æ ¡éªŒ</span>
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; tp = t.<span style="color:#007f7f">parent</span>, tl = t.<span style="color:#007f7f">left</span>, tr = t.<span style="color:#007f7f">right</span>,
</span></span><span style="display:flex;"><span>        tb = t.<span style="color:#007f7f">prev</span>, tn = (TreeNode&lt;K,V&gt;)t.<span style="color:#007f7f">next</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (tb != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; tb.<span style="color:#007f7f">next</span> != t)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (tn != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; tn.<span style="color:#007f7f">prev</span> != t)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (tp != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; t != tp.<span style="color:#007f7f">left</span> &amp;&amp; t != tp.<span style="color:#007f7f">right</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (tl != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; (tl.<span style="color:#007f7f">parent</span> != t || tl.<span style="color:#007f7f">hash</span> &gt; t.<span style="color:#007f7f">hash</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (tr != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; (tr.<span style="color:#007f7f">parent</span> != t || tr.<span style="color:#007f7f">hash</span> &lt; t.<span style="color:#007f7f">hash</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (t.<span style="color:#007f7f">red</span> &amp;&amp; tl != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; tl.<span style="color:#007f7f">red</span> &amp;&amp; tr != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; tr.<span style="color:#007f7f">red</span>)  <span style="color:#007f7f">// å¦‚æœå½“å‰èŠ‚ç‚¹ä¸ºçº¢è‰², åˆ™è¯¥èŠ‚ç‚¹çš„å·¦å³èŠ‚ç‚¹ä¸èƒ½åŒæ—¶ä¸ºçº¢è‰²</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (tl != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; !checkInvariants(tl))
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (tr != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; !checkInvariants(tr))
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°†ä¼ å…¥çš„èŠ‚ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ ¡éªŒèŠ‚ç‚¹çš„åˆæ³•æ€§ï¼Œä¸»è¦æ˜¯ä¿è¯è¯¥æ ‘ç¬¦åˆçº¢é»‘æ ‘çš„è§„åˆ™ã€‚</p>
<h1 id="resize-æ–¹æ³•">resize æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#resize-æ–¹æ³•">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">92
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> Node&lt;K,V&gt;[] resize() {
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt;[] oldTab = table;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> oldCap = (oldTab == <span style="color:#fff;font-weight:bold">null</span>) ? 0 : oldTab.<span style="color:#007f7f">length</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> oldThr = threshold;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> newCap, newThr = 0;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.è€è¡¨çš„å®¹é‡ä¸ä¸º0ï¼Œå³è€è¡¨ä¸ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (oldCap &gt; 0) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 1.1 åˆ¤æ–­è€è¡¨çš„å®¹é‡æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡å€¼ï¼šå¦‚æœè¶…è¿‡åˆ™å°†é˜ˆå€¼è®¾ç½®ä¸ºInteger.MAX_VALUEï¼Œå¹¶ç›´æ¥è¿”å›è€è¡¨,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ­¤æ—¶oldCap * 2æ¯”Integer.MAX_VALUEå¤§ï¼Œå› æ­¤æ— æ³•è¿›è¡Œé‡æ–°åˆ†å¸ƒï¼Œåªæ˜¯å•çº¯çš„å°†é˜ˆå€¼æ‰©å®¹åˆ°æœ€å¤§</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) {
</span></span><span style="display:flex;"><span>            threshold = Integer.<span style="color:#007f7f">MAX_VALUE</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> oldTab;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 1.2 å°†newCapèµ‹å€¼ä¸ºoldCapçš„2å€ï¼Œå¦‚æœnewCap&lt;æœ€å¤§å®¹é‡å¹¶ä¸”oldCap&gt;=16, åˆ™å°†æ–°é˜ˆå€¼è®¾ç½®ä¸ºåŸæ¥çš„ä¸¤å€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;
</span></span><span style="display:flex;"><span>                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)
</span></span><span style="display:flex;"><span>            newThr = oldThr &lt;&lt; 1; <span style="color:#007f7f">// double threshold</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 2.å¦‚æœè€è¡¨çš„å®¹é‡ä¸º0, è€è¡¨çš„é˜ˆå€¼å¤§äº0, æ˜¯å› ä¸ºåˆå§‹å®¹é‡è¢«æ”¾å…¥é˜ˆå€¼ï¼Œåˆ™å°†æ–°è¡¨çš„å®¹é‡è®¾ç½®ä¸ºè€è¡¨çš„é˜ˆå€¼</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (oldThr &gt; 0)
</span></span><span style="display:flex;"><span>        newCap = oldThr;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 3.è€è¡¨çš„å®¹é‡ä¸º0, è€è¡¨çš„é˜ˆå€¼ä¸º0ï¼Œè¿™ç§æƒ…å†µæ˜¯æ²¡æœ‰ä¼ åˆå§‹å®¹é‡çš„newæ–¹æ³•åˆ›å»ºçš„ç©ºè¡¨ï¼Œå°†é˜ˆå€¼å’Œå®¹é‡è®¾ç½®ä¸ºé»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>        newCap = DEFAULT_INITIAL_CAPACITY;
</span></span><span style="display:flex;"><span>        newThr = (<span style="color:#fff;font-weight:bold">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 4.å¦‚æœæ–°è¡¨çš„é˜ˆå€¼ä¸ºç©º, åˆ™é€šè¿‡æ–°çš„å®¹é‡*è´Ÿè½½å› å­è·å¾—é˜ˆå€¼</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (newThr == 0) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">float</span> ft = (<span style="color:#fff;font-weight:bold">float</span>)newCap * loadFactor;
</span></span><span style="display:flex;"><span>        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span style="color:#fff;font-weight:bold">float</span>)MAXIMUM_CAPACITY ?
</span></span><span style="display:flex;"><span>                  (<span style="color:#fff;font-weight:bold">int</span>)ft : Integer.<span style="color:#007f7f">MAX_VALUE</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 5.å°†å½“å‰é˜ˆå€¼è®¾ç½®ä¸ºåˆšè®¡ç®—å‡ºæ¥çš„æ–°çš„é˜ˆå€¼ï¼Œå®šä¹‰æ–°è¡¨ï¼Œå®¹é‡ä¸ºåˆšè®¡ç®—å‡ºæ¥çš„æ–°å®¹é‡ï¼Œå°†tableè®¾ç½®ä¸ºæ–°å®šä¹‰çš„è¡¨ã€‚</span>
</span></span><span style="display:flex;"><span>    threshold = newThr;
</span></span><span style="display:flex;"><span>    @SuppressWarnings({<span style="color:#0ff;font-weight:bold">&#34;rawtypes&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;unchecked&#34;</span>})
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span style="color:#fff;font-weight:bold">new</span> Node[newCap];
</span></span><span style="display:flex;"><span>    table = newTab;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 6.å¦‚æœè€è¡¨ä¸ä¸ºç©ºï¼Œåˆ™éœ€éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œå°†èŠ‚ç‚¹èµ‹å€¼ç»™æ–°è¡¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (oldTab != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> j = 0; j &lt; oldCap; ++j) {
</span></span><span style="display:flex;"><span>            Node&lt;K,V&gt; e;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> ((e = oldTab[j]) != <span style="color:#fff;font-weight:bold">null</span>) {  <span style="color:#007f7f">// å°†ç´¢å¼•å€¼ä¸ºjçš„è€è¡¨å¤´èŠ‚ç‚¹èµ‹å€¼ç»™e</span>
</span></span><span style="display:flex;"><span>                oldTab[j] = <span style="color:#fff;font-weight:bold">null</span>; <span style="color:#007f7f">// å°†è€è¡¨çš„èŠ‚ç‚¹è®¾ç½®ä¸ºç©º, ä»¥ä¾¿åƒåœ¾æ”¶é›†å™¨å›æ”¶ç©ºé—´</span>
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 7.å¦‚æœe.nextä¸ºç©º, åˆ™ä»£è¡¨è€è¡¨çš„è¯¥ä½ç½®åªæœ‰1ä¸ªèŠ‚ç‚¹ï¼Œè®¡ç®—æ–°è¡¨çš„ç´¢å¼•ä½ç½®, ç›´æ¥å°†è¯¥èŠ‚ç‚¹æ”¾åœ¨è¯¥ä½ç½®</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (e.<span style="color:#007f7f">next</span> == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>                    newTab[e.<span style="color:#007f7f">hash</span> &amp; (newCap - 1)] = e;
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 8.å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œåˆ™è¿›è¡Œçº¢é»‘æ ‘çš„é‡hashåˆ†å¸ƒ(è·Ÿé“¾è¡¨çš„hashåˆ†å¸ƒåŸºæœ¬ç›¸åŒ)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (e <span style="color:#fff;font-weight:bold">instanceof</span> TreeNode)
</span></span><span style="display:flex;"><span>                    ((TreeNode&lt;K,V&gt;)e).<span style="color:#007f7f">split</span>(<span style="color:#fff;font-weight:bold">this</span>, newTab, j, oldCap);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">else</span> { <span style="color:#007f7f">// preserve order</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// 9.å¦‚æœæ˜¯æ™®é€šçš„é“¾è¡¨èŠ‚ç‚¹ï¼Œåˆ™è¿›è¡Œæ™®é€šçš„é‡hashåˆ†å¸ƒ</span>
</span></span><span style="display:flex;"><span>                    Node&lt;K,V&gt; loHead = <span style="color:#fff;font-weight:bold">null</span>, loTail = <span style="color:#fff;font-weight:bold">null</span>; <span style="color:#007f7f">// å­˜å‚¨ç´¢å¼•ä½ç½®ä¸º:â€œåŸç´¢å¼•ä½ç½®â€çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                    Node&lt;K,V&gt; hiHead = <span style="color:#fff;font-weight:bold">null</span>, hiTail = <span style="color:#fff;font-weight:bold">null</span>; <span style="color:#007f7f">// å­˜å‚¨ç´¢å¼•ä½ç½®ä¸º:â€œåŸç´¢å¼•ä½ç½®+oldCapâ€çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                    Node&lt;K,V&gt; next;
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>                        next = e.<span style="color:#007f7f">next</span>;
</span></span><span style="display:flex;"><span>                        <span style="color:#007f7f">// 9.1 å¦‚æœeçš„hashå€¼ä¸è€è¡¨çš„å®¹é‡è¿›è¡Œä¸è¿ç®—ä¸º0,åˆ™æ‰©å®¹åçš„ç´¢å¼•ä½ç½®è·Ÿè€è¡¨çš„ç´¢å¼•ä½ç½®ä¸€æ ·</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">if</span> ((e.<span style="color:#007f7f">hash</span> &amp; oldCap) == 0) {
</span></span><span style="display:flex;"><span>                            <span style="color:#fff;font-weight:bold">if</span> (loTail == <span style="color:#fff;font-weight:bold">null</span>) <span style="color:#007f7f">// å¦‚æœloTailä¸ºç©º, ä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                                loHead = e; <span style="color:#007f7f">// åˆ™å°†loHeadèµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                                loTail.<span style="color:#007f7f">next</span> = e;    <span style="color:#007f7f">// å¦åˆ™å°†èŠ‚ç‚¹æ·»åŠ åœ¨loTailåé¢</span>
</span></span><span style="display:flex;"><span>                            loTail = e; <span style="color:#007f7f">// å¹¶å°†loTailèµ‹å€¼ä¸ºæ–°å¢çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                        <span style="color:#007f7f">// 9.2 å¦‚æœeçš„hashå€¼ä¸è€è¡¨çš„å®¹é‡è¿›è¡Œä¸è¿ç®—ä¸ºé0,åˆ™æ‰©å®¹åçš„ç´¢å¼•ä½ç½®ä¸º:è€è¡¨çš„ç´¢å¼•ä½ç½®ï¼‹oldCap</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#fff;font-weight:bold">if</span> (hiTail == <span style="color:#fff;font-weight:bold">null</span>) <span style="color:#007f7f">// å¦‚æœhiTailä¸ºç©º, ä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                                hiHead = e; <span style="color:#007f7f">// åˆ™å°†hiHeadèµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                                hiTail.<span style="color:#007f7f">next</span> = e;    <span style="color:#007f7f">// å¦åˆ™å°†èŠ‚ç‚¹æ·»åŠ åœ¨hiTailåé¢</span>
</span></span><span style="display:flex;"><span>                            hiTail = e; <span style="color:#007f7f">// å¹¶å°†hiTailèµ‹å€¼ä¸ºæ–°å¢çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    } <span style="color:#fff;font-weight:bold">while</span> ((e = next) != <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// 10.å¦‚æœloTailä¸ä¸ºç©ºï¼ˆè¯´æ˜è€è¡¨çš„æ•°æ®æœ‰åˆ†å¸ƒåˆ°æ–°è¡¨ä¸Šâ€œåŸç´¢å¼•ä½ç½®â€çš„èŠ‚ç‚¹ï¼‰ï¼Œåˆ™å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// çš„nextè®¾ä¸ºç©ºï¼Œå¹¶å°†æ–°è¡¨ä¸Šç´¢å¼•ä½ç½®ä¸ºâ€œåŸç´¢å¼•ä½ç½®â€çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå¯¹åº”çš„å¤´èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">if</span> (loTail != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                        loTail.<span style="color:#007f7f">next</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>                        newTab[j] = loHead;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// 11.å¦‚æœhiTailä¸ä¸ºç©ºï¼ˆè¯´æ˜è€è¡¨çš„æ•°æ®æœ‰åˆ†å¸ƒåˆ°æ–°è¡¨ä¸Šâ€œåŸç´¢å¼•+oldCapä½ç½®â€çš„èŠ‚ç‚¹ï¼‰ï¼Œåˆ™å°†æœ€å</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// ä¸€ä¸ªèŠ‚ç‚¹çš„nextè®¾ä¸ºç©ºï¼Œå¹¶å°†æ–°è¡¨ä¸Šç´¢å¼•ä½ç½®ä¸ºâ€œåŸç´¢å¼•+oldCapâ€çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå¯¹åº”çš„å¤´èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">if</span> (hiTail != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                        hiTail.<span style="color:#007f7f">next</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>                        newTab[j + oldCap] = hiHead;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 12.è¿”å›æ–°è¡¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> newTab;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>2.è€è¡¨çš„å®¹é‡ä¸º 0ï¼Œå¹¶ä¸”è€è¡¨çš„é˜ˆå€¼å¤§äº 0ï¼šè¿™ç§æƒ…å†µæ˜¯æ–°å»º HashMap æ—¶ä¼ äº†åˆå§‹å®¹é‡ï¼Œä¾‹å¦‚ï¼šnew HashMap&lt;&gt;(32)ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼æ–°å»º HashMap æ—¶ï¼Œç”±äº HashMap æ²¡æœ‰ capacity å±æ€§ï¼Œæ‰€ä»¥æ­¤æ—¶çš„ capacity ä¼šè¢«æš‚å­˜åœ¨ threshold å±æ€§ã€‚å› æ­¤æ­¤æ—¶çš„ threshold çš„å€¼å°±æ˜¯æˆ‘ä»¬è¦æ–°åˆ›å»ºçš„ HashMap çš„ capacityï¼Œæ‰€ä»¥å°†æ–°è¡¨çš„å®¹é‡è®¾ç½®ä¸º thresholdã€‚</p>
<p>4.å¦‚æœæ–°è¡¨çš„é˜ˆå€¼ä¸ºç©ºï¼Œåˆ™é€šè¿‡æ–°çš„å®¹é‡ * è´Ÿè½½å› å­è·å¾—é˜ˆå€¼ï¼ˆè¿™ç§æƒ…å†µæ˜¯åˆå§‹åŒ–çš„æ—¶å€™ä¼ äº†åˆå§‹å®¹é‡ï¼Œè·Ÿç¬¬2ç‚¹ç›¸åŒæƒ…å†µï¼Œæˆ–è€…åˆå§‹å®¹é‡è®¾ç½®çš„å¤ªå°å¯¼è‡´è€è¡¨çš„å®¹é‡æ²¡æœ‰è¶…è¿‡ 16 å¯¼è‡´çš„ï¼‰ã€‚</p>
<p>8.å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œåˆ™è¿›è¡Œçº¢é»‘æ ‘çš„é‡ hash åˆ†å¸ƒï¼Œè§ä»£ç å—10è¯¦è§£ã€‚</p>
<p>9.1 å¦‚æœ e çš„ hash å€¼ä¸è€è¡¨çš„å®¹é‡è¿›è¡Œä½ä¸è¿ç®—ä¸º 0ï¼Œåˆ™è¯´æ˜ e èŠ‚ç‚¹æ‰©å®¹åçš„ç´¢å¼•ä½ç½®è·Ÿè€è¡¨çš„ç´¢å¼•ä½ç½®ä¸€æ ·ï¼ˆè§ä¾‹å­1è¯¦è§£ï¼‰ï¼Œè¿›è¡Œé“¾è¡¨æ‹¼æ¥æ“ä½œï¼šå¦‚æœ loTail ä¸ºç©ºï¼Œä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å°† loHead èµ‹å€¼ä¸ºè¯¥èŠ‚ç‚¹ï¼›å¦åˆ™å°†èŠ‚ç‚¹æ·»åŠ åœ¨ loTail åé¢ï¼Œå¹¶å°† loTail èµ‹å€¼ä¸ºæ–°å¢çš„èŠ‚ç‚¹ã€‚</p>
<p>9.2 å¦‚æœ e çš„ hash å€¼ä¸è€è¡¨çš„å®¹é‡è¿›è¡Œä½ä¸è¿ç®—ä¸º 1ï¼Œåˆ™è¯´æ˜ e èŠ‚ç‚¹æ‰©å®¹åçš„ç´¢å¼•ä½ç½®ä¸ºï¼šè€è¡¨çš„ç´¢å¼•ä½ç½®ï¼‹oldCapï¼ˆè§ä¾‹å­1è¯¦è§£ï¼‰ï¼Œè¿›è¡Œé“¾è¡¨æ‹¼æ¥æ“ä½œï¼šå¦‚æœ hiTail ä¸ºç©ºï¼Œä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å°† hiHead èµ‹å€¼ä¸ºè¯¥èŠ‚ç‚¹ï¼›å¦åˆ™å°†èŠ‚ç‚¹æ·»åŠ åœ¨ hiTail åé¢ï¼Œå¹¶å°† hiTail èµ‹å€¼ä¸ºæ–°å¢çš„èŠ‚ç‚¹ã€‚</p>
<h2 id="ä»£ç å—10split">ä»£ç å—10ï¼šsplit<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—10split">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * æ‰©å®¹åï¼Œçº¢é»‘æ ‘çš„hashåˆ†å¸ƒï¼Œåªå¯èƒ½å­˜åœ¨äºä¸¤ä¸ªä½ç½®ï¼šåŸç´¢å¼•ä½ç½®ã€åŸç´¢å¼•ä½ç½®+oldCap
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">void</span> split(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab, <span style="color:#fff;font-weight:bold">int</span> index, <span style="color:#fff;font-weight:bold">int</span> bit) {
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; b = <span style="color:#fff;font-weight:bold">this</span>;	<span style="color:#007f7f">// æ‹¿åˆ°è°ƒç”¨æ­¤æ–¹æ³•çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; loHead = <span style="color:#fff;font-weight:bold">null</span>, loTail = <span style="color:#fff;font-weight:bold">null</span>; <span style="color:#007f7f">// å­˜å‚¨ç´¢å¼•ä½ç½®ä¸º:â€œåŸç´¢å¼•ä½ç½®â€çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; hiHead = <span style="color:#fff;font-weight:bold">null</span>, hiTail = <span style="color:#fff;font-weight:bold">null</span>; <span style="color:#007f7f">// å­˜å‚¨ç´¢å¼•ä½ç½®ä¸º:â€œåŸç´¢å¼•+oldCapâ€çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> lc = 0, hc = 0;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.ä»¥è°ƒç”¨æ­¤æ–¹æ³•çš„èŠ‚ç‚¹å¼€å§‹ï¼Œéå†æ•´ä¸ªçº¢é»‘æ ‘èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (TreeNode&lt;K,V&gt; e = b, next; e != <span style="color:#fff;font-weight:bold">null</span>; e = next) {	<span style="color:#007f7f">// ä»bèŠ‚ç‚¹å¼€å§‹éå†</span>
</span></span><span style="display:flex;"><span>        next = (TreeNode&lt;K,V&gt;)e.<span style="color:#007f7f">next</span>;   <span style="color:#007f7f">// nextèµ‹å€¼ä¸ºeçš„ä¸‹ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        e.<span style="color:#007f7f">next</span> = <span style="color:#fff;font-weight:bold">null</span>;  <span style="color:#007f7f">// åŒæ—¶å°†è€è¡¨çš„èŠ‚ç‚¹è®¾ç½®ä¸ºç©ºï¼Œä»¥ä¾¿åƒåœ¾æ”¶é›†å™¨å›æ”¶</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.å¦‚æœeçš„hashå€¼ä¸è€è¡¨çš„å®¹é‡è¿›è¡Œä¸è¿ç®—ä¸º0,åˆ™æ‰©å®¹åçš„ç´¢å¼•ä½ç½®è·Ÿè€è¡¨çš„ç´¢å¼•ä½ç½®ä¸€æ ·</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((e.<span style="color:#007f7f">hash</span> &amp; bit) == 0) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> ((e.<span style="color:#007f7f">prev</span> = loTail) == <span style="color:#fff;font-weight:bold">null</span>)  <span style="color:#007f7f">// å¦‚æœloTailä¸ºç©º, ä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                loHead = e; <span style="color:#007f7f">// åˆ™å°†loHeadèµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                loTail.<span style="color:#007f7f">next</span> = e;    <span style="color:#007f7f">// å¦åˆ™å°†èŠ‚ç‚¹æ·»åŠ åœ¨loTailåé¢</span>
</span></span><span style="display:flex;"><span>            loTail = e; <span style="color:#007f7f">// å¹¶å°†loTailèµ‹å€¼ä¸ºæ–°å¢çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            ++lc;   <span style="color:#007f7f">// ç»Ÿè®¡åŸç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹ä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 3.å¦‚æœeçš„hashå€¼ä¸è€è¡¨çš„å®¹é‡è¿›è¡Œä¸è¿ç®—ä¸ºé0,åˆ™æ‰©å®¹åçš„ç´¢å¼•ä½ç½®ä¸º:è€è¡¨çš„ç´¢å¼•ä½ç½®ï¼‹oldCap</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> ((e.<span style="color:#007f7f">prev</span> = hiTail) == <span style="color:#fff;font-weight:bold">null</span>)  <span style="color:#007f7f">// å¦‚æœhiHeadä¸ºç©º, ä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                hiHead = e; <span style="color:#007f7f">// åˆ™å°†hiHeadèµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                hiTail.<span style="color:#007f7f">next</span> = e;    <span style="color:#007f7f">// å¦åˆ™å°†èŠ‚ç‚¹æ·»åŠ åœ¨hiTailåé¢</span>
</span></span><span style="display:flex;"><span>            hiTail = e; <span style="color:#007f7f">// å¹¶å°†hiTailèµ‹å€¼ä¸ºæ–°å¢çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            ++hc;   <span style="color:#007f7f">// ç»Ÿè®¡ç´¢å¼•ä½ç½®ä¸ºåŸç´¢å¼•+oldCapçš„èŠ‚ç‚¹ä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 4.å¦‚æœåŸç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹ä¸ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (loHead != <span style="color:#fff;font-weight:bold">null</span>) {   <span style="color:#007f7f">// åŸç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹ä¸ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 4.1 å¦‚æœèŠ‚ç‚¹ä¸ªæ•°&lt;=6ä¸ªåˆ™å°†çº¢é»‘æ ‘è½¬ä¸ºé“¾è¡¨ç»“æ„</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (lc &lt;= UNTREEIFY_THRESHOLD)
</span></span><span style="display:flex;"><span>            tab[index] = loHead.<span style="color:#007f7f">untreeify</span>(map);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 4.2 å°†åŸç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå¯¹åº”çš„å¤´èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            tab[index] = loHead;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 4.3 å¦‚æœhiHeadä¸ä¸ºç©ºï¼Œåˆ™ä»£è¡¨åŸæ¥çš„çº¢é»‘æ ‘(è€è¡¨çš„çº¢é»‘æ ‘ç”±äºèŠ‚ç‚¹è¢«åˆ†åˆ°ä¸¤ä¸ªä½ç½®)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å·²ç»è¢«æ”¹å˜, éœ€è¦é‡æ–°æ„å»ºæ–°çš„çº¢é»‘æ ‘</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (hiHead != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 4.4 ä»¥loHeadä¸ºæ ¹èŠ‚ç‚¹, æ„å»ºæ–°çš„çº¢é»‘æ ‘</span>
</span></span><span style="display:flex;"><span>                loHead.<span style="color:#007f7f">treeify</span>(tab);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 5.å¦‚æœç´¢å¼•ä½ç½®ä¸ºåŸç´¢å¼•+oldCapçš„èŠ‚ç‚¹ä¸ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (hiHead != <span style="color:#fff;font-weight:bold">null</span>) {   <span style="color:#007f7f">// ç´¢å¼•ä½ç½®ä¸ºåŸç´¢å¼•+oldCapçš„èŠ‚ç‚¹ä¸ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 5.1 å¦‚æœèŠ‚ç‚¹ä¸ªæ•°&lt;=6ä¸ªåˆ™å°†çº¢é»‘æ ‘è½¬ä¸ºé“¾è¡¨ç»“æ„</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (hc &lt;= UNTREEIFY_THRESHOLD)
</span></span><span style="display:flex;"><span>            tab[index + bit] = hiHead.<span style="color:#007f7f">untreeify</span>(map);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 5.2 å°†ç´¢å¼•ä½ç½®ä¸ºåŸç´¢å¼•+oldCapçš„èŠ‚ç‚¹è®¾ç½®ä¸ºå¯¹åº”çš„å¤´èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            tab[index + bit] = hiHead;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 5.3 loHeadä¸ä¸ºç©ºåˆ™ä»£è¡¨åŸæ¥çš„çº¢é»‘æ ‘(è€è¡¨çš„çº¢é»‘æ ‘ç”±äºèŠ‚ç‚¹è¢«åˆ†åˆ°ä¸¤ä¸ªä½ç½®)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å·²ç»è¢«æ”¹å˜, éœ€è¦é‡æ–°æ„å»ºæ–°çš„çº¢é»‘æ ‘</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (loHead != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 5.4 ä»¥hiHeadä¸ºæ ¹èŠ‚ç‚¹, æ„å»ºæ–°çš„çº¢é»‘æ ‘</span>
</span></span><span style="display:flex;"><span>                hiHead.<span style="color:#007f7f">treeify</span>(tab);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>2.å¦‚æœ e çš„ hash å€¼ä¸è€è¡¨çš„å®¹é‡è¿›è¡Œä½ä¸è¿ç®—ä¸º 0ï¼Œåˆ™è¯´æ˜ e èŠ‚ç‚¹æ‰©å®¹åçš„ç´¢å¼•ä½ç½®è·Ÿè€è¡¨çš„ç´¢å¼•ä½ç½®ä¸€æ ·ï¼ˆè§ä¾‹å­1è¯¦è§£ï¼‰ï¼Œè¿›è¡Œé“¾è¡¨æ‹¼æ¥æ“ä½œï¼šå¦‚æœ loTail ä¸ºç©ºï¼Œä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å°† loHead èµ‹å€¼ä¸ºè¯¥èŠ‚ç‚¹ï¼›å¦åˆ™å°†èŠ‚ç‚¹æ·»åŠ åœ¨ loTail åé¢ï¼Œå¹¶å°† loTail èµ‹å€¼ä¸ºæ–°å¢çš„èŠ‚ç‚¹ï¼Œå¹¶ç»Ÿè®¡åŸç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚</p>
<p>3.å¦‚æœ e çš„ hash å€¼ä¸è€è¡¨çš„å®¹é‡è¿›è¡Œä½ä¸è¿ç®—ä¸º 1ï¼Œåˆ™è¯´æ˜ e èŠ‚ç‚¹æ‰©å®¹åçš„ç´¢å¼•ä½ç½®ä¸ºï¼šè€è¡¨çš„ç´¢å¼•ä½ç½®ï¼‹oldCapï¼ˆè§ä¾‹å­1è¯¦è§£ï¼‰ï¼Œè¿›è¡Œé“¾è¡¨æ‹¼æ¥æ“ä½œï¼šå¦‚æœ hiTail ä¸ºç©ºï¼Œä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å°† hiHead èµ‹å€¼ä¸ºè¯¥èŠ‚ç‚¹ï¼›å¦åˆ™å°†èŠ‚ç‚¹æ·»åŠ åœ¨ hiTail åé¢ï¼Œå¹¶å°† hiTail èµ‹å€¼ä¸ºæ–°å¢çš„èŠ‚ç‚¹ï¼Œå¹¶ç»Ÿè®¡ç´¢å¼•ä½ç½®ä¸ºåŸç´¢å¼• + oldCap çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚</p>
<p>4.1 å¦‚æœèŠ‚ç‚¹ä¸ªæ•° &lt;= 6 ä¸ªåˆ™å°†çº¢é»‘æ ‘è½¬ä¸ºé“¾è¡¨ç»“æ„ï¼Œè§ä»£ç å—11è¯¦è§£ã€‚</p>
<p>4.4 ä»¥ loHead ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ„å»ºæ–°çš„çº¢é»‘æ ‘ï¼Œè§ä»£ç å—7è¯¦è§£ã€‚</p>
<h2 id="ä»£ç å—11untreeify">ä»£ç å—11ï¼šuntreeify<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—11untreeify">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å°†çº¢é»‘æ ‘èŠ‚ç‚¹è½¬ä¸ºé“¾è¡¨èŠ‚ç‚¹, å½“èŠ‚ç‚¹&lt;=6ä¸ªæ—¶ä¼šè¢«è§¦å‘
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> Node&lt;K,V&gt; untreeify(HashMap&lt;K,V&gt; map) {
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt; hd = <span style="color:#fff;font-weight:bold">null</span>, tl = <span style="color:#fff;font-weight:bold">null</span>; <span style="color:#007f7f">// hdæŒ‡å‘å¤´èŠ‚ç‚¹, tlæŒ‡å‘å°¾èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.ä»è°ƒç”¨è¯¥æ–¹æ³•çš„èŠ‚ç‚¹, å³é“¾è¡¨çš„å¤´èŠ‚ç‚¹å¼€å§‹éå†, å°†æ‰€æœ‰èŠ‚ç‚¹å…¨è½¬ä¸ºé“¾è¡¨èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (Node&lt;K,V&gt; q = <span style="color:#fff;font-weight:bold">this</span>; q != <span style="color:#fff;font-weight:bold">null</span>; q = q.<span style="color:#007f7f">next</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.è°ƒç”¨replacementNodeæ–¹æ³•æ„å»ºé“¾è¡¨èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        Node&lt;K,V&gt; p = map.<span style="color:#007f7f">replacementNode</span>(q, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 3.å¦‚æœtlä¸ºnull, åˆ™ä»£è¡¨å½“å‰èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹, å°†hdèµ‹å€¼ä¸ºè¯¥èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (tl == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>            hd = p;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 4.å¦åˆ™, å°†å°¾èŠ‚ç‚¹çš„nextå±æ€§è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹p</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            tl.<span style="color:#007f7f">next</span> = p;
</span></span><span style="display:flex;"><span>        tl = p; <span style="color:#007f7f">// 5.æ¯æ¬¡éƒ½å°†tlèŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹, å³å°¾èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 6.è¿”å›è½¬æ¢åçš„é“¾è¡¨çš„å¤´èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> hd;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¾‹å­1æ‰©å®¹åèŠ‚ç‚¹é‡-hash-ä¸ºä»€ä¹ˆåªå¯èƒ½åˆ†å¸ƒåœ¨-åŸç´¢å¼•ä½ç½®-ä¸-åŸç´¢å¼•--oldcap-ä½ç½®-">ä¾‹å­1ï¼šæ‰©å®¹åï¼ŒèŠ‚ç‚¹é‡ hash ä¸ºä»€ä¹ˆåªå¯èƒ½åˆ†å¸ƒåœ¨ â€œåŸç´¢å¼•ä½ç½®â€ ä¸ â€œåŸç´¢å¼• + oldCap ä½ç½®â€ ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#ä¾‹å­1æ‰©å®¹åèŠ‚ç‚¹é‡-hash-ä¸ºä»€ä¹ˆåªå¯èƒ½åˆ†å¸ƒåœ¨-åŸç´¢å¼•ä½ç½®-ä¸-åŸç´¢å¼•--oldcap-ä½ç½®-">#</a></h2>
<p>æ‰©å®¹ä»£ç ä¸­ï¼Œä½¿ç”¨ e èŠ‚ç‚¹çš„ hash å€¼è·Ÿ oldCap è¿›è¡Œä½ä¸è¿ç®—ï¼Œä»¥æ­¤å†³å®šå°†èŠ‚ç‚¹åˆ†å¸ƒåˆ° â€œåŸç´¢å¼•ä½ç½®â€ æˆ–è€… â€œåŸç´¢å¼• + oldCap ä½ç½®â€ ä¸Šï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆäº†ï¼Ÿ</p>
<p>å‡è®¾è€è¡¨çš„å®¹é‡ä¸º 16ï¼Œå³ oldCap = 16ï¼Œåˆ™æ–°è¡¨å®¹é‡ä¸º 16 * 2 = 32ï¼Œå‡è®¾èŠ‚ç‚¹ 1 çš„ hash å€¼ä¸ºï¼š0000 0000 0000 0000 0000 1111 0000 1010ï¼ŒèŠ‚ç‚¹ 2 çš„ hash å€¼ä¸ºï¼š0000 0000 0000 0000 0000 1111 0001 1010ï¼Œåˆ™èŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 2 åœ¨è€è¡¨çš„ç´¢å¼•ä½ç½®è®¡ç®—å¦‚ä¸‹å›¾è®¡ç®—1ï¼Œç”±äºè€è¡¨çš„é•¿åº¦é™åˆ¶ï¼ŒèŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 2 çš„ç´¢å¼•ä½ç½®åªå–å†³äºèŠ‚ç‚¹ hash å€¼çš„æœ€å 4 ä½ã€‚</p>
<p>å†çœ‹è®¡ç®—2ï¼Œè®¡ç®—2ä¸ºæ–°è¡¨çš„ç´¢å¼•è®¡ç®—ï¼Œå¯ä»¥çŸ¥é“å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹åœ¨è€è¡¨çš„ç´¢å¼•ä½ç½®ç›¸åŒï¼Œåˆ™æ–°è¡¨çš„ç´¢å¼•ä½ç½®åªå–å†³äºèŠ‚ç‚¹hashå€¼å€’æ•°ç¬¬5ä½çš„å€¼ï¼Œè€Œæ­¤ä½ç½®çš„å€¼åˆšå¥½ä¸ºè€è¡¨çš„å®¹é‡å€¼ 16ï¼Œæ­¤æ—¶èŠ‚ç‚¹åœ¨æ–°è¡¨çš„ç´¢å¼•ä½ç½®åªæœ‰ä¸¤ç§æƒ…å†µï¼šâ€œåŸç´¢å¼•ä½ç½®â€ å’Œ â€œåŸç´¢å¼• + oldCapä½ç½®â€ï¼Œåœ¨æ­¤ä¾‹ä¸­å³ä¸º 10 å’Œ 10 + 16 = 26ã€‚</p>
<p>ç”±äºç»“æœåªå–å†³äºèŠ‚ç‚¹ hash å€¼çš„å€’æ•°ç¬¬ 5 ä½ï¼Œè€Œæ­¤ä½ç½®çš„å€¼åˆšå¥½ä¸ºè€è¡¨çš„å®¹é‡å€¼ 16ï¼Œå› æ­¤æ­¤æ—¶æ–°è¡¨çš„ç´¢å¼•ä½ç½®çš„è®¡ç®—å¯ä»¥æ›¿æ¢ä¸ºè®¡ç®—3ï¼Œç›´æ¥ä½¿ç”¨èŠ‚ç‚¹çš„ hash å€¼ä¸è€è¡¨çš„å®¹é‡ 16 è¿›è¡Œä½äºè¿ç®—ï¼Œå¦‚æœç»“æœä¸º 0 åˆ™è¯¥èŠ‚ç‚¹åœ¨æ–°è¡¨çš„ç´¢å¼•ä½ç½®ä¸ºåŸç´¢å¼•ä½ç½®ï¼Œå¦åˆ™è¯¥èŠ‚ç‚¹åœ¨æ–°è¡¨çš„ç´¢å¼•ä½ç½®ä¸º â€œåŸç´¢å¼• + oldCap ä½ç½®â€ã€‚</p>
<p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/3.png"></p>
<h1 id="remove-æ–¹æ³•">remove æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#remove-æ–¹æ³•">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * ç§»é™¤æŸä¸ªèŠ‚ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> V remove(Object key) {
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt; e;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> (e = removeNode(hash(key), key, <span style="color:#fff;font-weight:bold">null</span>, <span style="color:#fff;font-weight:bold">false</span>, <span style="color:#fff;font-weight:bold">true</span>)) == <span style="color:#fff;font-weight:bold">null</span> ?
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">null</span> : e.<span style="color:#007f7f">value</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> Node&lt;K,V&gt; removeNode(<span style="color:#fff;font-weight:bold">int</span> hash, Object key, Object value,
</span></span><span style="display:flex;"><span>                           <span style="color:#fff;font-weight:bold">boolean</span> matchValue, <span style="color:#fff;font-weight:bold">boolean</span> movable) {
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span style="color:#fff;font-weight:bold">int</span> n, index;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.å¦‚æœtableä¸ä¸ºç©ºå¹¶ä¸”æ ¹æ®hashå€¼è®¡ç®—å‡ºæ¥çš„ç´¢å¼•ä½ç½®ä¸ä¸ºç©º, å°†è¯¥ä½ç½®çš„èŠ‚ç‚¹èµ‹å€¼ç»™p</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> ((tab = table) != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; (n = tab.<span style="color:#007f7f">length</span>) &gt; 0 &amp;&amp;
</span></span><span style="display:flex;"><span>        (p = tab[index = (n - 1) &amp; hash]) != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        Node&lt;K,V&gt; node = <span style="color:#fff;font-weight:bold">null</span>, e; K k; V v;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 2.å¦‚æœpçš„hashå€¼å’Œkeyéƒ½ä¸å…¥å‚çš„ç›¸åŒ, åˆ™på³ä¸ºç›®æ ‡èŠ‚ç‚¹, èµ‹å€¼ç»™node</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (p.<span style="color:#007f7f">hash</span> == hash &amp;&amp;
</span></span><span style="display:flex;"><span>            ((k = p.<span style="color:#007f7f">key</span>) == key || (key != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; key.<span style="color:#007f7f">equals</span>(k))))
</span></span><span style="display:flex;"><span>            node = p;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> ((e = p.<span style="color:#007f7f">next</span>) != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.å¦åˆ™å°†p.nextèµ‹å€¼ç»™eï¼Œå‘ä¸‹éå†èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 3.1 å¦‚æœpæ˜¯TreeNodeåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æŸ¥æ‰¾èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (p <span style="color:#fff;font-weight:bold">instanceof</span> TreeNode)
</span></span><span style="display:flex;"><span>                node = ((TreeNode&lt;K,V&gt;)p).<span style="color:#007f7f">getTreeNode</span>(hash, key);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 3.2 å¦åˆ™ï¼Œè¿›è¡Œæ™®é€šé“¾è¡¨èŠ‚ç‚¹çš„æŸ¥æ‰¾</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// å½“èŠ‚ç‚¹çš„hashå€¼å’Œkeyä¸ä¼ å…¥çš„ç›¸åŒ,åˆ™è¯¥èŠ‚ç‚¹å³ä¸ºç›®æ ‡èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">if</span> (e.<span style="color:#007f7f">hash</span> == hash &amp;&amp;
</span></span><span style="display:flex;"><span>                        ((k = e.<span style="color:#007f7f">key</span>) == key ||
</span></span><span style="display:flex;"><span>                         (key != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; key.<span style="color:#007f7f">equals</span>(k)))) {
</span></span><span style="display:flex;"><span>                        node = e;	<span style="color:#007f7f">// èµ‹å€¼ç»™node, å¹¶è·³å‡ºå¾ªç¯</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    p = e;  <span style="color:#007f7f">// pèŠ‚ç‚¹èµ‹å€¼ä¸ºæœ¬æ¬¡ç»“æŸçš„eï¼Œåœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œeä¸ºpçš„nextèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#fff;font-weight:bold">while</span> ((e = e.<span style="color:#007f7f">next</span>) != <span style="color:#fff;font-weight:bold">null</span>); <span style="color:#007f7f">// eæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 4.å¦‚æœnodeä¸ä¸ºç©º(å³æ ¹æ®ä¼ å…¥keyå’Œhashå€¼æŸ¥æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹)ï¼Œåˆ™è¿›è¡Œç§»é™¤æ“ä½œ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (node != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; (!matchValue || (v = node.<span style="color:#007f7f">value</span>) == value ||
</span></span><span style="display:flex;"><span>                             (value != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; value.<span style="color:#007f7f">equals</span>(v)))) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 4.1 å¦‚æœæ˜¯TreeNodeåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„ç§»é™¤æ–¹æ³•</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (node <span style="color:#fff;font-weight:bold">instanceof</span> TreeNode)
</span></span><span style="display:flex;"><span>                ((TreeNode&lt;K,V&gt;)node).<span style="color:#007f7f">removeTreeNode</span>(<span style="color:#fff;font-weight:bold">this</span>, tab, movable);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 4.2 å¦‚æœnodeæ˜¯è¯¥ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹åˆ™ç›´æ¥å°†è¯¥ç´¢å¼•ä½ç½®çš„å€¼èµ‹å€¼ä¸ºnodeçš„nextèŠ‚ç‚¹ï¼Œ</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// â€œnode == pâ€åªä¼šå‡ºç°åœ¨nodeæ˜¯å¤´èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚æœnodeä¸æ˜¯å¤´èŠ‚ç‚¹ï¼Œåˆ™nodeä¸ºpçš„nextèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (node == p)
</span></span><span style="display:flex;"><span>                tab[index] = node.<span style="color:#007f7f">next</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 4.3 å¦åˆ™å°†nodeçš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„nextå±æ€§è®¾ç½®ä¸ºnodeçš„nextèŠ‚ç‚¹,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å³å°†nodeèŠ‚ç‚¹ç§»é™¤, å°†nodeçš„ä¸Šä¸‹èŠ‚ç‚¹è¿›è¡Œå…³è”(é“¾è¡¨çš„ç§»é™¤)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                p.<span style="color:#007f7f">next</span> = node.<span style="color:#007f7f">next</span>;
</span></span><span style="display:flex;"><span>            ++modCount;
</span></span><span style="display:flex;"><span>            --size;
</span></span><span style="display:flex;"><span>            afterNodeRemoval(node); <span style="color:#007f7f">// ä¾›LinkedHashMapä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 5.è¿”å›è¢«ç§»é™¤çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> node;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>3.1 å¦‚æœ p æ˜¯ TreeNode åˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æŸ¥æ‰¾èŠ‚ç‚¹ï¼Œ<strong>è§ä»£ç å—1è¯¦è§£</strong>ã€‚</p>
<p>4.1 å¦‚æœæ˜¯ TreeNode åˆ™è°ƒç”¨çº¢é»‘æ ‘çš„ç§»é™¤æ–¹æ³•ï¼Œ<strong>è§ä»£ç å—12è¯¦è§£</strong>ã€‚</p>
<h2 id="ä»£ç å—12removetreenode">ä»£ç å—12ï¼šremoveTreeNode<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å—12removetreenode">#</a></h2>
<p>è¿™å—ä»£ç æ¯”è¾ƒé•¿ï¼Œç›®çš„å°±æ˜¯ç§»é™¤è°ƒç”¨æ­¤æ–¹æ³•çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯¥æ–¹æ³•ä¸­çš„ this èŠ‚ç‚¹ã€‚ç§»é™¤åŒ…æ‹¬é“¾è¡¨çš„å¤„ç†å’Œçº¢é»‘æ ‘çš„å¤„ç†ã€‚å¯ä»¥ç»“åˆä¸‹æ–‡çš„å›¾è§£ç†è§£ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * çº¢é»‘æ ‘çš„èŠ‚ç‚¹ç§»é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">void</span> removeTreeNode(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab,
</span></span><span style="display:flex;"><span>                          <span style="color:#fff;font-weight:bold">boolean</span> movable) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// --- é“¾è¡¨çš„å¤„ç†start ---</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> n;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 1.tableä¸ºç©ºæˆ–è€…lengthä¸º0ç›´æ¥è¿”å›</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (tab == <span style="color:#fff;font-weight:bold">null</span> || (n = tab.<span style="color:#007f7f">length</span>) == 0)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 2.æ ¹æ®hashè®¡ç®—å‡ºç´¢å¼•çš„ä½ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> index = (n - 1) &amp; hash;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 3.å°†ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹èµ‹å€¼ç»™firstå’Œroot</span>
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; first = (TreeNode&lt;K,V&gt;)tab[index], root = first, rl;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 4.è¯¥æ–¹æ³•è¢«å°†è¦è¢«ç§»é™¤çš„node(TreeNode)è°ƒç”¨, å› æ­¤æ­¤æ–¹æ³•çš„thisä¸ºè¦è¢«ç§»é™¤nodeèŠ‚ç‚¹,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å°†nodeçš„nextèŠ‚ç‚¹èµ‹å€¼ç»™succèŠ‚ç‚¹ï¼ŒprevèŠ‚ç‚¹èµ‹å€¼ç»™predèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; succ = (TreeNode&lt;K,V&gt;)next, pred = prev;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 5.å¦‚æœpredèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ä»£è¡¨è¦è¢«ç§»é™¤çš„nodeèŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹ï¼Œ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ™å°†tableç´¢å¼•ä½ç½®çš„å€¼å’ŒfirstèŠ‚ç‚¹çš„å€¼èµ‹å€¼ä¸ºsuccèŠ‚ç‚¹(nodeçš„nextèŠ‚ç‚¹)å³å¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (pred == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        tab[index] = first = succ;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 6.å¦åˆ™å°†predèŠ‚ç‚¹çš„nextå±æ€§è®¾ç½®ä¸ºsuccèŠ‚ç‚¹(nodeçš„nextèŠ‚ç‚¹)</span>
</span></span><span style="display:flex;"><span>        pred.<span style="color:#007f7f">next</span> = succ;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 7.å¦‚æœsuccèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™å°†succçš„prevèŠ‚ç‚¹è®¾ç½®ä¸ºpred, ä¸å‰é¢å¯¹åº”</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (succ != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        succ.<span style="color:#007f7f">prev</span> = pred;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 8.å¦‚æœè¿›è¡Œåˆ°æ­¤firstèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ä»£è¡¨è¯¥ç´¢å¼•ä½ç½®å·²ç»æ²¡æœ‰èŠ‚ç‚¹åˆ™ç›´æ¥è¿”å›</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (first == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 9.å¦‚æœrootçš„çˆ¶èŠ‚ç‚¹ä¸ä¸ºç©º, åˆ™å°†rootèµ‹å€¼ä¸ºæ ¹èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (root.<span style="color:#007f7f">parent</span> != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        root = root.<span style="color:#007f7f">root</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 10.é€šè¿‡rootèŠ‚ç‚¹æ¥åˆ¤æ–­æ­¤çº¢é»‘æ ‘æ˜¯å¦å¤ªå°, å¦‚æœæ˜¯åˆ™è°ƒç”¨untreeifyæ–¹æ³•è½¬ä¸ºé“¾è¡¨èŠ‚ç‚¹å¹¶è¿”å›</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// (è½¬é“¾è¡¨åå°±æ— éœ€å†è¿›è¡Œä¸‹é¢çš„çº¢é»‘æ ‘å¤„ç†)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (root == <span style="color:#fff;font-weight:bold">null</span> || root.<span style="color:#007f7f">right</span> == <span style="color:#fff;font-weight:bold">null</span> ||
</span></span><span style="display:flex;"><span>        (rl = root.<span style="color:#007f7f">left</span>) == <span style="color:#fff;font-weight:bold">null</span> || rl.<span style="color:#007f7f">left</span> == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        tab[index] = first.<span style="color:#007f7f">untreeify</span>(map);  <span style="color:#007f7f">// too small</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// --- é“¾è¡¨çš„å¤„ç†end ---</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// --- ä»¥ä¸‹ä»£ç ä¸ºçº¢é»‘æ ‘çš„å¤„ç† ---</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 11.å°†pèµ‹å€¼ä¸ºè¦è¢«ç§»é™¤çš„nodeèŠ‚ç‚¹ï¼Œplèµ‹å€¼ä¸ºpçš„å·¦èŠ‚ç‚¹ï¼Œprèµ‹å€¼ä¸ºp çš„å³èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; p = <span style="color:#fff;font-weight:bold">this</span>, pl = left, pr = right, replacement;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 12.å¦‚æœpçš„å·¦èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹éƒ½ä¸ä¸ºç©ºæ—¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (pl != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; pr != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 12.1 å°†sèŠ‚ç‚¹èµ‹å€¼ä¸ºpçš„å³èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        TreeNode&lt;K,V&gt; s = pr, sl;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 12.2 å‘å·¦ä¸€ç›´æŸ¥æ‰¾ï¼Œè·³å‡ºå¾ªç¯æ—¶,sä¸ºæ²¡æœ‰å·¦èŠ‚ç‚¹çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> ((sl = s.<span style="color:#007f7f">left</span>) != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>            s = sl;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 12.3 äº¤æ¢pèŠ‚ç‚¹å’ŒsèŠ‚ç‚¹çš„é¢œè‰²</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">boolean</span> c = s.<span style="color:#007f7f">red</span>; s.<span style="color:#007f7f">red</span> = p.<span style="color:#007f7f">red</span>; p.<span style="color:#007f7f">red</span> = c;
</span></span><span style="display:flex;"><span>        TreeNode&lt;K,V&gt; sr = s.<span style="color:#007f7f">right</span>; <span style="color:#007f7f">// sçš„å³èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        TreeNode&lt;K,V&gt; pp = p.<span style="color:#007f7f">parent</span>;    <span style="color:#007f7f">// pçš„çˆ¶èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// --- ç¬¬ä¸€æ¬¡è°ƒæ•´å’Œç¬¬äºŒæ¬¡è°ƒæ•´ï¼šå°†pèŠ‚ç‚¹å’ŒsèŠ‚ç‚¹è¿›è¡Œäº†ä½ç½®è°ƒæ¢ ---</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 12.4 ç¬¬ä¸€æ¬¡è°ƒæ•´</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¦‚æœpèŠ‚ç‚¹çš„å³èŠ‚ç‚¹å³ä¸ºsèŠ‚ç‚¹ï¼Œåˆ™å°†pçš„çˆ¶èŠ‚ç‚¹èµ‹å€¼ä¸ºsï¼Œå°†sçš„å³èŠ‚ç‚¹èµ‹å€¼ä¸ºp</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (s == pr) {
</span></span><span style="display:flex;"><span>            p.<span style="color:#007f7f">parent</span> = s;
</span></span><span style="display:flex;"><span>            s.<span style="color:#007f7f">right</span> = p;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å°†spèµ‹å€¼ä¸ºsçš„çˆ¶èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            TreeNode&lt;K,V&gt; sp = s.<span style="color:#007f7f">parent</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å°†pçš„çˆ¶èŠ‚ç‚¹èµ‹å€¼ä¸ºsp</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> ((p.<span style="color:#007f7f">parent</span> = sp) != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å¦‚æœsèŠ‚ç‚¹ä¸ºspçš„å·¦èŠ‚ç‚¹ï¼Œåˆ™å°†spçš„å·¦èŠ‚ç‚¹èµ‹å€¼ä¸ºpèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (s == sp.<span style="color:#007f7f">left</span>)
</span></span><span style="display:flex;"><span>                    sp.<span style="color:#007f7f">left</span> = p;
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å¦åˆ™sèŠ‚ç‚¹ä¸ºspçš„å³èŠ‚ç‚¹ï¼Œåˆ™å°†spçš„å³èŠ‚ç‚¹èµ‹å€¼ä¸ºpèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                    sp.<span style="color:#007f7f">right</span> = p;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// sçš„å³èŠ‚ç‚¹èµ‹å€¼ä¸ºpèŠ‚ç‚¹çš„å³èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> ((s.<span style="color:#007f7f">right</span> = pr) != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å¦‚æœprä¸ä¸ºç©ºï¼Œåˆ™å°†prçš„çˆ¶èŠ‚ç‚¹èµ‹å€¼ä¸ºs</span>
</span></span><span style="display:flex;"><span>                pr.<span style="color:#007f7f">parent</span> = s;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 12.5 ç¬¬äºŒæ¬¡è°ƒæ•´</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†pçš„å·¦èŠ‚ç‚¹èµ‹å€¼ä¸ºç©ºï¼Œplå·²ç»ä¿å­˜äº†è¯¥èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        p.<span style="color:#007f7f">left</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†pèŠ‚ç‚¹çš„å³èŠ‚ç‚¹èµ‹å€¼ä¸ºsrï¼Œå¦‚æœsrä¸ä¸ºç©ºï¼Œåˆ™å°†srçš„çˆ¶èŠ‚ç‚¹èµ‹å€¼ä¸ºpèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((p.<span style="color:#007f7f">right</span> = sr) != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>            sr.<span style="color:#007f7f">parent</span> = p;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†sèŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹èµ‹å€¼ä¸ºplï¼Œå¦‚æœplä¸ä¸ºç©ºï¼Œåˆ™å°†plçš„çˆ¶èŠ‚ç‚¹èµ‹å€¼ä¸ºsèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((s.<span style="color:#007f7f">left</span> = pl) != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>            pl.<span style="color:#007f7f">parent</span> = s;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†sçš„çˆ¶èŠ‚ç‚¹èµ‹å€¼ä¸ºpçš„çˆ¶èŠ‚ç‚¹pp</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¦‚æœppä¸ºç©ºï¼Œåˆ™pèŠ‚ç‚¹ä¸ºrootèŠ‚ç‚¹, äº¤æ¢åsæˆä¸ºæ–°çš„rootèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((s.<span style="color:#007f7f">parent</span> = pp) == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>            root = s;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¦‚æœpä¸ä¸ºrootèŠ‚ç‚¹, å¹¶ä¸”pæ˜¯ppçš„å·¦èŠ‚ç‚¹ï¼Œåˆ™å°†ppçš„å·¦èŠ‚ç‚¹èµ‹å€¼ä¸ºsèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (p == pp.<span style="color:#007f7f">left</span>)
</span></span><span style="display:flex;"><span>            pp.<span style="color:#007f7f">left</span> = s;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¦‚æœpä¸ä¸ºrootèŠ‚ç‚¹, å¹¶ä¸”pæ˜¯ppçš„å³èŠ‚ç‚¹ï¼Œåˆ™å°†ppçš„å³èŠ‚ç‚¹èµ‹å€¼ä¸ºsèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            pp.<span style="color:#007f7f">right</span> = s;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 12.6 å¯»æ‰¾replacementèŠ‚ç‚¹ï¼Œç”¨æ¥æ›¿æ¢æ‰pèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 12.6.1 å¦‚æœsrä¸ä¸ºç©ºï¼Œåˆ™replacementèŠ‚ç‚¹ä¸ºsrï¼Œå› ä¸ºsæ²¡æœ‰å·¦èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä½¿ç”¨sçš„å³èŠ‚ç‚¹æ¥æ›¿æ¢pçš„ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (sr != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>            replacement = sr;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 12.6.1 å¦‚æœsrä¸ºç©ºï¼Œåˆ™sä¸ºå¶å­èŠ‚ç‚¹ï¼Œreplacementä¸ºpæœ¬èº«ï¼Œåªéœ€è¦å°†pèŠ‚ç‚¹ç›´æ¥å»é™¤å³å¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            replacement = p;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 13.æ‰¿æ¥12ç‚¹çš„åˆ¤æ–­ï¼Œå¦‚æœpçš„å·¦èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå³èŠ‚ç‚¹ä¸ºç©ºï¼ŒreplacementèŠ‚ç‚¹ä¸ºpçš„å·¦èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (pl != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        replacement = pl;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 14.å¦‚æœpçš„å³èŠ‚ç‚¹ä¸ä¸ºç©º,å·¦èŠ‚ç‚¹ä¸ºç©ºï¼ŒreplacementèŠ‚ç‚¹ä¸ºpçš„å³èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (pr != <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        replacement = pr;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 15.å¦‚æœpçš„å·¦å³èŠ‚ç‚¹éƒ½ä¸ºç©º, å³pä¸ºå¶å­èŠ‚ç‚¹, replacementèŠ‚ç‚¹ä¸ºpèŠ‚ç‚¹æœ¬èº«</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        replacement = p;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 16.ç¬¬ä¸‰æ¬¡è°ƒæ•´ï¼šä½¿ç”¨replacementèŠ‚ç‚¹æ›¿æ¢æ‰pèŠ‚ç‚¹çš„ä½ç½®ï¼Œå°†pèŠ‚ç‚¹ç§»é™¤</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (replacement != p) { <span style="color:#007f7f">// å¦‚æœpèŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 16.1 å°†pèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹èµ‹å€¼ç»™replacementèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹, åŒæ—¶èµ‹å€¼ç»™ppèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        TreeNode&lt;K,V&gt; pp = replacement.<span style="color:#007f7f">parent</span> = p.<span style="color:#007f7f">parent</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 16.2 å¦‚æœpæ²¡æœ‰çˆ¶èŠ‚ç‚¹, å³pä¸ºrootèŠ‚ç‚¹ï¼Œåˆ™å°†rootèŠ‚ç‚¹èµ‹å€¼ä¸ºreplacementèŠ‚ç‚¹å³å¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (pp == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>            root = replacement;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 16.3 å¦‚æœpä¸æ˜¯rootèŠ‚ç‚¹, å¹¶ä¸”pä¸ºppçš„å·¦èŠ‚ç‚¹ï¼Œåˆ™å°†ppçš„å·¦èŠ‚ç‚¹èµ‹å€¼ä¸ºæ›¿æ¢èŠ‚ç‚¹replacement</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (p == pp.<span style="color:#007f7f">left</span>)
</span></span><span style="display:flex;"><span>            pp.<span style="color:#007f7f">left</span> = replacement;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 16.4 å¦‚æœpä¸æ˜¯rootèŠ‚ç‚¹, å¹¶ä¸”pä¸ºppçš„å³èŠ‚ç‚¹ï¼Œåˆ™å°†ppçš„å³èŠ‚ç‚¹èµ‹å€¼ä¸ºæ›¿æ¢èŠ‚ç‚¹replacement</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            pp.<span style="color:#007f7f">right</span> = replacement;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 16.5 pèŠ‚ç‚¹çš„ä½ç½®å·²ç»è¢«å®Œæ•´çš„æ›¿æ¢ä¸ºreplacement, å°†pèŠ‚ç‚¹æ¸…ç©º, ä»¥ä¾¿åƒåœ¾æ”¶é›†å™¨å›æ”¶</span>
</span></span><span style="display:flex;"><span>        p.<span style="color:#007f7f">left</span> = p.<span style="color:#007f7f">right</span> = p.<span style="color:#007f7f">parent</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 17.å¦‚æœpèŠ‚ç‚¹ä¸ä¸ºçº¢è‰²åˆ™è¿›è¡Œçº¢é»‘æ ‘åˆ é™¤å¹³è¡¡è°ƒæ•´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// (å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æ˜¯çº¢è‰²åˆ™ä¸ä¼šç ´åçº¢é»‘æ ‘çš„å¹³è¡¡æ— éœ€è°ƒæ•´)</span>
</span></span><span style="display:flex;"><span>    TreeNode&lt;K,V&gt; r = p.<span style="color:#007f7f">red</span> ? root : balanceDeletion(root, replacement);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 18.å¦‚æœpèŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹, åˆ™ç®€å•çš„å°†pèŠ‚ç‚¹å»é™¤å³å¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (replacement == p) {
</span></span><span style="display:flex;"><span>        TreeNode&lt;K,V&gt; pp = p.<span style="color:#007f7f">parent</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 18.1 å°†pçš„parentå±æ€§è®¾ç½®ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>        p.<span style="color:#007f7f">parent</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (pp != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 18.2 å¦‚æœpèŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼Œåˆ™å°†çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹èµ‹å€¼ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (p == pp.<span style="color:#007f7f">left</span>)
</span></span><span style="display:flex;"><span>                pp.<span style="color:#007f7f">left</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 18.3 å¦‚æœpèŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼Œ åˆ™å°†çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹èµ‹å€¼ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (p == pp.<span style="color:#007f7f">right</span>)
</span></span><span style="display:flex;"><span>                pp.<span style="color:#007f7f">right</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (movable)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 19.å°†rootèŠ‚ç‚¹ç§»åˆ°ç´¢å¼•ä½ç½®çš„å¤´èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        moveRootToFront(tab, r);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>7.å¦‚æœ succ èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™å°† succ çš„ prev èŠ‚ç‚¹è®¾ç½®ä¸º predï¼Œä¸å‰é¢å¯¹åº”ï¼ˆTreeNode é“¾è¡¨çš„ç§»é™¤ï¼Œè§å¼€å¤´ç¬¬8ç‚¹ï¼‰ã€‚</p>
<p>12.6 å¯»æ‰¾ replacementï¼Œç”¨æ¥æ›¿æ¢æ‰ p èŠ‚ç‚¹ã€‚ä¸ºä»€ä¹ˆ sr æ˜¯ replacement çš„é¦–é€‰ï¼Œp ä¸ºå¤‡é€‰ï¼Ÿè§è§£é‡Š1ã€‚</p>
<p>PSï¼šä»£ç ä¸­çš„ç¬¬ä¸€æ¬¡è°ƒæ•´å’Œç¬¬äºŒæ¬¡è°ƒæ•´æ˜¯å°† p èŠ‚ç‚¹å’Œ s èŠ‚ç‚¹è¿›è¡Œäº†ä½ç½®è°ƒæ¢ï¼Œç„¶åæ‰¾å‡ºè¦æ›¿æ¢æ‰ p èŠ‚ç‚¹çš„ replacementï¼›ç¬¬ä¸‰æ¬¡è°ƒæ•´æ˜¯å°† replacement èŠ‚ç‚¹è¦†ç›–æ‰ p èŠ‚ç‚¹ï¼›è¿™éƒ¨åˆ†çš„ä»£ç é€»è¾‘éå¸¸å¤æ‚ï¼Œå»ºè®®è‡ªå·±åŠ¨æ‰‹ç”»å›¾æ¨¡æ‹Ÿã€‚ï¼ˆä¸‹æ–‡å›¾è§£1å³ä¸ºè¿™ä¸‰æ¬¡è°ƒæ•´çš„ä¾‹å­ï¼‰</p>
<p>è§£é‡Š1ï¼šä¸ºä»€ä¹ˆ sr æ˜¯ replacement çš„é¦–é€‰ï¼Œp ä¸ºå¤‡é€‰ï¼Ÿ
è§£æï¼šé¦–å…ˆæˆ‘ä»¬çœ‹ sr æ˜¯ä»€ä¹ˆï¼Ÿä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ° sr ç¬¬ä¸€æ¬¡è¢«èµ‹å€¼æ—¶ï¼Œæ˜¯åœ¨ s èŠ‚ç‚¹è¿›è¡Œäº†å‘å·¦ç©·éå†ç»“æŸåï¼Œå› æ­¤æ­¤æ—¶ s èŠ‚ç‚¹æ˜¯æ²¡æœ‰å·¦èŠ‚ç‚¹çš„ï¼Œsr å³ä¸º s èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ã€‚è€Œä»ä¸Šé¢çš„ç¬¬ä¸€æ¬¡è°ƒæ•´å’Œç¬¬äºŒæ¬¡è°ƒæ•´æˆ‘ä»¬çŸ¥é“ï¼Œp èŠ‚ç‚¹å·²ç»è·Ÿ s èŠ‚ç‚¹è¿›è¡Œäº†ä½ç½®è°ƒæ¢ï¼Œæ‰€ä»¥æ­¤æ—¶ sr å…¶å®æ˜¯ p èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼Œå¹¶ä¸” p èŠ‚ç‚¹æ²¡æœ‰å·¦èŠ‚ç‚¹ï¼Œå› æ­¤è¦ç§»é™¤ p èŠ‚ç‚¹ï¼Œåªéœ€è¦å°† p èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ sr è¦†ç›–æ‰ p èŠ‚ç‚¹å³å¯ï¼Œå› æ­¤ sr æ˜¯ replacement çš„é¦–é€‰ï¼Œè€Œå¦‚æœ sr ä¸ºç©ºï¼Œåˆ™ä»£è¡¨ p èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ï¼Œæ­¤æ—¶å°† p èŠ‚ç‚¹ç›´æ¥ç§»é™¤å³å¯ã€‚</p>
<p>å›¾è§£1ï¼šremoveTreeNode å›¾è§£
æœ¬å›¾è§£å¿½ç•¥çº¢é»‘æ ‘çš„é¢œè‰²ï¼Œè¯·æ³¨æ„ã€‚</p>
<p>ä¸‹é¢çš„å›¾è§£æ˜¯ä»£ç ä¸­çš„æœ€å¤æ‚çš„æƒ…å†µï¼Œå³æµç¨‹æœ€é•¿çš„é‚£ä¸ªï¼Œp èŠ‚ç‚¹ä¸ä¸ºæ ¹èŠ‚ç‚¹ï¼Œp èŠ‚ç‚¹æœ‰å·¦å³èŠ‚ç‚¹ï¼Œs èŠ‚ç‚¹ä¸ä¸º pr èŠ‚ç‚¹ï¼Œs èŠ‚ç‚¹æœ‰å³èŠ‚ç‚¹ã€‚</p>
<p>å¦å¤–ï¼Œç¬¬ä¸€æ¬¡è°ƒæ•´å’Œç¬¬äºŒæ¬¡è°ƒæ•´çš„æ˜¯æœ¬äººæ ¹æ®ä»£ç è€Œè®¾å®šçš„ï¼Œå°†ç¬¬ä¸€æ¬¡è°ƒæ•´å’Œç¬¬äºŒæ¬¡è°ƒæ•´åˆèµ·æ¥çœ‹ä¼šæ›´å®¹æ˜“ç†è§£ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡è°ƒæ•´ + ç¬¬äºŒæ¬¡è°ƒæ•´ï¼šå°† p èŠ‚ç‚¹å’Œ s èŠ‚ç‚¹è¿›è¡Œäº†ä½ç½®è°ƒæ¢ï¼Œé€‰å‡ºè¦æ›¿æ¢æ‰ p èŠ‚ç‚¹çš„ replacement</li>
<li>ç¬¬ä¸‰æ¬¡è°ƒæ•´ï¼šå°† replacement èŠ‚ç‚¹è¦†ç›–æ‰ p èŠ‚ç‚¹</li>
</ul>
<p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/4.png"></p>
<h2 id="è§£é‡Š2å…³äºçº¢é»‘æ ‘çš„å¹³è¡¡è°ƒæ•´">è§£é‡Š2ï¼šå…³äºçº¢é»‘æ ‘çš„å¹³è¡¡è°ƒæ•´ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#è§£é‡Š2å…³äºçº¢é»‘æ ‘çš„å¹³è¡¡è°ƒæ•´">#</a></h2>
<p>ç­”ï¼šçº¢é»‘æ ‘çš„æ“ä½œæ¶‰åŠçš„æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œä¸‰è¨€ä¸¤è¯­æ— æ³•è¯´æ¸…ã€‚æœ‰å…´è¶£çš„å¯ä»¥å»å•ç‹¬å­¦ä¹ ï¼Œæœ¬æ–‡ç”±äºç¯‡å¹…å…³ç³»æš‚ä¸è¯¦ç»†ä»‹ç»çº¢é»‘æ ‘çš„å…·ä½“æ“ä½œï¼Œåœ¨è¿™ç®€å•çš„ä»‹ç»ï¼šçº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æ ‘ï¼Œæ‹¥æœ‰ä¼˜ç§€çš„æŸ¥è¯¢å’Œæ’å…¥/åˆ é™¤æ€§èƒ½ï¼Œå¹¿æ³›åº”ç”¨äºå…³è”æ•°ç»„ã€‚</p>
<p>å¯¹æ¯” AVL æ ‘ï¼ŒAVL è¦æ±‚æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦ä¹‹å·®çš„ç»å¯¹å€¼ï¼ˆå¹³è¡¡å› å­ï¼‰æœ€å¤šä¸º 1ï¼Œè€Œçº¢é»‘æ ‘é€šè¿‡é€‚å½“çš„æ”¾ä½è¯¥æ¡ä»¶ï¼ˆçº¢é»‘æ ‘é™åˆ¶ä»æ ¹åˆ°å¶å­çš„æœ€é•¿çš„å¯èƒ½è·¯å¾„ä¸å¤šäºæœ€çŸ­çš„å¯èƒ½è·¯å¾„çš„ä¸¤å€é•¿ï¼Œç»“æœæ˜¯è¿™ä¸ªæ ‘å¤§è‡´ä¸Šæ˜¯å¹³è¡¡çš„ï¼‰ï¼Œä»¥æ­¤æ¥å‡å°‘æ’å…¥/åˆ é™¤æ—¶çš„å¹³è¡¡è°ƒæ•´è€—æ—¶ï¼Œä»è€Œè·å–æ›´å¥½çš„æ€§èƒ½ï¼Œè€Œè¿™è™½ç„¶ä¼šå¯¼è‡´çº¢é»‘æ ‘çš„æŸ¥è¯¢ä¼šæ¯” AVL ç¨æ…¢ï¼Œä½†ç›¸æ¯”æ’å…¥/åˆ é™¤æ—¶è·å–çš„æ—¶é—´ï¼Œè¿™ä¸ªä»˜å‡ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¾ç„¶æ˜¯å€¼å¾—çš„ã€‚</p>
<p>åœ¨ HashMap ä¸­çš„åº”ç”¨ï¼šHashMap åœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ—¶æœ‰å¯èƒ½ä¼šè§¦å‘çº¢é»‘æ ‘çš„æ’å…¥å¹³è¡¡è°ƒæ•´ï¼ˆbalanceInsertion æ–¹æ³•ï¼‰æˆ–åˆ é™¤å¹³è¡¡è°ƒæ•´ï¼ˆbalanceDeletion æ–¹æ³•ï¼‰ï¼Œè°ƒæ•´çš„æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹æ‰‹æ®µï¼šå·¦æ—‹è½¬ï¼ˆrotateLeft æ–¹æ³•ï¼‰ã€å³æ—‹è½¬ï¼ˆrotateRight æ–¹æ³•ï¼‰ã€æ”¹å˜èŠ‚ç‚¹é¢œè‰²ï¼ˆx.red = falseã€x.red = trueï¼‰ï¼Œè¿›è¡Œè°ƒæ•´çš„åŸå› æ˜¯ä¸ºäº†ç»´æŒçº¢é»‘æ ‘çš„æ•°æ®ç»“æ„ã€‚</p>
<h1 id="æ­»å¾ªç¯é—®é¢˜">æ­»å¾ªç¯é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#æ­»å¾ªç¯é—®é¢˜">#</a></h1>
<p>åœ¨ JDK 1.8 ä»¥å‰ï¼ŒJava è¯­è¨€åœ¨å¹¶å‘æƒ…å†µä¸‹ä½¿ç”¨ HashMap é€ æˆ Race Conditionï¼Œä»è€Œå¯¼è‡´æ­»å¾ªç¯ã€‚ç¨‹åºç»å¸¸å äº† 100% çš„ CPUï¼ŒæŸ¥çœ‹å †æ ˆï¼Œä½ ä¼šå‘ç°ç¨‹åºéƒ½ Hang åœ¨äº† â€œHashMap.get()â€ è¿™ä¸ªæ–¹æ³•ä¸Šäº†ï¼Œé‡å¯ç¨‹åºåé—®é¢˜æ¶ˆå¤±ã€‚å…·ä½“åˆ†æå¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://coolshell.cn/articles/9606.html">ç–«è‹—ï¼šJAVA HASHMAPçš„æ­»å¾ªç¯</a>ï¼Œæœ‰äººå°†è¿™ä¸ªé—®é¢˜å½“æˆä¸€ä¸ª bug æç»™äº† Sunï¼Œä½†æ˜¯ Sun è®¤ä¸ºè¿™å¹¶ä¸æ˜¯ä¸ª bugï¼Œå› ä¸ºHashMap æœ¬æ¥å°±ä¸ä¿è¯å¹¶å‘çš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œåœ¨å¹¶å‘ä¸‹ï¼Œè¦ç”¨ ConcurrentHashMap æ¥ä»£æ›¿ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒJDK 1.8 ä»¥å‰ï¼Œå¯¼è‡´æ­»å¾ªç¯çš„ä¸»è¦åŸå› æ˜¯æ‰©å®¹åï¼ŒèŠ‚ç‚¹çš„é¡ºåºä¼šåæ‰ï¼Œå¦‚ä¸‹å›¾ï¼šæ‰©å®¹å‰èŠ‚ç‚¹ A åœ¨èŠ‚ç‚¹ C å‰é¢ï¼Œè€Œæ‰©å®¹åèŠ‚ç‚¹ C åœ¨èŠ‚ç‚¹ A å‰é¢ã€‚</p>
<h1 id="jdk-18æ‰©å®¹è¿‡ç¨‹">JDK 1.8æ‰©å®¹è¿‡ç¨‹<a hidden class="anchor" aria-hidden="true" href="#jdk-18æ‰©å®¹è¿‡ç¨‹">#</a></h1>
<p>JDK1.8 æ™®é€šé“¾è¡¨çš„æ‰©å®¹ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨ä¸Šæ–‡å·²ç»åˆ†æè¿‡äº†ï¼šä¸»è¦æ˜¯åœ¨ä¸€ä¸ª do/while ä¸­å¤„ç†åŒä¸€ä¸ªä½ç½®çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">else</span> { <span style="color:#007f7f">// preserve order</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 9.å¦‚æœæ˜¯æ™®é€šçš„é“¾è¡¨èŠ‚ç‚¹ï¼Œåˆ™è¿›è¡Œæ™®é€šçš„é‡hashåˆ†å¸ƒ</span>
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt; loHead = <span style="color:#fff;font-weight:bold">null</span>, loTail = <span style="color:#fff;font-weight:bold">null</span>; <span style="color:#007f7f">// å­˜å‚¨ç´¢å¼•ä½ç½®ä¸º:â€œåŸç´¢å¼•ä½ç½®â€çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt; hiHead = <span style="color:#fff;font-weight:bold">null</span>, hiTail = <span style="color:#fff;font-weight:bold">null</span>; <span style="color:#007f7f">// å­˜å‚¨ç´¢å¼•ä½ç½®ä¸º:â€œåŸç´¢å¼•ä½ç½®+oldCapâ€çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    Node&lt;K,V&gt; next;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>        next = e.<span style="color:#007f7f">next</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 9.1 å¦‚æœeçš„hashå€¼ä¸è€è¡¨çš„å®¹é‡è¿›è¡Œä¸è¿ç®—ä¸º0,åˆ™æ‰©å®¹åçš„ç´¢å¼•ä½ç½®è·Ÿè€è¡¨çš„ç´¢å¼•ä½ç½®ä¸€æ ·</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((e.<span style="color:#007f7f">hash</span> &amp; oldCap) == 0) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (loTail == <span style="color:#fff;font-weight:bold">null</span>) <span style="color:#007f7f">// å¦‚æœloTailä¸ºç©º, ä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                loHead = e; <span style="color:#007f7f">// åˆ™å°†loHeadèµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                loTail.<span style="color:#007f7f">next</span> = e;    <span style="color:#007f7f">// å¦åˆ™å°†èŠ‚ç‚¹æ·»åŠ åœ¨loTailåé¢</span>
</span></span><span style="display:flex;"><span>            loTail = e; <span style="color:#007f7f">// å¹¶å°†loTailèµ‹å€¼ä¸ºæ–°å¢çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 9.2 å¦‚æœeçš„hashå€¼ä¸è€è¡¨çš„å®¹é‡è¿›è¡Œä¸è¿ç®—ä¸ºé0,åˆ™æ‰©å®¹åçš„ç´¢å¼•ä½ç½®ä¸º:è€è¡¨çš„ç´¢å¼•ä½ç½®ï¼‹oldCap</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (hiTail == <span style="color:#fff;font-weight:bold">null</span>) <span style="color:#007f7f">// å¦‚æœhiTailä¸ºç©º, ä»£è¡¨è¯¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>                hiHead = e; <span style="color:#007f7f">// åˆ™å°†hiHeadèµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                hiTail.<span style="color:#007f7f">next</span> = e;    <span style="color:#007f7f">// å¦åˆ™å°†èŠ‚ç‚¹æ·»åŠ åœ¨hiTailåé¢</span>
</span></span><span style="display:flex;"><span>            hiTail = e; <span style="color:#007f7f">// å¹¶å°†hiTailèµ‹å€¼ä¸ºæ–°å¢çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">while</span> ((e = next) != <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 10.å¦‚æœloTailä¸ä¸ºç©ºï¼ˆè¯´æ˜è€è¡¨çš„æ•°æ®æœ‰åˆ†å¸ƒåˆ°æ–°è¡¨ä¸Šâ€œåŸç´¢å¼•ä½ç½®â€çš„èŠ‚ç‚¹ï¼‰ï¼Œåˆ™å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// çš„nextè®¾ä¸ºç©ºï¼Œå¹¶å°†æ–°è¡¨ä¸Šç´¢å¼•ä½ç½®ä¸ºâ€œåŸç´¢å¼•ä½ç½®â€çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå¯¹åº”çš„å¤´èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (loTail != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        loTail.<span style="color:#007f7f">next</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        newTab[j] = loHead;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 11.å¦‚æœhiTailä¸ä¸ºç©ºï¼ˆè¯´æ˜è€è¡¨çš„æ•°æ®æœ‰åˆ†å¸ƒåˆ°æ–°è¡¨ä¸Šâ€œåŸç´¢å¼•+oldCapä½ç½®â€çš„èŠ‚ç‚¹ï¼‰ï¼Œåˆ™å°†æœ€å</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä¸€ä¸ªèŠ‚ç‚¹çš„nextè®¾ä¸ºç©ºï¼Œå¹¶å°†æ–°è¡¨ä¸Šç´¢å¼•ä½ç½®ä¸ºâ€œåŸç´¢å¼•+oldCapâ€çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå¯¹åº”çš„å¤´èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (hiTail != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        hiTail.<span style="color:#007f7f">next</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        newTab[j + oldCap] = hiHead;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å‰æ</strong>ï¼šæˆ‘ä»¬å‡è®¾æœ‰3ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ Aï¼ŒèŠ‚ç‚¹ Bï¼ŒèŠ‚ç‚¹ Cï¼Œå¹¶ä¸”å‡è®¾ä»–ä»¬çš„ hash å€¼ç­‰äº key å€¼ï¼Œåˆ™æŒ‰ä¸Šå›¾æ‰©å®¹çš„è¿‡ç¨‹æ¨¡æ‹Ÿå¦‚ä¸‹ã€‚</p>
<p>å…ˆçœ‹ä¸‹è€è¡¨å’Œæ–°è¡¨è®¡ç®—ç´¢å¼•ä½ç½®çš„è¿‡ç¨‹ï¼šï¼ˆhash è®¡ç®—çœç•¥å‰é¢ 28 ä½ 0ï¼Œåªçœ‹æœ€å 4 ä½ï¼‰</p>
<p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/5.png"></p>
<h2 id="å…·ä½“æ‰©å®¹è¿‡ç¨‹">å…·ä½“æ‰©å®¹è¿‡ç¨‹ï¼š<a hidden class="anchor" aria-hidden="true" href="#å…·ä½“æ‰©å®¹è¿‡ç¨‹">#</a></h2>
<p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/6.png"></p>
<p>****ç»“æœï¼š****å¯ä»¥çœ‹å‡ºï¼Œæ‰©å®¹åï¼ŒèŠ‚ç‚¹ A å’ŒèŠ‚ç‚¹ C çš„å…ˆåé¡ºåºè·Ÿæ‰©å®¹å‰æ˜¯ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œå³ä½¿æ­¤æ—¶æœ‰å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰©å®¹ï¼Œä¹Ÿä¸ä¼šå‡ºç°æ­»å¾ªç¯çš„æƒ…å†µã€‚å½“ç„¶ï¼Œè¿™ä»ç„¶æ”¹å˜ä¸äº† HashMap ä»æ˜¯éå¹¶å‘å®‰å…¨ï¼Œåœ¨å¹¶å‘ä¸‹ï¼Œè¿˜æ˜¯è¦ä½¿ç”¨ ConcurrentHashMap æ¥ä»£æ›¿ã€‚</p>
<h1 id="hashmapå®ç°çš„cloneableæ¥å£">HashMapå®ç°çš„Cloneableæ¥å£<a hidden class="anchor" aria-hidden="true" href="#hashmapå®ç°çš„cloneableæ¥å£">#</a></h1>
<p>HashMapå®ç°äº†Cloneableæ¥å£ï¼Œå³å®ç°äº†clone()æ–¹æ³•ã€‚
clone()æ–¹æ³•çš„ä½œç”¨å¾ˆç®€å•ï¼Œå°±æ˜¯å…‹éš†ä¸€ä¸ªHashMapå¯¹è±¡å¹¶è¿”å›ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>public Object clone() {
</span></span><span style="display:flex;"><span>        HashMap&lt;K,V&gt; result;
</span></span><span style="display:flex;"><span>        try {
</span></span><span style="display:flex;"><span>            result = (HashMap&lt;K,V&gt;)super.clone();
</span></span><span style="display:flex;"><span>        } catch (CloneNotSupportedException e) {
</span></span><span style="display:flex;"><span>            // this shouldn&#39;t happen, since we are Cloneable
</span></span><span style="display:flex;"><span>            throw new InternalError(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        result.reinitialize();
</span></span><span style="display:flex;"><span>        result.putMapEntries(this, false);
</span></span><span style="display:flex;"><span>        return result;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="hashmapéå†æ–¹å¼">HashMapéå†æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#hashmapéå†æ–¹å¼">#</a></h1>
<h2 id="éå†é”®å€¼å¯¹">éå†é”®å€¼å¯¹<a hidden class="anchor" aria-hidden="true" href="#éå†é”®å€¼å¯¹">#</a></h2>
<ol>
<li>æ ¹æ®entrySet()è·å–HashMapçš„â€œé”®å€¼å¯¹â€çš„Seté›†åˆã€‚</li>
<li>é€šè¿‡Iteratorè¿­ä»£å™¨éå†â€œç¬¬ä¸€æ­¥â€å¾—åˆ°çš„é›†åˆã€‚</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// å‡è®¾mapæ˜¯HashMapå¯¹è±¡</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// mapä¸­çš„keyæ˜¯Stringç±»å‹ï¼Œvalueæ˜¯Integerç±»å‹</span>
</span></span><span style="display:flex;"><span>Integer integ = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>Iterator iter = map.<span style="color:#007f7f">entrySet</span>().<span style="color:#007f7f">iterator</span>();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">while</span>(iter.<span style="color:#007f7f">hasNext</span>()) {
</span></span><span style="display:flex;"><span>    Map.<span style="color:#007f7f">Entry</span> entry = (Map.<span style="color:#007f7f">Entry</span>)iter.<span style="color:#007f7f">next</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è·å–key</span>
</span></span><span style="display:flex;"><span>    key = (String)entry.<span style="color:#007f7f">getKey</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è·å–value</span>
</span></span><span style="display:flex;"><span>    integ = (Integer)entry.<span style="color:#007f7f">getValue</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="éå†é”®">éå†é”®<a hidden class="anchor" aria-hidden="true" href="#éå†é”®">#</a></h2>
<ol>
<li>æ ¹æ®keySet()è·å–HashMapçš„â€œé”®â€çš„Seté›†åˆã€‚</li>
<li>é€šè¿‡Iteratorè¿­ä»£å™¨éå†â€œç¬¬ä¸€æ­¥â€å¾—åˆ°çš„é›†åˆã€‚</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// å‡è®¾mapæ˜¯HashMapå¯¹è±¡</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// mapä¸­çš„keyæ˜¯Stringç±»å‹ï¼Œvalueæ˜¯Integerç±»å‹</span>
</span></span><span style="display:flex;"><span>String key = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>Integer integ = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>Iterator iter = map.<span style="color:#007f7f">keySet</span>().<span style="color:#007f7f">iterator</span>();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">while</span> (iter.<span style="color:#007f7f">hasNext</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–key</span>
</span></span><span style="display:flex;"><span>    key = (String)iter.<span style="color:#007f7f">next</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ ¹æ®keyï¼Œè·å–value</span>
</span></span><span style="display:flex;"><span>    integ = (Integer)map.<span style="color:#007f7f">get</span>(key);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="éå†å€¼">éå†å€¼<a hidden class="anchor" aria-hidden="true" href="#éå†å€¼">#</a></h2>
<ol>
<li>æ ¹æ®values()è·å–HashMapçš„â€œå€¼â€çš„é›†åˆã€‚</li>
<li>è¿‡Iteratorè¿­ä»£å™¨éå†â€œç¬¬ä¸€æ­¥â€å¾—åˆ°çš„é›†åˆã€‚</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// å‡è®¾mapæ˜¯HashMapå¯¹è±¡</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// mapä¸­çš„keyæ˜¯Stringç±»å‹ï¼Œvalueæ˜¯Integerç±»å‹</span>
</span></span><span style="display:flex;"><span>Integer value = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>Collection c = map.<span style="color:#007f7f">values</span>();
</span></span><span style="display:flex;"><span>Iterator iter= c.<span style="color:#007f7f">iterator</span>();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">while</span> (iter.<span style="color:#007f7f">hasNext</span>()) {
</span></span><span style="display:flex;"><span>    value = (Integer)iter.<span style="color:#007f7f">next</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="jdk18">JDK1.8<a hidden class="anchor" aria-hidden="true" href="#jdk18">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>map.forEach((k,v)-&gt;{
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="hashmapä»£ç ç¤ºä¾‹">HashMapä»£ç ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#hashmapä»£ç ç¤ºä¾‹">#</a></h1>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Map;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Random;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Iterator;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.HashMap;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.HashSet;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Map.Entry;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Collection;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HashMapTest {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        testHashMapAPIs();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> testHashMapAPIs() {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆå§‹åŒ–éšæœºç§å­</span>
</span></span><span style="display:flex;"><span>        Random r = <span style="color:#fff;font-weight:bold">new</span> Random();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ–°å»ºHashMap</span>
</span></span><span style="display:flex;"><span>        HashMap map = <span style="color:#fff;font-weight:bold">new</span> HashMap();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ·»åŠ æ“ä½œ</span>
</span></span><span style="display:flex;"><span>        map.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;one&#34;</span>, r.<span style="color:#007f7f">nextInt</span>(10));
</span></span><span style="display:flex;"><span>        map.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;two&#34;</span>, r.<span style="color:#007f7f">nextInt</span>(10));
</span></span><span style="display:flex;"><span>        map.<span style="color:#007f7f">put</span>(<span style="color:#0ff;font-weight:bold">&#34;three&#34;</span>, r.<span style="color:#007f7f">nextInt</span>(10));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ‰“å°å‡ºmap</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;map:&#34;</span>+map );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// é€šè¿‡Iteratoréå†key-value</span>
</span></span><span style="display:flex;"><span>        Iterator iter = map.<span style="color:#007f7f">entrySet</span>().<span style="color:#007f7f">iterator</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span>(iter.<span style="color:#007f7f">hasNext</span>()) {
</span></span><span style="display:flex;"><span>            Map.<span style="color:#007f7f">Entry</span> entry = (Map.<span style="color:#007f7f">Entry</span>)iter.<span style="color:#007f7f">next</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;next : &#34;</span>+ entry.<span style="color:#007f7f">getKey</span>() +<span style="color:#0ff;font-weight:bold">&#34; - &#34;</span>+entry.<span style="color:#007f7f">getValue</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// HashMapçš„é”®å€¼å¯¹ä¸ªæ•°        </span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;size:&#34;</span>+map.<span style="color:#007f7f">size</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// containsKey(Object key) :æ˜¯å¦åŒ…å«é”®key</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;contains key two : &#34;</span>+map.<span style="color:#007f7f">containsKey</span>(<span style="color:#0ff;font-weight:bold">&#34;two&#34;</span>));
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;contains key five : &#34;</span>+map.<span style="color:#007f7f">containsKey</span>(<span style="color:#0ff;font-weight:bold">&#34;five&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// containsValue(Object value) :æ˜¯å¦åŒ…å«å€¼value</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;contains value 0 : &#34;</span>+map.<span style="color:#007f7f">containsValue</span>(<span style="color:#fff;font-weight:bold">new</span> Integer(0)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// remove(Object key) ï¼š åˆ é™¤é”®keyå¯¹åº”çš„é”®å€¼å¯¹</span>
</span></span><span style="display:flex;"><span>        map.<span style="color:#007f7f">remove</span>(<span style="color:#0ff;font-weight:bold">&#34;three&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;map:&#34;</span>+map );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// clear() ï¼š æ¸…ç©ºHashMap</span>
</span></span><span style="display:flex;"><span>        map.<span style="color:#007f7f">clear</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// isEmpty() : HashMapæ˜¯å¦ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>((map.<span style="color:#007f7f">isEmpty</span>()?<span style="color:#0ff;font-weight:bold">&#34;map is empty&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;map is not empty&#34;</span>) );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤ï¼ŒHashMapå†…å®¹æ€»ç»“å®Œæ¯•ï¼Œæœ‰å¾…å®Œå–„ï¼Œå…¶ä¸­å¾ˆå¤šæºç éƒ½æ˜¯JDK1.6ç‰ˆæœ¬çš„ï¼ŒJava8çš„HashMapç›¸æ¯”ä¹‹å‰æœ‰è¾ƒå¤§çš„ä¼˜åŒ–ï¼Œ
å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªä¼˜åŒ–å°±æ˜¯æ¡¶ä¸­çš„å…ƒç´ ä¸å†å”¯ä¸€æŒ‰ç…§é“¾è¡¨ç»„åˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨çº¢é»‘æ ‘è¿›è¡Œå­˜å‚¨ï¼Œæ€»ä¹‹ï¼Œç›®æ ‡åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯åœ¨å®‰å…¨å’ŒåŠŸèƒ½æ€§å®Œå¤‡çš„æƒ…å†µä¸‹è®©å…¶é€Ÿåº¦æ›´å¿«ï¼Œæå‡æ€§èƒ½ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“">#</a></h1>
<ul>
<li>HashMap çš„åº•å±‚æ˜¯ä¸ª Node æ•°ç»„ï¼ˆNode&lt;K,V&gt;[] tableï¼‰ï¼Œåœ¨æ•°ç»„çš„å…·ä½“ç´¢å¼•ä½ç½®ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªèŠ‚ç‚¹ï¼Œåˆ™å¯èƒ½æ˜¯ä»¥é“¾è¡¨æˆ–çº¢é»‘æ ‘çš„å½¢å¼å­˜åœ¨ã€‚</li>
<li>å¢åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾é”®å€¼å¯¹æ—¶ï¼Œå®šä½åˆ°å“ˆå¸Œæ¡¶æ•°ç»„çš„ä½ç½®æ˜¯å¾ˆå…³é”®çš„ä¸€æ­¥ï¼Œæºç ä¸­æ˜¯é€šè¿‡ä¸‹é¢3ä¸ªæ“ä½œæ¥å®Œæˆè¿™ä¸€æ­¥ï¼š1ï¼‰æ‹¿åˆ° key çš„ hashCode å€¼ï¼›2ï¼‰å°† hashCode çš„é«˜ä½å‚ä¸è¿ç®—ï¼Œé‡æ–°è®¡ç®— hash å€¼ï¼›3ï¼‰å°†è®¡ç®—å‡ºæ¥çš„ hash å€¼ä¸ â€œtable.length - 1â€ è¿›è¡Œ &amp; è¿ç®—ã€‚</li>
<li>HashMap çš„é»˜è®¤åˆå§‹å®¹é‡ï¼ˆcapacityï¼‰æ˜¯ 16ï¼Œcapacity å¿…é¡»ä¸º 2 çš„å¹‚æ¬¡æ–¹ï¼›é»˜è®¤è´Ÿè½½å› å­ï¼ˆload factorï¼‰æ˜¯ 0.75ï¼›å®é™…èƒ½å­˜æ”¾çš„èŠ‚ç‚¹ä¸ªæ•°ï¼ˆthresholdï¼Œå³è§¦å‘æ‰©å®¹çš„é˜ˆå€¼ï¼‰= capacity * load factorã€‚</li>
<li>HashMap åœ¨è§¦å‘æ‰©å®¹åï¼Œé˜ˆå€¼ä¼šå˜ä¸ºåŸæ¥çš„ 2 å€ï¼Œå¹¶ä¸”ä¼šå¯¹æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œé‡ hash åˆ†å¸ƒï¼Œé‡ hash åˆ†å¸ƒåèŠ‚ç‚¹çš„æ–°åˆ†å¸ƒä½ç½®åªå¯èƒ½æœ‰ä¸¤ä¸ªï¼šâ€œåŸç´¢å¼•ä½ç½®â€ æˆ– â€œåŸç´¢å¼•+oldCapä½ç½®â€ã€‚ä¾‹å¦‚ capacity ä¸º16ï¼Œç´¢å¼•ä½ç½® 5 çš„èŠ‚ç‚¹æ‰©å®¹åï¼Œåªå¯èƒ½åˆ†å¸ƒåœ¨æ–°è¡¨ â€œç´¢å¼•ä½ç½®5â€ å’Œ â€œç´¢å¼•ä½ç½®21ï¼ˆ5+16ï¼‰â€ã€‚</li>
<li>å¯¼è‡´ HashMap æ‰©å®¹åï¼ŒåŒä¸€ä¸ªç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹é‡ hash æœ€å¤šåˆ†å¸ƒåœ¨ä¸¤ä¸ªä½ç½®çš„æ ¹æœ¬åŸå› æ˜¯ï¼š1ï¼‰tableçš„é•¿åº¦å§‹ç»ˆä¸º 2 çš„ n æ¬¡æ–¹ï¼›2ï¼‰ç´¢å¼•ä½ç½®çš„è®¡ç®—æ–¹æ³•ä¸º â€œ(table.length - 1) &amp; hashâ€ã€‚HashMap æ‰©å®¹æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œå®šä¹‰ HashMap æ—¶å°½é‡ç»™ä¸ªæ¥è¿‘çš„åˆå§‹å®¹é‡å€¼ã€‚</li>
<li>HashMap æœ‰ threshold å±æ€§å’Œ loadFactor å±æ€§ï¼Œä½†æ˜¯æ²¡æœ‰ capacity å±æ€§ã€‚åˆå§‹åŒ–æ—¶ï¼Œå¦‚æœä¼ äº†åˆå§‹åŒ–å®¹é‡å€¼ï¼Œè¯¥å€¼æ˜¯å­˜åœ¨ threshold å˜é‡ï¼Œå¹¶ä¸” Node æ•°ç»„æ˜¯åœ¨ç¬¬ä¸€æ¬¡ put æ—¶æ‰ä¼šè¿›è¡Œåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–æ—¶ä¼šå°†æ­¤æ—¶çš„ threshold å€¼ä½œä¸ºæ–°è¡¨çš„ capacity å€¼ï¼Œç„¶åç”¨ capacity å’Œ loadFactor è®¡ç®—æ–°è¡¨çš„çœŸæ­£ threshold å€¼ã€‚</li>
<li>å½“åŒä¸€ä¸ªç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹åœ¨å¢åŠ åè¾¾åˆ° 9 ä¸ªæ—¶ï¼Œå¹¶ä¸”æ­¤æ—¶æ•°ç»„çš„é•¿åº¦å¤§äºç­‰äº 64ï¼Œåˆ™ä¼šè§¦å‘é“¾è¡¨èŠ‚ç‚¹ï¼ˆNodeï¼‰è½¬çº¢é»‘æ ‘èŠ‚ç‚¹ï¼ˆTreeNodeï¼‰ï¼Œè½¬æˆçº¢é»‘æ ‘èŠ‚ç‚¹åï¼Œå…¶å®é“¾è¡¨çš„ç»“æ„è¿˜å­˜åœ¨ï¼Œé€šè¿‡ next å±æ€§ç»´æŒã€‚é“¾è¡¨èŠ‚ç‚¹è½¬çº¢é»‘æ ‘èŠ‚ç‚¹çš„å…·ä½“æ–¹æ³•ä¸ºæºç ä¸­çš„ treeifyBin æ–¹æ³•ã€‚è€Œå¦‚æœæ•°ç»„é•¿åº¦å°äº64ï¼Œåˆ™ä¸ä¼šè§¦å‘é“¾è¡¨è½¬çº¢é»‘æ ‘ï¼Œè€Œæ˜¯ä¼šè¿›è¡Œæ‰©å®¹ã€‚</li>
<li>å½“åŒä¸€ä¸ªç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹åœ¨ç§»é™¤åè¾¾åˆ° 6 ä¸ªæ—¶ï¼Œå¹¶ä¸”è¯¥ç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œä¼šè§¦å‘çº¢é»‘æ ‘èŠ‚ç‚¹è½¬é“¾è¡¨èŠ‚ç‚¹ã€‚çº¢é»‘æ ‘èŠ‚ç‚¹è½¬é“¾è¡¨èŠ‚ç‚¹çš„å…·ä½“æ–¹æ³•ä¸ºæºç ä¸­çš„ untreeify æ–¹æ³•ã€‚</li>
<li>HashMap åœ¨ JDK 1.8 ä¹‹åä¸å†æœ‰æ­»å¾ªç¯çš„é—®é¢˜ï¼ŒJDK 1.8 ä¹‹å‰å­˜åœ¨æ­»å¾ªç¯çš„æ ¹æœ¬åŸå› æ˜¯åœ¨æ‰©å®¹ååŒä¸€ç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹é¡ºåºä¼šåæ‰ã€‚</li>
<li>HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨ ConcurrentHashMap æ¥ä»£æ›¿ã€‚</li>
</ul>
<p><a href="https://blog.csdn.net/v123411739/article/details/78996181/">å‚è€ƒ</a></p>
<h1 id="concurrenthashmap">ConcurrentHashMap<a hidden class="anchor" aria-hidden="true" href="#concurrenthashmap">#</a></h1>
<h2 id="jdk17ä¸­çš„-concurrenthashmap">jdk1.7ä¸­çš„ ConcurrentHashMap<a hidden class="anchor" aria-hidden="true" href="#jdk17ä¸­çš„-concurrenthashmap">#</a></h2>
<p>é’ˆå¯¹<code>HashTable</code>ä¼šé”æ•´ä¸ªhashè¡¨çš„é—®é¢˜ï¼ŒConcurrentHashMapæå‡ºäº†åˆ†æ®µé”çš„è§£å†³æ–¹æ¡ˆã€‚
åˆ†æ®µé”çš„æ€æƒ³å°±æ˜¯ï¼šé”çš„æ—¶å€™ä¸é”æ•´ä¸ªhashè¡¨ï¼Œè€Œæ˜¯åªé”ä¸€éƒ¨åˆ†ã€‚
å¦‚ä½•å®ç°å‘¢ï¼Ÿè¿™å°±ç”¨åˆ°äº†ConcurrentHashMapä¸­æœ€å…³é”®çš„Segmentã€‚
ConcurrentHashMapä¸­ç»´æŠ¤ç€ä¸€ä¸ªSegmentæ•°ç»„ï¼Œæ¯ä¸ªSegmentå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªHashMapã€‚
è€ŒSegmentæœ¬èº«ç»§æ‰¿äº†ReentrantLockï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªé”ã€‚
åœ¨Segmentä¸­é€šè¿‡HashEntryæ•°ç»„æ¥ç»´æŠ¤å…¶å†…éƒ¨çš„hashè¡¨ã€‚
æ¯ä¸ªHashEntryå°±ä»£è¡¨äº†mapä¸­çš„ä¸€ä¸ªK-Vï¼Œç”¨HashEntryå¯ä»¥ç»„æˆä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œé€šè¿‡nextå­—æ®µå¼•ç”¨åˆ°å…¶ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
æ‰€ä»¥1.7ä¸­çš„ConcurrentHashMapå®šä½ä¸€ä¸ªå…ƒç´ çš„è¿‡ç¨‹éœ€è¦è¿›è¡Œä¸¤æ¬¡Hashæ“ä½œã€‚ç¬¬ä¸€æ¬¡Hashå®šä½åˆ°Segmentï¼Œç¬¬äºŒæ¬¡Hashå®šä½åˆ°å…ƒç´ æ‰€åœ¨çš„é“¾è¡¨çš„å¤´éƒ¨ã€‚</p>
<p>ä½¿ç”¨Segmentçš„åå¤„ï¼š
Hashçš„è¿‡ç¨‹è¦æ¯”æ™®é€šçš„HashMapè¦é•¿</p>
<p>å¥½å¤„ï¼š
å¯ä»¥åªå¯¹å…ƒç´ æ‰€åœ¨çš„Segmentè¿›è¡ŒåŠ é”å³å¯ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„Segmentã€‚
è¿™æ ·ï¼Œåœ¨æœ€ç†æƒ³çš„æƒ…å†µä¸‹ï¼ŒConcurrentHashMapå¯ä»¥æœ€é«˜åŒæ—¶æ”¯æŒSegmentæ•°é‡å¤§å°çš„å†™æ“ä½œã€‚</p>
<h2 id="jdk18ä¸­çš„-concurrenthashmap">jdk1.8ä¸­çš„ ConcurrentHashMap<a hidden class="anchor" aria-hidden="true" href="#jdk18ä¸­çš„-concurrenthashmap">#</a></h2>
<p>JDK8ä¸­ConcurrentHashMapå‚è€ƒäº†JDK8 HashMapçš„å®ç°ï¼Œé‡‡ç”¨äº†æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„å®ç°æ–¹å¼æ¥è®¾è®¡ï¼Œå†…éƒ¨å¤§é‡é‡‡ç”¨CASæ“ä½œï¼Œè¿™é‡Œç®€è¦ä»‹ç»ä¸‹CASã€‚</p>
<p>CASæ˜¯compare and swapçš„ç¼©å†™ï¼Œå³æˆ‘ä»¬æ‰€è¯´çš„æ¯”è¾ƒäº¤æ¢ã€‚casæ˜¯ä¸€ç§åŸºäºé”çš„æ“ä½œï¼Œè€Œä¸”æ˜¯ä¹è§‚é”ã€‚åœ¨javaä¸­é”åˆ†ä¸ºä¹è§‚é”å’Œæ‚²è§‚é”ã€‚æ‚²è§‚é”æ˜¯å°†èµ„æºé”ä½ï¼Œç­‰ä¸€ä¸ªä¹‹å‰è·å¾—é”çš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹æ‰å¯ä»¥è®¿é—®ã€‚è€Œä¹è§‚é”é‡‡å–äº†ä¸€ç§å®½æ³›çš„æ€åº¦ï¼Œé€šè¿‡æŸç§æ–¹å¼ä¸åŠ é”æ¥å¤„ç†èµ„æºï¼Œæ¯”å¦‚é€šè¿‡ç»™è®°å½•åŠ versionæ¥è·å–æ•°æ®ï¼Œæ€§èƒ½è¾ƒæ‚²è§‚é”æœ‰å¾ˆå¤§çš„æé«˜ã€‚</p>
<p>CAS æ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•° â€”â€” å†…å­˜ä½ç½®ï¼ˆVï¼‰ã€é¢„æœŸåŸå€¼ï¼ˆAï¼‰å’Œæ–°å€¼(B)ã€‚å¦‚æœå†…å­˜åœ°å€é‡Œé¢çš„å€¼å’ŒAçš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå°±å°†å†…å­˜é‡Œé¢çš„å€¼æ›´æ–°æˆBã€‚CASæ˜¯é€šè¿‡æ— é™å¾ªç¯æ¥è·å–æ•°æ®çš„ï¼Œå¦‚æœåœ¨ç¬¬ä¸€è½®å¾ªç¯ä¸­ï¼Œaçº¿ç¨‹è·å–åœ°å€é‡Œé¢çš„å€¼è¢«bçº¿ç¨‹ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆaçº¿ç¨‹éœ€è¦è‡ªæ—‹ï¼Œåˆ°ä¸‹æ¬¡å¾ªç¯æ‰æœ‰å¯èƒ½æœºä¼šæ‰§è¡Œã€‚
JDK8ä¸­å½»åº•æ”¾å¼ƒäº†Segmentè½¬è€Œé‡‡ç”¨çš„æ˜¯Nodeï¼Œå…¶è®¾è®¡æ€æƒ³ä¹Ÿä¸å†æ˜¯JDK1.7ä¸­çš„åˆ†æ®µé”æ€æƒ³ã€‚
Nodeï¼šä¿å­˜keyï¼ŒvalueåŠkeyçš„hashå€¼çš„æ•°æ®ç»“æ„ã€‚å…¶ä¸­valueå’Œnextéƒ½ç”¨volatileä¿®é¥°ï¼Œä¿è¯å¹¶å‘çš„å¯è§æ€§ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {
</span></span><span style="display:flex;"><span>    final int hash;
</span></span><span style="display:flex;"><span>    final K key;
</span></span><span style="display:flex;"><span>    volatile V val;
</span></span><span style="display:flex;"><span>    volatile Node&lt;K,V&gt; next;
</span></span><span style="display:flex;"><span>    //... çœç•¥éƒ¨åˆ†ä»£ç 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="é¢˜">é¢˜<a hidden class="anchor" aria-hidden="true" href="#é¢˜">#</a></h1>
<h2 id="hashmap-çš„åº•å±‚æ•°æ®ç»“æ„">HashMap çš„åº•å±‚æ•°æ®ç»“æ„<a hidden class="anchor" aria-hidden="true" href="#hashmap-çš„åº•å±‚æ•°æ®ç»“æ„">#</a></h2>
<p>JDK 1.8åº•å±‚æ˜¯ç”±â€œæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘â€ç»„æˆï¼Œè€Œåœ¨ JDK 1.8 ä¹‹å‰æ˜¯ç”±â€œæ•°ç»„+é“¾è¡¨â€ç»„æˆã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¦æ”¹æˆæ•°ç»„é“¾è¡¨çº¢é»‘æ ‘">ä¸ºä»€ä¹ˆè¦æ”¹æˆâ€œæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘â€ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#ä¸ºä»€ä¹ˆè¦æ”¹æˆæ•°ç»„é“¾è¡¨çº¢é»‘æ ‘">#</a></h2>
<p>ä¸»è¦æ˜¯ä¸ºäº†æå‡åœ¨ hash å†²çªä¸¥é‡æ—¶ï¼ˆé“¾è¡¨è¿‡é•¿ï¼‰çš„æŸ¥æ‰¾æ€§èƒ½ï¼Œä½¿ç”¨é“¾è¡¨çš„æŸ¥æ‰¾æ€§èƒ½æ˜¯ O(n)ï¼Œè€Œä½¿ç”¨çº¢é»‘æ ‘æ˜¯ O(logn)ã€‚</p>
<h2 id="é‚£åœ¨ä»€ä¹ˆæ—¶å€™ç”¨é“¾è¡¨ä»€ä¹ˆæ—¶å€™ç”¨çº¢é»‘æ ‘">é‚£åœ¨ä»€ä¹ˆæ—¶å€™ç”¨é“¾è¡¨ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨çº¢é»‘æ ‘ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#é‚£åœ¨ä»€ä¹ˆæ—¶å€™ç”¨é“¾è¡¨ä»€ä¹ˆæ—¶å€™ç”¨çº¢é»‘æ ‘">#</a></h2>
<p>å¯¹äºæ’å…¥ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä½¿ç”¨é“¾è¡¨èŠ‚ç‚¹ã€‚å½“åŒä¸€ä¸ªç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹åœ¨æ–°å¢åè¾¾åˆ°9ä¸ªï¼ˆé˜ˆå€¼8ï¼‰ï¼šå¦‚æœæ­¤æ—¶æ•°ç»„é•¿åº¦å¤§äºç­‰äº 64ï¼Œåˆ™ä¼šè§¦å‘é“¾è¡¨èŠ‚ç‚¹è½¬çº¢é»‘æ ‘èŠ‚ç‚¹ï¼ˆtreeifyBinï¼‰ï¼›è€Œå¦‚æœæ•°ç»„é•¿åº¦å°äº64ï¼Œåˆ™ä¸ä¼šè§¦å‘é“¾è¡¨è½¬çº¢é»‘æ ‘ï¼Œè€Œæ˜¯ä¼šè¿›è¡Œæ‰©å®¹ï¼Œå› ä¸ºæ­¤æ—¶çš„æ•°æ®é‡è¿˜æ¯”è¾ƒå°ã€‚</p>
<p>å¯¹äºç§»é™¤ï¼Œå½“åŒä¸€ä¸ªç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹åœ¨ç§»é™¤åè¾¾åˆ° 6 ä¸ªï¼Œå¹¶ä¸”è¯¥ç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œä¼šè§¦å‘çº¢é»‘æ ‘èŠ‚ç‚¹è½¬é“¾è¡¨èŠ‚ç‚¹ï¼ˆuntreeifyï¼‰ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆé“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼æ˜¯8">ä¸ºä»€ä¹ˆé“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼æ˜¯8ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#ä¸ºä»€ä¹ˆé“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼æ˜¯8">#</a></h2>
<p>æˆ‘ä»¬å¹³æ—¶åœ¨è¿›è¡Œæ–¹æ¡ˆè®¾è®¡æ—¶ï¼Œå¿…é¡»è€ƒè™‘çš„ä¸¤ä¸ªå¾ˆé‡è¦çš„å› ç´ æ˜¯ï¼šæ—¶é—´å’Œç©ºé—´ã€‚å¯¹äº HashMap ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œç®€å•æ¥è¯´ï¼Œé˜ˆå€¼ä¸º8æ˜¯åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šæƒè¡¡çš„ç»“æœã€‚çº¢é»‘æ ‘èŠ‚ç‚¹å¤§å°çº¦ä¸ºé“¾è¡¨èŠ‚ç‚¹çš„2å€ï¼Œåœ¨èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œçº¢é»‘æ ‘çš„æŸ¥æ‰¾æ€§èƒ½ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ï¼Œä»˜å‡º2å€ç©ºé—´çš„ä»£ä»·ä½œè€…è§‰å¾—ä¸å€¼å¾—ã€‚</p>
<p>ç†æƒ³æƒ…å†µä¸‹ï¼Œä½¿ç”¨éšæœºçš„å“ˆå¸Œç ï¼ŒèŠ‚ç‚¹åˆ†å¸ƒåœ¨ hash æ¡¶ä¸­çš„é¢‘ç‡éµå¾ªæ³Šæ¾åˆ†å¸ƒï¼ŒæŒ‰ç…§æ³Šæ¾åˆ†å¸ƒçš„å…¬å¼è®¡ç®—ï¼Œé“¾è¡¨ä¸­èŠ‚ç‚¹ä¸ªæ•°ä¸º8æ—¶çš„æ¦‚ç‡ä¸º 0.00000006ï¼Œè¿™ä¸ªæ¦‚ç‡è¶³å¤Ÿä½äº†ï¼Œå¹¶ä¸”åˆ°8ä¸ªèŠ‚ç‚¹æ—¶ï¼Œçº¢é»‘æ ‘çš„æ€§èƒ½ä¼˜åŠ¿ä¹Ÿä¼šå¼€å§‹å±•ç°å‡ºæ¥ï¼Œå› æ­¤8æ˜¯ä¸€ä¸ªè¾ƒåˆç†çš„æ•°å­—ã€‚</p>
<h2 id="é‚£ä¸ºä»€ä¹ˆè½¬å›é“¾è¡¨èŠ‚ç‚¹æ˜¯ç”¨çš„6è€Œä¸æ˜¯å¤ç”¨8">é‚£ä¸ºä»€ä¹ˆè½¬å›é“¾è¡¨èŠ‚ç‚¹æ˜¯ç”¨çš„6è€Œä¸æ˜¯å¤ç”¨8ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#é‚£ä¸ºä»€ä¹ˆè½¬å›é“¾è¡¨èŠ‚ç‚¹æ˜¯ç”¨çš„6è€Œä¸æ˜¯å¤ç”¨8">#</a></h2>
<p>å¦‚æœæˆ‘ä»¬è®¾ç½®èŠ‚ç‚¹å¤šäº8ä¸ªè½¬çº¢é»‘æ ‘ï¼Œå°‘äº8ä¸ªå°±é©¬ä¸Šè½¬é“¾è¡¨ï¼Œå½“èŠ‚ç‚¹ä¸ªæ•°åœ¨8å¾˜å¾Šæ—¶ï¼Œå°±ä¼šé¢‘ç¹è¿›è¡Œçº¢é»‘æ ‘å’Œé“¾è¡¨çš„è½¬æ¢ï¼Œé€ æˆæ€§èƒ½çš„æŸè€—ã€‚</p>
<h2 id="é‚£-hashmap-æœ‰å“ªäº›é‡è¦å±æ€§åˆ†åˆ«ç”¨äºåšä»€ä¹ˆçš„">é‚£ HashMap æœ‰å“ªäº›é‡è¦å±æ€§ï¼Ÿåˆ†åˆ«ç”¨äºåšä»€ä¹ˆçš„ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#é‚£-hashmap-æœ‰å“ªäº›é‡è¦å±æ€§åˆ†åˆ«ç”¨äºåšä»€ä¹ˆçš„">#</a></h2>
<p>é™¤äº†ç”¨æ¥å­˜å‚¨æˆ‘ä»¬çš„èŠ‚ç‚¹ table æ•°ç»„å¤–ï¼ŒHashMap è¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªé‡è¦å±æ€§ï¼š</p>
<p>1ï¼‰sizeï¼šHashMap å·²ç»å­˜å‚¨çš„èŠ‚ç‚¹ä¸ªæ•°ï¼›
2ï¼‰thresholdï¼šæ‰©å®¹é˜ˆå€¼ï¼Œå½“ HashMap çš„ä¸ªæ•°è¾¾åˆ°è¯¥å€¼ï¼Œè§¦å‘æ‰©å®¹ã€‚
3ï¼‰loadFactorï¼šè´Ÿè½½å› å­ï¼Œæ‰©å®¹é˜ˆå€¼ = å®¹é‡ * è´Ÿè½½å› å­ã€‚</p>
<h2 id="threshold-é™¤äº†ç”¨äºå­˜æ”¾æ‰©å®¹é˜ˆå€¼è¿˜æœ‰å…¶ä»–ä½œç”¨å—">threshold é™¤äº†ç”¨äºå­˜æ”¾æ‰©å®¹é˜ˆå€¼è¿˜æœ‰å…¶ä»–ä½œç”¨å—ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#threshold-é™¤äº†ç”¨äºå­˜æ”¾æ‰©å®¹é˜ˆå€¼è¿˜æœ‰å…¶ä»–ä½œç”¨å—">#</a></h2>
<p>åœ¨æˆ‘ä»¬æ–°å»º HashMap å¯¹è±¡æ—¶ï¼Œ threshold è¿˜ä¼šè¢«ç”¨æ¥å­˜åˆå§‹åŒ–æ—¶çš„å®¹é‡ã€‚HashMap ç›´åˆ°æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ’å…¥èŠ‚ç‚¹æ—¶ï¼Œæ‰ä¼šå¯¹ table è¿›è¡Œåˆå§‹åŒ–ï¼Œé¿å…ä¸å¿…è¦çš„ç©ºé—´æµªè´¹ã€‚</p>
<h2 id="hashmap-çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯å¤šå°‘hashmap-çš„å®¹é‡æœ‰ä»€ä¹ˆé™åˆ¶å—">HashMap çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯å¤šå°‘ï¼ŸHashMap çš„å®¹é‡æœ‰ä»€ä¹ˆé™åˆ¶å—ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#hashmap-çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯å¤šå°‘hashmap-çš„å®¹é‡æœ‰ä»€ä¹ˆé™åˆ¶å—">#</a></h2>
<p>é»˜è®¤åˆå§‹å®¹é‡æ˜¯16ã€‚HashMap çš„å®¹é‡å¿…é¡»æ˜¯2çš„Næ¬¡æ–¹ï¼ŒHashMap ä¼šæ ¹æ®æˆ‘ä»¬ä¼ å…¥çš„å®¹é‡è®¡ç®—ä¸€ä¸ªå¤§äºç­‰äºè¯¥å®¹é‡çš„æœ€å°çš„2çš„Næ¬¡æ–¹ï¼Œä¾‹å¦‚ä¼  9ï¼Œå®¹é‡ä¸º16ã€‚</p>
<h2 id="ä½ è¯´-hashmap-çš„å®¹é‡å¿…é¡»æ˜¯-2-çš„-n-æ¬¡æ–¹è¿™æ˜¯ä¸ºä»€ä¹ˆ">ä½ è¯´ HashMap çš„å®¹é‡å¿…é¡»æ˜¯ 2 çš„ N æ¬¡æ–¹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#ä½ è¯´-hashmap-çš„å®¹é‡å¿…é¡»æ˜¯-2-çš„-n-æ¬¡æ–¹è¿™æ˜¯ä¸ºä»€ä¹ˆ">#</a></h2>
<p>è®¡ç®—ç´¢å¼•ä½ç½®çš„å…¬å¼ä¸ºï¼š(n - 1) &amp; hashï¼Œå½“ n ä¸º 2 çš„ N æ¬¡æ–¹æ—¶ï¼Œn - 1 ä¸ºä½ä½å…¨æ˜¯ 1 çš„å€¼ï¼Œæ­¤æ—¶ä»»ä½•å€¼è·Ÿ n - 1 è¿›è¡Œ &amp; è¿ç®—çš„ç»“æœä¸ºè¯¥å€¼çš„ä½ N ä½ï¼Œè¾¾åˆ°äº†å’Œå–æ¨¡åŒæ ·çš„æ•ˆæœï¼Œå®ç°äº†å‡åŒ€åˆ†å¸ƒã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªè®¾è®¡å°±æ˜¯åŸºäºå…¬å¼ï¼šx mod 2^n = x &amp; (2^n - 1)ï¼Œå› ä¸º &amp; è¿ç®—æ¯” mod å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚</p>
<h2 id="hashmap-çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯-16ä¸ºä»€ä¹ˆæ˜¯16è€Œä¸æ˜¯å…¶ä»–çš„">HashMap çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯ 16ï¼Œä¸ºä»€ä¹ˆæ˜¯16è€Œä¸æ˜¯å…¶ä»–çš„ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#hashmap-çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯-16ä¸ºä»€ä¹ˆæ˜¯16è€Œä¸æ˜¯å…¶ä»–çš„">#</a></h2>
<p>16æ˜¯2çš„Næ¬¡æ–¹ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªè¾ƒåˆç†çš„å¤§å°ã€‚å¦‚æœç”¨8æˆ–32ï¼Œæˆ‘è§‰å¾—ä¹Ÿæ˜¯OKçš„ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨æ–°å»º HashMap æ—¶ï¼Œæœ€å¥½æ˜¯æ ¹æ®è‡ªå·±ä½¿ç”¨æƒ…å†µè®¾ç½®åˆå§‹å®¹é‡ï¼Œè¿™æ‰æ˜¯æœ€åˆç†çš„æ–¹æ¡ˆã€‚</p>
<h2 id="hashmap-çš„è´Ÿè½½å› å­é»˜è®¤åˆå§‹å€¼åˆæ˜¯å¤šå°‘ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªæ•°">HashMap çš„è´Ÿè½½å› å­é»˜è®¤åˆå§‹å€¼åˆæ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªæ•°ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#hashmap-çš„è´Ÿè½½å› å­é»˜è®¤åˆå§‹å€¼åˆæ˜¯å¤šå°‘ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªæ•°">#</a></h2>
<p>è´Ÿè½½å› å­é»˜è®¤å€¼æ˜¯0.75ã€‚è¿™ä¸ªä¹Ÿæ˜¯åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šæƒè¡¡çš„ç»“æœã€‚å¦‚æœå€¼è¾ƒé«˜ï¼Œä¾‹å¦‚1ï¼Œæ­¤æ—¶ä¼šå‡å°‘ç©ºé—´å¼€é”€ï¼Œä½†æ˜¯ hash å†²çªçš„æ¦‚ç‡ä¼šå¢å¤§ï¼Œå¢åŠ æŸ¥æ‰¾æˆæœ¬ï¼›è€Œå¦‚æœå€¼è¾ƒä½ï¼Œä¾‹å¦‚ 0.5 ï¼Œæ­¤æ—¶ hash å†²çªä¼šé™ä½ï¼Œä½†æ˜¯æœ‰ä¸€åŠçš„ç©ºé—´ä¼šè¢«æµªè´¹ï¼Œæ‰€ä»¥æŠ˜è¡·è€ƒè™‘ 0.75 ä¼¼ä¹æ˜¯ä¸€ä¸ªåˆç†çš„å€¼ã€‚</p>
<h2 id="hashmap-çš„æ’å…¥æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„">HashMap çš„æ’å…¥æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#hashmap-çš„æ’å…¥æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„">#</a></h2>
<p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/7.png"></p>
<h2 id="ä»‹ç»æ‰©å®¹resizeçš„æµç¨‹">ä»‹ç»æ‰©å®¹ï¼ˆresizeï¼‰çš„æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#ä»‹ç»æ‰©å®¹resizeçš„æµç¨‹">#</a></h2>
<p><img loading="lazy" src="/posts/java%E9%9B%86%E5%90%88/hashmap/8.png"></p>
<h2 id="hashmap-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—">HashMap æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#hashmap-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—">#</a></h2>
<p>ä¸æ˜¯ã€‚HashMap åœ¨å¹¶å‘ä¸‹å­˜åœ¨æ•°æ®è¦†ç›–ã€éå†çš„åŒæ—¶è¿›è¡Œä¿®æ”¹ä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸ç­‰é—®é¢˜ï¼ŒJDK 1.8 ä¹‹å‰è¿˜å­˜åœ¨æ­»å¾ªç¯é—®é¢˜ã€‚</p>
<h2 id="ä»‹ç»ä¸€ä¸‹æ­»å¾ªç¯é—®é¢˜">ä»‹ç»ä¸€ä¸‹æ­»å¾ªç¯é—®é¢˜ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#ä»‹ç»ä¸€ä¸‹æ­»å¾ªç¯é—®é¢˜">#</a></h2>
<p>å¯¼è‡´æ­»å¾ªç¯çš„æ ¹æœ¬åŸå› æ˜¯ JDK 1.7 æ‰©å®¹é‡‡ç”¨çš„æ˜¯â€œå¤´æ’æ³•â€ï¼Œä¼šå¯¼è‡´åŒä¸€ç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹åœ¨æ‰©å®¹åé¡ºåºåæ‰ã€‚è€Œ JDK 1.8 ä¹‹åé‡‡ç”¨çš„æ˜¯â€œå°¾æ’æ³•â€ï¼Œæ‰©å®¹åèŠ‚ç‚¹é¡ºåºä¸ä¼šåæ‰ï¼Œä¸å­˜åœ¨æ­»å¾ªç¯é—®é¢˜ã€‚</p>
<h2 id="jdk-18-å¯¹-hashmap-ä¸»è¦è¿›è¡Œäº†å“ªäº›ä¼˜åŒ–">JDK 1.8 å¯¹ HashMap ä¸»è¦è¿›è¡Œäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#jdk-18-å¯¹-hashmap-ä¸»è¦è¿›è¡Œäº†å“ªäº›ä¼˜åŒ–">#</a></h2>
<ul>
<li>åº•å±‚æ•°æ®ç»“æ„ä»â€œæ•°ç»„+é“¾è¡¨â€æ”¹æˆâ€œæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘â€ï¼Œä¸»è¦æ˜¯ä¼˜åŒ–äº† hash å†²çªè¾ƒä¸¥é‡æ—¶ï¼Œé“¾è¡¨è¿‡é•¿çš„æŸ¥æ‰¾æ€§èƒ½ï¼šO(n) -&gt; O(logn)ã€‚</li>
<li>è®¡ç®— table åˆå§‹å®¹é‡çš„æ–¹å¼å‘ç”Ÿäº†æ”¹å˜ï¼Œè€çš„æ–¹å¼æ˜¯ä»1å¼€å§‹ä¸æ–­å‘å·¦è¿›è¡Œç§»ä½è¿ç®—ï¼Œç›´åˆ°æ‰¾åˆ°å¤§äºç­‰äºå…¥å‚å®¹é‡çš„å€¼ï¼›æ–°çš„æ–¹å¼åˆ™æ˜¯é€šè¿‡â€œ5ä¸ªç§»ä½+æˆ–ç­‰äºè¿ç®—â€æ¥è®¡ç®—ã€‚</li>
<li>ä¼˜åŒ–äº† hash å€¼çš„è®¡ç®—æ–¹å¼ï¼Œè€çš„é€šè¿‡ä¸€é¡¿çJBæ“ä½œï¼Œæ–°çš„åªæ˜¯ç®€å•çš„è®©é«˜16ä½å‚ä¸äº†è¿ç®—ã€‚</li>
<li>æ‰©å®¹æ—¶æ’å…¥æ–¹å¼ä»â€œå¤´æ’æ³•â€æ”¹æˆâ€œå°¾æ’æ³•â€ï¼Œé¿å…äº†å¹¶å‘ä¸‹çš„æ­»å¾ªç¯ã€‚</li>
<li>æ‰©å®¹æ—¶è®¡ç®—èŠ‚ç‚¹åœ¨æ–°è¡¨çš„ç´¢å¼•ä½ç½®æ–¹å¼ä»â€œh &amp; (length-1)â€æ”¹æˆâ€œhash &amp; oldCapâ€ï¼Œæ€§èƒ½å¯èƒ½æå‡ä¸å¤§ï¼Œä½†è®¾è®¡æ›´å·§å¦™ã€æ›´ä¼˜é›…ã€‚</li>
</ul>
<h2 id="ä»‹ç»ä¸‹-concurrenhashmapè¦è®²å‡º-17-å’Œ-18-çš„åŒºåˆ«">ä»‹ç»ä¸‹ ConcurrenHashMapï¼Œè¦è®²å‡º 1.7 å’Œ 1.8 çš„åŒºåˆ«ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#ä»‹ç»ä¸‹-concurrenhashmapè¦è®²å‡º-17-å’Œ-18-çš„åŒºåˆ«">#</a></h2>
<p>ConcurrentHashMap æ˜¯ HashMap çš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ï¼Œå’Œ HashMap ä¸€æ ·ï¼Œåœ¨JDK 1.8 ä¸­è¿›è¡Œäº†è¾ƒå¤§çš„ä¼˜åŒ–ã€‚
JDK1.7ï¼šåº•å±‚ç»“æ„ä¸ºï¼šåˆ†æ®µçš„æ•°ç»„+é“¾è¡¨ï¼›å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ï¼šåˆ†æ®µé”ï¼ˆSegmentï¼Œç»§æ‰¿äº†ReentrantLockï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
JDK1.8ï¼šåº•å±‚ç»“æ„ä¸ºï¼šæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼›å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ï¼šCAS + Synchronized</p>
<p>åŒºåˆ«ï¼š</p>
<ul>
<li>JDK1.8 ä¸­é™ä½é”çš„ç²’åº¦ã€‚JDK1.7 ç‰ˆæœ¬é”çš„ç²’åº¦æ˜¯åŸºäº Segment çš„ï¼ŒåŒ…å«å¤šä¸ªèŠ‚ç‚¹ï¼ˆHashEntryï¼‰ï¼Œè€Œ JDK1.8 é”çš„ç²’åº¦å°±æ˜¯å•èŠ‚ç‚¹ï¼ˆNodeï¼‰ã€‚</li>
<li>JDK1.8 ç‰ˆæœ¬çš„æ•°æ®ç»“æ„å˜å¾—æ›´åŠ ç®€å•ï¼Œä½¿å¾—æ“ä½œä¹Ÿæ›´åŠ æ¸…æ™°æµç•…ï¼Œå› ä¸ºå·²ç»ä½¿ç”¨ synchronized æ¥è¿›è¡ŒåŒæ­¥ï¼Œæ‰€ä»¥ä¸éœ€è¦åˆ†æ®µé”çš„æ¦‚å¿µï¼Œä¹Ÿå°±ä¸éœ€è¦ Segment è¿™ç§æ•°æ®ç»“æ„äº†ï¼Œå½“å‰è¿˜ä¿ç•™ä»…ä¸ºäº†å…¼å®¹ã€‚</li>
<li>JDK1.8 ä½¿ç”¨çº¢é»‘æ ‘æ¥ä¼˜åŒ–é“¾è¡¨ï¼Œè·Ÿ HashMap ä¸€æ ·ï¼Œä¼˜åŒ–äº†æç«¯æƒ…å†µä¸‹ï¼Œé“¾è¡¨è¿‡é•¿å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚</li>
<li>JDK1.8 ä½¿ç”¨å†…ç½®é” synchronized æ¥ä»£æ›¿é‡å…¥é” ReentrantLockï¼Œsynchronized æ˜¯å®˜æ–¹ä¸€ç›´åœ¨ä¸æ–­ä¼˜åŒ–çš„ï¼Œç°åœ¨æ€§èƒ½å·²ç»æ¯”è¾ƒå¯è§‚ï¼Œä¹Ÿæ˜¯å®˜æ–¹æ¨èä½¿ç”¨çš„åŠ é”æ–¹å¼ã€‚</li>
</ul>
<h2 id="concurrenthashmap-çš„å¹¶å‘æ‰©å®¹">ConcurrentHashMap çš„å¹¶å‘æ‰©å®¹<a hidden class="anchor" aria-hidden="true" href="#concurrenthashmap-çš„å¹¶å‘æ‰©å®¹">#</a></h2>
<p>ConcurrentHashMap åœ¨æ‰©å®¹æ—¶ä¼šè®¡ç®—å‡ºä¸€ä¸ªæ­¥é•¿ï¼ˆstrideï¼‰ï¼Œæœ€å°å€¼æ˜¯16ï¼Œç„¶åç»™å½“å‰æ‰©å®¹çº¿ç¨‹åˆ†é…â€œä¸€ä¸ªæ­¥é•¿â€çš„èŠ‚ç‚¹æ•°ï¼Œä¾‹å¦‚16ä¸ªï¼Œè®©è¯¥çº¿ç¨‹å»å¯¹è¿™16ä¸ªèŠ‚ç‚¹è¿›è¡Œæ‰©å®¹æ“ä½œï¼ˆå°†èŠ‚ç‚¹ä»è€è¡¨ç§»åŠ¨åˆ°æ–°è¡¨ï¼‰ã€‚</p>
<p>å¦‚æœåœ¨æ‰©å®¹ç»“æŸå‰åˆæ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™ä¹Ÿä¼šç»™è¯¥çº¿ç¨‹åˆ†é…ä¸€ä¸ªæ­¥é•¿çš„èŠ‚ç‚¹æ•°è®©è¯¥çº¿ç¨‹å»æ‰©å®¹ã€‚ä¾æ¬¡ç±»æ¨ï¼Œä»¥è¾¾åˆ°å¤šçº¿ç¨‹å¹¶å‘æ‰©å®¹çš„æ•ˆæœã€‚</p>
<p>ä¾‹å¦‚ï¼š64è¦æ‰©å®¹åˆ°128ï¼Œæ­¥é•¿ä¸º16ï¼Œåˆ™ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¼šè´Ÿè´£ç¬¬113ï¼ˆç´¢å¼•112ï¼‰~128ï¼ˆç´¢å¼•127ï¼‰çš„èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹ä¼šè´Ÿè´£ç¬¬97ï¼ˆç´¢å¼•96ï¼‰~112ï¼ˆç´¢å¼•111ï¼‰çš„èŠ‚ç‚¹ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p>
<p>å…·ä½“å¤„ç†ï¼ˆè¯¥æµç¨‹åç»­å¯èƒ½ä¼šæ›¿æ¢æˆæµç¨‹å›¾ï¼‰ï¼š</p>
<p>1ï¼‰å¦‚æœç´¢å¼•ä½ç½®ä¸Šä¸ºnullï¼Œåˆ™ç›´æ¥ä½¿ç”¨ CAS å°†ç´¢å¼•ä½ç½®èµ‹å€¼ä¸º ForwardingNodeï¼ˆhashå€¼ä¸º-1ï¼‰ï¼Œè¡¨ç¤ºå·²ç»å¤„ç†è¿‡ï¼Œè¿™ä¸ªä¹Ÿæ˜¯è§¦å‘å¹¶å‘æ‰©å®¹çš„å…³é”®ç‚¹ã€‚</p>
<p>2ï¼‰å¦‚æœç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹ f çš„ hash å€¼ä¸º MOVEDï¼ˆ-1ï¼‰ï¼Œåˆ™ä»£è¡¨èŠ‚ç‚¹ f æ˜¯ ForwardingNode èŠ‚ç‚¹ï¼Œåªæœ‰ ForwardingNode çš„ hash å€¼ä¸º -1ï¼Œæ„å‘³ç€è¯¥èŠ‚ç‚¹å·²ç»å¤„ç†è¿‡äº†ï¼Œåˆ™è·³è¿‡è¯¥èŠ‚ç‚¹ç»§ç»­å¾€ä¸‹å¤„ç†ã€‚</p>
<p>3ï¼‰.å¦åˆ™ï¼Œå¯¹ç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹ f å¯¹è±¡ä½¿ç”¨ synchronized è¿›è¡ŒåŠ é”ï¼Œéå†é“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼Œå¦‚æœæ‰¾åˆ° key å’Œå…¥å‚ç›¸åŒçš„ï¼Œåˆ™æ›¿æ¢æ‰ value å€¼ï¼›å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœæ˜¯é“¾è¡¨ï¼ŒåŒæ—¶åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬çº¢é»‘æ ‘ã€‚å¤„ç†å®Œåœ¨ç´¢å¼•ä½ç½®çš„èŠ‚ç‚¹åï¼Œä¼šå°†è¯¥ç´¢å¼•ä½ç½®èµ‹å€¼ä¸º ForwardingNodeï¼Œè¡¨ç¤ºè¯¥ä½ç½®å·²ç»å¤„ç†è¿‡ã€‚</p>
<p>ForwardingNodeï¼šä¸€ä¸ªç‰¹æ®Šçš„ Node èŠ‚ç‚¹ï¼Œhash å€¼ä¸º-1ï¼ˆæºç ä¸­å®šä¹‰æˆ MOVEDï¼‰ï¼Œå…¶ä¸­å­˜å‚¨ nextTable çš„å¼•ç”¨ã€‚ åªæœ‰å‘ç”Ÿæ‰©å®¹çš„æ—¶å€™ï¼ŒForwardingNodeæ‰ä¼šå‘æŒ¥ä½œç”¨ï¼Œä½œä¸ºä¸€ä¸ªå ä½ç¬¦æ”¾åœ¨ table ä¸­è¡¨ç¤ºå½“å‰èŠ‚ç‚¹å·²ç»è¢«å¤„ç†ï¼ˆæˆ–åˆ™ä¸º null ï¼‰ã€‚</p>
<h2 id="hashset-æ˜¯å¦‚ä½•ä¿è¯ä¸é‡å¤çš„">HashSet æ˜¯å¦‚ä½•ä¿è¯ä¸é‡å¤çš„ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#hashset-æ˜¯å¦‚ä½•ä¿è¯ä¸é‡å¤çš„">#</a></h2>
<p>HashSet åº•å±‚ä½¿ç”¨ HashMap æ¥å®ç°ï¼Œè§ä¸‹é¢çš„æºç ï¼Œå…ƒç´ æ”¾åœ¨ HashMap çš„ key é‡Œï¼Œvalue ä¸ºå›ºå®šçš„ Object å¯¹è±¡ã€‚å½“ add æ—¶è°ƒç”¨ HashMap çš„ put æ–¹æ³•ï¼Œå¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› null è¡¨ç¤º add æˆåŠŸï¼Œå¦åˆ™ add å¤±è´¥ã€‚
ç”±äº HashMap çš„ Key å€¼æœ¬èº«å°±ä¸å…è®¸é‡å¤ï¼ŒHashSet æ­£å¥½åˆ©ç”¨ HashMap ä¸­ key ä¸é‡å¤çš„ç‰¹æ€§æ¥æ ¡éªŒé‡å¤å…ƒç´ ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">transient</span> HashMap&lt;E,Object&gt; map;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Dummy value to associate with an Object in the backing Map</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> Object PRESENT = <span style="color:#fff;font-weight:bold">new</span> Object();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> add(E e) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> map.<span style="color:#007f7f">put</span>(e, PRESENT)==<span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="arraylist-å’Œ-linkedlist-çš„åŒºåˆ«">ArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#arraylist-å’Œ-linkedlist-çš„åŒºåˆ«">#</a></h2>
<ul>
<li>
<p>ArrayList åº•å±‚åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼ŒLinkedList åº•å±‚åŸºäºåŒå‘é“¾è¡¨å®ç°ã€‚</p>
</li>
<li>
<p>å¯¹äºéšæœºè®¿é—®ï¼ˆæŒ‰ index è®¿é—®ï¼Œget/setæ–¹æ³•ï¼‰ï¼šArrayList é€šè¿‡ index ç›´æ¥å®šä½åˆ°æ•°ç»„å¯¹åº”ä½ç½®çš„èŠ‚ç‚¹ï¼Œè€Œ LinkedListéœ€è¦ä»å¤´ç»“ç‚¹æˆ–å°¾èŠ‚ç‚¹å¼€å§‹éå†ï¼Œç›´åˆ°å¯»æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œå› æ­¤åœ¨æ•ˆç‡ä¸Š ArrayList ä¼˜äº LinkedListã€‚</p>
</li>
<li>
<p>å¯¹äºéšæœºæ’å…¥å’Œåˆ é™¤ï¼šArrayList éœ€è¦ç§»åŠ¨ç›®æ ‡èŠ‚ç‚¹åé¢çš„èŠ‚ç‚¹ï¼ˆä½¿ç”¨System.arraycopy æ–¹æ³•ç§»åŠ¨èŠ‚ç‚¹ï¼‰ï¼Œè€Œ LinkedList åªéœ€ä¿®æ”¹ç›®æ ‡èŠ‚ç‚¹å‰åèŠ‚ç‚¹çš„ next æˆ– prev å±æ€§å³å¯ï¼Œå› æ­¤åœ¨æ•ˆç‡ä¸Š LinkedList ä¼˜äº ArrayListã€‚</p>
</li>
<li>
<p>å¯¹äºé¡ºåºæ’å…¥å’Œåˆ é™¤ï¼šç”±äº ArrayList ä¸éœ€è¦ç§»åŠ¨èŠ‚ç‚¹ï¼Œå› æ­¤åœ¨æ•ˆç‡ä¸Šæ¯” LinkedList æ›´å¥½ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨å®é™…ä½¿ç”¨ä¸­ ArrayList æ›´å¤šï¼Œå› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬çš„ä½¿ç”¨éƒ½æ˜¯é¡ºåºæ’å…¥ã€‚</p>
</li>
<li>
<p>ä¸¤è€…éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
</li>
<li>
<p>å†…å­˜ç©ºé—´å ç”¨ï¼š ArrayList çš„ç©º é—´æµªè´¹ä¸»è¦ä½“ç°åœ¨åœ¨ list åˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€Œ LinkedList çš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æ¶ˆè€—æ¯” ArrayList æ›´å¤šçš„ç©ºé—´ï¼ˆå› ä¸ºè¦å­˜æ”¾ç›´æ¥åç»§å’Œç›´æ¥å‰é©±ä»¥åŠæ•°æ®ï¼‰ã€‚</p>
</li>
</ul>
<p><a href="https://blog.csdn.net/v123411739/article/details/106324537">é¢˜å‚è€ƒ</a></p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/java%E9%9B%86%E5%90%88/">Javaé›†åˆ</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>