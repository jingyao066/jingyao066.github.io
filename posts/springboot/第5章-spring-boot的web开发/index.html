<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>第5章 Spring Boot的web开发 | Wjy&#39;s Blog</title>
<meta name="keywords" content="springboot">
<meta name="description" content="SpringBoot的web自动配置 新建项目sb3-09-web：添加web启动器，添加Lombok依赖。 web自动配置的依赖是如何传递的 首">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://009965.xyz/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://009965.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://009965.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://009965.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://009965.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://009965.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://009965.xyz/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://009965.xyz/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="第5章 Spring Boot的web开发">
  <meta property="og:description" content="SpringBoot的web自动配置 新建项目sb3-09-web：添加web启动器，添加Lombok依赖。 web自动配置的依赖是如何传递的 首">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-05-06T15:50:01+00:00">
    <meta property="article:modified_time" content="2025-05-06T15:50:01+00:00">
    <meta property="article:tag" content="Springboot">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第5章 Spring Boot的web开发">
<meta name="twitter:description" content="SpringBoot的web自动配置 新建项目sb3-09-web：添加web启动器，添加Lombok依赖。 web自动配置的依赖是如何传递的 首">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://009965.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "第5章 Spring Boot的web开发",
      "item": "https://009965.xyz/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "第5章 Spring Boot的web开发",
  "name": "第5章 Spring Boot的web开发",
  "description": "SpringBoot的web自动配置 新建项目sb3-09-web：添加web启动器，添加Lombok依赖。 web自动配置的依赖是如何传递的 首",
  "keywords": [
    "springboot"
  ],
  "articleBody": "SpringBoot的web自动配置 新建项目sb3-09-web：添加web启动器，添加Lombok依赖。\nweb自动配置的依赖是如何传递的 首先引入了web启动器，如下： 1 2 3 4 org.springframework.boot spring-boot-starter-web web启动器传递引入了spring-boot-starter，如下： 1 2 3 4 5 6 org.springframework.boot spring-boot-starter 3.3.5 compile spring-boot-starter会传递引入一个spring-boot-autoconfigure包，如下： 1 2 3 4 5 6 org.springframework.boot spring-boot-autoconfigure 3.3.5 compile 在spring-boot-autoconfigure包中的.imports文件中罗列的需要导入的自动配置类，如下图： web自动配置的实现原理 从入口程序开始： 1 2 3 4 5 6 7 8 9 10 11 12 package com.powernode.sb309web; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class Sb309WebApplication { public static void main(String[] args) { SpringApplication.run(Sb309WebApplication.class, args); } } 入口程序被@SpringBootApplication注解标注。\n@SpringBootApplication注解被@EnableAutoConfiguration注解标注。表示启用自动配置。 @EnableAutoConfiguration注解被@Import({AutoConfigurationImportSelector.class})注解标注。 因此AutoConfigurationImportSelector决定哪些自动配置类是需要导入的。 AutoConfigurationImportSelector底层实现步骤具体如下： 最终找的文件是：META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports\n注意：任何jar包，包括第三方的依赖，自动配置类所在的路径以及文件名都是完全相同的，都是**META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports**\n例如mybatis的自动配置类的列表文件也是这样，如下图：\n通过web自动配置类逆推web配置的prefix 在自动配置列表中找到web自动配置相关的类：\n以下就是web自动配置类列表：\n1 2 3 4 5 6 7 8 org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration 通过web自动配置类的源码可以逆推web配置的prefix：\nWebMvcAutoConfiguration MultipartAutoConfiguration HttpEncodingAutoConfiguration ErrorMvcAutoConfiguration ServletWebServerFactoryAutoConfiguration DispatcherServletAutoConfiguration EmbeddedWebServerFactoryCustomizerAutoConfiguration RestTemplateAutoConfiguration 通过查看源码，得知，web开发时，在application.properties配置文件中可以配置的前缀是：\n1 2 3 4 5 6 7 8 9 10 11 # SpringMVC相关配置 spring.mvc. # web开发通用配置 spring.web. # 文件上传配置 spring.servlet.multipart. # 服务器配置 server. Web自动配置都默认配置了什么 查看官方文档：\n翻译如下：\nSpring Boot 为 Spring MVC 提供了自动配置，这在大多数应用程序中都能很好地工作。除了已经实现了 Spring MVC 的默认功能外，自动配置还提供了以下特性：\n包括 ContentNegotiatingViewResolver 和 BeanNameViewResolver 的 Bean。 ContentNegotiatingViewResolver 自动根据HTTP请求头中Accept字段来选择合适的视图技术渲染响应。 BeanNameViewResolver 的作用是根据视图名称找到视图View对象。 支持提供静态资源，包括对 WebJars的支持。 静态资源路径默认已经配置好了。默认会去static目录下找。 自动注册 Converter、GenericConverter 和 Formatter 的 Bean。 Converter：转换器，做类型转换的，例如表单提交了用户数据，将表单数据转换成User对象。 Formatter：格式化器，做数据格式化的，例如将Java中的日期类型对象格式化为特定格式的日期字符串。或者将用户提交的日期字符串，转换为Java中的日期对象。 支持 HttpMessageConverters。 内置了很多的HTTP消息转换器。例如：MappingJackson2HttpMessageConverter可以将json转换成java对象，也可以将java对象转换为json字符串。 自动注册 MessageCodesResolver。 SpringBoot会自动注册一个默认的消息代码解析器 帮助你在表单验证出错时生成一些特殊的代码。这些代码让你能够更精确地定位问题，并提供更友好的错误提示。 静态 index.html 文件支持。 Spring Boot 会自动处理位于项目静态资源目录下的 index.html 文件，使其成为应用程序的默认主页 自动使用 ConfigurableWebBindingInitializer Bean。 用它来指定默认使用哪个转换器，默认使用哪个格式化器。在这个类当中都已经配好了。 如果您不想使用自动配置并希望完全控制 Spring MVC，可以添加您自己的带有 **@EnableWebMvc** 注解的 @Configuration。\n如果您希望保留这些 Spring Boot MVC 定制化设置并进行更多的 MVC 定制化（如拦截器、格式化程序、视图控制器等其他功能），可以添加您自己的类型为 WebMvcConfigurer 的 @Configuration 类。但不能使用**@EnableWebMvc**注解。\nWebMvcAutoConfiguration原理 通过源码分析的方式，学习WebMvc的自动配置原理。\nWebMvc自动配置是否生效的条件 1 2 3 4 5 6 7 8 @AutoConfiguration(after = { DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class, ValidationAutoConfiguration.class }) @ConditionalOnWebApplication(type = Type.SERVLET) @ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class }) @ConditionalOnMissingBean(WebMvcConfigurationSupport.class) @AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10) @ImportRuntimeHints(WebResourcesRuntimeHints.class) public class WebMvcAutoConfiguration {} @AutoConfiguration(after = { DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,ValidationAutoConfiguration.class }) WebMvcAutoConfiguration自动配置类加载顺序在以上自动配置类加载后加载。 @ConditionalOnWebApplication(type = Type.SERVLET) WebMvcAutoConfiguration自动配置类只在servlet环境中生效。 @ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class }) 类路径中必须存在Servlet.class``DispatcherServlet.class``WebMvcConfigurer.class，WebMvcAutoConfiguration自动配置类才会生效。 @ConditionalOnMissingBean(WebMvcConfigurationSupport.class) 类路径中不存在WebMvcConfigurationSupport.class时WebMvcAutoConfiguration自动配置类才会生效。 注意：当使用@EnableWebMvc注解后，类路径中就会注册一个WebMvcConfigurationSupport这样的bean。 @AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10) 不重要 指定WebMvcAutoConfiguration自动配置类的加载顺序 @ImportRuntimeHints(WebResourcesRuntimeHints.class) 不重要 运行时引入WebResourcesRuntimeHints这个类，这个类的作用是给JVM或者其他组件提示信息的，提示一下系统应该如何处理类和资源。 总结来说，WebMvcAutoConfiguration类将在以下条件下生效：\n应用程序是一个Servlet类型的Web应用； 环境中有Servlet、DispatcherServlet和WebMvcConfigurer类； 容器中没有WebMvcConfigurationSupport的bean。 如果这些条件都满足的话，那么这个自动配置类就会被激活，并进行相应的自动配置工作。\nWebMvc自动配置生效后引入了两个Filter Bean 引入了HiddenHttpMethodFilter Bean 1 2 3 4 5 6 @Bean @ConditionalOnMissingBean(HiddenHttpMethodFilter.class) @ConditionalOnProperty(prefix = \"spring.mvc.hiddenmethod.filter\", name = \"enabled\") public OrderedHiddenHttpMethodFilter hiddenHttpMethodFilter() { return new OrderedHiddenHttpMethodFilter(); } 这个过滤器是专门处理Rest请求的。GET POST PUT DELETE请求。\n引入了FormContentFilter Bean 1 2 3 4 5 6 @Bean @ConditionalOnMissingBean(FormContentFilter.class) @ConditionalOnProperty(prefix = \"spring.mvc.formcontent.filter\", name = \"enabled\", matchIfMissing = true) public OrderedFormContentFilter formContentFilter() { return new OrderedFormContentFilter(); } OrderedFormContentFilter 是 Spring Boot 中用于处理 HTTP 请求的一个过滤器，特别是针对 PUT 和 DELETE 请求。这个过滤器的主要作用是在处理 PUT 和 DELETE 请求时，确保如果请求体中有表单格式的数据，这些数据会被正确解析并可用。\nWebMvc自动配置生效后引入了WebMvcConfigurer接口的实现类 在SpringBoot框架的WebMvcAutoConfiguration类中提供了一个内部类：WebMvcAutoConfigurationAdapter\nSpringBoot在这个类WebMvcAutoConfigurationAdapter中进行了一系列的Spring MVC相关配置。\n我们开发中要对Spring MVC的相关配置进行修改，可以编写一个类继承**WebMvcAutoConfigurationAdatper**，然后重写对应的方法即可。\n因此，通过对**WebMvcAutoConfigurationAdapter**类中的方法进行重写来修改Web MVC的默认配置。\n关于WebMvcConfigurer接口 这个接口不是SpringBoot框架提供的，是Spring MVC提供的，在Spring框架4.3版本中引入的。这个接口的作用主要是允许开发者通过实现这个接口来定制Spring MVC的行为。\n在这个接口中提供了很多方法，需要改变Spring MVC的哪个行为，则重写对应的方法即可，下面是这个接口中所有的方法，以及每个方法对应的Spring MVC行为的解释：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 public interface WebMvcConfigurer { // 用于定制 Spring MVC 如何匹配请求路径到控制器 default void configurePathMatch(PathMatchConfigurer configurer) {} // 用于定制 Spring MVC 的内容协商策略，以确定如何根据请求的内容类型来选择合适的处理方法或返回数据格式 default void configureContentNegotiation(ContentNegotiationConfigurer configurer) {} // 用于定制 Spring MVC 处理异步请求的方式 default void configureAsyncSupport(AsyncSupportConfigurer configurer) {} // 用于定制是否将某些静态资源请求转发WEB容器默认的Servlet处理 default void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {} // 用于定制 Spring MVC 解析视图的方式，以确定如何将控制器返回的视图名称转换为实际的视图资源。 default void configureViewResolvers(ViewResolverRegistry registry) {} // 用于定制 Spring MVC 如何处理 HTTP 请求和响应的数据格式，包括 JSON、XML 等内容类型的转换 default void configureMessageConverters(List",
  "wordCount" : "20869",
  "inLanguage": "en",
  "datePublished": "2025-05-06T15:50:01Z",
  "dateModified": "2025-05-06T15:50:01Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://009965.xyz/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://009965.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://009965.xyz/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://009965.xyz/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://009965.xyz/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://009965.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://009965.xyz/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      第5章 Spring Boot的web开发
    </h1>
    <div class="post-meta"><span title='2025-05-06 15:50:01 +0000 UTC'>2025-05-06</span>&nbsp;·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#springboot%e7%9a%84web%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae" aria-label="SpringBoot的web自动配置">SpringBoot的web自动配置</a><ul>
                        
                <li>
                    <a href="#web%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae%e7%9a%84%e4%be%9d%e8%b5%96%e6%98%af%e5%a6%82%e4%bd%95%e4%bc%a0%e9%80%92%e7%9a%84" aria-label="web自动配置的依赖是如何传递的">web自动配置的依赖是如何传递的</a></li>
                <li>
                    <a href="#web%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae%e7%9a%84%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86" aria-label="web自动配置的实现原理">web自动配置的实现原理</a></li>
                <li>
                    <a href="#%e9%80%9a%e8%bf%87web%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae%e7%b1%bb%e9%80%86%e6%8e%a8web%e9%85%8d%e7%bd%ae%e7%9a%84prefix" aria-label="通过web自动配置类逆推web配置的prefix">通过web自动配置类逆推web配置的prefix</a></li>
                <li>
                    <a href="#web%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae%e9%83%bd%e9%bb%98%e8%ae%a4%e9%85%8d%e7%bd%ae%e4%ba%86%e4%bb%80%e4%b9%88" aria-label="Web自动配置都默认配置了什么">Web自动配置都默认配置了什么</a></li>
                <li>
                    <a href="#font-stylecolor080808background-colorffffffwebmvcautoconfiguration%e5%8e%9f%e7%90%86font" aria-label="WebMvcAutoConfiguration原理">WebMvcAutoConfiguration原理</a><ul>
                        
                <li>
                    <a href="#webmvc%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae%e6%98%af%e5%90%a6%e7%94%9f%e6%95%88%e7%9a%84%e6%9d%a1%e4%bb%b6" aria-label="WebMvc自动配置是否生效的条件">WebMvc自动配置是否生效的条件</a></li>
                <li>
                    <a href="#webmvc%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae%e7%94%9f%e6%95%88%e5%90%8e%e5%bc%95%e5%85%a5%e4%ba%86%e4%b8%a4%e4%b8%aafilter-bean" aria-label="WebMvc自动配置生效后引入了两个Filter Bean">WebMvc自动配置生效后引入了两个Filter Bean</a><ul>
                        
                <li>
                    <a href="#%e5%bc%95%e5%85%a5%e4%ba%86font-stylecolor080808background-colorffffffhiddenhttpmethodfilter-beanfont" aria-label="引入了HiddenHttpMethodFilter Bean">引入了HiddenHttpMethodFilter Bean</a></li>
                <li>
                    <a href="#%e5%bc%95%e5%85%a5%e4%ba%86font-stylecolor080808background-colorffffffformcontentfilter-beanfont" aria-label="引入了FormContentFilter Bean">引入了FormContentFilter Bean</a></li></ul>
                </li>
                <li>
                    <a href="#webmvc%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae%e7%94%9f%e6%95%88%e5%90%8e%e5%bc%95%e5%85%a5%e4%ba%86webmvcconfigurer%e6%8e%a5%e5%8f%a3%e7%9a%84%e5%ae%9e%e7%8e%b0%e7%b1%bb" aria-label="WebMvc自动配置生效后引入了WebMvcConfigurer接口的实现类">WebMvc自动配置生效后引入了WebMvcConfigurer接口的实现类</a><ul>
                        
                <li>
                    <a href="#%e5%85%b3%e4%ba%8ewebmvcconfigurer%e6%8e%a5%e5%8f%a3" aria-label="关于WebMvcConfigurer接口">关于WebMvcConfigurer接口</a></li>
                <li>
                    <a href="#webmvcconfigurer%e6%8e%a5%e5%8f%a3%e7%9a%84%e5%ae%9e%e7%8e%b0%e7%b1%bbwebmvcautoconfigurationadapter" aria-label="WebMvcConfigurer接口的实现类WebMvcAutoConfigurationAdapter">WebMvcConfigurer接口的实现类WebMvcAutoConfigurationAdapter</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae%e4%b8%ad%e7%9a%84%e9%9d%99%e6%80%81%e8%b5%84%e6%ba%90%e5%a4%84%e7%90%86" aria-label="自动配置中的静态资源处理">自动配置中的静态资源处理</a><ul>
                        
                <li>
                    <a href="#%e9%9d%99%e6%80%81%e8%b5%84%e6%ba%90%e5%a4%84%e7%90%86%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" aria-label="静态资源处理源码分析">静态资源处理源码分析</a></li>
                <li>
                    <a href="#%e5%85%b3%e4%ba%8ewebjars%e9%9d%99%e6%80%81%e8%b5%84%e6%ba%90%e5%a4%84%e7%90%86" aria-label="关于WebJars静态资源处理">关于WebJars静态资源处理</a></li>
                <li>
                    <a href="#%e5%85%b3%e4%ba%8e%e6%99%ae%e9%80%9a%e9%9d%99%e6%80%81%e8%b5%84%e6%ba%90%e5%a4%84%e7%90%86" aria-label="关于普通静态资源处理">关于普通静态资源处理</a></li>
                <li>
                    <a href="#%e5%85%b3%e4%ba%8e%e9%9d%99%e6%80%81%e8%b5%84%e6%ba%90%e7%bc%93%e5%ad%98%e5%a4%84%e7%90%86" aria-label="关于静态资源缓存处理">关于静态资源缓存处理</a></li>
                <li>
                    <a href="#%e9%9d%99%e6%80%81%e8%b5%84%e6%ba%90%e7%bc%93%e5%ad%98%e6%b5%8b%e8%af%95" aria-label="静态资源缓存测试">静态资源缓存测试</a></li>
                <li>
                    <a href="#web%e5%ba%94%e7%94%a8%e7%9a%84%e6%ac%a2%e8%bf%8e%e9%a1%b5%e9%9d%a2" aria-label="web应用的欢迎页面">web应用的欢迎页面</a><ul>
                        
                <li>
                    <a href="#%e6%ac%a2%e8%bf%8e%e9%a1%b5%e6%b5%8b%e8%af%95" aria-label="欢迎页测试">欢迎页测试</a></li>
                <li>
                    <a href="#%e6%ac%a2%e8%bf%8e%e9%a1%b5%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" aria-label="欢迎页源码分析">欢迎页源码分析</a></li>
                <li>
                    <a href="#%e4%b8%80%e4%b8%aa%e5%b0%8f%e5%b0%8f%e7%9a%84%e7%96%91%e6%83%91" aria-label="一个小小的疑惑">一个小小的疑惑</a></li>
                <li>
                    <a href="#favorite-icon" aria-label="favorite icon">favorite icon</a></li></ul>
                </li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#springboot%e7%9a%84web%e6%89%8b%e5%8a%a8%e9%85%8d%e7%bd%ae%e9%9d%99%e6%80%81%e8%b5%84%e6%ba%90%e5%a4%84%e7%90%86" aria-label="SpringBoot的web手动配置(静态资源处理)">SpringBoot的web手动配置(静态资源处理)</a><ul>
                        
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%96%b9%e5%bc%8f" aria-label="配置文件方式">配置文件方式</a></li>
                <li>
                    <a href="#%e7%bc%96%e5%86%99%e4%bb%a3%e7%a0%81%e6%96%b9%e5%bc%8f" aria-label="编写代码方式">编写代码方式</a><ul>
                        
                <li>
                    <a href="#%e7%ac%ac%e4%b8%80%e7%a7%8d%e6%96%b9%e5%bc%8f" aria-label="第一种方式">第一种方式</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%8c%e7%a7%8d%e6%96%b9%e5%bc%8f" aria-label="第二种方式">第二种方式</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96%e9%85%8d%e7%bd%ae%e4%b9%9f%e8%bf%99%e6%a0%b7%e5%81%9a%e5%8d%b3%e5%8f%af" aria-label="其他配置也这样做即可">其他配置也这样做即可</a></li>
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e5%8f%aa%e8%a6%81%e5%ae%b9%e5%99%a8%e4%b8%ad%e6%9c%89webmvcconfigurer%e7%bb%84%e4%bb%b6%e5%8d%b3%e5%8f%af%e5%91%a2" aria-label="为什么只要容器中有WebMvcConfigurer组件即可呢">为什么只要容器中有WebMvcConfigurer组件即可呢</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#web%e8%af%b7%e6%b1%82%e7%9a%84%e8%b7%af%e5%be%84%e5%8c%b9%e9%85%8d" aria-label="web请求的路径匹配">web请求的路径匹配</a><ul>
                        
                <li>
                    <a href="#antpathmatcher" aria-label="AntPathMatcher">AntPathMatcher</a></li>
                <li>
                    <a href="#pathpatternparser" aria-label="PathPatternParser">PathPatternParser</a></li>
                <li>
                    <a href="#%e8%b7%af%e5%be%84%e5%8c%b9%e9%85%8d%e7%9b%b8%e5%85%b3%e6%ba%90%e7%a0%81" aria-label="路径匹配相关源码">路径匹配相关源码</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%86%85%e5%ae%b9%e5%8d%8f%e5%95%86" aria-label="内容协商">内容协商</a><ul>
                        
                <li>
                    <a href="#%e5%af%b9%e5%86%85%e5%ae%b9%e5%8d%8f%e5%95%86%e7%9a%84%e7%90%86%e8%a7%a3" aria-label="对内容协商的理解">对内容协商的理解</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0%e5%86%85%e5%ae%b9%e5%8d%8f%e5%95%86%e7%9a%84%e4%b8%a4%e7%a7%8d%e6%96%b9%e5%bc%8f" aria-label="实现内容协商的两种方式">实现内容协商的两种方式</a><ul>
                        
                <li>
                    <a href="#%e9%80%9a%e8%bf%87http%e8%af%b7%e6%b1%82%e5%a4%b4%e5%a6%82-accept" aria-label="通过HTTP请求头（如 Accept）">通过HTTP请求头（如 Accept）</a></li>
                <li>
                    <a href="#font-stylecolorrgb44-44-54%e9%80%9a%e8%bf%87%e8%af%b7%e6%b1%82%e5%8f%82%e6%95%b0%e5%a6%82-fontfont-stylecolorrgb44-44-54formatfontfont-stylecolorrgb44-44-54font" aria-label="通过请求参数（如 &lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;format&lt;/font&gt;）">通过请求参数（如 &lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;format&lt;/font&gt;）</a></li></ul>
                </li>
                <li>
                    <a href="#httpmessageconverter%e6%8e%a5%e5%8f%a3" aria-label="HttpMessageConverter接口">HttpMessageConverter接口</a><ul>
                        
                <li>
                    <a href="#httpmessageconverter%e7%9a%84%e7%90%86%e8%a7%a3" aria-label="HttpMessageConverter的理解">HttpMessageConverter的理解</a></li>
                <li>
                    <a href="#%e5%b8%b8%e8%a7%81%e7%9a%84httpmessageconverter" aria-label="常见的HttpMessageConverter">常见的HttpMessageConverter</a></li>
                <li>
                    <a href="#%e8%af%b7%e6%b1%82%e6%97%b6%e9%80%9a%e8%bf%87%e5%93%aa%e4%ba%9b%e6%9d%a1%e4%bb%b6%e7%a1%ae%e5%ae%9a%e4%bd%bf%e7%94%a8%e5%93%aa%e4%b8%aa%e8%bd%ac%e6%8d%a2%e5%99%a8" aria-label="请求时通过哪些条件确定使用哪个转换器">请求时通过哪些条件确定使用哪个转换器</a></li>
                <li>
                    <a href="#%e5%93%8d%e5%ba%94%e6%97%b6%e9%80%9a%e8%bf%87%e5%93%aa%e4%ba%9b%e6%9d%a1%e4%bb%b6%e7%a1%ae%e5%ae%9a%e4%bd%bf%e7%94%a8%e5%93%aa%e4%b8%aa%e8%bd%ac%e6%8d%a2%e5%99%a8" aria-label="响应时通过哪些条件确定使用哪个转换器">响应时通过哪些条件确定使用哪个转换器</a></li>
                <li>
                    <a href="#%e7%b3%bb%e7%bb%9f%e9%bb%98%e8%ae%a4%e6%8f%90%e4%be%9b%e4%ba%86%e5%93%aa%e4%ba%9bhttpmessageconverter" aria-label="系统默认提供了哪些HttpMessageConverter">系统默认提供了哪些HttpMessageConverter</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%9a%e4%b9%89%e8%87%aa%e5%b7%b1%e7%9a%84httpmessageconverter" aria-label="定义自己的HttpMessageConverter">定义自己的HttpMessageConverter</a><ul>
                        
                <li>
                    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%bc%95%e5%85%a5%e8%83%bd%e5%a4%9f%e5%a4%84%e7%90%86yaml%e6%a0%bc%e5%bc%8f%e7%9a%84%e4%be%9d%e8%b5%96" aria-label="第一步：引入能够处理yaml格式的依赖">第一步：引入能够处理yaml格式的依赖</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e6%96%b0%e5%a2%9e%e4%b8%80%e7%a7%8d%e5%aa%92%e4%bd%93%e7%b1%bb%e5%9e%8byaml" aria-label="第二步：新增一种媒体类型yaml">第二步：新增一种媒体类型yaml</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%b8%89%e6%ad%a5%e8%87%aa%e5%ae%9a%e4%b9%89httpmessageconverter" aria-label="第三步：自定义HttpMessageConverter">第三步：自定义HttpMessageConverter</a></li>
                <li>
                    <a href="#%e7%ac%ac%e5%9b%9b%e6%ad%a5%e9%85%8d%e7%bd%ae%e6%b6%88%e6%81%af%e8%bd%ac%e6%8d%a2%e5%99%a8" aria-label="第四步：配置消息转换器">第四步：配置消息转换器</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#springboot%e6%95%b4%e5%90%88thymeleaf" aria-label="SpringBoot整合Thymeleaf">SpringBoot整合Thymeleaf</a><ul>
                        
                <li>
                    <a href="#%e4%bc%a0%e7%bb%9fweb%e5%ba%94%e7%94%a8%e5%92%8c%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb" aria-label="传统web应用和前后端分离">传统web应用和前后端分离</a></li>
                <li>
                    <a href="#springboot%e6%95%b4%e5%90%88thymeleaf-1" aria-label="SpringBoot整合Thymeleaf">SpringBoot整合Thymeleaf</a></li>
                <li>
                    <a href="#thymeleaf%e7%9a%84%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae" aria-label="Thymeleaf的自动配置">Thymeleaf的自动配置</a></li>
                <li>
                    <a href="#thymeleaf%e6%a0%b8%e5%bf%83%e8%af%ad%e6%b3%95" aria-label="Thymeleaf核心语法">Thymeleaf核心语法</a><ul>
                        
                <li>
                    <a href="#thtext-%e6%9b%bf%e6%8d%a2%e6%a0%87%e7%ad%be%e4%bd%93%e5%86%85%e5%ae%b9" aria-label="th:text 替换标签体内容">th:text 替换标签体内容</a></li>
                <li>
                    <a href="#thutext-%e6%9b%bf%e6%8d%a2%e6%a0%87%e7%ad%be%e4%bd%93%e5%86%85%e5%ae%b9" aria-label="th:utext 替换标签体内容">th:utext 替换标签体内容</a></li>
                <li>
                    <a href="#th%e4%bb%bb%e6%84%8f%e5%b1%9e%e6%80%a7%e5%90%8d-%e5%8a%a8%e6%80%81%e6%9b%bf%e6%8d%a2%e8%af%a5%e5%b1%9e%e6%80%a7%e7%9a%84%e5%80%bc" aria-label="th:任意属性名 动态替换该属性的值">th:任意属性名 动态替换该属性的值</a></li>
                <li>
                    <a href="#thattr-%e5%b1%9e%e6%80%a7%e5%90%88%e5%b9%b6%e8%ae%be%e7%bd%ae" aria-label="th:attr 属性合并设置">th:attr 属性合并设置</a></li>
                <li>
                    <a href="#th%e6%8c%87%e4%bb%a4" aria-label="th:指令">th:指令</a></li>
                <li>
                    <a href="#-%e8%a1%a8%e8%be%be%e5%bc%8f" aria-label="@{} 表达式">@{} 表达式</a></li>
                <li>
                    <a href="#thymeleaf%e7%9a%84%e5%86%85%e7%bd%ae%e5%b7%a5%e5%85%b7" aria-label="thymeleaf的内置工具">thymeleaf的内置工具</a></li>
                <li>
                    <a href="#thymeleaf%e4%b9%9f%e6%94%af%e6%8c%81%e8%bf%90%e7%ae%97%e7%ac%a6" aria-label="thymeleaf也支持运算符">thymeleaf也支持运算符</a></li>
                <li>
                    <a href="#thymeleaf%e7%9a%84%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%8b%bc%e6%8e%a5" aria-label="thymeleaf的字符串拼接">thymeleaf的字符串拼接</a></li>
                <li>
                    <a href="#%e5%be%aa%e7%8e%af%e9%81%8d%e5%8e%86" aria-label="循环遍历">循环遍历</a></li>
                <li>
                    <a href="#%e6%9d%a1%e4%bb%b6%e5%88%a4%e6%96%adthif" aria-label="条件判断th:if">条件判断th:if</a></li>
                <li>
                    <a href="#%e6%9d%a1%e4%bb%b6%e5%88%a4%e6%96%adthswitch" aria-label="条件判断th:switch">条件判断th:switch</a></li>
                <li>
                    <a href="#thymeleaf%e5%b1%9e%e6%80%a7%e4%bc%98%e5%85%88%e7%ba%a7" aria-label="thymeleaf属性优先级">thymeleaf属性优先级</a></li>
                <li>
                    <a href="#-%e8%a1%a8%e8%be%be%e5%bc%8f-1" aria-label="*{&hellip;} 表达式">*{&hellip;} 表达式</a></li>
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e7%89%87%e6%ae%b5%e5%85%b1%e4%ba%ab" aria-label="代码片段共享">代码片段共享</a></li></ul>
                </li>
                <li>
                    <a href="#thymeleaf%e9%a1%b5%e9%9d%a2%e4%bf%ae%e6%94%b9%e5%a6%82%e4%bd%95%e7%ab%8b%e5%8d%b3%e7%94%9f%e6%95%88" aria-label="thymeleaf页面修改如何立即生效">thymeleaf页面修改如何立即生效</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86" aria-label="异常处理">异常处理</a><ul>
                        
                <li>
                    <a href="#%e8%87%aa%e9%80%82%e5%ba%94%e7%9a%84%e9%94%99%e8%af%af%e5%a4%84%e7%90%86%e6%9c%ba%e5%88%b6" aria-label="自适应的错误处理机制">自适应的错误处理机制</a></li>
                <li>
                    <a href="#springmvc%e7%9a%84%e9%94%99%e8%af%af%e5%a4%84%e7%90%86%e6%96%b9%e6%a1%88" aria-label="SpringMVC的错误处理方案">SpringMVC的错误处理方案</a><ul>
                        
                <li>
                    <a href="#%e5%b1%80%e9%83%a8%e6%8e%a7%e5%88%b6-exceptionhandler" aria-label="局部控制 @ExceptionHandler">局部控制 @ExceptionHandler</a></li>
                <li>
                    <a href="#%e5%85%a8%e5%b1%80%e6%8e%a7%e5%88%b6-controlleradvice--exceptionhandler" aria-label="全局控制 @ControllerAdvice &#43; @ExceptionHandler">全局控制 @ControllerAdvice + @ExceptionHandler</a></li></ul>
                </li>
                <li>
                    <a href="#springboot%e7%9a%84%e9%94%99%e8%af%af%e5%a4%84%e7%90%86%e6%96%b9%e6%a1%88" aria-label="SpringBoot的错误处理方案">SpringBoot的错误处理方案</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e5%9c%a8%e9%94%99%e8%af%af%e9%a1%b5%e8%8e%b7%e5%8f%96%e9%94%99%e8%af%af%e4%bf%a1%e6%81%af" aria-label="如何在错误页获取错误信息">如何在错误页获取错误信息</a></li>
                <li>
                    <a href="#%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e9%a1%b9%e7%9b%ae%e7%9a%84%e9%94%99%e8%af%af%e5%a4%84%e7%90%86%e6%96%b9%e6%a1%88" aria-label="前后端分离项目的错误处理方案">前后端分离项目的错误处理方案</a></li>
                <li>
                    <a href="#%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e8%b4%9f%e8%b4%a3%e9%a1%b5%e9%9d%a2%e6%b8%b2%e6%9f%93%e7%9a%84%e9%a1%b9%e7%9b%ae%e9%94%99%e8%af%af%e5%a4%84%e7%90%86%e6%96%b9%e6%a1%88" aria-label="服务器端负责页面渲染的项目错误处理方案">服务器端负责页面渲染的项目错误处理方案</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%9b%bd%e9%99%85%e5%8c%96%e4%ba%86%e8%a7%a3" aria-label="国际化（了解）">国际化（了解）</a><ul>
                        
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0%e5%9b%bd%e9%99%85%e5%8c%96" aria-label="实现国际化">实现国际化</a><ul>
                        
                <li>
                    <a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%88%9b%e5%bb%ba%e8%b5%84%e6%ba%90%e6%96%87%e4%bb%b6" aria-label="第一步：创建资源文件">第一步：创建资源文件</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%9c%a8%e6%a8%a1%e6%9d%bf%e6%96%87%e4%bb%b6%e4%b8%ad%e5%8f%96%e5%87%ba%e6%b6%88%e6%81%af" aria-label="第二步：在模板文件中取出消息">第二步：在模板文件中取出消息</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%9b%bd%e9%99%85%e5%8c%96%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86" aria-label="国际化实现原理">国际化实现原理</a></li>
                <li>
                    <a href="#%e5%9c%a8%e7%a8%8b%e5%ba%8f%e5%bd%93%e4%b8%ad%e5%a6%82%e4%bd%95%e8%8e%b7%e5%8f%96%e5%9b%bd%e9%99%85%e5%8c%96%e4%bf%a1%e6%81%af" aria-label="在程序当中如何获取国际化信息">在程序当中如何获取国际化信息</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%9a%e5%88%b6web%e5%ae%b9%e5%99%a8" aria-label="定制web容器">定制web容器</a><ul>
                        
                <li>
                    <a href="#web%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%88%87%e6%8d%a2%e4%b8%bajetty" aria-label="web服务器切换为jetty">web服务器切换为jetty</a></li>
                <li>
                    <a href="#web%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%88%87%e6%8d%a2%e5%8e%9f%e7%90%86" aria-label="web服务器切换原理">web服务器切换原理</a></li>
                <li>
                    <a href="#web%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%bc%98%e5%8c%96" aria-label="web服务器优化">web服务器优化</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="springboot的web自动配置">SpringBoot的web自动配置<a hidden class="anchor" aria-hidden="true" href="#springboot的web自动配置">#</a></h1>
<p>新建项目<code>sb3-09-web</code>：添加web启动器，添加Lombok依赖。</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/4bdc7b39e1f5ef7ec9da61c1fe603a2c_MD5.png"></p>
<h2 id="web自动配置的依赖是如何传递的">web自动配置的依赖是如何传递的<a hidden class="anchor" aria-hidden="true" href="#web自动配置的依赖是如何传递的">#</a></h2>
<ol>
<li>首先引入了<code>web启动器</code>，如下：</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li><code>web启动器</code>传递引入了<code>spring-boot-starter</code>，如下：</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;version&gt;</span>3.3.5<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;scope&gt;</span>compile<span style="font-weight:bold">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li><code>spring-boot-starter</code>会传递引入一个<code>spring-boot-autoconfigure</code>包，如下：</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-autoconfigure<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;version&gt;</span>3.3.5<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;scope&gt;</span>compile<span style="font-weight:bold">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/f0f95493c904d95a14497797b062d6a4_MD5.png"></p>
<ol start="4">
<li>在<code>spring-boot-autoconfigure</code>包中的<code>.imports</code>文件中罗列的需要导入的自动配置类，如下图：</li>
</ol>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/3f68e9463b64c59d390dcababdd2f0bd_MD5.png"></p>
<h2 id="web自动配置的实现原理">web自动配置的实现原理<a hidden class="anchor" aria-hidden="true" href="#web自动配置的实现原理">#</a></h2>
<ol>
<li>从入口程序开始：</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.sb309web;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.boot.SpringApplication;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@SpringBootApplication
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Sb309WebApplication {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        SpringApplication.<span style="color:#007f7f">run</span>(Sb309WebApplication.<span style="color:#007f7f">class</span>, args);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>入口程序被<code>@SpringBootApplication</code>注解标注。</p>
<ol start="2">
<li><code>@SpringBootApplication</code>注解被<code>@EnableAutoConfiguration</code><font style="color:#080808;background-color:#ffffff;">注解标注。表示启用自动配置。</font></li>
<li><code>@EnableAutoConfiguration</code><font style="color:#080808;background-color:#ffffff;">注解被</font><code>@Import({AutoConfigurationImportSelector.class})</code><font style="color:#080808;background-color:#ffffff;">注解标注。</font></li>
<li><font style="color:#080808;background-color:#ffffff;">因此</font><code>AutoConfigurationImportSelector</code><font style="color:#080808;background-color:#ffffff;">决定哪些自动配置类是需要导入的。</font></li>
<li><code>&lt;font style=&quot;color:#080808;background-color:#ffffff;&quot;&gt;AutoConfigurationImportSelector&lt;/font&gt;</code><font style="color:#080808;background-color:#ffffff;">底层实现步骤具体如下：</font></li>
</ol>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/fd3507b1d4a5124f839f37be97712a1e_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/eb4f7cbc2eb10676fa08b78eef56724b_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/4455adefd7830f59fcf25306eb9e2949_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/2cd9a2c2dba804614508c3fccebff148_MD5.png"></p>
<p>最终找的文件是：<code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code></p>
<p><strong>注意：任何jar包，包括第三方的依赖，自动配置类所在的路径以及文件名都是完全相同的，都是</strong><code>**META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports**</code></p>
<p>例如mybatis的自动配置类的列表文件也是这样，如下图：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/7483e0f2ca3d8dfe0af3097bf6193c32_MD5.png"></p>
<h2 id="通过web自动配置类逆推web配置的prefix">通过web自动配置类逆推web配置的prefix<a hidden class="anchor" aria-hidden="true" href="#通过web自动配置类逆推web配置的prefix">#</a></h2>
<p>在自动配置列表中找到web自动配置相关的类：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/7d6c1aa66da63bf3fffe1ff90b298e33_MD5.png"></p>
<p>以下就是web自动配置类列表：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>org.<span style="color:#007f7f">springframework</span>.<span style="color:#007f7f">boot</span>.<span style="color:#007f7f">autoconfigure</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">client</span>.<span style="color:#007f7f">RestTemplateAutoConfiguration</span>
</span></span><span style="display:flex;"><span>org.<span style="color:#007f7f">springframework</span>.<span style="color:#007f7f">boot</span>.<span style="color:#007f7f">autoconfigure</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">embedded</span>.<span style="color:#007f7f">EmbeddedWebServerFactoryCustomizerAutoConfiguration</span>
</span></span><span style="display:flex;"><span>org.<span style="color:#007f7f">springframework</span>.<span style="color:#007f7f">boot</span>.<span style="color:#007f7f">autoconfigure</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">servlet</span>.<span style="color:#007f7f">DispatcherServletAutoConfiguration</span>
</span></span><span style="display:flex;"><span>org.<span style="color:#007f7f">springframework</span>.<span style="color:#007f7f">boot</span>.<span style="color:#007f7f">autoconfigure</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">servlet</span>.<span style="color:#007f7f">ServletWebServerFactoryAutoConfiguration</span>
</span></span><span style="display:flex;"><span>org.<span style="color:#007f7f">springframework</span>.<span style="color:#007f7f">boot</span>.<span style="color:#007f7f">autoconfigure</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">servlet</span>.<span style="color:#007f7f">error</span>.<span style="color:#007f7f">ErrorMvcAutoConfiguration</span>
</span></span><span style="display:flex;"><span>org.<span style="color:#007f7f">springframework</span>.<span style="color:#007f7f">boot</span>.<span style="color:#007f7f">autoconfigure</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">servlet</span>.<span style="color:#007f7f">HttpEncodingAutoConfiguration</span>
</span></span><span style="display:flex;"><span>org.<span style="color:#007f7f">springframework</span>.<span style="color:#007f7f">boot</span>.<span style="color:#007f7f">autoconfigure</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">servlet</span>.<span style="color:#007f7f">MultipartAutoConfiguration</span>
</span></span><span style="display:flex;"><span>org.<span style="color:#007f7f">springframework</span>.<span style="color:#007f7f">boot</span>.<span style="color:#007f7f">autoconfigure</span>.<span style="color:#007f7f">web</span>.<span style="color:#007f7f">servlet</span>.<span style="color:#007f7f">WebMvcAutoConfiguration</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过web自动配置类的源码可以逆推web配置的prefix：</p>
<ol>
<li>WebMvcAutoConfiguration</li>
</ol>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/63caa8f1afa0114a14d4d0a57175c206_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/b7c9bb925fa99b8139179ac67f7857ba_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/a47452791f27ced67ef14f17c15c3b0c_MD5.png"></p>
<ol start="2">
<li>MultipartAutoConfiguration</li>
</ol>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/0434cd7e15cd5534ba03f81abb8fa4d5_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/286ee1a76fc613582200b2f88f5c8dbc_MD5.png"></p>
<ol start="3">
<li>HttpEncodingAutoConfiguration</li>
</ol>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/4f2811fd66838c50eeb0625b3f139321_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/6177fc39e108404991d38399f2c8b533_MD5.png"></p>
<ol start="4">
<li>ErrorMvcAutoConfiguration</li>
<li>ServletWebServerFactoryAutoConfiguration</li>
<li>DispatcherServletAutoConfiguration</li>
<li>EmbeddedWebServerFactoryCustomizerAutoConfiguration</li>
<li>RestTemplateAutoConfiguration</li>
</ol>
<p>通过查看源码，得知，web开发时，在<code>application.properties</code>配置文件中可以配置的前缀是：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f"># SpringMVC相关配置</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">spring.mvc.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># web开发通用配置</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">spring.web.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 文件上传配置</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">spring.servlet.multipart.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 服务器配置</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">server.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="web自动配置都默认配置了什么">Web自动配置都默认配置了什么<a hidden class="anchor" aria-hidden="true" href="#web自动配置都默认配置了什么">#</a></h2>
<p>查看官方文档：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/c0790951d776221af4305ded665b0220_MD5.png"></p>
<p><strong>翻译如下：</strong></p>
<p>Spring Boot 为 Spring MVC 提供了自动配置，这在大多数应用程序中都能很好地工作。除了已经实现了 Spring MVC 的默认功能外，自动配置还提供了以下特性：</p>
<ul>
<li>包括 <code>ContentNegotiatingViewResolver</code> 和 <code>BeanNameViewResolver</code> 的 Bean。
<ul>
<li><code>ContentNegotiatingViewResolver</code> 自动根据HTTP请求头中Accept字段来选择合适的视图技术渲染响应。</li>
<li><code>&lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;BeanNameViewResolver&lt;/font&gt;</code><font style="color:rgb(44, 44, 54);"> 的作用是根据视图名称找到视图View对象。</font></li>
</ul>
</li>
<li>支持提供静态资源，包括对 WebJars的支持。
<ul>
<li>静态资源路径默认已经配置好了。默认会去static目录下找。</li>
</ul>
</li>
<li>自动注册 <code>Converter</code>、<code>GenericConverter</code> 和 <code>Formatter</code> 的 Bean。
<ul>
<li><code>Converter</code>：转换器，做类型转换的，例如表单提交了用户数据，将表单数据转换成User对象。</li>
<li><code>Formatter</code>：格式化器，做数据格式化的，例如将Java中的<code>日期类型对象</code>格式化为<code>特定格式的日期字符串</code>。或者将用户提交的日期字符串，转换为Java中的日期对象。</li>
</ul>
</li>
<li>支持 <code>HttpMessageConverters</code>。
<ul>
<li>内置了很多的HTTP消息转换器。例如：<code>MappingJackson2HttpMessageConverter</code>可以将json转换成java对象，也可以将java对象转换为json字符串。</li>
</ul>
</li>
<li>自动注册 <code>MessageCodesResolver</code>。
<ul>
<li>SpringBoot会自动注册一个默认的<code>消息代码解析器</code></li>
<li>帮助你在表单验证出错时生成一些特殊的代码。这些代码让你能够更精确地定位问题，并提供更友好的错误提示。</li>
</ul>
</li>
<li>静态 <code>index.html</code> 文件支持。
<ul>
<li>Spring Boot 会自动处理位于项目静态资源目录下的 index.html 文件，使其成为应用程序的默认主页</li>
</ul>
</li>
<li>自动使用 <code>ConfigurableWebBindingInitializer</code> Bean。
<ul>
<li>用它来指定默认使用哪个转换器，默认使用哪个格式化器。在这个类当中都已经配好了。</li>
</ul>
</li>
</ul>
<p>如果您不想使用自动配置并希望完全控制 Spring MVC，可以添加您自己的带有 <code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;@EnableWebMvc&lt;/font&gt;**</code> 注解的 <code>@Configuration</code>。</p>
<p>如果您希望保留这些 Spring Boot MVC 定制化设置并进行更多的 MVC 定制化（如拦截器、格式化程序、视图控制器等其他功能），可以添加您自己的类型为 <code>WebMvcConfigurer</code> 的 <code>@Configuration</code> 类。<strong><font style="color:#DF2A3F;">但不能使用</font></strong><code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;@EnableWebMvc&lt;/font&gt;**</code><strong><font style="color:#DF2A3F;">注解</font></strong>。</p>
<h2 id="font-stylecolor080808background-colorffffffwebmvcautoconfiguration原理font"><font style="color:#080808;background-color:#ffffff;">WebMvcAutoConfiguration原理</font><a hidden class="anchor" aria-hidden="true" href="#font-stylecolor080808background-colorffffffwebmvcautoconfiguration原理font">#</a></h2>
<p>通过源码分析的方式，学习WebMvc的自动配置原理。</p>
<h3 id="webmvc自动配置是否生效的条件">WebMvc自动配置是否生效的条件<a hidden class="anchor" aria-hidden="true" href="#webmvc自动配置是否生效的条件">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@AutoConfiguration(after = { DispatcherServletAutoConfiguration.<span style="color:#007f7f">class</span>, TaskExecutionAutoConfiguration.<span style="color:#007f7f">class</span>,
</span></span><span style="display:flex;"><span>		ValidationAutoConfiguration.<span style="color:#007f7f">class</span> })
</span></span><span style="display:flex;"><span>@ConditionalOnWebApplication(type = Type.<span style="color:#007f7f">SERVLET</span>)
</span></span><span style="display:flex;"><span>@ConditionalOnClass({ Servlet.<span style="color:#007f7f">class</span>, DispatcherServlet.<span style="color:#007f7f">class</span>, WebMvcConfigurer.<span style="color:#007f7f">class</span> })
</span></span><span style="display:flex;"><span>@ConditionalOnMissingBean(WebMvcConfigurationSupport.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>@AutoConfigureOrder(Ordered.<span style="color:#007f7f">HIGHEST_PRECEDENCE</span> + 10)
</span></span><span style="display:flex;"><span>@ImportRuntimeHints(WebResourcesRuntimeHints.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WebMvcAutoConfiguration {}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>@AutoConfiguration(after = { DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,ValidationAutoConfiguration.class })
<ul>
<li><strong>WebMvcAutoConfiguration自动配置类</strong>加载顺序在以上自动配置类加载后加载。</li>
</ul>
</li>
<li>@ConditionalOnWebApplication(type = Type.SERVLET)
<ul>
<li><strong>WebMvcAutoConfiguration自动配置类</strong>只在servlet环境中生效。</li>
</ul>
</li>
<li>@ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class })
<ul>
<li>类路径中必须存在<code>Servlet.class``DispatcherServlet.class``WebMvcConfigurer.class</code>，<strong>WebMvcAutoConfiguration自动配置类才会生效。</strong></li>
</ul>
</li>
<li>@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)
<ul>
<li>类路径中不存在<code>WebMvcConfigurationSupport.class</code>时<strong>WebMvcAutoConfiguration自动配置类才会生效。</strong></li>
<li>注意：当使用@EnableWebMvc注解后，类路径中就会注册一个WebMvcConfigurationSupport这样的bean。</li>
</ul>
</li>
<li>@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10) <strong>不重要</strong>
<ul>
<li>指定<strong>WebMvcAutoConfiguration自动配置类</strong>的加载顺序</li>
</ul>
</li>
<li>@ImportRuntimeHints(WebResourcesRuntimeHints.class) <strong>不重要</strong>
<ul>
<li>运行时引入<strong>WebResourcesRuntimeHints</strong>这个类，这个类的作用是给JVM或者其他组件提示信息的，提示一下系统应该如何处理类和资源。</li>
</ul>
</li>
</ul>
<p>总结来说，WebMvcAutoConfiguration类将在以下条件下生效：</p>
<ol>
<li>应用程序是一个Servlet类型的Web应用；</li>
<li>环境中有Servlet、DispatcherServlet和WebMvcConfigurer类；</li>
<li>容器中没有WebMvcConfigurationSupport的bean。</li>
</ol>
<p>如果这些条件都满足的话，那么这个自动配置类就会被激活，并进行相应的自动配置工作。</p>
<h3 id="webmvc自动配置生效后引入了两个filter-bean">WebMvc自动配置生效后引入了两个Filter Bean<a hidden class="anchor" aria-hidden="true" href="#webmvc自动配置生效后引入了两个filter-bean">#</a></h3>
<h4 id="引入了font-stylecolor080808background-colorffffffhiddenhttpmethodfilter-beanfont">引入了<font style="color:#080808;background-color:#ffffff;">HiddenHttpMethodFilter Bean</font><a hidden class="anchor" aria-hidden="true" href="#引入了font-stylecolor080808background-colorffffffhiddenhttpmethodfilter-beanfont">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>@ConditionalOnMissingBean(HiddenHttpMethodFilter.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>@ConditionalOnProperty(prefix = <span style="color:#0ff;font-weight:bold">&#34;spring.mvc.hiddenmethod.filter&#34;</span>, name = <span style="color:#0ff;font-weight:bold">&#34;enabled&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> OrderedHiddenHttpMethodFilter hiddenHttpMethodFilter() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> OrderedHiddenHttpMethodFilter();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个过滤器是专门处理Rest请求的。GET POST PUT DELETE请求。</p>
<h4 id="引入了font-stylecolor080808background-colorffffffformcontentfilter-beanfont">引入了<font style="color:#080808;background-color:#ffffff;">FormContentFilter Bean</font><a hidden class="anchor" aria-hidden="true" href="#引入了font-stylecolor080808background-colorffffffformcontentfilter-beanfont">#</a></h4>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Bean
</span></span><span style="display:flex;"><span>@ConditionalOnMissingBean(FormContentFilter.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>@ConditionalOnProperty(prefix = <span style="color:#0ff;font-weight:bold">&#34;spring.mvc.formcontent.filter&#34;</span>, name = <span style="color:#0ff;font-weight:bold">&#34;enabled&#34;</span>, matchIfMissing = <span style="color:#fff;font-weight:bold">true</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> OrderedFormContentFilter formContentFilter() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> OrderedFormContentFilter();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>OrderedFormContentFilter 是 Spring Boot 中用于处理 HTTP 请求的一个过滤器，特别是针对 PUT 和 DELETE 请求。这个过滤器的主要作用是在处理 PUT 和 DELETE 请求时，确保如果请求体中有表单格式的数据，这些数据会被正确解析并可用。</p>
<h3 id="webmvc自动配置生效后引入了webmvcconfigurer接口的实现类">WebMvc自动配置生效后引入了WebMvcConfigurer接口的实现类<a hidden class="anchor" aria-hidden="true" href="#webmvc自动配置生效后引入了webmvcconfigurer接口的实现类">#</a></h3>
<p>在SpringBoot框架的<code>WebMvcAutoConfiguration</code>类中提供了一个内部类：<code>WebMvcAutoConfigurationAdapter</code></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/a7fa569774a34a19895bc70f2517ee02_MD5.png"></p>
<p>SpringBoot在这个类<code>WebMvcAutoConfigurationAdapter</code>中进行了一系列的Spring MVC相关配置。</p>
<p><strong><font style="color:#DF2A3F;">我们开发中要对Spring MVC的相关配置进行修改，可以编写一个类继承</font></strong><code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;WebMvcAutoConfigurationAdatper&lt;/font&gt;**</code><strong><font style="color:#DF2A3F;">，然后重写对应的方法即可。</font></strong></p>
<p><strong><font style="color:#DF2A3F;">因此，通过对</font></strong><code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;WebMvcAutoConfigurationAdapter&lt;/font&gt;**</code><strong><font style="color:#DF2A3F;">类中的方法进行重写来</font><strong><strong><font style="color:#74B602;">修改</font></strong></strong><font style="color:#DF2A3F;">Web MVC的默认配置。</font></strong></p>
<p><strong><font style="color:#DF2A3F;"></font></strong></p>
<h4 id="关于webmvcconfigurer接口">关于<code>WebMvcConfigurer</code>接口<a hidden class="anchor" aria-hidden="true" href="#关于webmvcconfigurer接口">#</a></h4>
<p>这个接口不是SpringBoot框架提供的，是Spring MVC提供的，在Spring框架4.3版本中引入的。这个接口的作用主要是<strong>允许开发者通过实现这个接口来定制Spring MVC的行为</strong>。</p>
<p>在这个接口中提供了很多方法，需要改变Spring MVC的哪个行为，则重写对应的方法即可，下面是这个接口中所有的方法，以及每个方法对应的Spring MVC行为的解释：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> WebMvcConfigurer {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何匹配请求路径到控制器</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> configurePathMatch(PathMatchConfigurer configurer) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 的内容协商策略，以确定如何根据请求的内容类型来选择合适的处理方法或返回数据格式</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> configureContentNegotiation(ContentNegotiationConfigurer configurer) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 处理异步请求的方式</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> configureAsyncSupport(AsyncSupportConfigurer configurer) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制是否将某些静态资源请求转发WEB容器默认的Servlet处理</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 解析视图的方式，以确定如何将控制器返回的视图名称转换为实际的视图资源。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> configureViewResolvers(ViewResolverRegistry registry) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何处理 HTTP 请求和响应的数据格式，包括 JSON、XML 等内容类型的转换</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何处理控制器方法中发生的异常，并提供相应的错误处理逻辑。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> configureHandlerExceptionResolvers(List&lt;HandlerExceptionResolver&gt; resolvers) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何处理数据的格式化和解析，例如日期、数值等类型的对象的输入和输出格式。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> addFormatters(FormatterRegistry registry) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何使用拦截器来处理请求和响应，包括在请求进入控制器之前和之后执行特定的操作。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> addInterceptors(InterceptorRegistry registry) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何处理静态资源（如 CSS、JavaScript、图片等文件）的请求。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何处理跨域请求，确保应用程序可以正确地响应来自不同域名的 AJAX 请求或其他跨域请求。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> addCorsMappings(CorsRegistry registry) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于快速定义简单的 URL 到视图的映射，而无需编写完整的控制器类和方法。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> addViewControllers(ViewControllerRegistry registry) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何解析控制器方法中的参数，包括如何从请求中获取并转换参数值。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> addArgumentResolvers(List&lt;HandlerMethodArgumentResolver&gt; resolvers) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何处理控制器方法的返回值，包括如何将返回值转换为实际的 HTTP 响应。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> addReturnValueHandlers(List&lt;HandlerMethodReturnValueHandler&gt; handlers) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何处理 HTTP 请求和响应的数据格式，允许你添加或调整默认的消息转换器，以支持特定的数据格式。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> extendMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {}
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 用于定制 Spring MVC 如何处理控制器方法中抛出的异常，允许你添加额外的异常处理逻辑。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">default</span> <span style="color:#fff;font-weight:bold">void</span> extendHandlerExceptionResolvers(List&lt;HandlerExceptionResolver&gt; resolvers) {}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="webmvcconfigurer接口的实现类webmvcautoconfigurationadapter"><code>WebMvcConfigurer</code>接口的实现类<code>WebMvcAutoConfigurationAdapter</code><a hidden class="anchor" aria-hidden="true" href="#webmvcconfigurer接口的实现类webmvcautoconfigurationadapter">#</a></h4>
<p><code>WebMvcAutoConfigurationAdapter</code>是Spring Boot框架提供的，实现了Spring MVC中的<code>WebMvcConfigurer</code>接口，对Spring MVC的所有行为进行了默认的配置。</p>
<p>如果想要改变这些默认配置，应该怎么办呢？看源码：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/017e4738dcba92c437789f79b2becc2a_MD5.png"></p>
<p>可以看到，该类上有一个注解<code>@EnableConfigurationProperties({ WebMvcProperties.class, WebProperties.class })</code>，该注解负责启用配置属性。会将配置文件<code>application.properties</code>或<code>application.yml</code>中的配置传递到该类中。因此可以通过<code>application.properties</code>或<code>application.yml</code>配置文件来改变Spring Boot对SpringMVC的默认配置。<code>WebMvcProperties</code>和<code>WebProperties</code>源码如下：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/6d48000cd8e9eafe03d3072a1338c318_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/8acde3609f8f592d08ef61cd78c6b7ef_MD5.png"></p>
<p>通过以上源码得知要改变SpringBoot对SpringMVC的默认配置，需要在配置文件中使用以下前缀的配置：</p>
<ul>
<li>spring.mvc：<font style="color:rgb(44, 44, 54);">主要用于配置 Spring MVC 的相关行为，例如路径匹配、视图解析、静态资源处理等</font></li>
<li>spring.web：通常用于配置一些通用的 Web 层设置，如资源处理、安全性配置等。</li>
</ul>
<h2 id="自动配置中的静态资源处理">自动配置中的静态资源处理<a hidden class="anchor" aria-hidden="true" href="#自动配置中的静态资源处理">#</a></h2>
<p>web站点中的静态资源指的是：js、css、图片等。</p>
<h3 id="静态资源处理源码分析">静态资源处理源码分析<a hidden class="anchor" aria-hidden="true" href="#静态资源处理源码分析">#</a></h3>
<p>关于<strong>SpringBoot对静态资源处理的默认配置</strong>，查看<code>WebMvcAutoConfigurationAdapter</code>源码，核心源码如下：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/55e41c92bc6ffce2d5249841ed865058_MD5.png"></p>
<p>对以上源码进行解释：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 检查 resourceProperties 中的 addMappings 属性是否为 false。如果为 false，则表示不启用默认的静态资源映射处理。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 在application.properties配置文件中进行`spring.web.resources.add-mappings=false`配置，可以将其设置为false。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 当然，如果没有配置的话，默认值是true。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (!<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">resourceProperties</span>.<span style="color:#007f7f">isAddMappings</span>()) {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">debug</span>(<span style="color:#0ff;font-weight:bold">&#34;Default resource handling disabled&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 配置 WebJars 的静态资源处理。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// this.mvcProperties.getWebjarsPathPattern()的执行结果是：/webjars/**</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 也就是说，如果请求路径是 http://localhost:8080/webjars/** ，则自动去类路径下的 /META-INF/resources/webjars/ 目录中找静态资源。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 如果要改变这个默认的配置，需要在application.properties文件中进行这样的配置：`spring.mvc.webjars-path-pattern=...`</span>
</span></span><span style="display:flex;"><span>    addResourceHandler(registry, <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">mvcProperties</span>.<span style="color:#007f7f">getWebjarsPathPattern</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#0ff;font-weight:bold">&#34;classpath:/META-INF/resources/webjars/&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 配置普通静态资源处理</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// this.mvcProperties.getStaticPathPattern()的执行结果是：/**</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// this.resourceProperties.getStaticLocations()的执行结果是：{ &#34;classpath:/META-INF/resources/&#34;,&#34;classpath:/resources/&#34;, &#34;classpath:/static/&#34;, &#34;classpath:/public/&#34; }</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 也就是说，如果请求路径是：http://localhost:8080/**，根据控制器方法优先原则，会先去找合适的控制器方法，如果没有合适的控制器方法，静态资源处理才会生效，则自动去类路径下的/META-INF/resources/、/resources/、/static/、/public/ 4个位置找。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 如果要改变这个默认的配置，需要在application.properties中进行如下的两个配置：</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 配置URL：spring.mvc.static-path-pattern=...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 配置物理路径：spring.web.resources.static-locations=...,...,...,...</span>
</span></span><span style="display:flex;"><span>    addResourceHandler(registry, <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">mvcProperties</span>.<span style="color:#007f7f">getStaticPathPattern</span>(), (registration) -&gt; {
</span></span><span style="display:flex;"><span>        registration.<span style="color:#007f7f">addResourceLocations</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">resourceProperties</span>.<span style="color:#007f7f">getStaticLocations</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span> != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            ServletContextResource resource = <span style="color:#fff;font-weight:bold">new</span> ServletContextResource(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">servletContext</span>, SERVLET_LOCATION);
</span></span><span style="display:flex;"><span>            registration.<span style="color:#007f7f">addResourceLocations</span>(resource);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="关于webjars静态资源处理">关于WebJars静态资源处理<a hidden class="anchor" aria-hidden="true" href="#关于webjars静态资源处理">#</a></h3>
<p>默认规则是：当请求路径是<code>/webjars/**</code>，则会去<code>classpath:/META-INF/resources/webjars/</code>找。</p>
<p><strong>WebJars介绍</strong></p>
<p><font style="color:rgb(44, 44, 54);">WebJars 是一种将常用的前端库（如 jQuery、Bootstrap、Font Awesome 等）打包成 JAR 文件的形式，方便在 Java 应用程序中使用。WebJars 提供了一种标准化的方式来管理前端库，使其更容易集成到 Java 项目中，并且可以利用 Maven 的依赖管理功能。</font></p>
<p><font style="color:rgb(44, 44, 54);"></font></p>
<p><strong><font style="color:rgb(44, 44, 54);">WebJars在SpringBoot中的使用</font></strong></p>
<p><font style="color:rgb(44, 44, 54);">WebJars官网：</font><a href="https://www.webjars.org/">https://www.webjars.org/</a></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/7f9660a89be3f6e5bfd470506acfb69f_MD5.png"></p>
<p>在官网上可以找到某个webjars的maven依赖，将依赖加入到SpringBoot项目中，例如我们添加vue的依赖：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.webjars.npm<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>vue<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;version&gt;</span>3.5.12<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如下图表示加入成功：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/eafba324f9982a8d4c9b0c0f8de5ce14_MD5.png"></p>
<p>在jar包列表中也可以看到：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/08c2f71c0a0746674c4d4e6e17826a00_MD5.png"></p>
<p>在SpringBoot中，对WebJars的默认访问规则是：当请求路径是<code>/webjars/**</code>，则会去<code>classpath:/META-INF/resources/webjars/</code>找。</p>
<p>因此我们要想访问上图的<code>index.js</code>，则应该发送这样的请求路径：<code>http://localhost:8080/webjars/vue/3.5.12/index.js</code></p>
<p>启动服务器，打开浏览器，访问，测试结果如下：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/8fd538750e90d2257ba0a1f556f64b29_MD5.png"></p>
<p>和IDEA中的文件对比一下，完全一样则表示测试成功：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/8205bbde03d496978e379e1d2cd8ae8f_MD5.png"></p>
<h3 id="关于普通静态资源处理">关于普通静态资源处理<a hidden class="anchor" aria-hidden="true" href="#关于普通静态资源处理">#</a></h3>
<p>SpringBoot对普通静态资源处理的规则是：</p>
<p>当请求路径是<a href="http://localhost:8080/**">http://localhost:8080/**</a>，根据控制器方法优先原则，会先去找合适的控制器方法，如果没有合适的控制器方法，静态资源处理才会生效，则自动去类路径下的以下4个位置查找：</p>
<ul>
<li>classpath:/META-INF/resources/</li>
<li>classpath:/resources/</li>
<li>classpath:/static/</li>
<li>classpath:/public/</li>
</ul>
<p>我们可以在项目中分别创建以上4个目录，在4个目录当中放入静态资源，例如4张图片：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/fb8bf03c8f94df525feaa1982a32d0d1_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/f22d412d84ad3333291f46013f7b63c3_MD5.png"></p>
<p>然后启动服务器，打开浏览器，访问，测试是否可以正常访问图片：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/449270cb860677bb650df4eb976a338b_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/6bbe5294f761e227d8baa737efed7ac3_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/a4588eb1db92586889bf935eee9bb267_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/0d6781bb540f6e0421c0fda2d97addbf_MD5.png"></p>
<h3 id="关于静态资源缓存处理">关于静态资源缓存处理<a hidden class="anchor" aria-hidden="true" href="#关于静态资源缓存处理">#</a></h3>
<p>不管是webjars的静态资源还是普通静态资源，统一都会执行以下这个方法，这个方法最后几行代码就是关于静态资源的缓存处理方式。</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/23adcb26563b34e5ab21aa1263067c3a_MD5.png"></p>
<p><strong>什么是静态资源缓存，谁缓存，有什么用？</strong></p>
<p>静态资源缓存指的是浏览器的缓存行为，浏览器可以将静态资源（js、css、图片、声音、视频）缓存到浏览器中，只要下一次用户访问同样的静态资源直接从缓存中取，不再从服务器中获取，可以降低服务器的压力，提高用户的体验。而这个缓存策略可以在服务器端程序中进行设置，SpringBoot对静态资源缓存的默认策略就是以下这三行代码：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/b884c9cb89e1d14c98095a751e1bf895_MD5.png"></p>
<p>以上三行代码的解释如下：</p>
<ul>
<li>registration.setCachePeriod(getSeconds(this.resourceProperties.getCache().getPeriod()));
<ul>
<li>设置缓存的过期时间（如果没有指定单位，默认单位是秒）</li>
<li>浏览器会<strong>根据响应头中的缓存控制信息</strong>决定是否从本地缓存中加载资源，而不是每次都从服务器重新请求。这有助于减少网络流量和提高页面加载速度。</li>
<li>假设你配置了静态资源缓存过期时间为 1 小时（3600 秒），那么浏览器在首次请求某个静态资源后，会在接下来的一小时内从本地缓存加载该资源，而不是重新请求服务器。</li>
<li>可以通过<code>application.properties</code>的来修改默认的过期时间，例如：<code>&lt;font style=&quot;color:rgb(51, 51, 51);&quot;&gt;spring.web.resources.cache.period=3600&lt;/font&gt;</code><font style="color:rgb(51, 51, 51);">或者</font><code>&lt;font style=&quot;color:rgb(51, 51, 51);&quot;&gt;spring.web.resources.cache.period=1h&lt;/font&gt;</code></li>
</ul>
</li>
<li>registration.setCacheControl(this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());
<ul>
<li>设置静态资源的 Cache-Control HTTP 响应头，告诉浏览器如何去缓存这些资源。</li>
<li><code>&lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;Cache-Control&lt;/font&gt;</code><font style="color:rgb(44, 44, 54);"> HTTP 响应头   是HTTP响应协议的一部分内容。如下图响应协议的响应头信息中即可看到</font><code>&lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;Cache-Control&lt;/font&gt;</code><font style="color:rgb(44, 44, 54);">的字样：</font></li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/b2a14561bfcaaf8eab65e93046618304_MD5.png"></p>
<pre><code>- &lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;常见的 Cache-Control 指令包括：&lt;/font&gt;
    * &lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;max-age=&lt;seconds&gt;：表示响应在多少秒内有效。&lt;/font&gt;
    * &lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;public：表示响应可以被任何缓存机制（如代理服务器）缓存。&lt;/font&gt;
    * &lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;private：表示响应只能被用户的浏览器缓存。&lt;/font&gt;
    * &lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;no-cache：表示在使用缓存的资源之前必须重新发送一次请求进行验证。&lt;/font&gt;
    * &lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;no-store：表示不缓存任何响应的资源。&lt;/font&gt;
- 例如：max-age=3600, public：表示响应在 3600 秒内有效，并且可以被任何缓存机制缓存。
- 可以通过`spring.web.resources.cache.cachecontrol.max-age=3600`以及`spring.web.resources.cache.cachecontrol.cache-public=true`进行重新配置。
</code></pre>
<ul>
<li>registration.setUseLastModified(this.resourceProperties.getCache().isUseLastModified());
<ul>
<li>设置静态资源在响应时，是否在响应头中添加资源的最后一次修改时间。SpringBoot默认配置的是：在响应头中添加响应资源的最后一次修改时间。</li>
<li>浏览器发送请求时，会将缓存中的资源的最后修改时间和服务器端资源的最后一次修改时间进行比对，如果没有变化，仍然从缓存中获取。</li>
<li>可以通过<code>spring.web.resources.cache.use-last-modified=false</code>来进行重新配置。</li>
</ul>
</li>
</ul>
<h3 id="静态资源缓存测试">静态资源缓存测试<a hidden class="anchor" aria-hidden="true" href="#静态资源缓存测试">#</a></h3>
<p>根据之前源码分析，得知<code>静态资源缓存</code>相关的配置应该使用<code>spring.web.resources.cache</code>：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/8349aa97fb7684dad856a957a0e5636e_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/031759a2d51cf28b0a9724854fd700c9_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/aad5aa3aeccd526d8470005c65dd89a5_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/a06c6acc043cd24057101ce90de6a8b5_MD5.png"></p>
<p>在<code>application.properties</code>文件中对缓存进行如下的配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f"># 静态资源缓存设置</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 1. 缓存有效期</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.web.resources.cache.period</span>=<span style="color:#0ff;font-weight:bold">100</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 2. 缓存控制（cachecontrol配置的话，period会失效）</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.web.resources.cache.cachecontrol.max-age</span>=<span style="color:#0ff;font-weight:bold">20</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 3. 是否使用缓存的最后修改时间（默认是：使用）</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.web.resources.cache.use-last-modified</span>=<span style="color:#0ff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 4. 是否开启静态资源默认处理方式（默认是：开启）</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.web.resources.add-mappings</span>=<span style="color:#0ff;font-weight:bold">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：<code>cachecontrol.max-age</code>配置的话，<code>period</code>会被覆盖。</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/01539eb2b8c7e80594c32079a988a9f7_MD5.png"></p>
<p>启动服务器测试：看看是否在20秒内走缓存，20秒之后是不是就不走缓存了！！！</p>
<p>第一次访问：请求服务器</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/d5dc0d9024dc89e8d94de19884f9b5f5_MD5.png"></p>
<p>第二次访问：20秒内开启一个新的浏览器窗口，再次访问，发现走了缓存</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/6cb2127be03d8c9d362bbd183c2ba1d9_MD5.png"></p>
<p>第三次访问：20秒后开启一个新的浏览器窗口，再次访问，发现重新请求服务器</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/2168c0b28c4e77c5d4a7e9f77329676b_MD5.png"></p>
<p>提示，为什么显示<code>304</code>，这是因为这个配置：<code>spring.web.resources.cache.use-last-modified=true</code></p>
<h3 id="web应用的欢迎页面">web应用的欢迎页面<a hidden class="anchor" aria-hidden="true" href="#web应用的欢迎页面">#</a></h3>
<h4 id="欢迎页测试">欢迎页测试<a hidden class="anchor" aria-hidden="true" href="#欢迎页测试">#</a></h4>
<p>先说结论：只要在静态资源路径下提供<code>index.html</code>，则被当做欢迎页面。静态资源路径指的是之前的4个路径：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>{ &#34;classpath:/META-INF/resources/&#34;, &#34;classpath:/resources/&#34;, &#34;classpath:/static/&#34;, &#34;classpath:/public/&#34; }
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试一下，在<code>classpath:/static/</code>目录下新建<code>index.html</code>页面：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/e188fa250663c6fa484b706816b30e63_MD5.png"></p>
<p>启动服务器，测试结果如下：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/475e30ad76da99a9337408b4666cff64_MD5.png"></p>
<p>如果同时在4个静态资源路径下都提供<code>index.html</code>，哪个页面会被当做欢迎页呢？</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/04b6fcdb612c3e311b5066368af05d89_MD5.png"></p>
<p>启动服务器，测试结果如下：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/9127693d8120a252028542a1d0503aea_MD5.png"></p>
<p>原因是什么呢？这是因为<code>classpath:/META-INF/resources/</code>是数组的首元素，因此先从这个路径下找欢迎页。</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/3ba2e8de4077dbc10c95f4e3bcace84e_MD5.png"></p>
<h4 id="欢迎页源码分析">欢迎页源码分析<a hidden class="anchor" aria-hidden="true" href="#欢迎页源码分析">#</a></h4>
<p>在<code>WebMvcAutoConfiguration</code>类中有一个内部类<code>EnableWebMvcConfiguration</code>，这个类中有这样一段代码：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/55d42485d768ee66c4a9d03429970b0c_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/1a06a1398497858973f4d1e3689333cf_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/1ceb95c3446aaa52168ab180d3fea3f1_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/bc0baf195e998159d208f511fe1f9337_MD5.png"></p>
<p>通过以上源码追踪，得出结论：只要请求路径是<code>/**</code>的，会依次去<code>{ &quot;classpath:/META-INF/resources/&quot;, &quot;classpath:/resources/&quot;, &quot;classpath:/static/&quot;, &quot;classpath:/public/&quot; }</code>这四个位置找<code>index.html</code>页面作为欢迎页。</p>
<h4 id="一个小小的疑惑">一个小小的疑惑<a hidden class="anchor" aria-hidden="true" href="#一个小小的疑惑">#</a></h4>
<p>我们来看一下<code>WebMvcAutoConfiguration</code>的生效条件：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/1dc6b9b2d6592210e811c42d316b5f5d_MD5.png"></p>
<p>上图红框内表示，要求Spring容器中缺失<code>WebMvcConfigurationSupport</code>这个Bean，<code>WebMvcAutoConfiguration</code>才会生效。</p>
<p>但是我们来看一下<code>EnableWebMvcConfiguration</code>的继承结构：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/99cabbbca68c7a655d43e982a33f02c6_MD5.png"></p>
<p>很明显，<code>EnableWebMvcConfiguration</code>就是一个<code>WebMvcConfigurationSupport</code>这样的Bean。</p>
<p>那疑问就有了：既然容器中存在<code>WebMvcConfigurationSupport</code>这样的Bean，<code>WebMvcAutoConfiguration</code>为什么还会生效呢？</p>
<p>原因是因为：<code>EnableWebMvcConfiguration</code>是<code>WebMvcAutoConfiguration</code>类的内部类。在<code>WebMvcAutoConfiguration</code>进行加载的时候，<code>EnableWebMvcConfiguration</code>这个内部类还没有加载。因此这个时候在容器中还不存在<code>WebMvcConfigurationSupport</code>的Bean，所以<code>WebMvcAutoConfiguration</code>仍然会生效。</p>
<p><strong><font style="color:#DF2A3F;">以上所说的</font></strong><code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;WebMvcAutoConfiguration&lt;/font&gt;**</code><strong><font style="color:#DF2A3F;">类中的内部类</font></strong><code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;EnableWebMvcConfiguration&lt;/font&gt;**</code><strong><font style="color:#DF2A3F;">，是用来启用Web MVC默认配置的。</font></strong></p>
<p><strong><font style="color:#DF2A3F;"></font></strong></p>
<p><strong><font style="color:#DF2A3F;">注意区分：WebMvcAutoConfiguration的两个内部类：</font></strong></p>
<ul>
<li><code>WebMvcAutoConfigurationAdapter</code>作用是用来：修改配置的</li>
<li><code>EnableWebMvcConfiguration</code>作用是用来：启用配置的</li>
</ul>
<h4 id="favorite-icon">favorite icon<a hidden class="anchor" aria-hidden="true" href="#favorite-icon">#</a></h4>
<p>favicon（也称为“收藏夹图标”或“网站图标”）是大多数现代网页浏览器的默认行为之一。当用户访问一个网站时，浏览器通常会尝试从该网站的根目录下载名为 favicon.ico 的文件，并将其用作标签页的图标。</p>
<p>如果网站没有提供 favicon.ico 文件，浏览器可能会显示一个默认图标，或者根本不显示任何图标。为了确保良好的用户体验，网站开发者通常会在网站的根目录下放置一个 favicon.ico 文件。</p>
<p>Spring Boot项目中<code>favicon.ico</code>文件应该放在哪里呢？Spring Boot官方是这样说明的：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/ef7833fdcb824a95576f02c6039188a4_MD5.png"></p>
<p>这段话翻译为：</p>
<p>与其他静态资源一样，Spring Boot 会在配置的静态内容位置检查是否存在 <code>favicon.ico</code>文件。如果存在这样的文件，它将自动作为应用程序的 favicon 使用。</p>
<p>以上官方说明的：将<code>favicon.ico</code>文件放到静态资源路径下即可。</p>
<p>web站点没有提供<code>favicon.ico</code>时：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/7498a0b58414a0e9692025763108909a_MD5.png"></p>
<p>我们在<a href="https://www.iconfont.cn/">https://www.iconfont.cn/</a> （阿里巴巴提供的图标库）上随便找一个图标，然后将图片名字命名为<code>favicon.ico</code>，然后将其放到SpringBoot项目的静态资源路径下：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/a1c2f19734b88de707d9c7ce163537cb_MD5.png"></p>
<p>启动服务器测试：记住（ctrl + F5强行刷新一下，避免影响测试效果）</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/415b74ac9bd62b66ef45e551a9a418f0_MD5.png"></p>
<h1 id="springboot的web手动配置静态资源处理">SpringBoot的web手动配置(静态资源处理)<a hidden class="anchor" aria-hidden="true" href="#springboot的web手动配置静态资源处理">#</a></h1>
<p>如果你对SpringBoot默认的静态资源处理方式不满意。可以通过两种方式来改变这些默认的配置：</p>
<ul>
<li>第一种：配置文件方式
<ul>
<li>通过修改<code>application.properties</code>或<code>application.yml</code></li>
<li>添加<code>spring.mvc</code>和<code>spring.web</code>相关的配置。</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/d56110aab274821d124082a7c76c7df1_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/ccfa9f06f8e961d30d3bbf39d007bfec_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/b39bdffe772d5241bbd441e32e3f4770_MD5.png"></p>
<ul>
<li>第二种：编写代码方式
<ul>
<li>SpringMVC框架为我们提供了<code>WebMvcConfigurer</code>接口，需要改变默认的行为，可以<code>编写一个类</code>实现<code>WebMvcConfigurer</code>接口，并<code>对应重写</code>接口中的方法即可改变默认的配置行为。</li>
</ul>
</li>
</ul>
<h2 id="配置文件方式">配置文件方式<a hidden class="anchor" aria-hidden="true" href="#配置文件方式">#</a></h2>
<p>要修改<code>访问静态资源URL的前缀</code>，这样配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f"># Spring MVC的相关配置</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 1. 设置webjars静态资源的请求路径的前缀</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.mvc.webjars-path-pattern</span>=<span style="color:#0ff;font-weight:bold">/wjs/**</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 2. 设置普通静态资源的请求路径的前缀</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.mvc.static-path-pattern</span>=<span style="color:#0ff;font-weight:bold">/static/**</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>要修改<code>静态资源的存放位置</code>，这样配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">spring.web.resources.static-locations</span>=<span style="color:#0ff;font-weight:bold">classpath:/static1/,classpath:/static2/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>进行以上配置之后：</p>
<ol>
<li>访问webjars的请求路径应该是这样的：http://localhost:8080/wjs/&hellip;.</li>
<li>访问普通静态资源的请求路径应该是这样的：http://localhost:8080/static/&hellip;.</li>
<li>普通静态资源的存放位置也应该放到<code>classpath:/static1/,classpath:/static2/</code>下面，其他位置无效。</li>
</ol>
<p><strong>访问webjars测试结果如下：</strong></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/10536b04010570aaa2e0b6cbec368fbc_MD5.png"></p>
<p><strong>访问普通静态资源测试结果如下：</strong></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/ad39a3001d07f9919e351ba565c44cdb_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/e041ffe52f937c69ed1f3e56cd4cba46_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/0d0853dc8c8892f21a73aec0eb347320_MD5.png"></p>
<p>如果访问<code>dog2.jpg</code>，就无法访问了：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/bfde73dc31479742de6f83bc1cea78a0_MD5.png"></p>
<p>但是，存储在<code>classpath:/META-INF/resources/</code>目录下的<code>dog1.jpg</code>仍然是可以访问的：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/8295148228c37eb37f77a5b5948dbb37_MD5.png"></p>
<p>因此，存储在<code>classpath:/META-INF/resources/</code>位置的静态资源会被默认加载，不受手动配置的影响。</p>
<h2 id="编写代码方式">编写代码方式<a hidden class="anchor" aria-hidden="true" href="#编写代码方式">#</a></h2>
<p>我们在前面提到过，想要定制Spring MVC的行为，也可以编写类实现Spring MVC框架提供的一个接口<code>WebMvcConfigurer</code>，想定制哪个行为就重写哪个方法即可。</p>
<p>编写的类只要纳入IoC容器的管理。因此有以下两种实现方式：</p>
<ul>
<li>第一种：编写类实现<code>WebMvcConfigurer</code>接口，重写对应的方法。</li>
<li>第二种：以组件的形式存在：编写一个方法，用<code>@Bean</code>注解标注。</li>
</ul>
<h3 id="第一种方式">第一种方式<a hidden class="anchor" aria-hidden="true" href="#第一种方式">#</a></h3>
<p>编写配置类，对于<code>web</code>开发来说，配置类一般起名为：<code>WebConfig</code>。配置类一般存放到<code>config</code>包下，因此在SpringBoot主入口程序同级目录下新建<code>config</code>包，在<code>config</code>包下新建<code>WebConfig</code>类：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 使用该注解标注，表示该类为配置类。</span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WebConfig <span style="color:#fff;font-weight:bold">implements</span> WebMvcConfigurer {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
</span></span><span style="display:flex;"><span>        registry.<span style="color:#007f7f">addResourceHandler</span>(<span style="color:#0ff;font-weight:bold">&#34;/static/**&#34;</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">addResourceLocations</span>(<span style="color:#0ff;font-weight:bold">&#34;classpath:/static1/&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;classpath:/static2/&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：将<code>application.properties</code>文件中之前的所有配置全部注释掉。让其恢复到最原始的默认配置。</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/a1b4d97eaa76b4b5092f916e614bb20f_MD5.png"></p>
<p>启动服务器进行测试：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/679e97d9ac59dc6ef2eb479b9f8174a0_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/f86023287741f4acc9d942233e8a6f5a_MD5.png"></p>
<p>通过测试，我们的配置是生效的。</p>
<p>我们再来看看，默认的配置是否还生效？</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/224ef284b0ed920a874b4bd312725085_MD5.png"></p>
<p>我们可以看到，Spring Boot对Spring MVC的默认自动配置是生效的。</p>
<p><strong><font style="color:#DF2A3F;">因此，以上的方式只是在Spring MVC默认行为之外扩展行为。</font></strong></p>
<p><strong><font style="color:#DF2A3F;"></font></strong></p>
<p>如果你不想再继续使用SpringBoot提供的默认行为，可以使用<code>@EnableWebMvc</code>进行标注。例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@EnableWebMvc
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 使用该注解标注，表示该类为配置类。</span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WebConfig <span style="color:#fff;font-weight:bold">implements</span> WebMvcConfigurer {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
</span></span><span style="display:flex;"><span>        registry.<span style="color:#007f7f">addResourceHandler</span>(<span style="color:#0ff;font-weight:bold">&#34;/static/**&#34;</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#007f7f">addResourceLocations</span>(<span style="color:#0ff;font-weight:bold">&#34;classpath:/static1/&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;classpath:/static2/&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/116d86650fd0dac129dec6e4d1e3b9f3_MD5.png"></p>
<p>可以看到，默认配置已经不再生效。</p>
<p>再来看看，我们自己的配置是否仍然生效：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/543043509ccd8e8ffa064b181a47a52e_MD5.png"></p>
<p>仍然生效。</p>
<h3 id="第二种方式">第二种方式<a hidden class="anchor" aria-hidden="true" href="#第二种方式">#</a></h3>
<p>采用<code>@Bean</code>注解提供一个<code>WebMvcConfigurer</code>组件，代码如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WebConfig2 {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> WebMvcConfigurer addResourceHandlers(){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> WebMvcConfigurer() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
</span></span><span style="display:flex;"><span>                registry.<span style="color:#007f7f">addResourceHandler</span>(<span style="color:#0ff;font-weight:bold">&#34;/static/**&#34;</span>)
</span></span><span style="display:flex;"><span>                        .<span style="color:#007f7f">addResourceLocations</span>(<span style="color:#0ff;font-weight:bold">&#34;classpath:/static1/&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;classpath:/static2/&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果如下：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/653ff231785e1acad42a38d4b508648a_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/8dc276403bb442809175c455ccd37336_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/fe3d7d8d7968ba2dd02c9b1b874a0455_MD5.png"></p>
<p>通过了测试，并且以上代码也是在原有配置基础上进行扩展。</p>
<p>如果要弃用默认配置，仍然使用	<code>@EnableWebMvc</code>注解进行标注。自行测试！</p>
<h3 id="其他配置也这样做即可">其他配置也这样做即可<a hidden class="anchor" aria-hidden="true" href="#其他配置也这样做即可">#</a></h3>
<p>以上对<code>静态资源处理</code>进行了手动配置，也可以做其他配置，例如拦截器：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletRequest;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletResponse;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.HandlerInterceptor;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.ModelAndView;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WebConfig2 {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> WebMvcConfigurer addResourceHandlers(){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> WebMvcConfigurer() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
</span></span><span style="display:flex;"><span>                registry.<span style="color:#007f7f">addResourceHandler</span>(<span style="color:#0ff;font-weight:bold">&#34;/static/**&#34;</span>)
</span></span><span style="display:flex;"><span>                        .<span style="color:#007f7f">addResourceLocations</span>(<span style="color:#0ff;font-weight:bold">&#34;classpath:/static1/&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;classpath:/static2/&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 拦截器配置。</span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> WebMvcConfigurer addInterceptor(){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> WebMvcConfigurer() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addInterceptors(InterceptorRegistry registry) {
</span></span><span style="display:flex;"><span>                registry.<span style="color:#007f7f">addInterceptor</span>(<span style="color:#fff;font-weight:bold">new</span> HandlerInterceptor() {
</span></span><span style="display:flex;"><span>                    @Override
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>                        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Interceptor&#39;s preHandle......&#34;</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    @Override
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>                        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Interceptor&#39;s postHandle......&#34;</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    @Override
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>                        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Interceptor&#39;s afterCompletion......&#34;</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动服务器，打开浏览器，发送请求<a href="http://localhost:8080/static/dog5.jpg">http://localhost:8080/static/dog5.jpg</a>，后台执行结果如下：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/9d032270795418e3cfe5a1df63667bf4_MD5.png"></p>
<p>这说明拦截器生效。</p>
<h3 id="为什么只要容器中有webmvcconfigurer组件即可呢">为什么只要容器中有<code>WebMvcConfigurer</code>组件即可呢<a hidden class="anchor" aria-hidden="true" href="#为什么只要容器中有webmvcconfigurer组件即可呢">#</a></h3>
<p>源码分析：</p>
<p><code>WebMvcAutoConfiguration</code>部分源码：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/306fa818a60bb3df059f0b6d16d2f30e_MD5.png"></p>
<p><code>WebMvcAutoConfiguration</code>类的内部类<code>EnableWebMvcConfiguration</code>，这个类继承了<code>DelegatingWebMvcConfiguration</code>（Delegating是委派的意思。）</p>
<p><code>DelegatingWebMvcConfiguration</code>部分源码：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/00c7faf2266cbcca3f81a56ba8529ad6_MD5.png"></p>
<p><code>DelegatingWebMvcConfiguration</code>中的<code>setConfigurers()</code>方法用来设置配置。而配置参数是一个List集合，这个List集合中存放的是<code>WebMvcConfigurer</code>接口的实例，并且可以看到这个方法上面使用了<code>@Autowired</code>进行了自动注入，这也就是说为什么只要是IoC容器中的组件就能生效的原因。</p>
<p>我们再次进入到<code>this.configurers.addWebMvcConfigurers(configurers);</code>方法中进一步查看源码：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/ac2aee257c7b5d02d55a9d76a593f4eb_MD5.png"></p>
<p>对于<code>WebMvcConfigurerComposite</code>类的代码来说，它是一个非常典型的<code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;组合模式&lt;/font&gt;**</code>。</p>
<p>组合模式的关键点：</p>
<ol>
<li>组合多个 WebMvcConfigurer 实例：WebMvcConfigurerComposite 通过 delegates 列表组合了多个 WebMvcConfigurer 实例。</li>
<li>统一接口：WebMvcConfigurerComposite 实现了 WebMvcConfigurer 接口，因此可以像一个单一的 WebMvcConfigurer 一样被使用。</li>
<li>代理调用：在实现 WebMvcConfigurer 接口的方法时，WebMvcConfigurerComposite 会遍历 delegates 列表，调用每个 WebMvcConfigurer 实例的相应方法。</li>
</ol>
<p>总结：WebMvcConfigurerComposite 主要采用了组合模式的思想，将多个 WebMvcConfigurer 实例组合在一起，形成一个整体。</p>
<p>注意：组合模式是GoF 23种设计模式中的结构型设计模式。</p>
<h1 id="web请求的路径匹配">web请求的路径匹配<a hidden class="anchor" aria-hidden="true" href="#web请求的路径匹配">#</a></h1>
<p>我们在学习SpringMVC的时候，路径匹配规则中学习了<code>Ant</code>风格的路径匹配规则。大家可以翻看一下之前的Spring MVC视频。</p>
<p>在<code>Spring Boot3</code>中，对web请求的路径匹配提供了两种规则：</p>
<ul>
<li>第一种：AntPathMatcher（Ant风格）【<strong><font style="color:#DF2A3F;">较旧</font></strong>】</li>
<li>第二种：PathPatternParser（从Spring5.3中引入的。在SpringBoot2.4中引入的。）【<strong><font style="color:#DF2A3F;">较新：效率高</font></strong>】
<ul>
<li><strong><font style="color:#DF2A3F;">效率比Ant高，一般新项目中使用</font></strong><code>**&lt;font style=&quot;color:#DF2A3F;&quot;&gt;PathPatternParser&lt;/font&gt;**</code></li>
</ul>
</li>
</ul>
<p>SpringBoot3中默认使用的是<code>PathPatternParser</code>，不需要任何配置。如果要使用<code>AntPathMatcher</code>，就需要进行如下的配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">spring.mvc.pathmatch.matching-strategy</span>=<span style="color:#0ff;font-weight:bold">ant_path_matcher</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="antpathmatcher">AntPathMatcher<a hidden class="anchor" aria-hidden="true" href="#antpathmatcher">#</a></h2>
<p>Ant风格的路径匹配规则回顾：</p>
<p><strong><font style="color:#DF2A3F;">*</font></strong>	匹配任意长度的任意字符序列（不包括路径分隔符）。示例：/foo/*.html 匹配 /foo/bar.html 和 /foo/baz.html。</p>
<p><strong><font style="color:#DF2A3F;"></strong></font>**	匹配任意数量的目录层级。示例：/foo/** 匹配 /foo/bar、/foo/bar/baz 和 /foo/bar/baz/qux。</p>
<p><strong><font style="color:#DF2A3F;">?</font></strong>**	<strong>匹配</strong>任意单个字符**。示例：/foo?bar 匹配 /foobar 和 /fooxbar。</p>
<p><strong><font style="color:#DF2A3F;">[]</font></strong>**	**匹配指定范围内的单个字符。示例：/foo[a-z]bar 匹配 /fooabar、/foobbar 等。</p>
<p><strong><font style="color:#DF2A3F;">{}</font></strong>**	**路径变量，用于提取路径的一部分作为参数。示例：/users/{userId} 匹配 /users/123，提取 userId=123。</p>
<p>如果在SpringBoot3中启用Ant风格，记得配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">spring.mvc.pathmatch.matching-strategy</span>=<span style="color:#0ff;font-weight:bold">ant_path_matcher</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如下代码：请分析以下路径匹配的是什么样的路径。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletRequest;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.PathVariable;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> PathController {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/{path:[a-z]+}/a?/**/*.do&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String path(HttpServletRequest request, @PathVariable String path){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> request.<span style="color:#007f7f">getRequestURI</span>() + <span style="color:#0ff;font-weight:bold">&#34;,&#34;</span> + path;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动服务器并测试路径：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/e53fc26999f404721f8ca6ef4adc883f_MD5.png"></p>
<h2 id="pathpatternparser">PathPatternParser<a hidden class="anchor" aria-hidden="true" href="#pathpatternparser">#</a></h2>
<p>项目中不做配置，或者按照以下方式配置，都是<code>PathPatternParser</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">spring.mvc.pathmatch.matching-strategy</span>=<span style="color:#0ff;font-weight:bold">path_pattern_parser</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>PathPatternParser</code>风格是兼容Ant风格的。只有一个地方<code>PathPatternParser</code>不支持，Ant支持。在Ant风格中，<code>**</code>可以出现在任意位置。在<code>PathPatternParser</code>中只允许<code>**</code>出现在路径的末尾。</p>
<p>可以测试一下，将配置文件中的Ant风格注释掉，采用<code>PathPatternParser</code>风格。然后控制器代码如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> jakarta.servlet.http.HttpServletRequest;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.PathVariable;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> PathController {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/{path:[a-z]+}/a?/**/*.do&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String path(HttpServletRequest request, @PathVariable String path){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> request.<span style="color:#007f7f">getRequestURI</span>() + <span style="color:#0ff;font-weight:bold">&#34;,&#34;</span> + path;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动服务器报错：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/75e0cd24994e8093d6696c26e63c1e49_MD5.png"></p>
<p>提示你，如果在路径当中出现了<code>**</code>，需要将路径匹配规则替换为Ant风格。因此路径当中如果出现<code>**</code>，那么必须使用Ant风格。除此之外，<code>PathPatternParser</code>均可用。</p>
<p>我们再来测试一下，<code>**</code>放到末尾，对于<code>PathPatternParser</code>是否可用？</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/{path:[a-z]+}/a?/*.do/**&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> String path(HttpServletRequest request, @PathVariable String path){
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> request.<span style="color:#007f7f">getRequestURI</span>() + <span style="color:#0ff;font-weight:bold">&#34;,&#34;</span> + path;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动服务器测试，可用：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/b1eda5f268e6e1f5839cfea2647b8cdc_MD5.png"></p>
<h2 id="路径匹配相关源码">路径匹配相关源码<a hidden class="anchor" aria-hidden="true" href="#路径匹配相关源码">#</a></h2>
<p>底层选择路径匹配规则的源码是：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/bad3282f32099d2f037fcf9173f35ec7_MD5.png"></p>
<h1 id="内容协商">内容协商<a hidden class="anchor" aria-hidden="true" href="#内容协商">#</a></h1>
<p>内容协商机制是Spring MVC框架提供的，接下来主要是学习在SpringBoot中是如何支持SpringMVC内容协商机制的。</p>
<h2 id="对内容协商的理解">对内容协商的理解<a hidden class="anchor" aria-hidden="true" href="#对内容协商的理解">#</a></h2>
<p>内容协商机制是指服务器根据客户端的请求来决定返回资源的最佳表示形式。</p>
<p>白话文描述：客户端要什么格式的数据，咱后端就应该返回什么格式的数据。</p>
<ul>
<li>客户端要JSON，咱就响应JSON。</li>
<li>客户端要XML，咱就响应XML。</li>
<li>客户端要YAML，咱就响应YAML。</li>
</ul>
<p>你可能会有疑问：客户端接收数据时统一采用一种格式，例如JSON，不就行了吗。哪那么多事儿呀！！！</p>
<p>但在实际的开发中，不是这样的，例如：</p>
<ul>
<li>遗留的老客户端系统，仍然处理的是XML格式的数据。</li>
<li>要求处理速度快的这种客户端系统，一般要求返回JSON格式的数据。</li>
<li>要求安全性高的客户端系统，一般要求返回XML格式的数据。</li>
</ul>
<p>因此，在现代的开发中，不同的客户端可能需要后端系统返回不同格式的数据。总之后端应该满足这种多样化的需求。</p>
<h2 id="实现内容协商的两种方式">实现内容协商的两种方式<a hidden class="anchor" aria-hidden="true" href="#实现内容协商的两种方式">#</a></h2>
<p>通常通过HTTP请求头（如 Accept）或请求参数（如 format）来指定客户端偏好接收的内容类型（如JSON、XML等）。服务器会根据这些信息选择最合适的格式进行响应。</p>
<h3 id="通过http请求头如-accept">通过HTTP请求头（如 Accept）<a hidden class="anchor" aria-hidden="true" href="#通过http请求头如-accept">#</a></h3>
<p>SpringBoot框架中，在程序员不做任何配置的情况下，优先考虑的是这种方式。</p>
<p>服务器会根据客户端发送请求时提交的请求头中的&quot;Accept: application/json&quot; 或 &ldquo;Accept: application/xml&rdquo; 或 &ldquo;Accept: text/html&quot;来决定响应什么格式的数据。</p>
<p>客户端发送请求给服务器的时候，如何设置请求头的<code>Accept</code>？有以下几种常见实现方式：</p>
<ul>
<li>写代码
<ul>
<li>fetch API</li>
<li>ajax的XMLHttpRequest</li>
<li>axios库</li>
<li>jQuery库&hellip;&hellip;</li>
</ul>
</li>
<li>用工具
<ul>
<li>接口测试工具，例如：Postman、Apifox等。</li>
<li>命令行工具：curl</li>
</ul>
</li>
</ul>
<p>对于我们编写的以下Controller来说：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.powernode.springboot.bean.User;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.powernode.springboot.service.UserService;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserController {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(value = <span style="color:#0ff;font-weight:bold">&#34;/detail&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> User detail(){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> userService.<span style="color:#007f7f">getUser</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们使用了<code>@RestController</code>，也就是使用了<code>@ResponseBody</code>。因此默认支持的是返回JSON数据。怎么才能支持返回XML格式的数据呢？需要做以下两步：</p>
<p>第一步：引入一个依赖</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;groupId&gt;</span>com.fasterxml.jackson.dataformat<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;artifactId&gt;</span>jackson-dataformat-xml<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>第二步：在实体类上添加一个注解</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.bean;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.dataformat.xml.annotation.JacksonXmlRootElement;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.AllArgsConstructor;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.Data;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> lombok.NoArgsConstructor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@JacksonXmlRootElement
</span></span><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span>@NoArgsConstructor
</span></span><span style="display:flex;"><span>@AllArgsConstructor
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> User {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String password;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来，我们使用<code>curl</code>命令行工具，来模拟发送请求，并在请求头中设置<code>Accept</code>：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/d448e437e9a26df4c839aaa0129dd151_MD5.png"></p>
<p>可以很清楚的看到，服务器根据不同的请求头返回了不同格式的数据。</p>
<ul>
<li><code>Accept: application/xml</code>则返回XML格式的数据</li>
<li><code>Accept: application/json</code>则返回JSON格式的数据</li>
</ul>
<h3 id="font-stylecolorrgb44-44-54通过请求参数如-fontfont-stylecolorrgb44-44-54formatfontfont-stylecolorrgb44-44-54font"><font style="color:rgb(44, 44, 54);">通过请求参数（如 </font><code>&lt;font style=&quot;color:rgb(44, 44, 54);&quot;&gt;format&lt;/font&gt;</code><font style="color:rgb(44, 44, 54);">）</font><a hidden class="anchor" aria-hidden="true" href="#font-stylecolorrgb44-44-54通过请求参数如-fontfont-stylecolorrgb44-44-54formatfontfont-stylecolorrgb44-44-54font">#</a></h3>
<p>接下来我们使用请求参数的方式，来测试一下服务器的响应，注意：默认的请求参数名为<code>format</code>。</p>
<p>我们仍然使用<code>curl</code>命令行工具进行测试：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/80e543a84feaffa8a1ce1058d4585ee6_MD5.png"></p>
<p>我们可以看到，并没有达到我们想要的效果，这是因为<code>SpringBoot优先考虑的不是通过请求参数format方式</code>。如何优先考虑使用<code>format</code>方式呢？做如下配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f"># 内容协商时，优先考虑请求参数format方式。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.mvc.contentnegotiation.favor-parameter</span>=<span style="color:#0ff;font-weight:bold">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>再次测试：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/685bb6818c38225059e8242a29f6e1c5_MD5.png"></p>
<p>可以看到，现在SpringBoot已经优先考虑使用<code>请求参数format</code>方式了。</p>
<p>当然，请求参数的名字可以不使用<code>format</code>吗？支持定制化吗？答案是支持的，例如你希望请求参数的名字为<code>type</code>，可以做如下配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f"># 内容协商时，设置请求参数的名字，默认为format</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.mvc.contentnegotiation.parameter-name</span>=<span style="color:#0ff;font-weight:bold">type</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>再次使用<code>curl</code>工具进行测试：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/2e87496bb962d5ceb3808230d6cea2ec_MD5.png"></p>
<h2 id="httpmessageconverter接口">HttpMessageConverter接口<a hidden class="anchor" aria-hidden="true" href="#httpmessageconverter接口">#</a></h2>
<h3 id="httpmessageconverter的理解">HttpMessageConverter的理解<a hidden class="anchor" aria-hidden="true" href="#httpmessageconverter的理解">#</a></h3>
<p><code>HttpMessageConverter</code>接口，对于这个接口来说，大家应该不陌生，在Spring MVC的课程当中咱们已经详细的学习过了。在这里简单回顾一下。</p>
<p><code>HttpMessageConverter</code>接口被翻译为：<code>Http消息转换器</code>。它起到转换<code>Http消息</code>的作用。</p>
<p>什么是<code>Http消息</code>？所谓的<code>Http消息</code>本质上就是浏览器向服务器发送请求时提交的数据，或者服务器向浏览器响应的数据。</p>
<p>而<code>HttpMessageConverter</code>接口就是负责完成<code>请求/响应</code>时的数据格式转换的。</p>
<p>在Spring MVC中提供了很多<code>HttpMessageConverter</code>接口的实现类，不同的<code>Http消息转换器</code>具有不同的转换效果，有的负责将Java对象转换为JSON格式的字符串，有的负责将Java对象转换成XML格式的字符串。</p>
<h3 id="常见的httpmessageconverter">常见的HttpMessageConverter<a hidden class="anchor" aria-hidden="true" href="#常见的httpmessageconverter">#</a></h3>
<p>内置的常见的<code>HttpMessageConverter</code>的实现类包括：</p>
<ul>
<li><font style="color:#DF2A3F;">【请求】提交的表单（form）数据转换成Java对象的主要任务是由 FormHttpMessageConverter 消息转换器完成的</font></li>
<li><font style="color:#DF2A3F;">【请求】提交的JSON数据转换成Java对象的主要任务是由 MappingJackson2HttpMessageConverter 消息转换器完成的。（我们通常使用的</font><code>&lt;font style=&quot;color:#DF2A3F;&quot;&gt;@RequestBody&lt;/font&gt;</code><font style="color:#DF2A3F;">注解）</font></li>
<li>【响应】将Java对象转换成JSON格式的数据，并将其写入HTTP响应体的任务是由 MappingJackson2HttpMessageConverter 消息转换器完成。（我们通常使用的<code>@ResponseBody</code>注解)</li>
<li>【响应】将Java对象转换成XML格式的数据，并将其写入HTTP响应体的任务通常由 Jaxb2RootElementHttpMessageConverter 消息转换器完成。</li>
<li>【响应】将 String 直接写入到响应体的任务是由 StringHttpMessageConverter 消息转换器完成。</li>
<li>&hellip;&hellip;</li>
</ul>
<h3 id="请求时通过哪些条件确定使用哪个转换器">请求时通过哪些条件确定使用哪个转换器<a hidden class="anchor" aria-hidden="true" href="#请求时通过哪些条件确定使用哪个转换器">#</a></h3>
<p>请求时通常根据以下条件来确定使用哪个消息转换器：</p>
<ol>
<li>请求的 Content-Type 字段：</li>
</ol>
<p>Spring MVC 会检查请求的 Content-Type 字段，以确定请求体的数据格式（例如 application/json、application/x-www-form-urlencoded、application/xml 等）。</p>
<ol start="2">
<li>方法参数类型：</li>
</ol>
<p>控制器方法中接收请求体的参数类型（例如 @RequestBody）。</p>
<h3 id="响应时通过哪些条件确定使用哪个转换器">响应时通过哪些条件确定使用哪个转换器<a hidden class="anchor" aria-hidden="true" href="#响应时通过哪些条件确定使用哪个转换器">#</a></h3>
<p>响应时通常根据以下条件来确定使用哪个消息转换器：</p>
<ol>
<li>请求提交时，请求头上的Accept字段 ：</li>
</ol>
<p>Spring MVC 会检查客户端请求的 Accept 字段，以确定客户端期望的响应格式（例如 application/json、application/xml 等）。</p>
<ol start="2">
<li>方法返回值类型：</li>
</ol>
<p>控制器方法的返回值类型（例如 @ResponseBody）。</p>
<p>例如1：@ResponseBody + 控制器方法的返回值是String，则使用StringHttpMessageConverter转换器。（将字符串直接写入响应体）</p>
<p>例如2：@ResponseBody + 控制器方法的返回值是User，则使用MappingJackson2HttpMessageConverter转换器。（将java对象转换成json格式的字符串写入到响应体）</p>
<h3 id="系统默认提供了哪些httpmessageconverter">系统默认提供了哪些HttpMessageConverter<a hidden class="anchor" aria-hidden="true" href="#系统默认提供了哪些httpmessageconverter">#</a></h3>
<p>查看源码：</p>
<p>WebMvcAutoConfiguration.EnableWebMvcConfiguration extends DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport</p>
<p><code>WebMvcAutoConfiguration</code>内部类<code>EnableWebMvcConfiguration</code></p>
<p><code>EnableWebMvcConfiguration</code>继承了<code>DelegatingWebMvcConfiguration</code></p>
<p><code>DelegatingWebMvcConfiguration</code>继承了<code>WebMvcConfigurationSupport</code></p>
<p>在<code>WebMvcConfigurationSupport</code>类中有这样一个方法：<code>addDefaultHttpMessageConverters()</code> 用来添加默认的<code>HttpMessageConverter</code>对象。</p>
<p>通过断点调试，可以发现默认支持6个HttpMessageConverter，如下：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/7b44e029f9d8db68029567056aa2da0a_MD5.png"></p>
<p>这6个<code>HttpMessageConverter</code>作用如下：</p>
<ol>
<li><strong>ByteArrayHttpMessageConverter:</strong></li>
</ol>
<p>用于将字节数组(byte[])与HTTP消息体之间进行转换。这通常用于处理二进制数据，如图片或文件。</p>
<ol start="2">
<li><strong>StringHttpMessageConverter:</strong></li>
</ol>
<p>用于将字符串(String)与HTTP消息体之间进行转换。它支持多种字符集编码，能够处理纯文本内容。</p>
<ol start="3">
<li><strong>ResourceHttpMessageConverter:</strong></li>
</ol>
<p>用于将Spring的Resource对象与HTTP消息体之间进行转换。Resource是Spring中表示资源的接口，可以读取文件等资源。这个转换器对于下载文件或发送静态资源有用。</p>
<ol start="4">
<li><strong>ResourceRegionHttpMessageConverter:</strong></li>
</ol>
<p>用于处理资源的部分内容（即“Range”请求），特别是当客户端请求大文件的一部分时。这对于实现视频流媒体等功能很有用。</p>
<ol start="5">
<li><strong>AllEncompassingFormHttpMessageConverter:</strong></li>
</ol>
<p>用于处理表单，是一个比较全面的form消息转换器。处理标准的application/x-www-form-urlencoded格式的数据，以及包含文件上传的multipart/form-data格式的数据。</p>
<ol start="6">
<li><strong>MappingJackson2HttpMessageConverter:</strong></li>
</ol>
<p>使用Jackson库来序列化和反序列化JSON数据。可以将Java对象转换为JSON格式的字符串，反之亦然。</p>
<p>另外，通过以下源码，也可以看到SpringBoot是根据类路径中是否存在某个类，而决定是否添加对应的消息转换器的：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/fd28c39709ab7ba0f6ddc94acaa54948_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/432207deab8e71953f98ce39c1c338d4_MD5.png"></p>
<p>因此，我们只要引入相关的依赖，让类路径存在某个类，则对应的消息转换器就会被加载。</p>
<h2 id="定义自己的httpmessageconverter">定义自己的HttpMessageConverter<a hidden class="anchor" aria-hidden="true" href="#定义自己的httpmessageconverter">#</a></h2>
<p>可以看到以上6个消息转换器中没有yaml相关的消息转换器，可见，如果要实现yaml格式的内容协商，yaml格式的消息转换器就需要我们自定义了。</p>
<h3 id="第一步引入能够处理yaml格式的依赖">第一步：引入能够处理yaml格式的依赖<a hidden class="anchor" aria-hidden="true" href="#第一步引入能够处理yaml格式的依赖">#</a></h3>
<p>任何一个能够处理yaml格式数据的库都可以，这里选择使用<code>jackson</code>的库，因为它既可以处理json，xml，又可以处理yaml。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;groupId&gt;</span>com.fasterxml.jackson.dataformat<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;artifactId&gt;</span>jackson-dataformat-yaml<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>编写测试程序，简单测试一下这个库的用法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.core.JsonProcessingException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.databind.ObjectMapper;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.dataformat.yaml.YAMLFactory;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.dataformat.yaml.YAMLGenerator;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.powernode.springboot.bean.User;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Jackson2YamlTest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JsonProcessingException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 创建YAML工厂类</span>
</span></span><span style="display:flex;"><span>        YAMLFactory yamlFactory = <span style="color:#fff;font-weight:bold">new</span> YAMLFactory().<span style="color:#007f7f">disable</span>(YAMLGenerator.<span style="color:#007f7f">Feature</span>.<span style="color:#007f7f">WRITE_DOC_START_MARKER</span>); <span style="color:#007f7f">// 禁止使用文档头标记</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 创建对象映射器</span>
</span></span><span style="display:flex;"><span>        ObjectMapper objectMapper = <span style="color:#fff;font-weight:bold">new</span> ObjectMapper(yamlFactory);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 准备数据</span>
</span></span><span style="display:flex;"><span>        User user = <span style="color:#fff;font-weight:bold">new</span> User(<span style="color:#0ff;font-weight:bold">&#34;jackson&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;jack123&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 将数据转换成YAML格式</span>
</span></span><span style="display:flex;"><span>        String s = objectMapper.<span style="color:#007f7f">writeValueAsString</span>(user);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(s);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行结果如下：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/5bdc3ba32e3a89ae318de5093a40fccd_MD5.png"></p>
<h3 id="第二步新增一种媒体类型yaml">第二步：新增一种媒体类型yaml<a hidden class="anchor" aria-hidden="true" href="#第二步新增一种媒体类型yaml">#</a></h3>
<p>默认支持xml和json两种媒体类型，要支持yaml格式的，需要新增一个yaml媒体类型，在springboot的配置文件中进行如下配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">spring.mvc.contentnegotiation.media-types.yaml</span>=<span style="color:#0ff;font-weight:bold">text/yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意，以上<code>types</code>后面的<code>yaml</code>是媒体类型的名字，名字随意，如果媒体类型起名为<code>xyz</code>，那么发送请求时的路径应该是这样的：http://localhost:8080/detail?format=xyz</p>
<h3 id="第三步自定义httpmessageconverter">第三步：自定义HttpMessageConverter<a hidden class="anchor" aria-hidden="true" href="#第三步自定义httpmessageconverter">#</a></h3>
<p>编写类<code>YamlHttpMessageConverter</code>继承<code>AbstractHttpMessageConverter</code>，代码如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.databind.ObjectMapper;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.dataformat.yaml.YAMLFactory;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.dataformat.yaml.YAMLGenerator;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.powernode.springboot.bean.User;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.http.HttpInputMessage;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.http.HttpOutputMessage;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.http.MediaType;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.http.converter.AbstractHttpMessageConverter;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.http.converter.HttpMessageNotReadableException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.http.converter.HttpMessageNotWritableException;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.nio.charset.Charset;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> YamlHttpMessageConverter <span style="color:#fff;font-weight:bold">extends</span> AbstractHttpMessageConverter&lt;Object&gt; {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> ObjectMapper objectMapper = <span style="color:#fff;font-weight:bold">new</span> ObjectMapper(<span style="color:#fff;font-weight:bold">new</span> YAMLFactory().<span style="color:#007f7f">disable</span>(YAMLGenerator.<span style="color:#007f7f">Feature</span>.<span style="color:#007f7f">WRITE_DOC_START_MARKER</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> YamlHttpMessageConverter() {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 让 消息转换器 和 媒体类型 application/yaml 绑定在一起。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(<span style="color:#fff;font-weight:bold">new</span> MediaType(<span style="color:#0ff;font-weight:bold">&#34;text&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;yaml&#34;</span>, Charset.<span style="color:#007f7f">forName</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>)));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">boolean</span> supports(Class&lt;?&gt; clazz) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 表示User类型的数据支持yaml，其他类型不支持</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> User.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">isAssignableFrom</span>(clazz);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 处理 @RequestBody（将提交的yaml格式数据转换为java对象）</span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> Object readInternal(Class&lt;?&gt; clazz, HttpInputMessage inputMessage) <span style="color:#fff;font-weight:bold">throws</span> IOException, HttpMessageNotReadableException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 处理 @ResponseBody（将java对象转换为yaml格式的数据）</span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> writeInternal(Object o, HttpOutputMessage outputMessage) <span style="color:#fff;font-weight:bold">throws</span> IOException, HttpMessageNotWritableException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">objectMapper</span>.<span style="color:#007f7f">writeValue</span>(outputMessage.<span style="color:#007f7f">getBody</span>(), o);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 注意：spring框架会自动关闭输出流，无需程序员手动释放。</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="第四步配置消息转换器">第四步：配置消息转换器<a hidden class="anchor" aria-hidden="true" href="#第四步配置消息转换器">#</a></h3>
<p>重写<code>WebMvcConfigurer</code>接口的<code>configureMessageConverters</code>方法：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.http.converter.HttpMessageConverter;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.List;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WebConfig <span style="color:#fff;font-weight:bold">implements</span> WebMvcConfigurer {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
</span></span><span style="display:flex;"><span>        converters.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> YamlHttpMessageConverter());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动服务器并测试：http://localhost:8080/detail?type=yaml</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/c58824294141987381b0d20e73e8933a_MD5.png"></p>
<h1 id="springboot整合thymeleaf">SpringBoot整合Thymeleaf<a hidden class="anchor" aria-hidden="true" href="#springboot整合thymeleaf">#</a></h1>
<h2 id="传统web应用和前后端分离">传统web应用和前后端分离<a hidden class="anchor" aria-hidden="true" href="#传统web应用和前后端分离">#</a></h2>
<p>如果你是做前后端分离的项目，这一章节的内容将用不上。</p>
<p>现代开发大部分应用都会采用前后端分离的方式进行开发，前端是一个独立的系统，后端也是一个独立的系统，后端系统只给前端系统提供数据（JSON数据），不需要后端解析模板页面，前端系统拿到后端提供的数据之后，前端负责填充数据即可。因此这一章节内容作为了解。</p>
<p>传统的WEB应用（非前后端分离）：浏览器页面上展示成什么效果，后端服务器说了算，这是传统web应用最大的特点。</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/de70f8a96f8f1476c37a0b5a5428ae34_MD5.png"></p>
<p>前后端分离的应用：前端是一个独立的系统，后端也是一个独立的系统，后端系统不再负责页面的渲染，后端系统只负责给前端系统提供开放的API接口，后端系统只负责数据的收集，然后将数据以JSON/XML等格式响应给前端系统。前端系统拿到接口返回的数据后，将数据填充到页面上。</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/5dd50a9573c564625691c0ec7790a2bf_MD5.png"></p>
<p>前后端分离的好处：</p>
<ul>
<li>职责清晰：前端专注于用户界面和用户体验，后端专注于业务逻辑和数据处理。</li>
<li>开发效率高：前后端可以并行开发，互不影响，提高开发速度。</li>
<li>可维护性强：代码结构更清晰，便于维护和扩展。</li>
<li>技术栈灵活：前后端可以独立选择最适合的技术栈。</li>
<li>响应式设计：前端可以更好地处理不同设备和屏幕尺寸。</li>
<li>性能优化：前后端可以独立优化，提升整体性能。</li>
<li>易于测试：前后端接口明确，便于单元测试和集成测试。</li>
</ul>
<h2 id="springboot整合thymeleaf-1">SpringBoot整合Thymeleaf<a hidden class="anchor" aria-hidden="true" href="#springboot整合thymeleaf-1">#</a></h2>
<p>Java的模板技术有很多，SpringBoot支持以下的模板技术：</p>
<ol>
<li><strong>Thymeleaf</strong>：
<ul>
<li><strong>特点</strong>：Thymeleaf 是一个现代的服务器端Java模板引擎，它支持HTML5，XML，TEXT，JAVASCRIPT，CSS等多种模板类型。它能够在浏览器中预览，这使得前端开发更加便捷。Thymeleaf 提供了一套强大的表达式语言，可以轻松地处理数据绑定、条件判断、循环等。</li>
<li><strong>优势</strong>：<strong><font style="color:#DF2A3F;">与Spring框架集成良好，也是SpringBoot官方推荐的</font></strong>。</li>
</ul>
</li>
<li><strong>FreeMarker</strong>：
<ul>
<li><strong>特点</strong>：FreeMarker 是一个用Java编写的模板引擎，主要用来生成文本输出，如HTML网页、邮件、配置文件等。它不依赖于Servlet容器，可以在任何环境中运行。</li>
<li><strong>优势</strong>：模板语法丰富，灵活性高，支持宏和函数定义，非常适合需要大量定制化的项目。</li>
</ul>
</li>
<li><strong>Velocity</strong>：
<ul>
<li><strong>特点</strong>：Velocity 是另一个强大的模板引擎，最初设计用于与Java一起工作，但也可以与其他技术结合使用。它提供了简洁的模板语言，易于学习和使用。</li>
<li><strong>优势</strong>：轻量级，性能优秀，特别适合需要快速生成静态内容的应用。</li>
</ul>
</li>
<li><strong>Mustache</strong>：
<ul>
<li><strong>特点</strong>：Mustache 是一种逻辑无感知的模板语言，可以用于多种编程语言，包括Java。它的设计理念是让模板保持简单，避免模板中出现复杂的逻辑。</li>
<li><strong>优势</strong>：逻辑无感知，确保模板的简洁性和可维护性，易于与前后端开发人员协作。</li>
</ul>
</li>
<li><strong>Groovy Templates</strong>：
<ul>
<li><strong>特点</strong>：Groovy 是一种基于JVM的动态语言，它可以作为模板引擎使用。Groovy Templates 提供了非常灵活的模板编写方式，可以直接嵌入Groovy代码。</li>
<li><strong>优势</strong>：对于熟悉Groovy语言的开发者来说，使用起来非常方便，可以快速实现复杂逻辑。</li>
</ul>
</li>
</ol>
<p>这些模板技术各有千秋，选择哪一种取决于项目的具体需求和个人偏好。Spring Boot 对这些模板引擎都提供了良好的支持，通常只需要在项目中添加相应的依赖，然后按照官方文档配置即可开始使用。</p>
<p><font style="color:#DF2A3F;">提醒：SpringBoot内嵌了Servlet容器（例如：Tomcat、Jetty等），使用SpringBoot不太适合使用JSP模板技术，因为SpringBoot项目最终打成jar包之后，放在jar包中的jsp文件不能被Servlet容器解析。</font></p>
<p>要在SpringBoot中整合Thymeleaf，按照以下步骤操作：</p>
<p>第一步：引入thymeleaf启动器</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>第二步：编写配置文件，指定前缀和后缀（<strong><font style="color:#DF2A3F;">默认不配置就是以下配置</font></strong>）</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">spring.thymeleaf.prefix</span>=<span style="color:#0ff;font-weight:bold">classpath:/templates/</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.thymeleaf.suffix</span>=<span style="color:#0ff;font-weight:bold">.html</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>第三步：编写控制器</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Controller;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.ui.Model;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.RequestParam;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 不能使用 @RestController</span>
</span></span><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HelloController {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/h&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String helloThymeleaf(@RequestParam(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>) String name, Model model) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 将接收到的name数据存储到域对象中</span>
</span></span><span style="display:flex;"><span>        model.<span style="color:#007f7f">addAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>, name);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 逻辑视图名</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>; <span style="color:#007f7f">// 最终的物理视图名：classpath:/templates/hello.html</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>第四步：编写thymeleaf模板页面</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">html</span> <span style="color:#007f7f">lang</span>=<span style="color:#0ff;font-weight:bold">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">meta</span> <span style="color:#007f7f">charset</span>=<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">title</span>&gt;hello, thymeleaf&lt;/<span style="font-weight:bold">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">h1</span>&gt;hello,&lt;<span style="font-weight:bold">span</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${name}&#34;</span>&gt;&lt;/<span style="font-weight:bold">span</span>&gt;&lt;/<span style="font-weight:bold">h1</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">html</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动服务器，测试地址为：http://localhost:8080/h</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/57f41e312e0237ece8ea73595fc996f9_MD5.png"></p>
<h2 id="thymeleaf的自动配置">Thymeleaf的自动配置<a hidden class="anchor" aria-hidden="true" href="#thymeleaf的自动配置">#</a></h2>
<p>Thymeleaf的自动配置类：<code>ThymeleafAutoConfiguration</code></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/6584a1339cd0f40cad6c730218b2b64c_MD5.png"></p>
<p>我们通过查看上图中红框中的类，可以找到thymeleaf的相关配置：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/94f95ee47c1be496e08bf1b239d12542_MD5.png"></p>
<p>与thymeleaf相关的配置统一使用<code>spring.thymeleaf</code>即可。并且通过源码可以进一步了解到默认的前缀和后缀：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/6525a7abe697e283dc532e5e24f190fd_MD5.png"></p>
<p>也就是说，默认情况下，只要放在<code>classpath:/templates/</code>目录下的<code>xxx.html</code>会被自动当做为thymeleaf的模板文件被thymeleaf模板引擎解析。因此放在<code>classpath:/templates/</code>目录下的<code>html</code>文件不是静态页面，而是动态的thymeleaf模板页面。</p>
<h2 id="thymeleaf核心语法">Thymeleaf核心语法<a hidden class="anchor" aria-hidden="true" href="#thymeleaf核心语法">#</a></h2>
<h3 id="thtext-替换标签体内容">th:text 替换标签体内容<a hidden class="anchor" aria-hidden="true" href="#thtext-替换标签体内容">#</a></h3>
<p>注意：在根标签<html>中引入 xmlns:th=&quot;<a href="http://www.thymeleaf.org\"">http://www.thymeleaf.org&rdquo;</a>，在编写<code>th:</code>语法时有智能提示。</p>
<p><code>th:text</code>用来替换标签体内容的，例如：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>th:text 语法：替换标签体中的内容
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${name}&#34;</span>&gt;我是一个DIV&lt;/<span style="font-weight:bold">div</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行效果：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/cd830170f82501b81e042c33b6ff2d3a_MD5.png"></p>
<p>提示：标签体中的内容即使是一段HTML代码，也只是会被当做普通文本对待。例如我们让存储在域中的文本内容是一段HTML代码：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>model.<span style="color:#007f7f">addAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;htmlCode&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;&lt;a href=&#39;http://www.bjpowernode.com&#39;&gt;动力节点&lt;/a&gt;&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${htmlCode}&#34;</span>&gt;我是一个DIV&lt;/<span style="font-weight:bold">div</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/db3585a22151397db043cda37184924f_MD5.png"></p>
<h3 id="thutext-替换标签体内容">th:utext 替换标签体内容<a hidden class="anchor" aria-hidden="true" href="#thutext-替换标签体内容">#</a></h3>
<p>作用和 <code>th:text</code>一样。只不过<code>th:utext</code>会将内容当做一段HTML代码解析并替换。将以上测试代码修改为：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>th:utext 语法：替换标签体中的内容
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">th:utext</span>=<span style="color:#0ff;font-weight:bold">&#34;${htmlCode}&#34;</span>&gt;我是一个DIV&lt;/<span style="font-weight:bold">div</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/3c3456f6d02fcbe088ea782a6e703a6d_MD5.png"></p>
<h3 id="th任意属性名-动态替换该属性的值">th:任意属性名 动态替换该属性的值<a hidden class="anchor" aria-hidden="true" href="#th任意属性名-动态替换该属性的值">#</a></h3>
<p>例如：我们向域中存储以下数据</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 向域中存储一个html标签的某个属性的值</span>
</span></span><span style="display:flex;"><span>model.<span style="color:#007f7f">addAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;company&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;动力节点&#34;</span>);
</span></span><span style="display:flex;"><span>model.<span style="color:#007f7f">addAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;hrefValue&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;http://www.bjpowernode.com&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后使用<code>th:href</code>动态替换<code>href</code>属性的值：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>th:任意属性名 语法：动态替换属性值
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">a</span> <span style="color:#007f7f">th:href</span>=<span style="color:#0ff;font-weight:bold">&#34;${hrefValue}&#34;</span> <span style="color:#007f7f">href</span>=<span style="color:#0ff;font-weight:bold">&#34;https://www.baidu.com&#34;</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${company}&#34;</span>&gt;百度&lt;/<span style="font-weight:bold">a</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/96ee43318b6d1dab53172aba141a320a_MD5.png"></p>
<h3 id="thattr-属性合并设置">th:attr 属性合并设置<a hidden class="anchor" aria-hidden="true" href="#thattr-属性合并设置">#</a></h3>
<ul>
<li>分开设置：</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>model.<span style="color:#007f7f">addAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;hrefValue&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;http://www.bjpowernode.com&#34;</span>);
</span></span><span style="display:flex;"><span>model.<span style="color:#007f7f">addAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;style&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;color:red&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">a</span> <span style="color:#007f7f">th:href</span>=<span style="color:#0ff;font-weight:bold">&#34;${hrefValue}&#34;</span> <span style="color:#007f7f">th:style</span>=<span style="color:#0ff;font-weight:bold">&#34;${style}&#34;</span>&gt;动力节点&lt;/<span style="font-weight:bold">a</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/124bd8519406725c3cdd6e740da24f5f_MD5.png"></p>
<ul>
<li>合并设置：使用<code>th:attr</code></li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>model.<span style="color:#007f7f">addAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;hrefValue&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;http://www.bjpowernode.com&#34;</span>);
</span></span><span style="display:flex;"><span>model.<span style="color:#007f7f">addAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;style&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;color:red&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">a</span> <span style="color:#007f7f">th:attr</span>=<span style="color:#0ff;font-weight:bold">&#34;href=${hrefValue},style=${style}&#34;</span>&gt;动力节点&lt;/<span style="font-weight:bold">a</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="th指令">th:指令<a hidden class="anchor" aria-hidden="true" href="#th指令">#</a></h3>
<p>指令非常多，具有代表性的例如：<code>th:if</code>，该指令用来控制元素<code>隐藏</code>和<code>显示</code>。</p>
<p>在<code>static</code>静态资源目录下存放一张图片：dog1.jpg</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/42ac13e1d17e8d21e4ea75366bb4daea_MD5.png"></p>
<p>然后编写这样的模板代码：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">img</span> <span style="color:#007f7f">src</span>=<span style="color:#0ff;font-weight:bold">&#34;dog1.jpg&#34;</span> <span style="color:#007f7f">th:if</span>=<span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果，图片是显示的：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/7640e7f5aab2e6fe15006df47353a854_MD5.png"></p>
<p>如果<code>th:if</code>的值修改为<code>false</code>，我们会发现隐藏了。</p>
<h3 id="-表达式">@{} 表达式<a hidden class="anchor" aria-hidden="true" href="#-表达式">#</a></h3>
<p><code>${}</code>表达式语法是专门用来获取<code>model</code>中绑定的数据的。</p>
<p><code>@{}</code>表达式语法是专门用来维护URL请求路径的。它可以动态设置项目的根路径。</p>
<p>SpringBoot中默认的项目根路径是：<code>/</code></p>
<p>假设我们编写这样的java代码，向model中绑定一个路径：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>model.<span style="color:#007f7f">addAttribute</span>(<span style="color:#0ff;font-weight:bold">&#34;imgUrl&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;/dog1.jpg&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们编写这样的模板代码：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">img</span> <span style="color:#007f7f">th:src</span>=<span style="color:#0ff;font-weight:bold">&#34;${imgUrl}&#34;</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/c82b197abaa4959c3fecafcfe27e36f4_MD5.png"></p>
<p>此时是可以正常显示的，但如果我们将web应用的根路径进行了修改，将其配置为：<code>/myweb</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">server.servlet.context-path</span>=<span style="color:#0ff;font-weight:bold">/myweb</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>其他位置代码不做修改，我们再来访问页面，注意访问路径中要添加<code>/myweb</code>，例如：<a href="http://localhost:8080/myweb/h?name=jackson">http://localhost:8080/myweb/h?name=jackson</a></p>
<p>访问后使用<code>ctrl + F5</code>强行刷新，不走浏览器缓存，结果发现无法访问到该图片：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/af51e484a4ee1ed6999385f0d5a1270f_MD5.png"></p>
<p>此时我们将模板代码进行如下修改，将<code>${}</code>修改为<code>@{}</code>：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">img</span> <span style="color:#007f7f">th:src</span>=<span style="color:#0ff;font-weight:bold">&#34;@{${imgUrl}}&#34;</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>再次测试：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/69438aade0a35ad4296ba0a9397e36a6_MD5.png"></p>
<h3 id="thymeleaf的内置工具">thymeleaf的内置工具<a hidden class="anchor" aria-hidden="true" href="#thymeleaf的内置工具">#</a></h3>
<p>内置工具很多，可以参考官方文档：<a href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#strings">https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#strings</a></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/c3aa25b04572c82194d830a2c562abc2_MD5.png"></p>
<p>例如我们要完成这样一个效果，用户提交用户名时，如果名字中含有<code>jack</code>则显示<code>狗狗图片</code>，否则不显示。</p>
<p>模板代码如下：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">img</span> <span style="color:#007f7f">th:src</span>=<span style="color:#0ff;font-weight:bold">&#34;@{${imgUrl}}&#34;</span> <span style="color:#007f7f">th:if</span>=<span style="color:#0ff;font-weight:bold">&#34;${#strings.contains(name,&#39;jack&#39;)}&#34;</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果1：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/0d9a992f46754fda8cc846042b6faaa2_MD5.png"></p>
<p>测试结果2：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/2cb5ae997d55c9aa49837b9e2d5d4dc9_MD5.png"></p>
<h3 id="thymeleaf也支持运算符">thymeleaf也支持运算符<a hidden class="anchor" aria-hidden="true" href="#thymeleaf也支持运算符">#</a></h3>
<p>例如<code>&gt;</code>运算符，我们实现这样一个功能，如果提供的用户名长度大于6，则显示狗狗图片：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">img</span> <span style="color:#007f7f">th:src</span>=<span style="color:#0ff;font-weight:bold">&#34;@{${imgUrl}}&#34;</span> <span style="color:#007f7f">th:if</span>=<span style="color:#0ff;font-weight:bold">&#34;${#strings.length(name) &gt; 6}&#34;</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果1：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/6c5eb37fadf897cdc8710c4a6cb362bc_MD5.png"></p>
<p>测试结果2：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/4630a8ba76d462195057653559d7f365_MD5.png"></p>
<p>另外thymeleaf也支持三目运算符：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">span</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.gender ? &#39;男&#39; : &#39;女&#39;}&#34;</span>&gt;&lt;/<span style="font-weight:bold">span</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果性别是true，则显示男，false，则显示女。</p>
<p>还有很多其他的运算符，可参考thymeleaf官方文档。</p>
<h3 id="thymeleaf的字符串拼接">thymeleaf的字符串拼接<a hidden class="anchor" aria-hidden="true" href="#thymeleaf的字符串拼接">#</a></h3>
<p>第一种方式：使用加号 <code>+</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${&#39;姓名：&#39; + name + &#39;，年龄：18&#39;}&#34;</span>&gt;&lt;/<span style="font-weight:bold">div</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试结果：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/da9a82464c90313eced9ef5531f7f6ca_MD5.png"></p>
<p>第二种方式：使用竖线 <code>||</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;|姓名：${name}，年龄：18|&#34;</span>&gt;&lt;/<span style="font-weight:bold">div</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/4942f684759a40aad97b64b6155e1a6c_MD5.png"></p>
<h3 id="循环遍历">循环遍历<a hidden class="anchor" aria-hidden="true" href="#循环遍历">#</a></h3>
<p>代码示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">tr</span> <span style="color:#007f7f">th:each</span>=<span style="color:#0ff;font-weight:bold">&#34;user : ${users}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.name}&#34;</span>&gt;&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.age}&#34;</span>&gt;&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.gender}&#34;</span>&gt;&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.desc}&#34;</span>&gt;&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.location}&#34;</span>&gt;&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">tr</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>说明：</p>
<ul>
<li>${users}：代表集合</li>
<li>user：代表集合中的每个元素</li>
<li>${user.name}：元素的name属性值</li>
</ul>
<p>遍历时也可以添加状态对象，代码示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">tr</span> <span style="color:#007f7f">th:each</span>=<span style="color:#0ff;font-weight:bold">&#34;user,state : ${userList}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${state.count}&#34;</span>&gt;1&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.name}&#34;</span>&gt;张三&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.age}&#34;</span>&gt;20&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.gender}&#34;</span>&gt;&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.desc}&#34;</span>&gt;&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.location}&#34;</span>&gt;&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>        thymeleaf的内联表达式：&lt;<span style="font-weight:bold">br</span>&gt;
</span></span><span style="display:flex;"><span>        下标：[[${state.index}]]&lt;<span style="font-weight:bold">br</span>&gt;
</span></span><span style="display:flex;"><span>        序号：[[${state.count}]]&lt;<span style="font-weight:bold">br</span>&gt;
</span></span><span style="display:flex;"><span>        当前对象：[[${state.current}]]&lt;<span style="font-weight:bold">br</span>&gt;
</span></span><span style="display:flex;"><span>        元素总数：[[${state.size}]]&lt;<span style="font-weight:bold">br</span>&gt;
</span></span><span style="display:flex;"><span>        是否为偶数行：[[${state.even}]]&lt;<span style="font-weight:bold">br</span>&gt;
</span></span><span style="display:flex;"><span>        是否为奇数行：[[${state.odd}]]&lt;<span style="font-weight:bold">br</span>&gt;
</span></span><span style="display:flex;"><span>        是否第一个元素：[[${state.first}]]&lt;<span style="font-weight:bold">br</span>&gt;
</span></span><span style="display:flex;"><span>        是否最后一个元素：[[${state.last}]]&lt;<span style="font-weight:bold">br</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">tr</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：以上<code>[[${state.index}]]</code>这种语法属于thymeleaf中的<code>内联表达式</code>写法。也可以写成：<code>[(${state.index})]</code></p>
<p>另外，状态对象<code>state</code>的属性包括：</p>
<ul>
<li>index：下标</li>
<li>count：序号</li>
<li>current：当前对象</li>
<li>size：元素总数</li>
<li>even：是否为偶数行</li>
<li>odd：是否为奇数行</li>
<li>first：是否为第一个元素</li>
<li>last：是否为最后一个元素</li>
</ul>
<h3 id="条件判断thif">条件判断th:if<a hidden class="anchor" aria-hidden="true" href="#条件判断thif">#</a></h3>
<p>th:if 语法用来决定元素是否显示：true显示。false隐藏。</p>
<div th:if="true">我是一个div元素</div>，则显示该div
<div th:if="false">我也是一个div元素</div>，则隐藏该div
<p>实现这样一个功能：用户如果没有留下简介，则显示<code>你比较懒没有留下任何介绍信息</code>，如果留下了简介，则显示具体的简介信息。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:if</span>=<span style="color:#0ff;font-weight:bold">&#34;${#strings.isEmpty(user.desc)}&#34;</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;&#39;你比较懒没有留下任何介绍信息&#39;&#34;</span>&gt;&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:if</span>=<span style="color:#0ff;font-weight:bold">&#34;${not #strings.isEmpty(user.desc)}&#34;</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.desc}&#34;</span>&gt;&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="条件判断thswitch">条件判断th:switch<a hidden class="anchor" aria-hidden="true" href="#条件判断thswitch">#</a></h3>
<p>实现一个这样的功能：如果城市编号001则显示北京，002则显示上海，003则显示广州，004则显示深圳，其他值显示未知。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">td</span> <span style="color:#007f7f">th:switch</span>=<span style="color:#0ff;font-weight:bold">&#34;${user.location}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">span</span> <span style="color:#007f7f">th:case</span>=<span style="color:#0ff;font-weight:bold">&#34;001&#34;</span>&gt;北京&lt;/<span style="font-weight:bold">span</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">span</span> <span style="color:#007f7f">th:case</span>=<span style="color:#0ff;font-weight:bold">&#34;002&#34;</span>&gt;上海&lt;/<span style="font-weight:bold">span</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">span</span> <span style="color:#007f7f">th:case</span>=<span style="color:#0ff;font-weight:bold">&#34;003&#34;</span>&gt;广州&lt;/<span style="font-weight:bold">span</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">span</span> <span style="color:#007f7f">th:case</span>=<span style="color:#0ff;font-weight:bold">&#34;004&#34;</span>&gt;深圳&lt;/<span style="font-weight:bold">span</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">span</span> <span style="color:#007f7f">th:case</span>=<span style="color:#0ff;font-weight:bold">&#34;*&#34;</span>&gt;未知&lt;/<span style="font-weight:bold">span</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">td</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="thymeleaf属性优先级">thymeleaf属性优先级<a hidden class="anchor" aria-hidden="true" href="#thymeleaf属性优先级">#</a></h3>
<p>thymeleaf的属性优先级非常重要，因为它直接决定了模板的解析和执行顺序。</p>
<p>以下是Thymeleaf属性的优先级从高到低的列表，以表格形式展示：</p>
<table>
<thead>
<tr>
<th>优先级</th>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code>th:if</code></td>
<td>如果条件为真，则渲染该元素。</td>
</tr>
<tr>
<td>2</td>
<td><code>th:unless</code></td>
<td>如果条件为假，则渲染该元素。</td>
</tr>
<tr>
<td>3</td>
<td><code>th:with</code></td>
<td>定义局部变量。</td>
</tr>
<tr>
<td>4</td>
<td><code>th:switch</code></td>
<td>开始一个 switch 语句。</td>
</tr>
<tr>
<td>5</td>
<td><code>th:case</code></td>
<td>定义 switch 语句中的 case 分支。</td>
</tr>
<tr>
<td>6</td>
<td><code>th:each</code></td>
<td>遍历列表，用于循环。</td>
</tr>
<tr>
<td>7</td>
<td><code>th:remove</code></td>
<td>移除元素或其属性。</td>
</tr>
<tr>
<td>8</td>
<td><code>th:attr</code></td>
<td>设置或修改元素的属性。</td>
</tr>
<tr>
<td>9</td>
<td><code>th:classappend</code></td>
<td>追加 CSS 类。</td>
</tr>
<tr>
<td>10</td>
<td><code>th:styleappend</code></td>
<td>追加内联样式。</td>
</tr>
<tr>
<td>11</td>
<td><code>th:src</code></td>
<td>设置元素的 <code>src</code> 属性。</td>
</tr>
<tr>
<td>12</td>
<td><code>th:href</code></td>
<td>设置元素的 <code>href</code> 属性。</td>
</tr>
<tr>
<td>13</td>
<td><code>th:value</code></td>
<td>设置元素的 <code>value</code> 属性。</td>
</tr>
<tr>
<td>14</td>
<td><code>th:text</code></td>
<td>设置元素的文本内容。</td>
</tr>
<tr>
<td>15</td>
<td><code>th:utext</code></td>
<td>设置元素的未转义文本内容。</td>
</tr>
<tr>
<td>16</td>
<td><code>th:html</code></td>
<td>设置元素的 HTML 内容。</td>
</tr>
<tr>
<td>17</td>
<td><code>th:fragment</code></td>
<td>定义模板片段。</td>
</tr>
<tr>
<td>18</td>
<td><code>th:insert</code></td>
<td>插入一个模板片段。</td>
</tr>
<tr>
<td>19</td>
<td><code>th:replace</code></td>
<td>替换当前元素为一个模板片段。</td>
</tr>
<tr>
<td>20</td>
<td><code>th:include</code></td>
<td>包含一个模板片段的内容。</td>
</tr>
<tr>
<td>21</td>
<td><code>th:block</code></td>
<td>用于逻辑分组，不产生任何HTML输出。</td>
</tr>
</tbody>
</table>
<p>对于thymeleaf属性优先级，我总结了以下一段话，把它记住即可：</p>
<p><strong>“先控制，再遍历，后操作，末内容。”</strong></p>
<p>具体来说：</p>
<ol>
<li><strong>先控制</strong>：<code>th:if</code> 和 <code>th:unless</code> 用于条件控制，决定是否渲染元素。</li>
<li><strong>再遍历</strong>：<code>th:each</code> 用于遍历列表，生成多个元素。</li>
<li><strong>后操作</strong>：<code>th:with</code>、<code>th:switch</code>、<code>th:case</code>、<code>th:remove</code>、<code>th:attr</code> 等用于局部变量定义、条件分支、属性操作等。</li>
<li><strong>末内容</strong>：<code>th:text</code>、<code>th:utext</code>、<code>th:html</code> 等用于设置元素的内容。</li>
</ol>
<h3 id="-表达式-1">*{&hellip;} 表达式<a hidden class="anchor" aria-hidden="true" href="#-表达式-1">#</a></h3>
<p><code>*{...}</code> 主要用于在上下文中访问对象的属性。这种表达式通常在表单处理和对象绑定场景中使用。</p>
<p><strong>语法</strong>：<code>*{property}</code>：访问当前**<font style="color:#DF2A3F;">上下文</font>**对象的某个属性。</p>
<p><strong>使用场景</strong></p>
<ul>
<li>表单绑定：在表单中绑定对象的属性。</li>
<li>对象属性访问：在模板中访问对象的属性，特别是当对象是当前上下文的一部分时。</li>
</ul>
<p><strong>示例</strong></p>
<ol>
<li><strong>表单绑定</strong></li>
</ol>
<p>假设你有一个 <code>User</code> 对象，包含 <code>name</code> 和 <code>age</code> 属性，你可以在表单中使用 <code>*{...}</code> 表达式来绑定这些属性：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">form</span> <span style="color:#007f7f">th:object</span>=<span style="color:#0ff;font-weight:bold">&#34;${user}&#34;</span> <span style="color:#007f7f">method</span>=<span style="color:#0ff;font-weight:bold">&#34;post&#34;</span> <span style="color:#007f7f">action</span>=<span style="color:#0ff;font-weight:bold">&#34;/submit&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">label</span> <span style="color:#007f7f">for</span>=<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>&gt;Name:&lt;/<span style="font-weight:bold">label</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">input</span> <span style="color:#007f7f">type</span>=<span style="color:#0ff;font-weight:bold">&#34;text&#34;</span> <span style="color:#007f7f">id</span>=<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span> <span style="color:#007f7f">name</span>=<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span> <span style="color:#007f7f">th:field</span>=<span style="color:#0ff;font-weight:bold">&#34;*{name}&#34;</span> /&gt; 
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">label</span> <span style="color:#007f7f">for</span>=<span style="color:#0ff;font-weight:bold">&#34;age&#34;</span>&gt;Age:&lt;/<span style="font-weight:bold">label</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">input</span> <span style="color:#007f7f">type</span>=<span style="color:#0ff;font-weight:bold">&#34;number&#34;</span> <span style="color:#007f7f">id</span>=<span style="color:#0ff;font-weight:bold">&#34;age&#34;</span> <span style="color:#007f7f">name</span>=<span style="color:#0ff;font-weight:bold">&#34;age&#34;</span> <span style="color:#007f7f">th:field</span>=<span style="color:#0ff;font-weight:bold">&#34;*{age}&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">button</span> <span style="color:#007f7f">type</span>=<span style="color:#0ff;font-weight:bold">&#34;submit&#34;</span>&gt;Submit&lt;/<span style="font-weight:bold">button</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">form</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这个例子中：</p>
<ul>
<li><code>th:object=&quot;${user}&quot;</code> 将 <code>user</code> 对象设置为当前上下文对象。</li>
<li><code>th:field=&quot;*{name}&quot;</code> 和 <code>th:field=&quot;*{age}&quot;</code> 分别绑定到 <code>user</code> 对象的 <code>name</code> 和 <code>age</code> 属性。</li>
</ul>
<ol start="2">
<li><strong>对象属性访问</strong></li>
</ol>
<p>假设你有一个 <code>User</code> 对象，包含 <code>name</code> 和 <code>age</code> 属性，你可以在模板中使用 <code>*{...}</code> 表达式来访问这些属性：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">th:object</span>=<span style="color:#0ff;font-weight:bold">&#34;${user}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">p</span>&gt;Name: &lt;<span style="font-weight:bold">span</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;*{name}&#34;</span>&gt;Default Name&lt;/<span style="font-weight:bold">span</span>&gt;&lt;/<span style="font-weight:bold">p</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">p</span>&gt;Age: &lt;<span style="font-weight:bold">span</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;*{age}&#34;</span>&gt;Default Age&lt;/<span style="font-weight:bold">span</span>&gt;&lt;/<span style="font-weight:bold">p</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">div</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这个例子中：</p>
<ul>
<li><code>th:object=&quot;${user}&quot;</code> 将 <code>user</code> 对象设置为当前上下文对象。</li>
<li><code>*{name}</code> 和 <code>*{age}</code> 分别访问 <code>user</code> 对象的 <code>name</code> 和 <code>age</code> 属性。</li>
</ul>
<p><strong>与 <strong><code>**${...}**</code></strong> 的区别</strong></p>
<ul>
<li><code>${...}</code>：标准表达式，用于访问模型中的变量和执行简单的表达式。</li>
<li><code>*{...}</code>：属性选择表达式，用于在上下文中访问对象的属性，通常与 <code>th:object</code> 一起使用。</li>
</ul>
<h3 id="代码片段共享">代码片段共享<a hidden class="anchor" aria-hidden="true" href="#代码片段共享">#</a></h3>
<p>片段是Thymeleaf中用于代码复用的基本机制。你可以将共享的部分提取到单独的HTML文件中，然后在其他模板中引用这些片段。</p>
<p>页面中公共的header.html</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">header</span> <span style="color:#007f7f">th:fragment</span>=<span style="color:#0ff;font-weight:bold">&#34;h&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">nav</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="font-weight:bold">ul</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="font-weight:bold">li</span>&gt;&lt;<span style="font-weight:bold">a</span> <span style="color:#007f7f">th:href</span>=<span style="color:#0ff;font-weight:bold">&#34;@{/a}&#34;</span>&gt;Home&lt;/<span style="font-weight:bold">a</span>&gt;&lt;/<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="font-weight:bold">li</span>&gt;&lt;<span style="font-weight:bold">a</span> <span style="color:#007f7f">th:href</span>=<span style="color:#0ff;font-weight:bold">&#34;@{/b}&#34;</span>&gt;About&lt;/<span style="font-weight:bold">a</span>&gt;&lt;/<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="font-weight:bold">ul</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="font-weight:bold">nav</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">header</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>页面中公共的footer.html</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">footer</span> <span style="color:#007f7f">th:fragment</span>=<span style="color:#0ff;font-weight:bold">&#34;f&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="font-weight:bold">p</span>&gt;&amp;copy; 2024 北京动力节点&lt;/<span style="font-weight:bold">p</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">footer</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在<code>a.html</code>中包含以上两个公共部分：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">html</span> <span style="color:#007f7f">xmlns:th</span>=<span style="color:#0ff;font-weight:bold">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">title</span>&gt;主页&lt;/<span style="font-weight:bold">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">th:replace</span>=<span style="color:#0ff;font-weight:bold">&#34;~{header :: h}&#34;</span>&gt;&lt;/<span style="font-weight:bold">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">main</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">h1</span>&gt;欢迎来到主页&lt;/<span style="font-weight:bold">h1</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">p</span>&gt;这是主页的主要内容.&lt;/<span style="font-weight:bold">p</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">main</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">th:replace</span>=<span style="color:#0ff;font-weight:bold">&#34;~{footer :: f}&#34;</span>&gt;&lt;/<span style="font-weight:bold">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">html</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在<code>b.html</code>中包含以上两个公共部分：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">html</span> <span style="color:#007f7f">xmlns:th</span>=<span style="color:#0ff;font-weight:bold">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">title</span>&gt;关于我们&lt;/<span style="font-weight:bold">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">body</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">th:replace</span>=<span style="color:#0ff;font-weight:bold">&#34;~{header :: h}&#34;</span>&gt;&lt;/<span style="font-weight:bold">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">main</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">h1</span>&gt;关于我们&lt;/<span style="font-weight:bold">h1</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">p</span>&gt;动力节点专注IT培训16年.&lt;/<span style="font-weight:bold">p</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">main</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">th:replace</span>=<span style="color:#0ff;font-weight:bold">&#34;~{footer :: f}&#34;</span>&gt;&lt;/<span style="font-weight:bold">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">html</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>主要作用是代码复用。实现此功能的主要代码：</p>
<ul>
<li>在公共代码部分使用<code>th:fragment=&quot;片段名称&quot;</code>来声明公共代码片段的名字。</li>
<li>在需要引入的地方使用<code>th:replace=&quot;~{文件名去掉后缀 :: 片段名称}&quot;</code>来引入。</li>
</ul>
<p><strong><font style="color:#DF2A3F;">小插曲：在springboot中如何实现：直接将请求路径映射到特定的视图，而不需要编写controller？</font></strong></p>
<ul>
<li>第一步：视图解析器配置</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">spring.mvc.view.prefix</span>=<span style="color:#0ff;font-weight:bold">/templates/</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.mvc.view.suffix</span>=<span style="color:#0ff;font-weight:bold">.html</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>第二步：使用<code>ViewControllerRegistry</code>进行视图与控制器的注册</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.springboot.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> WebMvcConfig <span style="color:#fff;font-weight:bold">implements</span> WebMvcConfigurer {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addViewControllers(ViewControllerRegistry registry) {
</span></span><span style="display:flex;"><span>        registry.<span style="color:#007f7f">addViewController</span>(<span style="color:#0ff;font-weight:bold">&#34;/a&#34;</span>).<span style="color:#007f7f">setViewName</span>(<span style="color:#0ff;font-weight:bold">&#34;a&#34;</span>);
</span></span><span style="display:flex;"><span>        registry.<span style="color:#007f7f">addViewController</span>(<span style="color:#0ff;font-weight:bold">&#34;/b&#34;</span>).<span style="color:#007f7f">setViewName</span>(<span style="color:#0ff;font-weight:bold">&#34;b&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="thymeleaf页面修改如何立即生效">thymeleaf页面修改如何立即生效<a hidden class="anchor" aria-hidden="true" href="#thymeleaf页面修改如何立即生效">#</a></h2>
<p>第一步：引入springboot提供的<code>dev tools</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-devtools<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;scope&gt;</span>runtime<span style="font-weight:bold">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;optional&gt;</span>true<span style="font-weight:bold">&lt;/optional&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>第二步：关闭应用重启功能，如果不关闭会导致每一次修改java代码后立即重启应用，不建议。我们现在只希望做到的功能是，修改thymeleaf模板文件后立即生效。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">spring.devtools.restart.enabled</span>=<span style="color:#0ff;font-weight:bold">false</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>第三步：修改代码后在IDEA中按组合键<code>ctrl+f9</code></p>
<p>以上三步配合即可。</p>
<h1 id="异常处理">异常处理<a hidden class="anchor" aria-hidden="true" href="#异常处理">#</a></h1>
<p>在controller层如果程序出现了异常，并且这个异常未被捕获，springboot提供的异常处理机制将生效。</p>
<p>Spring Boot 提供异常处理机制主要是为了提高应用的健壮性和用户体验。它的好处包括：</p>
<ol>
<li><strong>统一错误响应</strong>：可以定义全局异常处理器来统一处理各种异常，确保返回给客户端的错误信息格式一致，便于前端解析。</li>
<li><strong>提升用户体验</strong>：能够优雅地处理异常情况，避免直接将技术性错误信息暴露给用户，而是显示更加友好的提示信息。</li>
<li><strong>简化代码</strong>：开发者不需要在每个可能抛出异常的方法中重复编写异常处理逻辑，减少冗余代码，使业务代码更加清晰简洁。</li>
<li><strong>增强安全性</strong>：通过控制异常信息的输出，防止敏感信息泄露，增加系统的安全性。</li>
</ol>
<h2 id="自适应的错误处理机制">自适应的错误处理机制<a hidden class="anchor" aria-hidden="true" href="#自适应的错误处理机制">#</a></h2>
<p>springboot会根据请求头的Accept字段来决定错误的响应格式。</p>
<p>这种机制的好处就是：客户端设备自适应，提高用户的体验。</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/cc88d10ad64f30227696b1a37766736d_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/7784f0a37fe1605a7c5bc821c997cd44_MD5.png"></p>
<h2 id="springmvc的错误处理方案">SpringMVC的错误处理方案<a hidden class="anchor" aria-hidden="true" href="#springmvc的错误处理方案">#</a></h2>
<p><strong><font style="color:#DF2A3F;">重点：如果程序员使用了SpringMVC的错误处理方案，SpringBoot的错误处理方案不生效。</font></strong></p>
<h3 id="局部控制-exceptionhandler">局部控制 @ExceptionHandler<a hidden class="anchor" aria-hidden="true" href="#局部控制-exceptionhandler">#</a></h3>
<p>在控制器当中编写一个方法，方法使用@ExceptionHandler注解进行标注，凡是<strong>这个控制器</strong>当中出现了<strong>对应的异常</strong>，则走这个方法来进行异常的处理。局部生效。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.test.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.PathVariable;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> UserController {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/resource/{id}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getResource(@PathVariable Long id){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(id == 1){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalArgumentException(<span style="color:#0ff;font-weight:bold">&#34;无效ID：&#34;</span> + id);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;ID = &#34;</span> + id;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ExceptionHandler(IllegalArgumentException.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String handler(IllegalArgumentException e){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;错误信息：&#34;</span> + e.<span style="color:#007f7f">getMessage</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以再编写一个OtherController，让它也发生<code>IllegalArgumentException</code>异常，看看它会不会走局部的错误处理机制。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.test.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.PathVariable;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> OtherController {
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/resource2/{id}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getResource(@PathVariable Long id){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(id == 1){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalArgumentException(<span style="color:#0ff;font-weight:bold">&#34;无效ID：&#34;</span> + id);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;ID = &#34;</span> + id;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过测试，确实局部生效。</p>
<h3 id="全局控制-controlleradvice--exceptionhandler">全局控制 @ControllerAdvice + @ExceptionHandler<a hidden class="anchor" aria-hidden="true" href="#全局控制-controlleradvice--exceptionhandler">#</a></h3>
<p>也可以把以上局部生效的方法单独放到一个类当中，这个类使用@ControllerAdvice注解标注，凡是<strong>任何控制器</strong>当中出现了<strong>对应的异常</strong>，则走这个方法来进行异常的处理。全局生效。</p>
<p>将之前的局部处理方案的代码注释掉。使用全局处理方式，编写以下类：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.powernode.test.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.ControllerAdvice;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.ResponseBody;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@ControllerAdvice
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> GlobalExceptionHandler {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ExceptionHandler(IllegalArgumentException.<span style="color:#007f7f">class</span>)
</span></span><span style="display:flex;"><span>    @ResponseBody
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String handler(IllegalArgumentException e){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;错误信息：&#34;</span> + e.<span style="color:#007f7f">getMessage</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过测试，确实全局生效。</p>
<h2 id="springboot的错误处理方案">SpringBoot的错误处理方案<a hidden class="anchor" aria-hidden="true" href="#springboot的错误处理方案">#</a></h2>
<p><strong><font style="color:#DF2A3F;">重点：如果SpringMVC没有对应的处理方案，会开启SpringBoot默认的错误处理方案。</font></strong></p>
<p>SpringBoot默认的错误处理方案如下：</p>
<ol>
<li>如果客户端要的是json，则直接响应json格式的错误信息。</li>
<li>如果客户端要的是html页面，则按照下面方案：</li>
</ol>
<ul>
<li>第一步（精确错误码文件）：去<code>classpath:/templates/error/</code>目录下找<code>404.html``500.html</code>等<code>精确错误码.html</code>文件。如果找不到，则去静态资源目录下的/error目录下找。如果还是找不到，才会进入下一步。</li>
<li>第二步（模糊错误码文件）：去<code>classpath:/templates/error/</code>目录下找<code>4xx.html``5xx.html</code>等<code>模糊错误码.html</code>文件。如果找不到，则去静态资源目录下的/error目录下找。如果还是找不到，才会进入下一步。</li>
<li>第三步（通用错误页面）：去找<code>classpath:/templates/error.html</code>如果找不到则进入下一步。</li>
<li>第四步（默认错误处理）：如果上述所有步骤都未能找到合适的错误页面，Spring Boot 会使用内置的默认错误处理机制，即 <code>/error</code> 端点。</li>
</ul>
<h2 id="如何在错误页获取错误信息">如何在错误页获取错误信息<a hidden class="anchor" aria-hidden="true" href="#如何在错误页获取错误信息">#</a></h2>
<p>Spring Boot 默认会在模型Model中放置以下信息：</p>
<ul>
<li>timestamp: 错误发生的时间戳</li>
<li>status: HTTP 状态码</li>
<li>error: 错误类型（如 &ldquo;Not Found&rdquo;）</li>
<li>exception: 异常类名</li>
<li>message: 错误消息</li>
<li>trace: 堆栈跟踪</li>
</ul>
<p>在thymeleaf中使用 <code>${message}</code>即可取出信息。</p>
<p>注意：**<font style="color:#DF2A3F;">springboot3.3.5</font>**版本默认只向Model对象中绑定了<code>timestamp``status``error</code>。如果要保存<code>exception``message``trace</code>，需要开启以下三个配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>server.error.include-stacktrace=always
</span></span><span style="display:flex;"><span>server.error.include-exception=true
</span></span><span style="display:flex;"><span>server.error.include-message=always
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="前后端分离项目的错误处理方案">前后端分离项目的错误处理方案<a hidden class="anchor" aria-hidden="true" href="#前后端分离项目的错误处理方案">#</a></h2>
<p>统一使用SpringMVC的错误处理方案，定义全局的异常处理机制：@ControllerAdvice + @ExceptionHandler</p>
<p>返回json格式的错误信息，其它的就不需要管了，因为前端接收到错误信息怎么处理是他自己的事儿。</p>
<h2 id="服务器端负责页面渲染的项目错误处理方案">服务器端负责页面渲染的项目错误处理方案<a hidden class="anchor" aria-hidden="true" href="#服务器端负责页面渲染的项目错误处理方案">#</a></h2>
<p>建议使用SpringBoot的错误处理方案：</p>
<ol>
<li>如果发生的异常是HTTP错误状态码：
<ol>
<li>建议常见的错误码给定<code>精确错误码.html</code></li>
<li>建议不常见的错误码给定<code>模糊错误码.html</code></li>
</ol>
</li>
<li>如果发生的异常不是HTTP错误状态码，而是业务相关异常：
<ol>
<li>在程序中处理具体的业务异常，自己通过程序来决定跳转到哪个错误页面。</li>
</ol>
</li>
<li>建议提供<code>classpath:/templates/error.html</code>来处理通用错误。</li>
</ol>
<h1 id="国际化了解">国际化（了解）<a hidden class="anchor" aria-hidden="true" href="#国际化了解">#</a></h1>
<p>在Spring Boot中实现国际化（i18n）是一个常见的需求，它允许应用程序根据用户的语言和地区偏好显示不同的文本。</p>
<h2 id="实现国际化">实现国际化<a hidden class="anchor" aria-hidden="true" href="#实现国际化">#</a></h2>
<h3 id="第一步创建资源文件">第一步：创建资源文件<a hidden class="anchor" aria-hidden="true" href="#第一步创建资源文件">#</a></h3>
<p>创建包含不同语言版本的消息文件。这些文件通常放在<code>src/main/resources</code>目录下，并且以<code>.properties</code>为扩展名。例如：</p>
<ul>
<li><code>messages.properties</code> (默认语言，如英语)</li>
<li><code>messages_zh_CN.properties</code> (简体中文)</li>
<li><code>messages_fr.properties</code> (法语)</li>
</ul>
<p>每个文件都应包含相同的消息键，但值应对应于相应的语言。例如：</p>
<p><strong>messages.properties</strong>:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">welcome.message</span>=<span style="color:#0ff;font-weight:bold">Welcome to our application!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>messages_zh_CN.properties</strong>:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">welcome.message</span>=<span style="color:#0ff;font-weight:bold">欢迎来到我们的应用！</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>messages_fr.properties</strong>:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">welcome.message</span>=<span style="color:#0ff;font-weight:bold">Bienvenue dans notre application !</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="第二步在模板文件中取出消息">第二步：在模板文件中取出消息<a hidden class="anchor" aria-hidden="true" href="#第二步在模板文件中取出消息">#</a></h3>
<p>语法格式为：#{welcome.message}</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#0f0;font-weight:bold">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">html</span> <span style="color:#007f7f">lang</span>=<span style="color:#0ff;font-weight:bold">&#34;en&#34;</span> <span style="color:#007f7f">xmlns:th</span>=<span style="color:#0ff;font-weight:bold">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">meta</span> <span style="color:#007f7f">charset</span>=<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">title</span>&gt;Title&lt;/<span style="font-weight:bold">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">h1</span> <span style="color:#007f7f">th:text</span>=<span style="color:#0ff;font-weight:bold">&#34;#{welcome.message}&#34;</span>&gt;&lt;/<span style="font-weight:bold">h1</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">html</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>测试1：浏览器默认的语言环境是中文时</strong></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/4cfad89ba5f8be491c53a059e093b8dc_MD5.png"></p>
<p><strong>测试2：将浏览器默认语言环境修改为法文</strong></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/70e845641d5eb95dd7f2d9b5009d4a75_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/16f78a62c0fa6a93fc3636cc254b9a55_MD5.png"></p>
<h2 id="国际化实现原理">国际化实现原理<a hidden class="anchor" aria-hidden="true" href="#国际化实现原理">#</a></h2>
<p>做国际化的自动配置类是：<code>MessageSourceAutoConfiguration</code></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/a50fb510b29cb19c71ea3c569dc82e35_MD5.png"></p>
<p>通过以上源码得知，国际化对应的配置前缀是：<code>spring.message</code></p>
<p>例如在<code>application.properties</code>中进行如下配置：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f"># 配置国际化文件命名的基础名称</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.messages.basename</span>=<span style="color:#0ff;font-weight:bold">messages</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 指定国际化信息的字符编码方式</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.messages.encoding</span>=<span style="color:#0ff;font-weight:bold">UTF-8</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：标准标识符：en_US 和 zh_CN 这样的标识符是固定的，不能更改。可以设置的是basename。</p>
<h2 id="在程序当中如何获取国际化信息">在程序当中如何获取国际化信息<a hidden class="anchor" aria-hidden="true" href="#在程序当中如何获取国际化信息">#</a></h2>
<p>在国际化自动配置类中可以看到这样一个Bean：MessageSource，它是专门用来处理国际化的。我们可以将它注入到我们的程序中，然后调用相关方法在程序中获取国际化信息。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Controller
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MyController {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> MessageSource messageSource;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/test&#34;</span>)
</span></span><span style="display:flex;"><span>    @ResponseBody
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String test(HttpServletRequest request){
</span></span><span style="display:flex;"><span>        Locale locale = request.<span style="color:#007f7f">getLocale</span>();
</span></span><span style="display:flex;"><span>        String message = messageSource.<span style="color:#007f7f">getMessage</span>(<span style="color:#0ff;font-weight:bold">&#34;welcome.message&#34;</span>, <span style="color:#fff;font-weight:bold">null</span>, locale);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> message;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="定制web容器">定制web容器<a hidden class="anchor" aria-hidden="true" href="#定制web容器">#</a></h1>
<h2 id="web服务器切换为jetty">web服务器切换为jetty<a hidden class="anchor" aria-hidden="true" href="#web服务器切换为jetty">#</a></h2>
<p>springboot默认嵌入的web服务器是Tomcat，如何切换到jetty服务器？</p>
<p>实现方式：排除Tomcat，添加Jetty依赖</p>
<p><strong>修改 <strong><code>pom.xml</code></strong> 文件</strong>：在 <code>pom.xml</code> 中，确保你使用 <code>spring-boot-starter-web</code> 并排除 Tomcat，然后添加 Jetty 依赖。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#007f7f">&lt;!-- 排除 Tomcat --&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;exclusions&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;exclusion&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">&lt;/exclusion&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/exclusions&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">&lt;!-- 添加 Jetty 依赖 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-jetty<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="web服务器切换原理">web服务器切换原理<a hidden class="anchor" aria-hidden="true" href="#web服务器切换原理">#</a></h2>
<p>从哪里可以看出springboot是直接将tomcat服务器嵌入到应用中的呢？看这个类：<code>ServletWebServerFactoryAutoConfiguration</code></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/6eff518bd4c28899634ee9b77fd5c26b_MD5.png"></p>
<p>以上代码显示嵌入的是3个服务器。但并不是都生效，我们来看一下生效条件：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/b8e8e314edba8f03e9743b0885912684_MD5.png"></p>
<p>生效条件是，看类路径当中是否有对应服务器相关的类，如果有则生效。<code>spring-boot-web-starter</code>这个web启动器引入的时候，大家都知道，它间接引入的是tomcat服务器的jar包。因此默认Tomcat服务器被嵌入。如果想要切换web服务器，将tomcat相关jar包排除掉，引入jetty的jar包之后，jetty服务器就会生效，这就是切换web服务器的原理。</p>
<h2 id="web服务器优化">web服务器优化<a hidden class="anchor" aria-hidden="true" href="#web服务器优化">#</a></h2>
<p>通过以下源码得知，web服务器的相关配置和<code>ServerProperties</code>有关系：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/6861ec5a3f1d97d1161c08832d58b06b_MD5.png"></p>
<p>查看<code>ServerProperties</code>源码：</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/c14f6dd939e03b88b347a8e816df2c63_MD5.png"></p>
<p>得知web服务器的配置都是以<code>server</code>开头的。</p>
<p>那么如果要配置tomcat服务器怎么办？要配置jetty服务器怎么办？请看一下源码</p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/04685689177304702d99062ac3230c2f_MD5.png"></p>
<p><img loading="lazy" src="/posts/springboot/%E7%AC%AC5%E7%AB%A0-spring-boot%E7%9A%84web%E5%BC%80%E5%8F%91/2f11f712235f3cd477aaffa4d45cd0ce_MD5.png"></p>
<p>通过以上源码得知，如果要对tomcat服务器进行配置，前缀为：<code>server.tomcat</code></p>
<p>如果要对jetty服务器进行配置，前缀为：<code>server.jetty</code>。</p>
<p>在以后的开发中关于tomcat服务器的常见优化配置有：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f"># 这个参数决定了 Tomcat 在接收请求时，如果在指定的时间内没有收到完整的请求数据，将会关闭连接。这个超时时间是从客户端发送请求开始计算的。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 防止长时间占用资源：如果客户端发送请求后，长时间没有发送完所有数据，Tomcat 会在这个超时时间内关闭连接，从而释放资源，避免资源被长时间占用。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.connection-timeout</span>=<span style="color:#0ff;font-weight:bold">20000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 设置 Tomcat 服务器处理请求的最大线程数为 200。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 如果超过这个数量的请求同时到达，Tomcat 会将多余的请求放入一个等待队列中。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 如果等待队列也满了（由 server.tomcat.accept-count 配置），新的请求将被拒绝，通常会返回一个“503 Service Unavailable”错误。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.max-threads</span>=<span style="color:#0ff;font-weight:bold">200</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 用来设置等待队列的最大容量</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.accept-count</span>=<span style="color:#0ff;font-weight:bold">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 设置 Tomcat 服务器在空闲时至少保持 10 个线程处于活动状态，以便快速响应新的请求。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.min-spare-threads</span>=<span style="color:#0ff;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 允许 Tomcat 服务器在关闭后立即重新绑定相同的地址和端口，即使该端口还在 TIME_WAIT 状态</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 当一个网络连接关闭时，操作系统会将该连接的端口保持在 TIME_WAIT 状态一段时间（通常是 2-4 分钟），以确保所有未完成的数据包都能被正确处理。在这段时间内，该端口不能被其他进程绑定。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.address-reuse-enabled</span>=<span style="color:#0ff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 设置 Tomcat 服务器绑定到所有可用的网络接口，使其可以从任何网络地址访问。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.bind-address</span>=<span style="color:#0ff;font-weight:bold">0.0.0.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 设置 Tomcat 服务器使用 HTTP/1.1 协议处理请求。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.protocol</span>=<span style="color:#0ff;font-weight:bold">HTTP/1.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 设置 Tomcat 服务器的会话(session)超时时间为 30 分钟。具体来说，如果用户在 30 分钟内没有与应用进行任何交互，其会话将被自动注销。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.session-timeout</span>=<span style="color:#0ff;font-weight:bold">30</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 设置 Tomcat 服务器的静态资源缓存时间为 3600 秒（即 1 小时），这意味着浏览器会在 1 小时内缓存这些静态资源，减少重复请求。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.resource-cache-period</span>=<span style="color:#0ff;font-weight:bold">3600</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 解决get请求乱码。对请求行url进行编码。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.uri-encoding</span>=<span style="color:#0ff;font-weight:bold">UTF-8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 设置 Tomcat 服务器的基础目录为当前工作目录（. 表示当前目录）。这个配置指定了 Tomcat 服务器的工作目录，包括日志文件、临时文件和其他运行时生成的文件的存放位置。 生产环境中可能需要重新配置。</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">server.tomcat.basedir</span>=<span style="color:#0ff;font-weight:bold">.</span>
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://009965.xyz/tags/springboot/">Springboot</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://009965.xyz/">Wjy&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
