<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>redis | Wjy&#39;s Blog</title>
<meta name="keywords" content="中间件">
<meta name="description" content="redis是一个开源的，使用C语言编写的，支持网络交互的、可基于内存也可持久化的Key-Value数据库。">
<meta name="author" content="Wjy">
<link rel="canonical" href="https://funny-toffee-4aa7c3.netlify.app/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://funny-toffee-4aa7c3.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://funny-toffee-4aa7c3.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://funny-toffee-4aa7c3.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://funny-toffee-4aa7c3.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://funny-toffee-4aa7c3.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://funny-toffee-4aa7c3.netlify.app/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="https://funny-toffee-4aa7c3.netlify.app/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/">
  <meta property="og:site_name" content="Wjy&#39;s Blog">
  <meta property="og:title" content="redis">
  <meta property="og:description" content="redis是一个开源的，使用C语言编写的，支持网络交互的、可基于内存也可持久化的Key-Value数据库。">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-10-06T18:10:43+00:00">
    <meta property="article:modified_time" content="2018-10-06T18:10:43+00:00">
    <meta property="article:tag" content="中间件">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redis">
<meta name="twitter:description" content="redis是一个开源的，使用C语言编写的，支持网络交互的、可基于内存也可持久化的Key-Value数据库。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://funny-toffee-4aa7c3.netlify.app/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "redis",
      "item": "https://funny-toffee-4aa7c3.netlify.app/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "redis",
  "name": "redis",
  "description": "redis是一个开源的，使用C语言编写的，支持网络交互的、可基于内存也可持久化的Key-Value数据库。\n",
  "keywords": [
    "中间件"
  ],
  "articleBody": "redis是一个开源的，使用C语言编写的，支持网络交互的、可基于内存也可持久化的Key-Value数据库。\n概念 缓存处理流程\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // 先从redis中获取数据 String data = redisGet(\"xxx\"); // redis中没有数据 if(data == null) { // 从数据库中获取数据 data = dbGet(\"xxx\"); // 数据库也没有数据，返回空结果 if(data == null) { return \"\"; } // 设置到缓存中 redis.set(\"xxx\",\"xxx\"); } // 返回数据 return data; redis缓存穿透 缓存穿透是指：查询一个缓存和数据库中都不存在的数据，由于缓存不命中（因为数据根本就不存在），请求就会穿过缓存，直接请求数据库。如果有大量此类请求，数据库压力会突然增大，严重时可能会拖垮数据库。 例如：用户（这时的用户很可能是攻击者）发起为id为-1或id为特别大不存在的请求。 解决方案：\n接口层增加校验，如用户鉴权校验，id做基础校验，id\u003c=0的直接拦截； 从缓存取不到的数据，在数据库中也没有取到，这时也可以将key-value对写为key-null，缓存有效时间可以设置短点，如30秒（设置太长会导致正常情况也没法使用）。这样可以防止攻击用户反复用同一个id暴力攻击。 缓存雪崩 缓存雪崩是指：在某一个时间段内，大量的缓存键集中过期，导致所有的请求都落到数据库上，造成数据库瞬间压力过大，可能到达崩溃的状态。和缓存击穿不同的是，缓存击穿指并发查同一条数据，缓存雪崩是不同数据都过期了，很多数据从缓存查不到从而查数据库。 解决方案：\n缓存数据的过期时间设置随机，防止同一时间大量缓存过期。 热点数据不设置过期时间。 缓存击穿 缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个key进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，造成数据库压力过大，就像在一个屏障上凿开了一个洞。缓存击穿指并发查同一条数据。 解决方案：\n热点数据不设置过期时间：这要求系统能准确判断哪些是热点数据。 加锁或队列：当热点key过期时，不是所有请求都去数据库查询，而是让某一个请求去数据库查询并更新缓存，其他请求等待缓存更新后再访问缓存。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 public static String getData(String key) throws InterruptedException{ //从缓存中读取数据 String result = getDataFromRedis(key); //缓存中不存在数据 if(null == result){ //获取锁，获取成功，取数据库获取数据 if(reenLock.tryLock()){ //从数据库获取数据 result = getDataFromMysql(key); //更新缓存数据 if(result != null){ setDataToCache(key,result); } //释放锁 reenLock.unlock(); }else{//获取锁失败 //暂停100ms再重新获取数据 Thread.sleep(100); result = getData(key); } } return result; } 说明：\n缓存中有数据，直接走上述代码13行后就返回结果了 缓存中没有数据，第1个进入的线程，获取锁并从数据库去取数据，没释放锁之前，其他并行进入的线程会等待100ms，再重新去缓存取数据。这样就防止都去数据库重复取数据，重复往缓存中更新数据情况出现。 当然这是简化处理，理论上如果能根据key值加锁就更好了，就是线程A从数据库取key1的数据并不妨碍线程B取key2的数据，上面代码明显做不到这点。 数据一致性 数据一致性问题是指当数据在多个地方（如缓存和数据库）存储时，这些地方的数据可能会出现不一致的情况。这种不一致可能是由于缓存更新滞后、系统故障或其他原因引起的。数据一致性是分布式系统设计中的一项挑战，尤其是在读写非常频繁的系统中。\n数据一致性的问题所在\n当数据被更新时，如果缓存中的相应数据没有立即更新，那么缓存系统将向应用程序提供旧数据。这会导致应用程序得到不一致的结果，影响用户体验和数据的准确性。\n实时强一致性和最终一致性\n在分布式系统中，数据一致性是一个核心问题。根据系统的设计与需求，可以选择实时强一致性(Strong Consistency)或最终一致性(Eventual Consistency)。\n实时强一致性 **定义：**实时强一致性保证了任何时刻，所有的客户端看到的数据都是一样的。在分布式系统中实现强一致性意味着，一个操作一旦完成，所有的客户端立即都能看到这个操作的结果。\n**适用场景：**事务性强、对数据一致性要求高的系统，如银行系统或任何财务系统。\n保障策略：\n三阶段提交（3PC）等分布式事务协议：在分布式系统中保证操作要么全部成功，要么全部失败。 分布式锁：通过在操作前获取全局锁，保证同一时刻只有一个操作可以修改数据，从而保障数据一致性。 强一致性算法：如Paxos或Raft算法，通过一系列严格的消息传递和确认机制，确保分布式系统中的多个副本能够达到一致状态。 最终一致性 **定义：**最终一致性是指，系统会保证在没有新的更新操作的情况下，经过足够的时间后，数据将达到一致的状态。在这种模型下，数据的副本之间可能会暂时存在不一致。\n**适用场景：**对实时性要求不高，可以容忍短时间内数据不一致的场景，如社交网络、推荐系统等。\n保障策略：\n异步复制：当数据更新发生时，首先更新主副本，然后异步地将更新同步到其他副本。 读取修复（Read Repair）：在读取数据的时候检测副本之间的不一致，并在后台异步修复不一致的数据。 后台一致性修复进程：定期在后台运行的进程检查和同步数据副本之间的差异，以达到最终一致性。 版本控制：每次更新数据时附加一个时间戳或版本号，用于解决更新冲突和保持数据的最终一致性。 缓存更新策略 Write through cache（直写缓存）：首先将数据写入缓存，然后立即将新的缓存数据复制到数据库。这种方式可以保证写操作的一致性，但可能会影响写操作的性能。 Write back cache（写回缓存）：数据首先写入缓存，然后由缓存异步写入数据库。这种方式可以提高写操作的性能，但增加了数据丢失的风险。 Write around cache（饶写缓存）：绕过缓存，直接写数据库，然后依据需要更新缓存或使缓存失效。这适用于更频繁读取操作的场景。 缓存失效策略 主动更新：当数据库数据变化时，主动更新缓存中的数据。这可以保持缓存数据的实时性，但可能会增加系统的复杂性。 定时失效：为缓存数据设置一个过期时间。定期从数据库中重新加载数据，以保持数据的新鲜度。但这无法解决数据在两次加载之间变化导致的一致性问题。 惰性加载：只有在请求特定数据且发现缓存失效或缓存中没有该数据时，才去数据库加载该数据。这种策略简单，但在高并发场景下可能会导致缓存击穿。 使用缓存一致性协议 基于订阅的更新：使用消息队列（如Kafka，RabbitMQ）来发布数据库更新，然后相关服务订阅这些更新消息来同步更新缓存。 最终一致性：采用最终一致性模型，允许系统在一段时间内是不一致的，但保证经过足够的时间后，系统中的所有复制数据最终将达到一致的状态。 分布式缓存系统 使用如Redis Cluster、Apache Ignite、Tair等分布式缓存系统，这些系统内置了处理缓存一致性的机制，（但是无法解决缓存和数据库之间的数据一致性问题）。\n缓存一致性场景和问题 原文：https://mp.weixin.qq.com/s/6-TAG8s5tgefs-5Qdt4tzQ\n为了使各应用职责及整体的架构设计更加清晰，Push中心整体将后台配置端（后台管理）和前台投放端（用户端）分别部署在了两个应用中，两个应用需要分别配置数据库连接，分别配置缓存。\n投放段（用户端） 投放端对于投放计划pushPlan，只有查询流量，没有增删改。\n由于投放端qps较高，为减少数据库压力，必须使用缓存。同时，为了避免缓存击穿和缓存穿透，我们用本地缓存和tair组成了二级缓存，并使用定时任务定时将数据库中的数据刷新到tair。（注：不了解tair的话，可以简单理解为和redis类似）\n配置段（后台管理） 配置端会增删改pushPlan。\n问题描述 梳理到这里，其实很容易发现潜在的不一致性问题：\ntair和数据库不一致 投放端的本地缓存和Tair缓存不一致 投放端和配置端都用到了Tair缓存，需要是同一个，且key的拼写规则要保持一致 配置端采用的缓存一致性方案是：“修改前删缓存，查询后刷新”，删除后会导致投放端的缓存也被删除 本次的问题便出现在第4点：一旦数据在配置端被修改，那么在投放端本地缓存过期后，定时任务刷新tair前，查询出来的数据便是null，导致异常。\n至于前3点，此前的方案为：\n配置端通过“修改前删缓存，查询后刷新”解决，投放端使用定时任务刷新 减少本地缓存过期时间（本地缓存主要是避免缓存穿透和缓存击穿，过期时间可以设置地比较短，业务上可以接受短暂的不一致性） 谜题就在谜面上 问题原因 由于配置端每次更新是先删除缓存，再写数据库，此时在投放端定时任务刷新tair之前，查询缓存便是null。\n解决方案 写完数据库后刷新缓存。\n这是最直接的解决方案，既然之前删缓存不行，那就不删除，而是直接刷新缓存。刷新缓存后，配置端从数据库中取出的数据便为最新的数据。\n此处涉及到一个先刷新数据库，还是先刷新缓存之类的问题，这里简单列一下各方案及优缺点：\n方案 特点 先更新数据库，再更新缓存（建议） 优点：一致性更强：如果数据库更新成功，而缓存更新失败，可以通过重试机制解决，或者直接让缓存过期，保证了最终一致性。减少数据不一致的窗口期：因为更新缓存的操作通常比更新数据库快得多，所以更新完数据库后马上更新缓存，可以尽快保持它们之间的一致性。缺点：更新窗口期中的读操作可能导致脏读：如果在更新数据库后、更新缓存前有新的读请求，这时会读到旧的缓存数据。 先更新缓存，再更新数据库 优点：减少了脏读的可能：因为缓存是最先被更新的，读请求总是能读到最新的数据。缺点：一致性问题更为复杂：如果缓存更新成功，但是数据库更新失败，这会导致缓存和数据库之间出现长期的不一致状态，解决这种不一致状态需要额外的回滚操作，增加了系统的复杂性。需要处理回滚操作：如上所述，更新缓存成功而数据库更新失败时，需要有一套策略来回滚已经更新的缓存，确保数据一致性。 先删缓存，再更新数据库（不建议） 这种策略是指在更新数据之前，首先删除缓存中的数据，然后再更新数据库。优点：简单直接，逻辑清晰。缺点：可能导致窗口期一致性问题。在删除成功和数据库更新期间，如果有读操作发生，将会读取到旧的数据并且可能回填到缓存中，导致数据库与缓存数据不一致。 延时双删策略 延时双删涉及三个步骤：先删除缓存、更新数据库，然后过一段时间后再次删除缓存。优点：相对于“先删缓存，再更新数据库”策略，这种方法可以减少由于缓存窗口期造成的不一致概率。延迟第二次删除可以覆盖到那些在数据库更新过程中请求旧缓存的读操作，从而阻止这些操作将旧数据回填到缓存。缺点：增加了系统的复杂度，需要合适的机制来定时执行第二次删除操作。第二次删除的延迟时间不易确定，太短可能无效，太长则可能导致长时间的数据不一致。 安装redis linux安装redis 连接redis ./redis-cli 127.0.0.1:6379\u003e\n配置redis redis的配置文件位于Redis安装目录下，文件名为 redis.conf，可以通过CONFIG命令查看或者设置配置项。\n1 2 3 127.0.0.1:6379\u003e config get loglevel 1) \"loglevel\" 2) \"notice\" 使用*获取所有配置项 config get * 很多配置，这里就不贴了。参考这里 可以通过修改redis.conf文件或者使用config set 命令来修改配置\n1 2 127.0.0.1:6379\u003e config set loglevel 'notice' OK 如何停止/启动/重启redis服务 如果是用apt-get或者yum install安装的redis，可以直接通过下面的命令停止/启动/重启redis\n1 2 3 /etc/init.d/redis-server stop /etc/init.d/redis-server start /etc/init.d/redis-server restart 如果是通过源码安装的redis，可以通过redis的客户端程序redis-cli的shutdown命令来停止redis\nredis-cli -h 127.0.0.1 -p 6379 shutdown 或 ./redis-cli shutdown 没错，虽然启动的是server，但是这里停止的是redis-cli 如果上述方式都没有成功停止redis，则可以使用终极武器 kill -9\n启动redis： cd src ./redis-server 上面这种启动redis使用的是默认配置，也可以通过启动参数告诉redis使用指定配置 ./redis-server ../redis.conf\n让redis后台运行 ./redis-server \u0026 然后输入bg\nwindows安装redis5.x 参考 下载地址：https://github.com/tporadowski/redis/releases 这里下载的是 Redis-x64-5.0.10.msi 直接安装，安装过程勾选添加环境变量，其他都 next。 安装目录下，git bush执行命令： ./redis-server.exe redis.windows.conf\n如果显示： Redis is starting 就是redis已经在运行了。两种解决办法：\n运行redis安装目录的redis-cli.exe，shutdown，显示not connected\u003eexit。 找到windows服务，找到redis，停止，禁用自启。 redis设置密码，修改配置文件 redis.windows.conf：\n1 2 # requirepass foobared requirepass 123456 之后启动 redis 需要指定配置文件： redis-server.exe redis.windows.conf\nredis命令 参考redis中文官网\nkey del del用于删除已存在的键，不存在的 key 会被忽略 del key_name 返回被删除key的数量\ndump DUMP 命令用于序列化给定 key ，并返回被序列化的值 DUMP KEY_NAME 如果 key 不存在，那么返回 nil 。 否则，返回序列化之后的值。\nexist EXISTS 命令用于检查给定 key 是否存在。 EXISTS KEY_NAME 若 key 存在返回 1 ，否则返回 0 。\nexpire Expire 命令用于设置 key 的过期时间。key 过期后将不再可用。 Expire KEY_NAME TIME_IN_SECONDS 设置成功返回1， 当key不存在或者不能为key设置过期时间时返回0。\nexpireat Expireat 命令用于以 UNIX 时间戳(unix timestamp)格式设置 key 的过期时间。key 过期后将不再可用。 Expireat KEY_NAME TIME_IN_UNIX_TIMESTAMP 设置成功返回1，不成功或不存在返回0。 示例： EXPIREAT w3ckey 1293840000\nkeys Keys 命令用于查找所有符合给定模式 pattern 的 key KEYS PATTERN 返回符合给定模式的 key 列表 (Array)。\n查找以w3c开头的key： keys w3c* 查找所有的key keys *\nmove move命令用于将当前数据库的key移动到给定的数据库db当中。 MOVE KEY_NAME DESTINATION_DATABASE 移动成功返回 1 ，失败则返回 0 。\n示例：\n1 2 3 4 5 6 SELECT 0 # redis默认使用数据库 0，为了清晰起见，这里再显式指定一次。 set w3c redis #设置一个key move w3c 1 #转移到1库 exist w3c #发现w3c已经没有了 select 1 #选择1库 exist w3c #发现w3c已经转移到1库中 不存在的key无法转移 当源数据库和目标数据库有相同的 key 时，key无法转移。 persist persist命令用于移除给定 key 的过期时间，使得 key 永不过期。 PERSIST KEY_NAME 当过期时间移除成功时，返回 1 。 如果 key 不存在或 key 没有设置过期时间，返回 0 。\npttl Pttl 命令以毫秒为单位返回 key 的剩余过期时间。 PTTL KEY_NAME 当 key 不存在时，返回 -2 。 当 key 存在但没有设置剩余生存时间时，返回 -1 。 否则，以毫秒为单位，返回 key 的剩余生存时间。\nTTL TTL 命令以秒为单位返回 key 的剩余过期时间。 TTL KEY_NAME 当 key 不存在时，返回 -2 。 当 key 存在但没有设置剩余生存时间时，返回 -1 。 否则，以秒为单位，返回 key 的剩余生存时间。\nrandomkey RANDOMKEY 命令从当前数据库中随机返回一个 key 。 randomkey 当数据库不为空时，返回一个 key 。 当数据库为空时，返回 nil 。\nrename Rename 命令用于修改 key 的名称 。 RENAME OLD_KEY_NAME NEW_KEY_NAME 改名成功时提示 OK ，失败时候返回一个错误。 当 OLD_KEY_NAME 和 NEW_KEY_NAME 相同，或者 OLD_KEY_NAME 不存在时，返回一个错误。 当 NEW_KEY_NAME 已经存在时， RENAME 命令将覆盖旧值。\nrenamenx Renamenx 命令用于在新的 key 不存在时修改 key 的名称 。 RENAMENX OLD_KEY_NAME NEW_KEY_NAME 修改成功时，返回 1 。 如果 NEW_KEY_NAME 已经存在，返回 0 。\ntype Type 命令用于返回 key 所储存的值的类型。 TYPE KEY_NAME 返回 key 的数据类型，数据类型有：\n1 2 3 4 5 6 none (key不存在) string (字符串) list (列表) set (集合) zset (有序集) hash (哈希表) string set SET 命令用于设置给定 key 的值。如果 key 已经存储其他值， SET 就覆写旧值，且无视类型。 SET KEY_NAME VALUE 从 Redis 2.6.12 版本开始， SET 在设置操作成功完成时，才返回 OK 。\nget Get 命令用于获取指定 key 的值。 GET KEY_NAME 如果 key 不存在，返回 nil 。如果key 储存的值不是字符串类型，返回一个错误。\ngetrange getrange命令用于获取存储在指定 key 中字符串的子字符串。字符串的截取范围由 start 和 end 两个偏移量决定(包括 start 和 end 在内)。 getrange KEY_NAME start end\n示例：首先，设置 mykey 的值并截取字符串。\n1 2 3 4 5 6 redis 127.0.0.1:6379\u003e SET mykey \"This is my test key\" OK redis 127.0.0.1:6379\u003e GETRANGE mykey 0 3 \"This\" redis 127.0.0.1:6379\u003e GETRANGE mykey 0 -1 \"This is my test key\" getset getset 命令用于设置指定 key 的值，并返回 key 旧的值。 getset key_name value 返回给定 key 的旧值。 当 key 没有旧值时，即 key 不存在时，返回 nil 。 当 key 存在但不是字符串类型时，返回一个错误。 示例：首先，设置 mykey 的值并截取字符串。\n1 2 3 4 redis 127.0.0.1:6379\u003e GETSET mynewkey \"This is my test key\" (nil) redis 127.0.0.1:6379\u003e GETSET mynewkey \"This is my new value to test getset\" \"This is my test key\" getbit getbit 命令用于对 key 所储存的字符串值，获取指定偏移量上的位(bit)。 getbit key_name offset 返回字符串值指定偏移量上的位(bit)。 当偏移量 OFFSET 比字符串值的长度大，或者 key 不存在时，返回 0 。\nsetbit setbit命令用于对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)。 setbit key_name offset 返回指定偏移量原来储存的位。\nmget mget命令返回所有(一个或多个)给定 key 的值。 如果给定的 key 里面，有某个 key 不存在，那么这个 key 返回特殊值 nil 。 MGET KEY1 KEY2 .. KEYN\nsetex setex 命令为指定的 key 设置值及其过期时间。如果 key 已经存在， SETEX 命令将会替换旧的值。 setex key_name timeout value 设置成功时返回 OK 。 说白了就是在设置一个值的时候直接就指定了过期时间。\nsetnx setnx(SET if Not eXists)命令在指定的 key 不存在时，为 key 设置指定的值。 setnx key_name value 设置成功，返回 1 。 设置失败，返回 0 。\n1 2 3 4 5 6 7 8 redis\u003e EXISTS job # job 不存在 (integer) 0 redis\u003e SETNX job \"programmer\" # job 设置成功 (integer) 1 redis\u003e SETNX job \"code-farmer\" # 尝试覆盖 job ，失败 (integer) 0 redis\u003e GET job # 没有被覆盖 \"programmer\" setrange setrange 命令用指定的字符串覆盖给定 key 所储存的字符串值，覆盖的位置从偏移量 offset 开始。 SETRANGE KEY_NAME OFFSET VALUE 返回被修改后的字符串长度。 就是从指定位置修改字符串的内容。\nstrlen strlen 命令用于获取指定 key 所储存的字符串值的长度。当 key 储存的不是字符串值时，返回一个错误。 strlen key_name 返回字符串值的长度。 当 key 不存在时，返回 0。\nmset mset 命令用于同时设置一个或多个 key-value 对。 MSET key1 value1 key2 value2 .. keyN valueN 总是返回OK\nmsetnx msetnx 命令用于所有给定 key 都不存在时，同时设置一个或多个 key-value 对。 MSETNX key1 value1 key2 value2 .. keyN valueN 当所有 key 都成功设置，返回 1 。 如果所有给定 key 都设置失败(至少有一个 key 已经存在)，那么返回 0 。\nmsetnx是原子性操作，只要有一个值失败，所有的值都不会被设置。\npsetex psetex 命令以毫秒为单位设置 key 的生存时间。 PSETEX key1 EXPIRY_IN_MILLISECONDS value1 设置成功时返回 OK 。\nincr incr 命令将 key 中储存的数字值增一。 如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 INCR 操作。 如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。 本操作的值限制在 64 位(bit)有符号数字表示之内。 incr key_name 返回执行incr命令之后 key 的值。\nincrby incrby命令将 key 中储存的数字加上指定的增量值。 如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 INCRBY 命令。 如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。 本操作的值限制在 64 位(bit)有符号数字表示之内。 incr key_name incr_amount 返回加上指定的增量值之后， key 的值。\nincrbyfloat incrbyfloat命令为 key 中所储存的值加上指定的浮点数增量值。 incrbyfloat key_name incr_amount 返回执行命令之后 key 的值。\n用 SET 设置的值可以是指数符号314e-2，但执行 INCRBYFLOAT 之后格式会被改成非指数符号3.14 SET 设置的值小数部分可以是 03.0，但 INCRBYFLOAT 会将无用的 0 忽略掉，有需要的话，将浮点变为整数4\ndecr decr 命令将 key 中储存的数字值减一。 如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 DECR 操作。 如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。 本操作的值限制在 64 位(bit)有符号数字表示之内。 decr key_name 返回执行命令之后 key 的值。\ndecrby decrby 命令将 key 所储存的值减去指定的减量值。 如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 DECRBY 操作。 如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。 本操作的值限制在 64 位(bit)有符号数字表示之内。 decrby key_name decrement_amount 返回减去指定减量值之后， key 的值。\nappend append 命令用于为指定的 key 追加值。 如果 key 已经存在并且是一个字符串， APPEND 命令将 value 追加到 key 原来的值的末尾。 如果 key 不存在， APPEND 就简单地将给定 key 设为 value ，就像执行 SET key value 一样。 append key_name new_value 返回追加指定值之后， key 中字符串的长度。\nhash hdel hdel 命令用于删除哈希表 key 中的一个或多个指定字段，不存在的字段将被忽略。 HDEL KEY_NAME FIELD1.. FIELDN 被成功删除字段的数量，不包括被忽略的字段。\nhexists hexists 命令用于查看哈希表的指定字段是否存在。 HEXISTS KEY_NAME FIELD_NAME 如果哈希表含有给定字段，返回 1 。 如果哈希表不含有给定字段，或 key 不存在，返回 0 。\nhget hget 命令用于返回哈希表中指定字段的值。 HGET KEY_NAME FIELD_NAME 返回给定字段的值。如果给定的字段或 key 不存在时，返回 nil 。\nhgetall hgetall 命令用于返回哈希表中，所有的字段和值。 在返回值里，紧跟每个字段名(field name)之后是字段的值(value)，所以返回值的长度是哈希表大小的两倍。 HGETALL KEY_NAME 以列表形式返回哈希表的字段及字段值。 若 key 不存在，返回空列表。\nhincrby hincrby 命令用于为哈希表中的字段值加上指定增量值。 增量也可以为负数，相当于对指定字段进行减法操作。 如果哈希表的 key 不存在，一个新的哈希表被创建并执行 HINCRBY 命令。 如果指定的字段不存在，那么在执行命令前，字段的值被初始化为 0 。 对一个储存字符串值的字段执行 HINCRBY 命令将造成一个错误。 本操作的值被限制在 64 位(bit)有符号数字表示之内。 HINCRBY KEY_NAME FIELD_NAME INCR_BY_NUMBER hincrbyfloat hincrbyfloat 命令用于为哈希表中的字段值加上指定浮点数增量值。 如果指定的字段不存在，那么在执行命令前，字段的值被初始化为 0 。 HINCRBYFLOAT KEY_NAME FIELD_NAME INCR_BY_NUMBER 返回执行 Hincrbyfloat 命令之后，哈希表中字段的值。\nhkeys hkeys 命令用于获取哈希表中的所有字段名。 HKEYS KEY_NAME FIELD_NAME INCR_BY_NUMBER 包含哈希表中所有字段的列表。 当 key 不存在时，返回一个空列表。\nhlen hlen 命令用于获取哈希表中字段的数量。 HLEN KEY_NAME 返回哈希表中字段的数量。 当 key 不存在时，返回 0 。\nhmget hmget 命令用于返回哈希表中，一个或多个给定字段的值。 如果指定的字段不存在于哈希表，那么返回一个 nil 值。 HMGET KEY_NAME FIELD1...FIELDN 返回一个包含多个给定字段关联值的表，表值的排列顺序和指定字段的请求顺序一样。\nhmset hmset 命令用于同时将多个 field-value (字段-值)对设置到哈希表中。 此命令会覆盖哈希表中已存在的字段。 如果哈希表不存在，会创建一个空哈希表，并执行 HMSET 操作。 HMSET KEY_NAME FIELD1 VALUE1 ...FIELDN VALUEN\nhset hset 命令用于为哈希表中的字段赋值 。 如果哈希表不存在，一个新的哈希表被创建并进行 HSET 操作。 如果字段已经存在于哈希表中，旧值将被覆盖。 HSET KEY_NAME FIELD VALUE 返回如果字段是哈希表中的一个新建字段，并且值设置成功，返回 1 。 如果哈希表中域字段已经存在且旧值已被新值覆盖，返回 0 。\nhsetnx hsetnx 命令用于为哈希表中不存在的的字段赋值 。 如果哈希表不存在，一个新的哈希表被创建并进行 HSET 操作。 如果字段已经存在于哈希表中，操作无效。 如果 key 不存在，一个新哈希表被创建并执行 HSETNX 命令。 HSETNX KEY_NAME FIELD VALUE 设置成功，返回 1 。 如果给定字段已经存在且没有操作被执行，返回 0 。\nhvals hvals 命令返回哈希表所有字段的值。 HVALS KEY_NAME FIELD VALUE 返回一个包含哈希表中所有值的表。 当 key 不存在时，返回一个空表。\n连接操作命令 quit：关闭连接（connection） auth：简单密码认证 help cmd： 查看cmd帮助，例如：help quit\n持久化 save：将数据同步保存到磁盘 bgsave：将数据异步保存到磁盘 lastsave：返回上次成功将数据保存到磁盘的Unix时戳 shundown：将数据同步保存到磁盘，然后关闭服务\n远程服务控制 info：提供服务器的信息和统计 monitor：实时转储收到的请求 slaveof：改变复制策略设置 config：在运行时配置Redis服务器\n对value操作的命令 exists(key)：确认一个key是否存在 del(key)：删除一个key type(key)：返回值的类型 keys(pattern)：返回满足给定pattern的所有key randomkey：随机返回key空间的一个 keyrename(oldname, newname)：重命名key dbsize：返回当前数据库中key的数目 expire：设定一个key的活动时间（s） ttl：获得一个key的活动时间 select(index)：按索引查询 move(key, dbindex)：移动当前数据库中的key到dbindex数据库 flushdb：删除当前选择数据库中的所有key flushall：删除所有数据库中的所有key\nString set(key, value)：给数据库中名称为key的string赋予值value get(key)：返回数据库中名称为key的string的value getset(key, value)：给名称为key的string赋予上一次的value mget(key1, key2,…, key N)：返回库中多个string的value setnx(key, value)：添加string，名称为key，值为value setex(key, time, value)：向库中添加string，设定过期时间time mset(key N, value N)：批量设置多个string的值 msetnx(key N, value N)：如果所有名称为key i的string都不存在 incr(key)：名称为key的string增1操作 incrby(key, integer)：名称为key的string增加integer decr(key)：名称为key的string减1操作 decrby(key, integer)：名称为key的string减少integer append(key, value)：名称为key的string的值附加value substr(key, start, end)：返回名称为key的string的value的子串\nList rpush(key, value)：在名称为key的list尾添加一个值为value的元素 lpush(key, value)：在名称为key的list头添加一个值为value的 元素 llen(key)：返回名称为key的list的长度 lrange(key, start, end)：返回名称为key的list中start至end之间的元素 ltrim(key, start, end)：截取名称为key的list lindex(key, index)：返回名称为key的list中index位置的元素 lset(key, index, value)：给名称为key的list中index位置的元素赋值 lrem(key, count, value)：删除count个key的list中值为value的元素 lpop(key)：返回并删除名称为key的list中的首元素 rpop(key)：返回并删除名称为key的list中的尾元素 blpop(key1, key2,… key N, timeout)：lpop命令的block版本。 brpop(key1, key2,… key N, timeout)：rpop的block版本。 rpoplpush(srckey, dstkey)：返回并删除名称为srckey的list的尾元素，并将该元素添加到名称为dstkey的list的头部\nSet sadd(key, member)：向名称为key的set中添加元素member srem(key, member) ：删除名称为key的set中的元素member spop(key) ：随机返回并删除名称为key的set中一个元素 smove(srckey, dstkey, member) ：移到集合元素 scard(key) ：返回名称为key的set的基数 sismember(key, member) ：member是否是名称为key的set的元素 sinter(key1, key2,…key N) ：求交集 sinterstore(dstkey, (keys)) ：求交集并将交集保存到dstkey的集合 sunion(key1, (keys)) ：求并集 sunionstore(dstkey, (keys)) ：求并集并将并集保存到dstkey的集合 sdiff(key1, (keys)) ：求差集 sdiffstore(dstkey, (keys)) ：求差集并将差集保存到dstkey的集合 smembers(key) ：返回名称为key的set的所有元素 srandmember(key) ：随机返回名称为key的set的一个元素\nHash hset(key, field, value)：向名称为key的hash中添加元素field hget(key, field)：返回名称为key的hash中field对应的value hmget(key, (fields))：返回名称为key的hash中field i对应的value hmset(key, (fields))：向名称为key的hash中添加元素field hincrby(key, field, integer)：将名称为key的hash中field的value增加integer hexists(key, field)：名称为key的hash中是否存在键为field的域 hdel(key, field)：删除名称为key的hash中键为field的域 hlen(key)：返回名称为key的hash中元素个数 hkeys(key)：返回名称为key的hash中所有键 hvals(key)：返回名称为key的hash中所有键对应的value hgetall(key)：返回名称为key的hash中所有的键（field）及其对应的value\n功能实现 使用RedisTemplate 存储键值出现乱码 最近使用spring-data-redis RedisTemplate 操作redis时发现存储在redis中的key不是设置的string值，前面还多出了许多类似\\xac\\xed\\x00\\x05t\\x00这种字符串，如下\n1 2 3 4 127.0.0.1:6379\u003e keys * 1) \"\\xac\\xed\\x00\\x05t\\x00\\x04pass\" 2) \"\\xac\\xed\\x00\\x05t\\x00\\x04name\" 3) \"name\" 解决：使用StringRedisTemplate，而不是RedisTemplate。\nRedisTemplate和StringRedisTemplate的区别 StringRedisTemplate继承RedisTemplate StringRedisTemplate只能管理StringRedisTemplate里面的数据，RedisTemplate只能管理RedisTemplate中的数据。 SDR(spring-date-redis)默认采用的序列化策略有两种，一种是String的序列化策略，一种是JDK的序列化策略。 StringRedisTemplate默认采用的是String的序列化策略，保存的key和value都是采用此策略序列化保存的。 RedisTemplate默认采用的是JDK的序列化策略，保存的key和value都是采用此策略序列化保存的。 RedisTemplate使用的序列类在在操作数据的时候，比如说存入数据会将数据先序列化成字节数组然后在存入Redis数据库，这个时候打开Redis查看的时候，你会看到你的数据不是以可读的形式展现的，而是以字节数组显示，类似下面 key: \\xAC\\xED\\x00\\x05sr\\x00\nvalue: \\xAC\\xED\\x00\\x05sr\\x00\\x13java.util.ArrayList...\n总结： 当redis中本来存的是字符串数据，或者你要存取的数据就是字符串类型数据的时候，那么你就使用StringRedisTemplate即可，但是如果你的数据是复杂的对象类型，而取出的时候又不想做任何的数据转换，直接从Redis里面取出一个对象，那么使用RedisTemplate是更好的选择。\n通过notify-keyspace-events实现订单自动关闭功能 修改Redis配置文件，开启过期通知功能。 在配置文件中搜索notify，找到# notify-keyspace-events Ex这一行，将注释去掉。 同时注释掉下面一行notify-keyspace-events \"\"， 为了节约cup资源，事件通知默认是没有开启的，即notify-keyspace-events \"\"\n修改之后在需要重启redis，然后通过cli查看配置是否生效，config get notify-keyspace-events，如果显示Ex（或者xE），就生效了。\n在程序中使用redis：\n1 2 3 //引入redis @Resource private RedisTemplate redisTemplate; 设置key redisTemplate.opsForValue().set(orderNo, \"value是随便写的，因为过期通知无法取得value\", 10, TimeUnit.SECONDS);\n配置过期监听\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 @Slf4j @Component public class RedisTask extends KeyExpirationEventMessageListener { @Autowired private ExecuteHandle executeHandle; /** * * @param listenerContainer must not be {@literal null}. */ public RedisTask(RedisMessageListenerContainer listenerContainer) { super(listenerContainer); } @Override public void onMessage(Message message, byte[] pattern) { String channel = new String(message.getChannel(), StandardCharsets.UTF_8); //过期的key String key = new String(message.getBody(), StandardCharsets.UTF_8); //在这里，可以过滤调我们不需要的key if(key.startsWith(\"shiro_redis_session\")){ return; } log.info(\"redis key 过期：pattern={},channel={},key={}\",new String(pattern),channel,key); //业务逻辑，取消订单什么的 executeHandle.handle(key); } } 因为我们会有很多类型的过期key，所以需要区分\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 //处理基类， public abstract class AbstractRedisExpireHandle { //通过前缀区分过期的key private String prefix; public String getPrefix() { return prefix; } public void setPrefix(String prefix) { this.prefix = prefix; } public AbstractRedisExpireHandle(){} //处理redis过期的key abstract void expireHandle(String redisKey); } /** * 商品订单过期 */ @Component public class OrderExpireHandle extends AbstractRedisExpireHandle { private static final String PREFIX = \"12\"; public OrderExpireHandle(){ setPrefix(PREFIX); } @Reference(version = \"1.0.0\") private TaskService taskService; @Override void expireHandle(String redisKey) { //业务逻辑 taskService.orderExpireHandle(redisKey); } } 具体处理类\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 @Slf4j @Component public class ExecuteHandle implements ApplicationContextAware, InitializingBean { //spring容器 private ApplicationContext context; //过期key处理器 private List expireHandles = new ArrayList\u003c\u003e(); /** * 程序启动，将各个处理类，放到list中 * @throws Exception */ @Override public void afterPropertiesSet() throws Exception { String[] beanNames = BeanFactoryUtils.beanNamesForTypeIncludingAncestors(context,AbstractRedisExpireHandle.class); for(int i=0;i",
  "wordCount" : "45837",
  "inLanguage": "en",
  "datePublished": "2018-10-06T18:10:43Z",
  "dateModified": "2018-10-06T18:10:43Z",
  "author":{
    "@type": "Person",
    "name": "Wjy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://funny-toffee-4aa7c3.netlify.app/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://funny-toffee-4aa7c3.netlify.app/favicon.ico"
    }
  }
}
</script>

  <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.min.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath:  [['\\(', '\\)'], ['$', '$']],  
    }
  };
</script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://funny-toffee-4aa7c3.netlify.app/en/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://funny-toffee-4aa7c3.netlify.app/en/">Home</a>&nbsp;»&nbsp;<a href="https://funny-toffee-4aa7c3.netlify.app/en/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      redis
    </h1>
    <div class="post-meta"><span title='2018-10-06 18:10:43 +0000 UTC'>2018-10-06</span>&nbsp;·&nbsp;Wjy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%a6%82%e5%bf%b5" aria-label="概念">概念</a><ul>
                        
                <li>
                    <a href="#redis%e7%bc%93%e5%ad%98%e7%a9%bf%e9%80%8f" aria-label="redis缓存穿透">redis缓存穿透</a></li>
                <li>
                    <a href="#%e7%bc%93%e5%ad%98%e9%9b%aa%e5%b4%a9" aria-label="缓存雪崩">缓存雪崩</a></li>
                <li>
                    <a href="#%e7%bc%93%e5%ad%98%e5%87%bb%e7%a9%bf" aria-label="缓存击穿">缓存击穿</a></li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e4%b8%80%e8%87%b4%e6%80%a7" aria-label="数据一致性">数据一致性</a><ul>
                        
                <li>
                    <a href="#%e5%ae%9e%e6%97%b6%e5%bc%ba%e4%b8%80%e8%87%b4%e6%80%a7" aria-label="实时强一致性">实时强一致性</a></li>
                <li>
                    <a href="#%e6%9c%80%e7%bb%88%e4%b8%80%e8%87%b4%e6%80%a7" aria-label="最终一致性">最终一致性</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%bc%93%e5%ad%98%e6%9b%b4%e6%96%b0%e7%ad%96%e7%95%a5" aria-label="缓存更新策略">缓存更新策略</a></li>
                <li>
                    <a href="#%e7%bc%93%e5%ad%98%e5%a4%b1%e6%95%88%e7%ad%96%e7%95%a5" aria-label="缓存失效策略">缓存失效策略</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e7%bc%93%e5%ad%98%e4%b8%80%e8%87%b4%e6%80%a7%e5%8d%8f%e8%ae%ae" aria-label="使用缓存一致性协议">使用缓存一致性协议</a></li>
                <li>
                    <a href="#%e5%88%86%e5%b8%83%e5%bc%8f%e7%bc%93%e5%ad%98%e7%b3%bb%e7%bb%9f" aria-label="分布式缓存系统">分布式缓存系统</a></li>
                <li>
                    <a href="#%e7%bc%93%e5%ad%98%e4%b8%80%e8%87%b4%e6%80%a7%e5%9c%ba%e6%99%af%e5%92%8c%e9%97%ae%e9%a2%98" aria-label="缓存一致性场景和问题">缓存一致性场景和问题</a><ul>
                        
                <li>
                    <a href="#%e6%8a%95%e6%94%be%e6%ae%b5%e7%94%a8%e6%88%b7%e7%ab%af" aria-label="投放段（用户端）">投放段（用户端）</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae%e6%ae%b5%e5%90%8e%e5%8f%b0%e7%ae%a1%e7%90%86" aria-label="配置段（后台管理）">配置段（后台管理）</a></li>
                <li>
                    <a href="#%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0" aria-label="问题描述">问题描述</a></li>
                <li>
                    <a href="#%e9%97%ae%e9%a2%98%e5%8e%9f%e5%9b%a0" aria-label="问题原因">问题原因</a></li>
                <li>
                    <a href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" aria-label="解决方案">解决方案</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85redis" aria-label="安装redis">安装redis</a><ul>
                        
                <li>
                    <a href="#linux%e5%ae%89%e8%a3%85redis" aria-label="linux安装redis">linux安装redis</a><ul>
                        
                <li>
                    <a href="#%e8%bf%9e%e6%8e%a5redis" aria-label="连接redis">连接redis</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%aeredis" aria-label="配置redis">配置redis</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e5%81%9c%e6%ad%a2%e5%90%af%e5%8a%a8%e9%87%8d%e5%90%afredis%e6%9c%8d%e5%8a%a1" aria-label="如何停止/启动/重启redis服务">如何停止/启动/重启redis服务</a></li></ul>
                </li>
                <li>
                    <a href="#windows%e5%ae%89%e8%a3%85redis5x" aria-label="windows安装redis5.x">windows安装redis5.x</a></li></ul>
                </li>
                <li>
                    <a href="#redis%e5%91%bd%e4%bb%a4" aria-label="redis命令">redis命令</a><ul>
                        
                <li>
                    <a href="#key" aria-label="key">key</a><ul>
                        
                <li>
                    <a href="#del" aria-label="del">del</a></li>
                <li>
                    <a href="#dump" aria-label="dump">dump</a></li>
                <li>
                    <a href="#exist" aria-label="exist">exist</a></li>
                <li>
                    <a href="#expire" aria-label="expire">expire</a></li>
                <li>
                    <a href="#expireat" aria-label="expireat">expireat</a></li>
                <li>
                    <a href="#keys" aria-label="keys">keys</a></li>
                <li>
                    <a href="#move" aria-label="move">move</a></li>
                <li>
                    <a href="#persist" aria-label="persist">persist</a></li>
                <li>
                    <a href="#pttl" aria-label="pttl">pttl</a></li>
                <li>
                    <a href="#ttl" aria-label="TTL">TTL</a></li>
                <li>
                    <a href="#randomkey" aria-label="randomkey">randomkey</a></li>
                <li>
                    <a href="#rename" aria-label="rename">rename</a></li>
                <li>
                    <a href="#renamenx" aria-label="renamenx">renamenx</a></li>
                <li>
                    <a href="#type" aria-label="type">type</a></li></ul>
                </li>
                <li>
                    <a href="#string" aria-label="string">string</a><ul>
                        
                <li>
                    <a href="#set" aria-label="set">set</a></li>
                <li>
                    <a href="#get" aria-label="get">get</a></li>
                <li>
                    <a href="#getrange" aria-label="getrange">getrange</a></li>
                <li>
                    <a href="#getset" aria-label="getset">getset</a></li>
                <li>
                    <a href="#getbit" aria-label="getbit">getbit</a></li>
                <li>
                    <a href="#setbit" aria-label="setbit">setbit</a></li>
                <li>
                    <a href="#mget" aria-label="mget">mget</a></li>
                <li>
                    <a href="#setex" aria-label="setex">setex</a></li>
                <li>
                    <a href="#setnx" aria-label="setnx">setnx</a></li>
                <li>
                    <a href="#setrange" aria-label="setrange">setrange</a></li>
                <li>
                    <a href="#strlen" aria-label="strlen">strlen</a></li>
                <li>
                    <a href="#mset" aria-label="mset">mset</a></li>
                <li>
                    <a href="#msetnx" aria-label="msetnx">msetnx</a></li>
                <li>
                    <a href="#psetex" aria-label="psetex">psetex</a></li>
                <li>
                    <a href="#incr" aria-label="incr">incr</a></li>
                <li>
                    <a href="#incrby" aria-label="incrby">incrby</a></li>
                <li>
                    <a href="#incrbyfloat" aria-label="incrbyfloat">incrbyfloat</a></li>
                <li>
                    <a href="#decr" aria-label="decr">decr</a></li>
                <li>
                    <a href="#decrby" aria-label="decrby">decrby</a></li>
                <li>
                    <a href="#append" aria-label="append">append</a></li></ul>
                </li>
                <li>
                    <a href="#hash" aria-label="hash">hash</a><ul>
                        
                <li>
                    <a href="#hdel" aria-label="hdel">hdel</a></li>
                <li>
                    <a href="#hexists" aria-label="hexists">hexists</a></li>
                <li>
                    <a href="#hget" aria-label="hget">hget</a></li>
                <li>
                    <a href="#hgetall" aria-label="hgetall">hgetall</a></li>
                <li>
                    <a href="#hincrby" aria-label="hincrby">hincrby</a></li>
                <li>
                    <a href="#hincrbyfloat" aria-label="hincrbyfloat">hincrbyfloat</a></li>
                <li>
                    <a href="#hkeys" aria-label="hkeys">hkeys</a></li>
                <li>
                    <a href="#hlen" aria-label="hlen">hlen</a></li>
                <li>
                    <a href="#hmget" aria-label="hmget">hmget</a></li>
                <li>
                    <a href="#hmset" aria-label="hmset">hmset</a></li>
                <li>
                    <a href="#hset" aria-label="hset">hset</a></li>
                <li>
                    <a href="#hsetnx" aria-label="hsetnx">hsetnx</a></li>
                <li>
                    <a href="#hvals" aria-label="hvals">hvals</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%bf%9e%e6%8e%a5%e6%93%8d%e4%bd%9c%e5%91%bd%e4%bb%a4" aria-label="连接操作命令">连接操作命令</a></li>
                <li>
                    <a href="#%e6%8c%81%e4%b9%85%e5%8c%96" aria-label="持久化">持久化</a></li>
                <li>
                    <a href="#%e8%bf%9c%e7%a8%8b%e6%9c%8d%e5%8a%a1%e6%8e%a7%e5%88%b6" aria-label="远程服务控制">远程服务控制</a></li>
                <li>
                    <a href="#%e5%af%b9value%e6%93%8d%e4%bd%9c%e7%9a%84%e5%91%bd%e4%bb%a4" aria-label="对value操作的命令">对value操作的命令</a></li>
                <li>
                    <a href="#string-1" aria-label="String">String</a></li>
                <li>
                    <a href="#list" aria-label="List">List</a></li>
                <li>
                    <a href="#set-1" aria-label="Set">Set</a></li>
                <li>
                    <a href="#hash-1" aria-label="Hash">Hash</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8a%9f%e8%83%bd%e5%ae%9e%e7%8e%b0" aria-label="功能实现">功能实现</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8redistemplate-%e5%ad%98%e5%82%a8%e9%94%ae%e5%80%bc%e5%87%ba%e7%8e%b0%e4%b9%b1%e7%a0%81" aria-label="使用RedisTemplate 存储键值出现乱码">使用RedisTemplate 存储键值出现乱码</a></li>
                <li>
                    <a href="#redistemplate%e5%92%8cstringredistemplate%e7%9a%84%e5%8c%ba%e5%88%ab" aria-label="RedisTemplate和StringRedisTemplate的区别">RedisTemplate和StringRedisTemplate的区别</a></li>
                <li>
                    <a href="#%e9%80%9a%e8%bf%87notify-keyspace-events%e5%ae%9e%e7%8e%b0%e8%ae%a2%e5%8d%95%e8%87%aa%e5%8a%a8%e5%85%b3%e9%97%ad%e5%8a%9f%e8%83%bd" aria-label="通过notify-keyspace-events实现订单自动关闭功能">通过notify-keyspace-events实现订单自动关闭功能</a></li>
                <li>
                    <a href="#redis%e5%93%a8%e5%85%b5" aria-label="redis哨兵">redis哨兵</a><ul>
                        
                <li>
                    <a href="#java%e4%b8%ad%e4%bd%bf%e7%94%a8%e5%93%a8%e5%85%b5%e6%a8%a1%e5%bc%8f" aria-label="Java中使用哨兵模式">Java中使用哨兵模式</a></li>
                <li>
                    <a href="#%e5%93%a8%e5%85%b5%e6%a8%a1%e5%bc%8f%e7%9a%84%e5%85%b6%e4%bb%96%e9%85%8d%e7%bd%ae%e9%a1%b9" aria-label="哨兵模式的其他配置项">哨兵模式的其他配置项</a></li></ul>
                </li>
                <li>
                    <a href="#redis%e4%b8%bb%e4%bb%8e%e9%85%8d%e7%bd%ae%e5%93%a8%e5%85%b5%e6%a8%a1%e5%bc%8fdocker%e5%ae%9e%e7%8e%b0" aria-label="Redis主从配置、哨兵模式（Docker实现）">Redis主从配置、哨兵模式（Docker实现）</a><ul>
                        
                <li>
                    <a href="#%e5%93%a8%e5%85%b5%e6%a8%a1%e5%bc%8f" aria-label="哨兵模式">哨兵模式</a></li></ul>
                </li>
                <li>
                    <a href="#redisson-%e5%ae%9e%e7%8e%b0%e5%88%86%e5%b8%83%e5%bc%8f%e9%94%81" aria-label="redisson 实现分布式锁">redisson 实现分布式锁</a><ul>
                        
                <li>
                    <a href="#1-%e5%bc%95%e5%85%a5%e4%be%9d%e8%b5%96" aria-label="1. 引入依赖">1. 引入依赖</a></li>
                <li>
                    <a href="#2-%e9%85%8d%e7%bd%aeredis" aria-label="2. 配置Redis">2. 配置Redis</a></li>
                <li>
                    <a href="#3-%e9%85%8d%e7%bd%ae%e7%b1%bb" aria-label="3. 配置类">3. 配置类</a></li>
                <li>
                    <a href="#4-%e4%bd%bf%e7%94%a8redisson%e5%88%86%e5%b8%83%e5%bc%8f%e9%94%81" aria-label="4. 使用Redisson分布式锁">4. 使用Redisson分布式锁</a></li>
                <li>
                    <a href="#waittime-%e7%ad%89%e5%be%85%e6%97%b6%e9%97%b4" aria-label="waitTime (等待时间)">waitTime (等待时间)</a></li>
                <li>
                    <a href="#leasetime-%e6%8c%81%e6%9c%89%e6%97%b6%e9%97%b4" aria-label="leaseTime (持有时间)">leaseTime (持有时间)</a></li></ul>
                </li>
                <li>
                    <a href="#redis-setnx-%e5%91%bd%e4%bb%a4%e5%ae%9e%e7%8e%b0%e5%88%86%e5%b8%83%e5%bc%8f%e9%94%81%e4%b8%8d%e6%8e%a8%e8%8d%90%e8%af%b7%e4%bd%bf%e7%94%a8redisson" aria-label="Redis SETNX 命令实现分布式锁（不推荐，请使用redisson）">Redis SETNX 命令实现分布式锁（不推荐，请使用redisson）</a></li>
                <li>
                    <a href="#redis-key%e7%9a%84%e8%ae%be%e8%ae%a1" aria-label="redis key的设计">redis key的设计</a></li></ul>
                </li>
                <li>
                    <a href="#jedis%e6%93%8d%e4%bd%9credis" aria-label="Jedis操作redis">Jedis操作redis</a><ul>
                        
                <li>
                    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96" aria-label="初始化">初始化</a></li>
                <li>
                    <a href="#key-1" aria-label="key">key</a></li>
                <li>
                    <a href="#string-2" aria-label="string">string</a></li>
                <li>
                    <a href="#list-1" aria-label="list">list</a></li>
                <li>
                    <a href="#set-2" aria-label="set">set</a></li>
                <li>
                    <a href="#sortedset" aria-label="SortedSet">SortedSet</a></li>
                <li>
                    <a href="#hash-2" aria-label="hash">hash</a></li></ul>
                </li>
                <li>
                    <a href="#redistemplate" aria-label="Redistemplate">Redistemplate</a><ul>
                        
                <li>
                    <a href="#%e7%ae%80%e4%bb%8b" aria-label="简介">简介</a></li>
                <li>
                    <a href="#%e6%95%b4%e5%90%88spring-boot" aria-label="整合spring boot">整合spring boot</a></li>
                <li>
                    <a href="#redistemplate%e6%93%8d%e4%bd%9credis" aria-label="RedisTemplate操作Redis">RedisTemplate操作Redis</a><ul>
                        
                <li>
                    <a href="#%e9%80%9a%e7%94%a8%e6%93%8d%e4%bd%9c" aria-label="通用操作">通用操作</a></li>
                <li>
                    <a href="#string-3" aria-label="string">string</a></li>
                <li>
                    <a href="#list-2" aria-label="list">list</a></li>
                <li>
                    <a href="#hash-3" aria-label="hash">hash</a></li>
                <li>
                    <a href="#set-3" aria-label="set">set</a></li>
                <li>
                    <a href="#zset" aria-label="zSet">zSet</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#redis%e5%bc%80%e5%8f%91%e8%a7%84%e8%8c%83" aria-label="redis开发规范">redis开发规范</a><ul>
                        
                <li>
                    <a href="#key%e5%90%8d%e8%ae%be%e8%ae%a1" aria-label="key名设计">key名设计</a></li>
                <li>
                    <a href="#value%e8%ae%be%e8%ae%a1" aria-label="value设计">value设计</a></li>
                <li>
                    <a href="#%e5%91%bd%e4%bb%a4%e4%bd%bf%e7%94%a8" aria-label="命令使用">命令使用</a></li>
                <li>
                    <a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e4%bd%bf%e7%94%a8" aria-label="客户端使用">客户端使用</a></li></ul>
                </li>
                <li>
                    <a href="#redis-%e6%8c%81%e4%b9%85%e5%8c%96%e7%ad%96%e7%95%a5%e6%b5%85%e6%9e%90" aria-label="Redis 持久化策略浅析">Redis 持久化策略浅析</a><ul>
                        
                <li>
                    <a href="#rdb%e6%8c%81%e4%b9%85%e5%8c%96" aria-label="RDB持久化">RDB持久化</a><ul>
                        
                <li>
                    <a href="#rdb-%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84" aria-label="RDB 文件结构">RDB 文件结构</a></li>
                <li>
                    <a href="#rdb-%e6%96%87%e4%bb%b6%e7%9a%84%e5%88%9b%e5%bb%ba%e6%89%8b%e5%8a%a8%e6%8c%87%e4%bb%a4%e8%a7%a6%e5%8f%91" aria-label="RDB 文件的创建（手动指令触发）">RDB 文件的创建（手动指令触发）</a></li>
                <li>
                    <a href="#rdb-%e6%96%87%e4%bb%b6%e7%9a%84%e5%88%9b%e5%bb%ba%e8%87%aa%e5%8a%a8%e9%97%b4%e9%9a%94%e6%80%a7%e4%bf%9d%e5%ad%98" aria-label="RDB 文件的创建（自动间隔性保存）">RDB 文件的创建（自动间隔性保存）</a></li>
                <li>
                    <a href="#%e8%87%aa%e5%8a%a8%e4%bf%9d%e5%ad%98%e9%85%8d%e7%bd%ae%e7%9a%84%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" aria-label="自动保存配置的数据结构">自动保存配置的数据结构</a></li>
                <li>
                    <a href="#%e5%a4%87%e4%bb%bd%e8%bf%87%e7%a8%8b" aria-label="备份过程">备份过程</a></li>
                <li>
                    <a href="#fork-%e5%ad%90%e8%bf%9b%e7%a8%8b%e7%9a%84%e4%bd%9c%e7%94%a8" aria-label="Fork 子进程的作用">Fork 子进程的作用</a></li></ul>
                </li>
                <li>
                    <a href="#aof-%e6%8c%81%e4%b9%85%e5%8c%96" aria-label="AOF 持久化">AOF 持久化</a><ul>
                        
                <li>
                    <a href="#aof-%e6%96%87%e4%bb%b6%e5%86%85%e5%ae%b9" aria-label="AOF 文件内容">AOF 文件内容</a></li>
                <li>
                    <a href="#aof-%e6%8c%81%e4%b9%85%e5%8c%96%e5%ae%9e%e7%8e%b0" aria-label="AOF 持久化实现">AOF 持久化实现</a></li>
                <li>
                    <a href="#aof-%e9%87%8d%e5%86%99" aria-label="AOF 重写">AOF 重写</a></li></ul>
                </li>
                <li>
                    <a href="#aof-%e4%b8%8e-wal" aria-label="AOF 与 WAL">AOF 与 WAL</a></li>
                <li>
                    <a href="#aof-%e5%92%8c-rdb-%e4%b9%8b%e9%97%b4%e7%9a%84%e7%9b%b8%e4%ba%92%e4%bd%9c%e7%94%a8" aria-label="AOF 和 RDB 之间的相互作用">AOF 和 RDB 之间的相互作用</a></li>
                <li>
                    <a href="#%e6%b7%b7%e5%90%88%e6%8c%81%e4%b9%85%e5%8c%96" aria-label="混合持久化">混合持久化</a></li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="总结">总结</a></li></ul>
                </li>
                <li>
                    <a href="#redis%e5%a4%a7key%e5%a4%84%e7%90%86" aria-label="redis大key处理">redis大key处理</a><ul>
                        
                <li>
                    <a href="#%e8%83%8c%e6%99%af" aria-label="背景">背景</a></li>
                <li>
                    <a href="#%e5%a4%a7key%e8%a7%a3%e5%86%b3%e6%89%8b%e6%ae%b5" aria-label="大key解决手段">大key解决手段</a><ul>
                        
                <li>
                    <a href="#%e5%8e%86%e5%8f%b2key%e6%9c%aa%e4%bd%bf%e7%94%a8" aria-label="历史key未使用">历史key未使用</a></li>
                <li>
                    <a href="#%e5%85%83%e7%b4%a0%e6%95%b0%e8%bf%87%e5%a4%9a" aria-label="元素数过多">元素数过多</a></li>
                <li>
                    <a href="#%e5%a4%a7%e5%af%b9%e8%b1%a1%e8%bd%ac%e6%8d%a2%e5%ad%98%e5%82%a8%e5%bd%a2%e5%bc%8f" aria-label="大对象转换存储形式">大对象转换存储形式</a></li>
                <li>
                    <a href="#%e5%8e%8b%e7%bc%a9%e5%ad%98%e5%82%a8%e6%95%b0%e6%8d%ae" aria-label="压缩存储数据">压缩存储数据</a></li>
                <li>
                    <a href="#%e6%9b%bf%e6%8d%a2%e5%ad%98%e5%82%a8%e6%96%b9%e6%a1%88" aria-label="替换存储方案">替换存储方案</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93-1" aria-label="总结">总结</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>redis是一个开源的，使用C语言编写的，支持网络交互的、可基于内存也可持久化的Key-Value数据库。</p>
<h1 id="概念">概念<a hidden class="anchor" aria-hidden="true" href="#概念">#</a></h1>
<p>缓存处理流程</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 先从redis中获取数据</span>
</span></span><span style="display:flex;"><span>String data = redisGet(<span style="color:#0ff;font-weight:bold">&#34;xxx&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// redis中没有数据</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span>(data == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 从数据库中获取数据</span>
</span></span><span style="display:flex;"><span>    data = dbGet(<span style="color:#0ff;font-weight:bold">&#34;xxx&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 数据库也没有数据，返回空结果</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(data == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// 设置到缓存中</span>
</span></span><span style="display:flex;"><span>    redis.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;xxx&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;xxx&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 返回数据</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> data;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="redis缓存穿透">redis缓存穿透<a hidden class="anchor" aria-hidden="true" href="#redis缓存穿透">#</a></h2>
<p>缓存穿透是指：查询一个缓存和数据库中都不存在的数据，由于缓存不命中（因为数据根本就不存在），请求就会穿过缓存，直接请求数据库。如果有大量此类请求，数据库压力会突然增大，严重时可能会拖垮数据库。
例如：用户（这时的用户很可能是攻击者）发起为id为<code>-1</code>或id为特别大不存在的请求。
解决方案：</p>
<ol>
<li>接口层增加校验，如用户鉴权校验，id做基础校验，id&lt;=0的直接拦截；</li>
<li>从缓存取不到的数据，在数据库中也没有取到，这时也可以将key-value对写为key-null，缓存有效时间可以设置短点，如30秒（设置太长会导致正常情况也没法使用）。这样可以防止攻击用户反复用同一个id暴力攻击。</li>
</ol>
<h2 id="缓存雪崩">缓存雪崩<a hidden class="anchor" aria-hidden="true" href="#缓存雪崩">#</a></h2>
<p>缓存雪崩是指：在某一个时间段内，大量的缓存键集中过期，导致所有的请求都落到数据库上，造成数据库瞬间压力过大，可能到达崩溃的状态。和缓存击穿不同的是，缓存击穿指并发查同一条数据，缓存雪崩是不同数据都过期了，很多数据从缓存查不到从而查数据库。
解决方案：</p>
<ol>
<li>缓存数据的过期时间设置随机，防止同一时间大量缓存过期。</li>
<li>热点数据不设置过期时间。</li>
</ol>
<h2 id="缓存击穿">缓存击穿<a hidden class="anchor" aria-hidden="true" href="#缓存击穿">#</a></h2>
<p>缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个key进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，造成数据库压力过大，就像在一个屏障上凿开了一个洞。缓存击穿指并发查同一条数据。
解决方案：</p>
<ol>
<li>热点数据不设置过期时间：这要求系统能准确判断哪些是热点数据。</li>
<li>加锁或队列：当热点key过期时，不是所有请求都去数据库查询，而是让某一个请求去数据库查询并更新缓存，其他请求等待缓存更新后再访问缓存。</li>
</ol>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> String getData(String key) <span style="color:#fff;font-weight:bold">throws</span> InterruptedException{
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//从缓存中读取数据</span>
</span></span><span style="display:flex;"><span>    String result = getDataFromRedis(key);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//缓存中不存在数据</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(<span style="color:#fff;font-weight:bold">null</span> == result){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//获取锁，获取成功，取数据库获取数据</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(reenLock.<span style="color:#007f7f">tryLock</span>()){
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//从数据库获取数据</span>
</span></span><span style="display:flex;"><span>            result = getDataFromMysql(key);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//更新缓存数据</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span>(result != <span style="color:#fff;font-weight:bold">null</span>){
</span></span><span style="display:flex;"><span>                setDataToCache(key,result);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//释放锁</span>
</span></span><span style="display:flex;"><span>            reenLock.<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>        }<span style="color:#fff;font-weight:bold">else</span>{<span style="color:#007f7f">//获取锁失败</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//暂停100ms再重新获取数据</span>
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#007f7f">sleep</span>(100);
</span></span><span style="display:flex;"><span>            result = getData(key);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>说明：</p>
<ul>
<li>缓存中有数据，直接走上述代码13行后就返回结果了</li>
<li>缓存中没有数据，第1个进入的线程，获取锁并从数据库去取数据，没释放锁之前，其他并行进入的线程会等待100ms，再重新去缓存取数据。这样就防止都去数据库重复取数据，重复往缓存中更新数据情况出现。</li>
<li>当然这是简化处理，理论上如果能根据key值加锁就更好了，就是线程A从数据库取key1的数据并不妨碍线程B取key2的数据，上面代码明显做不到这点。</li>
</ul>
<h2 id="数据一致性">数据一致性<a hidden class="anchor" aria-hidden="true" href="#数据一致性">#</a></h2>
<p>数据一致性问题是指当数据在多个地方（如缓存和数据库）存储时，这些地方的数据可能会出现不一致的情况。这种不一致可能是由于缓存更新滞后、系统故障或其他原因引起的。数据一致性是分布式系统设计中的一项挑战，尤其是在读写非常频繁的系统中。</p>
<p><strong>数据一致性的问题所在</strong></p>
<p>当数据被更新时，如果缓存中的相应数据没有立即更新，那么缓存系统将向应用程序提供旧数据。这会导致应用程序得到不一致的结果，影响用户体验和数据的准确性。</p>
<p><strong>实时强一致性和最终一致性</strong></p>
<p>在分布式系统中，数据一致性是一个核心问题。根据系统的设计与需求，可以选择实时强一致性(Strong Consistency)或最终一致性(Eventual Consistency)。</p>
<h3 id="实时强一致性">实时强一致性<a hidden class="anchor" aria-hidden="true" href="#实时强一致性">#</a></h3>
<p>**定义：**实时强一致性保证了任何时刻，所有的客户端看到的数据都是一样的。在分布式系统中实现强一致性意味着，一个操作一旦完成，所有的客户端立即都能看到这个操作的结果。</p>
<p>**适用场景：**事务性强、对数据一致性要求高的系统，如银行系统或任何财务系统。</p>
<p><strong>保障策略：</strong></p>
<ol>
<li>三阶段提交（3PC）等分布式事务协议：在分布式系统中保证操作要么全部成功，要么全部失败。</li>
<li>分布式锁：通过在操作前获取全局锁，保证同一时刻只有一个操作可以修改数据，从而保障数据一致性。</li>
<li>强一致性算法：如Paxos或Raft算法，通过一系列严格的消息传递和确认机制，确保分布式系统中的多个副本能够达到一致状态。</li>
</ol>
<h3 id="最终一致性">最终一致性<a hidden class="anchor" aria-hidden="true" href="#最终一致性">#</a></h3>
<p>**定义：**最终一致性是指，系统会保证在没有新的更新操作的情况下，经过足够的时间后，数据将达到一致的状态。在这种模型下，数据的副本之间可能会暂时存在不一致。</p>
<p>**适用场景：**对实时性要求不高，可以容忍短时间内数据不一致的场景，如社交网络、推荐系统等。</p>
<p><strong>保障策略：</strong></p>
<ol>
<li>异步复制：当数据更新发生时，首先更新主副本，然后异步地将更新同步到其他副本。</li>
<li>读取修复（Read Repair）：在读取数据的时候检测副本之间的不一致，并在后台异步修复不一致的数据。</li>
<li>后台一致性修复进程：定期在后台运行的进程检查和同步数据副本之间的差异，以达到最终一致性。</li>
<li>版本控制：每次更新数据时附加一个时间戳或版本号，用于解决更新冲突和保持数据的最终一致性。</li>
</ol>
<h2 id="缓存更新策略">缓存更新策略<a hidden class="anchor" aria-hidden="true" href="#缓存更新策略">#</a></h2>
<ul>
<li>Write through cache（直写缓存）：首先将数据写入缓存，然后立即将新的缓存数据复制到数据库。这种方式可以保证写操作的一致性，但可能会影响写操作的性能。</li>
<li>Write back cache（写回缓存）：数据首先写入缓存，然后由缓存异步写入数据库。这种方式可以提高写操作的性能，但增加了数据丢失的风险。</li>
<li>Write around cache（饶写缓存）：绕过缓存，直接写数据库，然后依据需要更新缓存或使缓存失效。这适用于更频繁读取操作的场景。</li>
</ul>
<h2 id="缓存失效策略">缓存失效策略<a hidden class="anchor" aria-hidden="true" href="#缓存失效策略">#</a></h2>
<ul>
<li>主动更新：当数据库数据变化时，主动更新缓存中的数据。这可以保持缓存数据的实时性，但可能会增加系统的复杂性。</li>
<li>定时失效：为缓存数据设置一个过期时间。定期从数据库中重新加载数据，以保持数据的新鲜度。但这无法解决数据在两次加载之间变化导致的一致性问题。</li>
<li>惰性加载：只有在请求特定数据且发现缓存失效或缓存中没有该数据时，才去数据库加载该数据。这种策略简单，但在高并发场景下可能会导致缓存击穿。</li>
</ul>
<h2 id="使用缓存一致性协议">使用缓存一致性协议<a hidden class="anchor" aria-hidden="true" href="#使用缓存一致性协议">#</a></h2>
<ul>
<li>基于订阅的更新：使用消息队列（如Kafka，RabbitMQ）来发布数据库更新，然后相关服务订阅这些更新消息来同步更新缓存。</li>
<li>最终一致性：采用最终一致性模型，允许系统在一段时间内是不一致的，但保证经过足够的时间后，系统中的所有复制数据最终将达到一致的状态。</li>
</ul>
<h2 id="分布式缓存系统">分布式缓存系统<a hidden class="anchor" aria-hidden="true" href="#分布式缓存系统">#</a></h2>
<p>使用如Redis Cluster、Apache Ignite、Tair等分布式缓存系统，这些系统内置了处理缓存一致性的机制，（但是无法解决缓存和数据库之间的数据一致性问题）。</p>
<h2 id="缓存一致性场景和问题">缓存一致性场景和问题<a hidden class="anchor" aria-hidden="true" href="#缓存一致性场景和问题">#</a></h2>
<p>原文：https://mp.weixin.qq.com/s/6-TAG8s5tgefs-5Qdt4tzQ</p>
<p>为了使各应用职责及整体的架构设计更加清晰，Push中心整体将后台配置端（后台管理）和前台投放端（用户端）分别部署在了两个应用中，两个应用需要分别配置数据库连接，分别配置缓存。</p>
<p><img loading="lazy" src="/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/6.png"></p>
<h3 id="投放段用户端">投放段（用户端）<a hidden class="anchor" aria-hidden="true" href="#投放段用户端">#</a></h3>
<p>投放端对于投放计划pushPlan，只有查询流量，没有增删改。</p>
<p>由于投放端qps较高，为减少数据库压力，必须使用缓存。同时，为了避免缓存击穿和缓存穿透，我们用本地缓存和tair组成了二级缓存，并使用定时任务定时将数据库中的数据刷新到tair。（注：不了解tair的话，可以简单理解为和redis类似）</p>
<p><img loading="lazy" src="/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/7.png"></p>
<h3 id="配置段后台管理">配置段（后台管理）<a hidden class="anchor" aria-hidden="true" href="#配置段后台管理">#</a></h3>
<p>配置端会增删改pushPlan。</p>
<p><img loading="lazy" src="/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/8.png"></p>
<h3 id="问题描述">问题描述<a hidden class="anchor" aria-hidden="true" href="#问题描述">#</a></h3>
<p>梳理到这里，其实很容易发现潜在的不一致性问题：</p>
<ol>
<li>tair和数据库不一致</li>
<li>投放端的本地缓存和Tair缓存不一致</li>
<li>投放端和配置端都用到了Tair缓存，需要是同一个，且key的拼写规则要保持一致</li>
<li>配置端采用的缓存一致性方案是：“修改前删缓存，查询后刷新”，删除后会导致投放端的缓存也被删除</li>
</ol>
<p>本次的问题便出现在第4点：一旦数据在配置端被修改，那么在投放端本地缓存过期后，定时任务刷新tair前，查询出来的数据便是null，导致异常。</p>
<p>至于前3点，此前的方案为：</p>
<ol>
<li>配置端通过“修改前删缓存，查询后刷新”解决，投放端使用定时任务刷新</li>
<li>减少本地缓存过期时间（本地缓存主要是避免缓存穿透和缓存击穿，过期时间可以设置地比较短，业务上可以接受短暂的不一致性）</li>
<li>谜题就在谜面上</li>
</ol>
<h3 id="问题原因">问题原因<a hidden class="anchor" aria-hidden="true" href="#问题原因">#</a></h3>
<p>由于配置端每次更新是先删除缓存，再写数据库，此时在投放端定时任务刷新tair之前，查询缓存便是null。</p>
<h3 id="解决方案">解决方案<a hidden class="anchor" aria-hidden="true" href="#解决方案">#</a></h3>
<p>写完数据库后刷新缓存。</p>
<p>这是最直接的解决方案，既然之前删缓存不行，那就不删除，而是直接刷新缓存。刷新缓存后，配置端从数据库中取出的数据便为最新的数据。</p>
<p>此处涉及到一个先刷新数据库，还是先刷新缓存之类的问题，这里简单列一下各方案及优缺点：</p>
<table>
<thead>
<tr>
<th><strong>方案</strong></th>
<th><strong>特点</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>先更新数据库，再更新缓存（建议）</td>
<td><strong>优点</strong>：<strong>一致性更强</strong>：如果数据库更新成功，而缓存更新失败，可以通过重试机制解决，或者直接让缓存过期，保证了最终一致性。<strong>减少数据不一致的窗口期</strong>：因为更新缓存的操作通常比更新数据库快得多，所以更新完数据库后马上更新缓存，可以尽快保持它们之间的一致性。<strong>缺点</strong>：<strong>更新窗口期中的读操作可能导致脏读</strong>：如果在更新数据库后、更新缓存前有新的读请求，这时会读到旧的缓存数据。</td>
</tr>
<tr>
<td>先更新缓存，再更新数据库</td>
<td><strong>优点</strong>：<strong>减少了脏读的可能</strong>：因为缓存是最先被更新的，读请求总是能读到最新的数据。<strong>缺点</strong>：<strong>一致性问题更为复杂</strong>：如果缓存更新成功，但是数据库更新失败，这会导致缓存和数据库之间出现长期的不一致状态，解决这种不一致状态需要额外的回滚操作，增加了系统的复杂性。<strong>需要处理回滚操作</strong>：如上所述，更新缓存成功而数据库更新失败时，需要有一套策略来回滚已经更新的缓存，确保数据一致性。</td>
</tr>
<tr>
<td>先删缓存，再更新数据库（不建议）</td>
<td>这种策略是指在更新数据之前，首先删除缓存中的数据，然后再更新数据库。<strong>优点</strong>：简单直接，逻辑清晰。<strong>缺点</strong>：可能导致窗口期一致性问题。在删除成功和数据库更新期间，如果有读操作发生，将会读取到旧的数据并且可能回填到缓存中，导致数据库与缓存数据不一致。</td>
</tr>
<tr>
<td>延时双删策略</td>
<td>延时双删涉及三个步骤：先删除缓存、更新数据库，然后过一段时间后再次删除缓存。<strong>优点</strong>：相对于“先删缓存，再更新数据库”策略，这种方法可以减少由于缓存窗口期造成的不一致概率。延迟第二次删除可以覆盖到那些在数据库更新过程中请求旧缓存的读操作，从而阻止这些操作将旧数据回填到缓存。<strong>缺点</strong>：增加了系统的复杂度，需要合适的机制来定时执行第二次删除操作。第二次删除的延迟时间不易确定，太短可能无效，太长则可能导致长时间的数据不一致。</td>
</tr>
</tbody>
</table>
<h1 id="安装redis">安装redis<a hidden class="anchor" aria-hidden="true" href="#安装redis">#</a></h1>
<h2 id="linux安装redis">linux安装redis<a hidden class="anchor" aria-hidden="true" href="#linux安装redis">#</a></h2>
<h3 id="连接redis">连接redis<a hidden class="anchor" aria-hidden="true" href="#连接redis">#</a></h3>
<p><code>./redis-cli</code>
<code>127.0.0.1:6379&gt;</code></p>
<h3 id="配置redis">配置redis<a hidden class="anchor" aria-hidden="true" href="#配置redis">#</a></h3>
<p>redis的配置文件位于Redis安装目录下，文件名为 redis.conf，可以通过CONFIG命令查看或者设置配置项。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>127.0.0.1:6379&gt; config get loglevel
</span></span><span style="display:flex;"><span>1) &#34;loglevel&#34;
</span></span><span style="display:flex;"><span>2) &#34;notice&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用<code>*</code>获取所有配置项
<code>config get *</code>
很多配置，这里就不贴了。<a href="https://www.cnblogs.com/ruanraun/p/redis.html">参考这里</a>
可以通过修改redis.conf文件或者使用config set 命令来修改配置</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>127.0.0.1:6379&gt; config set loglevel &#39;notice&#39;
</span></span><span style="display:flex;"><span>OK
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="如何停止启动重启redis服务">如何停止/启动/重启redis服务<a hidden class="anchor" aria-hidden="true" href="#如何停止启动重启redis服务">#</a></h3>
<p>如果是用apt-get或者yum install安装的redis，可以直接通过下面的命令停止/启动/重启redis</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/etc/init.d/redis-server stop
</span></span><span style="display:flex;"><span>/etc/init.d/redis-server start
</span></span><span style="display:flex;"><span>/etc/init.d/redis-server restart
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果是通过源码安装的redis，可以通过redis的客户端程序redis-cli的shutdown命令来停止redis</p>
<p><code>redis-cli -h 127.0.0.1 -p 6379 shutdown</code>
或
<code>./redis-cli shutdown</code>
没错，虽然启动的是server，但是这里停止的是<code>redis-cli</code>
如果上述方式都没有成功停止redis，则可以使用终极武器 kill -9</p>
<p>启动redis：
<code>cd src</code>
<code>./redis-server</code>
上面这种启动redis使用的是默认配置，也可以通过启动参数告诉redis使用指定配置
<code>./redis-server ../redis.conf</code></p>
<p>让redis后台运行
<code>./redis-server &amp;</code>
然后输入<code>bg</code></p>
<h2 id="windows安装redis5x">windows安装redis5.x<a hidden class="anchor" aria-hidden="true" href="#windows安装redis5x">#</a></h2>
<p><a href="https://www.cnblogs.com/clis/p/14396338.html">参考</a>
下载地址：https://github.com/tporadowski/redis/releases
这里下载的是 Redis-x64-5.0.10.msi
直接安装，安装过程勾选添加环境变量，其他都 next。
安装目录下，git bush执行命令：
<code>./redis-server.exe redis.windows.conf</code></p>
<p>如果显示：
<code>Redis is starting</code>
就是redis已经在运行了。两种解决办法：</p>
<ul>
<li>运行redis安装目录的<code>redis-cli.exe</code>，<code>shutdown</code>，显示<code>not connected&gt;exit</code>。</li>
<li>找到windows服务，找到redis，停止，禁用自启。</li>
</ul>
<p>redis设置密码，修改配置文件 redis.windows.conf：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># requirepass foobared
</span></span><span style="display:flex;"><span>requirepass 123456
</span></span></code></pre></td></tr></table>
</div>
</div><p>之后启动 redis 需要指定配置文件：
<code>redis-server.exe redis.windows.conf</code></p>
<h1 id="redis命令">redis命令<a hidden class="anchor" aria-hidden="true" href="#redis命令">#</a></h1>
<p><a href="https://www.redis.net.cn/">参考redis中文官网</a></p>
<h2 id="key">key<a hidden class="anchor" aria-hidden="true" href="#key">#</a></h2>
<h3 id="del">del<a hidden class="anchor" aria-hidden="true" href="#del">#</a></h3>
<p>del用于删除已存在的键，不存在的 key 会被忽略
<code>del key_name</code>
返回被删除key的数量</p>
<h3 id="dump">dump<a hidden class="anchor" aria-hidden="true" href="#dump">#</a></h3>
<p>DUMP 命令用于序列化给定 key ，并返回被序列化的值
<code>DUMP KEY_NAME</code>
如果 key 不存在，那么返回 nil 。 否则，返回序列化之后的值。</p>
<h3 id="exist">exist<a hidden class="anchor" aria-hidden="true" href="#exist">#</a></h3>
<p>EXISTS 命令用于检查给定 key 是否存在。
<code>EXISTS KEY_NAME</code>
若 key 存在返回 1 ，否则返回 0 。</p>
<h3 id="expire">expire<a hidden class="anchor" aria-hidden="true" href="#expire">#</a></h3>
<p>Expire 命令用于设置 key 的过期时间。key 过期后将不再可用。
<code>Expire KEY_NAME TIME_IN_SECONDS</code>
设置成功返回1， 当key不存在或者不能为key设置过期时间时返回0。</p>
<h3 id="expireat">expireat<a hidden class="anchor" aria-hidden="true" href="#expireat">#</a></h3>
<p>Expireat 命令用于以 UNIX 时间戳(unix timestamp)格式设置 key 的过期时间。key 过期后将不再可用。
<code>Expireat KEY_NAME TIME_IN_UNIX_TIMESTAMP</code>
设置成功返回1，不成功或不存在返回0。
示例：
<code>EXPIREAT w3ckey 1293840000</code></p>
<h3 id="keys">keys<a hidden class="anchor" aria-hidden="true" href="#keys">#</a></h3>
<p>Keys 命令用于查找所有符合给定模式 pattern 的 key
<code>KEYS PATTERN</code>
返回符合给定模式的 key 列表 (Array)。</p>
<p>查找以w3c开头的key：
<code>keys w3c*</code>
查找所有的key
<code>keys *</code></p>
<h3 id="move">move<a hidden class="anchor" aria-hidden="true" href="#move">#</a></h3>
<p>move命令用于将当前数据库的key移动到给定的数据库db当中。
<code>MOVE KEY_NAME DESTINATION_DATABASE</code>
移动成功返回 1 ，失败则返回 0 。</p>
<p>示例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>SELECT 0     # redis默认使用数据库 0，为了清晰起见，这里再显式指定一次。
</span></span><span style="display:flex;"><span>set w3c redis  #设置一个key
</span></span><span style="display:flex;"><span>move w3c 1   #转移到1库
</span></span><span style="display:flex;"><span>exist w3c  #发现w3c已经没有了
</span></span><span style="display:flex;"><span>select 1 #选择1库
</span></span><span style="display:flex;"><span>exist w3c #发现w3c已经转移到1库中
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>不存在的key无法转移</li>
<li>当源数据库和目标数据库有相同的 key 时，key无法转移。</li>
</ol>
<h3 id="persist">persist<a hidden class="anchor" aria-hidden="true" href="#persist">#</a></h3>
<p>persist命令用于移除给定 key 的过期时间，使得 key 永不过期。
<code>PERSIST KEY_NAME</code>
当过期时间移除成功时，返回 1 。 如果 key 不存在或 key 没有设置过期时间，返回 0 。</p>
<h3 id="pttl">pttl<a hidden class="anchor" aria-hidden="true" href="#pttl">#</a></h3>
<p>Pttl 命令以毫秒为单位返回 key 的剩余过期时间。
<code>PTTL KEY_NAME</code>
当 key 不存在时，返回 -2 。 当 key 存在但没有设置剩余生存时间时，返回 -1 。 否则，以毫秒为单位，返回 key 的剩余生存时间。</p>
<h3 id="ttl">TTL<a hidden class="anchor" aria-hidden="true" href="#ttl">#</a></h3>
<p>TTL 命令以秒为单位返回 key 的剩余过期时间。
<code>TTL KEY_NAME</code>
当 key 不存在时，返回 -2 。 当 key 存在但没有设置剩余生存时间时，返回 -1 。 否则，以秒为单位，返回 key 的剩余生存时间。</p>
<h3 id="randomkey">randomkey<a hidden class="anchor" aria-hidden="true" href="#randomkey">#</a></h3>
<p>RANDOMKEY 命令从当前数据库中随机返回一个 key 。
<code>randomkey</code>
当数据库不为空时，返回一个 key 。 当数据库为空时，返回 nil 。</p>
<h3 id="rename">rename<a hidden class="anchor" aria-hidden="true" href="#rename">#</a></h3>
<p>Rename 命令用于修改 key 的名称 。
<code>RENAME OLD_KEY_NAME NEW_KEY_NAME</code>
改名成功时提示 OK ，失败时候返回一个错误。
当 OLD_KEY_NAME 和 NEW_KEY_NAME 相同，或者 OLD_KEY_NAME 不存在时，返回一个错误。
当 NEW_KEY_NAME 已经存在时， RENAME 命令将覆盖旧值。</p>
<h3 id="renamenx">renamenx<a hidden class="anchor" aria-hidden="true" href="#renamenx">#</a></h3>
<p>Renamenx 命令用于在新的 key 不存在时修改 key 的名称 。
<code>RENAMENX OLD_KEY_NAME NEW_KEY_NAME</code>
修改成功时，返回 1 。 如果 NEW_KEY_NAME 已经存在，返回 0 。</p>
<h3 id="type">type<a hidden class="anchor" aria-hidden="true" href="#type">#</a></h3>
<p>Type 命令用于返回 key 所储存的值的类型。
<code>TYPE KEY_NAME </code>
返回 key 的数据类型，数据类型有：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>none (key不存在)
</span></span><span style="display:flex;"><span>string (字符串)
</span></span><span style="display:flex;"><span>list (列表)
</span></span><span style="display:flex;"><span>set (集合)
</span></span><span style="display:flex;"><span>zset (有序集)
</span></span><span style="display:flex;"><span>hash (哈希表)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="string">string<a hidden class="anchor" aria-hidden="true" href="#string">#</a></h2>
<h3 id="set">set<a hidden class="anchor" aria-hidden="true" href="#set">#</a></h3>
<p>SET 命令用于设置给定 key 的值。如果 key 已经存储其他值， SET 就覆写旧值，且无视类型。
<code>SET KEY_NAME VALUE</code>
从 Redis 2.6.12 版本开始， SET 在设置操作成功完成时，才返回 OK 。</p>
<h3 id="get">get<a hidden class="anchor" aria-hidden="true" href="#get">#</a></h3>
<p>Get 命令用于获取指定 key 的值。
<code>GET KEY_NAME</code>
如果 key 不存在，返回 nil 。如果key 储存的值不是字符串类型，返回一个错误。</p>
<h3 id="getrange">getrange<a hidden class="anchor" aria-hidden="true" href="#getrange">#</a></h3>
<p>getrange命令用于获取存储在指定 key 中字符串的子字符串。字符串的截取范围由 start 和 end 两个偏移量决定(包括 start 和 end 在内)。
<code>getrange KEY_NAME start end</code></p>
<p>示例：首先，设置 mykey 的值并截取字符串。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>redis 127.0.0.1:6379&gt; SET mykey &#34;This is my test key&#34;
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>redis 127.0.0.1:6379&gt; GETRANGE mykey 0 3
</span></span><span style="display:flex;"><span>&#34;This&#34;
</span></span><span style="display:flex;"><span>redis 127.0.0.1:6379&gt; GETRANGE mykey 0 -1
</span></span><span style="display:flex;"><span>&#34;This is my test key&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="getset">getset<a hidden class="anchor" aria-hidden="true" href="#getset">#</a></h3>
<p>getset 命令用于设置指定 key 的值，并返回 key 旧的值。
<code>getset key_name value</code>
返回给定 key 的旧值。 当 key 没有旧值时，即 key 不存在时，返回 nil 。
当 key 存在但不是字符串类型时，返回一个错误。
示例：首先，设置 mykey 的值并截取字符串。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>redis 127.0.0.1:6379&gt; GETSET mynewkey &#34;This is my test key&#34;
</span></span><span style="display:flex;"><span>(nil)
</span></span><span style="display:flex;"><span>redis 127.0.0.1:6379&gt; GETSET mynewkey &#34;This is my new value to test getset&#34;
</span></span><span style="display:flex;"><span>&#34;This is my test key&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="getbit">getbit<a hidden class="anchor" aria-hidden="true" href="#getbit">#</a></h3>
<p>getbit 命令用于对 key 所储存的字符串值，获取指定偏移量上的位(bit)。
<code>getbit key_name offset</code>
返回字符串值指定偏移量上的位(bit)。
当偏移量 OFFSET 比字符串值的长度大，或者 key 不存在时，返回 0 。</p>
<h3 id="setbit">setbit<a hidden class="anchor" aria-hidden="true" href="#setbit">#</a></h3>
<p>setbit命令用于对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)。
<code>setbit key_name offset</code>
返回指定偏移量原来储存的位。</p>
<h3 id="mget">mget<a hidden class="anchor" aria-hidden="true" href="#mget">#</a></h3>
<p>mget命令返回所有(一个或多个)给定 key 的值。 如果给定的 key 里面，有某个 key 不存在，那么这个 key 返回特殊值 nil 。
<code>MGET KEY1 KEY2 .. KEYN</code></p>
<h3 id="setex">setex<a hidden class="anchor" aria-hidden="true" href="#setex">#</a></h3>
<p>setex 命令为指定的 key 设置值及其过期时间。如果 key 已经存在， SETEX 命令将会替换旧的值。
<code>setex key_name timeout value</code>
设置成功时返回 OK 。
说白了就是在设置一个值的时候直接就指定了过期时间。</p>
<h3 id="setnx">setnx<a hidden class="anchor" aria-hidden="true" href="#setnx">#</a></h3>
<p>setnx(SET if Not eXists)命令在指定的 key 不存在时，为 key 设置指定的值。
<code>setnx key_name value</code>
设置成功，返回 1 。 设置失败，返回 0 。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>redis&gt; EXISTS job                # job 不存在
</span></span><span style="display:flex;"><span>(integer) 0
</span></span><span style="display:flex;"><span>redis&gt; SETNX job &#34;programmer&#34;    # job 设置成功
</span></span><span style="display:flex;"><span>(integer) 1
</span></span><span style="display:flex;"><span>redis&gt; SETNX job &#34;code-farmer&#34;   # 尝试覆盖 job ，失败
</span></span><span style="display:flex;"><span>(integer) 0
</span></span><span style="display:flex;"><span>redis&gt; GET job                   # 没有被覆盖
</span></span><span style="display:flex;"><span>&#34;programmer&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="setrange">setrange<a hidden class="anchor" aria-hidden="true" href="#setrange">#</a></h3>
<p>setrange 命令用指定的字符串覆盖给定 key 所储存的字符串值，覆盖的位置从偏移量 offset 开始。
<code>SETRANGE KEY_NAME OFFSET VALUE</code>
返回被修改后的字符串长度。
就是从指定位置修改字符串的内容。</p>
<h3 id="strlen">strlen<a hidden class="anchor" aria-hidden="true" href="#strlen">#</a></h3>
<p>strlen 命令用于获取指定 key 所储存的字符串值的长度。当 key 储存的不是字符串值时，返回一个错误。
<code>strlen key_name</code>
返回字符串值的长度。 当 key 不存在时，返回 0。</p>
<h3 id="mset">mset<a hidden class="anchor" aria-hidden="true" href="#mset">#</a></h3>
<p>mset 命令用于同时设置一个或多个 key-value 对。
<code>MSET key1 value1 key2 value2 .. keyN valueN </code>
总是返回OK</p>
<h3 id="msetnx">msetnx<a hidden class="anchor" aria-hidden="true" href="#msetnx">#</a></h3>
<p>msetnx 命令用于所有给定 key 都不存在时，同时设置一个或多个 key-value 对。
<code>MSETNX key1 value1 key2 value2 .. keyN valueN </code>
当所有 key 都成功设置，返回 1 。 如果所有给定 key 都设置失败(至少有一个 key 已经存在)，那么返回 0 。</p>
<p>msetnx是原子性操作，只要有一个值失败，所有的值都不会被设置。</p>
<h3 id="psetex">psetex<a hidden class="anchor" aria-hidden="true" href="#psetex">#</a></h3>
<p>psetex 命令以毫秒为单位设置 key 的生存时间。
<code>PSETEX key1 EXPIRY_IN_MILLISECONDS value1 </code>
设置成功时返回 OK 。</p>
<h3 id="incr">incr<a hidden class="anchor" aria-hidden="true" href="#incr">#</a></h3>
<p>incr 命令将 key 中储存的数字值增一。
如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 INCR 操作。
如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。
本操作的值限制在 64 位(bit)有符号数字表示之内。
<code>incr key_name</code>
返回执行incr命令之后 key 的值。</p>
<h3 id="incrby">incrby<a hidden class="anchor" aria-hidden="true" href="#incrby">#</a></h3>
<p>incrby命令将 key 中储存的数字加上指定的增量值。
如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 INCRBY 命令。
如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。
本操作的值限制在 64 位(bit)有符号数字表示之内。
<code>incr key_name incr_amount</code>
返回加上指定的增量值之后， key 的值。</p>
<h3 id="incrbyfloat">incrbyfloat<a hidden class="anchor" aria-hidden="true" href="#incrbyfloat">#</a></h3>
<p>incrbyfloat命令为 key 中所储存的值加上指定的浮点数增量值。
<code>incrbyfloat key_name incr_amount</code>
返回执行命令之后 key 的值。</p>
<p>用 SET 设置的值可以是指数符号<code>314e-2</code>，但执行 INCRBYFLOAT 之后格式会被改成非指数符号<code>3.14</code>
SET 设置的值小数部分可以是 0<code>3.0</code>，但 INCRBYFLOAT 会将无用的 0 忽略掉，有需要的话，将浮点变为整数<code>4</code></p>
<h3 id="decr">decr<a hidden class="anchor" aria-hidden="true" href="#decr">#</a></h3>
<p>decr 命令将 key 中储存的数字值减一。
如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 DECR 操作。
如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。
本操作的值限制在 64 位(bit)有符号数字表示之内。
<code>decr key_name</code>
返回执行命令之后 key 的值。</p>
<h3 id="decrby">decrby<a hidden class="anchor" aria-hidden="true" href="#decrby">#</a></h3>
<p>decrby 命令将 key 所储存的值减去指定的减量值。
如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 DECRBY 操作。
如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。
本操作的值限制在 64 位(bit)有符号数字表示之内。
<code>decrby key_name decrement_amount</code>
返回减去指定减量值之后， key 的值。</p>
<h3 id="append">append<a hidden class="anchor" aria-hidden="true" href="#append">#</a></h3>
<p>append 命令用于为指定的 key 追加值。
如果 key 已经存在并且是一个字符串， APPEND 命令将 value 追加到 key 原来的值的末尾。
如果 key 不存在， APPEND 就简单地将给定 key 设为 value ，就像执行 SET key value 一样。
<code>append key_name new_value</code>
返回追加指定值之后， key 中字符串的长度。</p>
<h2 id="hash">hash<a hidden class="anchor" aria-hidden="true" href="#hash">#</a></h2>
<h3 id="hdel">hdel<a hidden class="anchor" aria-hidden="true" href="#hdel">#</a></h3>
<p>hdel 命令用于删除哈希表 key 中的一个或多个指定字段，不存在的字段将被忽略。
<code>HDEL KEY_NAME FIELD1.. FIELDN </code>
被成功删除字段的数量，不包括被忽略的字段。</p>
<h3 id="hexists">hexists<a hidden class="anchor" aria-hidden="true" href="#hexists">#</a></h3>
<p>hexists 命令用于查看哈希表的指定字段是否存在。
<code>HEXISTS KEY_NAME FIELD_NAME </code>
如果哈希表含有给定字段，返回 1 。 如果哈希表不含有给定字段，或 key 不存在，返回 0 。</p>
<h3 id="hget">hget<a hidden class="anchor" aria-hidden="true" href="#hget">#</a></h3>
<p>hget 命令用于返回哈希表中指定字段的值。
<code>HGET KEY_NAME FIELD_NAME </code>
返回给定字段的值。如果给定的字段或 key 不存在时，返回 nil 。</p>
<h3 id="hgetall">hgetall<a hidden class="anchor" aria-hidden="true" href="#hgetall">#</a></h3>
<p>hgetall 命令用于返回哈希表中，所有的字段和值。
在返回值里，紧跟每个字段名(field name)之后是字段的值(value)，所以返回值的长度是哈希表大小的两倍。
<code>HGETALL KEY_NAME </code>
以列表形式返回哈希表的字段及字段值。 若 key 不存在，返回空列表。</p>
<h3 id="hincrby">hincrby<a hidden class="anchor" aria-hidden="true" href="#hincrby">#</a></h3>
<p>hincrby 命令用于为哈希表中的字段值加上指定增量值。
增量也可以为负数，相当于对指定字段进行减法操作。
如果哈希表的 key 不存在，一个新的哈希表被创建并执行 HINCRBY 命令。
如果指定的字段不存在，那么在执行命令前，字段的值被初始化为 0 。
对一个储存字符串值的字段执行 HINCRBY 命令将造成一个错误。
本操作的值被限制在 64 位(bit)有符号数字表示之内。
<code>HINCRBY KEY_NAME FIELD_NAME INCR_BY_NUMBER </code></p>
<h3 id="hincrbyfloat">hincrbyfloat<a hidden class="anchor" aria-hidden="true" href="#hincrbyfloat">#</a></h3>
<p>hincrbyfloat 命令用于为哈希表中的字段值加上指定浮点数增量值。
如果指定的字段不存在，那么在执行命令前，字段的值被初始化为 0 。
<code>HINCRBYFLOAT KEY_NAME FIELD_NAME INCR_BY_NUMBER </code>
返回执行 Hincrbyfloat 命令之后，哈希表中字段的值。</p>
<h3 id="hkeys">hkeys<a hidden class="anchor" aria-hidden="true" href="#hkeys">#</a></h3>
<p>hkeys 命令用于获取哈希表中的所有字段名。
<code>HKEYS KEY_NAME FIELD_NAME INCR_BY_NUMBER </code>
包含哈希表中所有字段的列表。 当 key 不存在时，返回一个空列表。</p>
<h3 id="hlen">hlen<a hidden class="anchor" aria-hidden="true" href="#hlen">#</a></h3>
<p>hlen 命令用于获取哈希表中字段的数量。
<code>HLEN KEY_NAME </code>
返回哈希表中字段的数量。 当 key 不存在时，返回 0 。</p>
<h3 id="hmget">hmget<a hidden class="anchor" aria-hidden="true" href="#hmget">#</a></h3>
<p>hmget 命令用于返回哈希表中，一个或多个给定字段的值。
如果指定的字段不存在于哈希表，那么返回一个 nil 值。
<code>HMGET KEY_NAME FIELD1...FIELDN </code>
返回一个包含多个给定字段关联值的表，表值的排列顺序和指定字段的请求顺序一样。</p>
<h3 id="hmset">hmset<a hidden class="anchor" aria-hidden="true" href="#hmset">#</a></h3>
<p>hmset 命令用于同时将多个 field-value (字段-值)对设置到哈希表中。
此命令会覆盖哈希表中已存在的字段。
如果哈希表不存在，会创建一个空哈希表，并执行 HMSET 操作。
<code>HMSET KEY_NAME FIELD1 VALUE1 ...FIELDN VALUEN</code></p>
<h3 id="hset">hset<a hidden class="anchor" aria-hidden="true" href="#hset">#</a></h3>
<p>hset 命令用于为哈希表中的字段赋值 。
如果哈希表不存在，一个新的哈希表被创建并进行 HSET 操作。
如果字段已经存在于哈希表中，旧值将被覆盖。
<code>HSET KEY_NAME FIELD VALUE</code>
返回如果字段是哈希表中的一个新建字段，并且值设置成功，返回 1 。 如果哈希表中域字段已经存在且旧值已被新值覆盖，返回 0 。</p>
<h3 id="hsetnx">hsetnx<a hidden class="anchor" aria-hidden="true" href="#hsetnx">#</a></h3>
<p>hsetnx 命令用于为哈希表中不存在的的字段赋值 。
如果哈希表不存在，一个新的哈希表被创建并进行 HSET 操作。
如果字段已经存在于哈希表中，操作无效。
如果 key 不存在，一个新哈希表被创建并执行 HSETNX 命令。
<code>HSETNX KEY_NAME FIELD VALUE</code>
设置成功，返回 1 。 如果给定字段已经存在且没有操作被执行，返回 0 。</p>
<h3 id="hvals">hvals<a hidden class="anchor" aria-hidden="true" href="#hvals">#</a></h3>
<p>hvals 命令返回哈希表所有字段的值。
<code>HVALS KEY_NAME FIELD VALUE</code>
返回一个包含哈希表中所有值的表。 当 key 不存在时，返回一个空表。</p>
<h2 id="连接操作命令">连接操作命令<a hidden class="anchor" aria-hidden="true" href="#连接操作命令">#</a></h2>
<p>quit：关闭连接（connection）
auth：简单密码认证
help cmd： 查看cmd帮助，例如：help quit</p>
<h2 id="持久化">持久化<a hidden class="anchor" aria-hidden="true" href="#持久化">#</a></h2>
<p>save：将数据同步保存到磁盘
bgsave：将数据异步保存到磁盘
lastsave：返回上次成功将数据保存到磁盘的Unix时戳
shundown：将数据同步保存到磁盘，然后关闭服务</p>
<h2 id="远程服务控制">远程服务控制<a hidden class="anchor" aria-hidden="true" href="#远程服务控制">#</a></h2>
<p>info：提供服务器的信息和统计
monitor：实时转储收到的请求
slaveof：改变复制策略设置
config：在运行时配置Redis服务器</p>
<h2 id="对value操作的命令">对value操作的命令<a hidden class="anchor" aria-hidden="true" href="#对value操作的命令">#</a></h2>
<p>exists(key)：确认一个key是否存在
del(key)：删除一个key
type(key)：返回值的类型
keys(pattern)：返回满足给定pattern的所有key
randomkey：随机返回key空间的一个
keyrename(oldname, newname)：重命名key
dbsize：返回当前数据库中key的数目
expire：设定一个key的活动时间（s）
ttl：获得一个key的活动时间
select(index)：按索引查询
move(key, dbindex)：移动当前数据库中的key到dbindex数据库
flushdb：删除当前选择数据库中的所有key
flushall：删除所有数据库中的所有key</p>
<h2 id="string-1">String<a hidden class="anchor" aria-hidden="true" href="#string-1">#</a></h2>
<p>set(key, value)：给数据库中名称为key的string赋予值value
get(key)：返回数据库中名称为key的string的value
getset(key, value)：给名称为key的string赋予上一次的value
mget(key1, key2,…, key N)：返回库中多个string的value
setnx(key, value)：添加string，名称为key，值为value
setex(key, time, value)：向库中添加string，设定过期时间time
mset(key N, value N)：批量设置多个string的值
msetnx(key N, value N)：如果所有名称为key i的string都不存在
incr(key)：名称为key的string增1操作
incrby(key, integer)：名称为key的string增加integer
decr(key)：名称为key的string减1操作
decrby(key, integer)：名称为key的string减少integer
append(key, value)：名称为key的string的值附加value
substr(key, start, end)：返回名称为key的string的value的子串</p>
<h2 id="list">List<a hidden class="anchor" aria-hidden="true" href="#list">#</a></h2>
<p>rpush(key, value)：在名称为key的list尾添加一个值为value的元素
lpush(key, value)：在名称为key的list头添加一个值为value的 元素
llen(key)：返回名称为key的list的长度
lrange(key, start, end)：返回名称为key的list中start至end之间的元素
ltrim(key, start, end)：截取名称为key的list
lindex(key, index)：返回名称为key的list中index位置的元素
lset(key, index, value)：给名称为key的list中index位置的元素赋值
lrem(key, count, value)：删除count个key的list中值为value的元素
lpop(key)：返回并删除名称为key的list中的首元素
rpop(key)：返回并删除名称为key的list中的尾元素
blpop(key1, key2,… key N, timeout)：lpop命令的block版本。
brpop(key1, key2,… key N, timeout)：rpop的block版本。
rpoplpush(srckey, dstkey)：返回并删除名称为srckey的list的尾元素，并将该元素添加到名称为dstkey的list的头部</p>
<h2 id="set-1">Set<a hidden class="anchor" aria-hidden="true" href="#set-1">#</a></h2>
<p>sadd(key, member)：向名称为key的set中添加元素member
srem(key, member) ：删除名称为key的set中的元素member
spop(key) ：随机返回并删除名称为key的set中一个元素
smove(srckey, dstkey, member) ：移到集合元素
scard(key) ：返回名称为key的set的基数
sismember(key, member) ：member是否是名称为key的set的元素
sinter(key1, key2,…key N) ：求交集
sinterstore(dstkey, (keys)) ：求交集并将交集保存到dstkey的集合
sunion(key1, (keys)) ：求并集
sunionstore(dstkey, (keys)) ：求并集并将并集保存到dstkey的集合
sdiff(key1, (keys)) ：求差集
sdiffstore(dstkey, (keys)) ：求差集并将差集保存到dstkey的集合
smembers(key) ：返回名称为key的set的所有元素
srandmember(key) ：随机返回名称为key的set的一个元素</p>
<h2 id="hash-1">Hash<a hidden class="anchor" aria-hidden="true" href="#hash-1">#</a></h2>
<p>hset(key, field, value)：向名称为key的hash中添加元素field
hget(key, field)：返回名称为key的hash中field对应的value
hmget(key, (fields))：返回名称为key的hash中field i对应的value
hmset(key, (fields))：向名称为key的hash中添加元素field
hincrby(key, field, integer)：将名称为key的hash中field的value增加integer
hexists(key, field)：名称为key的hash中是否存在键为field的域
hdel(key, field)：删除名称为key的hash中键为field的域
hlen(key)：返回名称为key的hash中元素个数
hkeys(key)：返回名称为key的hash中所有键
hvals(key)：返回名称为key的hash中所有键对应的value
hgetall(key)：返回名称为key的hash中所有的键（field）及其对应的value</p>
<h1 id="功能实现">功能实现<a hidden class="anchor" aria-hidden="true" href="#功能实现">#</a></h1>
<h2 id="使用redistemplate-存储键值出现乱码">使用RedisTemplate 存储键值出现乱码<a hidden class="anchor" aria-hidden="true" href="#使用redistemplate-存储键值出现乱码">#</a></h2>
<p>最近使用spring-data-redis RedisTemplate 操作redis时发现存储在redis中的key不是设置的string值，前面还多出了许多类似\xac\xed\x00\x05t\x00这种字符串，如下</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>127.0.0.1:6379&gt; keys *
</span></span><span style="display:flex;"><span>1) &#34;\xac\xed\x00\x05t\x00\x04pass&#34;
</span></span><span style="display:flex;"><span>2) &#34;\xac\xed\x00\x05t\x00\x04name&#34;
</span></span><span style="display:flex;"><span>3) &#34;name&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>解决：使用StringRedisTemplate，而不是RedisTemplate。</p>
<h2 id="redistemplate和stringredistemplate的区别">RedisTemplate和StringRedisTemplate的区别<a hidden class="anchor" aria-hidden="true" href="#redistemplate和stringredistemplate的区别">#</a></h2>
<ul>
<li>StringRedisTemplate继承RedisTemplate</li>
<li>StringRedisTemplate只能管理StringRedisTemplate里面的数据，RedisTemplate只能管理RedisTemplate中的数据。</li>
<li>SDR(spring-date-redis)默认采用的序列化策略有两种，一种是String的序列化策略，一种是JDK的序列化策略。
StringRedisTemplate默认采用的是String的序列化策略，保存的key和value都是采用此策略序列化保存的。
RedisTemplate默认采用的是JDK的序列化策略，保存的key和value都是采用此策略序列化保存的。</li>
</ul>
<p>RedisTemplate使用的序列类在在操作数据的时候，比如说存入数据会将数据先序列化成字节数组然后在存入Redis数据库，这个时候打开Redis查看的时候，你会看到你的数据不是以可读的形式展现的，而是以字节数组显示，类似下面
key:
<code>\xAC\xED\x00\x05sr\x00</code></p>
<p>value:
<code>\xAC\xED\x00\x05sr\x00\x13java.util.ArrayList...</code></p>
<p>总结：
当redis中本来存的是字符串数据，或者你要存取的数据就是字符串类型数据的时候，那么你就使用StringRedisTemplate即可，但是如果你的数据是复杂的对象类型，而取出的时候又不想做任何的数据转换，直接从Redis里面取出一个对象，那么使用RedisTemplate是更好的选择。</p>
<h2 id="通过notify-keyspace-events实现订单自动关闭功能">通过notify-keyspace-events实现订单自动关闭功能<a hidden class="anchor" aria-hidden="true" href="#通过notify-keyspace-events实现订单自动关闭功能">#</a></h2>
<p>修改Redis配置文件，开启过期通知功能。
在配置文件中搜索<code>notify</code>，找到<code># notify-keyspace-events Ex</code>这一行，将注释去掉。
同时注释掉下面一行<code>notify-keyspace-events &quot;&quot;</code>，
为了节约cup资源，事件通知默认是没有开启的，即<code>notify-keyspace-events &quot;&quot;</code></p>
<p>修改之后在需要重启redis，然后通过cli查看配置是否生效，<code>config get notify-keyspace-events</code>，如果显示Ex（或者xE），就生效了。</p>
<p>在程序中使用redis：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>//引入redis
</span></span><span style="display:flex;"><span>@Resource
</span></span><span style="display:flex;"><span>private RedisTemplate redisTemplate;
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置key
<code>redisTemplate.opsForValue().set(orderNo, &quot;value是随便写的，因为过期通知无法取得value&quot;, 10, TimeUnit.SECONDS);</code></p>
<p>配置过期监听</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Slf4j
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RedisTask <span style="color:#fff;font-weight:bold">extends</span> KeyExpirationEventMessageListener {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> ExecuteHandle executeHandle;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param listenerContainer must not be {@literal null}.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> RedisTask(RedisMessageListenerContainer listenerContainer) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">super</span>(listenerContainer);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> onMessage(Message message, <span style="color:#fff;font-weight:bold">byte</span>[] pattern) {
</span></span><span style="display:flex;"><span>        String channel = <span style="color:#fff;font-weight:bold">new</span> String(message.<span style="color:#007f7f">getChannel</span>(), StandardCharsets.<span style="color:#007f7f">UTF_8</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//过期的key</span>
</span></span><span style="display:flex;"><span>        String key = <span style="color:#fff;font-weight:bold">new</span> String(message.<span style="color:#007f7f">getBody</span>(), StandardCharsets.<span style="color:#007f7f">UTF_8</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//在这里，可以过滤调我们不需要的key</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(key.<span style="color:#007f7f">startsWith</span>(<span style="color:#0ff;font-weight:bold">&#34;shiro_redis_session&#34;</span>)){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        log.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;redis key 过期：pattern={},channel={},key={}&#34;</span>,<span style="color:#fff;font-weight:bold">new</span> String(pattern),channel,key);
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//业务逻辑，取消订单什么的</span>
</span></span><span style="display:flex;"><span>        executeHandle.<span style="color:#007f7f">handle</span>(key);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为我们会有很多类型的过期key，所以需要区分</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//处理基类，</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">abstract</span> <span style="color:#fff;font-weight:bold">class</span> AbstractRedisExpireHandle {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//通过前缀区分过期的key</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String prefix;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getPrefix() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> prefix;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setPrefix(String prefix) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">prefix</span> = prefix;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> AbstractRedisExpireHandle(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//处理redis过期的key</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">abstract</span> <span style="color:#fff;font-weight:bold">void</span> expireHandle(String redisKey);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 商品订单过期
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> OrderExpireHandle <span style="color:#fff;font-weight:bold">extends</span> AbstractRedisExpireHandle {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String PREFIX = <span style="color:#0ff;font-weight:bold">&#34;12&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> OrderExpireHandle(){
</span></span><span style="display:flex;"><span>        setPrefix(PREFIX);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Reference(version = <span style="color:#0ff;font-weight:bold">&#34;1.0.0&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> TaskService taskService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> expireHandle(String redisKey) {
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//业务逻辑</span>
</span></span><span style="display:flex;"><span>        taskService.<span style="color:#007f7f">orderExpireHandle</span>(redisKey);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>具体处理类</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Slf4j
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ExecuteHandle <span style="color:#fff;font-weight:bold">implements</span> ApplicationContextAware, InitializingBean {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//spring容器</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> ApplicationContext context;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//过期key处理器</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> List&lt;AbstractRedisExpireHandle&gt; expireHandles = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 程序启动，将各个处理类，放到list中
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @throws Exception
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> afterPropertiesSet() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        String[] beanNames =  BeanFactoryUtils.<span style="color:#007f7f">beanNamesForTypeIncludingAncestors</span>(context,AbstractRedisExpireHandle.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span>(<span style="color:#fff;font-weight:bold">int</span> i=0;i&lt;beanNames.<span style="color:#007f7f">length</span>;i++){
</span></span><span style="display:flex;"><span>            expireHandles.<span style="color:#007f7f">add</span>((AbstractRedisExpireHandle)context.<span style="color:#007f7f">getBean</span>(beanNames[i]));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setApplicationContext(ApplicationContext applicationContext) <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">context</span> = applicationContext;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//找到合适的处理器处理</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> handle(String redisKey){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(expireHandles.<span style="color:#007f7f">isEmpty</span>()){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        log.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;redisKey是：&#34;</span> + redisKey);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span>(AbstractRedisExpireHandle i : expireHandles){
</span></span><span style="display:flex;"><span>            log.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;i.getPrefix()是：&#34;</span> + i.<span style="color:#007f7f">getPrefix</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span>(redisKey.<span style="color:#007f7f">startsWith</span>(i.<span style="color:#007f7f">getPrefix</span>())){
</span></span><span style="display:flex;"><span>                i.<span style="color:#007f7f">expireHandle</span>(redisKey);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="redis哨兵">redis哨兵<a hidden class="anchor" aria-hidden="true" href="#redis哨兵">#</a></h2>
<p>哨兵是一个独立的进程，作为进程，它会独立运行。其原理是哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例。
<img loading="lazy" src="/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/1.jpg"></p>
<p>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器。
当哨兵监测到master宕机，会自动将slave切换成master，然后通过发布订阅模式通知其他的从服务器，修改配置文件，让它们切换主机。
然而一个哨兵进程对Redis服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了多哨兵模式。
故障切换（failover）的过程。假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象成为主观下线。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为客观下线。这样对于客户端而言，一切都是透明的。</p>
<p>配置3个哨兵和1主2从的Redis服务器来演示这个过程。</p>
<table>
<thead>
<tr>
<th>服务类型</th>
<th>是否是主服务器</th>
<th>IP地址</th>
<th>端口</th>
</tr>
</thead>
<tbody>
<tr>
<td>Redis</td>
<td>是</td>
<td>192.168.11.128</td>
<td>6379</td>
</tr>
<tr>
<td>Redis</td>
<td>否</td>
<td>192.168.11.129</td>
<td>6379</td>
</tr>
<tr>
<td>Redis</td>
<td>否</td>
<td>192.168.11.130</td>
<td>6379</td>
</tr>
<tr>
<td>Sentinel</td>
<td>-</td>
<td>192.168.11.128</td>
<td>26379</td>
</tr>
<tr>
<td>Sentinel</td>
<td>-</td>
<td>192.168.11.129</td>
<td>26379</td>
</tr>
<tr>
<td>Sentinel</td>
<td>-</td>
<td>192.168.11.130</td>
<td>26379</td>
</tr>
</tbody>
</table>
<p><img loading="lazy" src="/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/2.jpg">
首先配置Redis的主从服务器，修改redis.conf文件如下</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 使得Redis服务器可以跨网络访问
</span></span><span style="display:flex;"><span>bind 0.0.0.0
</span></span><span style="display:flex;"><span># 设置密码
</span></span><span style="display:flex;"><span>requirepass &#34;123456&#34;
</span></span><span style="display:flex;"><span># 指定主服务器，注意：有关slaveof的配置只是配置从服务器，主服务器不需要配置
</span></span><span style="display:flex;"><span>slaveof 192.168.11.128 6379
</span></span><span style="display:flex;"><span># 主服务器密码，注意：有关slaveof的配置只是配置从服务器，主服务器不需要配置
</span></span><span style="display:flex;"><span>masterauth 123456
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述内容主要是配置Redis服务器，从服务器比主服务器多一个slaveof的配置和密码。
配置3个哨兵，每个哨兵的配置都是一样的。在Redis安装目录下有一个sentinel.conf文件，copy一份进行修改。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 禁止保护模式
</span></span><span style="display:flex;"><span>protected-mode no
</span></span><span style="display:flex;"><span># 配置监听的主服务器，这里sentinel monitor代表监控，mymaster代表服务器的名称，可以自定义，192.168.11.128代表监控的主服务器，6379代表端口，2代表只有两个或两个以上的哨兵认为主服务器不可用的时候，才会进行failover操作。
</span></span><span style="display:flex;"><span>sentinel monitor mymaster 192.168.11.128 6379 2
</span></span><span style="display:flex;"><span># sentinel author-pass定义服务的密码，mymaster是服务名称，123456是Redis服务器密码
</span></span><span style="display:flex;"><span># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;
</span></span><span style="display:flex;"><span>sentinel auth-pass mymaster 123456
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述关闭了保护模式，便于测试。
有了上述的修改，我们可以进入Redis的安装目录的src目录，通过下面的命令启动服务器和哨兵</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># 启动Redis服务器进程
</span></span><span style="display:flex;"><span>./redis-server ../redis.conf
</span></span><span style="display:flex;"><span># 启动哨兵进程
</span></span><span style="display:flex;"><span>./redis-sentinel ../sentinel.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意启动的顺序。首先是主机（192.168.11.128）的Redis服务进程，然后启动从机的服务进程，最后启动3个哨兵的服务进程。</p>
<h3 id="java中使用哨兵模式">Java中使用哨兵模式<a hidden class="anchor" aria-hidden="true" href="#java中使用哨兵模式">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 测试Redis哨兵模式
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @author liu
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TestSentinels {
</span></span><span style="display:flex;"><span>    @SuppressWarnings(<span style="color:#0ff;font-weight:bold">&#34;resource&#34;</span>)
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> testSentinel() {
</span></span><span style="display:flex;"><span>        JedisPoolConfig jedisPoolConfig = <span style="color:#fff;font-weight:bold">new</span> JedisPoolConfig();
</span></span><span style="display:flex;"><span>        jedisPoolConfig.<span style="color:#007f7f">setMaxTotal</span>(10);
</span></span><span style="display:flex;"><span>        jedisPoolConfig.<span style="color:#007f7f">setMaxIdle</span>(5);
</span></span><span style="display:flex;"><span>        jedisPoolConfig.<span style="color:#007f7f">setMinIdle</span>(5);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 哨兵信息</span>
</span></span><span style="display:flex;"><span>        Set&lt;String&gt; sentinels = <span style="color:#fff;font-weight:bold">new</span> HashSet&lt;&gt;(Arrays.<span style="color:#007f7f">asList</span>(<span style="color:#0ff;font-weight:bold">&#34;192.168.11.128:26379&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;192.168.11.129:26379&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;192.168.11.130:26379&#34;</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 创建连接池</span>
</span></span><span style="display:flex;"><span>        JedisSentinelPool pool = <span style="color:#fff;font-weight:bold">new</span> JedisSentinelPool(<span style="color:#0ff;font-weight:bold">&#34;mymaster&#34;</span>, sentinels,jedisPoolConfig,<span style="color:#0ff;font-weight:bold">&#34;123456&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 获取客户端</span>
</span></span><span style="display:flex;"><span>        Jedis jedis = pool.<span style="color:#007f7f">getResource</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 执行两个命令</span>
</span></span><span style="display:flex;"><span>        jedis.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;mykey&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;myvalue&#34;</span>);
</span></span><span style="display:flex;"><span>        String value = jedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;mykey&#34;</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(value);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面是通过Jedis进行使用的，同样也可以使用Spring进行配置RedisTemplate使用。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>&lt;bean id = <span style="color:#0ff;font-weight:bold">&#34;poolConfig&#34;</span> <span style="color:#fff;font-weight:bold">class</span>=<span style="color:#0ff;font-weight:bold">&#34;redis.clients.jedis.JedisPoolConfig&#34;</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;!-- <span style="color:#f00">最大空闲数</span> --&gt;
</span></span><span style="display:flex;"><span>	&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;maxIdle&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;50&#34;</span>&gt;&lt;/property&gt;
</span></span><span style="display:flex;"><span>	&lt;!-- <span style="color:#f00">最大连接数</span> --&gt;
</span></span><span style="display:flex;"><span>	&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;maxTotal&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;100&#34;</span>&gt;&lt;/property&gt;
</span></span><span style="display:flex;"><span>	&lt;!-- <span style="color:#f00">最大等待时间</span> --&gt;
</span></span><span style="display:flex;"><span>	&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;maxWaitMillis&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;20000&#34;</span>&gt;&lt;/property&gt;
</span></span><span style="display:flex;"><span>&lt;/bean&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;bean id=<span style="color:#0ff;font-weight:bold">&#34;connectionFactory&#34;</span> <span style="color:#fff;font-weight:bold">class</span>=<span style="color:#0ff;font-weight:bold">&#34;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&#34;</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;constructor-arg name=<span style="color:#0ff;font-weight:bold">&#34;poolConfig&#34;</span> ref=<span style="color:#0ff;font-weight:bold">&#34;poolConfig&#34;</span>&gt;&lt;/constructor-arg&gt;
</span></span><span style="display:flex;"><span>	&lt;constructor-arg name=<span style="color:#0ff;font-weight:bold">&#34;sentinelConfig&#34;</span> ref=<span style="color:#0ff;font-weight:bold">&#34;sentinelConfig&#34;</span>&gt;&lt;/constructor-arg&gt;
</span></span><span style="display:flex;"><span>	&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;password&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;123456&#34;</span>&gt;&lt;/property&gt;
</span></span><span style="display:flex;"><span>&lt;/bean&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;!-- JDK序列化器 --&gt;
</span></span><span style="display:flex;"><span>&lt;bean id=<span style="color:#0ff;font-weight:bold">&#34;jdkSerializationRedisSerializer&#34;</span> <span style="color:#fff;font-weight:bold">class</span>=<span style="color:#0ff;font-weight:bold">&#34;org.springframework.data.redis.serializer.JdkSerializationRedisSerializer&#34;</span>&gt;&lt;/bean&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;!-- String序列化器 --&gt;
</span></span><span style="display:flex;"><span>&lt;bean id=<span style="color:#0ff;font-weight:bold">&#34;stringRedisSerializer&#34;</span> <span style="color:#fff;font-weight:bold">class</span>=<span style="color:#0ff;font-weight:bold">&#34;org.springframework.data.redis.serializer.StringRedisSerializer&#34;</span>&gt;&lt;/bean&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;bean id=<span style="color:#0ff;font-weight:bold">&#34;redisTemplate&#34;</span> <span style="color:#fff;font-weight:bold">class</span>=<span style="color:#0ff;font-weight:bold">&#34;org.springframework.data.redis.core.RedisTemplate&#34;</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;connectionFactory&#34;</span> ref=<span style="color:#0ff;font-weight:bold">&#34;connectionFactory&#34;</span>&gt;&lt;/property&gt;
</span></span><span style="display:flex;"><span>	&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;keySerializer&#34;</span> ref=<span style="color:#0ff;font-weight:bold">&#34;stringRedisSerializer&#34;</span>&gt;&lt;/property&gt;
</span></span><span style="display:flex;"><span>	&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;defaultSerializer&#34;</span> ref=<span style="color:#0ff;font-weight:bold">&#34;stringRedisSerializer&#34;</span>&gt;&lt;/property&gt;
</span></span><span style="display:flex;"><span>	&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;valueSerializer&#34;</span> ref=<span style="color:#0ff;font-weight:bold">&#34;jdkSerializationRedisSerializer&#34;</span>&gt;&lt;/property&gt;
</span></span><span style="display:flex;"><span>&lt;/bean&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;!-- <span style="color:#f00">哨兵配置</span> --&gt;
</span></span><span style="display:flex;"><span>&lt;bean id=<span style="color:#0ff;font-weight:bold">&#34;sentinelConfig&#34;</span> <span style="color:#fff;font-weight:bold">class</span>=<span style="color:#0ff;font-weight:bold">&#34;org.springframework.data.redis.connection.RedisSentinelConfiguration&#34;</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;!-- <span style="color:#f00">服务名称</span> --&gt;
</span></span><span style="display:flex;"><span>	&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;master&#34;</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;bean <span style="color:#fff;font-weight:bold">class</span>=<span style="color:#0ff;font-weight:bold">&#34;org.springframework.data.redis.connection.RedisNode&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;mymaster&#34;</span>&gt;&lt;/property&gt;
</span></span><span style="display:flex;"><span>		&lt;/bean&gt;
</span></span><span style="display:flex;"><span>	&lt;/property&gt;
</span></span><span style="display:flex;"><span>	&lt;!-- <span style="color:#f00">哨兵服务</span>IP和端口 --&gt;
</span></span><span style="display:flex;"><span>	&lt;property name=<span style="color:#0ff;font-weight:bold">&#34;sentinels&#34;</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;set&gt;
</span></span><span style="display:flex;"><span>			&lt;bean <span style="color:#fff;font-weight:bold">class</span>=<span style="color:#0ff;font-weight:bold">&#34;org.springframework.data.redis.connection.RedisNode&#34;</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;constructor-arg name=<span style="color:#0ff;font-weight:bold">&#34;host&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;192.168.11.128&#34;</span>&gt;&lt;/constructor-arg&gt;
</span></span><span style="display:flex;"><span>				&lt;constructor-arg name=<span style="color:#0ff;font-weight:bold">&#34;port&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;26379&#34;</span>&gt;&lt;/constructor-arg&gt;
</span></span><span style="display:flex;"><span>			&lt;/bean&gt;
</span></span><span style="display:flex;"><span>			&lt;bean <span style="color:#fff;font-weight:bold">class</span>=<span style="color:#0ff;font-weight:bold">&#34;org.springframework.data.redis.connection.RedisNode&#34;</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;constructor-arg name=<span style="color:#0ff;font-weight:bold">&#34;host&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;192.168.11.129&#34;</span>&gt;&lt;/constructor-arg&gt;
</span></span><span style="display:flex;"><span>				&lt;constructor-arg name=<span style="color:#0ff;font-weight:bold">&#34;port&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;26379&#34;</span>&gt;&lt;/constructor-arg&gt;
</span></span><span style="display:flex;"><span>			&lt;/bean&gt;
</span></span><span style="display:flex;"><span>			&lt;bean <span style="color:#fff;font-weight:bold">class</span>=<span style="color:#0ff;font-weight:bold">&#34;org.springframework.data.redis.connection.RedisNode&#34;</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;constructor-arg name=<span style="color:#0ff;font-weight:bold">&#34;host&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;192.168.11.130&#34;</span>&gt;&lt;/constructor-arg&gt;
</span></span><span style="display:flex;"><span>				&lt;constructor-arg name=<span style="color:#0ff;font-weight:bold">&#34;port&#34;</span> value=<span style="color:#0ff;font-weight:bold">&#34;26379&#34;</span>&gt;&lt;/constructor-arg&gt;
</span></span><span style="display:flex;"><span>			&lt;/bean&gt;
</span></span><span style="display:flex;"><span>		&lt;/set&gt;
</span></span><span style="display:flex;"><span>	&lt;/property&gt;
</span></span><span style="display:flex;"><span>&lt;/bean&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="哨兵模式的其他配置项">哨兵模式的其他配置项<a hidden class="anchor" aria-hidden="true" href="#哨兵模式的其他配置项">#</a></h3>
<table>
<thead>
<tr>
<th>配置项</th>
<th>参数类型</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>port</td>
<td>整数</td>
<td>启动哨兵进程端口</td>
</tr>
<tr>
<td>dir</td>
<td>文件夹目录</td>
<td>哨兵进程服务临时文件夹，默认为/tmp，要保证有可写入的权限</td>
</tr>
<tr>
<td>sentinel down-after-milliseconds</td>
<td>&lt;服务名称&gt;&lt;毫秒数（整数）&gt;</td>
<td>指定哨兵在监控Redis服务时，当Redis服务在一个默认毫秒数内都无法回答时，单个哨兵认为的主观下线时间，默认为30000（30秒）</td>
</tr>
<tr>
<td>sentinel parallel-syncs</td>
<td>&lt;服务名称&gt;&lt;服务器数（整数）&gt;</td>
<td>指定可以有多少个Redis服务同步新的主机，一般而言，这个数字越小同步时间越长，而越大，则对网络资源要求越高</td>
</tr>
<tr>
<td>sentinel failover-timeout</td>
<td>&lt;服务名称&gt;&lt;毫秒数（整数）&gt;</td>
<td>指定故障切换允许的毫秒数，超过这个时间，就认为故障切换失败，默认为3分钟</td>
</tr>
<tr>
<td>sentinel notification-script</td>
<td>&lt;服务名称&gt;&lt;脚本路径&gt;</td>
<td>指定sentinel检测到该监控的redis实例指向的实例异常时，调用的报警脚本。该配置项可选，比较常用</td>
</tr>
</tbody>
</table>
<p>sentinel down-after-milliseconds配置项只是一个哨兵在超过规定时间依旧没有得到响应后，会自己认为主机不可用。对于其他哨兵而言，并不是这样认为。哨兵会记录这个消息，当拥有认为主观下线的哨兵达到sentinel monitor所配置的数量时，就会发起一次投票，进行failover，此时哨兵会重写Redis的哨兵配置文件，以适应新场景的需要。</p>
<h2 id="redis主从配置哨兵模式docker实现">Redis主从配置、哨兵模式（Docker实现）<a hidden class="anchor" aria-hidden="true" href="#redis主从配置哨兵模式docker实现">#</a></h2>
<p>使用docker下载redis镜像，默认下载最新版本。
<code>docker pull redis</code></p>
<p>创建文件夹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cd /home
</span></span><span style="display:flex;"><span>mkdir docker
</span></span><span style="display:flex;"><span>cd docker
</span></span><span style="display:flex;"><span>mkdir redis
</span></span><span style="display:flex;"><span>cd redis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir redis-6379-data
</span></span><span style="display:flex;"><span>mkdir redis-6380-data
</span></span><span style="display:flex;"><span>mkdir redis-6381-data
</span></span><span style="display:flex;"><span>mkdir sentinel-26379-data
</span></span><span style="display:flex;"><span>mkdir sentinel-26380-data
</span></span><span style="display:flex;"><span>mkdir sentinel-26381-data
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建自定义配置文件</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>touch redis-6379.conf
</span></span><span style="display:flex;"><span>touch redis-6380.conf
</span></span><span style="display:flex;"><span>touch redis-6381.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中redis-6379.conf是master服务器配置文件，redis-6380.conf、redis-6381.conf 是slave服务器配置文件。</p>
<p>编辑6379配置文件，输入如下内容：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>port 6379
</span></span><span style="display:flex;"><span>logfile &#34;redis-6379.log&#34;
</span></span><span style="display:flex;"><span>dir /data
</span></span><span style="display:flex;"><span>appendonly yes
</span></span><span style="display:flex;"><span>appendfilename appendonly.aof
</span></span><span style="display:flex;"><span>masterauth 123456
</span></span><span style="display:flex;"><span>requirepass 123456
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑6380：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>port 6380
</span></span><span style="display:flex;"><span>logfile &#34;redis-6380.log&#34;
</span></span><span style="display:flex;"><span>dir /data
</span></span><span style="display:flex;"><span>appendonly yes
</span></span><span style="display:flex;"><span>appendfilename appendonly.aof
</span></span><span style="display:flex;"><span>slaveof 192.168.43.188 6379
</span></span><span style="display:flex;"><span>masterauth 123456
</span></span><span style="display:flex;"><span>requirepass 123456
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑6381：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>port 6381
</span></span><span style="display:flex;"><span>logfile &#34;redis-6381.log&#34;
</span></span><span style="display:flex;"><span>dir /data
</span></span><span style="display:flex;"><span>appendonly yes
</span></span><span style="display:flex;"><span>appendfilename appendonly.aof
</span></span><span style="display:flex;"><span>slaveof 192.168.43.188 6379
</span></span><span style="display:flex;"><span>masterauth 123456
</span></span><span style="display:flex;"><span>requirepass 123456
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后启动三个redis容器：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>docker run -p 6379:6379 --net=host --restart=always --name redis-6379 -v /home/docker/redis/redis-6379.conf:/etc/redis/redis-6379.conf -v /home/docker/redis/redis-6379-data:/data -d redis redis-server /etc/redis/redis-6379.conf
</span></span><span style="display:flex;"><span>docker run -p 6380:6380 --net=host --restart=always --name redis-6380 -v /home/docker/redis/redis-6380.conf:/etc/redis/redis-6380.conf -v /home/docker/redis/redis-6380-data:/data -d redis redis-server /etc/redis/redis-6380.conf
</span></span><span style="display:flex;"><span>docker run -p 6381:6381 --net=host --restart=always --name redis-6381 -v /home/docker/redis/redis-6381.conf:/etc/redis/redis-6381.conf -v /home/docker/redis/redis-6381-data:/data -d redis redis-server /etc/redis/redis-6381.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>命令解释：
<code>-v /home/docker/redis/redis-6379-data:/data</code>
该命令是将redis容器中，redis配置文件中指定的数据存储目录/data下文件的内容共享到宿主机/home/docker/redis/redis-6379-data目录下。
为何必须挂载<code>/data</code>目录？有状态容器都有数据持久化需求，在容器的生命周期内，数据持久化是持续的，包括容器在被停止后，但当容器被删除后，数据也随之被删除了，因此Docker 采用 volume （卷）的形式来向容器提供持久化存储，如果不设置该命令，数据库中的数据会默认保存在redis容器中的/data目录下，这样当执行 docker rm 容器id/容器name 命令，会丢失数据库中的数据。</p>
<p>查看容器状态：
<code>docker ps -a</code></p>
<p>如果STATUS状态是Up表示成功启动容器，如果STATUS状态是Exited (1) 或者 Restarting (1) 表示未能正常启动，这时候我们需要查看redis容器日志修改配置文件内容重新运行容器
<code>docker logs redis-6379|less</code>
查找出问题后停止redis容器
<code>docker stop redis-6379</code>
删除redis容器
<code>docker rm redis-6379</code>
然后重新执行步骤6。</p>
<p>启动redis容器后，分别观察三个redis容器内部情况
<code>docker exec -it redis-6379 /bin/bash</code>
<code>redis-cli</code>
<code>127.0.0.1:6379&gt; auth 123456</code>
<code>info replication</code></p>
<p>master会有如下显示</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># Replication
</span></span><span style="display:flex;"><span>role:master
</span></span><span style="display:flex;"><span>connected_slaves:2
</span></span><span style="display:flex;"><span>slave0:ip=172.17.0.1,port=6379,state=online,offset=707,lag=0
</span></span><span style="display:flex;"><span>slave1:ip=172.17.0.1,port=6379,state=online,offset=707,lag=0
</span></span><span style="display:flex;"><span>master_replid:db3135b2f4cba8e6c1eb4be290b9dbfc2ec3b6d0
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:707
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1
</span></span><span style="display:flex;"><span>repl_backlog_histlen:707
</span></span></code></pre></td></tr></table>
</div>
</div><p>slave显示：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>role:slave
</span></span><span style="display:flex;"><span>master_host:192.168.43.188
</span></span><span style="display:flex;"><span>master_port:6379
</span></span><span style="display:flex;"><span>master_link_status:up
</span></span><span style="display:flex;"><span>master_last_io_seconds_ago:8
</span></span><span style="display:flex;"><span>master_sync_in_progress:0
</span></span><span style="display:flex;"><span>slave_repl_offset:833
</span></span><span style="display:flex;"><span>slave_priority:100
</span></span><span style="display:flex;"><span>slave_read_only:1
</span></span><span style="display:flex;"><span>connected_slaves:0
</span></span><span style="display:flex;"><span>master_replid:db3135b2f4cba8e6c1eb4be290b9dbfc2ec3b6d0
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:833
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1
</span></span><span style="display:flex;"><span>repl_backlog_histlen:833
</span></span></code></pre></td></tr></table>
</div>
</div><p>看到主机role:master、connected_slaves:2，两台从机role:slave、master_host有地址，可以确认redis主从模式已经建立成功。
下面可以使用<code>RedisDesktopManager</code>或分别进入各个redis容器，来测试数据是否同步。测试过程我就略了。</p>
<h3 id="哨兵模式">哨兵模式<a hidden class="anchor" aria-hidden="true" href="#哨兵模式">#</a></h3>
<p>主机上创建哨兵配置文件</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>touch sentinel-26379.conf
</span></span><span style="display:flex;"><span>touch sentinel-26380.conf
</span></span><span style="display:flex;"><span>touch sentinel-26381.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑sentinel-26379.conf</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>port 26379
</span></span><span style="display:flex;"><span>dir &#34;/data&#34;
</span></span><span style="display:flex;"><span>logfile &#34;sentinel-26379.log&#34;
</span></span><span style="display:flex;"><span>sentinel monitor mymaster 192.168.43.188 6379 2
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds mymaster 10000
</span></span><span style="display:flex;"><span>sentinel failover-timeout mymaster 60000
</span></span><span style="display:flex;"><span>sentinel auth-pass mymaster 123456
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑sentinel-26380.conf</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>port 26380
</span></span><span style="display:flex;"><span>dir &#34;/data&#34;
</span></span><span style="display:flex;"><span>logfile &#34;sentinel-26380.log&#34;
</span></span><span style="display:flex;"><span>sentinel monitor mymaster 192.168.43.188 6379 2
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds mymaster 10000
</span></span><span style="display:flex;"><span>sentinel failover-timeout mymaster 60000
</span></span><span style="display:flex;"><span>sentinel auth-pass mymaster 123456
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑sentinel-26381.conf</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>port 26381
</span></span><span style="display:flex;"><span>dir &#34;/data&#34;
</span></span><span style="display:flex;"><span>logfile &#34;sentinel-26381.log&#34;
</span></span><span style="display:flex;"><span>sentinel monitor mymaster 192.168.43.188 6379 2
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds mymaster 10000
</span></span><span style="display:flex;"><span>sentinel failover-timeout mymaster 60000
</span></span><span style="display:flex;"><span>sentinel auth-pass mymaster 123456
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动哨兵：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>docker run -p 26379:26379 --restart=always --name sentinel-26379 -v/home/docker/redis/sentinel-26379.conf:/etc/redis/sentinel.conf -v /home/docker/redis/sentinel-26379-data:/data -d redis redis-sentinel /etc/redis/sentinel.conf
</span></span><span style="display:flex;"><span>docker run -p 26380:26380 --restart=always --name sentinel-26380 -v/home/docker/redis/sentinel-26380.conf:/etc/redis/sentinel.conf -v /home/docker/redis/sentinel-26380-data:/data -d redis redis-sentinel /etc/redis/sentinel.conf
</span></span><span style="display:flex;"><span>docker run -p 26381:26381 --restart=always --name sentinel-26381 -v/home/docker/redis/sentinel-26381.conf:/etc/redis/sentinel.conf -v /home/docker/redis/sentinel-26381-data:/data -d redis redis-sentinel /etc/redis/sentinel.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看哨兵容器状态
<code>docker ps -a</code></p>
<p>至此，哨兵模式已经建立起来，查看哨兵信息</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>[root@localhost redis]# docker exec -it sentinel-26379 /bin/bash
</span></span><span style="display:flex;"><span>root@zhangqian527halbin:/data# redis-cli -p 26379
</span></span><span style="display:flex;"><span>127.0.0.1:26379&gt;  info sentinel
</span></span><span style="display:flex;"><span># Sentinel
</span></span><span style="display:flex;"><span>sentinel_masters:1
</span></span><span style="display:flex;"><span>sentinel_tilt:0
</span></span><span style="display:flex;"><span>sentinel_running_scripts:0
</span></span><span style="display:flex;"><span>sentinel_scripts_queue_length:0
</span></span><span style="display:flex;"><span>sentinel_simulate_failure_flags:0
</span></span><span style="display:flex;"><span>master0:name=mymaster,status=ok,address=192.168.43.188:6379,slaves=2,sentinels=3
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，现在端口号为:6379的redis服务器是master服务器，这时我们关闭端口号为6379的redis-6379容器测试哨兵配置是否生效
<code>docker stop redis-6379</code></p>
<p>然后再查看哨兵信息，哨兵模式下，当master服务器宕机之后，哨兵自动会在从slave redis服务器里面投票选举一个master服务器来，这个master服务器也可以进行读写操作</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>[root@localhost redis]# docker exec -it sentinel-26379 /bin/bash
</span></span><span style="display:flex;"><span>root@zhangqian527halbin:/data# redis-cli -p 26379
</span></span><span style="display:flex;"><span>127.0.0.1:26379&gt;  info sentinel
</span></span><span style="display:flex;"><span>sentinel_masters:1
</span></span><span style="display:flex;"><span>sentinel_tilt:0
</span></span><span style="display:flex;"><span>sentinel_running_scripts:0
</span></span><span style="display:flex;"><span>sentinel_scripts_queue_length:0
</span></span><span style="display:flex;"><span>sentinel_simulate_failure_flags:0
</span></span><span style="display:flex;"><span>master0:name=mymaster,status=ok,address=192.168.43.188:6380,slaves=2,sentinels=3
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到端口号为:6380的redis服务器已经变成master服务器了，说明哨兵配置成功。
<a href="https://www.jianshu.com/p/ce1d78cd368a">参考</a></p>
<h2 id="redisson-实现分布式锁">redisson 实现分布式锁<a hidden class="anchor" aria-hidden="true" href="#redisson-实现分布式锁">#</a></h2>
<h3 id="1-引入依赖">1. 引入依赖<a hidden class="anchor" aria-hidden="true" href="#1-引入依赖">#</a></h3>
<p>在你的<code>pom.xml</code>文件中添加Redisson的Spring Boot Starter依赖：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.redisson<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>redisson-spring-boot-starter<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;version&gt;</span>3.17.6<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-配置redis">2. 配置Redis<a hidden class="anchor" aria-hidden="true" href="#2-配置redis">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">data</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">redis</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">host</span>: <span style="color:#0ff;font-weight:bold">192.168.1.1 # Redis服务器地址</span>
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">database</span>: <span style="color:#0ff;font-weight:bold">3 # Redis数据库索引（默认为0）</span>
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">port</span>: <span style="color:#0ff;font-weight:bold">6379 # Redis服务器连接端口</span>
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">password</span>: <span style="color:#0ff;font-weight:bold">123456 # Redis服务器连接密码（默认为空）</span>
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">timeout</span>: <span style="color:#0ff;font-weight:bold">30000 # 连接超时时间（毫秒）</span>
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">minIdle</span>: <span style="color:#0ff;font-weight:bold">20</span>
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">poolSize</span>: <span style="color:#0ff;font-weight:bold">30</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-配置类">3. 配置类<a hidden class="anchor" aria-hidden="true" href="#3-配置类">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Getter
</span></span><span style="display:flex;"><span>@Setter
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ConfigurationProperties(prefix = <span style="color:#0ff;font-weight:bold">&#34;spring.data.redis&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RedissonConfig {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String host;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Integer database;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String port;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String password;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> minIdle;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> poolSize;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> RedissonClient redissonClient() {
</span></span><span style="display:flex;"><span>        Config config = <span style="color:#fff;font-weight:bold">new</span> Config();
</span></span><span style="display:flex;"><span>        String node = <span style="color:#0ff;font-weight:bold">&#34;redis://&#34;</span> + host + <span style="color:#0ff;font-weight:bold">&#34;:&#34;</span> + port;
</span></span><span style="display:flex;"><span>        SingleServerConfig serverConfig = config.<span style="color:#007f7f">useSingleServer</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">setAddress</span>(node)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">setDatabase</span>(database)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">setConnectionPoolSize</span>(poolSize)
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">setConnectionMinimumIdleSize</span>(minIdle);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (StringUtils.<span style="color:#007f7f">isNotBlank</span>(password)) {
</span></span><span style="display:flex;"><span>            serverConfig.<span style="color:#007f7f">setPassword</span>(password);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> Redisson.<span style="color:#007f7f">create</span>(config);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-使用redisson分布式锁">4. 使用Redisson分布式锁<a hidden class="anchor" aria-hidden="true" href="#4-使用redisson分布式锁">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.redisson.api.RLock;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.redisson.api.RedissonClient;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Service;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.TimeUnit;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Service
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MyService {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> RedissonClient redissonClient;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> doSomething() {
</span></span><span style="display:flex;"><span>        RLock lock = redissonClient.<span style="color:#007f7f">getLock</span>(<span style="color:#0ff;font-weight:bold">&#34;myLock&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 尝试获取锁，最多等待2秒，上锁后10秒自动解锁</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (lock.<span style="color:#007f7f">tryLock</span>(2, 10, TimeUnit.<span style="color:#007f7f">SECONDS</span>)) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 在锁内执行的代码</span>
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取锁成功，执行受保护的代码&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 模拟一些长时间操作</span>
</span></span><span style="display:flex;"><span>                Thread.<span style="color:#007f7f">sleep</span>(5000);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 获取锁失败，可以提示用户，也可以执行其他操作</span>
</span></span><span style="display:flex;"><span>                Assert.<span style="color:#007f7f">isTrue</span>(<span style="color:#fff;font-weight:bold">false</span>, <span style="color:#0ff;font-weight:bold">&#34;您的请求过于频繁&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (lock.<span style="color:#007f7f">isLocked</span>() &amp;&amp; lock.<span style="color:#007f7f">isHeldByCurrentThread</span>()) {
</span></span><span style="display:flex;"><span>                lock.<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在 Redisson 中，<code>tryLock</code> 方法的三个参数分别是：</p>
<ol>
<li><strong>waitTime (long)</strong>：等待时间，即尝试获取锁的最大等待时间。</li>
<li><strong>leaseTime (long)</strong>：租约时间，即锁的持有时间，超过这个时间后锁会自动释放。</li>
<li><strong>timeUnit (TimeUnit)</strong>：时间单位，用于指定 <code>waitTime</code> 和 <code>leaseTime</code> 的单位。</li>
</ol>
<h3 id="waittime-等待时间"><code>waitTime</code> (等待时间)<a hidden class="anchor" aria-hidden="true" href="#waittime-等待时间">#</a></h3>
<p><code>waitTime</code> 是指线程在尝试获取锁时，等待的最大时间。设置 <code>waitTime</code> 时应考虑以下因素：</p>
<ol>
<li><strong>业务操作的重要性和紧急性</strong>：
<ul>
<li>如果业务操作非常重要且必须确保完成，可以设置较长的 <code>waitTime</code>，以尽量获取锁。</li>
<li>如果业务操作可以延迟或者有替代方案，可以设置较短的 <code>waitTime</code>，避免长时间阻塞线程。</li>
</ul>
</li>
<li><strong>系统的负载和并发情况</strong>：
<ul>
<li>在高并发环境中，较长的 <code>waitTime</code> 可能导致更多线程等待，从而增加系统压力。</li>
<li>在低并发环境中，较长的 <code>waitTime</code> 有助于成功获取锁，提高任务成功率。</li>
</ul>
</li>
<li><strong>用户体验</strong>：
<ul>
<li>对于用户操作的请求，过长的 <code>waitTime</code> 可能导致用户体验不佳，应尽量减少等待时间。</li>
</ul>
</li>
</ol>
<h3 id="leasetime-持有时间"><code>leaseTime</code> (持有时间)<a hidden class="anchor" aria-hidden="true" href="#leasetime-持有时间">#</a></h3>
<p><code>leaseTime</code> 是指锁的持有时间，超过这个时间后锁会自动释放。设置 <code>leaseTime</code> 时应考虑以下因素：</p>
<ol>
<li><strong>业务操作的执行时间</strong>：
<ul>
<li><code>leaseTime</code> 应该足够长，能够覆盖业务操作的执行时间，确保在操作完成之前锁不会被自动释放。</li>
<li>可以根据操作的复杂度和执行时间设置适当的 <code>leaseTime</code>，例如业务操作通常在5秒内完成，可以设置为10秒以确保安全。</li>
</ul>
</li>
<li><strong>防止死锁</strong>：
<ul>
<li>通过设置 <code>leaseTime</code>，可以防止锁因线程意外终止或未正常释放而导致的死锁。</li>
<li>确保 <code>leaseTime</code> 不要过长，以便锁可以尽快释放供其他线程使用。</li>
</ul>
</li>
</ol>
<h2 id="redis-setnx-命令实现分布式锁不推荐请使用redisson">Redis SETNX 命令实现分布式锁（不推荐，请使用redisson）<a hidden class="anchor" aria-hidden="true" href="#redis-setnx-命令实现分布式锁不推荐请使用redisson">#</a></h2>
<p>起因：
最开始我们是单服务，注册时候总是出现重复的手机号用户。
于是加了同步锁<code>synchronized</code>，解决了问题。</p>
<p>后来用了阿里云SLB分布式服务。又出现了重复注册的问题，想到用redis的SETNX来解决问题。
现在分布式的应用场景很多，为了保持数据的一致性，经常碰到需要对资源加锁的情形。利用redis来实现分布式锁就是其中的一种实现方案。
命令各式：
<code>SETNX key value</code></p>
<p>将 key 的值设为 value ，当且仅当 key 不存在。
若给定的 key 已经存在，则 SETNX 不做任何动作。
SETNX 是『SET if Not eXists』(如果不存在，则 SET)的简写。
设置成功，返回1。
设置失败，返回0。
利用SETNX的特性，很容易的想到，在需要加锁的时候，调用SETNX命令，如果返回了1，表示设置成功，获得了当前锁，之后做一些想要的操作，完成之后调用DEL命令释放锁。
因为java的try/catch特性，即使程序报错，我们也可以在finally块释放锁，这样不会因为程序报错导致所无法释放的情况。
示例代码：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>    Boolean result = redisTemplate.<span style="color:#007f7f">opsForValue</span>().<span style="color:#007f7f">setIfAbsent</span>(<span style="color:#0ff;font-weight:bold">&#34;reg_&#34;</span> + newUser.<span style="color:#007f7f">getMobile</span>(),newUser.<span style="color:#007f7f">getMobile</span>(),30,TimeUnit.<span style="color:#007f7f">SECONDS</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(result){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//插入新用户</span>
</span></span><span style="display:flex;"><span>        usersMapper.<span style="color:#007f7f">insertSelective</span>(newUser);
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#007f7f">delete</span>(<span style="color:#0ff;font-weight:bold">&#34;reg_&#34;</span> + newUser.<span style="color:#007f7f">getMobile</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (java.<span style="color:#007f7f">lang</span>.<span style="color:#007f7f">Exception</span> e) {
</span></span><span style="display:flex;"><span>    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>    redisTemplate.<span style="color:#007f7f">delete</span>(<span style="color:#0ff;font-weight:bold">&#34;reg_&#34;</span> + newUser.<span style="color:#007f7f">getMobile</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>幂等性：
HTTP/1.1中对幂等性的定义是：一次和多次请求某一个资源对于资源本身应该具有同样的结果（网络超时等问题除外）。也就是说，其任意多次执行对资源本身所产生的影响均与一次执行的影响相同。
很多复杂的事务要分布进行，但它们组成了一个整体，要么整体生效，要么整体失效。这种思想反应到数据库上，就是多条SQL语句，要么所有执行成功，要么所有执行失败。</p>
<p><a href="https://blog.csdn.net/harleylau/article/details/85856774">参考</a></p>
<h2 id="redis-key的设计">redis key的设计<a hidden class="anchor" aria-hidden="true" href="#redis-key的设计">#</a></h2>
<p>关系型数据库的redis
例：<code>user:userId:9:username</code></p>
<ol>
<li>表名：<code>user:</code></li>
<li>列名：<code>userId:</code></li>
<li>列值：<code>9:</code></li>
<li>要存储的列名：<code>username</code></li>
</ol>
<p><a href="https://www.joshua317.com/article/37">参考</a></p>
<h1 id="jedis操作redis">Jedis操作redis<a hidden class="anchor" aria-hidden="true" href="#jedis操作redis">#</a></h1>
<h2 id="初始化">初始化<a hidden class="anchor" aria-hidden="true" href="#初始化">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RedisClient {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> Jedis jedis;<span style="color:#007f7f">// 非切片客户端连接</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> JedisPool jedisPool;<span style="color:#007f7f">// 非切片连接池</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> ShardedJedis shardedJedis;<span style="color:#007f7f">// 切片客户端连接</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> ShardedJedisPool shardedJedisPool;<span style="color:#007f7f">// 切片连接池</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> RedisClient() {
</span></span><span style="display:flex;"><span>	initialPool();
</span></span><span style="display:flex;"><span>	initialShardedPool();
</span></span><span style="display:flex;"><span>	shardedJedis = shardedJedisPool.<span style="color:#007f7f">getResource</span>();
</span></span><span style="display:flex;"><span>	jedis = jedisPool.<span style="color:#007f7f">getResource</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//初始化非切片连接池</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> initialPool() {
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 池基本配置</span>
</span></span><span style="display:flex;"><span>	JedisPoolConfig config = <span style="color:#fff;font-weight:bold">new</span> JedisPoolConfig();
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//可用连接实例的最大数目，默认值为8</span>
</span></span><span style="display:flex;"><span>	config.<span style="color:#007f7f">setMaxActive</span>(20);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//控制一个pool最多有多少个状态为idle(空闲的)的jedis实例，默认值也是8</span>
</span></span><span style="display:flex;"><span>	config.<span style="color:#007f7f">setMaxIdle</span>(5);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//等待可用连接的最大时间，单位毫秒，默认值为-1，表示永不超时。如果超过等待时间，则直接抛出JedisConnectionException</span>
</span></span><span style="display:flex;"><span>	config.<span style="color:#007f7f">setMaxWait</span>(1000l);
</span></span><span style="display:flex;"><span>	config.<span style="color:#007f7f">setTestOnBorrow</span>(<span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	jedisPool = <span style="color:#fff;font-weight:bold">new</span> JedisPool(config, <span style="color:#0ff;font-weight:bold">&#34;127.0.0.1&#34;</span>, 6379);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//初始化切片池</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> initialShardedPool() {
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 池基本配置</span>
</span></span><span style="display:flex;"><span>	JedisPoolConfig config = <span style="color:#fff;font-weight:bold">new</span> JedisPoolConfig();
</span></span><span style="display:flex;"><span>	config.<span style="color:#007f7f">setMaxActive</span>(20);
</span></span><span style="display:flex;"><span>	config.<span style="color:#007f7f">setMaxIdle</span>(5);
</span></span><span style="display:flex;"><span>	config.<span style="color:#007f7f">setMaxWait</span>(1000l);
</span></span><span style="display:flex;"><span>	config.<span style="color:#007f7f">setTestOnBorrow</span>(<span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// slave链接</span>
</span></span><span style="display:flex;"><span>	List&lt;JedisShardInfo&gt; shards = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;JedisShardInfo&gt;();
</span></span><span style="display:flex;"><span>	shards.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> JedisShardInfo(<span style="color:#0ff;font-weight:bold">&#34;127.0.0.1&#34;</span>, 6379, <span style="color:#0ff;font-weight:bold">&#34;master&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 构造池</span>
</span></span><span style="display:flex;"><span>	shardedJedisPool = <span style="color:#fff;font-weight:bold">new</span> ShardedJedisPool(config, shards);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> show() {
</span></span><span style="display:flex;"><span>	KeyOperate();
</span></span><span style="display:flex;"><span>	StringOperate();
</span></span><span style="display:flex;"><span>	ListOperate();
</span></span><span style="display:flex;"><span>	SetOperate();
</span></span><span style="display:flex;"><span>	SortedSetOperate();
</span></span><span style="display:flex;"><span>	HashOperate();
</span></span><span style="display:flex;"><span>	jedisPool.<span style="color:#007f7f">returnResource</span>(jedis);
</span></span><span style="display:flex;"><span>	shardedJedisPool.<span style="color:#007f7f">returnResource</span>(shardedJedis);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="key-1">key<a hidden class="anchor" aria-hidden="true" href="#key-1">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * key 功能 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 1.清空所有数据 jedis.flushDB()
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 2.判断键是否存在 shardedJedis.exists(&#34;key1&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 3.新增键值对 shardedJedis.set(&#34;key001&#34;, &#34;value001&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 4.删除某个key,若key不存在，则忽略该命令 jedis.del(&#34;key002&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 5.设置 key001的过期时间 jedis.expire(&#34;key001&#34;, 5)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 6.查看某个key的剩余生存时间,单位【秒】.永久生存或者不存在的都返回-1  jedis.ttl(&#34;key001&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 7.移除某个key的生存时间  jedis.persist(&#34;key001&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 8.查看key所储存的值的类型 jedis.type(&#34;key001&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> KeyOperate() {
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;======================key==========================&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 清空数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;清空库中所有数据：&#34;</span> + jedis.<span style="color:#007f7f">flushDB</span>());
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 判断key否存在</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;判断key999键是否存在：&#34;</span> + shardedJedis.<span style="color:#007f7f">exists</span>(<span style="color:#0ff;font-weight:bold">&#34;key999&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;新增key001,value001键值对：&#34;</span> + shardedJedis.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value001&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;判断key001是否存在：&#34;</span> + shardedJedis.<span style="color:#007f7f">exists</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 输出系统中所有的key</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;新增key002,value002键值对：&#34;</span> + shardedJedis.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;key002&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value002&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;系统中所有键如下：&#34;</span>);
</span></span><span style="display:flex;"><span>	Set&lt;String&gt; keys = jedis.<span style="color:#007f7f">keys</span>(<span style="color:#0ff;font-weight:bold">&#34;*&#34;</span>);
</span></span><span style="display:flex;"><span>	Iterator&lt;String&gt; it = keys.<span style="color:#007f7f">iterator</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">while</span> (it.<span style="color:#007f7f">hasNext</span>()) {
</span></span><span style="display:flex;"><span>		String key = it.<span style="color:#007f7f">next</span>();
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(key);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 删除某个key,若key不存在，则忽略该命令。</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;系统中删除key002: &#34;</span> + jedis.<span style="color:#007f7f">del</span>(<span style="color:#0ff;font-weight:bold">&#34;key002&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;判断key002是否存在：&#34;</span> + shardedJedis.<span style="color:#007f7f">exists</span>(<span style="color:#0ff;font-weight:bold">&#34;key002&#34;</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 设置 key001的过期时间</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;设置 key001的过期时间为5秒:&#34;</span> + jedis.<span style="color:#007f7f">expire</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>, 5));
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>		Thread.<span style="color:#007f7f">sleep</span>(2000);
</span></span><span style="display:flex;"><span>	} <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 查看某个key的剩余生存时间,单位【秒】.永久生存或者不存在的都返回-1</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;查看key001的剩余生存时间：&#34;</span> + jedis.<span style="color:#007f7f">ttl</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 移除某个key的生存时间</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;移除key001的生存时间：&#34;</span> + jedis.<span style="color:#007f7f">persist</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;查看key001的剩余生存时间：&#34;</span> + jedis.<span style="color:#007f7f">ttl</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 查看key所储存的值的类型</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;查看key所储存的值的类型：&#34;</span> + jedis.<span style="color:#007f7f">type</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * 一些其他方法：1、修改键名：jedis.rename(&#34;key6&#34;, &#34;key0&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * 2、将当前db的key移动到给定的db当中：jedis.move(&#34;foo&#34;, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 */</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="string-2">string<a hidden class="anchor" aria-hidden="true" href="#string-2">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * String功能
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 1.一次性新增key201,key202  jedis.mset(&#34;key201&#34;, &#34;value201&#34;, &#34;key202&#34;, &#34;value202&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 2.一次性删除key201,key202  jedis.del(new String[] { &#34;key201&#34;, &#34;key202&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 3.一次性获取key201,key202  jedis.mget(&#34;key201&#34;, &#34;key202&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 4.新增键值对时防止覆盖原先值  shardedJedis.setnx(&#34;key302&#34;, &#34;value302_new&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 5.获取原值，更新为新值一步完成 shardedJedis.getSet(&#34;key302&#34;, &#34;value302-after-getset&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 6.获取key302对应值中的子串   shardedJedis.getrange(&#34;key302&#34;, 5, 7)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> StringOperate() {
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;======================String_1==========================&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 清空数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;清空库中所有数据：&#34;</span> + jedis.<span style="color:#007f7f">flushDB</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============增=============&#34;</span>);
</span></span><span style="display:flex;"><span>	jedis.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value001&#34;</span>);
</span></span><span style="display:flex;"><span>	jedis.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;key002&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value002&#34;</span>);
</span></span><span style="display:flex;"><span>	jedis.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;key003&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value003&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;已新增的3个键值对如下：&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(jedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(jedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key002&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(jedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key003&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============删=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;删除key003键值对：&#34;</span> + jedis.<span style="color:#007f7f">del</span>(<span style="color:#0ff;font-weight:bold">&#34;key003&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取key003键对应的值：&#34;</span> + jedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key003&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============改=============&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 1、直接覆盖原来的数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;直接覆盖key001原来的数据：&#34;</span> + jedis.<span style="color:#007f7f">set</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value001-update&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取key001对应的新值：&#34;</span> + jedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 2、直接覆盖原来的数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;在key002原来值后面追加：&#34;</span> + jedis.<span style="color:#007f7f">append</span>(<span style="color:#0ff;font-weight:bold">&#34;key002&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;+appendString&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取key002对应的新值&#34;</span> + jedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key002&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============增，删，查（多个）=============&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * mset,mget同时新增，修改，查询多个键值对 等价于： jedis.set(&#34;name&#34;,&#34;ssss&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * jedis.set(&#34;jarorwar&#34;,&#34;xxxx&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 */</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;一次性新增key201,key202,key203,key204及其对应值：&#34;</span>
</span></span><span style="display:flex;"><span>			+ jedis.<span style="color:#007f7f">mset</span>(<span style="color:#0ff;font-weight:bold">&#34;key201&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value201&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key202&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value202&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key203&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value203&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key204&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value204&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(
</span></span><span style="display:flex;"><span>			<span style="color:#0ff;font-weight:bold">&#34;一次性获取key201,key202,key203,key204各自对应的值：&#34;</span> + jedis.<span style="color:#007f7f">mget</span>(<span style="color:#0ff;font-weight:bold">&#34;key201&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key202&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key203&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key204&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;一次性删除key201,key202：&#34;</span> + jedis.<span style="color:#007f7f">del</span>(<span style="color:#fff;font-weight:bold">new</span> String[] { <span style="color:#0ff;font-weight:bold">&#34;key201&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key202&#34;</span> }));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(
</span></span><span style="display:flex;"><span>			<span style="color:#0ff;font-weight:bold">&#34;一次性获取key201,key202,key203,key204各自对应的值：&#34;</span> + jedis.<span style="color:#007f7f">mget</span>(<span style="color:#0ff;font-weight:bold">&#34;key201&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key202&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key203&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key204&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// jedis具备的功能shardedJedis中也可直接使用，下面测试一些前面没用过的方法</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;======================String_2==========================&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 清空数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;清空库中所有数据：&#34;</span> + jedis.<span style="color:#007f7f">flushDB</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============新增键值对时防止覆盖原先值=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;原先key301不存在时，新增key301：&#34;</span> + shardedJedis.<span style="color:#007f7f">setnx</span>(<span style="color:#0ff;font-weight:bold">&#34;key301&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value301&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;原先key302不存在时，新增key302：&#34;</span> + shardedJedis.<span style="color:#007f7f">setnx</span>(<span style="color:#0ff;font-weight:bold">&#34;key302&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value302&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;当key302存在时，尝试新增key302：&#34;</span> + shardedJedis.<span style="color:#007f7f">setnx</span>(<span style="color:#0ff;font-weight:bold">&#34;key302&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value302_new&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取key301对应的值：&#34;</span> + shardedJedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key301&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取key302对应的值：&#34;</span> + shardedJedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key302&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============超过有效期键值对被删除=============&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 设置key的有效期，并存储数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;新增key303，并指定过期时间为2秒&#34;</span> + shardedJedis.<span style="color:#007f7f">setex</span>(<span style="color:#0ff;font-weight:bold">&#34;key303&#34;</span>, 2, <span style="color:#0ff;font-weight:bold">&#34;key303-2second&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取key303对应的值：&#34;</span> + shardedJedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key303&#34;</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>		Thread.<span style="color:#007f7f">sleep</span>(3000);
</span></span><span style="display:flex;"><span>	} <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;3秒之后，获取key303对应的值：&#34;</span> + shardedJedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key303&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============获取原值，更新为新值一步完成=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;key302原值：&#34;</span> + shardedJedis.<span style="color:#007f7f">getSet</span>(<span style="color:#0ff;font-weight:bold">&#34;key302&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value302-after-getset&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;key302新值：&#34;</span> + shardedJedis.<span style="color:#007f7f">get</span>(<span style="color:#0ff;font-weight:bold">&#34;key302&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============获取子串=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取key302对应值中的子串：&#34;</span> + shardedJedis.<span style="color:#007f7f">getrange</span>(<span style="color:#0ff;font-weight:bold">&#34;key302&#34;</span>, 5, 7));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="list-1">list<a hidden class="anchor" aria-hidden="true" href="#list-1">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * List功能
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 1.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 2.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 3.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 4.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 5.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 6.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 7.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 8.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> ListOperate() {
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;======================list==========================&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 清空数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;清空库中所有数据：&#34;</span> + jedis.<span style="color:#007f7f">flushDB</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============增=============&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;vector&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;ArrayList&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;vector&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;vector&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;LinkedList&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;MapList&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;SerialList&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;HashList&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;numberlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;3&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;numberlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;numberlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;5&#34;</span>);
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lpush</span>(<span style="color:#0ff;font-weight:bold">&#34;numberlists&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;2&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;所有元素-stringlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">lrange</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, 0, -1));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;所有元素-numberlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">lrange</span>(<span style="color:#0ff;font-weight:bold">&#34;numberlists&#34;</span>, 0, -1));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============删=============&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 删除列表指定的值 ，第二个参数为删除的个数（有重复时），后add进去的值先被删，类似于出栈</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;成功删除指定元素个数-stringlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">lrem</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, 2, <span style="color:#0ff;font-weight:bold">&#34;vector&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;删除指定元素之后-stringlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">lrange</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, 0, -1));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 删除区间以外的数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;删除下标0-3区间之外的元素：&#34;</span> + shardedJedis.<span style="color:#007f7f">ltrim</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, 0, 3));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;删除指定区间之外元素后-stringlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">lrange</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, 0, -1));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 列表元素出栈</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;出栈元素：&#34;</span> + shardedJedis.<span style="color:#007f7f">lpop</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;元素出栈后-stringlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">lrange</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, 0, -1));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============改=============&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 修改列表中指定下标的值</span>
</span></span><span style="display:flex;"><span>	shardedJedis.<span style="color:#007f7f">lset</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, 0, <span style="color:#0ff;font-weight:bold">&#34;hello list!&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;下标为0的值修改后-stringlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">lrange</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, 0, -1));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============查=============&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 数组长度</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;长度-stringlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">llen</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;长度-numberlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">llen</span>(<span style="color:#0ff;font-weight:bold">&#34;numberlists&#34;</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 排序</span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * list中存字符串时必须指定参数为alpha，如果不使用SortingParams，而是直接使用sort(&#34;list&#34;)，
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * 会出现&#34;ERR One or more scores can&#39;t be converted into double&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 */</span>
</span></span><span style="display:flex;"><span>	SortingParams sortingParameters = <span style="color:#fff;font-weight:bold">new</span> SortingParams();
</span></span><span style="display:flex;"><span>	sortingParameters.<span style="color:#007f7f">alpha</span>();
</span></span><span style="display:flex;"><span>	sortingParameters.<span style="color:#007f7f">limit</span>(0, 3);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;返回排序后的结果-stringlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">sort</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, sortingParameters));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;返回排序后的结果-numberlists：&#34;</span> + shardedJedis.<span style="color:#007f7f">sort</span>(<span style="color:#0ff;font-weight:bold">&#34;numberlists&#34;</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 子串： start为元素下标，end也为元素下标；-1代表倒数一个元素，-2代表倒数第二个元素</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;子串-第二个开始到结束：&#34;</span> + shardedJedis.<span style="color:#007f7f">lrange</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, 1, -1));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 获取列表指定下标的值</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取下标为2的元素：&#34;</span> + shardedJedis.<span style="color:#007f7f">lindex</span>(<span style="color:#0ff;font-weight:bold">&#34;stringlists&#34;</span>, 2) + <span style="color:#0ff;font-weight:bold">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="set-2">set<a hidden class="anchor" aria-hidden="true" href="#set-2">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * Set功能
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 1.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 2.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 3.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 4.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 5.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 6.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 7.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 8.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> SetOperate() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;======================set==========================&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 清空数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;清空库中所有数据：&#34;</span> + jedis.<span style="color:#007f7f">flushDB</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============增=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;向sets集合中加入元素element001：&#34;</span> + jedis.<span style="color:#007f7f">sadd</span>(<span style="color:#0ff;font-weight:bold">&#34;sets&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element001&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;向sets集合中加入元素element002：&#34;</span> + jedis.<span style="color:#007f7f">sadd</span>(<span style="color:#0ff;font-weight:bold">&#34;sets&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element002&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;向sets集合中加入元素element003：&#34;</span> + jedis.<span style="color:#007f7f">sadd</span>(<span style="color:#0ff;font-weight:bold">&#34;sets&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element003&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;向sets集合中加入元素element004：&#34;</span> + jedis.<span style="color:#007f7f">sadd</span>(<span style="color:#0ff;font-weight:bold">&#34;sets&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element004&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;查看sets集合中的所有元素:&#34;</span> + jedis.<span style="color:#007f7f">smembers</span>(<span style="color:#0ff;font-weight:bold">&#34;sets&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============删=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;集合sets中删除元素element003：&#34;</span> + jedis.<span style="color:#007f7f">srem</span>(<span style="color:#0ff;font-weight:bold">&#34;sets&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element003&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;查看sets集合中的所有元素:&#34;</span> + jedis.<span style="color:#007f7f">smembers</span>(<span style="color:#0ff;font-weight:bold">&#34;sets&#34;</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">/*
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * System.out.println(&#34;sets集合中任意位置的元素出栈：&#34;+jedis.spop(&#34;sets&#34;));//注：
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * 出栈元素位置居然不定？--无实际意义
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 * System.out.println(&#34;查看sets集合中的所有元素:&#34;+jedis.smembers(&#34;sets&#34;));
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">	 */</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============改=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============查=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;判断element001是否在集合sets中：&#34;</span> + jedis.<span style="color:#007f7f">sismember</span>(<span style="color:#0ff;font-weight:bold">&#34;sets&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element001&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;循环查询获取sets中的每个元素：&#34;</span>);
</span></span><span style="display:flex;"><span>	Set&lt;String&gt; set = jedis.<span style="color:#007f7f">smembers</span>(<span style="color:#0ff;font-weight:bold">&#34;sets&#34;</span>);
</span></span><span style="display:flex;"><span>	Iterator&lt;String&gt; it = set.<span style="color:#007f7f">iterator</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">while</span> (it.<span style="color:#007f7f">hasNext</span>()) {
</span></span><span style="display:flex;"><span>		Object obj = it.<span style="color:#007f7f">next</span>();
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(obj);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============集合运算=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1中添加元素element001：&#34;</span> + jedis.<span style="color:#007f7f">sadd</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element001&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1中添加元素element002：&#34;</span> + jedis.<span style="color:#007f7f">sadd</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element002&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1中添加元素element003：&#34;</span> + jedis.<span style="color:#007f7f">sadd</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element003&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1中添加元素element002：&#34;</span> + jedis.<span style="color:#007f7f">sadd</span>(<span style="color:#0ff;font-weight:bold">&#34;sets2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element002&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1中添加元素element003：&#34;</span> + jedis.<span style="color:#007f7f">sadd</span>(<span style="color:#0ff;font-weight:bold">&#34;sets2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element003&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1中添加元素element004：&#34;</span> + jedis.<span style="color:#007f7f">sadd</span>(<span style="color:#0ff;font-weight:bold">&#34;sets2&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element004&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;查看sets1集合中的所有元素:&#34;</span> + jedis.<span style="color:#007f7f">smembers</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;查看sets2集合中的所有元素:&#34;</span> + jedis.<span style="color:#007f7f">smembers</span>(<span style="color:#0ff;font-weight:bold">&#34;sets2&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1和sets2交集：&#34;</span> + jedis.<span style="color:#007f7f">sinter</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;sets2&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1和sets2并集：&#34;</span> + jedis.<span style="color:#007f7f">sunion</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;sets2&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1和sets2差集：&#34;</span> + jedis.<span style="color:#007f7f">sdiff</span>(<span style="color:#0ff;font-weight:bold">&#34;sets1&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;sets2&#34;</span>));<span style="color:#007f7f">// 差集：set1中有，set2中没有的元素</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="sortedset">SortedSet<a hidden class="anchor" aria-hidden="true" href="#sortedset">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * SortedSet功能
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 1.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 2.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 3.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 4.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 5.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 6.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 7.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 8.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> SortedSetOperate() {
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;======================zset==========================&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 清空数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(jedis.<span style="color:#007f7f">flushDB</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============增=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;zset中添加元素element001：&#34;</span> + shardedJedis.<span style="color:#007f7f">zadd</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>, 7.<span style="color:#007f7f">0</span>, <span style="color:#0ff;font-weight:bold">&#34;element001&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;zset中添加元素element002：&#34;</span> + shardedJedis.<span style="color:#007f7f">zadd</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>, 8.<span style="color:#007f7f">0</span>, <span style="color:#0ff;font-weight:bold">&#34;element002&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;zset中添加元素element003：&#34;</span> + shardedJedis.<span style="color:#007f7f">zadd</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>, 2.<span style="color:#007f7f">0</span>, <span style="color:#0ff;font-weight:bold">&#34;element003&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;zset中添加元素element004：&#34;</span> + shardedJedis.<span style="color:#007f7f">zadd</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>, 3.<span style="color:#007f7f">0</span>, <span style="color:#0ff;font-weight:bold">&#34;element004&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;zset集合中的所有元素：&#34;</span> + shardedJedis.<span style="color:#007f7f">zrange</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>, 0, -1));<span style="color:#007f7f">// 按照权重值排序</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============删=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;zset中删除元素element002：&#34;</span> + shardedJedis.<span style="color:#007f7f">zrem</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element002&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;zset集合中的所有元素：&#34;</span> + shardedJedis.<span style="color:#007f7f">zrange</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>, 0, -1));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============改=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============查=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;统计zset集合中的元素中个数：&#34;</span> + shardedJedis.<span style="color:#007f7f">zcard</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;统计zset集合中权重某个范围内（1.0——5.0），元素的个数：&#34;</span> + shardedJedis.<span style="color:#007f7f">zcount</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>, 1.<span style="color:#007f7f">0</span>, 5.<span style="color:#007f7f">0</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;查看zset集合中element004的权重：&#34;</span> + shardedJedis.<span style="color:#007f7f">zscore</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;element004&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;查看下标1到2范围内的元素值：&#34;</span> + shardedJedis.<span style="color:#007f7f">zrange</span>(<span style="color:#0ff;font-weight:bold">&#34;zset&#34;</span>, 1, 2));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hash-2">hash<a hidden class="anchor" aria-hidden="true" href="#hash-2">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * Hash功能
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 1.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 2.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 3.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 4.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 5.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 6.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 7.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 8.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> HashOperate() {
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;======================hash==========================&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// 清空数据</span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(jedis.<span style="color:#007f7f">flushDB</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============增=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs中添加key001和value001键值对：&#34;</span> + shardedJedis.<span style="color:#007f7f">hset</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value001&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs中添加key002和value002键值对：&#34;</span> + shardedJedis.<span style="color:#007f7f">hset</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key002&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value002&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs中添加key003和value003键值对：&#34;</span> + shardedJedis.<span style="color:#007f7f">hset</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key003&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;value003&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;新增key004和4的整型键值对：&#34;</span> + shardedJedis.<span style="color:#007f7f">hincrBy</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key004&#34;</span>, 4l));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs中的所有值：&#34;</span> + shardedJedis.<span style="color:#007f7f">hvals</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============删=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs中删除key002键值对：&#34;</span> + shardedJedis.<span style="color:#007f7f">hdel</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key002&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs中的所有值：&#34;</span> + shardedJedis.<span style="color:#007f7f">hvals</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============改=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;key004整型键值的值增加100：&#34;</span> + shardedJedis.<span style="color:#007f7f">hincrBy</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key004&#34;</span>, 100l));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs中的所有值：&#34;</span> + shardedJedis.<span style="color:#007f7f">hvals</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;=============查=============&#34;</span>);
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;判断key003是否存在：&#34;</span> + shardedJedis.<span style="color:#007f7f">hexists</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key003&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取key004对应的值：&#34;</span> + shardedJedis.<span style="color:#007f7f">hget</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key004&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;批量获取key001和key003对应的值：&#34;</span> + shardedJedis.<span style="color:#007f7f">hmget</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key001&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;key003&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取hashs中所有的key：&#34;</span> + shardedJedis.<span style="color:#007f7f">hkeys</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;获取hashs中所有的value：&#34;</span> + shardedJedis.<span style="color:#007f7f">hvals</span>(<span style="color:#0ff;font-weight:bold">&#34;hashs&#34;</span>));
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="redistemplate">Redistemplate<a hidden class="anchor" aria-hidden="true" href="#redistemplate">#</a></h1>
<p><a href="https://blog.csdn.net/lydms/article/details/105224210">参考</a>
Jedis 和 Lettuce 是 Java 操作 Redis 的客户端。在 Spring Boot 1.x 版本默认使用的是 jedis ，而在 Spring Boot 2.x 版本默认使用的就是Lettuce。关于 Jedis 跟 Lettuce 的区别如下：</p>
<ul>
<li>Jedis在实现上是直接连接的redis server，如果在多线程环境下是非线程安全的，这个时候只有使用连接池，为每个Jedis实例增加物理连接。</li>
<li>Lettuce的连接是基于Netty的，连接实例（StatefulRedisConnection）可以在多个线程间并发访问，应为StatefulRedisConnection是线程安全的，所以一个连接实例（StatefulRedisConnection）就可以满足多线程环境下的并发访问，当然这个也是可伸缩的设计，一个连接实例不够的情况也可以按需增加连接实例。</li>
</ul>
<p>RedisTemplate是Spring Data Redis提供给用户的最高级的抽象客户端，用户可直接通过RedisTemplate进行多种操作，那么，我们先来看看RedisTemplate封装了哪些操作。下面这列表是RedisTemplate的继承关系和所有方法（已过滤重载方法，共有81个方法）</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//RedisAccessor是RedisTemplate定义普通属性的基类，不直接使用</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//RedisOperations是指定RedisTemplate实现的Redis connection操作的集合接口</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//BeanClassLoaderAware是给其实现类是设置类加载器的接口</span>
</span></span><span style="display:flex;"><span>RedisTemplate&lt;K, V&gt; <span style="color:#fff;font-weight:bold">extends</span> RedisAccessor <span style="color:#fff;font-weight:bold">implements</span> RedisOperations&lt;K, V&gt;, BeanClassLoaderAware
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//配置默认序列化与反序列化工具类</span>
</span></span><span style="display:flex;"><span>2.<span style="color:#007f7f">afterPropertiesSet</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//根据参数执行相关operation操作，例如，事务</span>
</span></span><span style="display:flex;"><span>3.<span style="color:#007f7f">execute</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//执行pipelining流水线相关操作</span>
</span></span><span style="display:flex;"><span>4.<span style="color:#007f7f">executePipelined</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//执行指定connection连接的相关操作</span>
</span></span><span style="display:flex;"><span>5.<span style="color:#007f7f">executeWithStickyConnection</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//执行session内的execute方法</span>
</span></span><span style="display:flex;"><span>6.<span style="color:#007f7f">executeSession</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//创建RedisConnection代理类</span>
</span></span><span style="display:flex;"><span>7.<span style="color:#007f7f">createRedisConnectionProxy</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//connection连接的预处理</span>
</span></span><span style="display:flex;"><span>8.<span style="color:#007f7f">preProcessConnection</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//结果的后处理，默认什么都不做</span>
</span></span><span style="display:flex;"><span>9.<span style="color:#007f7f">postProcessResult</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//是否向RedisCallback暴露本地连接</span>
</span></span><span style="display:flex;"><span>10.<span style="color:#007f7f">isExposeConnection</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//设置是否向RedisCallback暴露本地连接</span>
</span></span><span style="display:flex;"><span>11.<span style="color:#007f7f">setExposeConnection</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//12到26都是设置和获取相关序列化工具类</span>
</span></span><span style="display:flex;"><span>12.<span style="color:#007f7f">isEnableDefaultSerializer</span>
</span></span><span style="display:flex;"><span>13.<span style="color:#007f7f">setEnableDefaultSerializer</span>
</span></span><span style="display:flex;"><span>14.<span style="color:#007f7f">getDefaultSerializer</span>
</span></span><span style="display:flex;"><span>15.<span style="color:#007f7f">setDefaultSerializer</span>
</span></span><span style="display:flex;"><span>16.<span style="color:#007f7f">setKeySerializer</span>
</span></span><span style="display:flex;"><span>17.<span style="color:#007f7f">getKeySerializer</span>
</span></span><span style="display:flex;"><span>18.<span style="color:#007f7f">setValueSerializer</span>
</span></span><span style="display:flex;"><span>19.<span style="color:#007f7f">getValueSerializer</span>
</span></span><span style="display:flex;"><span>20.<span style="color:#007f7f">getHashKeySerializer</span>
</span></span><span style="display:flex;"><span>21.<span style="color:#007f7f">setHashKeySerializer</span>
</span></span><span style="display:flex;"><span>22.<span style="color:#007f7f">getHashValueSerializer</span>
</span></span><span style="display:flex;"><span>23.<span style="color:#007f7f">setHashValueSerializer</span>
</span></span><span style="display:flex;"><span>24.<span style="color:#007f7f">getStringSerializer</span>
</span></span><span style="display:flex;"><span>25.<span style="color:#007f7f">setStringSerializer</span>
</span></span><span style="display:flex;"><span>26.<span style="color:#007f7f">setScriptExecutor</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//27到34为私有方法，不对外提供使用</span>
</span></span><span style="display:flex;"><span>27.<span style="color:#007f7f">rawKey</span>
</span></span><span style="display:flex;"><span>28.<span style="color:#007f7f">rawString</span>
</span></span><span style="display:flex;"><span>29.<span style="color:#007f7f">rawValue</span>
</span></span><span style="display:flex;"><span>30.<span style="color:#007f7f">rawKeys</span>
</span></span><span style="display:flex;"><span>31.<span style="color:#007f7f">deserializeKey</span>
</span></span><span style="display:flex;"><span>32.<span style="color:#007f7f">deserializeMixedResults</span>
</span></span><span style="display:flex;"><span>33.<span style="color:#007f7f">deserializeSet</span>
</span></span><span style="display:flex;"><span>34.<span style="color:#007f7f">convertTupleValues</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//执行事务</span>
</span></span><span style="display:flex;"><span>35.<span style="color:#007f7f">exec</span>
</span></span><span style="display:flex;"><span>36.<span style="color:#007f7f">execRaw</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//删除操作</span>
</span></span><span style="display:flex;"><span>37.<span style="color:#007f7f">delete</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//接触链接</span>
</span></span><span style="display:flex;"><span>38.<span style="color:#007f7f">unlink</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//查看是否含有指定key</span>
</span></span><span style="display:flex;"><span>39.<span style="color:#007f7f">hasKey</span>
</span></span><span style="display:flex;"><span>40.<span style="color:#007f7f">countExistingKeys</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//设置过期时间</span>
</span></span><span style="display:flex;"><span>41.<span style="color:#007f7f">expire</span>
</span></span><span style="display:flex;"><span>42.<span style="color:#007f7f">expireAt</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//转换成字节流并向channel发送message</span>
</span></span><span style="display:flex;"><span>43.<span style="color:#007f7f">convertAndSend</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//获取过期时间</span>
</span></span><span style="display:flex;"><span>44.<span style="color:#007f7f">getExpire</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//根据传入的正则表达式返回所有的key</span>
</span></span><span style="display:flex;"><span>46.<span style="color:#007f7f">keys</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//取消指定key的过期时间</span>
</span></span><span style="display:flex;"><span>47.<span style="color:#007f7f">persist</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//移动指定的key和index到数据库中</span>
</span></span><span style="display:flex;"><span>48.<span style="color:#007f7f">move</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//从键空间随机获取一个key</span>
</span></span><span style="display:flex;"><span>49.<span style="color:#007f7f">randomKey</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//将指定key改成目标key</span>
</span></span><span style="display:flex;"><span>50.<span style="color:#007f7f">rename</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//key不存在时，将指定key改成目标key</span>
</span></span><span style="display:flex;"><span>51.<span style="color:#007f7f">renameIfAbsent</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//设置存储在指定key的类型</span>
</span></span><span style="display:flex;"><span>52.<span style="color:#007f7f">type</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//检索存储在key的值的序列化版本</span>
</span></span><span style="display:flex;"><span>53.<span style="color:#007f7f">dump</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//执行Redis的restore的命令</span>
</span></span><span style="display:flex;"><span>54.<span style="color:#007f7f">restore</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//标记事务阻塞的开始</span>
</span></span><span style="display:flex;"><span>55.<span style="color:#007f7f">multi</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//丢弃所有在multi之后发出的命令</span>
</span></span><span style="display:flex;"><span>56.<span style="color:#007f7f">discard</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//观察指定key在事务处理开始即multi之后的修改情况</span>
</span></span><span style="display:flex;"><span>57.<span style="color:#007f7f">watch</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//刷新先前观察的所有key</span>
</span></span><span style="display:flex;"><span>58.<span style="color:#007f7f">unwatch</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//为key元素排序</span>
</span></span><span style="display:flex;"><span>59.<span style="color:#007f7f">sort</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//关闭客户端连接</span>
</span></span><span style="display:flex;"><span>60.<span style="color:#007f7f">killClient</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//请求连接客户端的相关信息和统计数据</span>
</span></span><span style="display:flex;"><span>61.<span style="color:#007f7f">getClientList</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//更改复制配置到新的master</span>
</span></span><span style="display:flex;"><span>62.<span style="color:#007f7f">slaveOf</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//将本机更改为master</span>
</span></span><span style="display:flex;"><span>63.<span style="color:#007f7f">slaveOfNoOne</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//64到79都是获取相对应的操作</span>
</span></span><span style="display:flex;"><span>64.<span style="color:#007f7f">opsForCluster</span>
</span></span><span style="display:flex;"><span>65.<span style="color:#007f7f">opsForGeo</span>
</span></span><span style="display:flex;"><span>66.<span style="color:#007f7f">boundGeoOps</span>
</span></span><span style="display:flex;"><span>67.<span style="color:#007f7f">boundHashOps</span>
</span></span><span style="display:flex;"><span>68.<span style="color:#007f7f">opsForHash</span>
</span></span><span style="display:flex;"><span>69.<span style="color:#007f7f">opsForHyperLogLog</span>
</span></span><span style="display:flex;"><span>70.<span style="color:#007f7f">opsForList</span>
</span></span><span style="display:flex;"><span>71.<span style="color:#007f7f">boundListOps</span>
</span></span><span style="display:flex;"><span>72.<span style="color:#007f7f">boundSetOps</span>
</span></span><span style="display:flex;"><span>73.<span style="color:#007f7f">opsForSet</span>
</span></span><span style="display:flex;"><span>74.<span style="color:#007f7f">opsForStream</span>
</span></span><span style="display:flex;"><span>75.<span style="color:#007f7f">boundStreamOps</span>
</span></span><span style="display:flex;"><span>76.<span style="color:#007f7f">boundValueOps</span>
</span></span><span style="display:flex;"><span>77.<span style="color:#007f7f">opsForValue</span>
</span></span><span style="display:flex;"><span>78.<span style="color:#007f7f">boundZSetOps</span>
</span></span><span style="display:flex;"><span>79.<span style="color:#007f7f">opsForZSet</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//设置是否支持事务</span>
</span></span><span style="display:flex;"><span>80.<span style="color:#007f7f">setEnableTransactionSupport</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//设置bean的类加载器</span>
</span></span><span style="display:flex;"><span>81.<span style="color:#007f7f">setBeanClassLoader</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="简介">简介<a hidden class="anchor" aria-hidden="true" href="#简介">#</a></h2>
<p>spring-data-redis针对jedis提供了如下功能：</p>
<ul>
<li>连接池自动管理，提供了一个高度封装的“RedisTemplate”类</li>
<li>针对jedis客户端中大量api进行了归类封装，将同一类型操作封装为operation接口</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ValueOperations：简单K-V操作
</span></span><span style="display:flex;"><span>SetOperations：set类型数据操作
</span></span><span style="display:flex;"><span>ZSetOperations：zset类型数据操作
</span></span><span style="display:flex;"><span>HashOperations：针对map类型的数据操作
</span></span><span style="display:flex;"><span>ListOperations：针对list类型的数据操作
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>提供了对key的<code>bound</code>(绑定)便捷化操作API，可以通过bound封装指定的key，然后进行一系列的操作而无须“显式”的再次指定Key，即BoundKeyOperations：</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>BoundValueOperations
</span></span><span style="display:flex;"><span>BoundSetOperations
</span></span><span style="display:flex;"><span>BoundListOperations
</span></span><span style="display:flex;"><span>BoundSetOperations
</span></span><span style="display:flex;"><span>BoundHashOperations
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>将事务操作封装，有容器控制。</li>
<li>针对数据的“序列化/反序列化”，提供了多种可选择策略(RedisSerializer)
<ul>
<li>1.JdkSerializationRedisSerializer：POJO对象的存取场景，使用JDK本身序列化机制，将pojo类通过ObjectInputStream/ObjectOutputStream进行序列化操作，最终redis-server中将存储字节序列。是目前最常用的序列化策略。</li>
<li>2.StringRedisSerializer：Key或者value为字符串的场景，根据指定的charset对数据的字节序列编码成string，是“newString(bytes,charset)”和“string.getBytes(charset)”的直接封装。是最轻量级和高效的策略。</li>
<li>3.JacksonJsonRedisSerializer：jackson-json工具提供了javabean与json之间的转换能力，可以将pojo实例序列化成json格式存储在redis中，也可以将json格式的数据转换成pojo实例。因为jackson工具在序列化和反序列化时，需要明确指定Class类型，因此此策略封装起来稍微复杂。</li>
<li>4.OxmSerializer：提供了将javabean与xml之间的转换能力，目前可用的三方支持包括jaxb，apache-xmlbeans；redis存储的数据将是xml工具。不过使用此策略，编程将会有些难度，而且效率最低；不建议使用。【需要spring-oxm模块的支持】</li>
</ul>
</li>
</ul>
<p>如果你的数据需要被第三方工具解析，那么数据应该使用StringRedisSerializer而不是JdkSerializationRedisSerializer。</p>
<p>RedisTemplate中定义了对5种数据结构操作</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>redisTemplate.opsForValue();//操作字符串
</span></span><span style="display:flex;"><span>redisTemplate.opsForHash();//操作hash
</span></span><span style="display:flex;"><span>redisTemplate.opsForList();//操作list
</span></span><span style="display:flex;"><span>redisTemplate.opsForSet();//操作set
</span></span><span style="display:flex;"><span>redisTemplate.opsForZSet();//操作有序set
</span></span></code></pre></td></tr></table>
</div>
</div><p>其实这里的ops相当于options， 是RedisTemplate对各种不同的Redis数据类型进行操作。其实还有另外的方法</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>redistempalate.boundValueOps
</span></span><span style="display:flex;"><span>redistempalate.boundSetOps
</span></span><span style="display:flex;"><span>redistempalate.boundListOps
</span></span><span style="display:flex;"><span>redistempalate.boundHashOps
</span></span><span style="display:flex;"><span>redistempalate.boundZSetOps
</span></span></code></pre></td></tr></table>
</div>
</div><p>opsForXXX和boundXXXOps的区别？
XXX为value的类型，前者获取一个operator，但是没有指定操作的对象（key），可以在一个连接（事务）内操作多个key以及对应的value；
后者获取了一个指定操作对象（key）的operator，在一个连接（事务）内只能操作这个key对应的value。</p>
<h2 id="整合spring-boot">整合spring boot<a hidden class="anchor" aria-hidden="true" href="#整合spring-boot">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>application.properties</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#007f7f"># Redis数据库索引（默认为0）</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.redis.database</span>=<span style="color:#0ff;font-weight:bold">0  </span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Redis服务器地址</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.redis.host</span>=<span style="color:#0ff;font-weight:bold">127.0.0.1</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Redis服务器连接端口</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.redis.port</span>=<span style="color:#0ff;font-weight:bold">6379  </span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Redis服务器连接密码（默认为空）</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.redis.password</span>=
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 连接池最大连接数（使用负值表示没有限制）</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.redis.pool.max-active</span>=<span style="color:#0ff;font-weight:bold">8  </span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 连接池最大阻塞等待时间（使用负值表示没有限制）</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.redis.pool.max-wait</span>=<span style="color:#0ff;font-weight:bold">-1  </span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 连接池中的最大空闲连接</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.redis.pool.max-idle</span>=<span style="color:#0ff;font-weight:bold">8  </span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 连接池中的最小空闲连接</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.redis.pool.min-idle</span>=<span style="color:#0ff;font-weight:bold">0  </span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 连接超时时间（毫秒）</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">spring.redis.timeout</span>=<span style="color:#0ff;font-weight:bold">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>redis配置</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.redis.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.fasterxml.jackson.databind.ObjectMapper;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.wjy.redis.util.RedisUtil;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.core.RedisTemplate;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RedisConfig {
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> RedisTemplate&lt;String,Object&gt; redisTemplate(RedisConnectionFactory factory) {
</span></span><span style="display:flex;"><span>        RedisTemplate&lt;String, Object&gt; template = <span style="color:#fff;font-weight:bold">new</span> RedisTemplate&lt;&gt;();
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">setConnectionFactory</span>(factory);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span style="color:#fff;font-weight:bold">new</span> Jackson2JsonRedisSerializer(Object.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>        ObjectMapper om = <span style="color:#fff;font-weight:bold">new</span> ObjectMapper();
</span></span><span style="display:flex;"><span>        om.<span style="color:#007f7f">setVisibility</span>(PropertyAccessor.<span style="color:#007f7f">ALL</span>, JsonAutoDetect.<span style="color:#007f7f">Visibility</span>.<span style="color:#007f7f">ANY</span>);
</span></span><span style="display:flex;"><span>        om.<span style="color:#007f7f">enableDefaultTyping</span>(ObjectMapper.<span style="color:#007f7f">DefaultTyping</span>.<span style="color:#007f7f">NON_FINAL</span>);
</span></span><span style="display:flex;"><span>        jackson2JsonRedisSerializer.<span style="color:#007f7f">setObjectMapper</span>(om);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StringRedisSerializer stringRedisSerializer = <span style="color:#fff;font-weight:bold">new</span> StringRedisSerializer();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// key采用String的序列化方式</span>
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">setKeySerializer</span>(stringRedisSerializer);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// hash的key也采用String的序列化方式</span>
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">setHashKeySerializer</span>(stringRedisSerializer);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// value序列化方式采用jackson</span>
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">setValueSerializer</span>(jackson2JsonRedisSerializer);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// hash的value序列化方式采用jackson</span>
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">setHashValueSerializer</span>(jackson2JsonRedisSerializer);
</span></span><span style="display:flex;"><span>        template.<span style="color:#007f7f">afterPropertiesSet</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> template;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 注入封装RedisTemplate
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     *
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return RedisUtil
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @throws
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @Title: redisUtil
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @autor admin
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @date
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    @Bean(name = <span style="color:#0ff;font-weight:bold">&#34;redisUtil&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> RedisUtil redisUtil(RedisTemplate&lt;String, Object&gt; redisTemplate) {
</span></span><span style="display:flex;"><span>        RedisUtil redisUtil = <span style="color:#fff;font-weight:bold">new</span> RedisUtil();
</span></span><span style="display:flex;"><span>        redisUtil.<span style="color:#007f7f">setRedisTemplate</span>(redisTemplate);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisUtil;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="redistemplate操作redis">RedisTemplate操作Redis<a hidden class="anchor" aria-hidden="true" href="#redistemplate操作redis">#</a></h2>
<h3 id="通用操作">通用操作<a hidden class="anchor" aria-hidden="true" href="#通用操作">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.redis.util;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.data.redis.core.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.*;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.TimeUnit;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//参考</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// https://blog.csdn.net/lydms/article/details/105224210</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RedisUtil {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setRedisTemplate(RedisTemplate&lt;String, Object&gt; redisTemplate) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">redisTemplate</span> = redisTemplate;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//============================= 通用操作 ============================</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 指定缓存失效时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param time 时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> expire(String key,<span style="color:#fff;font-weight:bold">long</span> time){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span>(time &gt; 0){
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//redisTemplate.boundValueOps(&#34;HashKey&#34;).expire(1,TimeUnit.MINUTES);</span>
</span></span><span style="display:flex;"><span>                redisTemplate.<span style="color:#007f7f">expire</span>(key, time, TimeUnit.<span style="color:#007f7f">SECONDS</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 根据key 获取过期时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 时间(秒) 返回0代表为永久有效
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> getExpire(String key){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">getExpire</span>(key,TimeUnit.<span style="color:#007f7f">SECONDS</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 判断key是否存在
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true 存在 false不存在
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> hasKey(String key){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">hasKey</span>(key);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 删除缓存
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 可以传一个值 或多个
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    @SuppressWarnings(<span style="color:#0ff;font-weight:bold">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> del(String ... key){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(key!=<span style="color:#fff;font-weight:bold">null</span>&amp;&amp;key.<span style="color:#007f7f">length</span> &gt; 0){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span>(key.<span style="color:#007f7f">length</span> == 1){
</span></span><span style="display:flex;"><span>                redisTemplate.<span style="color:#007f7f">delete</span>(key[0]);
</span></span><span style="display:flex;"><span>            }<span style="color:#fff;font-weight:bold">else</span>{
</span></span><span style="display:flex;"><span>                redisTemplate.<span style="color:#007f7f">delete</span>(<span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;(Arrays.<span style="color:#007f7f">asList</span>(key)));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="string-3">string<a hidden class="anchor" aria-hidden="true" href="#string-3">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//============================ String操作 =============================</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 普通缓存获取
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Object get(String key){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(key == <span style="color:#fff;font-weight:bold">null</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//String str1 = (String) redisTemplate.boundValueOps(&#34;StringKey&#34;).get();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForValue</span>().<span style="color:#007f7f">get</span>(key);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 普通缓存放入
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true成功 false失败
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> set(String key,Object value) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForValue</span>().<span style="color:#007f7f">set</span>(key, value);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//redisTemplate.boundValueOps(&#34;StringKey&#34;).set(&#34;StringValue&#34;);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 普通缓存放入并设置时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param time 时间(秒) time要大于0 如果time小于等于0 将设置无限期
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true成功 false 失败
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> set(String key,Object value,<span style="color:#fff;font-weight:bold">long</span> time){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span>(time &gt; 0){
</span></span><span style="display:flex;"><span>                redisTemplate.<span style="color:#007f7f">opsForValue</span>().<span style="color:#007f7f">set</span>(key, value, time, TimeUnit.<span style="color:#007f7f">SECONDS</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//redisTemplate.boundValueOps(&#34;StringKey&#34;).set(&#34;StringValue&#34;,1, TimeUnit.MINUTES);</span>
</span></span><span style="display:flex;"><span>            }<span style="color:#fff;font-weight:bold">else</span>{
</span></span><span style="display:flex;"><span>                set(key, value);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 递增
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param delta 要增加几(大于0)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> incr(String key, <span style="color:#fff;font-weight:bold">long</span> delta){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(delta&lt;0){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;递增因子必须大于0&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForValue</span>().<span style="color:#007f7f">increment</span>(key, delta);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 递减
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param delta 要减少几(小于0)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> decr(String key, <span style="color:#fff;font-weight:bold">long</span> delta){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(delta&lt;0){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(<span style="color:#0ff;font-weight:bold">&#34;递减因子必须大于0&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForValue</span>().<span style="color:#007f7f">increment</span>(key, -delta);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="list-2">list<a hidden class="anchor" aria-hidden="true" href="#list-2">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">177
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//=============================== list操作 =================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获取list缓存的内容
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param start 开始
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param end 结束  0 到 -1代表所有值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> List&lt;Object&gt; lGet(String key, <span style="color:#fff;font-weight:bold">long</span> start, <span style="color:#fff;font-weight:bold">long</span> end){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">range</span>(key, start, end);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获取list缓存的长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> lGetListSize(String key){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">size</span>(key);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> 0;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 通过索引 获取list中的值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param index 索引  index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Object lGetIndex(String key,<span style="color:#fff;font-weight:bold">long</span> index){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">index</span>(key, index);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 给缓存中的list添加元素
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> lSet(String key, Object value) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//redisTemplate.boundListOps(&#34;listKey&#34;).leftPush(&#34;listLeftValue1&#34;);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//redisTemplate.boundListOps(&#34;listKey&#34;).rightPush(&#34;listRightValue2&#34;);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">rightPush</span>(key, value);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//redisTemplate.opsForList().leftPush(key, value);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 给缓存中的list添加元素，并设置时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param time 时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> lSet(String key, Object value, <span style="color:#fff;font-weight:bold">long</span> time) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">rightPush</span>(key, value);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//redisTemplate.opsForList().leftPush(key, value);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (time &gt; 0){
</span></span><span style="display:flex;"><span>                expire(key, time);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 将整个list放入缓存
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param list 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> lSet(String key, List&lt;Object&gt; list) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">rightPushAll</span>(key, list);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//redisTemplate.boundListOps(&#34;listKey&#34;).leftPushAll(list);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 将整个list放入缓存，并设置时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param list 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param time 时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> lSet(String key, List&lt;Object&gt; list, <span style="color:#fff;font-weight:bold">long</span> time) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">rightPushAll</span>(key, list);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//redisTemplate.boundListOps(&#34;listKey&#34;).leftPushAll(list);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (time &gt; 0) {
</span></span><span style="display:flex;"><span>                expire(key, time);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 根据索引修改list中的某条数据
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param index 索引
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> lUpdateIndex(String key, <span style="color:#fff;font-weight:bold">long</span> index,Object value) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">set</span>(key, index, value);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 移除N个值为value
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param count 移除多少个
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 移除的个数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> lRemove(String key,<span style="color:#fff;font-weight:bold">long</span> count,Object value) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            Long remove = redisTemplate.<span style="color:#007f7f">opsForList</span>().<span style="color:#007f7f">remove</span>(key, count, value);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> remove;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> 0;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 从左侧弹出元素
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> leftPopValue(String key){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//从左侧弹出一个元素</span>
</span></span><span style="display:flex;"><span>        String listKey = (String) redisTemplate.<span style="color:#007f7f">boundListOps</span>(<span style="color:#0ff;font-weight:bold">&#34;listKey&#34;</span>).<span style="color:#007f7f">leftPop</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 从右侧弹出元素
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> rightPopValue(String key){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//从右侧弹出一个元素</span>
</span></span><span style="display:flex;"><span>        String listKey = (String) redisTemplate.<span style="color:#007f7f">boundListOps</span>(<span style="color:#0ff;font-weight:bold">&#34;listKey&#34;</span>).<span style="color:#007f7f">rightPop</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="hash-3">hash<a hidden class="anchor" aria-hidden="true" href="#hash-3">#</a></h3>
<p>Redis的Hash结构类似于Java中的Map&lt;String,Map&lt;String,Stgring&raquo;，键是字符串，值是另一个映射。因此Hash结构很适合用来存储对象。
键：对象名称
字段名：属性名
字段值：属性值。</p>
<p>string + json 也是存储对象的一种方式，那么存储对象时，到底用 string + json 还是用 hash 呢？</p>
<p>两种存储方式的对比如下表所示：</p>
<table>
<thead>
<tr>
<th>String + json</th>
<th>Hash</th>
</tr>
</thead>
<tbody>
<tr>
<td>效率</td>
<td>很高</td>
</tr>
<tr>
<td>容量</td>
<td>低</td>
</tr>
<tr>
<td>灵活性</td>
<td>低</td>
</tr>
<tr>
<td>序列化</td>
<td>简单</td>
</tr>
</tbody>
</table>
<p>当对象的某个属性需要频繁修改时，不适合用 string+json，因为它不够灵活，每次修改都需要重新将整个对象序列化并赋值，如果使用 hash 类型，则可以针对某个属性单独修改，没有序列化，也不需要修改整个对象。比如，商品的价格、销量、关注数、评价数等可能经常发生变化的属性，就适合存储在hash类型里。当然，不常变化的属性存储在 hash 类型里也没有问题，比如商品名称、商品描述、上市日期等。</p>
<p>但是，当对象的某个属性不是基本类型或字符串时，使用 hash 类型就必须手动进行复杂序列化，比如，商品的标签是一个标签对象的列表，商品可领取的优惠券是一个优惠券对象的列表等，即使以 coupons（优惠券）作为 field，value 想存储优惠券对象列表也还是要使用 json 来序列化，这样的话序列化工作就太繁琐了，不如直接用 string + json 的方式存储商品信息来的简单。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//================================ hash操作 =================================</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * HashGet
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key redis键 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param mapKey map键 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Object hGet(String key,String mapKey){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">get</span>(key, mapKey);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获取hashKey对应的所有键值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 对应的多个键值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Map&lt;Object,Object&gt; hGetMap(String key){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//通过BoundValueOperations获取值</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//Map entries = redisTemplate.boundHashOps(&#34;HashKey&#34;).entries();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">entries</span>(key);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获取map的所有key
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Set&lt;Object&gt; hGetMapKeys(String hashKey){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//1、通过BoundValueOperations获取值</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//        Set keys1 = redisTemplate.boundHashOps(hashKey).keys();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//2、通过ValueOperations获取值</span>
</span></span><span style="display:flex;"><span>        Set keys3 = redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">keys</span>(hashKey);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> keys3;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获取map的所有value
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> List&lt;Object&gt; hGetMapValues(String hashKey){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//1、通过BoundValueOperations获取值</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//        List values1 = redisTemplate.boundHashOps(hashKey).values();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//2、通过ValueOperations获取值</span>
</span></span><span style="display:flex;"><span>        List values3 = redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">values</span>(hashKey);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> values3;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 直接set一个map到redis
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param map 对应多个键值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true 成功 false 失败
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> hSetMap(String key, Map&lt;String,Object&gt; map){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">putAll</span>(key, map);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 直接set一个map到redis，并设置时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param map 对应多个键值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param time 时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true成功 false失败
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> hSetMap(String key, Map&lt;String,Object&gt; map, <span style="color:#fff;font-weight:bold">long</span> time){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">putAll</span>(key, map);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span>(time&gt;0){
</span></span><span style="display:flex;"><span>                expire(key, time);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 向一张hash表中放入数据,如果不存在将创建
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param item 项
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true 成功 false失败
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> hSet(String key,String item,Object value) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//redisTemplate.boundHashOps(&#34;HashKey&#34;).put(&#34;SmallKey&#34;, &#34;HashValue&#34;);</span>
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">put</span>(key, item, value);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 向一张hash表中放入数据,如果不存在将创建
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param item 项
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param time 时间(秒)  注意:如果已存在的hash表有时间,这里将会替换原有的时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true 成功 false失败
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> hSet(String key,String item,Object value,<span style="color:#fff;font-weight:bold">long</span> time) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">put</span>(key, item, value);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span>(time&gt;0){
</span></span><span style="display:flex;"><span>                expire(key, time);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 删除hash表中的值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param item 项 可以使多个 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> hDel(String key, Object... item){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//redisTemplate.boundHashOps(&#34;HashKey&#34;).delete(&#34;SmallKey&#34;);</span>
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">delete</span>(key,item);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 判断hash表中是否有该项的值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param item 项 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true 存在 false不存在
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> hHasKey(String key, String item){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//Boolean isEmpty = redisTemplate.boundHashOps(&#34;HashKey&#34;).hasKey(&#34;SmallKey&#34;);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">hasKey</span>(key, item);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param item 项
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param by 要增加几(大于0)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">double</span> hIncr(String key, String item,<span style="color:#fff;font-weight:bold">double</span> by){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">increment</span>(key, item, by);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * hash递减
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param item 项
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param by 要减少记(小于0)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">double</span> hDecr(String key, String item,<span style="color:#fff;font-weight:bold">double</span> by){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForHash</span>().<span style="color:#007f7f">increment</span>(key, item,-by);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="set-3">set<a hidden class="anchor" aria-hidden="true" href="#set-3">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">99
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//============================ set操作 =============================</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 根据key获取Set中的所有值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Set&lt;Object&gt; sGet(String key){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//Set set1 = redisTemplate.boundSetOps(&#34;setKey&#34;).members();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForSet</span>().<span style="color:#007f7f">members</span>(key);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 根据value从一个set中查询,是否存在
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return true 存在 false不存在
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> sHasKey(String key,Object value){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//Boolean isEmpty = redisTemplate.boundSetOps(&#34;setKey&#34;).isMember(&#34;setValue2&#34;);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForSet</span>().<span style="color:#007f7f">isMember</span>(key, value);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 将数据放入set缓存
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param values 值 可以是多个
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 成功个数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> sSet(String key, Object...<span style="color:#007f7f">values</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//redisTemplate.boundSetOps(&#34;setKey&#34;).add(&#34;setValue1&#34;, &#34;setValue2&#34;, &#34;setValue3&#34;);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForSet</span>().<span style="color:#007f7f">add</span>(key, values);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> 0;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 将set数据放入缓存
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param time 时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param values 值 可以是多个
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 成功个数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> sSetAndTime(String key,<span style="color:#fff;font-weight:bold">long</span> time,Object...<span style="color:#007f7f">values</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            Long count = redisTemplate.<span style="color:#007f7f">opsForSet</span>().<span style="color:#007f7f">add</span>(key, values);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span>(time &gt; 0){
</span></span><span style="display:flex;"><span>                expire(key, time);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> count;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> 0;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获取set缓存的长度
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> sGetSetSize(String key){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//Long size = redisTemplate.boundSetOps(&#34;setKey&#34;).size();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> redisTemplate.<span style="color:#007f7f">opsForSet</span>().<span style="color:#007f7f">size</span>(key);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> 0;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 移除值为value的
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param values 值 可以是多个
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 移除的个数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> setRemove(String key, Object ...<span style="color:#007f7f">values</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//Long result1 = redisTemplate.boundSetOps(&#34;setKey&#34;).remove(&#34;setValue1&#34;);</span>
</span></span><span style="display:flex;"><span>            Long count = redisTemplate.<span style="color:#007f7f">opsForSet</span>().<span style="color:#007f7f">remove</span>(key, values);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> count;
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> 0;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="zset">zSet<a hidden class="anchor" aria-hidden="true" href="#zset">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//=============================== zSet操作 =================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 向集合中插入元素，并设置分数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param zSetKey
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param zSetValue
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param score
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> zSetSet(String zSetKey,String zSetValue,<span style="color:#fff;font-weight:bold">double</span> score){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//通过ValueOperations设置值</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ZSetOperations zSetOps = redisTemplate.opsForZSet();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//zSetOps.add(&#34;zSetKey&#34;, &#34;zSetValue&#34;, 100D);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">boolean</span> success = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">add</span>(zSetValue, score);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> success;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 向集合中插入多个元素,并设置分数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> zSetMany(String zSetKey){
</span></span><span style="display:flex;"><span>        DefaultTypedTuple&lt;String&gt; p1 = <span style="color:#fff;font-weight:bold">new</span> DefaultTypedTuple&lt;&gt;(<span style="color:#0ff;font-weight:bold">&#34;zSetValue1&#34;</span>, 2.<span style="color:#007f7f">1D</span>);
</span></span><span style="display:flex;"><span>        DefaultTypedTuple&lt;String&gt; p2 = <span style="color:#fff;font-weight:bold">new</span> DefaultTypedTuple&lt;&gt;(<span style="color:#0ff;font-weight:bold">&#34;zSetValue2&#34;</span>, 3.<span style="color:#007f7f">3D</span>);
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> HashSet(Arrays.<span style="color:#007f7f">asList</span>(p1,p2)));
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获取区间内的元素，按照排名先后(从小到大)-1为打印全部
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Set&lt;Object&gt; getSet(String zSetKey){
</span></span><span style="display:flex;"><span>        Set&lt;Object&gt; range = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">range</span>(0, -1);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> range;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 返回集合内的成员个数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param zSetKey
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> getZSetCount(String zSetKey){
</span></span><span style="display:flex;"><span>        Long count = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">size</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> count;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 返回集合内指定分数范围的成员个数（Double类型）
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param zSetKey
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> getZSetCountRange(String zSetKey){
</span></span><span style="display:flex;"><span>        Long count = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">count</span>(0D, 2.<span style="color:#007f7f">2D</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> count;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 返回集合内元素在指定分数范围内的排名（从小到大）
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Set&lt;Object&gt; getSetByRange(String zSetKey){
</span></span><span style="display:flex;"><span>        Set&lt;Object&gt; byScore = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">rangeByScore</span>(0D, 2.<span style="color:#007f7f">2D</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> byScore;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 返回集合内元素在指定分数范围内的排名：带偏移量和个数，(key，起始分数，最大分数，偏移量，个数)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Set&lt;Object&gt; getSetByOffset(String zSetKey){
</span></span><span style="display:flex;"><span>        Set&lt;Object&gt; rank = redisTemplate.<span style="color:#007f7f">opsForZSet</span>().<span style="color:#007f7f">rangeByScore</span>(<span style="color:#0ff;font-weight:bold">&#34;zSetKey&#34;</span>, 0D, 2.<span style="color:#007f7f">2D</span>,1, 3);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> rank;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 返回集合内元素的排名，以及分数（从小到大）
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param zSetKey
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Set&lt;ZSetOperations.<span style="color:#007f7f">TypedTuple</span>&lt;Object&gt;&gt; getSetByRangeAndScore(String zSetKey){
</span></span><span style="display:flex;"><span>        Set&lt;ZSetOperations.<span style="color:#007f7f">TypedTuple</span>&lt;Object&gt;&gt; tuples = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">rangeWithScores</span>(0L, 3L);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (ZSetOperations.<span style="color:#007f7f">TypedTuple</span>&lt;Object&gt; tuple : tuples) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(tuple.<span style="color:#007f7f">getValue</span>() + <span style="color:#0ff;font-weight:bold">&#34; : &#34;</span> + tuple.<span style="color:#007f7f">getScore</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> tuples;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获取指定成员的排名
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param zSetKey
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> getStartRank(String zSetKey){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//从小到大</span>
</span></span><span style="display:flex;"><span>        Long startRank = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">rank</span>(<span style="color:#0ff;font-weight:bold">&#34;zSetValue&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//从大到小</span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//Long endRank = redisTemplate.boundZSetOps(zSetKey).reverseRank(&#34;zSetValue&#34;);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> startRank;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 为指定元素加分（Double类型）
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Double zSetAddScore(String zSetKey){
</span></span><span style="display:flex;"><span>        Double score = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">incrementScore</span>(<span style="color:#0ff;font-weight:bold">&#34;zSetValue&#34;</span>,1.<span style="color:#007f7f">1D</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> score;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 获得指定元素的分数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param zSetKey
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Double getScoreByZSetKey(String zSetKey){
</span></span><span style="display:flex;"><span>        Double score = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">score</span>(<span style="color:#0ff;font-weight:bold">&#34;zSetValue&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> score;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 从集合中删除指定元素
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 删除成功的元素个数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> zSetRemove(String zSetKey){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span> delNum = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">remove</span>(<span style="color:#0ff;font-weight:bold">&#34;zSetValue&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> delNum;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 从集合中删除指定元素，根据范围
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 删除成功的元素个数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> zSetRemoveByRange(String zSetKey){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span> delNum = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">removeRange</span>(0L,3L);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> delNum;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 从集合中删除指定元素，根据分数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return 删除成功的元素个数
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">long</span> zSetRemoveByScore(String zSetKey){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span> delNum = redisTemplate.<span style="color:#007f7f">boundZSetOps</span>(zSetKey).<span style="color:#007f7f">removeRangeByScore</span>(0D,2.<span style="color:#007f7f">2D</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> delNum;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="redis开发规范">redis开发规范<a hidden class="anchor" aria-hidden="true" href="#redis开发规范">#</a></h1>
<h2 id="key名设计">key名设计<a hidden class="anchor" aria-hidden="true" href="#key名设计">#</a></h2>
<p>【建议】: 可读性和可管理性</p>
<p>以业务名（或数据库名）为前缀（防止key冲突），用冒号分隔，比如</p>
<p><code>业务名:表名:id</code></p>
<p><code>ugc:video:1</code></p>
<p>【建议】：简洁性</p>
<p>保证语义的前提下，控制key的长度，当key较多时，内存占用也不容忽视，例如：</p>
<p><code>user:{uid}:friends:messages:{mid}</code></p>
<p>简化为</p>
<p><code>u:{uid}:fr:m:{mid}</code></p>
<p>【强制】：不要包含特殊字符</p>
<p>反例：包含空格、换行、单双引号以及其他转义字符</p>
<p><a href="https://mp.weixin.qq.com/s?spm=a2c6h.12873639.article-detail.7.23551fee7lWP7T&__biz=Mzg2NTEyNzE0OA==&mid=2247483663&idx=1&sn=7c4ad441eaec6f0ff38d1c6a097b1fa4&chksm=ce5f9e8cf928179a2c74227da95bec575bdebc682e8630b5b1bb2071c0a1b4be6f98d67c37ca&scene=21#wechat_redirect">详解</a></p>
<h2 id="value设计">value设计<a hidden class="anchor" aria-hidden="true" href="#value设计">#</a></h2>
<p>【强制】：拒绝 bigkey（防止网卡流量、慢查询）</p>
<p>string类型控制在10KB以内，hash、list、set、zset元素个数不要超过5000。</p>
<p>反例：一个包含200万个元素的list。</p>
<p>非字符串的bigkey，不要使用del删除，使用hscan、sscan、zscan方式渐进式删除，同时要注意防止bigkey过期时间自动删除问题(例如一个200万的zset设置1小时过期，会触发del操作，造成阻塞，而且该操作不会不出现在慢查询中(latency可查))，查找方法和删除方法。</p>
<p>【推荐】：选择适合的数据类型。</p>
<p>例如：实体类型，要合理控制和使用数据结构内存编码优化配置，例如ziplist，但也要注意节省内存和性能之间的平衡</p>
<p>反例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> user:1:name tom
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> user:1:age <span style="color:#ff0;font-weight:bold">19</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">set</span> user:1:favor football
</span></span></code></pre></td></tr></table>
</div>
</div><p>正例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>hmset user:1 name tom age <span style="color:#ff0;font-weight:bold">19</span> favor football
</span></span></code></pre></td></tr></table>
</div>
</div><p>【推荐】：控制key的生命周期</p>
<p>建议使用expire设置过期时间(条件允许可以打散过期时间，防止集中过期)，不过期的数据重点关注idletime。</p>
<h2 id="命令使用">命令使用<a hidden class="anchor" aria-hidden="true" href="#命令使用">#</a></h2>
<p>【推荐】 O(N)命令关注N的数量
例如hgetall、lrange、smembers、zrange、sinter等并非不能使用，但是需要明确N的值。有遍历的需求可以使用hscan、sscan、zscan代替。</p>
<p>【推荐】：禁用命令
禁止线上使用keys、flushall、flushdb等，通过redis的rename机制禁掉命令，或者使用scan的方式渐进式处理。</p>
<p>【推荐】合理使用select
redis的多数据库较弱，使用数字进行区分，很多客户端支持较差，同时多业务用多数据库实际还是单线程处理，会有干扰。</p>
<p>【推荐】使用批量操作提高效率</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>原生命令：例如mget、mset。
</span></span><span style="display:flex;"><span>非原生命令：可以使用pipeline提高效率。
</span></span></code></pre></td></tr></table>
</div>
</div><p>但要注意控制一次批量操作的<strong>元素个数</strong>(例如500以内，实际也和元素字节数有关)。</p>
<p>注意两者不同：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>1. 原生是原子操作，pipeline是非原子操作。
</span></span><span style="display:flex;"><span>2. pipeline可以打包不同的命令，原生做不到
</span></span><span style="display:flex;"><span>3. pipeline需要客户端和服务端同时支持。
</span></span></code></pre></td></tr></table>
</div>
</div><p>【建议】Redis事务功能较弱，不建议过多使用
Redis的事务功能较弱(不支持回滚)，而且集群版本(自研和官方)要求一次事务操作的key必须在一个slot上(可以使用hashtag功能解决)</p>
<p>【建议】Redis集群版本在使用Lua上有特殊要求：</p>
<ul>
<li>1.所有key都应该由 KEYS 数组来传递，redis.call/pcall 里面调用的redis命令，key的位置，必须是KEYS array, 否则直接返回error，&quot;-ERR bad lua script for redis cluster, all the keys that the script uses should be passed using the KEYS array&quot;</li>
<li>2.所有key，必须在1个slot上，否则直接返回error, &ldquo;-ERR eval/evalsha command keys must in same slot&rdquo;</li>
</ul>
<p>【建议】必要情况下使用monitor命令时，要注意不要长时间使用。</p>
<h2 id="客户端使用">客户端使用<a hidden class="anchor" aria-hidden="true" href="#客户端使用">#</a></h2>
<p>【推荐】
避免多个应用使用一个Redis实例
正例：不相干的业务拆分，公共数据做服务化。</p>
<p>【推荐】
使用带有连接池的数据库，可以有效控制连接，同时提高效率，标准使用方式：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>执行命令如下<span style="color:#f00">：</span>
</span></span><span style="display:flex;"><span>Jedis jedis = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>    jedis = jedisPool.<span style="color:#007f7f">getResource</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//具体的命令</span>
</span></span><span style="display:flex;"><span>    jedis.<span style="color:#007f7f">executeCommand</span>()
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>    logger.<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;op key {} error: &#34;</span> + e.<span style="color:#007f7f">getMessage</span>(), key, e);
</span></span><span style="display:flex;"><span>} <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//注意这里不是关闭连接，在JedisPool模式下，Jedis会被归还给资源池。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (jedis != <span style="color:#fff;font-weight:bold">null</span>) 
</span></span><span style="display:flex;"><span>        jedis.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>【建议】
高并发下建议客户端添加熔断功能(例如netflix hystrix)</p>
<p>【推荐】
设置合理的密码，如有必要可以使用SSL加密访问（阿里云Redis支持）</p>
<p>【建议】</p>
<p>根据自身业务类型，选好maxmemory-policy(最大内存淘汰策略)，设置好过期时间。</p>
<p>默认策略是volatile-lru，即超过最大内存后，在过期键中使用lru算法进行key的剔除，保证不过期数据不被删除，但是可能会出现OOM问题。</p>
<p>其他策略如下：</p>
<ul>
<li>allkeys-lru：根据LRU算法删除键，不管数据有没有设置超时属性，直到腾出足够空间为止。</li>
<li>allkeys-random：随机删除所有键，直到腾出足够空间为止。</li>
<li>volatile-random:随机删除过期键，直到腾出足够空间为止。</li>
<li>volatile-ttl：根据键值对象的ttl属性，删除最近将要过期数据。如果没有，回退到noeviction策略。</li>
<li>noeviction：不会剔除任何数据，拒绝所有写入操作并返回客户端错误信息&quot;(error) OOM command not allowed when used memory&quot;，此时Redis只响应读操作。</li>
</ul>
<h1 id="redis-持久化策略浅析">Redis 持久化策略浅析<a hidden class="anchor" aria-hidden="true" href="#redis-持久化策略浅析">#</a></h1>
<p>Redis 是内存数据库，数据都是存储在内存中，为了避免进程退出导致数据的永久丢失，需要定期将 Redis 中的数据以某种形式（数据或命令）从内存保存到硬盘。当下次 Redis 重启时，利用持久化文件实现数据恢复。除此之外，为了进行灾难备份，可以将持久化文件拷贝到一个远程位置。Redis 的持久化机制有两种：</p>
<ul>
<li>
<p>RDB（Redis Data Base）内存快照</p>
</li>
<li>
<p>AOF（Append Only File）增量日志</p>
</li>
</ul>
<p>RDB 将当前数据保存到硬盘，AOF 则是将每次执行的写命令保存到硬盘（类似于 MySQL 的 Binlog）。AOF 持久化的实时性更好，即当进程意外退出时丢失的数据更少。</p>
<h2 id="rdb持久化">RDB持久化<a hidden class="anchor" aria-hidden="true" href="#rdb持久化">#</a></h2>
<p>RDB（Redis Data Base）指的是在指定的时间间隔内将内存中的数据集快照写入磁盘，RDB 是内存快照（内存数据的二进制序列化形式）的方式持久化，每次都是从 Redis 中生成一个快照进行数据的全量备份。</p>
<p>优点：</p>
<ul>
<li>
<p>存储紧凑，节省内存空间。</p>
</li>
<li>
<p>恢复速度非常快。</p>
</li>
<li>
<p>适合全量备份、全量复制的场景，经常用于灾难恢复（对数据的完整性和一致性要求相对较低的场合）。</p>
</li>
</ul>
<p>缺点：</p>
<ul>
<li>容易丢失数据，容易丢失两次快照之间 Redis 服务器中变化的数据。</li>
<li>RDB 通过 fork 子进程对内存快照进行全量备份，是一个重量级操作，频繁执行成本高。</li>
</ul>
<h3 id="rdb-文件结构">RDB 文件结构<a hidden class="anchor" aria-hidden="true" href="#rdb-文件结构">#</a></h3>
<p>在默认情况下，Redis 将数据库快照保存在名字为 dump.rdb 的二进制文件中。RDB 文件结构由五个部分组成：</p>
<ul>
<li>长度为5字节的 <code>REDIS</code> 常量字符串。</li>
<li>4字节的 db_version，标识 RDB 文件版本。</li>
<li>databases：不定长度，包含零个或多个数据库，以及各数据库中的键值对数据。</li>
<li>1字节的 EOF 常量，表示文件正文内容结束。</li>
<li>check_sum：8字节长的无符号整数，保存校验和。</li>
</ul>
<h3 id="rdb-文件的创建手动指令触发">RDB 文件的创建（手动指令触发）<a hidden class="anchor" aria-hidden="true" href="#rdb-文件的创建手动指令触发">#</a></h3>
<p>手动触发 RDB 持久化的方式可以使用 <code>save</code> 命令和 <code>bgsave</code> 命令，这两个命令的区别如下：</p>
<p><code>save</code>：执行<code>save</code>指令，阻塞 Redis 的其他操作，会导致 Redis 无法响应客户端请求，不建议使用。</p>
<p><code>bgsave</code>：执行 <code>bgsave</code> 指令，Redis 后台创建子进程，异步进行快照的保存操作，此时 Redis 仍然能响应客户端的请求。</p>
<h3 id="rdb-文件的创建自动间隔性保存">RDB 文件的创建（自动间隔性保存）<a hidden class="anchor" aria-hidden="true" href="#rdb-文件的创建自动间隔性保存">#</a></h3>
<p>在默认情况下，Redis 将数据库快照保存在名字为 dump.rdb的二进制文件中。可以对 Redis 进行设置，让它在“ N 秒内数据集至少有 M 个改动”这一条件被满足时，自动保存一次数据集。</p>
<p>比如说， 以下设置会让 Redis 在满足“ 60 秒内有至少有 10 个键被改动”这一条件时，自动保存一次数据集:<code>save 60 10</code>。</p>
<p>Redis 的默认配置如下，三个设置满足其一即可触发自动保存：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>save <span style="color:#ff0;font-weight:bold">60</span> <span style="color:#ff0;font-weight:bold">10000</span>
</span></span><span style="display:flex;"><span>save <span style="color:#ff0;font-weight:bold">300</span> <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>save <span style="color:#ff0;font-weight:bold">900</span> <span style="color:#ff0;font-weight:bold">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="自动保存配置的数据结构">自动保存配置的数据结构<a hidden class="anchor" aria-hidden="true" href="#自动保存配置的数据结构">#</a></h3>
<p>记录了服务器触发自动 <code>BGSAVE</code> 条件的<code>saveparams</code>属性。</p>
<p><code>lastsave</code> 属性：记录服务器最后一次执行 <code>SAVE</code> 或者 <code>BGSAVE</code> 的时间。</p>
<p><code>dirty</code> 属性：以及自最后一次保存 RDB 文件以来，服务器进行了多少次写入。</p>
<h3 id="备份过程">备份过程<a hidden class="anchor" aria-hidden="true" href="#备份过程">#</a></h3>
<p>RDB 持久化方案进行备份时，Redis 会单独 fork 一个子进程来进行持久化，会将数据写入一个临时文件中，持久化完成后替换旧的 RDB 文件。在整个持久化过程中，主进程（为客户端提供服务的进程）不参与 IO 操作，这样能确保 Redis 服务的高性能，RDB 持久化机制适合对数据完整性要求不高但追求高效恢复的使用场景。下面展示 RDB 持久化流程：</p>
<p><img loading="lazy" src="/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/1.png"></p>
<p>关键执行步骤如下</p>
<ol>
<li>
<p>Redis 父进程首先判断：当前是否在执行 save，或 bgsave/bgrewriteaof 的子进程，如果在执行则 bgsave 命令直接返回。bgsave/bgrewriteaof 的子进程不能同时执行，主要是基于性能方面的考虑：两个并发的子进程同时执行大量的磁盘写操作，可能引起严重的性能问题。</p>
</li>
<li>
<p>父进程执行 fork 操作创建子进程，这个过程中父进程是阻塞的，Redis 不能执行来自客户端的任何命令。父进程 fork 后，bgsave 命令返回”Background saving started”信息并不再阻塞父进程，并可以响应其他命令。</p>
</li>
<li>
<p>子进程进程对内存数据生成快照文件。</p>
</li>
<li>
<p>父进程在此期间接收的新的写操作，使用 COW 机制写入。</p>
</li>
<li>
<p>子进程完成快照写入，替换旧 RDB 文件，随后子进程退出。</p>
</li>
</ol>
<blockquote>
<p>在生成 RDB 文件的步骤中，在同步到磁盘和持续写入这个过程是如何处理数据不一致的情况呢？生成快照 RDB 文件时是否会对业务产生影响？</p>
</blockquote>
<h3 id="fork-子进程的作用">Fork 子进程的作用<a hidden class="anchor" aria-hidden="true" href="#fork-子进程的作用">#</a></h3>
<p>上面说到了 RDB 持久化过程中，主进程会 fork 一个子进程来负责 RDB 的备份，这里简单介绍一下 fork：</p>
<ul>
<li>
<p>Linux 操作系统中的程序，fork 会产生一个和父进程完全相同的子进程。子进程与父进程所有的数据均一致，但是子进程是一个全新的进程，与原进程是父子进程关系。</p>
</li>
<li>
<p>出于效率考虑，Linux 操作系统中使用 COW(Copy On Write)写时复制机制，fork 子进程一般情况下与父进程共同使用一段物理内存，只有在进程空间中的内存发生修改时，内存空间才会复制一份出来。</p>
</li>
</ul>
<p>在 Redis 中，RDB 持久化就是充分的利用了这项技术，Redis 在持久化时调用 glibc 函数 fork 一个子进程，全权负责持久化工作，这样父进程仍然能继续给客户端提供服务。fork 的子进程初始时与父进程（Redis 的主进程）共享同一块内存；当持久化过程中，客户端的请求对内存中的数据进行修改，此时就会通过 COW (Copy On Write) 机制对数据段页面进行分离，也就是复制一块内存出来给主进程去修改。</p>
<p><img loading="lazy" src="/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/2.png"></p>
<p>通过 fork 创建的子进程能够获得和父进程完全相同的内存空间，父进程对内存的修改对于子进程是不可见的，两者不会相互影响；</p>
<p>通过 fork 创建子进程时不会立刻触发大量内存的拷贝，采用的是写时拷贝 COW (Copy On Write)。内核只为新生成的子进程创建虚拟空间结构，它们来复制于父进程的虚拟究竟结构，但是不为这些段分配物理内存，它们共享父进程的物理空间，当父子进程中有更改相应段的行为发生时，再为子进程相应的段分配物理空间；</p>
<h2 id="aof-持久化">AOF 持久化<a hidden class="anchor" aria-hidden="true" href="#aof-持久化">#</a></h2>
<p><strong>AOF</strong> <strong>(Append Only File)</strong> 是把所有对内存进行修改的指令（写操作）以独立日志文件的方式进行记录，重启时通过执行 AOF 文件中的 Redis 命令来恢复数据。类似MySql bin-log 原理。AOF 能够解决数据持久化实时性问题，是现在 Redis 持久化机制中主流的持久化方案。</p>
<p>优点：</p>
<ul>
<li>
<p>数据的备份更加完整，丢失数据的概率更低，适合对数据完整性要求高的场景</p>
</li>
<li>
<p>日志文件可读，AOF 可操作性更强，可通过操作日志文件进行修复</p>
</li>
</ul>
<p>缺点：</p>
<ul>
<li>
<p>AOF 日志记录在长期运行中逐渐庞大，恢复起来非常耗时，需要定期对 AOF 日志进行瘦身处理</p>
</li>
<li>
<p>恢复备份速度比较慢</p>
</li>
<li>
<p>同步写操作频繁会带来性能压力</p>
</li>
</ul>
<h3 id="aof-文件内容">AOF 文件内容<a hidden class="anchor" aria-hidden="true" href="#aof-文件内容">#</a></h3>
<p>被写入 AOF 文件的所有命令都是以 RESP 格式保存的，是纯文本格式保存在 AOF 文件中。</p>
<blockquote>
<p>Redis 客户端和服务端之间使用一种名为 <code>RESP(REdis Serialization Protocol)</code> 的二进制安全文本协议进行通信。</p>
</blockquote>
<p>下面以一个简单的 SET 命令进行举例：</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>redis&gt; SET mykey <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>    //客户端命令
</span></span><span style="display:flex;"><span>OK
</span></span></code></pre></td></tr></table>
</div>
</div><p>客户端封装为以下格式（每行用<code> \r\n</code>分隔）</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>*3
</span></span><span style="display:flex;"><span>$3
</span></span><span style="display:flex;"><span>SET
</span></span><span style="display:flex;"><span>$5
</span></span><span style="display:flex;"><span>mykey
</span></span><span style="display:flex;"><span>$5
</span></span><span style="display:flex;"><span>hello
</span></span></code></pre></td></tr></table>
</div>
</div><p>AOF 文件中记录的文本内容如下</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>*2<span style="color:#0ff;font-weight:bold">\r\n</span>$6<span style="color:#0ff;font-weight:bold">\r\n</span>SELECT<span style="color:#0ff;font-weight:bold">\r\n</span>$1<span style="color:#0ff;font-weight:bold">\r\n</span>0<span style="color:#0ff;font-weight:bold">\r\n</span>       //多出一个SELECT <span style="color:#ff0;font-weight:bold">0</span> 命令，用于指定数据库，为系统自动添加
</span></span><span style="display:flex;"><span>*3<span style="color:#0ff;font-weight:bold">\r\n</span>$3<span style="color:#0ff;font-weight:bold">\r\n</span>SET<span style="color:#0ff;font-weight:bold">\r\n</span>$5<span style="color:#0ff;font-weight:bold">\r\n</span>mykey<span style="color:#0ff;font-weight:bold">\r\n</span>$5<span style="color:#0ff;font-weight:bold">\r\n</span>hello<span style="color:#0ff;font-weight:bold">\r\n</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="aof-持久化实现">AOF 持久化实现<a hidden class="anchor" aria-hidden="true" href="#aof-持久化实现">#</a></h3>
<p>AOF 持久化方案进行备份时，客户端所有请求的写命令都会被追加到 AOF 缓冲区中，缓冲区中的数据会根据 Redis 配置文件中配置的同步策略来同步到磁盘上的 AOF 文件中，追加保存每次写的操作到文件末尾。同时当 AOF 的文件达到重写策略配置的阈值时，Redis 会对 AOF 日志文件进行重写，给 AOF 日志文件瘦身。Redis 服务重启的时候，通过加载 AOF 日志文件来恢复数据。</p>
<p><img loading="lazy" src="/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/3.png"></p>
<p>AOF 的执行流程包括：</p>
<p><strong>命令追加(append)</strong></p>
<p>Redis 先将写命令追加到缓冲区 aof_buf，而不是直接写入文件，主要是为了避免每次有写命令都直接写入硬盘，导致硬盘 IO 成为 Redis 负载的瓶颈。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>struct redisServer {
</span></span><span style="display:flex;"><span>   //其他域...
</span></span><span style="display:flex;"><span>   sds  aof_buf;           // sds类似于Java中的String
</span></span><span style="display:flex;"><span>   //其他域...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>文件写入(write)和文件同步(sync)</strong></p>
<p>根据不同的同步策略将 aof_buf 中的内容同步到硬盘；</p>
<p>Linux 操作系统中为了提升性能，使用了页缓存（page cache）。当我们将 aof_buf 的内容写到磁盘上时，此时数据并没有真正的落盘，而是在 page cache 中，为了将 page cache 中的数据真正落盘，需要执行 fsync / fdatasync 命令来强制刷盘。这边的文件同步做的就是刷盘操作，或者叫文件刷盘可能更容易理解一些。</p>
<p>AOF 缓存区的同步文件策略由参数 appendfsync 控制，有三种同步策略，各个值的含义如下：</p>
<ul>
<li>
<p><code>always</code>：命令写入 aof_buf 后立即调用系统 write 操作和系统 fsync 操作同步到 AOF 文件，fsync 完成后线程返回。这种情况下，每次有写命令都要同步到 AOF 文件，硬盘 IO 成为性能瓶颈，Redis 只能支持大约几百TPS写入，严重降低了 Redis 的性能；即便是使用固态硬盘（SSD），每秒大约也只能处理几万个命令，而且会大大降低 SSD 的寿命。可靠性较高，数据基本不丢失。</p>
</li>
<li>
<p><code>no</code>：命令写入 aof_buf 后调用系统 write 操作，不对 AOF 文件做 fsync 同步；同步由操作系统负责，通常同步周期为30秒。这种情况下，文件同步的时间不可控，且缓冲区中堆积的数据会很多，数据安全性无法保证。</p>
</li>
<li>
<p><code>everysec</code>：命令写入 aof_buf 后调用系统 write 操作，write 完成后线程返回；fsync 同步文件操作由专门的线程每秒调用一次。everysec 是前述两种策略的折中，是性能和数据安全性的平衡，因此是 Redis 的默认配置，也是我们推荐的配置。</p>
</li>
</ul>
<p><strong>文件重写(rewrite)</strong></p>
<p>定期重写 AOF 文件，达到压缩的目的。</p>
<p>AOF 重写是 AOF 持久化的一个机制，用来压缩 AOF 文件，通过 fork 一个子进程，重新写一个新的 AOF 文件，该次重写不是读取旧的 AOF 文件进行复制，而是读取内存中的Redis数据库，重写一份 AOF 文件，有点类似于 RDB 的快照方式。</p>
<p>文件重写之所以能够压缩 AOF 文件，原因在于：</p>
<ul>
<li>
<p>过期的数据不再写入文件</p>
</li>
<li>
<p>无效的命令不再写入文件：如有些数据被重复设值(set mykey v1, set mykey v2)、有些数据被删除了(sadd myset v1, del myset)等等</p>
</li>
<li>
<p>多条命令可以合并为一个：如 sadd myset v1, sadd myset v2, sadd myset v3 可以合并为 sadd myset v1 v2 v3。不过为了防止单条命令过大造成客户端缓冲区溢出，对于 list、set、hash、zset类型的 key，并不一定只使用一条命令；而是以某个常量为界将命令拆分为多条。这个常量在 redis.h/REDIS_AOF_REWRITE_ITEMS_PER_CMD 中定义，不可更改，2.9版本中值是64。</p>
</li>
</ul>
<h3 id="aof-重写"><strong>AOF</strong> 重写<a hidden class="anchor" aria-hidden="true" href="#aof-重写">#</a></h3>
<p>前面提到 AOF 的缺点时，说过 AOF 属于日志追加的形式来存储 Redis 的写指令，这会导致大量冗余的指令存储，从而使得 AOF 日志文件非常庞大，比如同一个 key 被写了 10000 次，最后却被删除了，这种情况不仅占内存，也会导致恢复的时候非常缓慢，因此 Redis 提供重写机制来解决这个问题。Redis 的 AOF 持久化机制执行重写后，保存的只是恢复数据的最小指令集，我们如果想手动触发可以使用如下指令：</p>
<p><code>bgrewriteaof</code></p>
<p><strong>文件重写时机</strong></p>
<p>相关参数：</p>
<ul>
<li>
<p>aof_current_size：表示当前 AOF 文件空间</p>
</li>
<li>
<p>aof_base_size：表示上一次重写后 AOF 文件空间</p>
</li>
<li>
<p>auto-aof-rewrite-min-size: 表示运行 AOF 重写时文件的最小体积，默认为64MB</p>
</li>
<li>
<p>auto-aof-rewrite-percentage：表示当前 AOF 重写时文件空间（aof_current_size）超过上一次重写后 AOF 文件空间（aof_base_size）的比值多少后会重写。</p>
</li>
</ul>
<p>同时满足下面两个条件，则触发 AOF 重写机制：</p>
<ul>
<li>
<p>aof_current_size 大于 auto-aof-rewrite-min-size</p>
</li>
<li>
<p>当前 AOF 相比上一次 AOF 的增长率：(aof_current_size - aof_base_size)/aof_base_size 大于或等于 auto-aof-rewrite-percentage</p>
</li>
</ul>
<p><strong>AOF</strong> <strong>重写流程如下：</strong></p>
<ol>
<li>
<p>bgrewriteaof 触发重写，判断是否存在 bgsave 或者 bgrewriteaof 正在执行，存在则等待其执行结束再执行</p>
</li>
<li>
<p>主进程 fork 子进程，防止主进程阻塞无法提供服务，类似 RDB</p>
</li>
<li>
<p>子进程遍历 Redis 内存快照中数据写入临时 AOF 文件，同时会将新的写指令写入 aof_buf 和 aof_rewrite_buf 两个重写缓冲区，前者是为了写回旧的 AOF 文件，后者是为了后续刷新到临时 AOF 文件中，防止快照内存遍历时新的写入操作丢失</p>
</li>
<li>
<p>子进程结束临时 AOF 文件写入后，通知主进程</p>
</li>
<li>
<p>主进程会将上面 3 中的 aof_rewirte_buf 缓冲区中的数据写入到子进程生成的临时 AOF 文件中</p>
</li>
<li>
<p>主进程使用临时 AOF 文件替换旧 AOF 文件，完成整个重写过程。</p>
</li>
</ol>
<p><img loading="lazy" src="/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/4.png"></p>
<p>在实际中，为了避免在执行命令时造成客户端输入缓冲区溢出，重写程序会检查集合元素数量是否超过 REDIS_AOF_REWRITE_ITEMS_PER_CMD 常量的值，如果超过了，则会使用多个命令来记录，而不单单使用一条命令。</p>
<p>Redis 2.9版本中该常量为64，如果一个命令的集合键包含超过了64个元素，重写程序会拆成多个命令。</p>
<p><code>SADD &lt;key&gt; &lt;elem1&gt; &lt;elem2&gt;...&lt;elem64&gt;</code></p>
<p><code>SADD &lt;key&gt; &lt;elem65&gt; &lt;elem66&gt;...&lt;elem128&gt;</code></p>
<blockquote>
<p>AOF重写是一个有歧义的名字，该功能是通过直接读取数据库的键值对实现的，程序无需对现有AOF文件进行任何读入、分析或者写入操作。</p>
</blockquote>
<h2 id="aof-与-wal">AOF 与 WAL<a hidden class="anchor" aria-hidden="true" href="#aof-与-wal">#</a></h2>
<p>Redis 为什么考虑使用 AOF 而不是 WAL 呢?</p>
<p>很多数据库都是采用的 Write Ahead Log（WAL）写前日志，其特点就是先把修改的数据记录到日志中，再进行写数据的提交，可以方便通过日志进行数据恢复。</p>
<p>但是 Redis 采用的却是 AOF（Append Only File）写后日志，特点就是先执行写命令，把数据写入内存中，再记录日志。</p>
<p>如果先让系统执行命令，只有命令能执行成功，才会被记录到日志中。因此，Redis 使用写后日志这种形式，可以避免出现记录错误命令的情况。</p>
<p>另外还有一个原因就是：AOF 是在命令执行后才记录日志，所以不会阻塞当前的写操作。</p>
<h2 id="aof-和-rdb-之间的相互作用">AOF 和 RDB 之间的相互作用<a hidden class="anchor" aria-hidden="true" href="#aof-和-rdb-之间的相互作用">#</a></h2>
<p>在版本号大于等于2.4的 Redis 中，BGSAVE 执行的过程中，不可以执行 BGREWRITEAOF。反过来说，在 BGREWRITEAOF 执行的过程中，也不可以执行 BGSAVE。这可以防止两个 Redis 后台进程同时对磁盘进行大量的 I/O 操作。</p>
<p>如果 BGSAVE 正在执行，并且用户显示地调用 BGREWRITEAOF 命令，那么服务器将向用户回复一个 OK 状态，并告知用户，BGREWRITEAOF 已经被预定执行：一旦 BGSAVE 执行完毕 BGREWRITEAOF 就会正式开始。</p>
<p>当 Redis 启动时，如果 RDB 持久化和 AOF 持久化都被打开了，那么程序会优先使用 AOF 文件来恢复数据集，因为 AOF 文件所保存的数据通常是最完整的。</p>
<h2 id="混合持久化">混合持久化<a hidden class="anchor" aria-hidden="true" href="#混合持久化">#</a></h2>
<p>Redis4.0 后大部分的使用场景都不会单独使用 RDB 或者 AOF 来做持久化机制，而是兼顾二者的优势混合使用。其原因是 RDB 虽然快，但是会丢失比较多的数据，不能保证数据完整性；AOF 虽然能尽可能保证数据完整性，但是性能确实是一个诟病，比如重放恢复数据。</p>
<p>Redis从4.0版本开始引入 RDB-AOF 混合持久化模式，这种模式是基于 AOF 持久化模式构建而来的，混合持久化通过 <code>aof-use-rdb-preamble yes</code> 开启。</p>
<p>那么 Redis 服务器在执行 AOF 重写操作时，就会像执行 BGSAVE 命令那样，根据数据库当前的状态生成出相应的 RDB 数据，并将这些数据写入新建的 AOF 文件中，至于那些在 AOF 重写开始之后执行的 Redis 命令，则会继续以协议文本的方式追加到新 AOF 文件的末尾，即已有的 RDB 数据的后面。</p>
<p>换句话说，在开启了 RDB-AOF 混合持久化功能之后，服务器生成的 AOF 文件将由两个部分组成，其中位于 AOF 文件开头的是 RDB 格式的数据，而跟在 RDB 数据后面的则是 AOF 格式的数据。</p>
<p>当一个支持 RDB-AOF 混合持久化模式的 Redis 服务器启动并载入 AOF 文件时，它会检查 AOF 文件的开头是否包含了 RDB 格式的内容。</p>
<ul>
<li>如果包含，那么服务器就会先载入开头的 RDB 数据，然后再载入之后的 AOF 数据。</li>
<li>如果 AOF 文件只包含 AOF 数据，那么服务器将直接载入 AOF 数据。</li>
</ul>
<p>其日志文件结构如下：</p>
<p><img loading="lazy" src="/en/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/5.png"></p>
<h2 id="总结">总结<a hidden class="anchor" aria-hidden="true" href="#总结">#</a></h2>
<p>最后来总结这两者，到底用哪个更好呢？</p>
<ul>
<li>
<p>推荐是两者均开启。</p>
</li>
<li>
<p>如果对数据不敏感，可以选单独用 RDB。</p>
</li>
<li>
<p>如果只是做纯内存缓存，可以都不用。</p>
</li>
</ul>
<h1 id="redis大key处理">redis大key处理<a hidden class="anchor" aria-hidden="true" href="#redis大key处理">#</a></h1>
<h2 id="背景">背景<a hidden class="anchor" aria-hidden="true" href="#背景">#</a></h2>
<p>想要解决大key，首先我们得知道什么定义为大key。大key 并不是指 key 的值很大，而是 key 对应的 value 很大（非常占内存）。此处为中间件给出的定义：</p>
<ul>
<li>单个String类型的Key大小达到20KB并且OPS高</li>
<li>单个String达到100KB</li>
<li>集合类型的Key总大小达到1MB</li>
<li>集合类型的Key中元素超过5000个</li>
</ul>
<p><strong>大KEY带来的影响</strong></p>
<p>知道了大key的定义，那么我们也得知道大key的带来的影响：</p>
<ul>
<li>**客户端超时阻塞。**Redis 执行命令是单线程处理，然后在大 key处理时会比较耗时，那么就会发生阻塞 ，期间就会各种业务超时出现。</li>
<li><strong>引发网络阻塞</strong>。每次获取大 key 产生的网络流量较大，如果一个 key 的大小是 1 MB，每秒访问量为 1000，那么每秒会产生 1000MB 的流量，这对于服务器来说是灾难性的。</li>
<li>**阻塞工作线程。**如果使用 del 删除大 key 时，会阻塞工作线程，无法处理后续的命令。</li>
<li><strong>内存分布不均</strong>。集群各分片内存使用不均。某个分片占用内存较高或OOM，发送缓存区增大等，导致该分片其他Key被逐出，同时也会造成其他分片的资源浪费。</li>
</ul>
<h2 id="大key解决手段">大key解决手段<a hidden class="anchor" aria-hidden="true" href="#大key解决手段">#</a></h2>
<h3 id="历史key未使用">历史key未使用<a hidden class="anchor" aria-hidden="true" href="#历史key未使用">#</a></h3>
<p>针对这种key场景，其实存在着历史原因，可能是伴随着某个业务下线或者不使用，往往对应实现的缓存操作代码会删除，但是对于缓存数据往往不会做任何处理，久而久之，这种脏数据会一直堆积，占用着资源。那么如果确定已经无使用，并且可以确认有持久化数据（如mysql、es等）备份的话，可以直接将对应key删除。</p>
<h3 id="元素数过多">元素数过多<a hidden class="anchor" aria-hidden="true" href="#元素数过多">#</a></h3>
<p>针对于Set、HASH这种场景，如果元素数量超过5000就视为大的key。如果对应value值不大，我们可以采取平铺的形式，</p>
<p>比如系统内历史的设计是存储下每个品牌对应的名称，那么就设置了统一的key，然后不同的品牌id作为fild，操作了hSet和hGet来存储获取数据，降低查询外围服务的频率。但是随着品牌数量的增长，导致元素逐步增多，元素个数就超过了大key的预设值了。这种根据场景，我们其实存储本身只有一个品牌名称，那么我们就针对于品牌id对应加上一个统一前缀作为唯一key，采用平铺方式缓存对应数据即可。那么针对这种数据的替换，我这里也总结了下具体要实现的步骤：</p>
<p>第一步：修改代码查询和赋值逻辑：</p>
<ul>
<li>
<p>把原始的hGet的逻辑修改为get获取；</p>
</li>
<li>
<p>把原始hSet的逻辑修改为set赋值。</p>
</li>
</ul>
<p>第一步：历史数据刷新到新缓存key：</p>
<p>为了避免上线之后出现缓存雪崩，因为替换了新的key，我们需要通过现有的HASH的数据刷新到新的缓存中，所以需要历史数据处理。</p>
<p>通过hGetAll获取所以元素数据，循环缓存元素数据操作存储新的缓存key和value。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> String refreshHistoryData(){
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        String key = <span style="color:#0ff;font-weight:bold">&#34;historyKey&#34;</span>;
</span></span><span style="display:flex;"><span>        Map&lt;String, String&gt; redisInfoMap= redisUtils.<span style="color:#007f7f">hGetAll</span>(key);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (redisInfoMap.<span style="color:#007f7f">isEmpty</span>()){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;查询缓存无数据&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (Map.<span style="color:#007f7f">Entry</span>&lt;String, String&gt; entry : redisInfoMap.<span style="color:#007f7f">entrySet</span>()) {
</span></span><span style="display:flex;"><span>            String redisVal = entry.<span style="color:#007f7f">getValue</span>();
</span></span><span style="display:flex;"><span>            String filedKey = entry.<span style="color:#007f7f">getKey</span>();
</span></span><span style="display:flex;"><span>            String newDataRedisKey = <span style="color:#0ff;font-weight:bold">&#34;newDataKey&#34;</span>+filedKey;
</span></span><span style="display:flex;"><span>            redisUtils.<span style="color:#007f7f">set</span>(newDataRedisKey,redisVal);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;success&#34;</span>;
</span></span><span style="display:flex;"><span>    }<span style="color:#fff;font-weight:bold">catch</span> (Exception e){
</span></span><span style="display:flex;"><span>        LOG.<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;refreshHistoryData 异常:&#34;</span>,e);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;failed&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：这里一定要先刷历史数据，再上线代码业务逻辑的修改。防止引发缓存雪崩。</p>
<h3 id="大对象转换存储形式">大对象转换存储形式<a hidden class="anchor" aria-hidden="true" href="#大对象转换存储形式">#</a></h3>
<p>复杂的大对象可以尝试将对象分拆成几个key-value， 使用mGet和mSet操作对应值或者pipeline的形式，最后拼装成需要返回的大对象。这样意义在于可以分散单次操作的压力，将操作压力平摊到多个redis实例中，降低对单个redis的IO影响。</p>
<p>这里以系统内订单对象为例：订单对象Order基础属性有几十个，如订单号、金额、时间、类型等，除此之外还要包含订单下的商品OrderSub、预售信息PresaleOrder、发票信息OrderInvoice、订单时效OrderPremiseInfo、订单轨迹OrderTrackInfo、订单详细费用OrderFee等信息。</p>
<p>那么对于每个订单相关信息，我们可以设置为单独的key，把订单信息和几个相关的关联数据每个按照单独key存储，接着通过mGet方式获取每个信息之后，最后封装成整体Order对象。下面仅展示关键伪代码以mSet和mGet实现。</p>
<p><strong>缓存定义：</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">enum</span> CacheKeyConstant {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 订单基础缓存key
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    REDIS_ORDER_BASE_INFO(<span style="color:#0ff;font-weight:bold">&#34;ORDER_BASE_INFO&#34;</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 订单商品缓存key
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    ORDER_SUB_INFO(<span style="color:#0ff;font-weight:bold">&#34;ORDER_SUB_INFO&#34;</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 订单预售信息缓存key
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    ORDER_PRESALE_INFO(<span style="color:#0ff;font-weight:bold">&#34;ORDER_PRESALE_INFO&#34;</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 订单履约信息缓存key
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    ORDER_PREMISE_INFO(<span style="color:#0ff;font-weight:bold">&#34;ORDER_PREMISE_INFO&#34;</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 订单发票信息缓存key
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    ORDER_INVOICE_INFO(<span style="color:#0ff;font-weight:bold">&#34;ORDER_INVOICE_INFO&#34;</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 订单轨迹信息缓存key
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    ORDER_TRACK_INFO(<span style="color:#0ff;font-weight:bold">&#34;ORDER_TRACK_INFO&#34;</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 订单详细费用信息缓存key
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    ORDER_FEE_INFO(<span style="color:#0ff;font-weight:bold">&#34;ORDER_FEE_INFO&#34;</span>),
</span></span><span style="display:flex;"><span>    ;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 前缀
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String prefix;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 项目统一前缀
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String COMMON_PREFIX = <span style="color:#0ff;font-weight:bold">&#34;XXX&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    CacheKeyConstant(String prefix){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">prefix</span> = prefix;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getPrefix(String subKey) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(StringUtil.<span style="color:#007f7f">isNotEmpty</span>(subKey)){
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> COMMON_PREFIX + prefix + <span style="color:#0ff;font-weight:bold">&#34;_&#34;</span> + subKey;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> COMMON_PREFIX + prefix;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String getPrefix() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> COMMON_PREFIX + prefix;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>缓存存储：</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @description 刷新订单到缓存
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param order 订单信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">boolean</span> refreshOrderToCache(Order order){
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(order == <span style="color:#fff;font-weight:bold">null</span> || order.<span style="color:#007f7f">getOrderId</span>() == <span style="color:#fff;font-weight:bold">null</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> ;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String orderId = order.<span style="color:#007f7f">getOrderId</span>().<span style="color:#007f7f">toString</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//设置存储缓存数据</span>
</span></span><span style="display:flex;"><span>    Map&lt;String,String&gt; cacheOrderMap = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;(16);
</span></span><span style="display:flex;"><span>    cacheOrderMap.<span style="color:#007f7f">put</span>(CacheKeyConstant.<span style="color:#007f7f">ORDER_BASE_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId), JSON.<span style="color:#007f7f">toJSONString</span>(buildBaseOrderVo(order)));
</span></span><span style="display:flex;"><span>    cacheOrderMap.<span style="color:#007f7f">put</span>(CacheKeyConstant.<span style="color:#007f7f">ORDER_SUB_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId), JSON.<span style="color:#007f7f">toJSONString</span>(order.<span style="color:#007f7f">getCustomerOrderSubs</span>()));
</span></span><span style="display:flex;"><span>    cacheOrderMap.<span style="color:#007f7f">put</span>(CacheKeyConstant.<span style="color:#007f7f">ORDER_PRESALE_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId), JSON.<span style="color:#007f7f">toJSONString</span>(order.<span style="color:#007f7f">getPresaleOrderData</span>()));
</span></span><span style="display:flex;"><span>    cacheOrderMap.<span style="color:#007f7f">put</span>(CacheKeyConstant.<span style="color:#007f7f">ORDER_INVOICE_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId), JSON.<span style="color:#007f7f">toJSONString</span>(order.<span style="color:#007f7f">getOrderInvoice</span>()));
</span></span><span style="display:flex;"><span>    cacheOrderMap.<span style="color:#007f7f">put</span>(CacheKeyConstant.<span style="color:#007f7f">ORDER_TRACK_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId), JSON.<span style="color:#007f7f">toJSONString</span>(order.<span style="color:#007f7f">getOrderTrackInfo</span>()));
</span></span><span style="display:flex;"><span>    cacheOrderMap.<span style="color:#007f7f">put</span>(CacheKeyConstant.<span style="color:#007f7f">ORDER_PREMISE_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId), JSON.<span style="color:#007f7f">toJSONString</span>( order.<span style="color:#007f7f">getPresaleOrderData</span>()));
</span></span><span style="display:flex;"><span>    cacheOrderMap.<span style="color:#007f7f">put</span>(CacheKeyConstant.<span style="color:#007f7f">ORDER_FEE_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId), JSON.<span style="color:#007f7f">toJSONString</span>(order.<span style="color:#007f7f">getOrderFeeVo</span>()));
</span></span><span style="display:flex;"><span>    superRedisUtils.<span style="color:#007f7f">mSetString</span>(cacheOrderMap);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>缓存获取：</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @description 通过订单号获取缓存数据
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param orderId 订单号
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @return Order 订单实体信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> Order getOrderFromCache(String orderId){
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(StringUtils.<span style="color:#007f7f">isBlank</span>(orderId)){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//定义查询缓存集合key</span>
</span></span><span style="display:flex;"><span>    List&lt;String&gt; queryOrderKey = Arrays.<span style="color:#007f7f">asList</span>(CacheKeyConstant.<span style="color:#007f7f">ORDER_BASE_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId),CacheKeyConstant.<span style="color:#007f7f">ORDER_SUB_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId),
</span></span><span style="display:flex;"><span>                                               CacheKeyConstant.<span style="color:#007f7f">ORDER_PRESALE_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId),CacheKeyConstant.<span style="color:#007f7f">ORDER_INVOICE_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId),CacheKeyConstant.<span style="color:#007f7f">ORDER_TRACK_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId),
</span></span><span style="display:flex;"><span>                                               CacheKeyConstant.<span style="color:#007f7f">ORDER_PREMISE_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId),CacheKeyConstant.<span style="color:#007f7f">ORDER_FEE_INFO</span>.<span style="color:#007f7f">getPrefix</span>(orderId));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//查询结果</span>
</span></span><span style="display:flex;"><span>    List&lt;String&gt; result = redisUtils.<span style="color:#007f7f">mGet</span>(queryOrderKey);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//基础信息</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(CollectionUtils.<span style="color:#007f7f">isEmpty</span>(result)){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String[] resultInfo = result.<span style="color:#007f7f">toArray</span>(<span style="color:#fff;font-weight:bold">new</span> String[0]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//基础信息</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(StringUtils.<span style="color:#007f7f">isBlank</span>(resultInfo[0])){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    BaseOrderVo baseOrderVo = JSON.<span style="color:#007f7f">parseObject</span>(resultInfo[0],BaseOrderVo.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>    Order order = coverBaseOrderVoToOrder(baseOrderVo);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//订单商品</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(StringUtils.<span style="color:#007f7f">isNotBlank</span>(resultInfo[1])){
</span></span><span style="display:flex;"><span>        List&lt;OrderSub&gt; orderSubs =JSON.<span style="color:#007f7f">parseObject</span>(result.<span style="color:#007f7f">get</span>(1), <span style="color:#fff;font-weight:bold">new</span> TypeReference&lt;List&lt;OrderSub&gt;&gt;(){});
</span></span><span style="display:flex;"><span>        order.<span style="color:#007f7f">setCustomerOrderSubs</span>(orderSubs);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//订单预售</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(StringUtils.<span style="color:#007f7f">isNotBlank</span>(resultInfo[2])){
</span></span><span style="display:flex;"><span>        PresaleOrderData presaleOrderData = JSON.<span style="color:#007f7f">parseObject</span>(resultInfo[2],PresaleOrderData.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>        order.<span style="color:#007f7f">setPresaleOrderData</span>(presaleOrderData);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//订单发票</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(StringUtils.<span style="color:#007f7f">isNotBlank</span>(resultInfo[3])){
</span></span><span style="display:flex;"><span>        OrderInvoice orderInvoice = JSON.<span style="color:#007f7f">parseObject</span>(resultInfo[3],OrderInvoice.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>        order.<span style="color:#007f7f">setOrderInvoice</span>(orderInvoice);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//订单轨迹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(StringUtils.<span style="color:#007f7f">isNotBlank</span>(resultInfo[5])){
</span></span><span style="display:flex;"><span>        OrderTrackInfo orderTrackInfo = JSON.<span style="color:#007f7f">parseObject</span>(resultInfo[5],OrderTrackInfo.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>        order.<span style="color:#007f7f">setOrderTrackInfo</span>(orderTrackInfo);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//订单履约信息</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(StringUtils.<span style="color:#007f7f">isNotBlank</span>(resultInfo[6])){
</span></span><span style="display:flex;"><span>        List&lt;OrderPremiseInfo&gt; orderPremiseInfos =JSON.<span style="color:#007f7f">parseObject</span>(result.<span style="color:#007f7f">get</span>(6), <span style="color:#fff;font-weight:bold">new</span> TypeReference&lt;List&lt;OrderPremiseInfo&gt;&gt;(){});
</span></span><span style="display:flex;"><span>        order.<span style="color:#007f7f">setPremiseInfos</span>(orderPremiseInfos);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//订单费用明细信息</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(StringUtils.<span style="color:#007f7f">isNotBlank</span>(resultInfo[7])){
</span></span><span style="display:flex;"><span>        OrderFeeVo orderFeeVo = JSON.<span style="color:#007f7f">parseObject</span>(resultInfo[7],OrderFeeVo.<span style="color:#007f7f">class</span>);
</span></span><span style="display:flex;"><span>        order.<span style="color:#007f7f">setOrderFeeVo</span>(orderFeeVo);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> order;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：获取缓存的结果跟传入的key的顺序保持对应即可。</p>
<p><strong>缓存util方法封装：</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @description 同时将多个 key-value (域-值)对设置到缓存中。
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param mappings 需要插入的数据信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> mSetString(Map&lt;String, String&gt; mappings) {
</span></span><span style="display:flex;"><span>    CallerInfo callerInfo = Ump.<span style="color:#007f7f">methodReg</span>(UmpKeyConstants.<span style="color:#007f7f">REDIS</span>.<span style="color:#007f7f">REDIS_STATUS_READ_MSET</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        redisClient.<span style="color:#007f7f">getClientInstance</span>().<span style="color:#007f7f">mSetString</span>(mappings);
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        Ump.<span style="color:#007f7f">funcError</span>(callerInfo);
</span></span><span style="display:flex;"><span>    }<span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        Ump.<span style="color:#007f7f">methodRegEnd</span>(callerInfo);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @description 同时将多个key的结果返回。
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param queryKeys 查询的缓存key集合
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> List&lt;String&gt; mGet(List&lt;String&gt; queryKeys) {
</span></span><span style="display:flex;"><span>    CallerInfo callerInfo = Ump.<span style="color:#007f7f">methodReg</span>(UmpKeyConstants.<span style="color:#007f7f">REDIS</span>.<span style="color:#007f7f">REDIS_STATUS_READ_MGET</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> redisClient.<span style="color:#007f7f">getClientInstance</span>().<span style="color:#007f7f">mGet</span>(queryKeys.<span style="color:#007f7f">toArray</span>(<span style="color:#fff;font-weight:bold">new</span> String[0]));
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        Ump.<span style="color:#007f7f">funcError</span>(callerInfo);
</span></span><span style="display:flex;"><span>    }<span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        Ump.<span style="color:#007f7f">methodRegEnd</span>(callerInfo);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;String&gt;(queryKeys.<span style="color:#007f7f">size</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里附上通过pipeline的util封装，可参考。</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @description pipeline放松查询数据
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @param redisKeyList
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @return java.util.List&lt;java.lang.String&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> List&lt;String&gt; getValueByPipeline(List&lt;String&gt; redisKeyList) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span>(CollectionUtils.<span style="color:#007f7f">isEmpty</span>(redisKeyList)){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    List&lt;String&gt; resultInfo = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;(redisKeyList);
</span></span><span style="display:flex;"><span>    CallerInfo callerInfo = Ump.<span style="color:#007f7f">methodReg</span>(UmpKeyConstants.<span style="color:#007f7f">REDIS</span>.<span style="color:#007f7f">REDIS_STATUS_READ_GET</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        PipelineClient pipelineClient = redisClient.<span style="color:#007f7f">getClientInstance</span>().<span style="color:#007f7f">pipelineClient</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//添加批量查询任务</span>
</span></span><span style="display:flex;"><span>        List&lt;JimFuture&gt; futures = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>        redisKeyList.<span style="color:#007f7f">forEach</span>(redisKey -&gt; {
</span></span><span style="display:flex;"><span>            futures.<span style="color:#007f7f">add</span>(pipelineClient.<span style="color:#007f7f">get</span>(redisKey.<span style="color:#007f7f">getBytes</span>()));
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//处理查询结果</span>
</span></span><span style="display:flex;"><span>        pipelineClient.<span style="color:#007f7f">flush</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//可以等待future的返回结果，来判断命令是否成功。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (JimFuture future : futures) {
</span></span><span style="display:flex;"><span>            resultInfo.<span style="color:#007f7f">add</span>(<span style="color:#fff;font-weight:bold">new</span> String((<span style="color:#fff;font-weight:bold">byte</span>[])future.<span style="color:#007f7f">get</span>()));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        log.<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;getValueByPipeline error:&#34;</span>,e);
</span></span><span style="display:flex;"><span>        Ump.<span style="color:#007f7f">funcError</span>(callerInfo);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;(redisKeyList.<span style="color:#007f7f">size</span>());
</span></span><span style="display:flex;"><span>    }<span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        Ump.<span style="color:#007f7f">methodRegEnd</span>(callerInfo);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> resultInfo;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：Pipeline不建议用来设置缓存值，因为本身不是原子性的操作。</p>
<h3 id="压缩存储数据">压缩存储数据<a hidden class="anchor" aria-hidden="true" href="#压缩存储数据">#</a></h3>
<p>DefaultOutputStream</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 压缩</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">byte</span>[] compressToByteArray(String text) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    ByteArrayOutputStream outputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>    Deflater deflater = <span style="color:#fff;font-weight:bold">new</span> Deflater();
</span></span><span style="display:flex;"><span>    DeflaterOutputStream deflaterOutputStream = <span style="color:#fff;font-weight:bold">new</span> DeflaterOutputStream(outputStream, deflater);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    deflaterOutputStream.<span style="color:#007f7f">write</span>(text.<span style="color:#007f7f">getBytes</span>());
</span></span><span style="display:flex;"><span>    deflaterOutputStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> outputStream.<span style="color:#007f7f">toByteArray</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 解压缩</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> String decompressFromByteArray(<span style="color:#fff;font-weight:bold">byte</span>[] bytes) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    ByteArrayInputStream inputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayInputStream(bytes);
</span></span><span style="display:flex;"><span>    Inflater inflater = <span style="color:#fff;font-weight:bold">new</span> Inflater();
</span></span><span style="display:flex;"><span>    InflaterInputStream inflaterInputStream = <span style="color:#fff;font-weight:bold">new</span> InflaterInputStream(inputStream, inflater);
</span></span><span style="display:flex;"><span>    ByteArrayOutputStream outputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">byte</span>[] buffer = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[1024];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> length;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> ((length = inflaterInputStream.<span style="color:#007f7f">read</span>(buffer)) != -1) {
</span></span><span style="display:flex;"><span>        outputStream.<span style="color:#007f7f">write</span>(buffer, 0, length);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    inflaterInputStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    outputStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">byte</span>[] decompressedData = outputStream.<span style="color:#007f7f">toByteArray</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> String(decompressedData);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>GZIPOutputStream</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 压缩</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">byte</span>[] compressGzip(String str) {
</span></span><span style="display:flex;"><span>    ByteArrayOutputStream outputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>    GZIPOutputStream gzipOutputStream = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        gzipOutputStream = <span style="color:#fff;font-weight:bold">new</span> GZIPOutputStream(outputStream);
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        gzipOutputStream.<span style="color:#007f7f">write</span>(str.<span style="color:#007f7f">getBytes</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>));
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>    }<span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            gzipOutputStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> outputStream.<span style="color:#007f7f">toByteArray</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 解压缩</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> String decompressGzip(<span style="color:#fff;font-weight:bold">byte</span>[] compressed) <span style="color:#fff;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    ByteArrayInputStream inputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayInputStream(compressed);
</span></span><span style="display:flex;"><span>    GZIPInputStream gzipInputStream = <span style="color:#fff;font-weight:bold">new</span> GZIPInputStream(inputStream);
</span></span><span style="display:flex;"><span>    ByteArrayOutputStream outputStream = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">byte</span>[] buffer = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[1024];
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> length;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> ((length = gzipInputStream.<span style="color:#007f7f">read</span>(buffer)) &gt; 0) {
</span></span><span style="display:flex;"><span>        outputStream.<span style="color:#007f7f">write</span>(buffer, 0, length);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    gzipInputStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    outputStream.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> outputStream.<span style="color:#007f7f">toString</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ZlibCompress</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// 压缩</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span>  <span style="color:#fff;font-weight:bold">byte</span>[] zlibCompress(String message) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    String chatacter = <span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">byte</span>[] input = message.<span style="color:#007f7f">getBytes</span>(chatacter);
</span></span><span style="display:flex;"><span>    BigDecimal bigDecimal = BigDecimal.<span style="color:#007f7f">valueOf</span>(0.<span style="color:#007f7f">25f</span>);
</span></span><span style="display:flex;"><span>    BigDecimal length = BigDecimal.<span style="color:#007f7f">valueOf</span>(input.<span style="color:#007f7f">length</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">byte</span>[] output = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[input.<span style="color:#007f7f">length</span> + 10 + <span style="color:#fff;font-weight:bold">new</span> Double(Math.<span style="color:#007f7f">ceil</span>(Double.<span style="color:#007f7f">parseDouble</span>(bigDecimal.<span style="color:#007f7f">multiply</span>(length).<span style="color:#007f7f">toString</span>()))).<span style="color:#007f7f">intValue</span>()];
</span></span><span style="display:flex;"><span>    Deflater compresser = <span style="color:#fff;font-weight:bold">new</span> Deflater();
</span></span><span style="display:flex;"><span>    compresser.<span style="color:#007f7f">setInput</span>(input);
</span></span><span style="display:flex;"><span>    compresser.<span style="color:#007f7f">finish</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> compressedDataLength = compresser.<span style="color:#007f7f">deflate</span>(output);
</span></span><span style="display:flex;"><span>    compresser.<span style="color:#007f7f">end</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> Arrays.<span style="color:#007f7f">copyOf</span>(output, compressedDataLength);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// 解压缩</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> String zlibInfCompress(<span style="color:#fff;font-weight:bold">byte</span>[] data) {
</span></span><span style="display:flex;"><span>    String s = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Inflater decompresser = <span style="color:#fff;font-weight:bold">new</span> Inflater();
</span></span><span style="display:flex;"><span>    decompresser.<span style="color:#007f7f">reset</span>();
</span></span><span style="display:flex;"><span>    decompresser.<span style="color:#007f7f">setInput</span>(data);
</span></span><span style="display:flex;"><span>    ByteArrayOutputStream o = <span style="color:#fff;font-weight:bold">new</span> ByteArrayOutputStream(data.<span style="color:#007f7f">length</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">byte</span>[] buf = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">byte</span>[1024];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> (!decompresser.<span style="color:#007f7f">finished</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> i = decompresser.<span style="color:#007f7f">inflate</span>(buf);
</span></span><span style="display:flex;"><span>            o.<span style="color:#007f7f">write</span>(buf, 0, i);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        s = o.<span style="color:#007f7f">toString</span>(<span style="color:#0ff;font-weight:bold">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            o.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    decompresser.<span style="color:#007f7f">end</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> s;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到压缩效率比较好，压缩效率可以从几百kb压缩到几kb内；当然也是看具体场景。不过这里就是最好是避免调用量大的场景使用，毕竟解压和压缩数据量大会比较耗费cpu性能。如果是黄金链路使用，还需要具体配合压测，对比前后接口性能。</p>
<h3 id="替换存储方案">替换存储方案<a hidden class="anchor" aria-hidden="true" href="#替换存储方案">#</a></h3>
<p>如果数据量庞大，那么其实本身是不是就不太适合redis这种缓存存储了。可以考虑es或者mongo这种文档式存储结构，存储大的数据格式。</p>
<h2 id="总结-1">总结<a hidden class="anchor" aria-hidden="true" href="#总结-1">#</a></h2>
<p>redis缓存的使用是一个支持业务和功能高并发的很好的使用方案，但是随着使用场景的多样性以及数据的增加，可能逐渐的会出现大key，日常使用中都可以注意以下几点：</p>
<p>**1.分而治之。**如果需要存储大量的数据，避免直接放到缓存中。可以将其拆分成多个小的value。就像是咱们日常吃饭，盛到碗里，一口一口的吃，俗话说的好呀：“细嚼慢咽”。</p>
<p>**2.避免使用不必要的数据结构。**例如，如果只需要存储一个字符串结构的数据，就不要过度设计，使用Hash或者List等数据结构。</p>
<p>**3.定期清理过期的key。**如果Redis中存在大量的过期key，就会导致Redis的性能下降，或者场景非必要以缓存来持久存储的，可以添加过期时间，定时清理过期的key，就像是家中的日常垃圾类似，定期的清洁和打扫，居住起来咱们才会更加舒服和方便。</p>
<p>**4.对象压缩。**将大的数据压缩成更小的数据，也是一种好的解决方案，不过要注意压缩和解压的频率，毕竟是比较耗费cpu的。</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://funny-toffee-4aa7c3.netlify.app/en/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://funny-toffee-4aa7c3.netlify.app/en/">Wjy&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>