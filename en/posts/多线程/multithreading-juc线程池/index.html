<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>multithreading-JUCçº¿ç¨‹æ±  | Wjy&#39;s Blog</title>
<meta name="keywords" content="multithreading">
<meta name="description" content="ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå…³äºçº¿ç¨‹æ± çš„æ–‡ç« 
çº¿ç¨‹æ± çš„ä½¿ç”¨åœºæ™¯
javaä¸­ç»å¸¸éœ€è¦ç”¨åˆ°å¤šçº¿ç¨‹æ¥å¤„ç†ä¸€äº›ä¸šåŠ¡ï¼Œæˆ‘ä»¬éå¸¸ä¸å»ºè®®å•çº¯ä½¿ç”¨ç»§æ‰¿Threadæˆ–è€…å®ç°Runnableæ¥å£çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ï¼Œé‚£æ ·åŠ¿å¿…æœ‰åˆ›å»ºåŠé”€æ¯çº¿ç¨‹è€—è´¹èµ„æºã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ã€‚åŒæ—¶åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ä¹Ÿå¯èƒ½å¼•å‘èµ„æºè€—å°½çš„é£é™©ï¼Œè¿™ä¸ªæ—¶å€™å¼•å…¥çº¿ç¨‹æ± æ¯”è¾ƒåˆç†ï¼Œæ–¹ä¾¿çº¿ç¨‹ä»»åŠ¡çš„ç®¡ç†ã€‚javaä¸­æ¶‰åŠåˆ°çº¿ç¨‹æ± çš„ç›¸å…³ç±»å‡åœ¨jdk1.5å¼€å§‹çš„java.util.concurrentåŒ…ä¸­ï¼Œæ¶‰åŠåˆ°çš„å‡ ä¸ªæ ¸å¿ƒç±»åŠæ¥å£åŒ…æ‹¬ï¼šExecutorã€Executorsã€ExecutorServiceã€ThreadPoolExecutorã€FutureTaskã€Callableã€Runnableç­‰ã€‚">
<meta name="author" content="">
<link rel="canonical" href="https://funny-toffee-4aa7c3.netlify.app/en/posts/%E5%A4%9A%E7%BA%BF%E7%A8%8B/multithreading-juc%E7%BA%BF%E7%A8%8B%E6%B1%A0/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://funny-toffee-4aa7c3.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://funny-toffee-4aa7c3.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://funny-toffee-4aa7c3.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://funny-toffee-4aa7c3.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://funny-toffee-4aa7c3.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="multithreading-JUCçº¿ç¨‹æ± " />
<meta property="og:description" content="ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå…³äºçº¿ç¨‹æ± çš„æ–‡ç« 
çº¿ç¨‹æ± çš„ä½¿ç”¨åœºæ™¯
javaä¸­ç»å¸¸éœ€è¦ç”¨åˆ°å¤šçº¿ç¨‹æ¥å¤„ç†ä¸€äº›ä¸šåŠ¡ï¼Œæˆ‘ä»¬éå¸¸ä¸å»ºè®®å•çº¯ä½¿ç”¨ç»§æ‰¿Threadæˆ–è€…å®ç°Runnableæ¥å£çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ï¼Œé‚£æ ·åŠ¿å¿…æœ‰åˆ›å»ºåŠé”€æ¯çº¿ç¨‹è€—è´¹èµ„æºã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ã€‚åŒæ—¶åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ä¹Ÿå¯èƒ½å¼•å‘èµ„æºè€—å°½çš„é£é™©ï¼Œè¿™ä¸ªæ—¶å€™å¼•å…¥çº¿ç¨‹æ± æ¯”è¾ƒåˆç†ï¼Œæ–¹ä¾¿çº¿ç¨‹ä»»åŠ¡çš„ç®¡ç†ã€‚javaä¸­æ¶‰åŠåˆ°çº¿ç¨‹æ± çš„ç›¸å…³ç±»å‡åœ¨jdk1.5å¼€å§‹çš„java.util.concurrentåŒ…ä¸­ï¼Œæ¶‰åŠåˆ°çš„å‡ ä¸ªæ ¸å¿ƒç±»åŠæ¥å£åŒ…æ‹¬ï¼šExecutorã€Executorsã€ExecutorServiceã€ThreadPoolExecutorã€FutureTaskã€Callableã€Runnableç­‰ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://funny-toffee-4aa7c3.netlify.app/en/posts/%E5%A4%9A%E7%BA%BF%E7%A8%8B/multithreading-juc%E7%BA%BF%E7%A8%8B%E6%B1%A0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-03-30T10:22:55+00:00" />
<meta property="article:modified_time" content="2019-03-30T10:22:55+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="multithreading-JUCçº¿ç¨‹æ± "/>
<meta name="twitter:description" content="ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå…³äºçº¿ç¨‹æ± çš„æ–‡ç« 
çº¿ç¨‹æ± çš„ä½¿ç”¨åœºæ™¯
javaä¸­ç»å¸¸éœ€è¦ç”¨åˆ°å¤šçº¿ç¨‹æ¥å¤„ç†ä¸€äº›ä¸šåŠ¡ï¼Œæˆ‘ä»¬éå¸¸ä¸å»ºè®®å•çº¯ä½¿ç”¨ç»§æ‰¿Threadæˆ–è€…å®ç°Runnableæ¥å£çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ï¼Œé‚£æ ·åŠ¿å¿…æœ‰åˆ›å»ºåŠé”€æ¯çº¿ç¨‹è€—è´¹èµ„æºã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ã€‚åŒæ—¶åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ä¹Ÿå¯èƒ½å¼•å‘èµ„æºè€—å°½çš„é£é™©ï¼Œè¿™ä¸ªæ—¶å€™å¼•å…¥çº¿ç¨‹æ± æ¯”è¾ƒåˆç†ï¼Œæ–¹ä¾¿çº¿ç¨‹ä»»åŠ¡çš„ç®¡ç†ã€‚javaä¸­æ¶‰åŠåˆ°çº¿ç¨‹æ± çš„ç›¸å…³ç±»å‡åœ¨jdk1.5å¼€å§‹çš„java.util.concurrentåŒ…ä¸­ï¼Œæ¶‰åŠåˆ°çš„å‡ ä¸ªæ ¸å¿ƒç±»åŠæ¥å£åŒ…æ‹¬ï¼šExecutorã€Executorsã€ExecutorServiceã€ThreadPoolExecutorã€FutureTaskã€Callableã€Runnableç­‰ã€‚"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://funny-toffee-4aa7c3.netlify.app/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "multithreading-JUCçº¿ç¨‹æ± ",
      "item": "https://funny-toffee-4aa7c3.netlify.app/en/posts/%E5%A4%9A%E7%BA%BF%E7%A8%8B/multithreading-juc%E7%BA%BF%E7%A8%8B%E6%B1%A0/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "multithreading-JUCçº¿ç¨‹æ± ",
  "name": "multithreading-JUCçº¿ç¨‹æ± ",
  "description": "ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå…³äºçº¿ç¨‹æ± çš„æ–‡ç« \nçº¿ç¨‹æ± çš„ä½¿ç”¨åœºæ™¯ javaä¸­ç»å¸¸éœ€è¦ç”¨åˆ°å¤šçº¿ç¨‹æ¥å¤„ç†ä¸€äº›ä¸šåŠ¡ï¼Œæˆ‘ä»¬éå¸¸ä¸å»ºè®®å•çº¯ä½¿ç”¨ç»§æ‰¿Threadæˆ–è€…å®ç°Runnableæ¥å£çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ï¼Œé‚£æ ·åŠ¿å¿…æœ‰åˆ›å»ºåŠé”€æ¯çº¿ç¨‹è€—è´¹èµ„æºã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ã€‚åŒæ—¶åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ä¹Ÿå¯èƒ½å¼•å‘èµ„æºè€—å°½çš„é£é™©ï¼Œè¿™ä¸ªæ—¶å€™å¼•å…¥çº¿ç¨‹æ± æ¯”è¾ƒåˆç†ï¼Œæ–¹ä¾¿çº¿ç¨‹ä»»åŠ¡çš„ç®¡ç†ã€‚javaä¸­æ¶‰åŠåˆ°çº¿ç¨‹æ± çš„ç›¸å…³ç±»å‡åœ¨jdk1.5å¼€å§‹çš„java.util.concurrentåŒ…ä¸­ï¼Œæ¶‰åŠåˆ°çš„å‡ ä¸ªæ ¸å¿ƒç±»åŠæ¥å£åŒ…æ‹¬ï¼šExecutorã€Executorsã€ExecutorServiceã€ThreadPoolExecutorã€FutureTaskã€Callableã€Runnableç­‰ã€‚\n",
  "keywords": [
    "multithreading"
  ],
  "articleBody": "ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå…³äºçº¿ç¨‹æ± çš„æ–‡ç« \nçº¿ç¨‹æ± çš„ä½¿ç”¨åœºæ™¯ javaä¸­ç»å¸¸éœ€è¦ç”¨åˆ°å¤šçº¿ç¨‹æ¥å¤„ç†ä¸€äº›ä¸šåŠ¡ï¼Œæˆ‘ä»¬éå¸¸ä¸å»ºè®®å•çº¯ä½¿ç”¨ç»§æ‰¿Threadæˆ–è€…å®ç°Runnableæ¥å£çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ï¼Œé‚£æ ·åŠ¿å¿…æœ‰åˆ›å»ºåŠé”€æ¯çº¿ç¨‹è€—è´¹èµ„æºã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ã€‚åŒæ—¶åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ä¹Ÿå¯èƒ½å¼•å‘èµ„æºè€—å°½çš„é£é™©ï¼Œè¿™ä¸ªæ—¶å€™å¼•å…¥çº¿ç¨‹æ± æ¯”è¾ƒåˆç†ï¼Œæ–¹ä¾¿çº¿ç¨‹ä»»åŠ¡çš„ç®¡ç†ã€‚javaä¸­æ¶‰åŠåˆ°çº¿ç¨‹æ± çš„ç›¸å…³ç±»å‡åœ¨jdk1.5å¼€å§‹çš„java.util.concurrentåŒ…ä¸­ï¼Œæ¶‰åŠåˆ°çš„å‡ ä¸ªæ ¸å¿ƒç±»åŠæ¥å£åŒ…æ‹¬ï¼šExecutorã€Executorsã€ExecutorServiceã€ThreadPoolExecutorã€FutureTaskã€Callableã€Runnableç­‰ã€‚\nåŠ å¿«è¯·æ±‚å“åº”ï¼ˆå“åº”æ—¶é—´ä¼˜å…ˆï¼‰ æ¯”å¦‚ç”¨æˆ·åœ¨é¥¿äº†ä¹ˆä¸ŠæŸ¥çœ‹æŸå•†å®¶å¤–å–ï¼Œéœ€è¦èšåˆå•†å“åº“å­˜ã€åº—å®¶ã€ä»·æ ¼ã€çº¢åŒ…ä¼˜æƒ ç­‰ç­‰ä¿¡æ¯è¿”å›ç»™ç”¨æˆ·ï¼Œæ¥å£é€»è¾‘æ¶‰åŠåˆ°èšåˆã€çº§è”ç­‰æŸ¥è¯¢ï¼Œä»è¿™ä¸ªè§’åº¦æ¥çœ‹æ¥å£è¿”å›è¶Šå¿«è¶Šå¥½ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹æ–¹å¼ï¼ŒæŠŠèšåˆ/çº§è”æŸ¥è¯¢ç­‰ä»»åŠ¡é‡‡ç”¨å¹¶è¡Œæ–¹å¼æ‰§è¡Œï¼Œä»è€Œç¼©çŸ­æ¥å£å“åº”æ—¶é—´ã€‚è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨çº¿ç¨‹æ± çš„ç›®çš„å°±æ˜¯ä¸ºäº†ç¼©çŸ­å“åº”æ—¶é—´ï¼Œå¾€å¾€ä¸å»è®¾ç½®é˜Ÿåˆ—å»ç¼“å†²å¹¶å‘çš„è¯·æ±‚ï¼Œè€Œæ˜¯ä¼šé€‚å½“è°ƒé«˜corePoolSizeå’ŒmaxPoolSizeå»å°½å¯èƒ½çš„åˆ›é€ çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚\nåŠ å¿«å¤„ç†å¤§ä»»åŠ¡ï¼ˆååé‡ä¼˜å…ˆï¼‰ æ¯”å¦‚ä¸šåŠ¡ä¸­å°æ¯10åˆ†é’Ÿå°±è°ƒç”¨æ¥å£ç»Ÿè®¡æ¯ä¸ªç³»ç»Ÿ/é¡¹ç›®çš„PV/UVç­‰æŒ‡æ ‡ç„¶åå†™å…¥å¤šä¸ªsheeté¡µä¸­è¿”å›ï¼Œè¿™ç§æƒ…å†µä¸‹å¾€å¾€ä¹Ÿä¼šä½¿ç”¨å¤šçº¿ç¨‹æ–¹å¼æ¥å¹¶è¡Œç»Ÿè®¡ã€‚å’Œæ—¶é—´ä¼˜å…ˆåœºæ™¯ä¸åŒï¼Œè¿™ç§åœºæ™¯çš„å…³æ³¨ç‚¹ä¸åœ¨äºå°½å¯èƒ½å¿«çš„è¿”å›ï¼Œè€Œæ˜¯å…³æ³¨åˆ©ç”¨æœ‰é™çš„èµ„æºå°½å¯èƒ½çš„åœ¨å•ä½æ—¶é—´å†…å¤„ç†æ›´å¤šçš„ä»»åŠ¡ï¼Œå³ååé‡ä¼˜å…ˆã€‚è¿™ç§åœºæ™¯ä¸‹æˆ‘ä»¬å¾€å¾€ä¼šè®¾ç½®é˜Ÿåˆ—æ¥ç¼“å†²å¹¶å‘ä»»åŠ¡ï¼Œå¹¶ä¸”è®¾ç½®åˆç†çš„corePoolSizeå’ŒmaxPoolSizeå‚æ•°ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœè®¾ç½®äº†å¤ªå¤§çš„corePoolSizeå’ŒmaxPoolSizeå¯èƒ½è¿˜ä¼šå› ä¸ºçº¿ç¨‹ä¸Šä¸‹æ–‡é¢‘ç¹åˆ‡æ¢é™ä½ä»»åŠ¡å¤„ç†é€Ÿåº¦ï¼Œä»è€Œå¯¼è‡´ååé‡é™ä½ã€‚\nä»¥ä¸Šä¸¤ç§ä½¿ç”¨åœºæ™¯å’ŒJVMé‡Œçš„ParallelScavengeå’ŒCMSåƒåœ¾æ”¶é›†å™¨æœ‰è¾ƒå¤§çš„ç±»æ¯”æ€§ï¼Œ ParallelScavengeåƒåœ¾æ”¶é›†å™¨å…³æ³¨ç‚¹åœ¨äºè¾¾åˆ°å¯è§‚çš„ååé‡ï¼Œè€ŒCMSåƒåœ¾æ”¶é›†å™¨é‡ç‚¹å…³æ³¨å°½å¯èƒ½ç¼©çŸ­GCåœé¡¿æ—¶é—´ã€‚\nçº¿ç¨‹æ± çš„åˆ›å»ºåŠé‡è¦å‚æ•° çº¿ç¨‹æ± å¯ä»¥è‡ªåŠ¨åˆ›å»ºä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼Œè‡ªåŠ¨åˆ›å»ºä½“ç°åœ¨Executorså·¥å…·ç±»ä¸­ï¼Œå¸¸è§çš„å¯ä»¥åˆ›å»º newFixedThreadPoolã€newCachedThreadPoolã€newSingleThreadExecutorã€newScheduledThreadPoolï¼›æ‰‹åŠ¨åˆ›å»ºä½“ç°åœ¨å¯ä»¥çµæ´»è®¾ç½®çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°ï¼Œä½“ç°åœ¨ä»£ç ä¸­å³ThreadPoolExecutorç±»æ„é€ å™¨ä¸Šå„ä¸ªå®å‚çš„ä¸åŒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 //è®¾ç½®äº†corePoolSize=maxPoolSizeï¼ŒkeepAliveTime=0(æ­¤æ—¶è¯¥å‚æ•°æ²¡ä½œç”¨)ï¼Œæ— ç•Œé˜Ÿåˆ—ï¼Œä»»åŠ¡å¯ä»¥æ— é™æ”¾å…¥ï¼Œå½“è¯·æ±‚è¿‡å¤šæ—¶(ä»»åŠ¡å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šä»»åŠ¡æäº¤é€Ÿåº¦é€ æˆè¯·æ±‚å †ç§¯)å¯èƒ½å¯¼è‡´å ç”¨è¿‡å¤šå†…å­˜æˆ–ç›´æ¥å¯¼è‡´OOMå¼‚å¸¸ public static ExecutorService newFixedThreadPool(int var0) { return new ThreadPoolExecutor(var0, var0, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue()); } //åŸºæœ¬åŒnewFixedThreadPoolï¼Œä½†æ˜¯å°†çº¿ç¨‹æ•°è®¾ç½®ä¸ºäº†1ï¼Œå•çº¿ç¨‹ï¼Œå¼Šç«¯å’ŒnewFixedThreadPoolä¸€è‡´ public static ExecutorService newSingleThreadExecutor() { return new Executors.FinalizableDelegatedExecutorService(new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue())); } //maxPoolSizeä¸ºintçš„æœ€å¤§å€¼ï¼ŒåŒæ­¥ç§»äº¤é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç»´æŠ¤å¸¸é©»çº¿ç¨‹(æ ¸å¿ƒçº¿ç¨‹)ï¼Œæ¯æ¬¡æ¥è¯·æ±‚ç›´æ¥åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œä¹Ÿä¸ä½¿ç”¨é˜Ÿåˆ—ç¼“å†²ï¼Œä¼šè‡ªåŠ¨å›æ”¶å¤šä½™çº¿ç¨‹ï¼Œç”±äºå°†maxPoolSizeè®¾ç½®æˆInteger.MAX_VALUEï¼Œå½“è¯·æ±‚å¾ˆå¤šæ—¶å°±å¯èƒ½åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ï¼Œå¯¼è‡´èµ„æºè€—å°½OOM public static ExecutorService newCachedThreadPool() { return new ThreadPoolExecutor(0, 2147483647, 60L, TimeUnit.SECONDS, new SynchronousQueue()); } //æ”¯æŒå®šæ—¶å‘¨æœŸæ€§æ‰§è¡Œï¼Œä½¿ç”¨çš„æ˜¯å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå¼Šç«¯åŒnewCachedThreadPoolä¸€è‡´ public static ScheduledExecutorService newScheduledThreadPool(int var0) { return new ScheduledThreadPoolExecutor(var0); } æ‰€ä»¥æ ¹æ®ä¸Šé¢åˆ†ææˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒFixedThreadPoolå’ŒSigleThreadExecutorä¸­ä¹‹æ‰€ä»¥ç”¨LinkedBlockingQueueæ— ç•Œé˜Ÿåˆ—ï¼Œæ˜¯å› ä¸ºè®¾ç½®äº†corePoolSize=maxPoolSizeï¼Œçº¿ç¨‹æ•°æ— æ³•åŠ¨æ€æ‰©å±•ï¼Œäºæ˜¯å°±è®¾ç½®äº†æ— ç•Œé˜»å¡é˜Ÿåˆ—æ¥åº”å¯¹ä¸å¯çŸ¥çš„ä»»åŠ¡é‡ï¼›è€ŒCachedThreadPoolåˆ™ä½¿ç”¨çš„æ˜¯SynchronousQueueåŒæ­¥ç§»äº¤é˜Ÿåˆ—ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªé˜Ÿåˆ—å‘¢ï¼Ÿå› ä¸ºCachedThreadPoolè®¾ç½®äº†corePoolSize=0ï¼ŒmaxPoolSize=Integer.MAX_VALUEï¼Œæ¥ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œç”¨ä¸åˆ°é˜Ÿåˆ—æ¥å­˜å‚¨ä»»åŠ¡ï¼›SchduledThreadPoolç”¨çš„æ˜¯å»¶è¿Ÿé˜Ÿåˆ—DelayedWorkQueueã€‚åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ä¹Ÿæ˜¯æ¨èä½¿ç”¨æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼ï¼Œè€Œä¸ç”¨é»˜è®¤æ–¹å¼ï¼Œå…³äºè¿™ç‚¹åœ¨ã€Šé˜¿é‡Œå·´å·´å¼€å‘è§„èŒƒã€‹ä¸­æ˜¯è¿™æ ·æè¿°çš„ï¼š ã€å¼ºåˆ¶ã€‘çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ Executors å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ ThreadPoolExecutor çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚ è¯´æ˜ï¼šExecutors è¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š 1ï¼‰FixedThreadPool å’Œ SingleThreadPool: å…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ 2ï¼‰CachedThreadPool å’Œ ScheduledThreadPool: å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOM 1 2 3 4 5 6 7 public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) {â€¦â€¦} ThreadPoolExecutorä¸­é‡è¦çš„å‡ ä¸ªå‚æ•°è¯¦è§£\ncorePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¹Ÿæ˜¯çº¿ç¨‹æ± ä¸­å¸¸é©»çš„çº¿ç¨‹æ•°ï¼Œçº¿ç¨‹æ± åˆå§‹åŒ–æ—¶é»˜è®¤æ˜¯æ²¡æœ‰çº¿ç¨‹çš„ï¼Œå½“ä»»åŠ¡æ¥ä¸´æ—¶æ‰å¼€å§‹åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°ï¼Œåœ¨æ ¸å¿ƒçº¿ç¨‹æ•°çš„åŸºç¡€ä¸Šå¯èƒ½ä¼šé¢å¤–å¢åŠ ä¸€äº›éæ ¸å¿ƒçº¿ç¨‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åªæœ‰å½“workQueueé˜Ÿåˆ—å¡«æ»¡æ—¶æ‰ä¼šåˆ›å»ºå¤šäºcorePoolSizeçš„çº¿ç¨‹ï¼ˆçº¿ç¨‹æ± æ€»çº¿ç¨‹æ•°ä¸è¶…è¿‡maxPoolSizeï¼‰ keepAliveTimeï¼šéæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²æ—¶é—´è¶…è¿‡keepAliveTimeå°±ä¼šè¢«è‡ªåŠ¨ç»ˆæ­¢å›æ”¶æ‰ï¼Œæ³¨æ„å½“corePoolSize=maxPoolSizeæ—¶ï¼ŒkeepAliveTimeå‚æ•°ä¹Ÿå°±ä¸èµ·ä½œç”¨äº†(å› ä¸ºä¸å­˜åœ¨éæ ¸å¿ƒçº¿ç¨‹)ï¼› unitï¼škeepAliveTimeçš„æ—¶é—´å•ä½ workQueueï¼šç”¨äºä¿å­˜ä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œå¯ä»¥ä¸ºæ— ç•Œã€æœ‰ç•Œã€åŒæ­¥ç§»äº¤ä¸‰ç§é˜Ÿåˆ—ç±»å‹ä¹‹ä¸€ï¼Œå½“æ± å­é‡Œçš„å·¥ä½œçº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶ï¼Œè¿™æ—¶æ–°è¿›æ¥çš„ä»»åŠ¡ä¼šè¢«æ”¾åˆ°é˜Ÿåˆ—ä¸­ threadFactoryï¼šåˆ›å»ºçº¿ç¨‹çš„å·¥å‚ç±»ï¼Œé»˜è®¤ä½¿ç”¨Executors.defaultThreadFactory()ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨guavaåº“çš„ThreadFactoryBuilderæ¥åˆ›å»º handlerï¼šçº¿ç¨‹æ± æ— æ³•ç»§ç»­æ¥æ”¶ä»»åŠ¡ï¼ˆé˜Ÿåˆ—å·²æ»¡ä¸”çº¿ç¨‹æ•°è¾¾åˆ°maximunPoolSizeï¼‰æ—¶çš„é¥±å’Œç­–ç•¥ï¼Œå–å€¼æœ‰AbortPolicyã€CallerRunsPolicyã€DiscardOldestPolicyã€DiscardPolicy çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆ›å»ºæµç¨‹å›¾ ä¸¾ä¾‹ï¼šç°æœ‰ä¸€ä¸ªçº¿ç¨‹æ± ï¼ŒcorePoolSize=10ï¼ŒmaxPoolSize=20ï¼Œé˜Ÿåˆ—é•¿åº¦ä¸º100ï¼Œé‚£ä¹ˆå½“ä»»åŠ¡è¿‡æ¥ä¼šå…ˆåˆ›å»º10ä¸ªæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæ¥ä¸‹æ¥è¿›æ¥çš„ä»»åŠ¡ä¼šè¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ç›´åˆ°é˜Ÿåˆ—æ»¡äº†ï¼Œä¼šåˆ›å»ºé¢å¤–çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡(æœ€å¤š20ä¸ªçº¿ç¨‹)ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœå†æ¥ä»»åŠ¡å°±ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚\nworkQueueé˜Ÿåˆ— SynchronousQueue(åŒæ­¥ç§»äº¤é˜Ÿåˆ—)ï¼šé˜Ÿåˆ—ä¸ä½œä¸ºä»»åŠ¡çš„ç¼“å†²æ–¹å¼ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºé˜Ÿåˆ—é•¿åº¦ä¸ºé›¶ LinkedBlockingQueue(æ— ç•Œé˜Ÿåˆ—)ï¼šé˜Ÿåˆ—é•¿åº¦ä¸å—é™åˆ¶ï¼Œå½“è¯·æ±‚è¶Šæ¥è¶Šå¤šæ—¶(ä»»åŠ¡å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šä»»åŠ¡å¤„ç†é€Ÿåº¦é€ æˆè¯·æ±‚å †ç§¯)å¯èƒ½å¯¼è‡´å†…å­˜å ç”¨è¿‡å¤šæˆ–OOM ArrayBlockintQueue(æœ‰ç•Œé˜Ÿåˆ—)ï¼šé˜Ÿåˆ—é•¿åº¦å—é™ï¼Œå½“é˜Ÿåˆ—æ»¡äº†å°±éœ€è¦åˆ›å»ºå¤šä½™çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡\nhandleræ‹’ç»ç­–ç•¥ AbortPolicyï¼šä¸­æ–­æŠ›å‡ºå¼‚å¸¸ DiscardPolicyï¼šé»˜é»˜ä¸¢å¼ƒä»»åŠ¡ï¼Œä¸è¿›è¡Œä»»ä½•é€šçŸ¥ DiscardOldestPolicyï¼šä¸¢å¼ƒæ‰åœ¨é˜Ÿåˆ—ä¸­å­˜åœ¨æ—¶é—´æœ€ä¹…çš„ä»»åŠ¡ CallerRunsPolicyï¼šè®©æäº¤ä»»åŠ¡çš„çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼ˆå¯¹æ¯”å‰ä¸‰ç§æ¯”è¾ƒå‹å¥½ä¸€ä¸¢ä¸¢ï¼‰\nå…³é—­çº¿ç¨‹æ±  shutdownNow()ï¼šç«‹å³å…³é—­çº¿ç¨‹æ± (æš´åŠ›)ï¼Œæ­£åœ¨æ‰§è¡Œä¸­çš„åŠé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¼šè¢«ä¸­æ–­ï¼ŒåŒæ—¶è¯¥æ–¹æ³•ä¼šè¿”å›è¢«ä¸­æ–­çš„é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡åˆ—è¡¨ shutdown()ï¼šå¹³æ»‘å…³é—­çº¿ç¨‹æ± ï¼Œæ­£åœ¨æ‰§è¡Œä¸­çš„åŠé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡èƒ½æ‰§è¡Œå®Œæˆï¼Œåç»­è¿›æ¥çš„ä»»åŠ¡ä¼šè¢«æ‰§è¡Œæ‹’ç»ç­–ç•¥ isTerminated()ï¼šå½“æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡åŠå¯¹åˆ—ä¸­çš„ä»»åŠ¡å…¨éƒ¨éƒ½æ‰§è¡Œï¼ˆæ¸…ç©ºï¼‰å®Œå°±ä¼šè¿”å›true çº¿ç¨‹æ± å®ç°çº¿ç¨‹å¤ç”¨çš„åŸç† æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± (æ¨è) é‚£ä¹ˆä¸Šé¢è¯´äº†ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºçš„çº¿ç¨‹æ± æœ‰éšæ‚£ï¼Œé‚£å¦‚ä½•ä½¿ç”¨æ‰èƒ½é¿å…è¿™ä¸ªéšæ‚£å‘¢ï¼Ÿå¯¹ç—‡ä¸‹è¯ï¼Œå»ºç«‹è‡ªå·±çš„çº¿ç¨‹å·¥å‚ç±»ï¼Œçµæ´»è®¾ç½®å…³é”®å‚æ•°ï¼š è¿™é‡Œé»˜è®¤æ‹’ç»ç­–ç•¥ä¸ºAbortPolicy\n1 private static ExecutorService executor = new ThreadPoolExecutor(10,10,60L, TimeUnit.SECONDS,new ArrayBlockingQueue(10)); ä½¿ç”¨guavaåŒ…ä¸­çš„ThreadFactoryBuilderå·¥å‚ç±»æ¥æ„é€ çº¿ç¨‹æ± ï¼š\n1 2 3 4 5 //é€šè¿‡guavaçš„ThreadFactoryå·¥å‚ç±»å¯ä»¥æŒ‡å®šçº¿ç¨‹ç»„åç§°ï¼Œè¿™å¯¹åæœŸå®šä½é”™è¯¯æœ‰å¸®åŠ© private static ThreadFactory threadFactory = new ThreadFactoryBuilder().setNameFormat(\"thread-pool-d%\").build(); private static ExecutorService executorService = new ThreadPoolExecutor(10, 10, 60L, TimeUnit.SECONDS, new ArrayBlockingQueue(10), threadFactory, new ThreadPoolExecutor.AbortPolicy()); Springbootä¸­ä½¿ç”¨çº¿ç¨‹æ±  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 //æ–¹å¼ä¸€ï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± é…ç½®ç±» @Configuration public class ThreadPoolConfig { /** * é…ç½®çº¿ç¨‹æ± ï¼ˆæ–¹æ³•ååº”æ”¹æˆæ¨¡å—åå­—ï¼‰ * @return */ @Bean public ThreadPoolExecutor threadPoolExecutor() { return new ThreadPoolExecutor( Integer.valueOf(10), Integer.valueOf(20), Integer.valueOf(60), TimeUnit.SECONDS, new LinkedBlockingQueue(Integer.valueOf(100)), new ZzwThreadFactory(\"zzw\"),//æ”¹æˆæ¨¡å—çš„åå­— new ThreadPoolExecutor.AbortPolicy()); } /** * æ„å»ºçº¿ç¨‹æ± å·¥å‚ï¼ˆç±»åæ”¹æˆæ¨¡å—åå·¥å‚ï¼‰ */ static class ZzwThreadFactory implements ThreadFactory { private ThreadGroup group; private String namePrefix; private final AtomicInteger threadNumber = new AtomicInteger(1); ZzwThreadFactory(String name) { SecurityManager s = System.getSecurityManager(); group = (s == null) ? Thread.currentThread().getThreadGroup() : s.getThreadGroup(); if (null == name || \"\".equals(name.trim())){ name = \"pool\"; } // å‘½åæ–¹å¼ï¼špool(çº¿ç¨‹æ± åå­—)-1(çº¿ç¨‹æ± æ•°)-thread-1(çº¿ç¨‹æ•°) ï¼špool-1-thread-1 this.namePrefix = name +\"-\"+ threadNumber.getAndIncrement() + \"-thread\"; } @Override public Thread newThread(Runnable r) { Thread t = new Thread(group, r, namePrefix + \"-\" + threadNumber.getAndIncrement(), 0); //è®¾ç½®ä¸ºéå®ˆæŠ¤çº¿ç¨‹ if (t.isDaemon()) { t.setDaemon(false); } //è®¾ç½®ä¸ºéå®ˆæŠ¤çº¿ç¨‹ if (t.getPriority() != Thread.NORM_PRIORITY) { t.setPriority(Thread.NORM_PRIORITY); } return t; } } } ä½¿ç”¨æ–¹å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Resource(name = \"ThreadPoolExecutor\") private ThreadPoolExecutor threadPoolExecutor; //ä½¿ç”¨åŒ¿åå‡½æ•° threadPoolExecutor.execute(new Runnable() { @Override public void run() { //TODO } }); //ç”¨lambdaè¡¨è¾¾å¼ç®€å†™ threadPoolExecutor.execute(() -\u003e { // TODO }); æ–¹æ³•äºŒï¼š\n1 2 3 4 5 6 7 8 9 10 @Configuration public class ThreadPoolConfig { @Bean(value = \"threadPoolInstance\") public ExecutorService createThreadPoolInstance() { //é€šè¿‡guavaç±»åº“çš„ThreadFactoryBuilderæ¥å®ç°çº¿ç¨‹å·¥å‚ç±»å¹¶è®¾ç½®çº¿ç¨‹åç§° ThreadFactory threadFactory = new ThreadFactoryBuilder().setNameFormat(\"thread-pool-%d\").build(); ExecutorService threadPool = new ThreadPoolExecutor(10, 16, 60L, TimeUnit.SECONDS, new ArrayBlockingQueue(100), threadFactory, new ThreadPoolExecutor.AbortPolicy()); return threadPool; } } ä½¿ç”¨æ–¹å¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 //é€šè¿‡name=threadPoolInstanceå¼•ç”¨çº¿ç¨‹æ± å®ä¾‹ @Resource(name = \"threadPoolInstance\") private ExecutorService executorService; //ä½¿ç”¨åŒ¿åå‡½æ•° executorService.execute(new Runnable() { @Override public void run() { //TODO } }); //åŒ¿åå‡½æ•°ï¼Œç”¨lambdaç®€å†™åå°±æ˜¯è¿™æ · operationThreadPoolExecutor.execute(() -\u003e { // TODO }); å…¶å®ƒç›¸å…³ åœ¨ThreadPoolExecutorç±»ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•å¼•èµ·äº†æˆ‘ä»¬çš„æ³¨æ„ï¼šbeforeExecuteå’ŒafterExecute\n1 2 protected void beforeExecute(Thread var1, Runnable var2) {} protected void afterExecute(Runnable var1, Throwable var2) {} è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯protectedä¿®é¥°çš„ï¼Œå¾ˆæ˜¾ç„¶æ˜¯ç•™ç»™å¼€å‘äººå‘˜å»é‡å†™æ–¹æ³•ä½“å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œéå¸¸é€‚åˆåšé’©å­å‡½æ•°ï¼Œåœ¨ä»»åŠ¡runæ–¹æ³•çš„å‰åå¢åŠ ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ·»åŠ æ—¥å¿—ã€ç»Ÿè®¡ç­‰ã€‚è¿™ä¸ªå’Œæˆ‘ä»¬springmvcä¸­æ‹¦æˆªå™¨çš„preHandleå’ŒafterCompletionæ–¹æ³•å¾ˆç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹æ–¹æ³•è¿›è¡Œç¯ç»•ï¼Œç±»ä¼¼äºspringçš„AOPï¼Œå‚è€ƒä¸‹å›¾ï¼š Callableå’ŒRunnable Runnableå’ŒCallableéƒ½å¯ä»¥ç†è§£ä¸ºä»»åŠ¡ï¼Œé‡Œé¢å°è£…ç€ä»»åŠ¡çš„å…·ä½“é€»è¾‘ï¼Œç”¨äºæäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œï¼ŒåŒºåˆ«åœ¨äºRunnableä»»åŠ¡æ‰§è¡Œæ²¡æœ‰è¿”å›å€¼ï¼Œä¸”Runnableä»»åŠ¡é€»è¾‘ä¸­ä¸èƒ½é€šè¿‡throwsæŠ›å‡ºchechedå¼‚å¸¸(ä½†æ˜¯å¯ä»¥try catch)ï¼Œè€ŒCallableå¯ä»¥è·å–åˆ°ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿”å›å€¼ä¸”æŠ›å‡ºcheckedå¼‚å¸¸ã€‚\n1 2 3 4 5 6 7 8 9 @FunctionalInterface public interface Runnable { public abstract void run(); } @FunctionalInterface public interface Callable { V call() throws Exception; } Futureå’ŒFutureTask Futureæ¥å£ç”¨æ¥è¡¨ç¤ºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„ç»“æœå­˜å‚¨å™¨ï¼Œå½“ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´è¿‡é•¿å°±å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ï¼šæŠŠä»»åŠ¡æäº¤ç»™å­çº¿ç¨‹å»å¤„ç†ï¼Œä¸»çº¿ç¨‹ä¸ç”¨åŒæ­¥ç­‰å¾…ï¼Œå½“å‘çº¿ç¨‹æ± æäº¤äº†ä¸€ä¸ªCallableæˆ–Runnableä»»åŠ¡æ—¶å°±ä¼šè¿”å›Futureï¼Œç”¨Futureå¯ä»¥è·å–ä»»åŠ¡æ‰§è¡Œçš„è¿”å›ç»“æœã€‚ Futureçš„ä¸»è¦æ–¹æ³•åŒ…æ‹¬ï¼š\nget()æ–¹æ³•ï¼šè¿”å›ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œè‹¥ä»»åŠ¡è¿˜æœªæ‰§è¡Œå®Œï¼Œåˆ™ä¼šä¸€ç›´é˜»å¡ç›´åˆ°å®Œæˆä¸ºæ­¢ï¼Œå¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯ä¸»çº¿ç¨‹æ˜¯æ„ŸçŸ¥ä¸åˆ°å¹¶ä¸”ä¸å—å½±å“çš„ï¼Œé™¤éè°ƒç”¨get()æ–¹æ³•è¿›è¡Œè·å–ç»“æœåˆ™ä¼šæŠ›å‡ºExecutionExceptionå¼‚å¸¸ï¼› get(long timeout, TimeUnit unit)ï¼šåœ¨æŒ‡å®šæ—¶é—´å†…è¿”å›ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œè¶…æ—¶æœªè¿”å›ä¼šæŠ›å‡ºTimeoutExceptionï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ˜¾å¼çš„å–æ¶ˆä»»åŠ¡ï¼› cancel(boolean mayInterruptIfRunning)ï¼šå–æ¶ˆä»»åŠ¡ï¼Œbooleanç±»å‹å…¥å‚è¡¨ç¤ºå¦‚æœä»»åŠ¡æ­£åœ¨è¿è¡Œä¸­æ˜¯å¦å¼ºåˆ¶ä¸­æ–­ï¼› isDone()ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œå®Œæ¯•ä¸ä»£è¡¨ä»»åŠ¡ä¸€å®šæˆåŠŸæ‰§è¡Œï¼Œæ¯”å¦‚ä»»åŠ¡æ‰§è¡Œå¤±ä½†ä¹Ÿæ‰§è¡Œå®Œæ¯•ã€ä»»åŠ¡è¢«ä¸­æ–­äº†ä¹Ÿæ‰§è¡Œå®Œæ¯•éƒ½ä¼šè¿”å›trueï¼Œå®ƒä»…ä»…è¡¨ç¤ºä¸€ç§çŠ¶æ€è¯´åé¢ä»»åŠ¡ä¸ä¼šå†æ‰§è¡Œäº†ï¼› isCancelled()ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆï¼› Futureçš„ç”¨æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public static void main(String[] args) throws ExecutionException, InterruptedException { ExecutorService executorService = Executors.newFixedThreadPool(10); Future future = executorService.submit(new Task()); Integer integer = future.get(); System.out.println(integer); executorService.shutdown(); } static class Task implements Callable { @Override public Integer call() throws Exception { System.out.println(\"å­çº¿ç¨‹å¼€å§‹è®¡ç®—\"); int sum = 0; for (int i = 0; i \u003c= 100; i++) { sum += i; } return sum; } } FutureTaskçš„ç”¨æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public static void main(String[] args) throws ExecutionException, InterruptedException { ExecutorService executorService = Executors.newFixedThreadPool(10); FutureTask futureTask = new FutureTask\u003c\u003e(new Task()); executorService.submit(futureTask); Integer integer = futureTask.get(); System.out.println(integer); executorService.shutdown(); } static class Task implements Callable { @Override public Integer call() throws Exception { System.out.println(\"å­çº¿ç¨‹å¼€å§‹è®¡ç®—\"); int sum = 0; for (int i = 0; i \u003c= 100; i++) { sum += i; } return sum; } } å‚è€ƒ\nçº¿ç¨‹æ± æ¶æ„å›¾ Executor å®ƒæ˜¯æ‰§è¡Œè€…æ¥å£ï¼Œå®ƒæ˜¯æ¥æ‰§è¡Œä»»åŠ¡çš„ã€‚å‡†ç¡®çš„è¯´ï¼ŒExecutoræä¾›äº†execute()æ¥å£æ¥æ‰§è¡Œå·²æäº¤çš„ Runnable ä»»åŠ¡çš„å¯¹è±¡ã€‚Executorå­˜åœ¨çš„ç›®çš„æ˜¯æä¾›ä¸€ç§å°†\"ä»»åŠ¡æäº¤\"ä¸\"ä»»åŠ¡å¦‚ä½•è¿è¡Œ\"åˆ†ç¦»å¼€æ¥çš„æœºåˆ¶ã€‚ å®ƒåªåŒ…å«ä¸€ä¸ªå‡½æ•°æ¥å£ï¼š void execute(Runnable command)\næ³¨æ„åŒºåˆ†Executorså’ŒExecutorã€‚\nExecutorService ExecutorServiceç»§æ‰¿äºExecutorã€‚å®ƒæ˜¯\"æ‰§è¡Œè€…æœåŠ¡\"æ¥å£ï¼Œå®ƒæ˜¯ä¸º\"æ‰§è¡Œè€…æ¥å£Executor\"æœåŠ¡è€Œå­˜åœ¨çš„ï¼›å‡†ç¡®çš„è¯ï¼ŒExecutorServiceæä¾›äº†\"å°†ä»»åŠ¡æäº¤ç»™æ‰§è¡Œè€…çš„æ¥å£(submitæ–¹æ³•)\"ï¼Œâ€œè®©æ‰§è¡Œè€…æ‰§è¡Œä»»åŠ¡(invokeAll, invokeAnyæ–¹æ³•)â€œçš„æ¥å£ç­‰ç­‰ã€‚\nExecutorServiceçš„å‡½æ•°åˆ—è¡¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // è¯·æ±‚å…³é—­ã€å‘ç”Ÿè¶…æ—¶æˆ–è€…å½“å‰çº¿ç¨‹ä¸­æ–­ï¼Œæ— è®ºå“ªä¸€ä¸ªé¦–å…ˆå‘ç”Ÿä¹‹åï¼Œéƒ½å°†å¯¼è‡´é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆæ‰§è¡Œã€‚ boolean awaitTermination(long timeout, TimeUnit unit) // æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå½“æ‰€æœ‰ä»»åŠ¡å®Œæˆæ—¶ï¼Œè¿”å›ä¿æŒä»»åŠ¡çŠ¶æ€å’Œç»“æœçš„ Future åˆ—è¡¨ã€‚ List",
  "wordCount" : "34334",
  "inLanguage": "en",
  "datePublished": "2019-03-30T10:22:55Z",
  "dateModified": "2019-03-30T10:22:55Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://funny-toffee-4aa7c3.netlify.app/en/posts/%E5%A4%9A%E7%BA%BF%E7%A8%8B/multithreading-juc%E7%BA%BF%E7%A8%8B%E6%B1%A0/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Wjy's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://funny-toffee-4aa7c3.netlify.app/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://funny-toffee-4aa7c3.netlify.app/en/" accesskey="h" title="Wjy&#39;s Blog (Alt + H)">Wjy&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://funny-toffee-4aa7c3.netlify.app/en/links" title="ğŸ¤å‹é“¾">
                    <span>ğŸ¤å‹é“¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://funny-toffee-4aa7c3.netlify.app/en/">Home</a>&nbsp;Â»&nbsp;<a href="https://funny-toffee-4aa7c3.netlify.app/en/posts/">Posts</a></div>
    <h1 class="post-title">
      multithreading-JUCçº¿ç¨‹æ± 
    </h1>
    <div class="post-meta"><span title='2019-03-30 10:22:55 +0000 UTC'>2019-03-30</span>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="çº¿ç¨‹æ± çš„ä½¿ç”¨åœºæ™¯">çº¿ç¨‹æ± çš„ä½¿ç”¨åœºæ™¯</a></li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e5%88%9b%e5%bb%ba%e5%8f%8a%e9%87%8d%e8%a6%81%e5%8f%82%e6%95%b0" aria-label="çº¿ç¨‹æ± çš„åˆ›å»ºåŠé‡è¦å‚æ•°">çº¿ç¨‹æ± çš„åˆ›å»ºåŠé‡è¦å‚æ•°</a><ul>
                        
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e4%b8%ad%e7%9a%84%e7%ba%bf%e7%a8%8b%e5%88%9b%e5%bb%ba%e6%b5%81%e7%a8%8b%e5%9b%be" aria-label="çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆ›å»ºæµç¨‹å›¾">çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆ›å»ºæµç¨‹å›¾</a></li>
                <li>
                    <a href="#workqueue%e9%98%9f%e5%88%97" aria-label="workQueueé˜Ÿåˆ—">workQueueé˜Ÿåˆ—</a></li>
                <li>
                    <a href="#handler%e6%8b%92%e7%bb%9d%e7%ad%96%e7%95%a5" aria-label="handleræ‹’ç»ç­–ç•¥">handleræ‹’ç»ç­–ç•¥</a></li>
                <li>
                    <a href="#%e5%85%b3%e9%97%ad%e7%ba%bf%e7%a8%8b%e6%b1%a0" aria-label="å…³é—­çº¿ç¨‹æ± ">å…³é—­çº¿ç¨‹æ± </a></li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e5%ae%9e%e7%8e%b0%e7%ba%bf%e7%a8%8b%e5%a4%8d%e7%94%a8%e7%9a%84%e5%8e%9f%e7%90%86" aria-label="çº¿ç¨‹æ± å®ç°çº¿ç¨‹å¤ç”¨çš„åŸç†">çº¿ç¨‹æ± å®ç°çº¿ç¨‹å¤ç”¨çš„åŸç†</a></li>
                <li>
                    <a href="#%e6%89%8b%e5%8a%a8%e5%88%9b%e5%bb%ba%e7%ba%bf%e7%a8%8b%e6%b1%a0%e6%8e%a8%e8%8d%90" aria-label="æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± (æ¨è)">æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± (æ¨è)</a></li>
                <li>
                    <a href="#springboot%e4%b8%ad%e4%bd%bf%e7%94%a8%e7%ba%bf%e7%a8%8b%e6%b1%a0" aria-label="Springbootä¸­ä½¿ç”¨çº¿ç¨‹æ± ">Springbootä¸­ä½¿ç”¨çº¿ç¨‹æ± </a></li>
                <li>
                    <a href="#%e5%85%b6%e5%ae%83%e7%9b%b8%e5%85%b3" aria-label="å…¶å®ƒç›¸å…³">å…¶å®ƒç›¸å…³</a></li>
                <li>
                    <a href="#callable%e5%92%8crunnable" aria-label="Callableå’ŒRunnable">Callableå’ŒRunnable</a></li>
                <li>
                    <a href="#future%e5%92%8cfuturetask" aria-label="Futureå’ŒFutureTask">Futureå’ŒFutureTask</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e6%9e%b6%e6%9e%84%e5%9b%be" aria-label="çº¿ç¨‹æ± æ¶æ„å›¾">çº¿ç¨‹æ± æ¶æ„å›¾</a><ul>
                        
                <li>
                    <a href="#executor" aria-label="Executor">Executor</a></li>
                <li>
                    <a href="#executorservice" aria-label="ExecutorService">ExecutorService</a></li>
                <li>
                    <a href="#abstractexecutorservice" aria-label="AbstractExecutorService">AbstractExecutorService</a></li>
                <li>
                    <a href="#threadpoolexecutor" aria-label="ThreadPoolExecutor">ThreadPoolExecutor</a></li>
                <li>
                    <a href="#scheduledexecutorservice" aria-label="ScheduledExecutorService">ScheduledExecutorService</a></li>
                <li>
                    <a href="#scheduledthreadpoolexecutor" aria-label="ScheduledThreadPoolExecutor">ScheduledThreadPoolExecutor</a></li>
                <li>
                    <a href="#executors" aria-label="Executors">Executors</a></li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%a4%ba%e4%be%8b" aria-label="çº¿ç¨‹æ± ç¤ºä¾‹">çº¿ç¨‹æ± ç¤ºä¾‹</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e5%8e%9f%e7%90%86" aria-label="çº¿ç¨‹æ± åŸç†">çº¿ç¨‹æ± åŸç†</a><ul>
                        
                <li>
                    <a href="#threadpoolexecutor-1" aria-label="ThreadPoolExecutor">ThreadPoolExecutor</a></li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%b0%83%e5%ba%a6" aria-label="çº¿ç¨‹æ± è°ƒåº¦">çº¿ç¨‹æ± è°ƒåº¦</a></li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%a4%ba%e4%be%8b-1" aria-label="çº¿ç¨‹æ± ç¤ºä¾‹">çº¿ç¨‹æ± ç¤ºä¾‹</a></li>
                <li>
                    <a href="#executors%e5%92%8cthreadpoolexecutor%e5%ae%8c%e6%95%b4%e6%ba%90%e7%a0%81" aria-label="Executorså’ŒThreadPoolExecutorå®Œæ•´æºç ">Executorså’ŒThreadPoolExecutorå®Œæ•´æºç </a></li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" aria-label="çº¿ç¨‹æ± æºç åˆ†æ">çº¿ç¨‹æ± æºç åˆ†æ</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e7%ba%bf%e7%a8%8b%e6%b1%a0" aria-label="åˆ›å»ºâ€œçº¿ç¨‹æ± â€">åˆ›å»ºâ€œçº¿ç¨‹æ± â€</a><ul>
                        
                <li>
                    <a href="#newfixedthreadpool" aria-label="newFixedThreadPool()">newFixedThreadPool()</a></li>
                <li>
                    <a href="#threadpoolexecutor-2" aria-label="ThreadPoolExecutor()">ThreadPoolExecutor()</a></li>
                <li>
                    <a href="#threadfactory" aria-label="ThreadFactory">ThreadFactory</a></li>
                <li>
                    <a href="#rejectedexecutionhandler" aria-label="RejectedExecutionHandler">RejectedExecutionHandler</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%b7%bb%e5%8a%a0%e4%bb%bb%e5%8a%a1%e5%88%b0%e7%ba%bf%e7%a8%8b%e6%b1%a0" aria-label="æ·»åŠ ä»»åŠ¡åˆ°â€œçº¿ç¨‹æ± â€">æ·»åŠ ä»»åŠ¡åˆ°â€œçº¿ç¨‹æ± â€</a><ul>
                        
                <li>
                    <a href="#execute" aria-label="execute()">execute()</a></li>
                <li>
                    <a href="#addworker" aria-label="addWorker()">addWorker()</a></li>
                <li>
                    <a href="#submit" aria-label="submit()">submit()</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%85%b3%e9%97%ad%e7%ba%bf%e7%a8%8b%e6%b1%a0-1" aria-label="å…³é—­â€œçº¿ç¨‹æ± â€">å…³é—­â€œçº¿ç¨‹æ± â€</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e7%8a%b6%e6%80%81" aria-label="çº¿ç¨‹æ± çš„çŠ¶æ€">çº¿ç¨‹æ± çš„çŠ¶æ€</a></li>
                <li>
                    <a href="#%e6%8b%92%e7%bb%9d%e7%ad%96%e7%95%a5" aria-label="æ‹’ç»ç­–ç•¥">æ‹’ç»ç­–ç•¥</a><ul>
                        
                <li>
                    <a href="#discardpolicy-%e7%a4%ba%e4%be%8b" aria-label="DiscardPolicy ç¤ºä¾‹">DiscardPolicy ç¤ºä¾‹</a></li>
                <li>
                    <a href="#discardoldestpolicy-%e7%a4%ba%e4%be%8b" aria-label="DiscardOldestPolicy ç¤ºä¾‹">DiscardOldestPolicy ç¤ºä¾‹</a></li>
                <li>
                    <a href="#abortpolicy-%e7%a4%ba%e4%be%8b" aria-label="AbortPolicy ç¤ºä¾‹">AbortPolicy ç¤ºä¾‹</a></li>
                <li>
                    <a href="#callerrunspolicy-%e7%a4%ba%e4%be%8b" aria-label="CallerRunsPolicy ç¤ºä¾‹">CallerRunsPolicy ç¤ºä¾‹</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#callable-%e5%92%8c-future-%e7%ae%80%e4%bb%8b" aria-label="Callable å’Œ Future ç®€ä»‹">Callable å’Œ Future ç®€ä»‹</a><ul>
                        
                <li>
                    <a href="#callable" aria-label="Callable">Callable</a></li>
                <li>
                    <a href="#future" aria-label="Future">Future</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e5%92%8c%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" aria-label="ç¤ºä¾‹å’Œæºç åˆ†æ">ç¤ºä¾‹å’Œæºç åˆ†æ</a><ul>
                        
                <li>
                    <a href="#submit-1" aria-label="submit()">submit()</a></li>
                <li>
                    <a href="#futuretask%e7%9a%84%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0" aria-label="FutureTaskçš„æ„é€ å‡½æ•°">FutureTaskçš„æ„é€ å‡½æ•°</a></li>
                <li>
                    <a href="#futuretask%e7%9a%84run%e6%96%b9%e6%b3%95" aria-label="FutureTaskçš„run()æ–¹æ³•">FutureTaskçš„run()æ–¹æ³•</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#completablefuture" aria-label="CompletableFuture">CompletableFuture</a><ul>
                        
                <li>
                    <a href="#completablefuturejoin%e5%92%8cget%e7%9a%84%e5%8c%ba%e5%88%ab" aria-label="CompletableFuture.join()å’Œget()çš„åŒºåˆ«"><code>CompletableFuture.join()</code>å’Œ<code>get()</code>çš„åŒºåˆ«</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e5%bc%82%e6%ad%a5%e4%bb%bb%e5%8a%a1" aria-label="åˆ›å»ºå¼‚æ­¥ä»»åŠ¡">åˆ›å»ºå¼‚æ­¥ä»»åŠ¡</a><ul>
                        
                <li>
                    <a href="#runasync-%e5%92%8c-supplyasync%e6%96%b9%e6%b3%95" aria-label="runAsync å’Œ supplyAsyncæ–¹æ³•">runAsync å’Œ supplyAsyncæ–¹æ³•</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%bc%82%e6%ad%a5%e5%9b%9e%e8%b0%83" aria-label="å¼‚æ­¥å›è°ƒ">å¼‚æ­¥å›è°ƒ</a><ul>
                        
                <li>
                    <a href="#whencomplete" aria-label="whenComplete">whenComplete</a></li>
                <li>
                    <a href="#thenapply" aria-label="thenApply">thenApply</a></li>
                <li>
                    <a href="#handle" aria-label="handle">handle</a></li>
                <li>
                    <a href="#thenaccept" aria-label="thenAccept">thenAccept</a></li>
                <li>
                    <a href="#thenrun" aria-label="thenRun">thenRun</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%bb%84%e5%90%88" aria-label="ç»„åˆ">ç»„åˆ</a><ul>
                        
                <li>
                    <a href="#thencombine-%e5%90%88%e5%b9%b6%e4%bb%bb%e5%8a%a1" aria-label="thenCombine åˆå¹¶ä»»åŠ¡">thenCombine åˆå¹¶ä»»åŠ¡</a></li>
                <li>
                    <a href="#thenacceptboth" aria-label="thenAcceptBoth">thenAcceptBoth</a></li>
                <li>
                    <a href="#runafterboth" aria-label="runAfterBoth">runAfterBoth</a></li>
                <li>
                    <a href="#applytoeither" aria-label="applyToEither">applyToEither</a></li>
                <li>
                    <a href="#accepteither" aria-label="acceptEither">acceptEither</a></li>
                <li>
                    <a href="#runaftereither" aria-label="runAfterEither">runAfterEither</a></li>
                <li>
                    <a href="#thencompose" aria-label="thenCompose">thenCompose</a></li>
                <li>
                    <a href="#allof" aria-label="allOf()">allOf()</a></li>
                <li>
                    <a href="#anyof" aria-label="anyOf()">anyOf()</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#forkjoin" aria-label="ForkJoin">ForkJoin</a><ul>
                        
                <li>
                    <a href="#%e5%b7%a5%e4%bd%9c%e7%aa%83%e5%8f%96work-stealing" aria-label="å·¥ä½œçªƒå–ï¼ˆwork-stealingï¼‰">å·¥ä½œçªƒå–ï¼ˆwork-stealingï¼‰</a></li>
                <li>
                    <a href="#%e6%a0%b8%e5%bf%83%e7%b1%bb" aria-label="æ ¸å¿ƒç±»">æ ¸å¿ƒç±»</a><ul>
                        
                <li>
                    <a href="#forkjoinpool" aria-label="ForkJoinPool">ForkJoinPool</a></li>
                <li>
                    <a href="#forkjointask" aria-label="ForkJoinTask">ForkJoinTask</a></li>
                <li>
                    <a href="#forkjoinworkerthread" aria-label="ForkJoinWorkerThread">ForkJoinWorkerThread</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b" aria-label="ç¤ºä¾‹">ç¤ºä¾‹</a><ul>
                        
                <li>
                    <a href="#%e5%af%b9%e5%a4%a7%e6%95%b0%e6%b1%82%e5%92%8c%e9%9c%80%e8%a6%81%e5%ad%90%e7%ba%bf%e7%a8%8b%e7%9a%84%e8%bf%94%e5%9b%9e%e7%bb%93%e6%9e%9c" aria-label="å¯¹å¤§æ•°æ±‚å’Œï¼šéœ€è¦å­çº¿ç¨‹çš„è¿”å›ç»“æœ">å¯¹å¤§æ•°æ±‚å’Œï¼šéœ€è¦å­çº¿ç¨‹çš„è¿”å›ç»“æœ</a></li>
                <li>
                    <a href="#%e6%89%b9%e9%87%8f%e5%8f%91%e9%80%81%e6%b6%88%e6%81%af%e4%b8%8d%e9%9c%80%e8%a6%81%e5%ad%90%e7%ba%bf%e7%a8%8b%e7%9a%84%e8%bf%94%e5%9b%9e%e5%80%bc" aria-label="æ‰¹é‡å‘é€æ¶ˆæ¯ï¼šä¸éœ€è¦å­çº¿ç¨‹çš„è¿”å›å€¼">æ‰¹é‡å‘é€æ¶ˆæ¯ï¼šä¸éœ€è¦å­çº¿ç¨‹çš„è¿”å›å€¼</a></li>
                <li>
                    <a href="#%e6%95%b0%e7%bb%84%e6%8e%92%e5%ba%8f" aria-label="æ•°ç»„æ’åº">æ•°ç»„æ’åº</a></li>
                <li>
                    <a href="#%e6%96%90%e6%b3%a2%e9%82%a3%e5%a5%91%e6%95%b0%e5%88%97" aria-label="æ–æ³¢é‚£å¥‘æ•°åˆ—">æ–æ³¢é‚£å¥‘æ•°åˆ—</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#java%e4%b8%ad%e7%9a%84%e5%87%a0%e7%a7%8d%e7%ba%bf%e7%a8%8b%e6%b1%a0" aria-label="javaä¸­çš„å‡ ç§çº¿ç¨‹æ± ">javaä¸­çš„å‡ ç§çº¿ç¨‹æ± </a><ul>
                        
                <li>
                    <a href="#newsinglethreadexecutor" aria-label="newSingleThreadExecutor">newSingleThreadExecutor</a></li>
                <li>
                    <a href="#newfixedthreadpool-1" aria-label="newFixedThreadPool">newFixedThreadPool</a></li>
                <li>
                    <a href="#newcachedthreadpool" aria-label="newCachedThreadPool">newCachedThreadPool</a></li>
                <li>
                    <a href="#newscheduledthreadpool" aria-label="newScheduledThreadPool">newScheduledThreadPool</a></li>
                <li>
                    <a href="#newworkstealingpool" aria-label="newWorkStealingPool">newWorkStealingPool</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a4%9a%e7%ba%bf%e7%a8%8b%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8" aria-label="å¤šçº¿ç¨‹å®é™…åº”ç”¨">å¤šçº¿ç¨‹å®é™…åº”ç”¨</a></li>
                <li>
                    <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9b%91%e6%8e%a7" aria-label="çº¿ç¨‹æ± ç›‘æ§">çº¿ç¨‹æ± ç›‘æ§</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p><a href="https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå…³äºçº¿ç¨‹æ± çš„æ–‡ç« </a></p>
<h1 id="çº¿ç¨‹æ± çš„ä½¿ç”¨åœºæ™¯">çº¿ç¨‹æ± çš„ä½¿ç”¨åœºæ™¯<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± çš„ä½¿ç”¨åœºæ™¯">#</a></h1>
<p>javaä¸­ç»å¸¸éœ€è¦ç”¨åˆ°å¤šçº¿ç¨‹æ¥å¤„ç†ä¸€äº›ä¸šåŠ¡ï¼Œæˆ‘ä»¬éå¸¸ä¸å»ºè®®å•çº¯ä½¿ç”¨ç»§æ‰¿Threadæˆ–è€…å®ç°Runnableæ¥å£çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ï¼Œé‚£æ ·åŠ¿å¿…æœ‰åˆ›å»ºåŠé”€æ¯çº¿ç¨‹è€—è´¹èµ„æºã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ã€‚åŒæ—¶åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ä¹Ÿå¯èƒ½å¼•å‘èµ„æºè€—å°½çš„é£é™©ï¼Œè¿™ä¸ªæ—¶å€™å¼•å…¥çº¿ç¨‹æ± æ¯”è¾ƒåˆç†ï¼Œæ–¹ä¾¿çº¿ç¨‹ä»»åŠ¡çš„ç®¡ç†ã€‚javaä¸­æ¶‰åŠåˆ°çº¿ç¨‹æ± çš„ç›¸å…³ç±»å‡åœ¨jdk1.5å¼€å§‹çš„java.util.concurrentåŒ…ä¸­ï¼Œæ¶‰åŠåˆ°çš„å‡ ä¸ªæ ¸å¿ƒç±»åŠæ¥å£åŒ…æ‹¬ï¼šExecutorã€Executorsã€ExecutorServiceã€ThreadPoolExecutorã€FutureTaskã€Callableã€Runnableç­‰ã€‚</p>
<ul>
<li>
<p>åŠ å¿«è¯·æ±‚å“åº”ï¼ˆå“åº”æ—¶é—´ä¼˜å…ˆï¼‰
æ¯”å¦‚ç”¨æˆ·åœ¨é¥¿äº†ä¹ˆä¸ŠæŸ¥çœ‹æŸå•†å®¶å¤–å–ï¼Œéœ€è¦èšåˆå•†å“åº“å­˜ã€åº—å®¶ã€ä»·æ ¼ã€çº¢åŒ…ä¼˜æƒ ç­‰ç­‰ä¿¡æ¯è¿”å›ç»™ç”¨æˆ·ï¼Œæ¥å£é€»è¾‘æ¶‰åŠåˆ°èšåˆã€çº§è”ç­‰æŸ¥è¯¢ï¼Œä»è¿™ä¸ªè§’åº¦æ¥çœ‹æ¥å£è¿”å›è¶Šå¿«è¶Šå¥½ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹æ–¹å¼ï¼ŒæŠŠèšåˆ/çº§è”æŸ¥è¯¢ç­‰ä»»åŠ¡é‡‡ç”¨å¹¶è¡Œæ–¹å¼æ‰§è¡Œï¼Œä»è€Œç¼©çŸ­æ¥å£å“åº”æ—¶é—´ã€‚è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨çº¿ç¨‹æ± çš„ç›®çš„å°±æ˜¯ä¸ºäº†ç¼©çŸ­å“åº”æ—¶é—´ï¼Œå¾€å¾€ä¸å»è®¾ç½®é˜Ÿåˆ—å»ç¼“å†²å¹¶å‘çš„è¯·æ±‚ï¼Œè€Œæ˜¯ä¼šé€‚å½“è°ƒé«˜corePoolSizeå’ŒmaxPoolSizeå»å°½å¯èƒ½çš„åˆ›é€ çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
</li>
<li>
<p>åŠ å¿«å¤„ç†å¤§ä»»åŠ¡ï¼ˆååé‡ä¼˜å…ˆï¼‰
æ¯”å¦‚ä¸šåŠ¡ä¸­å°æ¯10åˆ†é’Ÿå°±è°ƒç”¨æ¥å£ç»Ÿè®¡æ¯ä¸ªç³»ç»Ÿ/é¡¹ç›®çš„PV/UVç­‰æŒ‡æ ‡ç„¶åå†™å…¥å¤šä¸ªsheeté¡µä¸­è¿”å›ï¼Œè¿™ç§æƒ…å†µä¸‹å¾€å¾€ä¹Ÿä¼šä½¿ç”¨å¤šçº¿ç¨‹æ–¹å¼æ¥å¹¶è¡Œç»Ÿè®¡ã€‚å’Œæ—¶é—´ä¼˜å…ˆåœºæ™¯ä¸åŒï¼Œè¿™ç§åœºæ™¯çš„å…³æ³¨ç‚¹ä¸åœ¨äºå°½å¯èƒ½å¿«çš„è¿”å›ï¼Œè€Œæ˜¯å…³æ³¨åˆ©ç”¨æœ‰é™çš„èµ„æºå°½å¯èƒ½çš„åœ¨å•ä½æ—¶é—´å†…å¤„ç†æ›´å¤šçš„ä»»åŠ¡ï¼Œå³ååé‡ä¼˜å…ˆã€‚è¿™ç§åœºæ™¯ä¸‹æˆ‘ä»¬å¾€å¾€ä¼šè®¾ç½®é˜Ÿåˆ—æ¥ç¼“å†²å¹¶å‘ä»»åŠ¡ï¼Œå¹¶ä¸”è®¾ç½®åˆç†çš„corePoolSizeå’ŒmaxPoolSizeå‚æ•°ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœè®¾ç½®äº†å¤ªå¤§çš„corePoolSizeå’ŒmaxPoolSizeå¯èƒ½è¿˜ä¼šå› ä¸ºçº¿ç¨‹ä¸Šä¸‹æ–‡é¢‘ç¹åˆ‡æ¢é™ä½ä»»åŠ¡å¤„ç†é€Ÿåº¦ï¼Œä»è€Œå¯¼è‡´ååé‡é™ä½ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸Šä¸¤ç§ä½¿ç”¨åœºæ™¯å’ŒJVMé‡Œçš„ParallelScavengeå’ŒCMSåƒåœ¾æ”¶é›†å™¨æœ‰è¾ƒå¤§çš„ç±»æ¯”æ€§ï¼Œ
ParallelScavengeåƒåœ¾æ”¶é›†å™¨å…³æ³¨ç‚¹åœ¨äºè¾¾åˆ°å¯è§‚çš„ååé‡ï¼Œè€ŒCMSåƒåœ¾æ”¶é›†å™¨é‡ç‚¹å…³æ³¨å°½å¯èƒ½ç¼©çŸ­GCåœé¡¿æ—¶é—´ã€‚</p>
<h1 id="çº¿ç¨‹æ± çš„åˆ›å»ºåŠé‡è¦å‚æ•°">çº¿ç¨‹æ± çš„åˆ›å»ºåŠé‡è¦å‚æ•°<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± çš„åˆ›å»ºåŠé‡è¦å‚æ•°">#</a></h1>
<p>çº¿ç¨‹æ± å¯ä»¥è‡ªåŠ¨åˆ›å»ºä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼Œè‡ªåŠ¨åˆ›å»ºä½“ç°åœ¨Executorså·¥å…·ç±»ä¸­ï¼Œå¸¸è§çš„å¯ä»¥åˆ›å»º
newFixedThreadPoolã€newCachedThreadPoolã€newSingleThreadExecutorã€newScheduledThreadPoolï¼›æ‰‹åŠ¨åˆ›å»ºä½“ç°åœ¨å¯ä»¥çµæ´»è®¾ç½®çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°ï¼Œä½“ç°åœ¨ä»£ç ä¸­å³ThreadPoolExecutorç±»æ„é€ å™¨ä¸Šå„ä¸ªå®å‚çš„ä¸åŒï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//è®¾ç½®äº†corePoolSize=maxPoolSizeï¼ŒkeepAliveTime=0(æ­¤æ—¶è¯¥å‚æ•°æ²¡ä½œç”¨)ï¼Œæ— ç•Œé˜Ÿåˆ—ï¼Œä»»åŠ¡å¯ä»¥æ— é™æ”¾å…¥ï¼Œå½“è¯·æ±‚è¿‡å¤šæ—¶(ä»»åŠ¡å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šä»»åŠ¡æäº¤é€Ÿåº¦é€ æˆè¯·æ±‚å †ç§¯)å¯èƒ½å¯¼è‡´å ç”¨è¿‡å¤šå†…å­˜æˆ–ç›´æ¥å¯¼è‡´OOMå¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ExecutorService newFixedThreadPool(<span style="color:#fff;font-weight:bold">int</span> var0) {
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(var0, var0, <span style="color:#ff0;font-weight:bold">0</span>L, 
</span></span><span style="display:flex;"><span>		TimeUnit.<span style="color:#007f7f">MILLISECONDS</span>, <span style="color:#fff;font-weight:bold">new</span> LinkedBlockingQueue());
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//åŸºæœ¬åŒnewFixedThreadPoolï¼Œä½†æ˜¯å°†çº¿ç¨‹æ•°è®¾ç½®ä¸ºäº†1ï¼Œå•çº¿ç¨‹ï¼Œå¼Šç«¯å’ŒnewFixedThreadPoolä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ExecutorService newSingleThreadExecutor() {
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Executors.<span style="color:#007f7f">FinalizableDelegatedExecutorService</span>(<span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">0</span>L, 
</span></span><span style="display:flex;"><span>		TimeUnit.<span style="color:#007f7f">MILLISECONDS</span>, <span style="color:#fff;font-weight:bold">new</span> LinkedBlockingQueue()));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//maxPoolSizeä¸ºintçš„æœ€å¤§å€¼ï¼ŒåŒæ­¥ç§»äº¤é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç»´æŠ¤å¸¸é©»çº¿ç¨‹(æ ¸å¿ƒçº¿ç¨‹)ï¼Œæ¯æ¬¡æ¥è¯·æ±‚ç›´æ¥åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œä¹Ÿä¸ä½¿ç”¨é˜Ÿåˆ—ç¼“å†²ï¼Œä¼šè‡ªåŠ¨å›æ”¶å¤šä½™çº¿ç¨‹ï¼Œç”±äºå°†maxPoolSizeè®¾ç½®æˆInteger.MAX_VALUEï¼Œå½“è¯·æ±‚å¾ˆå¤šæ—¶å°±å¯èƒ½åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ï¼Œå¯¼è‡´èµ„æºè€—å°½OOM
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ExecutorService newCachedThreadPool() {
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(<span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">2147483647</span>, <span style="color:#ff0;font-weight:bold">60L</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>, <span style="color:#fff;font-weight:bold">new</span> SynchronousQueue());
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//æ”¯æŒå®šæ—¶å‘¨æœŸæ€§æ‰§è¡Œï¼Œä½¿ç”¨çš„æ˜¯å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå¼Šç«¯åŒnewCachedThreadPoolä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ScheduledExecutorService newScheduledThreadPool(<span style="color:#fff;font-weight:bold">int</span> var0) {
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ScheduledThreadPoolExecutor(var0);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">æ‰€ä»¥æ ¹æ®ä¸Šé¢åˆ†ææˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ</span>FixedThreadPool<span style="color:#f00">å’Œ</span>SigleThreadExecutor<span style="color:#f00">ä¸­ä¹‹æ‰€ä»¥ç”¨</span>LinkedBlockingQueue<span style="color:#f00">æ— ç•Œé˜Ÿåˆ—ï¼Œæ˜¯å› ä¸ºè®¾ç½®äº†</span>corePoolSize=maxPoolSize<span style="color:#f00">ï¼Œçº¿ç¨‹æ•°æ— æ³•åŠ¨æ€æ‰©å±•ï¼Œäºæ˜¯å°±è®¾ç½®äº†æ— ç•Œé˜»å¡é˜Ÿåˆ—æ¥åº”å¯¹ä¸å¯çŸ¥çš„ä»»åŠ¡é‡ï¼›è€Œ</span>CachedThreadPool<span style="color:#f00">åˆ™ä½¿ç”¨çš„æ˜¯</span>SynchronousQueue<span style="color:#f00">åŒæ­¥ç§»äº¤é˜Ÿåˆ—ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªé˜Ÿåˆ—å‘¢ï¼Ÿå› ä¸º</span>CachedThreadPool<span style="color:#f00">è®¾ç½®äº†</span>corePoolSize=<span style="color:#ff0;font-weight:bold">0</span><span style="color:#f00">ï¼Œ</span>maxPoolSize=Integer.<span style="color:#007f7f">MAX_VALUE</span><span style="color:#f00">ï¼Œæ¥ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œç”¨ä¸åˆ°é˜Ÿåˆ—æ¥å­˜å‚¨ä»»åŠ¡ï¼›</span>SchduledThreadPool<span style="color:#f00">ç”¨çš„æ˜¯å»¶è¿Ÿé˜Ÿåˆ—</span>DelayedWorkQueue<span style="color:#f00">ã€‚åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ä¹Ÿæ˜¯æ¨èä½¿ç”¨æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼ï¼Œè€Œä¸ç”¨é»˜è®¤æ–¹å¼ï¼Œå…³äºè¿™ç‚¹åœ¨ã€Šé˜¿é‡Œå·´å·´å¼€å‘è§„èŒƒã€‹ä¸­æ˜¯è¿™æ ·æè¿°çš„ï¼š</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">ã€å¼ºåˆ¶ã€‘çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨</span> Executors <span style="color:#f00">å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡</span> ThreadPoolExecutor <span style="color:#f00">çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">è¯´æ˜ï¼š</span>Executors <span style="color:#f00">è¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">1</span><span style="color:#f00">ï¼‰</span>FixedThreadPool <span style="color:#f00">å’Œ</span> SingleThreadPool:
</span></span><span style="display:flex;"><span><span style="color:#f00">å…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸º</span> Integer.<span style="color:#007f7f">MAX_VALUE</span><span style="color:#f00">ï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´</span> OOM<span style="color:#f00">ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#ff0;font-weight:bold">2</span><span style="color:#f00">ï¼‰</span>CachedThreadPool <span style="color:#f00">å’Œ</span> ScheduledThreadPool:
</span></span><span style="display:flex;"><span><span style="color:#f00">å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸º</span> Integer.<span style="color:#007f7f">MAX_VALUE</span><span style="color:#f00">ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´</span> OOM
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize,
</span></span><span style="display:flex;"><span>                           <span style="color:#fff;font-weight:bold">int</span> maximumPoolSize,
</span></span><span style="display:flex;"><span>                           <span style="color:#fff;font-weight:bold">long</span> keepAliveTime, 
</span></span><span style="display:flex;"><span>                           TimeUnit unit,
</span></span><span style="display:flex;"><span>                           BlockingQueue&lt;Runnable&gt; workQueue,
</span></span><span style="display:flex;"><span>                           ThreadFactory threadFactory,
</span></span><span style="display:flex;"><span>                          RejectedExecutionHandler handler) {<span style="color:#f00">â€¦â€¦</span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ThreadPoolExecutorä¸­é‡è¦çš„å‡ ä¸ªå‚æ•°è¯¦è§£</p>
<ul>
<li>corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¹Ÿæ˜¯çº¿ç¨‹æ± ä¸­å¸¸é©»çš„çº¿ç¨‹æ•°ï¼Œçº¿ç¨‹æ± åˆå§‹åŒ–æ—¶é»˜è®¤æ˜¯æ²¡æœ‰çº¿ç¨‹çš„ï¼Œå½“ä»»åŠ¡æ¥ä¸´æ—¶æ‰å¼€å§‹åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡</li>
<li>maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°ï¼Œåœ¨æ ¸å¿ƒçº¿ç¨‹æ•°çš„åŸºç¡€ä¸Šå¯èƒ½ä¼šé¢å¤–å¢åŠ ä¸€äº›éæ ¸å¿ƒçº¿ç¨‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åªæœ‰å½“workQueueé˜Ÿåˆ—å¡«æ»¡æ—¶æ‰ä¼šåˆ›å»ºå¤šäºcorePoolSizeçš„çº¿ç¨‹ï¼ˆçº¿ç¨‹æ± æ€»çº¿ç¨‹æ•°ä¸è¶…è¿‡maxPoolSizeï¼‰</li>
<li>keepAliveTimeï¼šéæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²æ—¶é—´è¶…è¿‡keepAliveTimeå°±ä¼šè¢«è‡ªåŠ¨ç»ˆæ­¢å›æ”¶æ‰ï¼Œæ³¨æ„å½“corePoolSize=maxPoolSizeæ—¶ï¼ŒkeepAliveTimeå‚æ•°ä¹Ÿå°±ä¸èµ·ä½œç”¨äº†(å› ä¸ºä¸å­˜åœ¨éæ ¸å¿ƒçº¿ç¨‹)ï¼›</li>
<li>unitï¼škeepAliveTimeçš„æ—¶é—´å•ä½</li>
<li>workQueueï¼šç”¨äºä¿å­˜ä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œå¯ä»¥ä¸ºæ— ç•Œã€æœ‰ç•Œã€åŒæ­¥ç§»äº¤ä¸‰ç§é˜Ÿåˆ—ç±»å‹ä¹‹ä¸€ï¼Œå½“æ± å­é‡Œçš„å·¥ä½œçº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶ï¼Œè¿™æ—¶æ–°è¿›æ¥çš„ä»»åŠ¡ä¼šè¢«æ”¾åˆ°é˜Ÿåˆ—ä¸­</li>
<li>threadFactoryï¼šåˆ›å»ºçº¿ç¨‹çš„å·¥å‚ç±»ï¼Œé»˜è®¤ä½¿ç”¨Executors.defaultThreadFactory()ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨guavaåº“çš„ThreadFactoryBuilderæ¥åˆ›å»º</li>
<li>handlerï¼šçº¿ç¨‹æ± æ— æ³•ç»§ç»­æ¥æ”¶ä»»åŠ¡ï¼ˆé˜Ÿåˆ—å·²æ»¡ä¸”çº¿ç¨‹æ•°è¾¾åˆ°maximunPoolSizeï¼‰æ—¶çš„é¥±å’Œç­–ç•¥ï¼Œå–å€¼æœ‰AbortPolicyã€CallerRunsPolicyã€DiscardOldestPolicyã€DiscardPolicy</li>
</ul>
<h2 id="çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆ›å»ºæµç¨‹å›¾">çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆ›å»ºæµç¨‹å›¾<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆ›å»ºæµç¨‹å›¾">#</a></h2>
<p><img loading="lazy" src="0.png" alt=""  />

ä¸¾ä¾‹ï¼šç°æœ‰ä¸€ä¸ªçº¿ç¨‹æ± ï¼ŒcorePoolSize=10ï¼ŒmaxPoolSize=20ï¼Œé˜Ÿåˆ—é•¿åº¦ä¸º100ï¼Œé‚£ä¹ˆå½“ä»»åŠ¡è¿‡æ¥ä¼šå…ˆåˆ›å»º10ä¸ªæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæ¥ä¸‹æ¥è¿›æ¥çš„ä»»åŠ¡ä¼šè¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ç›´åˆ°é˜Ÿåˆ—æ»¡äº†ï¼Œä¼šåˆ›å»ºé¢å¤–çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡(æœ€å¤š20ä¸ªçº¿ç¨‹)ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœå†æ¥ä»»åŠ¡å°±ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</p>
<h2 id="workqueueé˜Ÿåˆ—">workQueueé˜Ÿåˆ—<a hidden class="anchor" aria-hidden="true" href="#workqueueé˜Ÿåˆ—">#</a></h2>
<p>SynchronousQueue(åŒæ­¥ç§»äº¤é˜Ÿåˆ—)ï¼šé˜Ÿåˆ—ä¸ä½œä¸ºä»»åŠ¡çš„ç¼“å†²æ–¹å¼ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºé˜Ÿåˆ—é•¿åº¦ä¸ºé›¶
LinkedBlockingQueue(æ— ç•Œé˜Ÿåˆ—)ï¼šé˜Ÿåˆ—é•¿åº¦ä¸å—é™åˆ¶ï¼Œå½“è¯·æ±‚è¶Šæ¥è¶Šå¤šæ—¶(ä»»åŠ¡å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šä»»åŠ¡å¤„ç†é€Ÿåº¦é€ æˆè¯·æ±‚å †ç§¯)å¯èƒ½å¯¼è‡´å†…å­˜å ç”¨è¿‡å¤šæˆ–OOM
ArrayBlockintQueue(æœ‰ç•Œé˜Ÿåˆ—)ï¼šé˜Ÿåˆ—é•¿åº¦å—é™ï¼Œå½“é˜Ÿåˆ—æ»¡äº†å°±éœ€è¦åˆ›å»ºå¤šä½™çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</p>
<h2 id="handleræ‹’ç»ç­–ç•¥">handleræ‹’ç»ç­–ç•¥<a hidden class="anchor" aria-hidden="true" href="#handleræ‹’ç»ç­–ç•¥">#</a></h2>
<p>AbortPolicyï¼šä¸­æ–­æŠ›å‡ºå¼‚å¸¸
DiscardPolicyï¼šé»˜é»˜ä¸¢å¼ƒä»»åŠ¡ï¼Œä¸è¿›è¡Œä»»ä½•é€šçŸ¥
DiscardOldestPolicyï¼šä¸¢å¼ƒæ‰åœ¨é˜Ÿåˆ—ä¸­å­˜åœ¨æ—¶é—´æœ€ä¹…çš„ä»»åŠ¡
CallerRunsPolicyï¼šè®©æäº¤ä»»åŠ¡çš„çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼ˆå¯¹æ¯”å‰ä¸‰ç§æ¯”è¾ƒå‹å¥½ä¸€ä¸¢ä¸¢ï¼‰</p>
<h2 id="å…³é—­çº¿ç¨‹æ± ">å…³é—­çº¿ç¨‹æ± <a hidden class="anchor" aria-hidden="true" href="#å…³é—­çº¿ç¨‹æ± ">#</a></h2>
<ul>
<li>shutdownNow()ï¼šç«‹å³å…³é—­çº¿ç¨‹æ± (æš´åŠ›)ï¼Œæ­£åœ¨æ‰§è¡Œä¸­çš„åŠé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¼šè¢«ä¸­æ–­ï¼ŒåŒæ—¶è¯¥æ–¹æ³•ä¼šè¿”å›è¢«ä¸­æ–­çš„é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡åˆ—è¡¨</li>
<li>shutdown()ï¼šå¹³æ»‘å…³é—­çº¿ç¨‹æ± ï¼Œæ­£åœ¨æ‰§è¡Œä¸­çš„åŠé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡èƒ½æ‰§è¡Œå®Œæˆï¼Œåç»­è¿›æ¥çš„ä»»åŠ¡ä¼šè¢«æ‰§è¡Œæ‹’ç»ç­–ç•¥</li>
<li>isTerminated()ï¼šå½“æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡åŠå¯¹åˆ—ä¸­çš„ä»»åŠ¡å…¨éƒ¨éƒ½æ‰§è¡Œï¼ˆæ¸…ç©ºï¼‰å®Œå°±ä¼šè¿”å›true</li>
</ul>
<h2 id="çº¿ç¨‹æ± å®ç°çº¿ç¨‹å¤ç”¨çš„åŸç†">çº¿ç¨‹æ± å®ç°çº¿ç¨‹å¤ç”¨çš„åŸç†<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± å®ç°çº¿ç¨‹å¤ç”¨çš„åŸç†">#</a></h2>
<p><img loading="lazy" src="01.png" alt=""  />
</p>
<h2 id="æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± æ¨è">æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± (æ¨è)<a hidden class="anchor" aria-hidden="true" href="#æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± æ¨è">#</a></h2>
<p>é‚£ä¹ˆä¸Šé¢è¯´äº†ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºçš„çº¿ç¨‹æ± æœ‰éšæ‚£ï¼Œé‚£å¦‚ä½•ä½¿ç”¨æ‰èƒ½é¿å…è¿™ä¸ªéšæ‚£å‘¢ï¼Ÿå¯¹ç—‡ä¸‹è¯ï¼Œå»ºç«‹è‡ªå·±çš„çº¿ç¨‹å·¥å‚ç±»ï¼Œçµæ´»è®¾ç½®å…³é”®å‚æ•°ï¼š
è¿™é‡Œé»˜è®¤æ‹’ç»ç­–ç•¥ä¸ºAbortPolicy</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> ExecutorService executor = <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(<span style="color:#ff0;font-weight:bold">10</span>,<span style="color:#ff0;font-weight:bold">10</span>,<span style="color:#ff0;font-weight:bold">60L</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>,<span style="color:#fff;font-weight:bold">new</span> ArrayBlockingQueue(<span style="color:#ff0;font-weight:bold">10</span>));
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨guavaåŒ…ä¸­çš„ThreadFactoryBuilderå·¥å‚ç±»æ¥æ„é€ çº¿ç¨‹æ± ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//é€šè¿‡guavaçš„ThreadFactoryå·¥å‚ç±»å¯ä»¥æŒ‡å®šçº¿ç¨‹ç»„åç§°ï¼Œè¿™å¯¹åæœŸå®šä½é”™è¯¯æœ‰å¸®åŠ©
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> ThreadFactory threadFactory = <span style="color:#fff;font-weight:bold">new</span> ThreadFactoryBuilder().<span style="color:#007f7f">setNameFormat</span>(<span style="color:#0ff;font-weight:bold">&#34;thread-pool-d%&#34;</span>).<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> ExecutorService executorService = <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(<span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">60L</span>, 
</span></span><span style="display:flex;"><span>	TimeUnit.<span style="color:#007f7f">SECONDS</span>, <span style="color:#fff;font-weight:bold">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span style="color:#ff0;font-weight:bold">10</span>), 
</span></span><span style="display:flex;"><span>	threadFactory, <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor.<span style="color:#007f7f">AbortPolicy</span>());
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="springbootä¸­ä½¿ç”¨çº¿ç¨‹æ± ">Springbootä¸­ä½¿ç”¨çº¿ç¨‹æ± <a hidden class="anchor" aria-hidden="true" href="#springbootä¸­ä½¿ç”¨çº¿ç¨‹æ± ">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//æ–¹å¼ä¸€ï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± é…ç½®ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadPoolConfig {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * é…ç½®çº¿ç¨‹æ± ï¼ˆæ–¹æ³•ååº”æ”¹æˆæ¨¡å—åå­—ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ThreadPoolExecutor threadPoolExecutor() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(
</span></span><span style="display:flex;"><span>                Integer.<span style="color:#007f7f">valueOf</span>(<span style="color:#ff0;font-weight:bold">10</span>),
</span></span><span style="display:flex;"><span>                Integer.<span style="color:#007f7f">valueOf</span>(<span style="color:#ff0;font-weight:bold">20</span>),
</span></span><span style="display:flex;"><span>                Integer.<span style="color:#007f7f">valueOf</span>(<span style="color:#ff0;font-weight:bold">60</span>),
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> LinkedBlockingQueue(Integer.<span style="color:#007f7f">valueOf</span>(<span style="color:#ff0;font-weight:bold">100</span>)),
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> ZzwThreadFactory(<span style="color:#0ff;font-weight:bold">&#34;zzw&#34;</span>),<span style="color:#007f7f">//æ”¹æˆæ¨¡å—çš„åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor.<span style="color:#007f7f">AbortPolicy</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æ„å»ºçº¿ç¨‹æ± å·¥å‚ï¼ˆç±»åæ”¹æˆæ¨¡å—åå·¥å‚ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> ZzwThreadFactory <span style="color:#fff;font-weight:bold">implements</span> ThreadFactory {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> ThreadGroup group;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> String namePrefix;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> AtomicInteger threadNumber = <span style="color:#fff;font-weight:bold">new</span> AtomicInteger(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ZzwThreadFactory(String name) {
</span></span><span style="display:flex;"><span>            SecurityManager s = System.<span style="color:#007f7f">getSecurityManager</span>();
</span></span><span style="display:flex;"><span>            group = (s == <span style="color:#fff;font-weight:bold">null</span>) ? Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getThreadGroup</span>() : s.<span style="color:#007f7f">getThreadGroup</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">null</span> == name || <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>.<span style="color:#007f7f">equals</span>(name.<span style="color:#007f7f">trim</span>())){
</span></span><span style="display:flex;"><span>                name = <span style="color:#0ff;font-weight:bold">&#34;pool&#34;</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å‘½åæ–¹å¼ï¼špool(çº¿ç¨‹æ± åå­—)-1(çº¿ç¨‹æ± æ•°)-thread-1(çº¿ç¨‹æ•°) ï¼špool-1-thread-1
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">namePrefix</span> = name +<span style="color:#0ff;font-weight:bold">&#34;-&#34;</span>+ threadNumber.<span style="color:#007f7f">getAndIncrement</span>() + <span style="color:#0ff;font-weight:bold">&#34;-thread&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Thread newThread(Runnable r) {
</span></span><span style="display:flex;"><span>            Thread t = <span style="color:#fff;font-weight:bold">new</span> Thread(group, r, namePrefix + <span style="color:#0ff;font-weight:bold">&#34;-&#34;</span> + threadNumber.<span style="color:#007f7f">getAndIncrement</span>(), <span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//è®¾ç½®ä¸ºéå®ˆæŠ¤çº¿ç¨‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (t.<span style="color:#007f7f">isDaemon</span>()) {
</span></span><span style="display:flex;"><span>                t.<span style="color:#007f7f">setDaemon</span>(<span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//è®¾ç½®ä¸ºéå®ˆæŠ¤çº¿ç¨‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (t.<span style="color:#007f7f">getPriority</span>() != Thread.<span style="color:#007f7f">NORM_PRIORITY</span>) {
</span></span><span style="display:flex;"><span>                t.<span style="color:#007f7f">setPriority</span>(Thread.<span style="color:#007f7f">NORM_PRIORITY</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ–¹å¼ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Resource(name = <span style="color:#0ff;font-weight:bold">&#34;ThreadPoolExecutor&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> ThreadPoolExecutor threadPoolExecutor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//ä½¿ç”¨åŒ¿åå‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>threadPoolExecutor.<span style="color:#007f7f">execute</span>(<span style="color:#fff;font-weight:bold">new</span> Runnable() {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">//TODO
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>     }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//ç”¨lambdaè¡¨è¾¾å¼ç®€å†™
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>threadPoolExecutor.<span style="color:#007f7f">execute</span>(() -&gt; {
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// TODO
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>});
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ–¹æ³•äºŒï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadPoolConfig {
</span></span><span style="display:flex;"><span>    @Bean(value = <span style="color:#0ff;font-weight:bold">&#34;threadPoolInstance&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> ExecutorService createThreadPoolInstance() {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//é€šè¿‡guavaç±»åº“çš„ThreadFactoryBuilderæ¥å®ç°çº¿ç¨‹å·¥å‚ç±»å¹¶è®¾ç½®çº¿ç¨‹åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ThreadFactory threadFactory = <span style="color:#fff;font-weight:bold">new</span> ThreadFactoryBuilder().<span style="color:#007f7f">setNameFormat</span>(<span style="color:#0ff;font-weight:bold">&#34;thread-pool-%d&#34;</span>).<span style="color:#007f7f">build</span>();
</span></span><span style="display:flex;"><span>        ExecutorService threadPool = <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(<span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">16</span>, <span style="color:#ff0;font-weight:bold">60L</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>, <span style="color:#fff;font-weight:bold">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span style="color:#ff0;font-weight:bold">100</span>), threadFactory, <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor.<span style="color:#007f7f">AbortPolicy</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> threadPool;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ–¹å¼</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//é€šè¿‡name=threadPoolInstanceå¼•ç”¨çº¿ç¨‹æ± å®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>@Resource(name = <span style="color:#0ff;font-weight:bold">&#34;threadPoolInstance&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> ExecutorService executorService;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//ä½¿ç”¨åŒ¿åå‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>executorService.<span style="color:#007f7f">execute</span>(<span style="color:#fff;font-weight:bold">new</span> Runnable() {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">//TODO
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>     }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>	 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//åŒ¿åå‡½æ•°ï¼Œç”¨lambdaç®€å†™åå°±æ˜¯è¿™æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>operationThreadPoolExecutor.<span style="color:#007f7f">execute</span>(() -&gt; {
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// TODO
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>});
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…¶å®ƒç›¸å…³">å…¶å®ƒç›¸å…³<a hidden class="anchor" aria-hidden="true" href="#å…¶å®ƒç›¸å…³">#</a></h2>
<p>åœ¨ThreadPoolExecutorç±»ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•å¼•èµ·äº†æˆ‘ä»¬çš„æ³¨æ„ï¼šbeforeExecuteå’ŒafterExecute</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> beforeExecute(Thread var1, Runnable var2) {}
</span></span><span style="display:flex;"><span> <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> afterExecute(Runnable var1, Throwable var2) {}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯protectedä¿®é¥°çš„ï¼Œå¾ˆæ˜¾ç„¶æ˜¯ç•™ç»™å¼€å‘äººå‘˜å»é‡å†™æ–¹æ³•ä½“å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œéå¸¸é€‚åˆåšé’©å­å‡½æ•°ï¼Œåœ¨ä»»åŠ¡runæ–¹æ³•çš„å‰åå¢åŠ ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ·»åŠ æ—¥å¿—ã€ç»Ÿè®¡ç­‰ã€‚è¿™ä¸ªå’Œæˆ‘ä»¬springmvcä¸­æ‹¦æˆªå™¨çš„preHandleå’ŒafterCompletionæ–¹æ³•å¾ˆç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹æ–¹æ³•è¿›è¡Œç¯ç»•ï¼Œç±»ä¼¼äºspringçš„AOPï¼Œå‚è€ƒä¸‹å›¾ï¼š
<img loading="lazy" src="02.png" alt=""  />
</p>
<h2 id="callableå’Œrunnable">Callableå’ŒRunnable<a hidden class="anchor" aria-hidden="true" href="#callableå’Œrunnable">#</a></h2>
<p>Runnableå’ŒCallableéƒ½å¯ä»¥ç†è§£ä¸ºä»»åŠ¡ï¼Œé‡Œé¢å°è£…ç€ä»»åŠ¡çš„å…·ä½“é€»è¾‘ï¼Œç”¨äºæäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œï¼ŒåŒºåˆ«åœ¨äºRunnableä»»åŠ¡æ‰§è¡Œæ²¡æœ‰è¿”å›å€¼ï¼Œä¸”Runnableä»»åŠ¡é€»è¾‘ä¸­ä¸èƒ½é€šè¿‡throwsæŠ›å‡ºchechedå¼‚å¸¸(ä½†æ˜¯å¯ä»¥try catch)ï¼Œè€ŒCallableå¯ä»¥è·å–åˆ°ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿”å›å€¼ä¸”æŠ›å‡ºcheckedå¼‚å¸¸ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Runnable {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">abstract</span> <span style="color:#fff;font-weight:bold">void</span> run();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>@FunctionalInterface
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Callable&lt;V&gt; {
</span></span><span style="display:flex;"><span>    V call() <span style="color:#fff;font-weight:bold">throws</span> Exception;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="futureå’Œfuturetask">Futureå’ŒFutureTask<a hidden class="anchor" aria-hidden="true" href="#futureå’Œfuturetask">#</a></h2>
<p>Futureæ¥å£ç”¨æ¥è¡¨ç¤ºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„ç»“æœå­˜å‚¨å™¨ï¼Œå½“ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´è¿‡é•¿å°±å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ï¼šæŠŠä»»åŠ¡æäº¤ç»™å­çº¿ç¨‹å»å¤„ç†ï¼Œä¸»çº¿ç¨‹ä¸ç”¨åŒæ­¥ç­‰å¾…ï¼Œå½“å‘çº¿ç¨‹æ± æäº¤äº†ä¸€ä¸ªCallableæˆ–Runnableä»»åŠ¡æ—¶å°±ä¼šè¿”å›Futureï¼Œç”¨Futureå¯ä»¥è·å–ä»»åŠ¡æ‰§è¡Œçš„è¿”å›ç»“æœã€‚
Futureçš„ä¸»è¦æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li>get()æ–¹æ³•ï¼šè¿”å›ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œè‹¥ä»»åŠ¡è¿˜æœªæ‰§è¡Œå®Œï¼Œåˆ™ä¼šä¸€ç›´é˜»å¡ç›´åˆ°å®Œæˆä¸ºæ­¢ï¼Œå¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯ä¸»çº¿ç¨‹æ˜¯æ„ŸçŸ¥ä¸åˆ°å¹¶ä¸”ä¸å—å½±å“çš„ï¼Œé™¤éè°ƒç”¨get()æ–¹æ³•è¿›è¡Œè·å–ç»“æœåˆ™ä¼šæŠ›å‡ºExecutionExceptionå¼‚å¸¸ï¼›</li>
<li>get(long timeout, TimeUnit unit)ï¼šåœ¨æŒ‡å®šæ—¶é—´å†…è¿”å›ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œè¶…æ—¶æœªè¿”å›ä¼šæŠ›å‡ºTimeoutExceptionï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ˜¾å¼çš„å–æ¶ˆä»»åŠ¡ï¼›</li>
<li>cancel(boolean mayInterruptIfRunning)ï¼šå–æ¶ˆä»»åŠ¡ï¼Œbooleanç±»å‹å…¥å‚è¡¨ç¤ºå¦‚æœä»»åŠ¡æ­£åœ¨è¿è¡Œä¸­æ˜¯å¦å¼ºåˆ¶ä¸­æ–­ï¼›</li>
<li>isDone()ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œå®Œæ¯•ä¸ä»£è¡¨ä»»åŠ¡ä¸€å®šæˆåŠŸæ‰§è¡Œï¼Œæ¯”å¦‚ä»»åŠ¡æ‰§è¡Œå¤±ä½†ä¹Ÿæ‰§è¡Œå®Œæ¯•ã€ä»»åŠ¡è¢«ä¸­æ–­äº†ä¹Ÿæ‰§è¡Œå®Œæ¯•éƒ½ä¼šè¿”å›trueï¼Œå®ƒä»…ä»…è¡¨ç¤ºä¸€ç§çŠ¶æ€è¯´åé¢ä»»åŠ¡ä¸ä¼šå†æ‰§è¡Œäº†ï¼›</li>
<li>isCancelled()ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆï¼›</li>
</ul>
<p>Futureçš„ç”¨æ³•</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>	ExecutorService executorService = Executors.<span style="color:#007f7f">newFixedThreadPool</span>(<span style="color:#ff0;font-weight:bold">10</span>);
</span></span><span style="display:flex;"><span>	Future&lt;Integer&gt; future = executorService.<span style="color:#007f7f">submit</span>(<span style="color:#fff;font-weight:bold">new</span> Task());
</span></span><span style="display:flex;"><span>	Integer integer = future.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(integer);
</span></span><span style="display:flex;"><span>	executorService.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> Task <span style="color:#fff;font-weight:bold">implements</span> Callable&lt;Integer&gt; {
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">public</span> Integer call() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;å­çº¿ç¨‹å¼€å§‹è®¡ç®—&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">int</span> sum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt;= <span style="color:#ff0;font-weight:bold">100</span>; i++) {
</span></span><span style="display:flex;"><span>			sum += i;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> sum;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>FutureTaskçš„ç”¨æ³•</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>	ExecutorService executorService = Executors.<span style="color:#007f7f">newFixedThreadPool</span>(<span style="color:#ff0;font-weight:bold">10</span>);
</span></span><span style="display:flex;"><span>	FutureTask&lt;Integer&gt; futureTask = <span style="color:#fff;font-weight:bold">new</span> FutureTask&lt;&gt;(<span style="color:#fff;font-weight:bold">new</span> Task());
</span></span><span style="display:flex;"><span>	executorService.<span style="color:#007f7f">submit</span>(futureTask);
</span></span><span style="display:flex;"><span>	Integer integer = futureTask.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>	System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(integer);
</span></span><span style="display:flex;"><span>	executorService.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> Task <span style="color:#fff;font-weight:bold">implements</span> Callable&lt;Integer&gt; {
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">public</span> Integer call() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>		System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;å­çº¿ç¨‹å¼€å§‹è®¡ç®—&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">int</span> sum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt;= <span style="color:#ff0;font-weight:bold">100</span>; i++) {
</span></span><span style="display:flex;"><span>			sum += i;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">return</span> sum;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://blog.csdn.net/fanrenxiang/article/details/79855992">å‚è€ƒ</a></p>
<h1 id="çº¿ç¨‹æ± æ¶æ„å›¾">çº¿ç¨‹æ± æ¶æ„å›¾<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± æ¶æ„å›¾">#</a></h1>
<p><img loading="lazy" src="1.jpg" alt=""  />
</p>
<h2 id="executor">Executor<a hidden class="anchor" aria-hidden="true" href="#executor">#</a></h2>
<p>å®ƒæ˜¯<code>æ‰§è¡Œè€…</code>æ¥å£ï¼Œå®ƒæ˜¯æ¥æ‰§è¡Œä»»åŠ¡çš„ã€‚å‡†ç¡®çš„è¯´ï¼ŒExecutoræä¾›äº†execute()æ¥å£æ¥æ‰§è¡Œå·²æäº¤çš„ Runnable ä»»åŠ¡çš„å¯¹è±¡ã€‚Executorå­˜åœ¨çš„ç›®çš„æ˜¯æä¾›ä¸€ç§å°†&quot;ä»»åŠ¡æäº¤&quot;ä¸&quot;ä»»åŠ¡å¦‚ä½•è¿è¡Œ&quot;åˆ†ç¦»å¼€æ¥çš„æœºåˆ¶ã€‚
å®ƒåªåŒ…å«ä¸€ä¸ªå‡½æ•°æ¥å£ï¼š
<code>void execute(Runnable command)</code></p>
<p>æ³¨æ„åŒºåˆ†<code>Executors</code>å’Œ<code>Executor</code>ã€‚</p>
<h2 id="executorservice">ExecutorService<a hidden class="anchor" aria-hidden="true" href="#executorservice">#</a></h2>
<p>ExecutorServiceç»§æ‰¿äºExecutorã€‚å®ƒæ˜¯&quot;æ‰§è¡Œè€…æœåŠ¡&quot;æ¥å£ï¼Œå®ƒæ˜¯ä¸º&quot;æ‰§è¡Œè€…æ¥å£Executor&quot;æœåŠ¡è€Œå­˜åœ¨çš„ï¼›å‡†ç¡®çš„è¯ï¼ŒExecutorServiceæä¾›äº†&quot;å°†ä»»åŠ¡æäº¤ç»™æ‰§è¡Œè€…çš„æ¥å£(submitæ–¹æ³•)&quot;ï¼Œ&ldquo;è®©æ‰§è¡Œè€…æ‰§è¡Œä»»åŠ¡(invokeAll, invokeAnyæ–¹æ³•)&ldquo;çš„æ¥å£ç­‰ç­‰ã€‚</p>
<p>ExecutorServiceçš„å‡½æ•°åˆ—è¡¨</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// è¯·æ±‚å…³é—­ã€å‘ç”Ÿè¶…æ—¶æˆ–è€…å½“å‰çº¿ç¨‹ä¸­æ–­ï¼Œæ— è®ºå“ªä¸€ä¸ªé¦–å…ˆå‘ç”Ÿä¹‹åï¼Œéƒ½å°†å¯¼è‡´é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆæ‰§è¡Œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> awaitTermination(<span style="color:#fff;font-weight:bold">long</span> timeout, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå½“æ‰€æœ‰ä»»åŠ¡å®Œæˆæ—¶ï¼Œè¿”å›ä¿æŒä»»åŠ¡çŠ¶æ€å’Œç»“æœçš„ Future åˆ—è¡¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? <span style="color:#fff;font-weight:bold">extends</span> Callable&lt;T&gt;&gt; tasks)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå½“æ‰€æœ‰ä»»åŠ¡å®Œæˆæˆ–è¶…æ—¶æœŸæ»¡æ—¶ï¼ˆæ— è®ºå“ªä¸ªé¦–å…ˆå‘ç”Ÿï¼‰ï¼Œè¿”å›ä¿æŒä»»åŠ¡çŠ¶æ€å’Œç»“æœçš„ Future åˆ—è¡¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? <span style="color:#fff;font-weight:bold">extends</span> Callable&lt;T&gt;&gt; tasks, <span style="color:#fff;font-weight:bold">long</span> timeout, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå¦‚æœæŸä¸ªä»»åŠ¡å·²æˆåŠŸå®Œæˆï¼ˆä¹Ÿå°±æ˜¯æœªæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œåˆ™è¿”å›å…¶ç»“æœã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>&lt;T&gt; T invokeAny(Collection&lt;? <span style="color:#fff;font-weight:bold">extends</span> Callable&lt;T&gt;&gt; tasks)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå¦‚æœåœ¨ç»™å®šçš„è¶…æ—¶æœŸæ»¡å‰æŸä¸ªä»»åŠ¡å·²æˆåŠŸå®Œæˆï¼ˆä¹Ÿå°±æ˜¯æœªæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œåˆ™è¿”å›å…¶ç»“æœã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>&lt;T&gt; T invokeAny(Collection&lt;? <span style="color:#fff;font-weight:bold">extends</span> Callable&lt;T&gt;&gt; tasks, <span style="color:#fff;font-weight:bold">long</span> timeout, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¦‚æœæ­¤æ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™è¿”å› trueã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> isShutdown()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¦‚æœå…³é—­åæ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆï¼Œåˆ™è¿”å› trueã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> isTerminated()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¯åŠ¨ä¸€æ¬¡é¡ºåºå…³é—­ï¼Œæ‰§è¡Œä»¥å‰æäº¤çš„ä»»åŠ¡ï¼Œä½†ä¸æ¥å—æ–°ä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> shutdown()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¯•å›¾åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„æ´»åŠ¨ä»»åŠ¡ï¼Œæš‚åœå¤„ç†æ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>List&lt;Runnable&gt; shutdownNow()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æäº¤ä¸€ä¸ªè¿”å›å€¼çš„ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ªè¡¨ç¤ºä»»åŠ¡çš„æœªå†³ç»“æœçš„ Futureã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æäº¤ä¸€ä¸ª Runnable ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä»»åŠ¡çš„ Futureã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>Future&lt;?&gt; submit(Runnable task)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æäº¤ä¸€ä¸ª Runnable ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä»»åŠ¡çš„ Futureã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="abstractexecutorservice">AbstractExecutorService<a hidden class="anchor" aria-hidden="true" href="#abstractexecutorservice">#</a></h2>
<p>AbstractExecutorServiceæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒå®ç°äº†ExecutorServiceæ¥å£ã€‚
AbstractExecutorServiceå­˜åœ¨çš„ç›®çš„æ˜¯ä¸ºExecutorServiceä¸­çš„å‡½æ•°æ¥å£æä¾›äº†é»˜è®¤å®ç°ã€‚</p>
<h2 id="threadpoolexecutor">ThreadPoolExecutor<a hidden class="anchor" aria-hidden="true" href="#threadpoolexecutor">#</a></h2>
<p>ThreadPoolExecutorå°±æ˜¯å¤§åé¼é¼çš„&quot;çº¿ç¨‹æ± &rdquo;ã€‚å®ƒç»§æ‰¿äºAbstractExecutorServiceæŠ½è±¡ç±»ã€‚
ThreadPoolExecutorå‡½æ•°åˆ—è¡¨</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// ç”¨ç»™å®šçš„åˆå§‹å‚æ•°å’Œé»˜è®¤çš„çº¿ç¨‹å·¥å‚åŠè¢«æ‹’ç»çš„æ‰§è¡Œå¤„ç†ç¨‹åºåˆ›å»ºæ–°çš„ ThreadPoolExecutorã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize, <span style="color:#fff;font-weight:bold">int</span> maximumPoolSize, <span style="color:#fff;font-weight:bold">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç”¨ç»™å®šçš„åˆå§‹å‚æ•°å’Œé»˜è®¤çš„çº¿ç¨‹å·¥å‚åˆ›å»ºæ–°çš„ ThreadPoolExecutorã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize, <span style="color:#fff;font-weight:bold">int</span> maximumPoolSize, <span style="color:#fff;font-weight:bold">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç”¨ç»™å®šçš„åˆå§‹å‚æ•°å’Œé»˜è®¤è¢«æ‹’ç»çš„æ‰§è¡Œå¤„ç†ç¨‹åºåˆ›å»ºæ–°çš„ ThreadPoolExecutorã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize, <span style="color:#fff;font-weight:bold">int</span> maximumPoolSize, <span style="color:#fff;font-weight:bold">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ç”¨ç»™å®šçš„åˆå§‹å‚æ•°åˆ›å»ºæ–°çš„ ThreadPoolExecutorã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize, <span style="color:#fff;font-weight:bold">int</span> maximumPoolSize, <span style="color:#fff;font-weight:bold">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åŸºäºå®Œæˆæ‰§è¡Œç»™å®š Runnable æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> afterExecute(Runnable r, Throwable t)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¦‚æœåœ¨ä¿æŒæ´»åŠ¨æ—¶é—´å†…æ²¡æœ‰ä»»åŠ¡åˆ°è¾¾ï¼Œæ–°ä»»åŠ¡åˆ°è¾¾æ—¶æ­£åœ¨æ›¿æ¢ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼Œåˆ™è®¾ç½®æ§åˆ¶æ ¸å¿ƒçº¿ç¨‹æ˜¯è¶…æ—¶è¿˜æ˜¯ç»ˆæ­¢çš„ç­–ç•¥ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> allowCoreThreadTimeOut(<span style="color:#fff;font-weight:bold">boolean</span> value)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¦‚æœæ­¤æ± å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶å’Œç»ˆæ­¢ï¼Œå¦‚æœåœ¨ keepAlive æ—¶é—´å†…æ²¡æœ‰ä»»åŠ¡åˆ°è¾¾ï¼Œæ–°ä»»åŠ¡åˆ°è¾¾æ—¶æ­£åœ¨æ›¿æ¢ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼Œåˆ™è¿”å› trueã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> allowsCoreThreadTimeOut()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¯·æ±‚å…³é—­ã€å‘ç”Ÿè¶…æ—¶æˆ–è€…å½“å‰çº¿ç¨‹ä¸­æ–­ï¼Œæ— è®ºå“ªä¸€ä¸ªé¦–å…ˆå‘ç”Ÿä¹‹åï¼Œéƒ½å°†å¯¼è‡´é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆæ‰§è¡Œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> awaitTermination(<span style="color:#fff;font-weight:bold">long</span> timeout, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åœ¨æ‰§è¡Œç»™å®šçº¿ç¨‹ä¸­çš„ç»™å®š Runnable ä¹‹å‰è°ƒç”¨çš„æ–¹æ³•ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> beforeExecute(Thread t, Runnable r)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åœ¨å°†æ¥æŸä¸ªæ—¶é—´æ‰§è¡Œç»™å®šä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> execute(Runnable command)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å½“ä¸å†å¼•ç”¨æ­¤æ‰§è¡Œç¨‹åºæ—¶ï¼Œè°ƒç”¨ shutdownã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> finalize()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›ä¸»åŠ¨æ‰§è¡Œä»»åŠ¡çš„è¿‘ä¼¼çº¿ç¨‹æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> getActiveCount()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›å·²å®Œæˆæ‰§è¡Œçš„è¿‘ä¼¼ä»»åŠ¡æ€»æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">long</span> getCompletedTaskCount()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> getCorePoolSize()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›çº¿ç¨‹ä¿æŒæ´»åŠ¨çš„æ—¶é—´ï¼Œè¯¥æ—¶é—´å°±æ˜¯è¶…è¿‡æ ¸å¿ƒæ± å¤§å°çš„çº¿ç¨‹å¯ä»¥åœ¨ç»ˆæ­¢å‰ä¿æŒç©ºé—²çš„æ—¶é—´å€¼ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">long</span> getKeepAliveTime(TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›æ›¾ç»åŒæ—¶ä½äºæ± ä¸­çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> getLargestPoolSize()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> getMaximumPoolSize()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›æ± ä¸­çš„å½“å‰çº¿ç¨‹æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> getPoolSize()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›æ­¤æ‰§è¡Œç¨‹åºä½¿ç”¨çš„ä»»åŠ¡é˜Ÿåˆ—ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>BlockingQueue&lt;Runnable&gt; getQueue()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›ç”¨äºæœªæ‰§è¡Œä»»åŠ¡çš„å½“å‰å¤„ç†ç¨‹åºã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>RejectedExecutionHandler getRejectedExecutionHandler()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›æ›¾è®¡åˆ’æ‰§è¡Œçš„è¿‘ä¼¼ä»»åŠ¡æ€»æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">long</span> getTaskCount()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›ç”¨äºåˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ThreadFactory getThreadFactory()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¦‚æœæ­¤æ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™è¿”å› trueã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> isShutdown()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¦‚æœå…³é—­åæ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆï¼Œåˆ™è¿”å› trueã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> isTerminated()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¦‚æœæ­¤æ‰§è¡Œç¨‹åºå¤„äºåœ¨ shutdown æˆ– shutdownNow ä¹‹åæ­£åœ¨ç»ˆæ­¢ä½†å°šæœªå®Œå…¨ç»ˆæ­¢çš„è¿‡ç¨‹ä¸­ï¼Œåˆ™è¿”å› trueã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> isTerminating()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œä½¿å…¶å¤„äºç­‰å¾…å·¥ä½œçš„ç©ºé—²çŠ¶æ€ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">int</span> prestartAllCoreThreads()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å¯åŠ¨æ ¸å¿ƒçº¿ç¨‹ï¼Œä½¿å…¶å¤„äºç­‰å¾…å·¥ä½œçš„ç©ºé—²çŠ¶æ€ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> prestartCoreThread()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å°è¯•ä»å·¥ä½œé˜Ÿåˆ—ç§»é™¤æ‰€æœ‰å·²å–æ¶ˆçš„ Future ä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> purge()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä»æ‰§è¡Œç¨‹åºçš„å†…éƒ¨é˜Ÿåˆ—ä¸­ç§»é™¤æ­¤ä»»åŠ¡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œä»è€Œå¦‚æœå°šæœªå¼€å§‹ï¼Œåˆ™å…¶ä¸å†è¿è¡Œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> remove(Runnable task)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> setCorePoolSize(<span style="color:#fff;font-weight:bold">int</span> corePoolSize)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è®¾ç½®çº¿ç¨‹åœ¨ç»ˆæ­¢å‰å¯ä»¥ä¿æŒç©ºé—²çš„æ—¶é—´é™åˆ¶ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> setKeepAliveTime(<span style="color:#fff;font-weight:bold">long</span> time, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è®¾ç½®å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> setMaximumPoolSize(<span style="color:#fff;font-weight:bold">int</span> maximumPoolSize)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è®¾ç½®ç”¨äºæœªæ‰§è¡Œä»»åŠ¡çš„æ–°å¤„ç†ç¨‹åºã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> setRejectedExecutionHandler(RejectedExecutionHandler handler)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è®¾ç½®ç”¨äºåˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> setThreadFactory(ThreadFactory threadFactory)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æŒ‰è¿‡å»æ‰§è¡Œå·²æäº¤ä»»åŠ¡çš„é¡ºåºå‘èµ·ä¸€ä¸ªæœ‰åºçš„å…³é—­ï¼Œä½†æ˜¯ä¸æ¥å—æ–°ä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> shutdown()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å°è¯•åœæ­¢æ‰€æœ‰çš„æ´»åŠ¨æ‰§è¡Œä»»åŠ¡ã€æš‚åœç­‰å¾…ä»»åŠ¡çš„å¤„ç†ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>List&lt;Runnable&gt; shutdownNow()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å½“ Executor å·²ç»ç»ˆæ­¢æ—¶è°ƒç”¨çš„æ–¹æ³•ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> terminated()
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="scheduledexecutorservice">ScheduledExecutorService<a hidden class="anchor" aria-hidden="true" href="#scheduledexecutorservice">#</a></h2>
<p>ScheduledExecutorServiceæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒç»§æ‰¿äºäºExecutorServiceã€‚å®ƒç›¸å½“äºæä¾›äº†&quot;å»¶æ—¶&quot;å’Œ&quot;å‘¨æœŸæ‰§è¡Œ&quot;åŠŸèƒ½çš„ExecutorServiceã€‚
ScheduledExecutorServiceæä¾›äº†ç›¸åº”çš„å‡½æ•°æ¥å£ï¼Œå¯ä»¥å®‰æ’ä»»åŠ¡åœ¨ç»™å®šçš„å»¶è¿Ÿåæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥è®©ä»»åŠ¡å‘¨æœŸçš„æ‰§è¡Œã€‚
ScheduledExecutorServiceå‡½æ•°åˆ—è¡¨</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºå¹¶æ‰§è¡Œåœ¨ç»™å®šå»¶è¿Ÿåå¯ç”¨çš„ ScheduledFutureã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>&lt;V&gt; ScheduledFuture&lt;V&gt; schedule(Callable&lt;V&gt; callable, <span style="color:#fff;font-weight:bold">long</span> delay, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºå¹¶æ‰§è¡Œåœ¨ç»™å®šå»¶è¿Ÿåå¯ç”¨çš„ä¸€æ¬¡æ€§æ“ä½œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ScheduledFuture&lt;?&gt; schedule(Runnable command, <span style="color:#fff;font-weight:bold">long</span> delay, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªåœ¨ç»™å®šåˆå§‹å»¶è¿Ÿåé¦–æ¬¡å¯ç”¨çš„å®šæœŸæ“ä½œï¼Œåç»­æ“ä½œå…·æœ‰ç»™å®šçš„å‘¨æœŸï¼›ä¹Ÿå°±æ˜¯å°†åœ¨ initialDelay åå¼€å§‹æ‰§è¡Œï¼Œç„¶ååœ¨ initialDelay+period åæ‰§è¡Œï¼Œæ¥ç€åœ¨ initialDelay + 2 * period åæ‰§è¡Œï¼Œä¾æ­¤ç±»æ¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command, <span style="color:#fff;font-weight:bold">long</span> initialDelay, <span style="color:#fff;font-weight:bold">long</span> period, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªåœ¨ç»™å®šåˆå§‹å»¶è¿Ÿåé¦–æ¬¡å¯ç”¨çš„å®šæœŸæ“ä½œï¼Œéšåï¼Œåœ¨æ¯ä¸€æ¬¡æ‰§è¡Œç»ˆæ­¢å’Œä¸‹ä¸€æ¬¡æ‰§è¡Œå¼€å§‹ä¹‹é—´éƒ½å­˜åœ¨ç»™å®šçš„å»¶è¿Ÿã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command, <span style="color:#fff;font-weight:bold">long</span> initialDelay, <span style="color:#fff;font-weight:bold">long</span> delay, TimeUnit unit)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="scheduledthreadpoolexecutor">ScheduledThreadPoolExecutor<a hidden class="anchor" aria-hidden="true" href="#scheduledthreadpoolexecutor">#</a></h2>
<p>ScheduledThreadPoolExecutorç»§æ‰¿äºThreadPoolExecutorï¼Œå¹¶ä¸”å®ç°äº†ScheduledExecutorServiceæ¥å£ã€‚å®ƒç›¸å½“äºæä¾›äº†&quot;å»¶æ—¶&quot;å’Œ&quot;å‘¨æœŸæ‰§è¡Œ&quot;åŠŸèƒ½çš„ScheduledExecutorServiceã€‚
ScheduledThreadPoolExecutorç±»ä¼¼äºTimerï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘ç¨‹åºä¸­ï¼ŒScheduledThreadPoolExecutorçš„æ€§èƒ½è¦ä¼˜äºTimerã€‚</p>
<p>ScheduledThreadPoolExecutorå‡½æ•°åˆ—è¡¨</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// ä½¿ç”¨ç»™å®šæ ¸å¿ƒæ± å¤§å°åˆ›å»ºä¸€ä¸ªæ–° ScheduledThreadPoolExecutorã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ScheduledThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä½¿ç”¨ç»™å®šåˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–° ScheduledThreadPoolExecutorã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ScheduledThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize, RejectedExecutionHandler handler)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä½¿ç”¨ç»™å®šçš„åˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–° ScheduledThreadPoolExecutorã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ScheduledThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize, ThreadFactory threadFactory)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä½¿ç”¨ç»™å®šåˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–° ScheduledThreadPoolExecutorã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ScheduledThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize, ThreadFactory threadFactory, RejectedExecutionHandler handler)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä¿®æ”¹æˆ–æ›¿æ¢ç”¨äºæ‰§è¡Œ callable çš„ä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> &lt;V&gt; RunnableScheduledFuture&lt;V&gt; decorateTask(Callable&lt;V&gt; callable, RunnableScheduledFuture&lt;V&gt; task)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä¿®æ”¹æˆ–æ›¿æ¢ç”¨äºæ‰§è¡Œ runnable çš„ä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> &lt;V&gt; RunnableScheduledFuture&lt;V&gt; decorateTask(Runnable runnable, RunnableScheduledFuture&lt;V&gt; task)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä½¿ç”¨æ‰€è¦æ±‚çš„é›¶å»¶è¿Ÿæ‰§è¡Œå‘½ä»¤ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> execute(Runnable command)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è·å–æœ‰å…³åœ¨æ­¤æ‰§è¡Œç¨‹åºå·² shutdown çš„æƒ…å†µä¸‹ã€æ˜¯å¦ç»§ç»­æ‰§è¡Œç°æœ‰å®šæœŸä»»åŠ¡çš„ç­–ç•¥ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> getContinueExistingPeriodicTasksAfterShutdownPolicy()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è·å–æœ‰å…³åœ¨æ­¤æ‰§è¡Œç¨‹åºå·² shutdown çš„æƒ…å†µä¸‹æ˜¯å¦ç»§ç»­æ‰§è¡Œç°æœ‰å»¶è¿Ÿä»»åŠ¡çš„ç­–ç•¥ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> getExecuteExistingDelayedTasksAfterShutdownPolicy()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›æ­¤æ‰§è¡Œç¨‹åºä½¿ç”¨çš„ä»»åŠ¡é˜Ÿåˆ—ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>BlockingQueue&lt;Runnable&gt; getQueue()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä»æ‰§è¡Œç¨‹åºçš„å†…éƒ¨é˜Ÿåˆ—ä¸­ç§»é™¤æ­¤ä»»åŠ¡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œä»è€Œå¦‚æœå°šæœªå¼€å§‹ï¼Œåˆ™å…¶ä¸å†è¿è¡Œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">boolean</span> remove(Runnable task)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºå¹¶æ‰§è¡Œåœ¨ç»™å®šå»¶è¿Ÿåå¯ç”¨çš„ ScheduledFutureã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>&lt;V&gt; ScheduledFuture&lt;V&gt; schedule(Callable&lt;V&gt; callable, <span style="color:#fff;font-weight:bold">long</span> delay, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºå¹¶æ‰§è¡Œåœ¨ç»™å®šå»¶è¿Ÿåå¯ç”¨çš„ä¸€æ¬¡æ€§æ“ä½œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ScheduledFuture&lt;?&gt; schedule(Runnable command, <span style="color:#fff;font-weight:bold">long</span> delay, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªåœ¨ç»™å®šåˆå§‹å»¶è¿Ÿåé¦–æ¬¡å¯ç”¨çš„å®šæœŸæ“ä½œï¼Œåç»­æ“ä½œå…·æœ‰ç»™å®šçš„å‘¨æœŸï¼›ä¹Ÿå°±æ˜¯å°†åœ¨ initialDelay åå¼€å§‹æ‰§è¡Œï¼Œç„¶ååœ¨ initialDelay+period åæ‰§è¡Œï¼Œæ¥ç€åœ¨ initialDelay + 2 * period åæ‰§è¡Œï¼Œä¾æ­¤ç±»æ¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command, <span style="color:#fff;font-weight:bold">long</span> initialDelay, <span style="color:#fff;font-weight:bold">long</span> period, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªåœ¨ç»™å®šåˆå§‹å»¶è¿Ÿåé¦–æ¬¡å¯ç”¨çš„å®šæœŸæ“ä½œï¼Œéšåï¼Œåœ¨æ¯ä¸€æ¬¡æ‰§è¡Œç»ˆæ­¢å’Œä¸‹ä¸€æ¬¡æ‰§è¡Œå¼€å§‹ä¹‹é—´éƒ½å­˜åœ¨ç»™å®šçš„å»¶è¿Ÿã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command, <span style="color:#fff;font-weight:bold">long</span> initialDelay, <span style="color:#fff;font-weight:bold">long</span> delay, TimeUnit unit)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è®¾ç½®æœ‰å…³åœ¨æ­¤æ‰§è¡Œç¨‹åºå·² shutdown çš„æƒ…å†µä¸‹æ˜¯å¦ç»§ç»­æ‰§è¡Œç°æœ‰å®šæœŸä»»åŠ¡çš„ç­–ç•¥ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> setContinueExistingPeriodicTasksAfterShutdownPolicy(<span style="color:#fff;font-weight:bold">boolean</span> value)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è®¾ç½®æœ‰å…³åœ¨æ­¤æ‰§è¡Œç¨‹åºå·² shutdown çš„æƒ…å†µä¸‹æ˜¯å¦ç»§ç»­æ‰§è¡Œç°æœ‰å»¶è¿Ÿä»»åŠ¡çš„ç­–ç•¥ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> setExecuteExistingDelayedTasksAfterShutdownPolicy(<span style="color:#fff;font-weight:bold">boolean</span> value)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åœ¨ä»¥å‰å·²æäº¤ä»»åŠ¡çš„æ‰§è¡Œä¸­å‘èµ·ä¸€ä¸ªæœ‰åºçš„å…³é—­ï¼Œä½†æ˜¯ä¸æ¥å—æ–°ä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">void</span> shutdown()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å°è¯•åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ã€æš‚åœç­‰å¾…ä»»åŠ¡çš„å¤„ç†ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>List&lt;Runnable&gt; shutdownNow()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æäº¤ä¸€ä¸ªè¿”å›å€¼çš„ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ªè¡¨ç¤ºä»»åŠ¡çš„æœªå†³ç»“æœçš„ Futureã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æäº¤ä¸€ä¸ª Runnable ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä»»åŠ¡çš„ Futureã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>Future&lt;?&gt; submit(Runnable task)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æäº¤ä¸€ä¸ª Runnable ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä»»åŠ¡çš„ Futureã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="executors">Executors<a hidden class="anchor" aria-hidden="true" href="#executors">#</a></h2>
<p>Executorsæ˜¯ä¸ªé™æ€å·¥å‚ç±»ã€‚å®ƒé€šè¿‡é™æ€å·¥å‚æ–¹æ³•è¿”å›ExecutorServiceã€ScheduledExecutorServiceã€ThreadFactory å’Œ Callable ç­‰ç±»çš„å¯¹è±¡ã€‚</p>
<p>Executorså‡½æ•°åˆ—è¡¨</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å› Callable å¯¹è±¡ï¼Œè°ƒç”¨å®ƒæ—¶å¯è¿è¡Œç»™å®šç‰¹æƒçš„æ“ä½œå¹¶è¿”å›å…¶ç»“æœã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> Callable&lt;Object&gt; callable(PrivilegedAction&lt;?&gt; action)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å› Callable å¯¹è±¡ï¼Œè°ƒç”¨å®ƒæ—¶å¯è¿è¡Œç»™å®šç‰¹æƒçš„å¼‚å¸¸æ“ä½œå¹¶è¿”å›å…¶ç»“æœã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> Callable&lt;Object&gt; callable(PrivilegedExceptionAction&lt;?&gt; action)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å› Callable å¯¹è±¡ï¼Œè°ƒç”¨å®ƒæ—¶å¯è¿è¡Œç»™å®šçš„ä»»åŠ¡å¹¶è¿”å› nullã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> Callable&lt;Object&gt; callable(Runnable task)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å› Callable å¯¹è±¡ï¼Œè°ƒç”¨å®ƒæ—¶å¯è¿è¡Œç»™å®šçš„ä»»åŠ¡å¹¶è¿”å›ç»™å®šçš„ç»“æœã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> &lt;T&gt; Callable&lt;T&gt; callable(Runnable task, T result)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›ç”¨äºåˆ›å»ºæ–°çº¿ç¨‹çš„é»˜è®¤çº¿ç¨‹å·¥å‚ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ThreadFactory defaultThreadFactory()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªå¯æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä½†æ˜¯åœ¨ä»¥å‰æ„é€ çš„çº¿ç¨‹å¯ç”¨æ—¶å°†é‡ç”¨å®ƒä»¬ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ExecutorService newCachedThreadPool()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªå¯æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä½†æ˜¯åœ¨ä»¥å‰æ„é€ çš„çº¿ç¨‹å¯ç”¨æ—¶å°†é‡ç”¨å®ƒä»¬ï¼Œå¹¶åœ¨éœ€è¦æ—¶ä½¿ç”¨æä¾›çš„ ThreadFactory åˆ›å»ºæ–°çº¿ç¨‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ExecutorService newCachedThreadPool(ThreadFactory threadFactory)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼Œä»¥å…±äº«çš„æ— ç•Œé˜Ÿåˆ—æ–¹å¼æ¥è¿è¡Œè¿™äº›çº¿ç¨‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ExecutorService newFixedThreadPool(<span style="color:#fff;font-weight:bold">int</span> nThreads)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼Œä»¥å…±äº«çš„æ— ç•Œé˜Ÿåˆ—æ–¹å¼æ¥è¿è¡Œè¿™äº›çº¿ç¨‹ï¼Œåœ¨éœ€è¦æ—¶ä½¿ç”¨æä¾›çš„ ThreadFactory åˆ›å»ºæ–°çº¿ç¨‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ExecutorService newFixedThreadPool(<span style="color:#fff;font-weight:bold">int</span> nThreads, ThreadFactory threadFactory)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ScheduledExecutorService newScheduledThreadPool(<span style="color:#fff;font-weight:bold">int</span> corePoolSize)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ScheduledExecutorService newScheduledThreadPool(<span style="color:#fff;font-weight:bold">int</span> corePoolSize, ThreadFactory threadFactory)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªä½¿ç”¨å•ä¸ª worker çº¿ç¨‹çš„ Executorï¼Œä»¥æ— ç•Œé˜Ÿåˆ—æ–¹å¼æ¥è¿è¡Œè¯¥çº¿ç¨‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ExecutorService newSingleThreadExecutor()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªä½¿ç”¨å•ä¸ª worker çº¿ç¨‹çš„ Executorï¼Œä»¥æ— ç•Œé˜Ÿåˆ—æ–¹å¼æ¥è¿è¡Œè¯¥çº¿ç¨‹ï¼Œå¹¶åœ¨éœ€è¦æ—¶ä½¿ç”¨æä¾›çš„ ThreadFactory åˆ›å»ºæ–°çº¿ç¨‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ExecutorService newSingleThreadExecutor(ThreadFactory threadFactory)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œç¨‹åºï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ScheduledExecutorService newSingleThreadScheduledExecutor()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œç¨‹åºï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ScheduledExecutorService newSingleThreadScheduledExecutor(ThreadFactory threadFactory)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å› Callable å¯¹è±¡ï¼Œè°ƒç”¨å®ƒæ—¶å¯åœ¨å½“å‰çš„è®¿é—®æ§åˆ¶ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œç»™å®šçš„ callable å¯¹è±¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> &lt;T&gt; Callable&lt;T&gt; privilegedCallable(Callable&lt;T&gt; callable)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å› Callable å¯¹è±¡ï¼Œè°ƒç”¨å®ƒæ—¶å¯åœ¨å½“å‰çš„è®¿é—®æ§åˆ¶ä¸Šä¸‹æ–‡ä¸­ï¼Œä½¿ç”¨å½“å‰ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä½œä¸ºä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥æ‰§è¡Œç»™å®šçš„ callable å¯¹è±¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> &lt;T&gt; Callable&lt;T&gt; privilegedCallableUsingCurrentClassLoader(Callable&lt;T&gt; callable)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›ç”¨äºåˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ï¼Œè¿™äº›æ–°çº¿ç¨‹ä¸å½“å‰çº¿ç¨‹å…·æœ‰ç›¸åŒçš„æƒé™ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ThreadFactory privilegedThreadFactory()
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›ä¸€ä¸ªå°†æ‰€æœ‰å·²å®šä¹‰çš„ ExecutorService æ–¹æ³•å§”æ‰˜ç»™æŒ‡å®šæ‰§è¡Œç¨‹åºçš„å¯¹è±¡ï¼Œä½†æ˜¯ä½¿ç”¨å¼ºåˆ¶è½¬æ¢å¯èƒ½æ— æ³•è®¿é—®å…¶ä»–æ–¹æ³•ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ExecutorService unconfigurableExecutorService(ExecutorService executor)
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è¿”å›ä¸€ä¸ªå°†æ‰€æœ‰å·²å®šä¹‰çš„ ExecutorService æ–¹æ³•å§”æ‰˜ç»™æŒ‡å®šæ‰§è¡Œç¨‹åºçš„å¯¹è±¡ï¼Œä½†æ˜¯ä½¿ç”¨å¼ºåˆ¶è½¬æ¢å¯èƒ½æ— æ³•è®¿é—®å…¶ä»–æ–¹æ³•ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">static</span> ScheduledExecutorService unconfigurableScheduledExecutorService(ScheduledExecutorService executor)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="çº¿ç¨‹æ± ç¤ºä¾‹">çº¿ç¨‹æ± ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± ç¤ºä¾‹">#</a></h2>
<p>ä¸‹é¢é€šè¿‡ç¤ºä¾‹æ¥å¯¹çº¿ç¨‹æ± çš„ä½¿ç”¨åšç®€å•æ¼”ç¤ºã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.Executors;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ExecutorService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadPoolDemo1 {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ExecutorService pool = Executors.<span style="color:#007f7f">newFixedThreadPool</span>(<span style="color:#ff0;font-weight:bold">2</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºå®ç°äº†Runnableæ¥å£å¯¹è±¡ï¼ŒThreadå¯¹è±¡å½“ç„¶ä¹Ÿå®ç°äº†Runnableæ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Thread ta = <span style="color:#fff;font-weight:bold">new</span> MyThread();
</span></span><span style="display:flex;"><span>        Thread tb = <span style="color:#fff;font-weight:bold">new</span> MyThread();
</span></span><span style="display:flex;"><span>        Thread tc = <span style="color:#fff;font-weight:bold">new</span> MyThread();
</span></span><span style="display:flex;"><span>        Thread td = <span style="color:#fff;font-weight:bold">new</span> MyThread();
</span></span><span style="display:flex;"><span>        Thread te = <span style="color:#fff;font-weight:bold">new</span> MyThread();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†çº¿ç¨‹æ”¾å…¥æ± ä¸­è¿›è¡Œæ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">execute</span>(ta);
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">execute</span>(tb);
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">execute</span>(tc);
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">execute</span>(td);
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">execute</span>(te);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> MyThread <span style="color:#fff;font-weight:bold">extends</span> Thread {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+ <span style="color:#0ff;font-weight:bold">&#34; is running.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœ
pool-1-thread-1 is running.
pool-1-thread-2 is running.
pool-1-thread-1 is running.
pool-1-thread-2 is running.
pool-1-thread-1 is running.</p>
<p>ç»“æœè¯´æ˜ï¼š
ä¸»çº¿ç¨‹ä¸­åˆ›å»ºäº†çº¿ç¨‹æ± poolï¼Œçº¿ç¨‹æ± çš„å®¹é‡æ˜¯2ã€‚å³ï¼Œçº¿ç¨‹æ± ä¸­æœ€å¤šèƒ½åŒæ—¶è¿è¡Œ2ä¸ªçº¿ç¨‹ã€‚
ç´§æ¥ç€ï¼Œå°†taã€tbã€tcã€tdã€teè¿™5ä¸ªçº¿ç¨‹æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­è¿è¡Œã€‚
æœ€åï¼Œé€šè¿‡shutdown()å…³é—­çº¿ç¨‹æ± ã€‚</p>
<h1 id="çº¿ç¨‹æ± åŸç†">çº¿ç¨‹æ± åŸç†<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± åŸç†">#</a></h1>
<h2 id="threadpoolexecutor-1">ThreadPoolExecutor<a hidden class="anchor" aria-hidden="true" href="#threadpoolexecutor-1">#</a></h2>
<p>ThreadPoolExecutoræ˜¯çº¿ç¨‹æ± ç±»ã€‚å¯¹äºçº¿ç¨‹æ± ï¼Œå¯ä»¥é€šä¿—çš„å°†å®ƒç†è§£ä¸º<code>å­˜æ”¾ä¸€å®šæ•°é‡çº¿ç¨‹çš„ä¸€ä¸ªçº¿ç¨‹é›†åˆ</code>ã€‚
çº¿ç¨‹æ± å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå…è®¸åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°±æ˜¯çº¿ç¨‹æ± çš„å®¹é‡ï¼›å½“æ·»åŠ çš„åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¶…è¿‡å®ƒçš„å®¹é‡æ—¶ï¼Œä¼šæœ‰ä¸€éƒ¨åˆ†çº¿ç¨‹é˜»å¡ç­‰å¾…ã€‚
çº¿ç¨‹æ± ä¼šé€šè¿‡ç›¸åº”çš„è°ƒåº¦ç­–ç•¥å’Œæ‹’ç»ç­–ç•¥ï¼Œå¯¹æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¿›è¡Œç®¡ç†ã€‚</p>
<p>ThreadPoolExecutorçš„æ•°æ®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img loading="lazy" src="2.jpg" alt=""  />
</p>
<p>å„ä¸ªæ•°æ®åœ¨ThreadPoolExecutor.javaä¸­çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// é˜»å¡é˜Ÿåˆ—ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> BlockingQueue&lt;Runnable&gt; workQueue;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// äº’æ–¥é”
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> ReentrantLock mainLock = <span style="color:#fff;font-weight:bold">new</span> ReentrantLock();
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// çº¿ç¨‹é›†åˆã€‚ä¸€ä¸ªWorkerå¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> HashSet&lt;Worker&gt; workers = <span style="color:#fff;font-weight:bold">new</span> HashSet&lt;Worker&gt;();
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// â€œç»ˆæ­¢æ¡ä»¶â€ï¼Œä¸â€œmainLockâ€ç»‘å®šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> Condition termination = mainLock.<span style="color:#007f7f">newCondition</span>();
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡æ›¾ç»è¾¾åˆ°è¿‡çš„æœ€å¤§å€¼ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> largestPoolSize;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// å·²å®Œæˆä»»åŠ¡æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">long</span> completedTaskCount;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ThreadFactoryå¯¹è±¡ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> ThreadFactory threadFactory;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ‹’ç»ç­–ç•¥çš„å¤„ç†å¥æŸ„ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> RejectedExecutionHandler handler;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä¿æŒçº¿ç¨‹å­˜æ´»æ—¶é—´ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> <span style="color:#fff;font-weight:bold">long</span> keepAliveTime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> <span style="color:#fff;font-weight:bold">boolean</span> allowCoreThreadTimeOut;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ ¸å¿ƒæ± å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> <span style="color:#fff;font-weight:bold">int</span> corePoolSize;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æœ€å¤§æ± å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> <span style="color:#fff;font-weight:bold">int</span> maximumPoolSize;
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>workers
workersæ˜¯<code>HashSet&lt;Work&gt;</code>ç±»å‹ï¼Œå³å®ƒæ˜¯ä¸€ä¸ªWorkeré›†åˆã€‚è€Œä¸€ä¸ªWorkerå¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ± é€šè¿‡workersåŒ…å«äº†&quot;ä¸€ä¸ªçº¿ç¨‹é›†åˆ&rdquo;ã€‚å½“Workerå¯¹åº”çš„çº¿ç¨‹æ± å¯åŠ¨æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡ï¼›å½“æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡åï¼Œå®ƒä¼šä»çº¿ç¨‹æ± çš„é˜»å¡é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªé˜»å¡çš„ä»»åŠ¡æ¥ç»§ç»­è¿è¡Œã€‚
wokersçš„ä½œç”¨æ˜¯ï¼Œçº¿ç¨‹æ± é€šè¿‡å®ƒå®ç°äº†&quot;å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ&quot;ã€‚</p>
</li>
<li>
<p>workQueue
workQueueæ˜¯BlockingQueueç±»å‹ï¼Œå³å®ƒæ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è¶…è¿‡å®ƒçš„å®¹é‡çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—è¿›è¡Œé˜»å¡ç­‰å¾…ã€‚
é€šè¿‡workQueueï¼Œçº¿ç¨‹æ± å®ç°äº†é˜»å¡åŠŸèƒ½ã€‚</p>
</li>
<li>
<p>mainLock
mainLockæ˜¯äº’æ–¥é”ï¼Œé€šè¿‡mainLockå®ç°äº†å¯¹çº¿ç¨‹æ± çš„äº’æ–¥è®¿é—®ã€‚</p>
</li>
<li>
<p>corePoolSizeå’ŒmaximumPoolSize
corePoolSizeæ˜¯&quot;æ ¸å¿ƒæ± å¤§å°&quot;ï¼ŒmaximumPoolSizeæ˜¯&quot;æœ€å¤§æ± å¤§å°&quot;ã€‚å®ƒä»¬çš„ä½œç”¨æ˜¯è°ƒæ•´&quot;çº¿ç¨‹æ± ä¸­å®é™…è¿è¡Œçš„çº¿ç¨‹çš„æ•°é‡&quot;ã€‚
ä¾‹å¦‚ï¼Œå½“æ–°ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± æ—¶(é€šè¿‡executeæ–¹æ³•)ã€‚
å¦‚æœæ­¤æ—¶ï¼Œçº¿ç¨‹æ± ä¸­è¿è¡Œçš„çº¿ç¨‹æ•°é‡&lt; corePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚
å¦‚æœæ­¤æ—¶ï¼Œçº¿ç¨‹æ± ä¸­è¿è¡Œçš„çº¿ç¨‹æ•°é‡&gt; corePoolSizeï¼Œä½†æ˜¯å´&lt; maximumPoolSizeï¼›åˆ™ä»…å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶æ‰åˆ›å»ºæ–°çº¿ç¨‹ã€‚
å¦‚æœè®¾ç½®çš„ corePoolSize å’Œ maximumPoolSize ç›¸åŒï¼Œåˆ™åˆ›å»ºäº†å›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚å¦‚æœå°† maximumPoolSize è®¾ç½®ä¸ºåŸºæœ¬çš„æ— ç•Œå€¼ï¼ˆå¦‚ Integer.MAX_VALUEï¼‰ï¼Œåˆ™å…è®¸æ± é€‚åº”ä»»æ„æ•°é‡çš„å¹¶å‘ä»»åŠ¡ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ ¸å¿ƒæ± å¤§å°å’Œæœ€å¤§æ± å¤§å°çš„å€¼æ˜¯åœ¨åˆ›å»ºçº¿ç¨‹æ± è®¾ç½®çš„ï¼›ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ setCorePoolSize(int) å’Œ setMaximumPoolSize(int) è¿›è¡ŒåŠ¨æ€æ›´æ”¹ã€‚</p>
</li>
<li>
<p>poolSize
poolSizeæ˜¯å½“å‰çº¿ç¨‹æ± çš„å®é™…å¤§å°ï¼Œå³çº¿ç¨‹æ± ä¸­ä»»åŠ¡çš„æ•°é‡ã€‚</p>
</li>
<li>
<p>allowCoreThreadTimeOutå’ŒkeepAliveTime
allowCoreThreadTimeOutè¡¨ç¤ºæ˜¯å¦å…è®¸&quot;çº¿ç¨‹åœ¨ç©ºé—²çŠ¶æ€æ—¶ï¼Œä»ç„¶èƒ½å¤Ÿå­˜æ´»&quot;ï¼›è€ŒkeepAliveTimeæ˜¯å½“çº¿ç¨‹æ± å¤„äºç©ºé—²çŠ¶æ€çš„æ—¶å€™ï¼Œè¶…è¿‡keepAliveTimeæ—¶é—´ä¹‹åï¼Œç©ºé—²çš„çº¿ç¨‹ä¼šè¢«ç»ˆæ­¢ã€‚</p>
</li>
<li>
<p>threadFactory
threadFactoryæ˜¯ThreadFactoryå¯¹è±¡ã€‚å®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹å·¥å‚ç±»ï¼Œ&ldquo;çº¿ç¨‹æ± é€šè¿‡ThreadFactoryåˆ›å»ºçº¿ç¨‹&rdquo;ã€‚</p>
</li>
<li>
<p>handler
handleræ˜¯RejectedExecutionHandlerç±»å‹ã€‚å®ƒæ˜¯&quot;çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥&quot;çš„å¥æŸ„ï¼Œä¹Ÿå°±æ˜¯è¯´&quot;å½“æŸä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ï¼Œè€Œçº¿ç¨‹æ± æ‹’ç»è¯¥ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šé€šè¿‡handlerè¿›è¡Œç›¸åº”çš„å¤„ç†&quot;ã€‚</p>
</li>
</ul>
<p>ç»¼ä¸Šæ‰€è¯´ï¼Œçº¿ç¨‹æ± é€šè¿‡workersæ¥ç®¡ç†&quot;çº¿ç¨‹é›†åˆ&quot;ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨å¯åŠ¨åï¼Œä¼šæ‰§è¡Œçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡ï¼›å½“ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œåï¼Œå®ƒä¼šä»çº¿ç¨‹æ± çš„é˜»å¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥ç»§ç»­è¿è¡Œã€‚
é˜»å¡é˜Ÿåˆ—æ˜¯ç®¡ç†çº¿ç¨‹æ± ä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œå½“æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡è¶…è¿‡çº¿ç¨‹æ± çš„å®¹é‡æ—¶ï¼Œè¯¥ä»»åŠ¡å°±ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—è¿›è¡Œç­‰å¾…ã€‚</p>
<h2 id="çº¿ç¨‹æ± è°ƒåº¦">çº¿ç¨‹æ± è°ƒåº¦<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± è°ƒåº¦">#</a></h2>
<p>æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„å›¾çœ‹çœ‹ä¸‹é¢çº¿ç¨‹æ± ä¸­ä»»åŠ¡çš„è°ƒåº¦ç­–ç•¥ï¼ŒåŠ æ·±å¯¹çº¿ç¨‹æ± çš„ç†è§£ã€‚
å›¾01
<img loading="lazy" src="3.jpg" alt=""  />
</p>
<p>å›¾02
<img loading="lazy" src="4.jpg" alt=""  />
</p>
<p>è¯´æ˜ï¼š
åœ¨&quot;å›¾-01&quot;ä¸­ï¼Œçº¿ç¨‹æ± ä¸­æœ‰Nä¸ªä»»åŠ¡ã€‚&ldquo;ä»»åŠ¡1&rdquo;, &ldquo;ä»»åŠ¡2&rdquo;, &ldquo;ä»»åŠ¡3&quot;è¿™3ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œè€Œ&quot;ä»»åŠ¡4&quot;åˆ°&quot;ä»»åŠ¡N&quot;åœ¨é˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚
æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œåœ¨workersé›†åˆä¸­ï¼Œworkersé›†åˆåŒ…å«3ä¸ªWorkerï¼Œæ¯ä¸€ä¸ªWorkerå¯¹åº”ä¸€ä¸ªThreadçº¿ç¨‹ï¼ŒThreadçº¿ç¨‹æ¯æ¬¡å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚
å½“workersé›†åˆä¸­å¤„ç†å®ŒæŸä¸€ä¸ªä»»åŠ¡ä¹‹åï¼Œä¼šä»é˜»å¡é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªä»»åŠ¡æ¥ç»§ç»­æ‰§è¡Œï¼Œå¦‚å›¾-02æ‰€ç¤ºã€‚
å›¾-02è¡¨ç¤º&quot;ä»»åŠ¡1&quot;å¤„ç†å®Œæ¯•ä¹‹åï¼Œçº¿ç¨‹æ± å°†&quot;ä»»åŠ¡4&quot;ä»é˜»å¡é˜Ÿåˆ—ä¸­å–å‡ºï¼Œæ”¾åˆ°workersä¸­è¿›è¡Œå¤„ç†ã€‚</p>
<h2 id="çº¿ç¨‹æ± ç¤ºä¾‹-1">çº¿ç¨‹æ± ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± ç¤ºä¾‹-1">#</a></h2>
<p>åœ¨åˆ†æçº¿ç¨‹æ± ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± ç¤ºä¾‹ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.Executors;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ExecutorService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadPoolDemo1 {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ExecutorService pool = Executors.<span style="color:#007f7f">newFixedThreadPool</span>(<span style="color:#ff0;font-weight:bold">2</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºå®ç°äº†Runnableæ¥å£å¯¹è±¡ï¼ŒThreadå¯¹è±¡å½“ç„¶ä¹Ÿå®ç°äº†Runnableæ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Thread ta = <span style="color:#fff;font-weight:bold">new</span> MyThread();
</span></span><span style="display:flex;"><span>        Thread tb = <span style="color:#fff;font-weight:bold">new</span> MyThread();
</span></span><span style="display:flex;"><span>        Thread tc = <span style="color:#fff;font-weight:bold">new</span> MyThread();
</span></span><span style="display:flex;"><span>        Thread td = <span style="color:#fff;font-weight:bold">new</span> MyThread();
</span></span><span style="display:flex;"><span>        Thread te = <span style="color:#fff;font-weight:bold">new</span> MyThread();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†çº¿ç¨‹æ”¾å…¥æ± ä¸­è¿›è¡Œæ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">execute</span>(ta);
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">execute</span>(tb);
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">execute</span>(tc);
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">execute</span>(td);
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">execute</span>(te);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> MyThread <span style="color:#fff;font-weight:bold">extends</span> Thread {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+ <span style="color:#0ff;font-weight:bold">&#34; is running.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœï¼š
pool-1-thread-1 is running.
pool-1-thread-2 is running.
pool-1-thread-1 is running.
pool-1-thread-2 is running.
pool-1-thread-1 is running.
ç¤ºä¾‹ä¸­ï¼ŒåŒ…æ‹¬äº†çº¿ç¨‹æ± çš„åˆ›å»ºï¼Œå°†ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ï¼Œå…³é—­çº¿ç¨‹æ± è¿™3ä¸ªä¸»è¦çš„æ­¥éª¤ã€‚ç¨åï¼Œæˆ‘ä»¬ä¼šä»è¿™3ä¸ªæ–¹é¢æ¥åˆ†æThreadPoolExecutorã€‚</p>
<h2 id="executorså’Œthreadpoolexecutorå®Œæ•´æºç ">Executorså’ŒThreadPoolExecutorå®Œæ•´æºç <a hidden class="anchor" aria-hidden="true" href="#executorså’Œthreadpoolexecutorå®Œæ•´æºç ">#</a></h2>
<p>å‚è€ƒjdk
<code>Executors</code>
<code>ThreadPoolExecutor</code></p>
<h2 id="çº¿ç¨‹æ± æºç åˆ†æ">çº¿ç¨‹æ± æºç åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± æºç åˆ†æ">#</a></h2>
<h3 id="åˆ›å»ºçº¿ç¨‹æ± ">åˆ›å»ºâ€œçº¿ç¨‹æ± â€<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»ºçº¿ç¨‹æ± ">#</a></h3>
<p>ä¸‹é¢ä»¥newFixedThreadPool()ä»‹ç»çº¿ç¨‹æ± çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p>
<h4 id="newfixedthreadpool">newFixedThreadPool()<a hidden class="anchor" aria-hidden="true" href="#newfixedthreadpool">#</a></h4>
<p>newFixedThreadPool()åœ¨Executors.javaä¸­å®šä¹‰ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ExecutorService newFixedThreadPool(<span style="color:#fff;font-weight:bold">int</span> nThreads) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(nThreads, nThreads,
</span></span><span style="display:flex;"><span>                                  <span style="color:#ff0;font-weight:bold">0</span>L, TimeUnit.<span style="color:#007f7f">MILLISECONDS</span>,
</span></span><span style="display:flex;"><span>                                  <span style="color:#fff;font-weight:bold">new</span> LinkedBlockingQueue&lt;Runnable&gt;());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼šnewFixedThreadPool(int nThreads)çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çš„å®¹é‡æ˜¯nThreadsã€‚
newFixedThreadPool()åœ¨è°ƒç”¨ThreadPoolExecutor()æ—¶ï¼Œä¼šä¼ é€’ä¸€ä¸ªLinkedBlockingQueue()å¯¹è±¡ï¼Œè€ŒLinkedBlockingQueueæ˜¯å•å‘é“¾è¡¨å®ç°çš„é˜»å¡é˜Ÿåˆ—ã€‚
åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå°±æ˜¯é€šè¿‡è¯¥é˜»å¡é˜Ÿåˆ—æ¥å®ç°&quot;å½“çº¿ç¨‹æ± ä¸­ä»»åŠ¡æ•°é‡è¶…è¿‡å…è®¸çš„ä»»åŠ¡æ•°é‡æ—¶ï¼Œéƒ¨åˆ†ä»»åŠ¡ä¼šé˜»å¡ç­‰å¾…&rdquo;ã€‚</p>
<h4 id="threadpoolexecutor-2">ThreadPoolExecutor()<a hidden class="anchor" aria-hidden="true" href="#threadpoolexecutor-2">#</a></h4>
<p>ThreadPoolExecutor()åœ¨ThreadPoolExecutor.javaä¸­å®šä¹‰ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize,
</span></span><span style="display:flex;"><span>                          <span style="color:#fff;font-weight:bold">int</span> maximumPoolSize,
</span></span><span style="display:flex;"><span>                          <span style="color:#fff;font-weight:bold">long</span> keepAliveTime,
</span></span><span style="display:flex;"><span>                          TimeUnit unit,
</span></span><span style="display:flex;"><span>                          BlockingQueue&lt;Runnable&gt; workQueue) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,
</span></span><span style="display:flex;"><span>         Executors.<span style="color:#007f7f">defaultThreadFactory</span>(), defaultHandler);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼šè¯¥å‡½æ•°å®é™…ä¸Šæ˜¯è°ƒç”¨ThreadPoolExecutorçš„å¦å¤–ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚è¯¥å‡½æ•°çš„æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize,
</span></span><span style="display:flex;"><span>                          <span style="color:#fff;font-weight:bold">int</span> maximumPoolSize,
</span></span><span style="display:flex;"><span>                          <span style="color:#fff;font-weight:bold">long</span> keepAliveTime,
</span></span><span style="display:flex;"><span>                          TimeUnit unit,
</span></span><span style="display:flex;"><span>                          BlockingQueue&lt;Runnable&gt; workQueue,
</span></span><span style="display:flex;"><span>                          ThreadFactory threadFactory,
</span></span><span style="display:flex;"><span>                          RejectedExecutionHandler handler) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (corePoolSize &lt; <span style="color:#ff0;font-weight:bold">0</span> ||
</span></span><span style="display:flex;"><span>        maximumPoolSize &lt;= <span style="color:#ff0;font-weight:bold">0</span> ||
</span></span><span style="display:flex;"><span>        maximumPoolSize &lt; corePoolSize ||
</span></span><span style="display:flex;"><span>        keepAliveTime &lt; <span style="color:#ff0;font-weight:bold">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalArgumentException();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (workQueue == <span style="color:#fff;font-weight:bold">null</span> || threadFactory == <span style="color:#fff;font-weight:bold">null</span> || handler == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> NullPointerException();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ ¸å¿ƒæ± å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">corePoolSize</span> = corePoolSize;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æœ€å¤§æ± å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">maximumPoolSize</span> = maximumPoolSize;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// çº¿ç¨‹æ± çš„ç­‰å¾…é˜Ÿåˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">workQueue</span> = workQueue;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">keepAliveTime</span> = unit.<span style="color:#007f7f">toNanos</span>(keepAliveTime);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// çº¿ç¨‹å·¥å‚å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">threadFactory</span> = threadFactory;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ‹’ç»ç­–ç•¥çš„å¥æŸ„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">handler</span> = handler;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼šåœ¨ThreadPoolExecutor()çš„æ„é€ å‡½æ•°ä¸­ï¼Œè¿›è¡Œçš„æ˜¯åˆå§‹åŒ–å·¥ä½œã€‚
corePoolSizeã€maximumPoolSizeã€unitã€keepAliveTimeå’ŒworkQueueè¿™äº›å˜é‡çš„å€¼æ˜¯å·²çŸ¥çš„ï¼Œå®ƒä»¬éƒ½æ˜¯é€šè¿‡newFixedThreadPool()ä¼ é€’è€Œæ¥ã€‚ä¸‹é¢çœ‹çœ‹threadFactoryå’Œhandlerå¯¹è±¡ã€‚</p>
<h4 id="threadfactory">ThreadFactory<a hidden class="anchor" aria-hidden="true" href="#threadfactory">#</a></h4>
<p>çº¿ç¨‹æ± ä¸­çš„ThreadFactoryæ˜¯ä¸€ä¸ªçº¿ç¨‹å·¥å‚ï¼Œçº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹éƒ½æ˜¯é€šè¿‡çº¿ç¨‹å·¥å‚å¯¹è±¡(threadFactory)æ¥å®Œæˆçš„ã€‚
ä¸Šé¢æ‰€è¯´çš„threadFactoryå¯¹è±¡ï¼Œæ˜¯é€šè¿‡ Executors.defaultThreadFactory()è¿”å›çš„ã€‚Executors.javaä¸­çš„defaultThreadFactory()æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ThreadFactory defaultThreadFactory() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> DefaultThreadFactory();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>defaultThreadFactory()è¿”å›DefaultThreadFactoryå¯¹è±¡ã€‚Executors.javaä¸­çš„DefaultThreadFactory()æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> DefaultThreadFactory <span style="color:#fff;font-weight:bold">implements</span> ThreadFactory {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> AtomicInteger poolNumber = <span style="color:#fff;font-weight:bold">new</span> AtomicInteger(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> ThreadGroup group;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> AtomicInteger threadNumber = <span style="color:#fff;font-weight:bold">new</span> AtomicInteger(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> String namePrefix;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    DefaultThreadFactory() {
</span></span><span style="display:flex;"><span>        SecurityManager s = System.<span style="color:#007f7f">getSecurityManager</span>();
</span></span><span style="display:flex;"><span>        group = (s != <span style="color:#fff;font-weight:bold">null</span>) ? s.<span style="color:#007f7f">getThreadGroup</span>() :
</span></span><span style="display:flex;"><span>                              Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getThreadGroup</span>();
</span></span><span style="display:flex;"><span>        namePrefix = <span style="color:#0ff;font-weight:bold">&#34;pool-&#34;</span> +
</span></span><span style="display:flex;"><span>                      poolNumber.<span style="color:#007f7f">getAndIncrement</span>() +
</span></span><span style="display:flex;"><span>                     <span style="color:#0ff;font-weight:bold">&#34;-thread-&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æä¾›åˆ›å»ºçº¿ç¨‹çš„APIã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">public</span> Thread newThread(Runnable r) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// çº¿ç¨‹å¯¹åº”çš„ä»»åŠ¡æ˜¯Runnableå¯¹è±¡r
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Thread t = <span style="color:#fff;font-weight:bold">new</span> Thread(group, r,
</span></span><span style="display:flex;"><span>                              namePrefix + threadNumber.<span style="color:#007f7f">getAndIncrement</span>(),
</span></span><span style="display:flex;"><span>                              <span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ä¸ºâ€œéå®ˆæŠ¤çº¿ç¨‹â€
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">if</span> (t.<span style="color:#007f7f">isDaemon</span>())
</span></span><span style="display:flex;"><span>            t.<span style="color:#007f7f">setDaemon</span>(<span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†ä¼˜å…ˆçº§è®¾ä¸ºâ€œThread.NORM_PRIORITYâ€
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">if</span> (t.<span style="color:#007f7f">getPriority</span>() != Thread.<span style="color:#007f7f">NORM_PRIORITY</span>)
</span></span><span style="display:flex;"><span>            t.<span style="color:#007f7f">setPriority</span>(Thread.<span style="color:#007f7f">NORM_PRIORITY</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼šThreadFactoryçš„ä½œç”¨å°±æ˜¯æä¾›åˆ›å»ºçº¿ç¨‹çš„åŠŸèƒ½çš„çº¿ç¨‹å·¥å‚ã€‚
å®ƒæ˜¯é€šè¿‡newThread()æä¾›åˆ›å»ºçº¿ç¨‹åŠŸèƒ½çš„ï¼Œä¸‹é¢ç®€å•è¯´è¯´newThread()ã€‚newThread()åˆ›å»ºçš„çº¿ç¨‹å¯¹åº”çš„ä»»åŠ¡æ˜¯Runnableå¯¹è±¡ï¼Œå®ƒåˆ›å»ºçš„çº¿ç¨‹éƒ½æ˜¯â€œéå®ˆæŠ¤çº¿ç¨‹â€è€Œä¸”â€œçº¿ç¨‹ä¼˜å…ˆçº§éƒ½æ˜¯Thread.NORM_PRIORITYâ€ã€‚</p>
<h4 id="rejectedexecutionhandler">RejectedExecutionHandler<a hidden class="anchor" aria-hidden="true" href="#rejectedexecutionhandler">#</a></h4>
<p>handleræ˜¯ThreadPoolExecutorä¸­æ‹’ç»ç­–ç•¥çš„å¤„ç†å¥æŸ„ã€‚æ‰€è°“æ‹’ç»ç­–ç•¥ï¼Œæ˜¯æŒ‡å°†ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­æ—¶ï¼Œçº¿ç¨‹æ± æ‹’ç»è¯¥ä»»åŠ¡æ‰€é‡‡å–çš„ç›¸åº”ç­–ç•¥ã€‚
çº¿ç¨‹æ± é»˜è®¤ä¼šé‡‡ç”¨çš„æ˜¯defaultHandlerç­–ç•¥ï¼Œå³AbortPolicyç­–ç•¥ã€‚åœ¨AbortPolicyç­–ç•¥ä¸­ï¼Œçº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼
defaultHandlerçš„å®šä¹‰å¦‚ä¸‹ï¼š
<code>private static final RejectedExecutionHandler defaultHandler = new AbortPolicy();</code></p>
<p>AbortPolicyçš„æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> AbortPolicy <span style="color:#fff;font-weight:bold">implements</span> RejectedExecutionHandler {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> AbortPolicy() { }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œæ²¡åˆ«çš„ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> rejectedExecution(Runnable r, ThreadPoolExecutor e) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RejectedExecutionException(<span style="color:#0ff;font-weight:bold">&#34;Task &#34;</span> + r.<span style="color:#007f7f">toString</span>() +
</span></span><span style="display:flex;"><span>                                             <span style="color:#0ff;font-weight:bold">&#34; rejected from &#34;</span> +
</span></span><span style="display:flex;"><span>                                             e.<span style="color:#007f7f">toString</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ·»åŠ ä»»åŠ¡åˆ°çº¿ç¨‹æ± ">æ·»åŠ ä»»åŠ¡åˆ°â€œçº¿ç¨‹æ± â€<a hidden class="anchor" aria-hidden="true" href="#æ·»åŠ ä»»åŠ¡åˆ°çº¿ç¨‹æ± ">#</a></h3>
<h4 id="execute">execute()<a hidden class="anchor" aria-hidden="true" href="#execute">#</a></h4>
<p>execute()å®šä¹‰åœ¨ThreadPoolExecutor.javaä¸­ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> execute(Runnable command) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœä»»åŠ¡ä¸ºnullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (command == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> NullPointerException();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è·å–ctlå¯¹åº”çš„intå€¼ã€‚è¯¥intå€¼ä¿å­˜äº†&#34;çº¿ç¨‹æ± ä¸­ä»»åŠ¡çš„æ•°é‡&#34;å’Œ&#34;çº¿ç¨‹æ± çŠ¶æ€&#34;ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">int</span> c = ctl.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å½“çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ•°é‡ &lt; &#34;æ ¸å¿ƒæ± å¤§å°&#34;æ—¶ï¼Œå³çº¿ç¨‹æ± ä¸­å°‘äºcorePoolSizeä¸ªä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// åˆ™é€šè¿‡addWorker(command, true)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (workerCountOf(c) &lt; corePoolSize) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (addWorker(command, <span style="color:#fff;font-weight:bold">true</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        c = ctl.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å½“çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ•°é‡ &gt;= &#34;æ ¸å¿ƒæ± å¤§å°&#34;æ—¶ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// è€Œä¸”ï¼Œ&#34;çº¿ç¨‹æ± å¤„äºå…è®¸çŠ¶æ€&#34;æ—¶ï¼Œåˆ™å°è¯•å°†ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (isRunning(c) &amp;&amp; workQueue.<span style="color:#007f7f">offer</span>(command)) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å†æ¬¡ç¡®è®¤â€œçº¿ç¨‹æ± çŠ¶æ€â€ï¼Œè‹¥çº¿ç¨‹æ± å¼‚å¸¸ç»ˆæ­¢äº†ï¼Œåˆ™åˆ é™¤ä»»åŠ¡ï¼›ç„¶åé€šè¿‡reject()æ‰§è¡Œç›¸åº”çš„æ‹’ç»ç­–ç•¥çš„å†…å®¹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">int</span> recheck = ctl.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (! isRunning(recheck) &amp;&amp; remove(command))
</span></span><span style="display:flex;"><span>            reject(command);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¦åˆ™ï¼Œå¦‚æœ&#34;çº¿ç¨‹æ± ä¸­ä»»åŠ¡æ•°é‡&#34;ä¸º0ï¼Œåˆ™é€šè¿‡addWorker(null, false)å°è¯•æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œæ–°å»ºçº¿ç¨‹å¯¹åº”çš„ä»»åŠ¡ä¸ºnullã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (workerCountOf(recheck) == <span style="color:#ff0;font-weight:bold">0</span>)
</span></span><span style="display:flex;"><span>            addWorker(<span style="color:#fff;font-weight:bold">null</span>, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// é€šè¿‡addWorker(command, false)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// å¦‚æœaddWorker(command, false)æ‰§è¡Œå¤±è´¥ï¼Œåˆ™é€šè¿‡reject()æ‰§è¡Œç›¸åº”çš„æ‹’ç»ç­–ç•¥çš„å†…å®¹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (!addWorker(command, <span style="color:#fff;font-weight:bold">false</span>))
</span></span><span style="display:flex;"><span>        reject(command);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼šexecute()çš„ä½œç”¨æ˜¯å°†ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚å®ƒä¼šåˆ†ä¸º3ç§æƒ…å†µè¿›è¡Œå¤„ç†ï¼š</p>
<ul>
<li>æƒ…å†µ1 &ndash; å¦‚æœ&quot;çº¿ç¨‹æ± ä¸­ä»»åŠ¡æ•°é‡&quot; &lt; &ldquo;æ ¸å¿ƒæ± å¤§å°&quot;æ—¶ï¼Œå³çº¿ç¨‹æ± ä¸­å°‘äºcorePoolSizeä¸ªä»»åŠ¡ï¼›æ­¤æ—¶å°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†è¯¥ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹ä¸­è¿›è¡Œæ‰§è¡Œã€‚</li>
<li>æƒ…å†µ2 &ndash; å¦‚æœ&quot;çº¿ç¨‹æ± ä¸­ä»»åŠ¡æ•°é‡&rdquo; &gt;= &ldquo;æ ¸å¿ƒæ± å¤§å°&rdquo;ï¼Œå¹¶ä¸”&quot;çº¿ç¨‹æ± æ˜¯å…è®¸çŠ¶æ€&quot;ï¼›æ­¤æ—¶ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­é˜»å¡ç­‰å¾…ã€‚åœ¨è¯¥æƒ…å†µä¸‹ï¼Œä¼šå†æ¬¡ç¡®è®¤&quot;çº¿ç¨‹æ± çš„çŠ¶æ€&quot;ï¼Œå¦‚æœ&quot;ç¬¬2æ¬¡è¯»åˆ°çš„çº¿ç¨‹æ± çŠ¶æ€&quot;å’Œ&quot;ç¬¬1æ¬¡è¯»åˆ°çš„çº¿ç¨‹æ± çŠ¶æ€&quot;ä¸åŒï¼Œåˆ™ä»é˜»å¡é˜Ÿåˆ—ä¸­åˆ é™¤è¯¥ä»»åŠ¡ã€‚</li>
<li>æƒ…å†µ3 &ndash; éä»¥ä¸Šä¸¤ç§æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°è¯•æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†è¯¥ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹ä¸­è¿›è¡Œæ‰§è¡Œã€‚å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œåˆ™é€šè¿‡reject()æ‹’ç»è¯¥ä»»åŠ¡ã€‚</li>
</ul>
<h4 id="addworker">addWorker()<a hidden class="anchor" aria-hidden="true" href="#addworker">#</a></h4>
<p>addWorker()çš„æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">boolean</span> addWorker(Runnable firstTask, <span style="color:#fff;font-weight:bold">boolean</span> core) {
</span></span><span style="display:flex;"><span>    retry:
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ›´æ–°&#34;çº¿ç¨‹æ± çŠ¶æ€å’Œè®¡æ•°&#34;æ ‡è®°ï¼Œå³æ›´æ–°ctlã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–ctlå¯¹åº”çš„intå€¼ã€‚è¯¥intå€¼ä¿å­˜äº†&#34;çº¿ç¨‹æ± ä¸­ä»»åŠ¡çš„æ•°é‡&#34;å’Œ&#34;çº¿ç¨‹æ± çŠ¶æ€&#34;ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">int</span> c = ctl.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–çº¿ç¨‹æ± çŠ¶æ€ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">int</span> rs = runStateOf(c);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æœ‰æ•ˆæ€§æ£€æŸ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">if</span> (rs &gt;= SHUTDOWN &amp;&amp;
</span></span><span style="display:flex;"><span>            ! (rs == SHUTDOWN &amp;&amp;
</span></span><span style="display:flex;"><span>               firstTask == <span style="color:#fff;font-weight:bold">null</span> &amp;&amp;
</span></span><span style="display:flex;"><span>               ! workQueue.<span style="color:#007f7f">isEmpty</span>()))
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è·å–çº¿ç¨‹æ± ä¸­ä»»åŠ¡çš„æ•°é‡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">int</span> wc = workerCountOf(c);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¦‚æœ&#34;çº¿ç¨‹æ± ä¸­ä»»åŠ¡çš„æ•°é‡&#34;è¶…è¿‡é™åˆ¶ï¼Œåˆ™è¿”å›falseã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (wc &gt;= CAPACITY ||
</span></span><span style="display:flex;"><span>                wc &gt;= (core ? corePoolSize : maximumPoolSize))
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// é€šè¿‡CASå‡½æ•°å°†cçš„å€¼+1ã€‚æ“ä½œå¤±è´¥çš„è¯ï¼Œåˆ™é€€å‡ºå¾ªç¯ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (compareAndIncrementWorkerCount(c))
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span> retry;
</span></span><span style="display:flex;"><span>            c = ctl.<span style="color:#007f7f">get</span>();  <span style="color:#007f7f">// Re-read ctl
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#007f7f">// æ£€æŸ¥&#34;çº¿ç¨‹æ± çŠ¶æ€&#34;ï¼Œå¦‚æœä¸ä¹‹å‰çš„çŠ¶æ€ä¸åŒï¼Œåˆ™ä»retryé‡æ–°å¼€å§‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (runStateOf(c) != rs)
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">continue</span> retry;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// else CAS failed due to workerCount change; retry inner loop
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> workerStarted = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">boolean</span> workerAdded = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>    Worker w = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ·»åŠ ä»»åŠ¡åˆ°çº¿ç¨‹æ± ï¼Œå¹¶å¯åŠ¨ä»»åŠ¡æ‰€åœ¨çš„çº¿ç¨‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">final</span> ReentrantLock mainLock = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">mainLock</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ–°å»ºWorkerï¼Œå¹¶ä¸”æŒ‡å®šfirstTaskä¸ºWorkerçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        w = <span style="color:#fff;font-weight:bold">new</span> Worker(firstTask);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è·å–Workerå¯¹åº”çš„çº¿ç¨‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">final</span> Thread t = w.<span style="color:#007f7f">thread</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (t != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è·å–é”
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            mainLock.<span style="color:#007f7f">lock</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">int</span> c = ctl.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">int</span> rs = runStateOf(c);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// å†æ¬¡ç¡®è®¤&#34;çº¿ç¨‹æ± çŠ¶æ€&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                <span style="color:#fff;font-weight:bold">if</span> (rs &lt; SHUTDOWN ||
</span></span><span style="display:flex;"><span>                    (rs == SHUTDOWN &amp;&amp; firstTask == <span style="color:#fff;font-weight:bold">null</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">if</span> (t.<span style="color:#007f7f">isAlive</span>()) <span style="color:#007f7f">// precheck that t is startable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalThreadStateException();
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// å°†Workerå¯¹è±¡(w)æ·»åŠ åˆ°&#34;çº¿ç¨‹æ± çš„Workeré›†åˆ(workers)&#34;ä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                    workers.<span style="color:#007f7f">add</span>(w);
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// æ›´æ–°largestPoolSize
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                    <span style="color:#fff;font-weight:bold">int</span> s = workers.<span style="color:#007f7f">size</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">if</span> (s &gt; largestPoolSize)
</span></span><span style="display:flex;"><span>                        largestPoolSize = s;
</span></span><span style="display:flex;"><span>                    workerAdded = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// é‡Šæ”¾é”
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                mainLock.<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¦‚æœ&#34;æˆåŠŸå°†ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± &#34;ä¸­ï¼Œåˆ™å¯åŠ¨ä»»åŠ¡æ‰€åœ¨çš„çº¿ç¨‹ã€‚ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (workerAdded) {
</span></span><span style="display:flex;"><span>                t.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>                workerStarted = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (! workerStarted)
</span></span><span style="display:flex;"><span>            addWorkerFailed(w);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è¿”å›ä»»åŠ¡æ˜¯å¦å¯åŠ¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">return</span> workerStarted;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼š
addWorker(Runnable firstTask, boolean core) çš„ä½œç”¨æ˜¯å°†ä»»åŠ¡(firstTask)æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ï¼Œå¹¶å¯åŠ¨è¯¥ä»»åŠ¡ã€‚
coreä¸ºtrueçš„è¯ï¼Œåˆ™ä»¥corePoolSizeä¸ºç•Œé™ï¼Œè‹¥&quot;çº¿ç¨‹æ± ä¸­å·²æœ‰ä»»åŠ¡æ•°é‡&gt;=corePoolSize&quot;ï¼Œåˆ™è¿”å›falseï¼›coreä¸ºfalseçš„è¯ï¼Œåˆ™ä»¥maximumPoolSizeä¸ºç•Œé™ï¼Œè‹¥&quot;çº¿ç¨‹æ± ä¸­å·²æœ‰ä»»åŠ¡æ•°é‡&gt;=maximumPoolSize&quot;ï¼Œåˆ™è¿”å›falseã€‚
addWorker()ä¼šå…ˆé€šè¿‡forå¾ªç¯ä¸æ–­å°è¯•æ›´æ–°ctlçŠ¶æ€ï¼Œctlè®°å½•äº†&quot;çº¿ç¨‹æ± ä¸­ä»»åŠ¡æ•°é‡å’Œçº¿ç¨‹æ± çŠ¶æ€&quot;ã€‚
æ›´æ–°æˆåŠŸä¹‹åï¼Œå†é€šè¿‡tryæ¨¡å—æ¥å°†ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ï¼Œå¹¶å¯åŠ¨ä»»åŠ¡æ‰€åœ¨çš„çº¿ç¨‹ã€‚
ä»addWorker()ä¸­ï¼Œæˆ‘ä»¬èƒ½æ¸…æ™°çš„å‘ç°ï¼šçº¿ç¨‹æ± åœ¨æ·»åŠ ä»»åŠ¡æ—¶ï¼Œä¼šåˆ›å»ºä»»åŠ¡å¯¹åº”çš„Workerå¯¹è±¡ï¼›è€Œä¸€ä¸ªWorkderå¯¹è±¡åŒ…å«ä¸€ä¸ªThreadå¯¹è±¡ã€‚(01) é€šè¿‡å°†Workerå¯¹è±¡æ·»åŠ åˆ°&quot;çº¿ç¨‹çš„workersé›†åˆ&quot;ä¸­ï¼Œä»è€Œå®ç°å°†ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ã€‚ (02) é€šè¿‡å¯åŠ¨Workerå¯¹åº”çš„Threadçº¿ç¨‹ï¼Œåˆ™æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚</p>
<h4 id="submit">submit()<a hidden class="anchor" aria-hidden="true" href="#submit">#</a></h4>
<p>è¡¥å……è¯´æ˜ä¸€ç‚¹ï¼Œsubmit()å®é™…ä¸Šä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨execute()å®ç°çš„ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> Future&lt;?&gt; submit(Runnable task) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (task == <span style="color:#fff;font-weight:bold">null</span>) <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> NullPointerException();
</span></span><span style="display:flex;"><span>    RunnableFuture&lt;Void&gt; ftask = newTaskFor(task, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>    execute(ftask);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> ftask;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å…³é—­çº¿ç¨‹æ± -1">å…³é—­â€œçº¿ç¨‹æ± â€<a hidden class="anchor" aria-hidden="true" href="#å…³é—­çº¿ç¨‹æ± -1">#</a></h3>
<p>shutdown()çš„æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> shutdown() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">final</span> ReentrantLock mainLock = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">mainLock</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è·å–é”
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    mainLock.<span style="color:#007f7f">lock</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ£€æŸ¥ç»ˆæ­¢çº¿ç¨‹æ± çš„â€œçº¿ç¨‹â€æ˜¯å¦æœ‰æƒé™ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        checkShutdownAccess();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ç½®çº¿ç¨‹æ± çš„çŠ¶æ€ä¸ºå…³é—­çŠ¶æ€ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        advanceRunState(SHUTDOWN);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä¸­æ–­çº¿ç¨‹æ± ä¸­ç©ºé—²çš„çº¿ç¨‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        interruptIdleWorkers();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// é’©å­å‡½æ•°ï¼Œåœ¨ThreadPoolExecutorä¸­æ²¡æœ‰ä»»ä½•åŠ¨ä½œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        onShutdown(); <span style="color:#007f7f">// hook for ScheduledThreadPoolExecutor
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// é‡Šæ”¾é”
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        mainLock.<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å°è¯•ç»ˆæ­¢çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    tryTerminate();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼šshutdown()çš„ä½œç”¨æ˜¯å…³é—­çº¿ç¨‹æ± ã€‚</p>
<h2 id="çº¿ç¨‹æ± çš„çŠ¶æ€">çº¿ç¨‹æ± çš„çŠ¶æ€<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± çš„çŠ¶æ€">#</a></h2>
<p>çº¿ç¨‹æœ‰5ç§çŠ¶æ€ï¼šæ–°å»ºçŠ¶æ€ï¼Œå°±ç»ªçŠ¶æ€ï¼Œè¿è¡ŒçŠ¶æ€ï¼Œé˜»å¡çŠ¶æ€ï¼Œæ­»äº¡çŠ¶æ€ã€‚
çº¿ç¨‹æ± çš„5ç§çŠ¶æ€æ˜¯ï¼šRunning, shutdown, stop, tidying, terminatedã€‚</p>
<p>ThreadPoolExecutorçº¿ç¨‹æ± çŠ¶æ€å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> AtomicInteger ctl = <span style="color:#fff;font-weight:bold">new</span> AtomicInteger(ctlOf(RUNNING, <span style="color:#ff0;font-weight:bold">0</span>));
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> COUNT_BITS = Integer.<span style="color:#007f7f">SIZE</span> - <span style="color:#ff0;font-weight:bold">3</span>;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> CAPACITY = (<span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; COUNT_BITS) - <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> RUNNING = -<span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; COUNT_BITS;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> SHUTDOWN = <span style="color:#ff0;font-weight:bold">0</span> &lt;&lt; COUNT_BITS;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> STOP = <span style="color:#ff0;font-weight:bold">1</span> &lt;&lt; COUNT_BITS;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> TIDYING = <span style="color:#ff0;font-weight:bold">2</span> &lt;&lt; COUNT_BITS;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> TERMINATED = <span style="color:#ff0;font-weight:bold">3</span> &lt;&lt; COUNT_BITS;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">int</span> ctlOf(<span style="color:#fff;font-weight:bold">int</span> rs, <span style="color:#fff;font-weight:bold">int</span> wc) { <span style="color:#fff;font-weight:bold">return</span> rs | wc; }
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼š
ctlæ˜¯ä¸€ä¸ªAtomicIntegerç±»å‹çš„åŸå­å¯¹è±¡ã€‚ctlè®°å½•äº†&quot;çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ•°é‡&quot;å’Œ&quot;çº¿ç¨‹æ± çŠ¶æ€&quot;2ä¸ªä¿¡æ¯ã€‚
ctlå…±åŒ…æ‹¬32ä½ã€‚å…¶ä¸­ï¼Œé«˜3ä½è¡¨ç¤º&quot;çº¿ç¨‹æ± çŠ¶æ€&quot;ï¼Œä½29ä½è¡¨ç¤º&quot;çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ•°é‡&quot;ã€‚</p>
<p>RUNNING    &ndash; å¯¹åº”çš„é«˜3ä½å€¼æ˜¯111ã€‚
SHUTDOWN   &ndash; å¯¹åº”çš„é«˜3ä½å€¼æ˜¯000ã€‚
STOP       &ndash; å¯¹åº”çš„é«˜3ä½å€¼æ˜¯001ã€‚
TIDYING    &ndash; å¯¹åº”çš„é«˜3ä½å€¼æ˜¯010ã€‚
TERMINATED &ndash; å¯¹åº”çš„é«˜3ä½å€¼æ˜¯011ã€‚
<img loading="lazy" src="5.jpg" alt=""  />
</p>
<ol>
<li>RUNNING
(01) çŠ¶æ€è¯´æ˜ï¼šçº¿ç¨‹æ± å¤„åœ¨RUNNINGçŠ¶æ€æ—¶ï¼Œèƒ½å¤Ÿæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä»¥åŠå¯¹å·²æ·»åŠ çš„ä»»åŠ¡è¿›è¡Œå¤„ç†ã€‚
(02) çŠ¶æ€åˆ‡æ¢ï¼šçº¿ç¨‹æ± çš„åˆå§‹åŒ–çŠ¶æ€æ˜¯RUNNINGã€‚æ¢å¥è¯è¯´ï¼Œçº¿ç¨‹æ± è¢«ä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±å¤„äºRUNNINGçŠ¶æ€ï¼
é“ç†å¾ˆç®€å•ï¼Œåœ¨ctlçš„åˆå§‹åŒ–ä»£ç ä¸­(å¦‚ä¸‹)ï¼Œå°±å°†å®ƒåˆå§‹åŒ–ä¸ºRUNNINGçŠ¶æ€ï¼Œå¹¶ä¸”&quot;ä»»åŠ¡æ•°é‡&quot;åˆå§‹åŒ–ä¸º0ã€‚
<code>private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));</code></li>
<li>SHUTDOWN
(01) çŠ¶æ€è¯´æ˜ï¼šçº¿ç¨‹æ± å¤„åœ¨SHUTDOWNçŠ¶æ€æ—¶ï¼Œä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†èƒ½å¤„ç†å·²æ·»åŠ çš„ä»»åŠ¡ã€‚
(02) çŠ¶æ€åˆ‡æ¢ï¼šè°ƒç”¨çº¿ç¨‹æ± çš„shutdown()æ¥å£æ—¶ï¼Œçº¿ç¨‹æ± ç”±RUNNING -&gt; SHUTDOWNã€‚</li>
<li>STOP
(01) çŠ¶æ€è¯´æ˜ï¼šçº¿ç¨‹æ± å¤„åœ¨STOPçŠ¶æ€æ—¶ï¼Œä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä¸å¤„ç†å·²æ·»åŠ çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šä¸­æ–­æ­£åœ¨å¤„ç†çš„ä»»åŠ¡ã€‚
(02) çŠ¶æ€åˆ‡æ¢ï¼šè°ƒç”¨çº¿ç¨‹æ± çš„shutdownNow()æ¥å£æ—¶ï¼Œçº¿ç¨‹æ± ç”±(RUNNING or SHUTDOWN ) -&gt; STOPã€‚</li>
<li>TIDYING
(01) çŠ¶æ€è¯´æ˜ï¼šå½“æ‰€æœ‰çš„ä»»åŠ¡å·²ç»ˆæ­¢ï¼Œctlè®°å½•çš„&quot;ä»»åŠ¡æ•°é‡&quot;ä¸º0ï¼Œçº¿ç¨‹æ± ä¼šå˜ä¸ºTIDYINGçŠ¶æ€ã€‚å½“çº¿ç¨‹æ± å˜ä¸ºTIDYINGçŠ¶æ€æ—¶ï¼Œä¼šæ‰§è¡Œé’©å­å‡½æ•°terminated()ã€‚terminated()åœ¨ThreadPoolExecutorç±»ä¸­æ˜¯ç©ºçš„ï¼Œè‹¥ç”¨æˆ·æƒ³åœ¨çº¿ç¨‹æ± å˜ä¸ºTIDYINGæ—¶ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†ï¼›å¯ä»¥é€šè¿‡é‡è½½terminated()å‡½æ•°æ¥å®ç°ã€‚
(02) çŠ¶æ€åˆ‡æ¢ï¼šå½“çº¿ç¨‹æ± åœ¨SHUTDOWNçŠ¶æ€ä¸‹ï¼Œé˜»å¡é˜Ÿåˆ—ä¸ºç©ºå¹¶ä¸”çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ä»»åŠ¡ä¹Ÿä¸ºç©ºæ—¶ï¼Œå°±ä¼šç”± SHUTDOWN -&gt; TIDYINGã€‚
å½“çº¿ç¨‹æ± åœ¨STOPçŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ä»»åŠ¡ä¸ºç©ºæ—¶ï¼Œå°±ä¼šç”±STOP -&gt; TIDYINGã€‚</li>
<li>TERMINATED
(01) çŠ¶æ€è¯´æ˜ï¼šçº¿ç¨‹æ± å½»åº•ç»ˆæ­¢ï¼Œå°±å˜æˆTERMINATEDçŠ¶æ€ã€‚
(02) çŠ¶æ€åˆ‡æ¢ï¼šçº¿ç¨‹æ± å¤„åœ¨TIDYINGçŠ¶æ€æ—¶ï¼Œæ‰§è¡Œå®Œterminated()ä¹‹åï¼Œå°±ä¼šç”± TIDYING -&gt; TERMINATEDã€‚</li>
</ol>
<h2 id="æ‹’ç»ç­–ç•¥">æ‹’ç»ç­–ç•¥<a hidden class="anchor" aria-hidden="true" href="#æ‹’ç»ç­–ç•¥">#</a></h2>
<p>çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ï¼Œæ˜¯æŒ‡å½“ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­è¢«æ‹’ç»ï¼Œè€Œé‡‡å–çš„å¤„ç†æªæ–½ã€‚
å½“ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ä¹‹æ‰€ä»¥è¢«æ‹’ç»ï¼Œå¯èƒ½æ˜¯ç”±äºï¼šç¬¬ä¸€ï¼Œçº¿ç¨‹æ± å¼‚å¸¸å…³é—­ã€‚ç¬¬äºŒï¼Œä»»åŠ¡æ•°é‡è¶…è¿‡çº¿ç¨‹æ± çš„æœ€å¤§é™åˆ¶ã€‚
çº¿ç¨‹æ± å…±åŒ…æ‹¬4ç§æ‹’ç»ç­–ç•¥ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š
AbortPolicyã€CallerRunsPolicyã€DiscardOldestPolicyå’ŒDiscardPolicyã€‚</p>
<p>AbortPolicyï¼šå½“ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­è¢«æ‹’ç»æ—¶ï¼Œå®ƒå°†æŠ›å‡º RejectedExecutionException å¼‚å¸¸ã€‚
CallerRunsPolicyï¼šå½“ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­è¢«æ‹’ç»æ—¶ï¼Œä¼šåœ¨çº¿ç¨‹æ± å½“å‰æ­£åœ¨è¿è¡Œçš„Threadçº¿ç¨‹æ± ä¸­å¤„ç†è¢«æ‹’ç»çš„ä»»åŠ¡ã€‚
DiscardOldestPolicyï¼šå½“ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­è¢«æ‹’ç»æ—¶ï¼Œçº¿ç¨‹æ± ä¼šæ”¾å¼ƒç­‰å¾…é˜Ÿåˆ—ä¸­æœ€æ—§çš„æœªå¤„ç†ä»»åŠ¡ï¼Œç„¶åå°†è¢«æ‹’ç»çš„ä»»åŠ¡æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚
DiscardPolicyï¼šå½“ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­è¢«æ‹’ç»æ—¶ï¼Œçº¿ç¨‹æ± å°†ä¸¢å¼ƒè¢«æ‹’ç»çš„ä»»åŠ¡ã€‚
<strong>çº¿ç¨‹æ± é»˜è®¤çš„å¤„ç†ç­–ç•¥æ˜¯AbortPolicyï¼</strong></p>
<p>ä¸‹é¢é€šè¿‡ç¤ºä¾‹ï¼Œåˆ†åˆ«æ¼”ç¤ºçº¿ç¨‹æ± çš„4ç§æ‹’ç»ç­–ç•¥ã€‚</p>
<h3 id="discardpolicy-ç¤ºä¾‹">DiscardPolicy ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#discardpolicy-ç¤ºä¾‹">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.lang.reflect.Field;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ArrayBlockingQueue;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ThreadPoolExecutor;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.TimeUnit;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ThreadPoolExecutor.DiscardPolicy;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DiscardPolicyDemo {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> THREADS_SIZE = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> CAPACITY = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„&#34;æœ€å¤§æ± å¤§å°&#34;å’Œ&#34;æ ¸å¿ƒæ± å¤§å°&#34;éƒ½ä¸º1(THREADS_SIZE)ï¼Œ&#34;çº¿ç¨‹æ± &#34;çš„é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸º1(CAPACITY)ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ThreadPoolExecutor pool = <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(THREADS_SIZE, THREADS_SIZE, <span style="color:#ff0;font-weight:bold">0</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> ArrayBlockingQueue&lt;Runnable&gt;(CAPACITY));
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ç½®çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä¸º&#34;ä¸¢å¼ƒ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">setRejectedExecutionHandler</span>(<span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor.<span style="color:#007f7f">DiscardPolicy</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ–°å»º10ä¸ªä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">10</span>; i++) {
</span></span><span style="display:flex;"><span>            Runnable myrun = <span style="color:#fff;font-weight:bold">new</span> MyRunnable(<span style="color:#0ff;font-weight:bold">&#34;task-&#34;</span>+i);
</span></span><span style="display:flex;"><span>            pool.<span style="color:#007f7f">execute</span>(myrun);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> MyRunnable <span style="color:#fff;font-weight:bold">implements</span> Runnable {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> MyRunnable(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> + <span style="color:#0ff;font-weight:bold">&#34; is running.&#34;</span>);
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">100</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœï¼š
task-0 is running.
task-1 is running.</p>
<p>ç»“æœè¯´æ˜ï¼šçº¿ç¨‹æ± poolçš„&quot;æœ€å¤§æ± å¤§å°&quot;å’Œ&quot;æ ¸å¿ƒæ± å¤§å°&quot;éƒ½ä¸º1(THREADS_SIZE)ï¼Œè¿™æ„å‘³ç€&quot;çº¿ç¨‹æ± èƒ½åŒæ—¶è¿è¡Œçš„ä»»åŠ¡æ•°é‡æœ€å¤§åªèƒ½æ˜¯1&quot;ã€‚
çº¿ç¨‹æ± poolçš„é˜»å¡é˜Ÿåˆ—æ˜¯ArrayBlockingQueueï¼ŒArrayBlockingQueueæ˜¯ä¸€ä¸ªæœ‰ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼ŒArrayBlockingQueueçš„å®¹é‡ä¸º1ã€‚è¿™ä¹Ÿæ„å‘³ç€çº¿ç¨‹æ± çš„é˜»å¡é˜Ÿåˆ—åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ± é˜»å¡ç­‰å¾…ã€‚
æ ¹æ®&quot;&ldquo;ä¸­åˆ†æçš„execute()ä»£ç å¯çŸ¥ï¼šçº¿ç¨‹æ± ä¸­å…±è¿è¡Œäº†2ä¸ªä»»åŠ¡ã€‚ç¬¬1ä¸ªä»»åŠ¡ç›´æ¥æ”¾åˆ°Workerä¸­ï¼Œé€šè¿‡çº¿ç¨‹å»æ‰§è¡Œï¼›ç¬¬2ä¸ªä»»åŠ¡æ”¾åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚å…¶ä»–çš„ä»»åŠ¡éƒ½è¢«ä¸¢å¼ƒäº†ï¼</p>
<h3 id="discardoldestpolicy-ç¤ºä¾‹">DiscardOldestPolicy ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#discardoldestpolicy-ç¤ºä¾‹">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.lang.reflect.Field;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ArrayBlockingQueue;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ThreadPoolExecutor;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.TimeUnit;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ThreadPoolExecutor.DiscardOldestPolicy;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> DiscardOldestPolicyDemo {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> THREADS_SIZE = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> CAPACITY = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„&#34;æœ€å¤§æ± å¤§å°&#34;å’Œ&#34;æ ¸å¿ƒæ± å¤§å°&#34;éƒ½ä¸º1(THREADS_SIZE)ï¼Œ&#34;çº¿ç¨‹æ± &#34;çš„é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸º1(CAPACITY)ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ThreadPoolExecutor pool = <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(THREADS_SIZE, THREADS_SIZE, <span style="color:#ff0;font-weight:bold">0</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> ArrayBlockingQueue&lt;Runnable&gt;(CAPACITY));
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ç½®çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä¸º&#34;DiscardOldestPolicy&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">setRejectedExecutionHandler</span>(<span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor.<span style="color:#007f7f">DiscardOldestPolicy</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ–°å»º10ä¸ªä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">10</span>; i++) {
</span></span><span style="display:flex;"><span>            Runnable myrun = <span style="color:#fff;font-weight:bold">new</span> MyRunnable(<span style="color:#0ff;font-weight:bold">&#34;task-&#34;</span>+i);
</span></span><span style="display:flex;"><span>            pool.<span style="color:#007f7f">execute</span>(myrun);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> MyRunnable <span style="color:#fff;font-weight:bold">implements</span> Runnable {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> MyRunnable(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> + <span style="color:#0ff;font-weight:bold">&#34; is running.&#34;</span>);
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">200</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœï¼š
task-0 is running.
task-9 is running.</p>
<p>ç»“æœè¯´æ˜ï¼šå°†&quot;çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥&quot;ç”±DiscardPolicyä¿®æ”¹ä¸ºDiscardOldestPolicyä¹‹åï¼Œå½“æœ‰ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± è¢«æ‹’ç»æ—¶ï¼Œçº¿ç¨‹æ± ä¼šä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­æœ«å°¾çš„ä»»åŠ¡ï¼Œç„¶åå°†è¢«æ‹’ç»çš„ä»»åŠ¡æ·»åŠ åˆ°æœ«å°¾ã€‚</p>
<h3 id="abortpolicy-ç¤ºä¾‹">AbortPolicy ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#abortpolicy-ç¤ºä¾‹">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.lang.reflect.Field;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ArrayBlockingQueue;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ThreadPoolExecutor;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.TimeUnit;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ThreadPoolExecutor.AbortPolicy;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.RejectedExecutionException;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> AbortPolicyDemo {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> THREADS_SIZE = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> CAPACITY = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„&#34;æœ€å¤§æ± å¤§å°&#34;å’Œ&#34;æ ¸å¿ƒæ± å¤§å°&#34;éƒ½ä¸º1(THREADS_SIZE)ï¼Œ&#34;çº¿ç¨‹æ± &#34;çš„é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸º1(CAPACITY)ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ThreadPoolExecutor pool = <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(THREADS_SIZE, THREADS_SIZE, <span style="color:#ff0;font-weight:bold">0</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> ArrayBlockingQueue&lt;Runnable&gt;(CAPACITY));
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ç½®çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä¸º&#34;æŠ›å‡ºå¼‚å¸¸&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">setRejectedExecutionHandler</span>(<span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor.<span style="color:#007f7f">AbortPolicy</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ–°å»º10ä¸ªä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">10</span>; i++) {
</span></span><span style="display:flex;"><span>                Runnable myrun = <span style="color:#fff;font-weight:bold">new</span> MyRunnable(<span style="color:#0ff;font-weight:bold">&#34;task-&#34;</span>+i);
</span></span><span style="display:flex;"><span>                pool.<span style="color:#007f7f">execute</span>(myrun);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (RejectedExecutionException e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            pool.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> MyRunnable <span style="color:#fff;font-weight:bold">implements</span> Runnable {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> MyRunnable(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> + <span style="color:#0ff;font-weight:bold">&#34; is running.&#34;</span>);
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">200</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>(æŸä¸€æ¬¡)è¿è¡Œç»“æœï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">concurrent</span>.<span style="color:#007f7f">RejectedExecutionException</span>
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">concurrent</span>.<span style="color:#007f7f">ThreadPoolExecutor$AbortPolicy</span>.<span style="color:#007f7f">rejectedExecution</span>(ThreadPoolExecutor.<span style="color:#007f7f">java</span>:<span style="color:#ff0;font-weight:bold">1774</span>)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">concurrent</span>.<span style="color:#007f7f">ThreadPoolExecutor</span>.<span style="color:#007f7f">reject</span>(ThreadPoolExecutor.<span style="color:#007f7f">java</span>:<span style="color:#ff0;font-weight:bold">768</span>)
</span></span><span style="display:flex;"><span>    at java.<span style="color:#007f7f">util</span>.<span style="color:#007f7f">concurrent</span>.<span style="color:#007f7f">ThreadPoolExecutor</span>.<span style="color:#007f7f">execute</span>(ThreadPoolExecutor.<span style="color:#007f7f">java</span>:<span style="color:#ff0;font-weight:bold">656</span>)
</span></span><span style="display:flex;"><span>    at AbortPolicyDemo.<span style="color:#007f7f">main</span>(AbortPolicyDemo.<span style="color:#007f7f">java</span>:<span style="color:#ff0;font-weight:bold">27</span>)
</span></span><span style="display:flex;"><span>task-<span style="color:#ff0;font-weight:bold">0</span> is running.
</span></span><span style="display:flex;"><span>task-<span style="color:#ff0;font-weight:bold">1</span> is running.
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœè¯´æ˜ï¼šå°†&quot;çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥&quot;ç”±DiscardPolicyä¿®æ”¹ä¸ºAbortPolicyä¹‹åï¼Œå½“æœ‰ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± è¢«æ‹’ç»æ—¶ï¼Œä¼šæŠ›å‡ºRejectedExecutionExceptionã€‚</p>
<h3 id="callerrunspolicy-ç¤ºä¾‹">CallerRunsPolicy ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#callerrunspolicy-ç¤ºä¾‹">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.lang.reflect.Field;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ArrayBlockingQueue;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ThreadPoolExecutor;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.TimeUnit;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ThreadPoolExecutor.CallerRunsPolicy;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> CallerRunsPolicyDemo {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> THREADS_SIZE = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> CAPACITY = <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„&#34;æœ€å¤§æ± å¤§å°&#34;å’Œ&#34;æ ¸å¿ƒæ± å¤§å°&#34;éƒ½ä¸º1(THREADS_SIZE)ï¼Œ&#34;çº¿ç¨‹æ± &#34;çš„é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸º1(CAPACITY)ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ThreadPoolExecutor pool = <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(THREADS_SIZE, THREADS_SIZE, <span style="color:#ff0;font-weight:bold">0</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> ArrayBlockingQueue&lt;Runnable&gt;(CAPACITY));
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ç½®çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä¸º&#34;CallerRunsPolicy&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">setRejectedExecutionHandler</span>(<span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor.<span style="color:#007f7f">CallerRunsPolicy</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ–°å»º10ä¸ªä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">10</span>; i++) {
</span></span><span style="display:flex;"><span>            Runnable myrun = <span style="color:#fff;font-weight:bold">new</span> MyRunnable(<span style="color:#0ff;font-weight:bold">&#34;task-&#34;</span>+i);
</span></span><span style="display:flex;"><span>            pool.<span style="color:#007f7f">execute</span>(myrun);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> MyRunnable <span style="color:#fff;font-weight:bold">implements</span> Runnable {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> MyRunnable(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> = name;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">name</span> + <span style="color:#0ff;font-weight:bold">&#34; is running.&#34;</span>);
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">100</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>(æŸä¸€æ¬¡)è¿è¡Œç»“æœï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>task-2 is running.
</span></span><span style="display:flex;"><span>task-3 is running.
</span></span><span style="display:flex;"><span>task-4 is running.
</span></span><span style="display:flex;"><span>task-5 is running.
</span></span><span style="display:flex;"><span>task-6 is running.
</span></span><span style="display:flex;"><span>task-7 is running.
</span></span><span style="display:flex;"><span>task-8 is running.
</span></span><span style="display:flex;"><span>task-9 is running.
</span></span><span style="display:flex;"><span>task-0 is running.
</span></span><span style="display:flex;"><span>task-1 is running.
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœè¯´æ˜ï¼šå°†&quot;çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥&quot;ç”±DiscardPolicyä¿®æ”¹ä¸ºCallerRunsPolicyä¹‹åï¼Œå½“æœ‰ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± è¢«æ‹’ç»æ—¶ï¼Œçº¿ç¨‹æ± ä¼šå°†è¢«æ‹’ç»çš„ä»»åŠ¡æ·»åŠ åˆ°&quot;çº¿ç¨‹æ± æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹&quot;ä¸­å»è¿è¡Œã€‚</p>
<h1 id="callable-å’Œ-future-ç®€ä»‹">Callable å’Œ Future ç®€ä»‹<a hidden class="anchor" aria-hidden="true" href="#callable-å’Œ-future-ç®€ä»‹">#</a></h1>
<p>Callable å’Œ Future æ˜¯æ¯”è¾ƒæœ‰è¶£çš„ä¸€å¯¹ç»„åˆã€‚å½“æˆ‘ä»¬éœ€è¦è·å–çº¿ç¨‹çš„æ‰§è¡Œç»“æœæ—¶ï¼Œå°±éœ€è¦ç”¨åˆ°å®ƒä»¬ã€‚Callableç”¨äºäº§ç”Ÿç»“æœï¼ŒFutureç”¨äºè·å–ç»“æœã€‚</p>
<h2 id="callable">Callable<a hidden class="anchor" aria-hidden="true" href="#callable">#</a></h2>
<p>Callable æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒåªåŒ…å«ä¸€ä¸ªcall()æ–¹æ³•ã€‚Callableæ˜¯ä¸€ä¸ªè¿”å›ç»“æœå¹¶ä¸”å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»»åŠ¡ã€‚
ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥å°†Callableæ¯”ä½œä¸€ä¸ªRunnableæ¥å£ï¼Œè€ŒCallableçš„call()æ–¹æ³•åˆ™ç±»ä¼¼äºRunnableçš„run()æ–¹æ³•ã€‚
Callableçš„æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Callable&lt;V&gt; {
</span></span><span style="display:flex;"><span>    V call() <span style="color:#fff;font-weight:bold">throws</span> Exception;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼šä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºCallableæ”¯æŒæ³›å‹ã€‚</p>
<h2 id="future">Future<a hidden class="anchor" aria-hidden="true" href="#future">#</a></h2>
<p>Future æ˜¯ä¸€ä¸ªæ¥å£ã€‚å®ƒç”¨äºè¡¨ç¤ºå¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚æä¾›äº†æ£€æŸ¥è®¡ç®—æ˜¯å¦å®Œæˆçš„æ–¹æ³•ï¼Œä»¥ç­‰å¾…è®¡ç®—çš„å®Œæˆï¼Œå¹¶è·å–è®¡ç®—çš„ç»“æœã€‚Futureçš„æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Future&lt;V&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è¯•å›¾å–æ¶ˆå¯¹æ­¤ä»»åŠ¡çš„æ‰§è¡Œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">boolean</span> cancel(<span style="color:#fff;font-weight:bold">boolean</span> mayInterruptIfRunning)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœåœ¨ä»»åŠ¡æ­£å¸¸å®Œæˆå‰å°†å…¶å–æ¶ˆï¼Œåˆ™è¿”å› trueã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">boolean</span> isCancelled()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœä»»åŠ¡å·²å®Œæˆï¼Œåˆ™è¿”å› trueã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">boolean</span> isDone()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœ‰å¿…è¦ï¼Œç­‰å¾…è®¡ç®—å®Œæˆï¼Œç„¶åè·å–å…¶ç»“æœã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    V get() <span style="color:#fff;font-weight:bold">throws</span> InterruptedException, ExecutionException;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœ‰å¿…è¦ï¼Œæœ€å¤šç­‰å¾…ä¸ºä½¿è®¡ç®—å®Œæˆæ‰€ç»™å®šçš„æ—¶é—´ä¹‹åï¼Œè·å–å…¶ç»“æœï¼ˆå¦‚æœç»“æœå¯ç”¨ï¼‰ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    V get(<span style="color:#fff;font-weight:bold">long</span> timeout, TimeUnit unit) <span style="color:#fff;font-weight:bold">throws</span> InterruptedException, ExecutionException, TimeoutException;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼š Futureç”¨äºè¡¨ç¤ºå¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚å®ƒçš„å®ç°ç±»æ˜¯FutureTaskï¼Œåœ¨è®²è§£FutureTaskä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹Callableã€Futureã€FutureTaskå®ƒä»¬ä¹‹é—´çš„å…³ç³»å›¾ï¼Œå¦‚ä¸‹ï¼š
<img loading="lazy" src="6.jpg" alt=""  />

è¯´æ˜ï¼š</p>
<ul>
<li>RunnableFutureæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒç»§æ‰¿äº†Runnableå’ŒFutureè¿™ä¸¤ä¸ªæ¥å£ã€‚RunnableFutureçš„æºç å¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> RunnableFuture&lt;V&gt; <span style="color:#fff;font-weight:bold">extends</span> Runnable, Future&lt;V&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">void</span> run();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>FutureTaskå®ç°äº†RunnableFutureæ¥å£ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿè¯´å®ƒå®ç°äº†Futureæ¥å£ã€‚</li>
</ul>
<h2 id="ç¤ºä¾‹å’Œæºç åˆ†æ">ç¤ºä¾‹å’Œæºç åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹å’Œæºç åˆ†æ">#</a></h2>
<p>æˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªç¤ºä¾‹çœ‹çœ‹Callableå’ŒFutureçš„åŸºæœ¬ç”¨æ³•ï¼Œç„¶åå†åˆ†æç¤ºä¾‹çš„å®ç°åŸç†ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.Callable;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.Future;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.Executors;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ExecutorService;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ExecutionException;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> MyCallable <span style="color:#fff;font-weight:bold">implements</span> Callable {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Integer call() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> sum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ‰§è¡Œä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i=<span style="color:#ff0;font-weight:bold">0</span>; i&lt;<span style="color:#ff0;font-weight:bold">100</span>; i++)
</span></span><span style="display:flex;"><span>            sum += i;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//return sum;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">return</span> Integer.<span style="color:#007f7f">valueOf</span>(sum);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> CallableTest1 {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throws</span> ExecutionException, InterruptedException{
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ExecutorService pool = Executors.<span style="color:#007f7f">newSingleThreadExecutor</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºæœ‰è¿”å›å€¼çš„ä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Callable c1 = <span style="color:#fff;font-weight:bold">new</span> MyCallable();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æ‰§è¡Œä»»åŠ¡å¹¶è·å–Futureå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Future f1 = pool.<span style="color:#007f7f">submit</span>(c1);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¾“å‡ºç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(f1.<span style="color:#007f7f">get</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        pool.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœï¼š
4950</p>
<p>ç»“æœè¯´æ˜ï¼š
åœ¨ä¸»çº¿ç¨‹mainä¸­ï¼Œé€šè¿‡newSingleThreadExecutor()æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚æ¥ç€åˆ›å»ºCallableå¯¹è±¡c1ï¼Œç„¶åå†é€šè¿‡pool.submit(c1)å°†c1æäº¤åˆ°çº¿ç¨‹æ± ä¸­è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å°†è¿”å›çš„ç»“æœä¿å­˜åˆ°Futureå¯¹è±¡f1ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡f1.get()è·å–Callableä¸­ä¿å­˜çš„ç»“æœï¼›æœ€åé€šè¿‡pool.shutdown()å…³é—­çº¿ç¨‹æ± ã€‚</p>
<h3 id="submit-1">submit()<a hidden class="anchor" aria-hidden="true" href="#submit-1">#</a></h3>
<p>submit()åœ¨ <code>java/util/concurrent/AbstractExecutorService.java</code> ä¸­å®ç°ï¼Œå®ƒçš„æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (task == <span style="color:#fff;font-weight:bold">null</span>) <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> NullPointerException();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ›å»ºä¸€ä¸ªRunnableFutureå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    RunnableFuture&lt;T&gt; ftask = newTaskFor(task);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ‰§è¡Œâ€œä»»åŠ¡ftaskâ€
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    execute(ftask);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è¿”å›â€œftaskâ€
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">return</span> ftask;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼šsubmit()é€šè¿‡newTaskFor(task)åˆ›å»ºäº†RunnableFutureå¯¹è±¡ftaskã€‚å®ƒçš„æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Callable&lt;T&gt; callable) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> FutureTask&lt;T&gt;(callable);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="futuretaskçš„æ„é€ å‡½æ•°">FutureTaskçš„æ„é€ å‡½æ•°<a hidden class="anchor" aria-hidden="true" href="#futuretaskçš„æ„é€ å‡½æ•°">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> FutureTask(Callable&lt;V&gt; callable) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (callable == <span style="color:#fff;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> NullPointerException();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// callableæ˜¯ä¸€ä¸ªCallableå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">callable</span> = callable;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// stateè®°å½•FutureTaskçš„çŠ¶æ€
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">state</span> = NEW;       <span style="color:#007f7f">// ensure visibility of callable
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="futuretaskçš„runæ–¹æ³•">FutureTaskçš„run()æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#futuretaskçš„runæ–¹æ³•">#</a></h3>
<p>æˆ‘ä»¬ç»§ç»­å›åˆ°submit()çš„æºç ä¸­ã€‚
åœ¨newTaskFor()æ–°å»ºä¸€ä¸ªftaskå¯¹è±¡ä¹‹åï¼Œä¼šé€šè¿‡execute(ftask)æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚æ­¤æ—¶ftaskè¢«å½“ä½œä¸€ä¸ªRunnableå¯¹è±¡è¿›è¡Œæ‰§è¡Œï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ°å®ƒçš„run()æ–¹æ³•ï¼›ftaskçš„run()æ–¹æ³•åœ¨<code>java/util/concurrent/FutureTask.java</code>ä¸­å®ç°ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (state != NEW ||
</span></span><span style="display:flex;"><span>        !UNSAFE.<span style="color:#007f7f">compareAndSwapObject</span>(<span style="color:#fff;font-weight:bold">this</span>, runnerOffset,
</span></span><span style="display:flex;"><span>                                     <span style="color:#fff;font-weight:bold">null</span>, Thread.<span style="color:#007f7f">currentThread</span>()))
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å°†callableå¯¹è±¡èµ‹å€¼ç»™cã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Callable&lt;V&gt; c = callable;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (c != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; state == NEW) {
</span></span><span style="display:flex;"><span>            V result;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">boolean</span> ran;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// æ‰§è¡ŒCallableçš„call()æ–¹æ³•ï¼Œå¹¶ä¿å­˜ç»“æœåˆ°resultä¸­ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                result = c.<span style="color:#007f7f">call</span>();
</span></span><span style="display:flex;"><span>                ran = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (Throwable ex) {
</span></span><span style="display:flex;"><span>                result = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>                ran = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>                setException(ex);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// å¦‚æœè¿è¡ŒæˆåŠŸï¼Œåˆ™å°†resultä¿å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (ran)
</span></span><span style="display:flex;"><span>                set(result);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        runner = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è®¾ç½®â€œstateçŠ¶æ€æ ‡è®°â€
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">int</span> s = state;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (s &gt;= INTERRUPTING)
</span></span><span style="display:flex;"><span>            handlePossibleCancellationInterrupt(s);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯´æ˜ï¼šrun()ä¸­ä¼šæ‰§è¡ŒCallableå¯¹è±¡çš„call()æ–¹æ³•ï¼Œå¹¶ä¸”æœ€ç»ˆå°†ç»“æœä¿å­˜åˆ°resultä¸­ï¼Œå¹¶é€šè¿‡set(result)å°†resultä¿å­˜ã€‚
ä¹‹åè°ƒç”¨FutureTaskçš„get()æ–¹æ³•ï¼Œè¿”å›çš„å°±æ˜¯é€šè¿‡set(result)ä¿å­˜çš„å€¼ã€‚</p>
<p><a href="https://www.cnblogs.com/skywang12345/archive/2013/06/14/index.html">å‚è€ƒ</a></p>
<h1 id="completablefuture">CompletableFuture<a hidden class="anchor" aria-hidden="true" href="#completablefuture">#</a></h1>
<p>ä½¿ç”¨Futureè·å¾—å¼‚æ­¥æ‰§è¡Œç»“æœæ—¶ï¼Œè¦ä¹ˆè°ƒç”¨é˜»å¡æ–¹æ³•get()ï¼Œè¦ä¹ˆè½®è¯¢çœ‹isDone()æ˜¯å¦ä¸ºtrueï¼Œè¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºä¸»çº¿ç¨‹ä¹Ÿä¼šè¢«è¿«ç­‰å¾…ã€‚
ä»Java 8å¼€å§‹å¼•å…¥äº†CompletableFutureï¼Œå®ƒé’ˆå¯¹Futureåšäº†æ”¹è¿›ï¼Œå¯ä»¥ä¼ å…¥å›è°ƒå¯¹è±¡ï¼Œå½“å¼‚æ­¥ä»»åŠ¡å®Œæˆæˆ–è€…å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨å›è°ƒå¯¹è±¡çš„å›è°ƒæ–¹æ³•ã€‚</p>
<h2 id="completablefuturejoinå’Œgetçš„åŒºåˆ«"><code>CompletableFuture.join()</code>å’Œ<code>get()</code>çš„åŒºåˆ«<a hidden class="anchor" aria-hidden="true" href="#completablefuturejoinå’Œgetçš„åŒºåˆ«">#</a></h2>
<p>join()æ–¹æ³•æŠ›å‡ºçš„æ˜¯uncheckå¼‚å¸¸ï¼ˆå³æœªç»æ£€æŸ¥çš„å¼‚å¸¸)ï¼Œä¸ä¼šå¼ºåˆ¶å¼€å‘è€…æŠ›å‡ºã€‚ä¼šå°†å¼‚å¸¸åŒ…è£…æˆCompletionExceptionå¼‚å¸¸ /CancellationExceptionå¼‚å¸¸ï¼Œä½†æ˜¯æœ¬è´¨åŸå› è¿˜æ˜¯ä»£ç å†…å­˜åœ¨çš„çœŸæ­£çš„å¼‚å¸¸ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        CompletableFuture&lt;Integer&gt; f1 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> i =<span style="color:#ff0;font-weight:bold">1</span>/<span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        CompletableFuture.<span style="color:#007f7f">allOf</span>(f1).<span style="color:#007f7f">join</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;CompletableFuture Test&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>get()æ–¹æ³•æŠ›å‡ºçš„æ˜¯ checked å¼‚å¸¸ï¼ŒExecutionExceptionã€InterruptedExceptionã€‚éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å¤„ç†ï¼ˆæŠ›å‡ºæˆ–è€… try catchï¼‰</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>        CompletableFuture&lt;Integer&gt; f1 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> i =<span style="color:#ff0;font-weight:bold">1</span>/<span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        f1.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;CompletableFuture Test&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ›å»ºå¼‚æ­¥ä»»åŠ¡">åˆ›å»ºå¼‚æ­¥ä»»åŠ¡<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»ºå¼‚æ­¥ä»»åŠ¡">#</a></h2>
<h3 id="runasync-å’Œ-supplyasyncæ–¹æ³•">runAsync å’Œ supplyAsyncæ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#runasync-å’Œ-supplyasyncæ–¹æ³•">#</a></h3>
<p>æ²¡æœ‰æŒ‡å®šExecutorçš„æ–¹æ³•ä¼šä½¿ç”¨<code>ForkJoinPool.commonPool()</code>ä½œä¸ºå®ƒçš„çº¿ç¨‹æ± æ‰§è¡Œå¼‚æ­¥ä»£ç ã€‚å¦‚æœæŒ‡å®šçº¿ç¨‹æ± ï¼Œåˆ™ä½¿ç”¨æŒ‡å®šçš„çº¿ç¨‹æ± è¿è¡Œã€‚ä»¥ä¸‹æ‰€æœ‰çš„æ–¹æ³•éƒ½ç±»åŒã€‚</p>
<p>CompletableFuture æä¾›äº†å››ä¸ªé™æ€æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> CompletableFuture&lt;Void&gt; runAsync(Runnable runnable)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> CompletableFuture&lt;Void&gt; runAsync(Runnable runnable, Executor executor)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier, Executor executor)
</span></span></code></pre></td></tr></table>
</div>
</div><p>runAsync ä¸æ”¯æŒè¿”å›å€¼ã€‚
supplyAsync æ”¯æŒè¿”å›å€¼ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//æ— è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> runAsync() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Void&gt; future = CompletableFuture.<span style="color:#007f7f">runAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;run end ...&#34;</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    future.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//æœ‰è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> supplyAsync() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Long&gt; future = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;run end ...&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> time = future.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;time = &#34;</span>+time);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¼‚æ­¥å›è°ƒ">å¼‚æ­¥å›è°ƒ<a hidden class="anchor" aria-hidden="true" href="#å¼‚æ­¥å›è°ƒ">#</a></h2>
<h3 id="whencomplete">whenComplete<a hidden class="anchor" aria-hidden="true" href="#whencomplete">#</a></h3>
<p>å½“CompletableFutureçš„è®¡ç®—ç»“æœå®Œæˆï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œå¯ä»¥æ‰§è¡Œç‰¹å®šçš„Actionã€‚ä¸»è¦æ˜¯ä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletableFuture&lt;T&gt; whenComplete(BiConsumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T,? <span style="color:#fff;font-weight:bold">super</span> Throwable&gt; action)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletableFuture&lt;T&gt; whenCompleteAsync(BiConsumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T,? <span style="color:#fff;font-weight:bold">super</span> Throwable&gt; action)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletableFuture&lt;T&gt; whenCompleteAsync(BiConsumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T,? <span style="color:#fff;font-weight:bold">super</span> Throwable&gt; action, Executor executor)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletableFuture&lt;T&gt; exceptionally(Function&lt;Throwable,? <span style="color:#fff;font-weight:bold">extends</span> T&gt; fn)
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°Actionçš„ç±»å‹æ˜¯<code>BiConsumer&lt;? super T,? super Throwable&gt;</code>å®ƒå¯ä»¥å¤„ç†æ­£å¸¸çš„è®¡ç®—ç»“æœï¼Œæˆ–è€…å¼‚å¸¸æƒ…å†µã€‚</p>
<p>whenCompleteï¼šwhenComplete çš„ä»»åŠ¡ï¼Œäº¤ç»™å½“å‰çº¿ç¨‹æ‰§è¡Œ ã€‚
whenCompleteAsyncï¼šwhenCompleteAsync çš„ä»»åŠ¡ï¼Œäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> whenComplete() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Void&gt; future = CompletableFuture.<span style="color:#007f7f">runAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span>(<span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>()%<span style="color:#ff0;font-weight:bold">2</span>&gt;=<span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">12</span>/<span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;run end ...&#34;</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    future.<span style="color:#007f7f">whenComplete</span>(<span style="color:#fff;font-weight:bold">new</span> BiConsumer&lt;Void, Throwable&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> accept(Void t, Throwable action) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ‰§è¡Œå®Œæˆï¼&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    future.<span style="color:#007f7f">exceptionally</span>(<span style="color:#fff;font-weight:bold">new</span> Function&lt;Throwable, Void&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Void apply(Throwable t) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ‰§è¡Œå¤±è´¥ï¼&#34;</span>+t.<span style="color:#007f7f">getMessage</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">2</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="thenapply">thenApply<a hidden class="anchor" aria-hidden="true" href="#thenapply">#</a></h3>
<p>å½“ä¸€ä¸ªçº¿ç¨‹ä¾èµ–å¦ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ thenApply æ–¹æ³•æ¥æŠŠè¿™ä¸¤ä¸ªçº¿ç¨‹ä¸²è¡ŒåŒ–ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; thenApply(Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T,? <span style="color:#fff;font-weight:bold">extends</span> U&gt; fn)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; thenApplyAsync(Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T,? <span style="color:#fff;font-weight:bold">extends</span> U&gt; fn)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; thenApplyAsync(Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T,? <span style="color:#fff;font-weight:bold">extends</span> U&gt; fn, Executor executor)
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Function&lt;? super T,? extends U&gt;</code>
Tï¼šä¸Šä¸€ä¸ªä»»åŠ¡è¿”å›ç»“æœçš„ç±»å‹
Uï¼šå½“å‰ä»»åŠ¡çš„è¿”å›å€¼ç±»å‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> thenApply() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Long&gt; future = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Long&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Long get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">long</span> result = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">100</span>);
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;result1=&#34;</span>+result);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }).<span style="color:#007f7f">thenApply</span>(<span style="color:#fff;font-weight:bold">new</span> Function&lt;Long, Long&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Long apply(Long t) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">long</span> result = t*<span style="color:#ff0;font-weight:bold">5</span>;
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;result2=&#34;</span>+result);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span> result = future.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒä¸ªä»»åŠ¡ä¾èµ–ç¬¬ä¸€ä¸ªä»»åŠ¡çš„ç»“æœã€‚</p>
<h3 id="handle">handle<a hidden class="anchor" aria-hidden="true" href="#handle">#</a></h3>
<p>handle æ˜¯æ‰§è¡Œä»»åŠ¡å®Œæˆæ—¶å¯¹ç»“æœçš„å¤„ç†ã€‚
handle æ–¹æ³•å’Œ thenApply æ–¹æ³•å¤„ç†æ–¹å¼åŸºæœ¬ä¸€æ ·ã€‚ä¸åŒçš„æ˜¯ handle æ˜¯åœ¨ä»»åŠ¡å®Œæˆåå†æ‰§è¡Œï¼Œè¿˜å¯ä»¥å¤„ç†å¼‚å¸¸çš„ä»»åŠ¡ã€‚thenApply åªå¯ä»¥æ‰§è¡Œæ­£å¸¸çš„ä»»åŠ¡ï¼Œä»»åŠ¡å‡ºç°å¼‚å¸¸åˆ™ä¸æ‰§è¡Œ thenApply æ–¹æ³•ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletionStage&lt;U&gt; handle(BiFunction&lt;? <span style="color:#fff;font-weight:bold">super</span> T, Throwable, ? <span style="color:#fff;font-weight:bold">extends</span> U&gt; fn);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletionStage&lt;U&gt; handleAsync(BiFunction&lt;? <span style="color:#fff;font-weight:bold">super</span> T, Throwable, ? <span style="color:#fff;font-weight:bold">extends</span> U&gt; fn);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletionStage&lt;U&gt; handleAsync(BiFunction&lt;? <span style="color:#fff;font-weight:bold">super</span> T, Throwable, ? <span style="color:#fff;font-weight:bold">extends</span> U&gt; fn,Executor executor);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> handle() <span style="color:#fff;font-weight:bold">throws</span> Exception{
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; future = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> i= <span style="color:#ff0;font-weight:bold">10</span>/<span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">10</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }).<span style="color:#007f7f">handle</span>(<span style="color:#fff;font-weight:bold">new</span> BiFunction&lt;Integer, Throwable, Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer apply(Integer param, Throwable throwable) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> result = -<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span>(throwable==<span style="color:#fff;font-weight:bold">null</span>){
</span></span><span style="display:flex;"><span>                result = param * <span style="color:#ff0;font-weight:bold">2</span>;
</span></span><span style="display:flex;"><span>            }<span style="color:#fff;font-weight:bold">else</span>{
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(throwable.<span style="color:#007f7f">getMessage</span>());
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>     });
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(future.<span style="color:#007f7f">get</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ç¤ºä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨ handle ä¸­å¯ä»¥æ ¹æ®ä»»åŠ¡æ˜¯å¦æœ‰å¼‚å¸¸æ¥è¿›è¡Œåšç›¸åº”çš„åç»­å¤„ç†æ“ä½œã€‚è€Œ thenApply æ–¹æ³•ï¼Œå¦‚æœä¸Šä¸ªä»»åŠ¡å‡ºç°é”™è¯¯ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œ thenApply æ–¹æ³•ã€‚</p>
<h3 id="thenaccept">thenAccept<a hidden class="anchor" aria-hidden="true" href="#thenaccept">#</a></h3>
<p>æ¥æ”¶ä»»åŠ¡çš„å¤„ç†ç»“æœï¼Œå¹¶æ¶ˆè´¹å¤„ç†ï¼Œæ— è¿”å›ç»“æœã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; thenAccept(Consumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T&gt; action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; thenAcceptAsync(Consumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T&gt; action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; thenAcceptAsync(Consumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T&gt; action,Executor executor);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> thenAccept() <span style="color:#fff;font-weight:bold">throws</span> Exception{
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Void&gt; future = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">10</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }).<span style="color:#007f7f">thenAccept</span>(integer -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(integer);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    future.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ç¤ºä¾‹ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ–¹æ³•åªæ˜¯æ¶ˆè´¹ä¸Šä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„ä»»åŠ¡ï¼Œå¹¶å¯ä»¥æ ¹æ®ä¸Šé¢çš„ä»»åŠ¡è¿”å›çš„ç»“æœè¿›è¡Œå¤„ç†ã€‚å¹¶æ²¡æœ‰åç»­çš„è¾“å‡ºæ“ä½œã€‚</p>
<h3 id="thenrun">thenRun<a hidden class="anchor" aria-hidden="true" href="#thenrun">#</a></h3>
<p>è·Ÿ thenAccept æ–¹æ³•ä¸ä¸€æ ·çš„æ˜¯ï¼Œä¸å…³å¿ƒä»»åŠ¡çš„å¤„ç†ç»“æœã€‚åªè¦ä¸Šé¢çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå°±å¼€å§‹æ‰§è¡Œ thenRunã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; thenRun(Runnable action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; thenRunAsync(Runnable action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; thenRunAsync(Runnable action,Executor executor);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> thenRun() <span style="color:#fff;font-weight:bold">throws</span> Exception{
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Void&gt; future = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">10</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }).<span style="color:#007f7f">thenRun</span>(() -&gt; {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;thenRun ...&#34;</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    future.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¥æ–¹æ³•åŒ thenAccept æ–¹æ³•ç±»ä¼¼ã€‚ä¸åŒçš„æ˜¯ä¸Šä¸ªä»»åŠ¡å¤„ç†å®Œæˆåï¼Œå¹¶ä¸ä¼šæŠŠè®¡ç®—çš„ç»“æœä¼ ç»™ thenRun æ–¹æ³•ã€‚åªæ˜¯å¤„ç†å®Œä»»åŠ¡åï¼Œæ‰§è¡Œ thenRun çš„åç»­æ“ä½œã€‚</p>
<h2 id="ç»„åˆ">ç»„åˆ<a hidden class="anchor" aria-hidden="true" href="#ç»„åˆ">#</a></h2>
<h3 id="thencombine-åˆå¹¶ä»»åŠ¡">thenCombine åˆå¹¶ä»»åŠ¡<a hidden class="anchor" aria-hidden="true" href="#thencombine-åˆå¹¶ä»»åŠ¡">#</a></h3>
<p>thenCombine ä¼šæŠŠ ä¸¤ä¸ª CompletionStage çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆåï¼ŒæŠŠä¸¤ä¸ªä»»åŠ¡çš„ç»“æœä¸€å—äº¤ç»™ thenCombine æ¥å¤„ç†ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U,V&gt; CompletionStage&lt;V&gt; thenCombine(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> U&gt; other,BiFunction&lt;? <span style="color:#fff;font-weight:bold">super</span> T,? <span style="color:#fff;font-weight:bold">super</span> U,? <span style="color:#fff;font-weight:bold">extends</span> V&gt; fn);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U,V&gt; CompletionStage&lt;V&gt; thenCombineAsync(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> U&gt; other,BiFunction&lt;? <span style="color:#fff;font-weight:bold">super</span> T,? <span style="color:#fff;font-weight:bold">super</span> U,? <span style="color:#fff;font-weight:bold">extends</span> V&gt; fn);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U,V&gt; CompletionStage&lt;V&gt; thenCombineAsync(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> U&gt; other,BiFunction&lt;? <span style="color:#fff;font-weight:bold">super</span> T,? <span style="color:#fff;font-weight:bold">super</span> U,? <span style="color:#fff;font-weight:bold">extends</span> V&gt; fn,Executor executor);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> thenCombine() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;String&gt; future1 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;String&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> String get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;String&gt; future2 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;String&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> String get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;String&gt; result = future1.<span style="color:#007f7f">thenCombine</span>(future2, <span style="color:#fff;font-weight:bold">new</span> BiFunction&lt;String, String, String&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> String apply(String t, String u) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t+<span style="color:#0ff;font-weight:bold">&#34; &#34;</span>+u;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result.<span style="color:#007f7f">get</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="thenacceptboth">thenAcceptBoth<a hidden class="anchor" aria-hidden="true" href="#thenacceptboth">#</a></h3>
<p>å½“ä¸¤ä¸ªCompletionStageéƒ½æ‰§è¡Œå®Œæˆåï¼ŒæŠŠç»“æœä¸€å—äº¤ç»™thenAcceptBothæ¥è¿›è¡Œæ¶ˆè€—</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletionStage&lt;Void&gt; thenAcceptBoth(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> U&gt; other,BiConsumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">super</span> U&gt; action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletionStage&lt;Void&gt; thenAcceptBothAsync(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> U&gt; other,BiConsumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">super</span> U&gt; action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletionStage&lt;Void&gt; thenAcceptBothAsync(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> U&gt; other,BiConsumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">super</span> U&gt; action,     Executor executor);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> thenAcceptBoth() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; f1 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(t);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f1=&#34;</span>+t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; f2 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(t);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f2=&#34;</span>+t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    f1.<span style="color:#007f7f">thenAcceptBoth</span>(f2, <span style="color:#fff;font-weight:bold">new</span> BiConsumer&lt;Integer, Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> accept(Integer t, Integer u) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f1=&#34;</span>+t+<span style="color:#0ff;font-weight:bold">&#34;;f2=&#34;</span>+u+<span style="color:#0ff;font-weight:bold">&#34;;&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å’ŒthenCombineç›¸æ¯”ï¼ŒthenAcceptBothæ˜¯æ²¡æœ‰è¿”å›å€¼çš„ã€‚</p>
<h3 id="runafterboth">runAfterBoth<a hidden class="anchor" aria-hidden="true" href="#runafterboth">#</a></h3>
<p>ä¸¤ä¸ªCompletionStageï¼Œéƒ½å®Œæˆäº†è®¡ç®—æ‰ä¼šæ‰§è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œï¼ˆRunnableï¼‰</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; runAfterBoth(CompletionStage&lt;?&gt; other,Runnable action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; runAfterBothAsync(CompletionStage&lt;?&gt; other,Runnable action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; runAfterBothAsync(CompletionStage&lt;?&gt; other,Runnable action,Executor executor);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> runAfterBoth() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; f1 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(t);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f1=&#34;</span>+t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; f2 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(t);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f2=&#34;</span>+t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    f1.<span style="color:#007f7f">runAfterBoth</span>(f2, <span style="color:#fff;font-weight:bold">new</span> Runnable() {
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ä¸Šé¢ä¸¤ä¸ªä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆäº†ã€‚&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="applytoeither">applyToEither<a hidden class="anchor" aria-hidden="true" href="#applytoeither">#</a></h3>
<p>ä¸¤ä¸ªCompletionStageï¼Œè°æ‰§è¡Œè¿”å›çš„ç»“æœå¿«ï¼Œæˆ‘å°±ç”¨é‚£ä¸ªCompletionStageçš„ç»“æœè¿›è¡Œä¸‹ä¸€æ­¥çš„è½¬åŒ–æ“ä½œã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletionStage&lt;U&gt; applyToEither(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> T&gt; other,Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, U&gt; fn);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletionStage&lt;U&gt; applyToEitherAsync(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> T&gt; other,Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, U&gt; fn);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletionStage&lt;U&gt; applyToEitherAsync(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> T&gt; other,Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, U&gt; fn,Executor executor);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> applyToEither() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; f1 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(t);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f1=&#34;</span>+t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; f2 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(t);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f2=&#34;</span>+t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; result = f1.<span style="color:#007f7f">applyToEither</span>(f2, <span style="color:#fff;font-weight:bold">new</span> Function&lt;Integer, Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer apply(Integer t) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t * <span style="color:#ff0;font-weight:bold">2</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result.<span style="color:#007f7f">get</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="accepteither">acceptEither<a hidden class="anchor" aria-hidden="true" href="#accepteither">#</a></h3>
<p>ä¸¤ä¸ªCompletionStageï¼Œè°æ‰§è¡Œè¿”å›çš„ç»“æœå¿«ï¼Œæˆ‘å°±ç”¨é‚£ä¸ªCompletionStageçš„ç»“æœè¿›è¡Œä¸‹ä¸€æ­¥çš„æ¶ˆè€—æ“ä½œã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; acceptEither(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> T&gt; other,Consumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T&gt; action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; acceptEitherAsync(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> T&gt; other,Consumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T&gt; action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; acceptEitherAsync(CompletionStage&lt;? <span style="color:#fff;font-weight:bold">extends</span> T&gt; other,Consumer&lt;? <span style="color:#fff;font-weight:bold">super</span> T&gt; action,Executor executor);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> acceptEither() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; f1 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(t);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f1=&#34;</span>+t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; f2 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(t);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f2=&#34;</span>+t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    f1.<span style="color:#007f7f">acceptEither</span>(f2, <span style="color:#fff;font-weight:bold">new</span> Consumer&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> accept(Integer t) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(t);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>acceptEitheræ²¡æœ‰è¿”å›å€¼ã€‚</p>
<h3 id="runaftereither">runAfterEither<a hidden class="anchor" aria-hidden="true" href="#runaftereither">#</a></h3>
<p>ä¸¤ä¸ªCompletionStageï¼Œä»»ä½•ä¸€ä¸ªå®Œæˆäº†éƒ½ä¼šæ‰§è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œï¼ˆRunnableï¼‰ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; runAfterEither(CompletionStage&lt;?&gt; other,Runnable action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; runAfterEitherAsync(CompletionStage&lt;?&gt; other,Runnable action);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Void&gt; runAfterEitherAsync(CompletionStage&lt;?&gt; other,Runnable action,Executor executor);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> runAfterEither() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; f1 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(t);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f1=&#34;</span>+t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Integer&gt; f2 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(t);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;f2=&#34;</span>+t);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    f1.<span style="color:#007f7f">runAfterEither</span>(f2, <span style="color:#fff;font-weight:bold">new</span> Runnable() {
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> run() {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ä¸Šé¢æœ‰ä¸€ä¸ªå·²ç»å®Œæˆäº†ã€‚&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="thencompose">thenCompose<a hidden class="anchor" aria-hidden="true" href="#thencompose">#</a></h3>
<p>thenCompose æ–¹æ³•å…è®¸ä½ å¯¹ä¸¤ä¸ª CompletionStage è¿›è¡Œæµæ°´çº¿æ“ä½œï¼Œç¬¬ä¸€ä¸ªæ“ä½œå®Œæˆæ—¶ï¼Œå°†å…¶ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ç»™ç¬¬äºŒä¸ªæ“ä½œã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; thenCompose(Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">extends</span> CompletionStage&lt;U&gt;&gt; fn);
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; thenComposeAsync(Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">extends</span> CompletionStage&lt;U&gt;&gt; fn) ;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; thenComposeAsync(Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">extends</span> CompletionStage&lt;U&gt;&gt; fn, Executor executor) ;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> thenCompose() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        CompletableFuture&lt;Integer&gt; f = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">int</span> t = <span style="color:#fff;font-weight:bold">new</span> Random().<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;t1=&#34;</span>+t);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }).<span style="color:#007f7f">thenCompose</span>(<span style="color:#fff;font-weight:bold">new</span> Function&lt;Integer, CompletionStage&lt;Integer&gt;&gt;() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">public</span> CompletionStage&lt;Integer&gt; apply(Integer param) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(<span style="color:#fff;font-weight:bold">new</span> Supplier&lt;Integer&gt;() {
</span></span><span style="display:flex;"><span>                    @Override
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">public</span> Integer get() {
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">int</span> t = param *<span style="color:#ff0;font-weight:bold">2</span>;
</span></span><span style="display:flex;"><span>                        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;t2=&#34;</span>+t);
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">return</span> t;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;thenCompose result : &#34;</span>+f.<span style="color:#007f7f">get</span>());
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="allof">allOf()<a hidden class="anchor" aria-hidden="true" href="#allof">#</a></h3>
<p>anyOf å¯ä»¥æ¥å—å¤šä¸ª CompletableFuture å‚æ•°ã€‚æ‰€æœ‰ CompletableFuture ç»“æŸï¼Œæ‰ä¼šæ‰§è¡Œåç»­çš„ä»£ç ã€‚å› ä¸ºæ¯ä¸ª CompletableFuture çš„è¿”å›å€¼ç±»å‹å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥æ— æ³•ç¡®å®šè¿”å›ç±»å‹æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥ allOf çš„è¿”å›å€¼æ˜¯<code>CompletableFuture&lt;void&gt;</code>ç±»å‹ã€‚ è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> allOf1(){
</span></span><span style="display:flex;"><span>        CompletableFuture&lt;String&gt; future1 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;future1çš„æ‰§è¡Œç»“æœ&#34;</span>;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        CompletableFuture&lt;String&gt; future2 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">2</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;future2çš„æ‰§è¡Œç»“æœ&#34;</span>;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">// joinæ–¹æ³•ä¼šé˜»å¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        CompletableFuture.<span style="color:#007f7f">allOf</span>(future1,future2).<span style="color:#007f7f">join</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¼šç­‰å¾…æ‰€æœ‰ future æ‰§è¡Œå®Œæˆï¼Œæ‰ä¼šè¿”å›ã€‚
è¿™ç§æƒ…å†µç›¸å½“äºå¼‚æ­¥æ‰§è¡Œäº†ä¸¤ä¸ªä»»åŠ¡ï¼Œä¸”ç­‰å¾…ä¸¤ä¸ªä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆæ‰è¿”å›ã€‚</p>
<p>ä¸Šé¢ allof åªæ¥æ”¶äº†ä¸¤ä¸ªå‚æ•°ï¼Œå¦‚æœå¤šä¸ªå‚æ•°å¦‚ä½•æ¥æ”¶å‘¢ï¼Ÿ</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> allOf2(){
</span></span><span style="display:flex;"><span>    List&lt;Integer&gt; list = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    list.<span style="color:#007f7f">add</span>(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    list.<span style="color:#007f7f">add</span>(<span style="color:#ff0;font-weight:bold">2</span>);
</span></span><span style="display:flex;"><span>    list.<span style="color:#007f7f">add</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    CompletableFuture[] futures = list.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>    		<span style="color:#007f7f">// åœ¨è¿™é‡Œå¼‚æ­¥æ‰§è¡Œä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            .<span style="color:#007f7f">map</span>(i -&gt; CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; i + <span style="color:#ff0;font-weight:bold">1</span>))
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">toArray</span>(CompletableFuture[]::<span style="color:#fff;font-weight:bold">new</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">// è°ƒç”¨é˜»å¡æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    CompletableFuture.<span style="color:#007f7f">allOf</span>(futures).<span style="color:#007f7f">join</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œå¦‚æœéœ€è¦æ¯ä¸ªä»»åŠ¡çš„è¿”å›å€¼å‘¢ï¼Ÿ</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> allOf3(){
</span></span><span style="display:flex;"><span>    List&lt;Integer&gt; list = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    list.<span style="color:#007f7f">add</span>(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    list.<span style="color:#007f7f">add</span>(<span style="color:#ff0;font-weight:bold">2</span>);
</span></span><span style="display:flex;"><span>    list.<span style="color:#007f7f">add</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    List&lt;CompletableFuture&lt;Integer&gt;&gt; futureList = list.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// åœ¨è¿™é‡Œå¼‚æ­¥æ‰§è¡Œä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            .<span style="color:#007f7f">map</span>(i -&gt; CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; i + <span style="color:#ff0;font-weight:bold">1</span>))
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    CompletableFuture&lt;Void&gt; allOf = CompletableFuture
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">allOf</span>(futureList.<span style="color:#007f7f">toArray</span>(<span style="color:#fff;font-weight:bold">new</span> CompletableFuture[futureList.<span style="color:#007f7f">size</span>()]));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    List&lt;Integer&gt; resultList = allOf
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">thenApply</span>(i -&gt; futureList.<span style="color:#007f7f">stream</span>()
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// è·å–è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                    .<span style="color:#007f7f">map</span>(j -&gt; j.<span style="color:#007f7f">join</span>())
</span></span><span style="display:flex;"><span>                    .<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>()))
</span></span><span style="display:flex;"><span>            .<span style="color:#007f7f">join</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ‰“å°è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">for</span> (Integer i : resultList) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(i);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹ä¸Šé¢çš„æ–¹æ³•è¿›è¡Œå°è£…ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span>@AllArgsConstructor
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> FutureTaskWorker&lt;T, R&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> List&lt;T&gt; taskList;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * éœ€è¦æ‰§è¡Œçš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Function&lt;T, CompletableFuture&lt;R&gt;&gt; workFunction;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æœé›†æ‰§è¡Œç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> List&lt;R&gt; getAllResult() {
</span></span><span style="display:flex;"><span>        List&lt;CompletableFuture&lt;R&gt;&gt; futureList = taskList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">map</span>(workFunction).<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>());
</span></span><span style="display:flex;"><span>        CompletableFuture&lt;Void&gt; allCompletableFuture = CompletableFuture.<span style="color:#007f7f">allOf</span>(futureList.<span style="color:#007f7f">toArray</span>(<span style="color:#fff;font-weight:bold">new</span> CompletableFuture[futureList.<span style="color:#007f7f">size</span>()]));
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> allCompletableFuture.<span style="color:#007f7f">thenApply</span>(e -&gt; futureList.<span style="color:#007f7f">stream</span>().<span style="color:#007f7f">map</span>(CompletableFuture::join).<span style="color:#007f7f">collect</span>(Collectors.<span style="color:#007f7f">toList</span>())).<span style="color:#007f7f">join</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// è°ƒç”¨å°è£…çš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> allOf4(){
</span></span><span style="display:flex;"><span>    List&lt;Integer&gt; list = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    list.<span style="color:#007f7f">add</span>(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>    list.<span style="color:#007f7f">add</span>(<span style="color:#ff0;font-weight:bold">2</span>);
</span></span><span style="display:flex;"><span>    list.<span style="color:#007f7f">add</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    FutureTaskWorker&lt;Integer, Integer&gt; worker = <span style="color:#fff;font-weight:bold">new</span> FutureTaskWorker&lt;&gt;(list,
</span></span><span style="display:flex;"><span>            i -&gt; CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; i + <span style="color:#ff0;font-weight:bold">1</span>));
</span></span><span style="display:flex;"><span>    List&lt;Integer&gt; result = worker.<span style="color:#007f7f">getAllResult</span>();
</span></span><span style="display:flex;"><span>    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="anyof">anyOf()<a hidden class="anchor" aria-hidden="true" href="#anyof">#</a></h3>
<p>anyOf å¯ä»¥æ¥å—å¤šä¸ª CompletableFuture å‚æ•°ã€‚å…¶ä¸­ä»»æ„ä¸€ä¸ª CompletableFuture ç»“æŸï¼Œå°±å¯ä»¥æ‰§è¡Œåç»­çš„ä»£ç ï¼Œæ— é¡»åƒ allOf() é‚£æ ·ï¼Œéœ€è¦ç­‰å¾…æ‰€æœ‰çš„ CompletableFuture ç»“æŸã€‚
å› ä¸ºæ¯ä¸ª CompletableFuture çš„è¿”å›å€¼ç±»å‹å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥æ— æ³•ç¡®å®šè¿”å›ç±»å‹æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥ anyOf çš„è¿”å›å€¼æ˜¯<code>CompletableFuture&lt;Object&gt;</code>ç±»å‹ã€‚ è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æµ‹è¯•anyOf
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> anyOf() <span style="color:#fff;font-weight:bold">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>        CompletableFuture&lt;String&gt; future1 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;future1çš„æ‰§è¡Œç»“æœ&#34;</span>;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        CompletableFuture&lt;String&gt; future2 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">2</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;future2çš„æ‰§è¡Œç»“æœ&#34;</span>;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        CompletableFuture&lt;String&gt; future3 = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;future3çš„æ‰§è¡Œç»“æœ&#34;</span>;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        CompletableFuture&lt;Object&gt; anyOf = CompletableFuture.<span style="color:#007f7f">anyOf</span>(future1, future2, future3);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(anyOf.<span style="color:#007f7f">get</span>());
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>3 ä¸ª future ä¸­ï¼Œfuture3 ç¡çœ æ—¶é—´æœ€çŸ­ï¼Œä¼šæœ€å…ˆæ‰§è¡Œå®Œæˆï¼Œ<code>anyOfFuture.get()</code>è·å–çš„ä¹Ÿå°±æ˜¯ future2 çš„å†…å®¹ã€‚future1ã€future3 çš„ è¿”å›ç»“æœè¢«ä¸¢å¼ƒäº†ã€‚</p>
<h1 id="forkjoin">ForkJoin<a hidden class="anchor" aria-hidden="true" href="#forkjoin">#</a></h1>
<p>Java 7å¼€å§‹å¼•å…¥äº†ä¸€ç§æ–°çš„Fork/Joinçº¿ç¨‹æ± ï¼Œå®ƒå¯ä»¥æ‰§è¡Œä¸€ç§ç‰¹æ®Šçš„ä»»åŠ¡ï¼šæŠŠä¸€ä¸ªå¤§ä»»åŠ¡æ‹†æˆå¤šä¸ªå°ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œã€‚
ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœè¦è®¡ç®—ä¸€ä¸ªè¶…å¤§æ•°ç»„çš„å’Œï¼Œæœ€ç®€å•çš„åšæ³•æ˜¯ç”¨ä¸€ä¸ªå¾ªç¯åœ¨ä¸€ä¸ªçº¿ç¨‹å†…å®Œæˆï¼š
â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”
â””â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”˜</p>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥æŠŠæ•°ç»„æ‹†æˆä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«è®¡ç®—ï¼Œæœ€ååŠ èµ·æ¥å°±æ˜¯æœ€ç»ˆç»“æœï¼Œè¿™æ ·å¯ä»¥ç”¨ä¸¤ä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼š</p>
<p>â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”
â””â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”˜
â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”
â””â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”˜
å¦‚æœæ‹†æˆä¸¤éƒ¨åˆ†è¿˜æ˜¯å¾ˆå¤§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­æ‹†ï¼Œç”¨4ä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼š</p>
<p>â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”
â””â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”˜
â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”
â””â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”˜
â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”
â””â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”˜
â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”
â””â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”˜
è¿™å°±æ˜¯Fork/Joinä»»åŠ¡çš„åŸç†ï¼šåˆ¤æ–­ä¸€ä¸ªä»»åŠ¡æ˜¯å¦è¶³å¤Ÿå°ï¼Œå¦‚æœæ˜¯ï¼Œç›´æ¥è®¡ç®—ï¼Œå¦åˆ™ï¼Œå°±åˆ†æ‹†æˆå‡ ä¸ªå°ä»»åŠ¡åˆ†åˆ«è®¡ç®—ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥åå¤â€œè£‚å˜â€æˆä¸€ç³»åˆ—å°ä»»åŠ¡ã€‚</p>
<p>ä¸»è¦æœ‰ä¸¤æ­¥ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šä»»åŠ¡åˆ‡åˆ†</li>
<li>ç¬¬äºŒæ­¥ï¼šç»“æœåˆå¹¶</li>
</ul>
<p>çº¿ç¨‹æ± ä¸­çš„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œé˜Ÿåˆ—ï¼Œå½“è‡ªå·±é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½å®Œæˆä»¥åï¼Œä¼šä»å…¶å®ƒçº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—ä¸­å·ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥å……åˆ†åˆ©ç”¨èµ„æºã€‚
PSï¼šè¿™ä¸€ç‚¹å’ŒThreadPoolExecutorä¸åŒï¼ŒThreadPoolExecutoræ˜¯æ‰€æœ‰çº¿ç¨‹å…¬ç”¨ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½ä»è¿™ä¸ªå·¥ä½œé˜Ÿåˆ—ä¸­å–ä»»åŠ¡ã€‚</p>
<h2 id="å·¥ä½œçªƒå–work-stealing">å·¥ä½œçªƒå–ï¼ˆwork-stealingï¼‰<a hidden class="anchor" aria-hidden="true" href="#å·¥ä½œçªƒå–work-stealing">#</a></h2>
<p>å·¥ä½œçªƒå–ï¼ˆwork-stealingï¼‰ç®—æ³•æ˜¯æŒ‡æŸä¸ªçº¿ç¨‹ä»å…¶ä»–é˜Ÿåˆ—é‡Œçªƒå–ä»»åŠ¡æ¥æ‰§è¡Œã€‚
é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å·¥ä½œçªƒå–ç®—æ³•å‘¢ï¼Ÿ</p>
<p>å‡å¦‚æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªæ¯”è¾ƒå¤§çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªä»»åŠ¡åˆ†å‰²ä¸ºè‹¥å¹²äº’ä¸ä¾èµ–çš„å­ä»»åŠ¡ï¼Œä¸ºäº†å‡å°‘çº¿ç¨‹é—´çš„ç«äº‰ï¼Œäºæ˜¯æŠŠè¿™äº›å­ä»»åŠ¡åˆ†åˆ«æ”¾åˆ°ä¸åŒçš„é˜Ÿåˆ—é‡Œï¼Œå¹¶ä¸ºæ¯ä¸ªé˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥æ‰§è¡Œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œçº¿ç¨‹å’Œé˜Ÿåˆ—ä¸€ä¸€å¯¹åº”ï¼Œæ¯”å¦‚Açº¿ç¨‹è´Ÿè´£å¤„ç†Aé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ã€‚ä½†æ˜¯æœ‰çš„çº¿ç¨‹ä¼šå…ˆæŠŠè‡ªå·±é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡å¹²å®Œï¼Œè€Œå…¶ä»–çº¿ç¨‹å¯¹åº”çš„é˜Ÿåˆ—é‡Œè¿˜æœ‰ä»»åŠ¡ç­‰å¾…å¤„ç†ã€‚å¹²å®Œæ´»çš„çº¿ç¨‹ä¸å…¶ç­‰ç€ï¼Œä¸å¦‚å»å¸®å…¶ä»–çº¿ç¨‹å¹²æ´»ï¼Œäºæ˜¯å®ƒå°±å»å…¶ä»–çº¿ç¨‹çš„é˜Ÿåˆ—é‡Œçªƒå–ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚è€Œåœ¨è¿™æ—¶å®ƒä»¬ä¼šè®¿é—®åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¸ºäº†å‡å°‘çªƒå–ä»»åŠ¡çº¿ç¨‹å’Œè¢«çªƒå–ä»»åŠ¡çº¿ç¨‹ä¹‹é—´çš„ç«äº‰ï¼Œé€šå¸¸ä¼šä½¿ç”¨åŒç«¯é˜Ÿåˆ—ï¼Œè¢«çªƒå–ä»»åŠ¡çº¿ç¨‹æ°¸è¿œä»åŒç«¯é˜Ÿåˆ—çš„å¤´éƒ¨æ‹¿ä»»åŠ¡æ‰§è¡Œï¼Œè€Œçªƒå–ä»»åŠ¡çš„çº¿ç¨‹æ°¸è¿œä»åŒç«¯é˜Ÿåˆ—çš„å°¾éƒ¨æ‹¿ä»»åŠ¡æ‰§è¡Œã€‚</p>
<p>å·¥ä½œçªƒå–ç®—æ³•çš„ä¼˜ç‚¹æ˜¯å……åˆ†åˆ©ç”¨çº¿ç¨‹è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œå¹¶å‡å°‘äº†çº¿ç¨‹é—´çš„ç«äº‰ï¼Œå…¶ç¼ºç‚¹æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹è¿˜æ˜¯å­˜åœ¨ç«äº‰ï¼Œæ¯”å¦‚åŒç«¯é˜Ÿåˆ—é‡Œåªæœ‰ä¸€ä¸ªä»»åŠ¡æ—¶ã€‚å¹¶ä¸”æ¶ˆè€—äº†æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚åˆ›å»ºå¤šä¸ªçº¿ç¨‹å’Œå¤šä¸ªåŒç«¯é˜Ÿåˆ—ã€‚</p>
<h2 id="æ ¸å¿ƒç±»">æ ¸å¿ƒç±»<a hidden class="anchor" aria-hidden="true" href="#æ ¸å¿ƒç±»">#</a></h2>
<h3 id="forkjoinpool">ForkJoinPool<a hidden class="anchor" aria-hidden="true" href="#forkjoinpool">#</a></h3>
<p>ForkJoinPoolä¸å…¶å®ƒçš„ExecutorServiceåŒºåˆ«ä¸»è¦åœ¨äºå®ƒä½¿ç”¨â€œå·¥ä½œçªƒå–â€ï¼šçº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼å›¾æ‰¾åˆ°å¹¶æ‰§è¡Œæäº¤ç»™çº¿ç¨‹æ± çš„ä»»åŠ¡ã€‚å½“å¤§é‡çš„ä»»åŠ¡äº§ç”Ÿå­ä»»åŠ¡çš„æ—¶å€™ï¼Œæˆ–è€…åŒæ—¶å½“æœ‰è®¸å¤šå°ä»»åŠ¡è¢«æäº¤åˆ°çº¿ç¨‹æ± ä¸­çš„æ—¶å€™ï¼Œè¿™ç§å¤„ç†æ˜¯éå¸¸é«˜æ•ˆçš„ã€‚ç‰¹åˆ«çš„ï¼Œå½“åœ¨æ„é€ æ–¹æ³•ä¸­è®¾ç½®asyncModeä¸ºtrueçš„æ—¶å€™è¿™ç§å¤„ç†æ›´åŠ é«˜æ•ˆã€‚
WorkQueueæ˜¯ä¸€ä¸ªForkJoinPoolä¸­çš„å†…éƒ¨ç±»ï¼Œå®ƒæ˜¯çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—çš„ä¸€ä¸ªå°è£…ï¼Œæ”¯æŒä»»åŠ¡çªƒå–ã€‚</p>
<h3 id="forkjointask">ForkJoinTask<a hidden class="anchor" aria-hidden="true" href="#forkjointask">#</a></h3>
<p>ForkJoinTaskä»£è¡¨è¿è¡Œåœ¨ForkJoinPoolä¸­çš„ä»»åŠ¡ã€‚</p>
<p>ä¸»è¦æ–¹æ³•ï¼š</p>
<ul>
<li>fork()</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> ForkJoinTask&lt;V&gt; fork() {
</span></span><span style="display:flex;"><span>        Thread t;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((t = Thread.<span style="color:#007f7f">currentThread</span>()) <span style="color:#fff;font-weight:bold">instanceof</span> ForkJoinWorkerThread)
</span></span><span style="display:flex;"><span>            ((ForkJoinWorkerThread)t).<span style="color:#007f7f">workQueue</span>.<span style="color:#007f7f">push</span>(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            ForkJoinPool.<span style="color:#007f7f">common</span>.<span style="color:#007f7f">externalPush</span>(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>join()ï¼šä»»åŠ¡å®Œæˆæ—¶ï¼Œè¿”å›è®¡ç®—ç»“æœã€‚</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> V join() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> s;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((s = doJoin() &amp; DONE_MASK) != NORMAL)
</span></span><span style="display:flex;"><span>            reportException(s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> getRawResult();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>invoke()ï¼šå¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœå¿…è¦ï¼Œç­‰å¾…è®¡ç®—å®Œæˆã€‚</li>
</ul>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">final</span> V invoke() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> s;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> ((s = doInvoke() &amp; DONE_MASK) != NORMAL)
</span></span><span style="display:flex;"><span>            reportException(s);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> getRawResult();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>å­ç±»ï¼š</p>
<ul>
<li>RecursiveActionï¼šä¸€ä¸ªé€’å½’æ— ç»“æœçš„ForkJoinTaskï¼ˆæ²¡æœ‰è¿”å›å€¼ï¼‰</li>
<li>RecursiveTaskï¼šä¸€ä¸ªé€’å½’æœ‰ç»“æœçš„ForkJoinTaskï¼ˆæœ‰è¿”å›å€¼ï¼‰</li>
</ul>
<h3 id="forkjoinworkerthread">ForkJoinWorkerThread<a hidden class="anchor" aria-hidden="true" href="#forkjoinworkerthread">#</a></h3>
<p>ForkJoinWorkerThreadä»£è¡¨ForkJoinPoolçº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">final</span> ForkJoinPool pool;                <span style="color:#007f7f">// the pool this thread works in
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">final</span> ForkJoinPool.<span style="color:#007f7f">WorkQueue</span> workQueue; <span style="color:#007f7f">// work-stealing mechanics
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼ŒForkJoinWorkThreadæŒæœ‰ForkJoinPoolå’ŒForkJoinPool.WorkQueueçš„å¼•ç”¨ï¼Œä»¥è¡¨æ˜è¯¥çº¿ç¨‹å±äºå“ªä¸ªçº¿ç¨‹æ± ï¼Œå®ƒçš„å·¥ä½œé˜Ÿåˆ—æ˜¯å“ªä¸ªã€‚</p>
<h2 id="ç¤ºä¾‹">ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹">#</a></h2>
<h3 id="å¯¹å¤§æ•°æ±‚å’Œéœ€è¦å­çº¿ç¨‹çš„è¿”å›ç»“æœ">å¯¹å¤§æ•°æ±‚å’Œï¼šéœ€è¦å­çº¿ç¨‹çš„è¿”å›ç»“æœ<a hidden class="anchor" aria-hidden="true" href="#å¯¹å¤§æ•°æ±‚å’Œéœ€è¦å­çº¿ç¨‹çš„è¿”å›ç»“æœ">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ForkJoinTest {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»º2000ä¸ªéšæœºæ•°ç»„æˆçš„æ•°ç»„:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">long</span>[] array = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">long</span>[<span style="color:#ff0;font-weight:bold">2000</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span> expectedSum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; array.<span style="color:#007f7f">length</span>; i++) {
</span></span><span style="display:flex;"><span>            array[i] = random();
</span></span><span style="display:flex;"><span>            expectedSum += array[i];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;é¢„æœŸç»“æœï¼šExpected sum: &#34;</span> + expectedSum);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// fork/join:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ForkJoinTask&lt;Long&gt; task = <span style="color:#fff;font-weight:bold">new</span> SumTask(array, <span style="color:#ff0;font-weight:bold">0</span>, array.<span style="color:#007f7f">length</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span> startTime = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        Long result = ForkJoinPool.<span style="color:#007f7f">commonPool</span>().<span style="color:#007f7f">invoke</span>(task);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span> endTime = System.<span style="color:#007f7f">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Fork/joinçš„ç»“æœ sum: &#34;</span> + result + <span style="color:#0ff;font-weight:bold">&#34; æ‰§è¡Œæ—¶é—´æ˜¯ &#34;</span> + (endTime - startTime) + <span style="color:#0ff;font-weight:bold">&#34; ms.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> Random random = <span style="color:#fff;font-weight:bold">new</span> Random(<span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">long</span> random() {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> random.<span style="color:#007f7f">nextInt</span>(<span style="color:#ff0;font-weight:bold">10000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> SumTask <span style="color:#fff;font-weight:bold">extends</span> RecursiveTask&lt;Long&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//é˜ˆå€¼
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> THRESHOLD = <span style="color:#ff0;font-weight:bold">500</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">long</span>[] array;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> start;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> end;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SumTask(<span style="color:#fff;font-weight:bold">long</span>[] array, <span style="color:#fff;font-weight:bold">int</span> start, <span style="color:#fff;font-weight:bold">int</span> end) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">array</span> = array;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">start</span> = start;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">end</span> = end;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">protected</span> Long compute() {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// å¦‚æœä»»åŠ¡è¶³å¤Ÿå°,ç›´æ¥è®¡ç®—:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">if</span> (end - start &lt;= THRESHOLD) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">long</span> sum = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = start; i &lt; end; i++) {
</span></span><span style="display:flex;"><span>                sum += <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">array</span>[i];
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// æ•…æ„æ”¾æ…¢è®¡ç®—é€Ÿåº¦:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                    Thread.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>                } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> sum;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// ä»»åŠ¡å¤ªå¤§ï¼Œä¸€åˆ†ä¸ºäºŒ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">int</span> middle = (end + start) / <span style="color:#ff0;font-weight:bold">2</span>;
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(String.<span style="color:#007f7f">format</span>(<span style="color:#0ff;font-weight:bold">&#34;split %d~%d ==&gt; %d~%d, %d~%d&#34;</span>, start, end, start, middle, middle, end));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        SumTask subTask1 = <span style="color:#fff;font-weight:bold">new</span> SumTask(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">array</span>, start, middle);
</span></span><span style="display:flex;"><span>        SumTask subTask2 = <span style="color:#fff;font-weight:bold">new</span> SumTask(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">array</span>, middle, end);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        invokeAll(subTask1, subTask2);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Long subResult1 = subTask1.<span style="color:#007f7f">join</span>();
</span></span><span style="display:flex;"><span>        Long subResult2 = subTask2.<span style="color:#007f7f">join</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Long result = subResult1 + subResult2;
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;result = &#34;</span> + subResult1 + <span style="color:#0ff;font-weight:bold">&#34; + &#34;</span> + subResult2 + <span style="color:#0ff;font-weight:bold">&#34; ==&gt; &#34;</span> + result);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ‰¹é‡å‘é€æ¶ˆæ¯ä¸éœ€è¦å­çº¿ç¨‹çš„è¿”å›å€¼">æ‰¹é‡å‘é€æ¶ˆæ¯ï¼šä¸éœ€è¦å­çº¿ç¨‹çš„è¿”å›å€¼<a hidden class="anchor" aria-hidden="true" href="#æ‰¹é‡å‘é€æ¶ˆæ¯ä¸éœ€è¦å­çº¿ç¨‹çš„è¿”å›å€¼">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ForkJoinPoolDemo {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> InterruptedException {
</span></span><span style="display:flex;"><span>        List&lt;String&gt; list = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">123</span>; i++) {
</span></span><span style="display:flex;"><span>            list.<span style="color:#007f7f">add</span>(String.<span style="color:#007f7f">valueOf</span>(i+<span style="color:#ff0;font-weight:bold">1</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ForkJoinPool pool = <span style="color:#fff;font-weight:bold">new</span> ForkJoinPool();
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">submit</span>(<span style="color:#fff;font-weight:bold">new</span> ForkJoinPoolDemo().<span style="color:#007f7f">new</span> SendMsgTask(<span style="color:#ff0;font-weight:bold">0</span>, list.<span style="color:#007f7f">size</span>(), list));
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">awaitTermination</span>(<span style="color:#ff0;font-weight:bold">10</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>);
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">class</span> SendMsgTask <span style="color:#fff;font-weight:bold">extends</span> RecursiveAction {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> THRESHOLD = <span style="color:#ff0;font-weight:bold">10</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> start;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> end;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">private</span> List&lt;String&gt; list;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> SendMsgTask(<span style="color:#fff;font-weight:bold">int</span> start, <span style="color:#fff;font-weight:bold">int</span> end, List&lt;String&gt; list) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">start</span> = start;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">end</span> = end;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">list</span> = list;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> compute() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (end - start &lt;= THRESHOLD) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = start; i &lt; end; i++) {
</span></span><span style="display:flex;"><span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34;: &#34;</span> + list.<span style="color:#007f7f">get</span>(i));
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }<span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">int</span> middle = (start + end) / <span style="color:#ff0;font-weight:bold">2</span>;
</span></span><span style="display:flex;"><span>                invokeAll(<span style="color:#fff;font-weight:bold">new</span> SendMsgTask(start, middle, list), <span style="color:#fff;font-weight:bold">new</span> SendMsgTask(middle, end, list));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ•°ç»„æ’åº">æ•°ç»„æ’åº<a hidden class="anchor" aria-hidden="true" href="#æ•°ç»„æ’åº">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.test;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Arrays;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> RecursiveActionDemo {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> SortTask <span style="color:#fff;font-weight:bold">extends</span> RecursiveAction {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> THRESHOLD = <span style="color:#ff0;font-weight:bold">100</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">long</span>[] array;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> lo, hi;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> SortTask(<span style="color:#fff;font-weight:bold">long</span>[] array, <span style="color:#fff;font-weight:bold">int</span> lo, <span style="color:#fff;font-weight:bold">int</span> hi) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">array</span> = array;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">lo</span> = lo;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">hi</span> = hi;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> SortTask(<span style="color:#fff;font-weight:bold">long</span>[] array) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>(array, <span style="color:#ff0;font-weight:bold">0</span>, array.<span style="color:#007f7f">length</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> sortSequentially(<span style="color:#fff;font-weight:bold">int</span> lo, <span style="color:#fff;font-weight:bold">int</span> hi) {
</span></span><span style="display:flex;"><span>            Arrays.<span style="color:#007f7f">sort</span>(array, lo, hi);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> merge(<span style="color:#fff;font-weight:bold">int</span> lo, <span style="color:#fff;font-weight:bold">int</span> mid, <span style="color:#fff;font-weight:bold">int</span> hi) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">long</span>[] buf = Arrays.<span style="color:#007f7f">copyOfRange</span>(array, lo, mid);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>, j = lo, k = mid; i &lt; buf.<span style="color:#007f7f">length</span>; j++) {
</span></span><span style="display:flex;"><span>                array[j] = (k == hi || buf[i] &lt; array[k]) ? buf[i++] : array[k++];
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> compute() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (hi - lo &lt; THRESHOLD) {
</span></span><span style="display:flex;"><span>                sortSequentially(lo, hi);
</span></span><span style="display:flex;"><span>            }<span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">int</span> mid = (lo + hi) &gt;&gt;&gt; <span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>                invokeAll(<span style="color:#fff;font-weight:bold">new</span> SortTask(array, lo, mid), <span style="color:#fff;font-weight:bold">new</span> SortTask(array, mid, hi));
</span></span><span style="display:flex;"><span>                merge(lo, mid, hi);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">long</span>[] array = <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">long</span>[<span style="color:#ff0;font-weight:bold">120</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; array.<span style="color:#007f7f">length</span>; i++) {
</span></span><span style="display:flex;"><span>            array[i] = (<span style="color:#fff;font-weight:bold">long</span>) (Math.<span style="color:#007f7f">random</span>() * <span style="color:#ff0;font-weight:bold">1000</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ç”Ÿæˆä¸€ä¸ªæ•°ç»„ï¼š&#34;</span> + Arrays.<span style="color:#007f7f">toString</span>(array));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ForkJoinPool pool = <span style="color:#fff;font-weight:bold">new</span> ForkJoinPool();
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">submit</span>(<span style="color:#fff;font-weight:bold">new</span> SortTask(array));
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">awaitTermination</span>(<span style="color:#ff0;font-weight:bold">5</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>);
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ•°ç»„æ’åºå®Œæ¯•ï¼š&#34;</span> + Arrays.<span style="color:#007f7f">toString</span>(array));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–æ³¢é‚£å¥‘æ•°åˆ—">æ–æ³¢é‚£å¥‘æ•°åˆ—<a hidden class="anchor" aria-hidden="true" href="#æ–æ³¢é‚£å¥‘æ•°åˆ—">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.wjy.test;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ForkJoinPoolDemo {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">class</span> Fibonacci <span style="color:#fff;font-weight:bold">extends</span> RecursiveTask&lt;Integer&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> n;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">public</span> Fibonacci(<span style="color:#fff;font-weight:bold">int</span> n) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">n</span> = n;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">protected</span> Integer compute() {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (n &lt;= <span style="color:#ff0;font-weight:bold">1</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> n;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            Fibonacci f1 = <span style="color:#fff;font-weight:bold">new</span> Fibonacci(n - <span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>            f1.<span style="color:#007f7f">fork</span>();
</span></span><span style="display:flex;"><span>            Fibonacci f2 = <span style="color:#fff;font-weight:bold">new</span> Fibonacci(n - <span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> f2.<span style="color:#007f7f">compute</span>() + f1.<span style="color:#007f7f">join</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> InterruptedException, ExecutionException {
</span></span><span style="display:flex;"><span>        ForkJoinPool pool = <span style="color:#fff;font-weight:bold">new</span> ForkJoinPool();
</span></span><span style="display:flex;"><span>        Future&lt;Integer&gt; future = pool.<span style="color:#007f7f">submit</span>(<span style="color:#fff;font-weight:bold">new</span> Fibonacci(<span style="color:#ff0;font-weight:bold">10</span>));
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(future.<span style="color:#007f7f">get</span>());
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">shutdown</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="http://gee.cs.oswego.edu/dl/papers/fj.pdf">å‚è€ƒDoug Leaæœ¬äººå†™çš„pdf</a></p>
<h1 id="javaä¸­çš„å‡ ç§çº¿ç¨‹æ± ">javaä¸­çš„å‡ ç§çº¿ç¨‹æ± <a hidden class="anchor" aria-hidden="true" href="#javaä¸­çš„å‡ ç§çº¿ç¨‹æ± ">#</a></h1>
<p>Javaé€šè¿‡Executorsæä¾›5ç§çº¿ç¨‹æ± ï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>
<p>newFixedThreadPool
åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼Œè¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚
<code>ExecutorService executorService = Executors.newFixedThreadPool(2);</code></p>
</li>
<li>
<p>newCachedThreadPool
åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹ã€‚
çº¿ç¨‹æ± ä¸ºæ— é™å¤§ï¼Œå½“æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶ç¬¬ä¸€ä¸ªä»»åŠ¡å·²ç»å®Œæˆï¼Œä¼šå¤ç”¨æ‰§è¡Œç¬¬ä¸€ä¸ªä»»åŠ¡çš„çº¿ç¨‹ï¼Œè€Œä¸ç”¨æ¯æ¬¡æ–°å»ºçº¿ç¨‹ã€‚å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼Œä¸€èˆ¬ä½¿ç”¨newFixedThreadPoolä»£æ›¿ã€‚
<code>ExecutorService executorService = Executors.newCachedThreadPool();</code></p>
</li>
<li>
<p>newScheduledThreadPool
åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚
<code>ExecutorService executorService = Executors.newScheduledThreadPool(2);</code></p>
</li>
<li>
<p>newSingleThreadExecutor
åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚
<code>ExecutorService executorService = Executors.newSingleThreadExecutor();</code></p>
</li>
<li>
<p>newSingleThreadScheduledExecutor
åˆ›å»ºåªæœ‰ä¸€æ¡çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä»–å¯ä»¥åœ¨æŒ‡å®šå»¶è¿Ÿåæ‰§è¡Œçº¿ç¨‹ä»»åŠ¡</p>
</li>
<li>
<p>newWorkStealingPoolï¼ˆjdk1.8æ–°å¢ï¼‰
stealing ç¿»è¯‘ä¸ºæŠ¢æ–­ã€çªƒå–çš„æ„æ€ï¼Œä¸Šè¾¹å››ç§çº¿ç¨‹æ± æ˜¯é€šè¿‡<code>ThreadPoolExecutor</code>å®ç°çš„ï¼Œè€Œ<code>newWorkStealingPool</code>æ˜¯é€šè¿‡<code>ForkJoinPool</code>å®ç°çš„ã€‚
newWorkStealingPoolä¼šæ ¹æ®æ‰€éœ€çš„å¹¶è¡Œå±‚æ¬¡æ¥åŠ¨æ€åˆ›å»ºå’Œå…³é—­çº¿ç¨‹ã€‚è¿™æ˜¯ä¸€ä¸ªå¹¶è¡Œçº¿ç¨‹æ± ï¼Œå‚æ•°ä¸­ä¼ å…¥çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹å¹¶å‘çš„æ•°é‡ã€‚
è¿™ä¸ªçº¿ç¨‹æ± å’Œå…¶ä»–çº¿ç¨‹æ± æœ‰å¾ˆæ˜æ˜¾çš„åŒºåˆ«ï¼Œå‰é¢4ç§çº¿ç¨‹æ± éƒ½æœ‰æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ç­‰ç­‰ï¼Œè€Œè¿™ä¸ªçº¿ç¨‹æ± åªä½¿ç”¨ä¸€ä¸ªå¹¶å‘çº¿ç¨‹æ•°æ¥è§£å†³é—®é¢˜ã€‚
ä»ä»‹ç»ä¸­ï¼Œè¿˜è¯´æ˜è¿™ä¸ªçº¿ç¨‹æ± ä¸ä¼šä¿è¯ä»»åŠ¡çš„é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ WorkStealing çš„æ„æ€ï¼ŒæŠ¢å å¼çš„å·¥ä½œã€‚å³ä»»åŠ¡çš„æ‰§è¡Œæ˜¯æ— åºçš„ï¼Œå“ªä¸ªçº¿ç¨‹æŠ¢åˆ°ä»»åŠ¡ï¼Œå°±ç”±å®ƒæ‰§è¡Œã€‚
<code>ExecutorService executorService = Executors.newWorkStealingPool();</code></p>
</li>
</ul>
<h2 id="newsinglethreadexecutor">newSingleThreadExecutor<a hidden class="anchor" aria-hidden="true" href="#newsinglethreadexecutor">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ExecutorService newSingleThreadExecutor() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> Executors.<span style="color:#007f7f">FinalizableDelegatedExecutorService</span>
</span></span><span style="display:flex;"><span>            (<span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#ff0;font-weight:bold">0</span>L, TimeUnit.<span style="color:#007f7f">MILLISECONDS</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>LinkedBlockingQueue</code>æ˜¯ä¸€ä¸ªæ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡è¯·æ±‚ï¼Œä¸å»ºè®®ä½¿ç”¨è¯¥çº¿ç¨‹æ± ã€‚
åˆ›å»ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä¸”çº¿ç¨‹çš„å­˜æ´»æ—¶é—´æ˜¯æ— é™çš„ï¼›å½“è¯¥çº¿ç¨‹æ­£ç¹å¿™æ—¶ï¼Œå¯¹äºæ–°ä»»åŠ¡ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—ä¸­ï¼ˆæ— ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼‰ã€‚é€‚ç”¨ï¼šåªæœ‰ä¸€ä¸ªä»»åŠ¡çš„åœºæ™¯ï¼ˆé‚£æˆ‘è¿˜ç”¨ä½ å¹²å˜›ï¼Ÿï¼‰</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> singleTheadPoolTest() {
</span></span><span style="display:flex;"><span>    ExecutorService pool = Executors.<span style="color:#007f7f">newSingleThreadExecutor</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">10</span>; i++) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> ii = i;
</span></span><span style="display:flex;"><span>        pool.<span style="color:#007f7f">execute</span>(() -&gt; out.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34;=&gt;&#34;</span> + ii));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œç»“æœ:
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ0
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ1
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ2
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ3
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ4
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ5
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ6
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ7
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ8
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ9</p>
<p><img loading="lazy" src="7.gif" alt=""  />

ç”±äºæˆ‘ä»¬çš„çº¿ç¨‹æ± ä¸­ä½¿ç”¨çš„ä»å§‹è‡³ç»ˆéƒ½æ˜¯å•ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥è¿™é‡Œçš„çº¿ç¨‹åå­—éƒ½æ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”ä¸‹è½½ä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„æ¥ï¼Œç›´åˆ°æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œä»»åŠ¡ï¼Œå¦åˆ™éƒ½æ˜¯ç­‰å¾…çŠ¶æ€ã€‚</p>
<h2 id="newfixedthreadpool-1">newFixedThreadPool<a hidden class="anchor" aria-hidden="true" href="#newfixedthreadpool-1">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ExecutorService newFixedThreadPool(<span style="color:#fff;font-weight:bold">int</span> nThreads) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(nThreads, nThreads,
</span></span><span style="display:flex;"><span>            <span style="color:#ff0;font-weight:bold">0</span>L, TimeUnit.<span style="color:#007f7f">MILLISECONDS</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">new</span> LinkedBlockingQueue&lt;Runnable&gt;());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>LinkedBlockingQueue</code>æ˜¯ä¸€ä¸ªæ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡è¯·æ±‚ï¼Œä¸å»ºè®®ä½¿ç”¨è¯¥çº¿ç¨‹æ± ã€‚
åˆ›å»ºå¯å®¹çº³å›ºå®šæ•°é‡çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ¯ä¸ªçº¿ç¨‹çš„å­˜æ´»æ—¶é—´æ˜¯æ— é™çš„ï¼Œå½“æ± å­æ»¡äº†å°±ä¸åœ¨æ·»åŠ çº¿ç¨‹äº†ï¼›å¦‚æœæ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹å‡åœ¨ç¹å¿™çŠ¶æ€ï¼Œå¯¹äºæ–°ä»»åŠ¡ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—ä¸­ï¼ˆæ— ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼‰</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 1.åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚æ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°çº¿ç¨‹è¾¾åˆ°çº¿ç¨‹æ± çš„æœ€å¤§å¤§å°&lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 2.çº¿ç¨‹æ± çš„å¤§å°ä¸€æ—¦è¾¾åˆ°æœ€å¤§å€¼å°±ä¼šä¿æŒä¸å˜ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å› ä¸ºæ‰§è¡Œå¼‚å¸¸è€Œç»“æŸï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šè¡¥å……ä¸€ä¸ªæ–°çº¿ç¨‹&lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 3.å› ä¸ºçº¿ç¨‹æ± å¤§å°ä¸º3ï¼Œæ¯ä¸ªä»»åŠ¡è¾“å‡ºindexåsleep 2ç§’ï¼Œæ‰€ä»¥æ¯ä¸¤ç§’æ‰“å°3ä¸ªæ•°å­—ï¼Œå’Œçº¿ç¨‹åç§°&lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> fixTheadPoolTest() {
</span></span><span style="display:flex;"><span>	ExecutorService fixedThreadPool = Executors.<span style="color:#007f7f">newFixedThreadPool</span>(<span style="color:#ff0;font-weight:bold">3</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">10</span>; i++) {
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> ii = i;
</span></span><span style="display:flex;"><span>		fixedThreadPool.<span style="color:#007f7f">execute</span>(() -&gt; {
</span></span><span style="display:flex;"><span>			out.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;çº¿ç¨‹åç§°ï¼š&#34;</span> + Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34;ï¼Œæ‰§è¡Œ&#34;</span> + ii);
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>				Thread.<span style="color:#007f7f">sleep</span>(<span style="color:#ff0;font-weight:bold">2000</span>);
</span></span><span style="display:flex;"><span>			} <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>				e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		});
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œç»“æœ:
çº¿ç¨‹åç§°ï¼špool-1-thread-3ï¼Œæ‰§è¡Œ2
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ0
çº¿ç¨‹åç§°ï¼špool-1-thread-2ï¼Œæ‰§è¡Œ3
çº¿ç¨‹åç§°ï¼špool-1-thread-3ï¼Œæ‰§è¡Œ4
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ5
çº¿ç¨‹åç§°ï¼špool-1-thread-2ï¼Œæ‰§è¡Œ6
çº¿ç¨‹åç§°ï¼špool-1-thread-3ï¼Œæ‰§è¡Œ7
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ8
çº¿ç¨‹åç§°ï¼špool-1-thread-3ï¼Œæ‰§è¡Œ9</p>
<p>æˆ‘ä»¬é€šè¿‡newFixedThreadPoolï¼ˆ2ï¼‰ç»™å®ƒä¼ å…¥äº† 2 ä¸ªæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œçœ‹çœ‹ä¸‹è½½æ•ˆæœå¦‚ä½•ï¼š
<img loading="lazy" src="8.gif" alt=""  />

æ˜¾ç„¶ï¼Œå®ƒå°±å¯ä»¥åšåˆ°å¹¶å‘çš„ä¸‹è½½ï¼Œæˆ‘ä»¬ä¸¤ä¸ªä¸‹è½½ä»»åŠ¡å¯ä»¥åŒæ—¶è¿›è¡Œï¼Œå¹¶ä¸”æ‰€ç”¨çš„çº¿ç¨‹å§‹ç»ˆéƒ½åªæœ‰ä¸¤ä¸ªï¼Œå› ä¸ºå®ƒçš„æœ€å¤§çº¿ç¨‹æ•°ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¸ä¼šå†å»åˆ›å»ºæ–°çš„çº¿ç¨‹äº†ã€‚</p>
<h2 id="newcachedthreadpool">newCachedThreadPool<a hidden class="anchor" aria-hidden="true" href="#newcachedthreadpool">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> ExecutorService newCachedThreadPool() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(<span style="color:#ff0;font-weight:bold">0</span>, Integer.<span style="color:#007f7f">MAX_VALUE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ff0;font-weight:bold">60L</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">new</span> SynchronousQueue&lt;Runnable&gt;());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>maximumPoolSizeä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡è¯·æ±‚ï¼Œä¸å»ºè®®ä½¿ç”¨è¯¥çº¿ç¨‹æ± ã€‚
å¯ä»¥è¿›è¡Œç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œæ„å‘³ç€å®ƒçš„çº¿ç¨‹æ•°æ˜¯æœ€å¤§çš„ï¼Œæ— é™çš„ã€‚
å½“æœ‰æ–°ä»»åŠ¡åˆ°æ¥ï¼Œåˆ™æ’å…¥åˆ°SynchronousQueueä¸­ï¼Œç”±äºSynchronousQueueæ˜¯åŒæ­¥é˜Ÿåˆ—ï¼Œå› æ­¤ä¼šåœ¨æ± ä¸­å¯»æ‰¾å¯ç”¨çº¿ç¨‹æ¥æ‰§è¡Œï¼Œè‹¥æœ‰å¯ä»¥çº¿ç¨‹åˆ™æ‰§è¡Œï¼Œè‹¥æ²¡æœ‰å¯ç”¨çº¿ç¨‹åˆ™åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ï¼›è‹¥æ± ä¸­çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡æŒ‡å®šå¤§å°ï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¢«é”€æ¯ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 1.åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ã€‚å¦‚æœçº¿ç¨‹æ± çš„å¤§å°è¶…è¿‡äº†å¤„ç†ä»»åŠ¡æ‰€éœ€è¦çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ä¼šå›æ”¶éƒ¨åˆ†ç©ºé—²ï¼ˆ60ç§’ä¸æ‰§è¡Œä»»åŠ¡ï¼‰çš„çº¿ç¨‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 2.å½“ä»»åŠ¡æ•°å¢åŠ æ—¶ï¼Œæ­¤çº¿ç¨‹æ± åˆå¯ä»¥æ™ºèƒ½çš„æ·»åŠ æ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 3.æ­¤çº¿ç¨‹æ± ä¸ä¼šå¯¹çº¿ç¨‹æ± å¤§å°åšé™åˆ¶ï¼Œçº¿ç¨‹æ± å¤§å°å®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…è¯´JVMï¼‰èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> cacheThreadPool() {
</span></span><span style="display:flex;"><span>	ExecutorService cachedThreadPool = Executors.<span style="color:#007f7f">newCachedThreadPool</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">1</span>; i &lt;= <span style="color:#ff0;font-weight:bold">10</span>; i++) {
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> ii = i;
</span></span><span style="display:flex;"><span>		<span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>			Thread.<span style="color:#007f7f">sleep</span>(ii * <span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>		} <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>			e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		cachedThreadPool.<span style="color:#007f7f">execute</span>(()-&gt;System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;çº¿ç¨‹åç§°ï¼š&#34;</span> + Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34;ï¼Œæ‰§è¡Œ&#34;</span> + ii));
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œç»“æœï¼š
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ1
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ2
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ3
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ4
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ5
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ6
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ7
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ8
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ9
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ10</p>
<p><img loading="lazy" src="9.gif" alt=""  />

å› ä¸ºæ²¡æœ‰æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶ï¼Œæ‰€ä»¥ä¸€ç‚¹å…¨éƒ¨å¼€å§‹ä¸‹è½½ï¼Œå°±ä¼šåˆ›å»ºå‡º 5 æ¡æ–°çš„çº¿ç¨‹åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œä»ä¸Šå›¾çš„ä¾‹å­çœ‹å‡ºï¼Œæ¯æ¡çº¿ç¨‹éƒ½ä¸ä¸€æ ·ã€‚
ç”±äºè¿™ç§çº¿ç¨‹æ± åˆ›å»ºæ—¶åˆå§‹åŒ–æ—¶ï¼Œæœ€å¤§çº¿ç¨‹æ•°å’Œä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—éƒ½æ˜¯æ— ç•Œçš„å€¼ï¼Œæ‰€ä»¥è¿™å¯èƒ½ä¼šè€—å°½cpuèµ„æºã€‚
å› ä¸ºç©ºé—²çš„çº¿ç¨‹çš„æ‘§æ¯æ—¶é—´æ˜¯60ç§’ï¼Œä¸ºäº†è¯æ˜çº¿ç¨‹çš„å¤ç”¨æ•ˆæœï¼Œæˆ‘è¿™é‡Œåˆæ·»åŠ äº†ä¸€ä¸ªæŒ‰é’®ï¼Œåœ¨è¿™ä¸ªæŒ‰é’®ä¸­ç»§ç»­æ·»åŠ åé¢ä¸¤ä¸ªä¸‹è½½ä»»åŠ¡ã€‚
å½“çº¿ç¨‹ä¸‹è½½å®Œæ¯•æ—¶ï¼Œç©ºé—²çº¿ç¨‹å°±ä¼šå¤ç”¨ï¼Œç»“æœæ˜¾ç¤ºå¦‚ä¸‹ï¼Œå¤ç”¨çº¿ç¨‹æ± çš„ç©ºé—²çº¿ç¨‹ï¼š
<img loading="lazy" src="10.gif" alt=""  />
</p>
<p>å¦ä¸€ç§æƒ…å†µï¼Œå½“çº¿ç¨‹æ± ä¸­æ²¡æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œè¿™æ—¶åˆåŠ äº†æ–°çš„ä»»åŠ¡ï¼Œå®ƒå°±ä¼šåˆ›å»ºå‡ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œç»“æœå¦‚ä¸‹ï¼š
<img loading="lazy" src="11.gif" alt=""  />
</p>
<h2 id="newscheduledthreadpool">newScheduledThreadPool<a hidden class="anchor" aria-hidden="true" href="#newscheduledthreadpool">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ScheduledThreadPoolExecutor(<span style="color:#fff;font-weight:bold">int</span> corePoolSize,
</span></span><span style="display:flex;"><span>                                   ThreadFactory threadFactory) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">super</span>(corePoolSize, Integer.<span style="color:#007f7f">MAX_VALUE</span>, <span style="color:#ff0;font-weight:bold">0</span>, NANOSECONDS,
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">new</span> ScheduledThreadPoolExecutor.<span style="color:#007f7f">DelayedWorkQueue</span>(), threadFactory);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>maximumPoolSizeä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMï¼Œä¸å»ºè®®ä½¿ç”¨è¯¥çº¿ç¨‹æ± ã€‚
åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± å†…çº¿ç¨‹å­˜æ´»æ—¶é—´æ— é™åˆ¶ï¼Œçº¿ç¨‹æ± å¯ä»¥æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹å‡å¤„äºç¹å¿™çŠ¶æ€ï¼Œå¯¹äºæ–°ä»»åŠ¡ä¼šè¿›å…¥DelayedWorkQueueé˜Ÿåˆ—ä¸­ï¼Œè¿™æ˜¯ä¸€ç§æŒ‰ç…§è¶…æ—¶æ—¶é—´æ’åºçš„é˜Ÿåˆ—ç»“æ„ã€‚
é€‚ç”¨ï¼šå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œ</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚å»¶è¿Ÿæ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> sceduleThreadPool() {
</span></span><span style="display:flex;"><span>	ScheduledExecutorService scheduledThreadPool = Executors.<span style="color:#007f7f">newScheduledThreadPool</span>(<span style="color:#ff0;font-weight:bold">5</span>);
</span></span><span style="display:flex;"><span>	Runnable r1 = () -&gt; out.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;çº¿ç¨‹åç§°ï¼š&#34;</span> + Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34;ï¼Œæ‰§è¡Œ:3ç§’åæ‰§è¡Œ&#34;</span>);
</span></span><span style="display:flex;"><span>	scheduledThreadPool.<span style="color:#007f7f">schedule</span>(r1, <span style="color:#ff0;font-weight:bold">3</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>);
</span></span><span style="display:flex;"><span>	Runnable r2 = () -&gt; out.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;çº¿ç¨‹åç§°ï¼š&#34;</span> + Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34;ï¼Œæ‰§è¡Œ:å»¶è¿Ÿ2ç§’åæ¯3ç§’æ‰§è¡Œä¸€æ¬¡&#34;</span>);
</span></span><span style="display:flex;"><span>	scheduledThreadPool.<span style="color:#007f7f">scheduleAtFixedRate</span>(r2, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">3</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>);
</span></span><span style="display:flex;"><span>	Runnable r3 = () -&gt; out.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;çº¿ç¨‹åç§°ï¼š&#34;</span> + Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34;ï¼Œæ‰§è¡Œ:æ™®é€šä»»åŠ¡&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; <span style="color:#ff0;font-weight:bold">5</span>; i++) {
</span></span><span style="display:flex;"><span>		scheduledThreadPool.<span style="color:#007f7f">execute</span>(r3);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œç»“æœ:
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ:æ™®é€šä»»åŠ¡
çº¿ç¨‹åç§°ï¼špool-1-thread-5ï¼Œæ‰§è¡Œ:æ™®é€šä»»åŠ¡
çº¿ç¨‹åç§°ï¼špool-1-thread-4ï¼Œæ‰§è¡Œ:æ™®é€šä»»åŠ¡
çº¿ç¨‹åç§°ï¼špool-1-thread-3ï¼Œæ‰§è¡Œ:æ™®é€šä»»åŠ¡
çº¿ç¨‹åç§°ï¼špool-1-thread-2ï¼Œæ‰§è¡Œ:æ™®é€šä»»åŠ¡
çº¿ç¨‹åç§°ï¼špool-1-thread-1ï¼Œæ‰§è¡Œ:å»¶è¿Ÿ2ç§’åæ¯3ç§’æ‰§è¡Œä¸€æ¬¡
çº¿ç¨‹åç§°ï¼špool-1-thread-5ï¼Œæ‰§è¡Œ:3ç§’åæ‰§è¡Œ
çº¿ç¨‹åç§°ï¼špool-1-thread-4ï¼Œæ‰§è¡Œ:å»¶è¿Ÿ2ç§’åæ¯3ç§’æ‰§è¡Œä¸€æ¬¡
çº¿ç¨‹åç§°ï¼špool-1-thread-4ï¼Œæ‰§è¡Œ:å»¶è¿Ÿ2ç§’åæ¯3ç§’æ‰§è¡Œä¸€æ¬¡
çº¿ç¨‹åç§°ï¼špool-1-thread-4ï¼Œæ‰§è¡Œ:å»¶è¿Ÿ2ç§’åæ¯3ç§’æ‰§è¡Œä¸€æ¬¡
çº¿ç¨‹åç§°ï¼špool-1-thread-4ï¼Œæ‰§è¡Œ:å»¶è¿Ÿ2ç§’åæ¯3ç§’æ‰§è¡Œä¸€æ¬¡</p>
<h2 id="newworkstealingpool">newWorkStealingPool<a hidden class="anchor" aria-hidden="true" href="#newworkstealingpool">#</a></h2>
<p>æœ€æ˜æ˜¾çš„ç”¨æ„å°±æ˜¯å®ƒæ˜¯ä¸€ä¸ªå¹¶è¡Œçš„çº¿ç¨‹æ± ï¼Œå‚æ•°ä¸­ä¼ å…¥çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹å¹¶å‘çš„æ•°é‡ï¼Œè¿™é‡Œå’Œä¹‹å‰å°±æœ‰å¾ˆæ˜æ˜¾çš„åŒºåˆ«ï¼Œ
å‰é¢4ç§çº¿ç¨‹æ± éƒ½æœ‰æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ç­‰ç­‰ï¼Œè€Œè¿™å°±ä½¿ç”¨äº†ä¸€ä¸ªå¹¶å‘çº¿ç¨‹æ•°è§£å†³é—®é¢˜ã€‚
ä»ä»‹ç»ä¸­ï¼Œè¿˜è¯´æ˜è¿™ä¸ªçº¿ç¨‹æ± ä¸ä¼šä¿è¯ä»»åŠ¡çš„é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ WorkStealing çš„æ„æ€ï¼ŒæŠ¢å å¼çš„å·¥ä½œã€‚</p>
<p><a href="https://blog.csdn.net/tjbsl/article/details/98480843">gifå›¾å‚è€ƒ</a></p>
<h1 id="å¤šçº¿ç¨‹å®é™…åº”ç”¨">å¤šçº¿ç¨‹å®é™…åº”ç”¨<a hidden class="anchor" aria-hidden="true" href="#å¤šçº¿ç¨‹å®é™…åº”ç”¨">#</a></h1>
<p>éœ€æ±‚ï¼šæ‰¹é‡æ’å…¥100wæ•°æ®ï¼Œä½¿ç”¨çº¿ç¨‹æ± ã€‚
æ€è·¯ï¼šå°†æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚
æ–¹æ³•ï¼šä¸€æ¬¡æ€§å–å‡ºå…¨éƒ¨æ•°æ®ï¼Œæ”¾åˆ°å†…å­˜ä¸­ï¼Œåœ¨å†…å­˜ä¸­å°†æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œç„¶åçº¿ç¨‹æ± å¤„ç†æ•°æ®ã€‚
å¦‚æœæ•°æ®å¤ªå¤šï¼Œå¯ä»¥å…ˆåˆ†æ‰¹ä»æ•°æ®åº“ä¸­å–æ•°æ®ï¼Œç„¶ååœ¨å†…å­˜ä¸­åˆ†ç»„ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @author: wjy
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * @description: ç»™æ²¡æœ‰ç­çº§çš„å­¦æ ¡ï¼Œæ‰¹é‡æ·»åŠ 60ä¸ªç­çº§
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> addSquadForSchool() {
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//æ²¡æœ‰ç­çº§çš„å­¦æ ¡æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	List&lt;Integer&gt; list = schoolMapper.<span style="color:#007f7f">getSchoolWithoutSquad</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; list.<span style="color:#007f7f">size</span>(); i+=<span style="color:#ff0;font-weight:bold">100</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//100æ¡æ•°æ®ä¸€ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		<span style="color:#fff;font-weight:bold">int</span> toIndex = i + <span style="color:#ff0;font-weight:bold">100</span> &gt; list.<span style="color:#007f7f">size</span>() ? list.<span style="color:#007f7f">size</span>() : i+<span style="color:#ff0;font-weight:bold">100</span>;
</span></span><span style="display:flex;"><span>		List&lt;Integer&gt; subList = list.<span style="color:#007f7f">subList</span>(i,toIndex);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ¯1000æ¡æ•°æ®ä¸ºä¸€ç»„ï¼Œæ­¤å¤„ä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹å¼åˆ†ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">// List&lt;List&lt;Long&gt;&gt; lists = Lists.partition(idList, 1000);
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">//çº¿ç¨‹æ± å¤„ç†æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>		executorService.<span style="color:#007f7f">execute</span>(()-&gt;{
</span></span><span style="display:flex;"><span>			<span style="color:#007f7f">//æ‰¹é‡æ·»åŠ ç­çº§
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>			SquadUtils.<span style="color:#007f7f">batchInsertSquad</span>(subList);
</span></span><span style="display:flex;"><span>		});
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="çº¿ç¨‹æ± ç›‘æ§">çº¿ç¨‹æ± ç›‘æ§<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± ç›‘æ§">#</a></h1>
<p><a href="https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå…³äºçº¿ç¨‹æ± çš„æ–‡ç« </a></p>
<p><a href="https://www.jianshu.com/p/6f6e2bcb8128">å…¶ä»–å‚è€ƒ</a></p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://funny-toffee-4aa7c3.netlify.app/en/tags/multithreading/">multithreading</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://funny-toffee-4aa7c3.netlify.app/en/">Wjy&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
